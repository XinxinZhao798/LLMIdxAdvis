SELECT r.r_name AS region, n.n_name AS nation, AVG(p.p_retailprice) AS avg_retail_price, SUM(ps.ps_availqty) AS total_avail_qty, SUM(ps.ps_availqty * ps.ps_supplycost) AS total_value FROM nation n JOIN region r ON n.n_regionkey = r.r_regionkey JOIN partsupp ps ON ps.ps_suppkey = n.n_nationkey JOIN part p ON p.p_partkey = ps.ps_partkey GROUP BY r.r_name, n.n_name ORDER BY total_value DESC, avg_retail_price DESC LIMIT 10;
SELECT r.r_name AS region, COUNT(DISTINCT s.s_suppkey) AS total_suppliers, COUNT(DISTINCT c.c_custkey) AS total_customers, SUM(ps.ps_availqty) AS total_available_quantity, AVG(ps.ps_supplycost) AS average_supply_cost, SUM(l.l_quantity) AS total_quantity_ordered, AVG(l.l_extendedprice * (1 - l_discount)) AS average_discounted_price, SUM(o.o_totalprice) AS total_orders_value FROM region r JOIN supplier s ON r.r_regionkey = s.s_nationkey JOIN partsupp ps ON s.s_suppkey = ps.ps_suppkey JOIN lineitem l ON ps.ps_partkey = l.l_partkey AND ps.ps_suppkey = l.l_suppkey JOIN orders o ON l.l_orderkey = o.o_orderkey JOIN customer c ON o.o_custkey = c.c_custkey AND s.s_nationkey = c.c_nationkey WHERE l.l_shipdate BETWEEN '1995-01-01' AND '1996-12-31' AND c.c_acctbal > 5000 AND l.l_quantity < 30 GROUP BY r.r_name ORDER BY total_orders_value DESC LIMIT 1;
SELECT r.r_name AS region, COUNT(DISTINCT o.o_orderkey) AS total_orders, AVG(o.o_shippriority) AS avg_ship_priority, SUM(l.l_quantity) AS total_quantity_shipped, AVG(l.l_discount) AS avg_discount_offered FROM region r JOIN nation n ON r.r_regionkey = n.n_regionkey JOIN supplier s ON s.s_nationkey = n.n_nationkey JOIN partsupp ps ON ps.ps_suppkey = s.s_suppkey JOIN part p ON p.p_partkey = ps.ps_partkey JOIN lineitem l ON l.l_partkey = p.p_partkey AND l.l_suppkey = ps.ps_suppkey JOIN orders o ON o.o_orderkey = l.l_orderkey WHERE p.p_brand IN ('Brand#23', 'Brand#34') AND p.p_container IN ('SM BAG', 'JUMBO CAN') AND o.o_orderdate >= '2020-01-01'::date AND o.o_orderdate < '2021-01-01'::date GROUP BY r.r_name ORDER BY r.r_name;
SELECT n.n_name AS nation_name, p.p_type AS part_type, AVG(ps.ps_supplycost) AS avg_supply_cost, SUM(ps.ps_availqty) AS total_availability, COUNT(DISTINCT p.p_partkey) AS unique_parts_count FROM nation n JOIN partsupp ps ON n.n_nationkey = ps.ps_suppkey JOIN part p ON ps.ps_partkey = p.p_partkey WHERE ps.ps_availqty > 3000 AND p.p_size BETWEEN 30 AND 50 GROUP BY nation_name, part_type ORDER BY avg_supply_cost DESC, total_availability DESC LIMIT 10;
SELECT c.c_custkey, c.c_name, AVG(ps.ps_availqty) AS avg_parts_availability, SUM(l.l_quantity) AS total_quantity_ordered, SUM(l.l_extendedprice * (1 - l.l_discount)) AS total_revenue, COUNT(l.l_orderkey) AS total_orders FROM customer AS c JOIN lineitem AS l ON c.c_custkey = l.l_orderkey JOIN partsupp AS ps ON (l.l_partkey = ps.ps_partkey AND l.l_suppkey = ps.ps_suppkey) WHERE ps.ps_availqty BETWEEN 5000 AND 10000 GROUP BY c.c_custkey, c.c_name ORDER BY total_revenue DESC, total_orders DESC;
