SELECT ct.kind AS company_kind, AVG(t.production_year) AS average_production_year, COUNT(DISTINCT t.id) AS number_of_movies, SUM(COUNT(DISTINCT mk.keyword_id)) OVER (PARTITION BY mc.company_type_id) AS total_keywords FROM title t JOIN movie_companies mc ON t.id = mc.movie_id JOIN company_type ct ON mc.company_type_id = ct.id LEFT JOIN movie_keyword mk ON t.id = mk.movie_id GROUP BY ct.kind, mc.company_type_id ORDER BY average_production_year DESC, number_of_movies DESC;
SELECT cn.country_code, cc.status_id, COUNT(DISTINCT cn.id) AS number_of_companies, COUNT(DISTINCT cc.movie_id) AS number_of_movies, AVG(cn.imdb_id) AS average_imdb_id, STRING_AGG(DISTINCT it.info, '; ') AS associated_info_types FROM company_name AS cn JOIN complete_cast AS cc ON cn.id = cc.subject_id JOIN info_type AS it ON cc.status_id = it.id WHERE cc.status_id IN (3, 4) AND it.id IN (14, 61) GROUP BY cn.country_code, cc.status_id ORDER BY number_of_movies DESC;
SELECT rt.ROLE, COUNT(*) AS num_roles, AVG(cn.imdb_id) AS avg_imdb_id, SUM(cct.id) AS sum_cast_type_ids FROM aka_name AS an JOIN char_name AS cn ON an.person_id = cn.id JOIN comp_cast_type AS cct ON cn.id = cct.id JOIN role_type AS rt ON cct.id = rt.id GROUP BY rt.ROLE ORDER BY num_roles DESC;
SELECT rt.ROLE as role, COUNT(ci.id) as total_cast, AVG(ci.nr_order) as average_order, SUM(case when ci.note LIKE '%(voice:%' THEN 1 ELSE 0 END) as total_voice_roles, cm.name as company_name, cm.country_code as company_country, COUNT(distinct mc.movie_id) as total_movies_produced FROM cast_info ci JOIN role_type rt ON ci.role_id = rt.id AND rt.id IN (1, 10, 3, 5, 8, 9) JOIN movie_companies mc ON ci.movie_id = mc.movie_id JOIN company_name cm ON mc.company_id = cm.id WHERE mc.company_type_id = 1 AND mc.note LIKE '%(USA)%' AND ci.note NOT LIKE '%(credit only)%' GROUP BY role, company_name, company_country ORDER BY total_movies_produced DESC, total_cast DESC;
SELECT rt.ROLE as role, COUNT(*) as number_of_actors, AVG(name.imdb_id) as average_imdb_id, MAX(ci.nr_order) as max_order_appearance, MIN(name.surname_pcode) as min_surname_pcode, COUNT(DISTINCT comp_cast_type.id) as distinct_comp_cast_type_count FROM cast_info ci JOIN name ON ci.person_id = name.id JOIN role_type rt ON ci.role_id = rt.id JOIN comp_cast_type ON ci.person_role_id = comp_cast_type.id JOIN movie_link ON ci.movie_id = movie_link.movie_id WHERE name.gender = 'f' AND comp_cast_type.kind IN ('actor', 'actress') AND movie_link.link_type_id BETWEEN 1 AND 4 GROUP BY rt.ROLE ORDER BY number_of_actors DESC, average_imdb_id;
SELECT ct.kind AS cast_type, AVG(production_year) AS average_production_year, COUNT(DISTINCT ci.movie_id) AS number_of_movies, COUNT(DISTINCT ci.person_id) AS number_of_actors, COUNT(DISTINCT cn.id) AS number_of_characters, SUM(CASE WHEN ci.nr_order IS NOT NULL THEN 1 ELSE 0 END) AS number_of_credits_with_order FROM cast_info ci JOIN comp_cast_type ct ON ci.person_role_id = ct.id JOIN aka_title at ON ci.movie_id = at.movie_id JOIN char_name cn ON ci.person_id = cn.id WHERE at.kind_id = 1 AND ci.role_id IN (1,2) GROUP BY ct.kind ORDER BY number_of_movies DESC;
SELECT c.name AS company_name, COUNT(DISTINCT ml.movie_id) AS number_of_linked_movies, AVG(name.imdb_id) AS average_imdb_id, SUM(CASE WHEN name.gender = 'M' THEN 1 ELSE 0 END) AS count_male_actors, SUM(CASE WHEN name.gender = 'F' THEN 1 ELSE 0 END) AS count_female_actors FROM movie_link AS ml JOIN complete_cast AS cc ON cc.movie_id = ml.movie_id JOIN name ON name.id = cc.subject_id JOIN movie_companies AS mc ON mc.movie_id = ml.movie_id JOIN company_name AS c ON c.id = mc.company_id WHERE name.name_pcode_nf IN ('B534', 'A214', 'N6435', 'M243', 'O5254') GROUP BY c.name ORDER BY number_of_linked_movies DESC, average_imdb_id DESC;
SELECT kt.kind AS movie_kind, COUNT(DISTINCT cn.id) AS number_of_char_names, AVG(mi_idx.info::numeric) AS average_movie_info, SUM(CASE WHEN an.imdb_index = 'I' THEN 1 ELSE 0 END) AS indexed_aka_names_count FROM kind_type AS kt JOIN movie_info_idx AS mi_idx ON mi_idx.info_type_id = kt.id LEFT JOIN char_name AS cn ON cn.imdb_id = mi_idx.movie_id LEFT JOIN aka_name AS an ON an.person_id = mi_idx.movie_id WHERE kt.id IN (SELECT DISTINCT info_type_id FROM movie_info_idx) AND cn.id IN ('60670', '10694') AND mi_idx.note IS NOT NULL GROUP BY kt.kind;
SELECT ct.kind AS company_kind, COUNT(DISTINCT cc.movie_id) AS number_of_movies, COUNT(DISTINCT cc.subject_id) AS number_of_subjects, AVG(cc.status_id) AS average_status FROM company_type ct JOIN complete_cast cc ON ct.id = cc.status_id GROUP BY ct.kind HAVING COUNT(DISTINCT cc.movie_id) > 5 ORDER BY number_of_movies DESC, average_status ASC;
SELECT AVG(at.production_year) AS average_production_year, COUNT(DISTINCT comp.id) AS number_of_companies, SUM(CASE WHEN cc.status_id = 4 THEN 1 ELSE 0 END) AS full_cast_movies, COUNT(DISTINCT mk.id) AS number_of_keywords, MAX(pi.id) AS max_person_info_id FROM aka_title AS at JOIN movie_companies AS mc ON mc.movie_id = at.movie_id JOIN company_name AS comp ON mc.company_id = comp.id JOIN complete_cast AS cc ON at.movie_id = cc.movie_id JOIN movie_keyword AS mk ON at.movie_id = mk.movie_id LEFT JOIN person_info AS pi ON pi.person_id = at.movie_id WHERE at.kind_id = 1 AND mc.company_type_id IN (1, 2) AND cc.status_id IN (3, 4) AND at.production_year BETWEEN 1990 AND 2000 GROUP BY at.production_year ORDER BY average_production_year DESC;
SELECT kt.kind AS content_type, COUNT(DISTINCT k.id) AS total_keywords, COUNT(DISTINCT n.id) AS total_people, AVG(n.imdb_id) AS average_imdb_id, COUNT(DISTINCT ak.id) AS total_aka_names, MAX(it.id) AS max_info_type_id, MIN(lt.id) AS min_link_type_id FROM kind_type kt LEFT JOIN keyword k ON kt.id = k.id LEFT JOIN name n ON n.surname_pcode = k.phonetic_code LEFT JOIN aka_name ak ON ak.person_id = n.id LEFT JOIN info_type it ON it.id = ak.id LEFT JOIN link_type lt ON lt.id = it.id GROUP BY kt.kind;
SELECT AVG(aka_title.production_year) AS avg_production_year, COUNT(DISTINCT movie_keyword.keyword_id) AS num_keywords, COUNT(DISTINCT aka_title.movie_id) AS num_movies, AVG(COUNT(DISTINCT aka_title.movie_id)) OVER (PARTITION BY aka_title.production_year) AS avg_num_movies_per_year FROM aka_title JOIN complete_cast ON aka_title.movie_id = complete_cast.movie_id JOIN movie_keyword ON aka_title.movie_id = movie_keyword.movie_id WHERE complete_cast.status_id = 1 GROUP BY aka_title.production_year;
SELECT kt.kind, COUNT(DISTINCT cc.movie_id) AS number_of_movies, AVG(CAST(mi_idx.info AS NUMERIC)) AS average_movie_info, SUM(CASE WHEN mi_idx.note = 'Y' THEN 1 ELSE 0 END) AS count_noted_info FROM complete_cast cc JOIN kind_type kt ON cc.subject_id = kt.id JOIN movie_info_idx mi_idx ON cc.movie_id = mi_idx.movie_id WHERE cc.status_id IN (1, 2, 3) AND mi_idx.info_type_id BETWEEN 10 AND 20 AND mi_idx.id NOT IN (4072, 3466, 2096, 1652, 1371) AND cc.id NOT IN (3672, 620) GROUP BY kt.kind HAVING COUNT(DISTINCT cc.movie_id) > 5 ORDER BY average_movie_info DESC;
SELECT AVG(mi_idx.info::numeric) AS average_movie_rating, COUNT(DISTINCT cn.id) AS number_of_companies, COUNT(DISTINCT k.id) AS number_of_unique_keywords, MAX(cn.name) AS largest_company_name, ct.kind AS company_type, MIN(lt.link) AS link_type_description, STRING_AGG(DISTINCT k.keyword, ', ') AS keywords_list FROM movie_info_idx mi_idx JOIN movie_keyword mk ON mi_idx.movie_id = mk.movie_id JOIN keyword k ON mk.keyword_id = k.id JOIN company_name cn ON cn.country_code = '[lv]' OR cn.country_code = '[by]' JOIN company_type ct ON cn.id = ct.id JOIN link_type lt ON lt.id = mi_idx.info_type_id WHERE mi_idx.info_type_id = (SELECT id FROM link_type WHERE link = 'edited from') AND (k.keyword = 'blind-woman' OR k.keyword = 'weather-forecasting') AND cn.name_pcode_sf IN ('O2163', 'G4214', 'A4314') GROUP BY ct.kind ORDER BY average_movie_rating DESC;
SELECT COUNT(DISTINCT n.id) AS total_actors, AVG(n.imdb_id) AS average_imdb_id, SUM(CASE WHEN n.gender = 'f' THEN 1 ELSE 0 END) AS female_actors_count, SUM(CASE WHEN n.gender = 'm' THEN 1 ELSE 0 END) AS male_actors_count, COUNT(DISTINCT k.id) AS total_distinct_keywords, STRING_AGG(DISTINCT k.keyword, ', ') AS keywords_list FROM name AS n JOIN cast_info AS ci ON n.id = ci.person_id JOIN movie_keyword AS mk ON ci.movie_id = mk.movie_id JOIN keyword AS k ON mk.keyword_id = k.id JOIN comp_cast_type AS cct ON ci.role_id = cct.id WHERE k.keyword IN ('graffiti', 'goblet') AND n.name LIKE '%a%' GROUP BY cct.kind ORDER BY total_actors DESC;
SELECT rt.role AS role_type, COUNT(DISTINCT ci.person_id) AS number_of_people, AVG(mi.info::numeric) AS average_movie_rating, SUM(CASE WHEN k.keyword IN ('drug-abuser', 'obesity') THEN 1 ELSE 0 END) AS count_unhealthy_keywords, COUNT(DISTINCT mi.movie_id) AS number_of_movies FROM cast_info ci JOIN role_type rt ON ci.role_id = rt.id JOIN movie_info mi ON ci.movie_id = mi.movie_id AND mi.info_type_id = ( SELECT id FROM info_type WHERE info = 'rating' ) JOIN keyword k ON mi.movie_id = ANY ( SELECT movie_id FROM movie_info WHERE info = k.keyword ) GROUP BY rt.role HAVING COUNT(DISTINCT ci.person_id) > 10 ORDER BY average_movie_rating DESC;
SELECT ct.kind AS company_type, COUNT(DISTINCT cc.movie_id) AS total_movies, COUNT(DISTINCT ml.movie_id) AS total_linked_movies, AVG(CAST(mi.info AS NUMERIC)) FILTER (WHERE it.info = 'budget') AS average_movie_budget, SUM(CAST(mi.info AS INTEGER)) FILTER (WHERE it.info = 'votes') AS total_movie_votes FROM company_type ct JOIN movie_companies mc ON mc.company_type_id = ct.id JOIN complete_cast cc ON cc.movie_id = mc.movie_id JOIN movie_link ml ON ml.movie_id = mc.movie_id JOIN movie_info mi ON mi.movie_id = mc.movie_id JOIN info_type it ON it.id = mi.info_type_id WHERE ct.kind IN ('distributors', 'special effects companies', 'production companies') AND cc.status_id IN (3, 4) AND mi.movie_id IN ('932270', '939910') AND mi.info IN ('Gujarati', 'Tagalog', 'French', 'Portuguese') GROUP BY ct.kind ORDER BY total_movies DESC, average_movie_budget DESC;
SELECT rt.ROLE AS role_type, COUNT(DISTINCT ci.person_id) AS number_of_people, AVG(ci.nr_order) AS average_cast_order, SUM(CASE WHEN cct.kind = 'complete+verified' THEN 1 ELSE 0 END) AS total_complete_verified_casts, MIN(cn.country_code) AS country_code, MAX(mi.info) AS maximum_movie_info FROM cast_info ci JOIN role_type rt ON ci.role_id = rt.id JOIN complete_cast cc ON ci.movie_id = cc.movie_id JOIN comp_cast_type cct ON cc.status_id = cct.id JOIN company_name cn ON ci.person_id = cn.id JOIN movie_info mi ON ci.movie_id = mi.movie_id WHERE ci.person_role_id IN (107, 448, 439, 1389, 1249, 420) AND cc.movie_id = 1643515 AND cc.id IN (4897, 2653, 4910, 182, 342, 359) AND mi.info LIKE '0.......26%' GROUP BY rt.ROLE ORDER BY number_of_people DESC, average_cast_order;
SELECT kt.kind, COUNT(DISTINCT cn.id) AS total_characters, AVG(cn.imdb_id) AS average_imdb_id, COUNT(DISTINCT mi.info) AS distinct_info_count FROM kind_type AS kt LEFT JOIN movie_info_idx AS mi ON mi.info_type_id = kt.id LEFT JOIN char_name AS cn ON cn.imdb_id = mi.movie_id GROUP BY kt.kind ORDER BY total_characters DESC;
SELECT kt.kind AS movie_kind, AVG(at.production_year) AS average_production_year, COUNT(DISTINCT at.movie_id) AS total_movies, COUNT(DISTINCT mk.keyword_id) AS distinct_keywords FROM aka_title at INNER JOIN kind_type kt ON at.kind_id = kt.id LEFT JOIN movie_keyword mk ON at.movie_id = mk.movie_id GROUP BY kt.kind ORDER BY total_movies DESC, average_production_year DESC;
SELECT ct.kind AS company_kind, AVG(mi_idx.info::NUMERIC) AS average_movie_length, COUNT(DISTINCT ch_name.id) AS unique_character_count, COUNT(DISTINCT cn_name.id) AS unique_company_count, SUM(CASE WHEN ml.link_type_id = 2 THEN 1 ELSE 0 END) AS sequel_link_count FROM movie_info_idx AS mi_idx JOIN company_name AS cn_name ON cn_name.imdb_id = mi_idx.movie_id JOIN company_type AS ct ON cn_name.id = ct.id JOIN char_name AS ch_name ON ch_name.imdb_id = mi_idx.movie_id JOIN movie_link AS ml ON ml.movie_id = mi_idx.movie_id WHERE mi_idx.info_type_id = 1 AND ct.kind IN ('special effects companies', 'miscellaneous companies', 'production companies', 'distributors') AND ch_name.name IN ('Dr. Carlos Ventura', 'John Hartman Jr.', 'Paw Slawson', 'Pera', 'The Jester', 'Guitarist') GROUP BY ct.kind;
SELECT AVG(CAST(mi.info AS NUMERIC)) AS average_movie_duration, COUNT(DISTINCT ci.movie_id) AS number_of_movies, COUNT(DISTINCT ci.person_id) AS number_of_actors, MAX(CAST(mi.info AS INTERVAL)) AS longest_movie_duration, MIN(CAST(mi.info AS INTERVAL)) AS shortest_movie_duration FROM movie_info mi JOIN cast_info ci ON mi.movie_id = ci.movie_id JOIN movie_companies mc ON mi.movie_id = mc.movie_id JOIN comp_cast_type cct ON ci.person_role_id = cct.id JOIN char_name cn ON ci.person_id = cn.id WHERE mi.info_type_id = (SELECT id FROM info_type WHERE info = 'runtime') AND mc.note LIKE '%(USA)%' AND cct.kind IN ('cast', 'complete') AND cn.surname_pcode IN ('E235', 'A6432', 'E2536', 'A1526') GROUP BY mc.company_id ORDER BY average_movie_duration DESC;
SELECT rt.ROLE, COUNT(DISTINCT n.id) AS total_actors, AVG(t.production_year) AS average_production_year, SUM(CASE WHEN n.gender = 'F' THEN 1 ELSE 0 END) AS female_actors_count, SUM(CASE WHEN n.gender = 'M' THEN 1 ELSE 0 END) AS male_actors_count, COUNT(DISTINCT t.id) AS total_movies, COUNT(DISTINCT k.id) AS total_keywords FROM name n JOIN person_info pi ON n.id = pi.person_id JOIN movie_info_idx mii ON pi.info_type_id = mii.info_type_id JOIN role_type rt ON pi.info_type_id = rt.id JOIN title t ON mii.movie_id = t.id LEFT JOIN keyword k ON k.phonetic_code = t.phonetic_code WHERE mii.info IN ('856', '1..11...15') AND t.production_year BETWEEN 2000 AND 2020 GROUP BY rt.ROLE;
SELECT ct.kind AS company_kind, it.info AS info_category, COUNT(DISTINCT mi.movie_id) AS number_of_movies, AVG(ti.production_year) AS average_production_year, SUM(CASE WHEN ti.kind_id = ct.id AND ct.kind = 'production companies' THEN 1 ELSE 0 END) AS production_companies_count, SUM(CASE WHEN ti.kind_id = ct.id AND ct.kind = 'distributors' THEN 1 ELSE 0 END) AS distributors_count, SUM(CASE WHEN ti.kind_id = ct.id AND ct.kind = 'special effects companies' THEN 1 ELSE 0 END) AS special_effects_companies_count, SUM(CASE WHEN mi.note LIKE '%(Ukrainian)%' THEN 1 ELSE 0 END) AS ukrainian_notes_count FROM movie_info mi INNER JOIN info_type it ON mi.info_type_id = it.id INNER JOIN title ti ON mi.movie_id = ti.id INNER JOIN company_type ct ON ti.kind_id = ct.id GROUP BY ct.kind, it.info ORDER BY number_of_movies DESC, average_production_year DESC;
SELECT cn.name AS character_name, COUNT(DISTINCT cl.movie_id) AS total_linked_movies, COUNT(ci.person_id) AS total_roles_played, AVG(ci.nr_order) AS average_role_order FROM char_name AS cn JOIN cast_info AS ci ON cn.id = ci.person_id JOIN movie_link AS cl ON ci.movie_id = cl.movie_id WHERE cn.name IN ('Boy Negro''s Gang', 'Lazoglu', 'Paco Hernández Gil', 'Tedddy Hart', 'Funcionario prisión', 'Make Up Man') GROUP BY cn.name ORDER BY total_linked_movies DESC, total_roles_played DESC;
