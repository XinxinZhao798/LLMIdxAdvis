SELECT k.keyword, ci.person_role_id, COUNT(DISTINCT ci.person_id) AS unique_person_count, COUNT(ci.movie_id) AS movie_count, AVG(ci.nr_order) AS average_cast_order FROM cast_info ci JOIN movie_keyword mk ON ci.movie_id = mk.movie_id JOIN keyword k ON mk.keyword_id = k.id WHERE k.phonetic_code IN ('V315', 'G2324') GROUP BY k.keyword, ci.person_role_id ORDER BY unique_person_count DESC, movie_count DESC;
SELECT ct.kind AS company_type, COUNT(DISTINCT cn.id) AS number_of_companies, AVG((n.gender = 'M')::int) AS avg_male_actors, AVG((n.gender = 'F')::int) AS avg_female_actors, SUM(CASE WHEN mi_idx.info_type_id = 1 THEN 1 ELSE 0 END) AS number_of_movies, COUNT(DISTINCT pi.person_id) AS number_of_person_info_entries FROM company_type AS ct JOIN company_name AS cn ON cn.country_code NOT LIKE '[pl]' JOIN movie_info_idx AS mi_idx ON mi_idx.movie_id = cn.id LEFT JOIN person_info AS pi ON pi.info_type_id = mi_idx.info_type_id LEFT JOIN name AS n ON n.id = pi.person_id WHERE cn.name LIKE '%Entertainment%' AND ct.id IN (1, 2, 3) AND n.surname_pcode LIKE 'A4%' GROUP BY ct.kind;
SELECT t.kind_id, COUNT(DISTINCT t.id) AS total_movies, AVG(t.production_year) AS average_production_year, COUNT(DISTINCT ci.person_id) AS total_actors_involved, SUM(CASE WHEN ml.link_type_id = 1 THEN 1 ELSE 0 END) AS total_sequels_linked, MAX(ci.nr_order) AS highest_cast_order FROM title t JOIN cast_info ci ON t.id = ci.movie_id LEFT JOIN movie_link ml ON t.id = ml.movie_id GROUP BY t.kind_id HAVING COUNT(DISTINCT ci.person_id) > 10 ORDER BY total_movies DESC;
SELECT kt.kind AS movie_kind, COUNT(DISTINCT at.movie_id) AS total_movies, AVG(at.production_year) AS average_production_year, COUNT(DISTINCT ci.person_id) AS count_distinct_actors FROM aka_title at JOIN kind_type kt ON at.kind_id = kt.id LEFT JOIN cast_info ci ON at.movie_id = ci.movie_id AND ci.role_id = (SELECT id FROM role_type WHERE role = 'actor') WHERE at.production_year > 2000 GROUP BY kt.kind ORDER BY total_movies DESC;
SELECT ct.kind AS company_type, AVG(t.production_year) AS average_production_year, COUNT(DISTINCT mc.movie_id) AS total_movies, COUNT(DISTINCT ml.movie_id) AS total_movie_links, SUM(CASE WHEN t.kind_id = 2 THEN 1 ELSE 0 END) AS count_of_series, COUNT(DISTINCT t.id) FILTER (WHERE t.title = 'It Came from the Nightosphere' OR t.title = 'Wes Craven Presents Don''t Look Down') AS specific_titles_count FROM title t JOIN movie_companies mc ON t.id = mc.movie_id JOIN comp_cast_type ct ON mc.company_type_id = ct.id LEFT JOIN movie_link ml ON t.id = ml.movie_id WHERE ct.id IN (2, 3) AND mc.company_type_id = 1 AND (ml.link_type_id IN (12, 1, 13, 15) OR ml.link_type_id IS NULL) GROUP BY ct.kind
SELECT kt.kind AS movie_kind, AVG(t.production_year) AS average_production_year, COUNT(DISTINCT t.id) AS total_movies, COUNT(DISTINCT n.id) AS total_actors, SUM(CASE WHEN n.gender = 'F' THEN 1 ELSE 0 END) AS female_actors, SUM(CASE WHEN n.gender = 'M' THEN 1 ELSE 0 END) AS male_actors, COUNT(DISTINCT k.id) AS total_keywords FROM title t JOIN kind_type kt ON t.kind_id = kt.id LEFT JOIN cast_info ci ON t.id = ci.movie_id LEFT JOIN name n ON ci.person_id = n.id LEFT JOIN movie_keyword mk ON t.id = mk.movie_id LEFT JOIN keyword k ON mk.keyword_id = k.id WHERE t.production_year BETWEEN 2000 AND 2020 AND kt.kind IN ('movie', 'tv series', 'video') AND t.season_nr IS NULL GROUP BY kt.kind ORDER BY total_movies DESC, average_production_year DESC;
SELECT rt.ROLE AS role_type, AVG(name.imdb_id) AS average_imdb_id, SUM(case when name.gender = 'M' then 1 else 0 end) AS number_of_male_actors, SUM(case when name.gender = 'F' then 1 else 0 end) AS number_of_female_actors, COUNT(DISTINCT ci.movie_id) AS number_of_movies, MAX(title.production_year) AS latest_movie_year, MIN(title.production_year) AS earliest_movie_year, AVG(title.production_year) AS average_movie_year FROM cast_info ci JOIN name ON ci.person_id = name.id JOIN role_type rt ON ci.role_id = rt.id JOIN title ON ci.movie_id = title.id WHERE ci.person_role_id IN (541, 657, 1059) AND name.name_pcode_cf IN ('A4545', 'A4135', 'A242') AND name.surname_pcode IN ('A42', 'A456', 'A432', 'A426', 'A461') GROUP BY rt.ROLE ORDER BY number_of_movies DESC;
SELECT ct.kind AS company_kind, kt.kind AS movie_kind, COUNT(mc.movie_id) AS num_movies, AVG(mi_idx.info::NUMERIC) AS average_info, SUM(CASE WHEN mi_idx.note = 'Y' THEN 1 ELSE 0 END) AS noted_count FROM movie_companies AS mc JOIN company_type AS ct ON mc.company_type_id = ct.id JOIN movie_info_idx AS mi_idx ON mc.movie_id = mi_idx.movie_id JOIN kind_type AS kt ON mi_idx.info_type_id = kt.id JOIN movie_keyword AS mk ON mc.movie_id = mk.movie_id WHERE mc.movie_id IN (8982, 14559, 8408) AND kt.id IN (6, 2, 3, 4, 5, 1) GROUP BY company_kind, movie_kind ORDER BY num_movies DESC, average_info DESC;
SELECT COUNT(DISTINCT n.id) AS total_actors, AVG(n.imdb_id) AS average_imdb_id, SUM(CASE WHEN n.gender = 'f' THEN 1 ELSE 0 END) AS female_actors_count, SUM(CASE WHEN n.gender = 'm' THEN 1 ELSE 0 END) AS male_actors_count, COUNT(DISTINCT k.id) AS total_distinct_keywords, STRING_AGG(DISTINCT k.keyword, ', ') AS keywords_list FROM name AS n JOIN cast_info AS ci ON n.id = ci.person_id JOIN movie_keyword AS mk ON ci.movie_id = mk.movie_id JOIN keyword AS k ON mk.keyword_id = k.id JOIN comp_cast_type AS cct ON ci.role_id = cct.id WHERE k.keyword IN ('graffiti', 'goblet') AND n.name LIKE '%a%' GROUP BY cct.kind ORDER BY total_actors DESC;
SELECT kt.kind, AVG(CAST(mi.info AS numeric)) AS average_rating, COUNT(DISTINCT t.id) AS total_movies, COUNT(DISTINCT c.id) AS total_cast_members, SUM(CASE WHEN t.production_year > 2010 THEN 1 ELSE 0 END) AS movies_after_2010, MIN(t.production_year) AS earliest_production_year, MAX(t.production_year) AS latest_production_year FROM title t JOIN kind_type kt ON t.kind_id = kt.id JOIN movie_info mi ON t.id = mi.movie_id JOIN movie_info_idx mi_idx ON t.id = mi_idx.movie_id JOIN complete_cast c ON t.id = c.movie_id WHERE t.kind_id IN (2, 7) AND mi.info_type_id = (SELECT id FROM movie_info WHERE info = 'rating') AND t.episode_nr IN (332, 104, 36) AND mi_idx.info_type_id IN (SELECT id FROM movie_info_idx WHERE note = 'R') GROUP BY kt.kind ORDER BY average_rating DESC;
SELECT ct.kind AS company_kind, COUNT(DISTINCT cn.id) AS total_companies, AVG(ci.nr_order) AS average_order, SUM(CASE WHEN cct.kind = 'cast' THEN 1 ELSE 0 END) AS total_cast_roles, SUM(CASE WHEN cct.kind = 'crew' THEN 1 ELSE 0 END) AS total_crew_roles FROM company_name cn JOIN company_type ct ON cn.id = ct.id JOIN movie_companies mc ON cn.id = mc.company_id JOIN cast_info ci ON mc.movie_id = ci.movie_id JOIN comp_cast_type cct ON ci.person_role_id = cct.id WHERE (cn.name = 'Laska Productions' OR cn.name = 'Curzon Film World' OR cn.name = 'Jernigan Films' OR cn.name = 'Clark Productions') AND ct.kind IN ('production companies', 'distributors') AND ci.person_id IN (1732, 1053, 1788, 1668, 1056, 1817) AND ci.person_role_id IN (374, 366) AND cct.id IN (1, 2, 3, 4) GROUP BY ct.kind;
SELECT kt.kind AS movie_kind, AVG(akat.production_year) AS average_production_year, COUNT(DISTINCT akat.movie_id) AS total_movies, SUM(CASE WHEN cn.country_code LIKE 'US%' THEN 1 ELSE 0 END) AS total_usa_productions FROM aka_title AS akat JOIN kind_type AS kt ON akat.kind_id = kt.id JOIN company_name AS cn ON akat.movie_id = cn.imdb_id WHERE akat.production_year BETWEEN 1990 AND 2000 AND kt.kind IN ('tv movie', 'movie') AND cn.country_code IN ('USA', 'CAN', 'GBR') GROUP BY kt.kind ORDER BY total_movies DESC;
SELECT cct.kind AS cast_type, COUNT(DISTINCT cc.movie_id) AS number_of_movies, rt.ROLE AS role_type, COUNT(DISTINCT mi.movie_id) AS movies_with_info, AVG(CAST(mi.info AS numeric)) AS average_info_numeric_value FROM comp_cast_type AS cct JOIN complete_cast AS cc ON cct.id = cc.status_id JOIN role_type AS rt ON cc.subject_id = rt.id JOIN movie_info_idx AS mi ON cc.movie_id = mi.movie_id WHERE cct.id IN (2, 3) AND rt.id IN (11, 9, 1, 3) AND rt.ROLE IN ('producer', 'guest', 'writer') AND mi.id IN (4348, 2817, 476, 2090, 937) GROUP BY cct.kind, rt.ROLE ORDER BY number_of_movies DESC, average_info_numeric_value DESC;
