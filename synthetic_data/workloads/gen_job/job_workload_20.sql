SELECT COUNT(DISTINCT ci.movie_id) AS number_of_movies, AVG(ci.nr_order) AS average_cast_position, MIN(n.name) AS first_actor_name, MAX(n.name) AS last_actor_name, COUNT(DISTINCT n.id) AS number_of_actors, SUM(CASE WHEN ci.note LIKE '%(voice)%' THEN 1 ELSE 0 END) AS number_of_voice_actors, COUNT(DISTINCT cc.id) AS number_of_complete_casts, COUNT(DISTINCT cct.id) AS number_of_different_cast_types FROM cast_info AS ci JOIN name AS n ON ci.person_id = n.id LEFT JOIN complete_cast AS cc ON ci.movie_id = cc.movie_id LEFT JOIN comp_cast_type AS cct ON cc.subject_id = cct.id WHERE ci.role_id = (SELECT id FROM comp_cast_type WHERE kind = 'actor') AND (ci.note LIKE '%(voice)%' OR ci.note NOT LIKE '%(archive footage)%') GROUP BY ci.movie_id HAVING COUNT(DISTINCT ci.person_id) > 1;
SELECT kt.kind, lt.link, COUNT(DISTINCT mi.movie_id) AS num_movies, AVG(n.imdb_id) AS avg_imdb_id, SUM(CASE WHEN mi.info = 'French' THEN 1 ELSE 0 END) AS num_french_movies, SUM(CASE WHEN mi.note = '(none)' THEN 1 ELSE 0 END) AS num_movies_without_notes, COUNT(DISTINCT c.name) FILTER (WHERE c.surname_pcode = 'M6456') AS count_characters_with_surname_pcode_M6456 FROM movie_info mi JOIN kind_type kt ON mi.movie_id = kt.id JOIN link_type lt ON lt.id = mi.info_type_id LEFT JOIN movie_info_idx mii ON mii.movie_id = mi.movie_id AND mii.info_type_id = mi.info_type_id LEFT JOIN char_name c ON c.id = mii.info_type_id LEFT JOIN name n ON n.id = c.id WHERE lt.id IN ('4', '6', '9', '1', '14') AND mi.info IN ('Albanian', 'Catalan', 'French', 'Danish') GROUP BY kt.kind, lt.link ORDER BY num_movies DESC, avg_imdb_id;
SELECT ct.kind AS company_type, AVG(CAST(at.production_year AS NUMERIC)) AS average_production_year, COUNT(DISTINCT ci.movie_id) AS number_of_movies, COUNT(DISTINCT cn.id) AS number_of_companies, SUM(CASE WHEN lt.LINK = 'references' THEN 1 ELSE 0 END) AS references_count, SUM(CASE WHEN lt.LINK = 'referenced in' THEN 1 ELSE 0 END) AS referenced_in_count FROM company_type AS ct JOIN company_name AS cn ON cn.country_code = 'US' JOIN movie_info AS mi ON mi.movie_id = cn.id JOIN aka_title AS at ON at.movie_id = mi.movie_id JOIN cast_info AS ci ON ci.movie_id = at.movie_id JOIN link_type AS lt ON lt.id IN (SELECT ml.link_type_id FROM movie_link AS ml WHERE ml.movie_id = ci.movie_id) WHERE ct.kind IN ('production companies', 'distributors') AND at.production_year BETWEEN 2000 AND 2010 AND ci.nr_order IS NOT NULL GROUP BY ct.kind ORDER BY number_of_movies DESC;
SELECT ct.kind AS company_type, COUNT(DISTINCT mc.movie_id) AS total_movies, AVG(at.production_year) AS average_production_year, SUM(CASE WHEN at.season_nr IN ('6', '22', '9', '1') THEN 1 ELSE 0 END) AS total_seasonal_titles, COUNT(DISTINCT ml.movie_id) AS total_movies_with_links, COUNT(DISTINCT pi.person_id) AS total_people_with_info FROM company_type AS ct JOIN movie_companies AS mc ON ct.id = mc.company_type_id LEFT JOIN aka_title AS at ON mc.movie_id = at.movie_id LEFT JOIN movie_link AS ml ON mc.movie_id = ml.movie_id LEFT JOIN person_info AS pi ON pi.person_id = mc.movie_id WHERE ct.kind IN ('special effects companies', 'miscellaneous companies', 'production companies', 'distributors') GROUP BY ct.kind ORDER BY total_movies DESC;
SELECT AVG(t.production_year) AS average_production_year, COUNT(DISTINCT t.id) AS number_of_movies, COUNT(DISTINCT k.id) AS number_of_unique_keywords, SUM(CASE WHEN k.keyword = 'poisoning' THEN 1 ELSE 0 END) AS count_poisoning_keyword, SUM(CASE WHEN k.keyword = 'law-student' THEN 1 ELSE 0 END) AS count_law_student_keyword, MAX(t.title) AS latest_movie_title FROM title AS t JOIN movie_keyword AS mk ON t.id = mk.movie_id JOIN keyword AS k ON mk.keyword_id = k.id JOIN movie_info AS mi ON t.id = mi.movie_id JOIN company_type AS ct ON ct.id = mi.info_type_id WHERE t.production_year BETWEEN 2000 AND 2010 AND ct.kind IN ('production companies', 'distributors') GROUP BY ct.kind ORDER BY average_production_year DESC;
SELECT kt.kind AS movie_kind, COUNT(DISTINCT ci.movie_id) AS number_of_movies, AVG(ci.nr_order) AS average_cast_order, SUM(CASE WHEN ci.person_role_id IS NOT NULL THEN 1 ELSE 0 END) AS number_of_characters, COUNT(DISTINCT mk.keyword_id) AS number_of_unique_keywords, COUNT(DISTINCT cn.id) AS number_of_companies_involved, STRING_AGG(DISTINCT cn.country_code, ', ') AS countries_involved FROM cast_info ci JOIN movie_keyword mk ON ci.movie_id = mk.movie_id JOIN movie_companies mc ON ci.movie_id = mc.movie_id JOIN company_name cn ON mc.company_id = cn.id JOIN kind_type kt ON kt.id IN (6, 4) WHERE ci.nr_order = 39 AND mk.id IN (337, 1460, 1468, 4397, 4374, 1643) AND mk.keyword_id = 3554 AND kt.kind IN ('tv movie', 'tv mini series', 'video game', 'episode') GROUP BY kt.kind;
SELECT COUNT(DISTINCT ci.movie_id) AS total_movies, AVG(mi_idx.avg_rating) AS average_movie_rating, SUM(case when ci.note LIKE '%(voice)%' THEN 1 ELSE 0 END) AS total_voice_roles FROM cast_info ci JOIN (SELECT movie_id, AVG(CAST(info AS FLOAT)) as avg_rating FROM movie_info_idx WHERE info_type_id = 101 GROUP BY movie_id) mi_idx ON mi_idx.movie_id = ci.movie_id JOIN movie_keyword mk ON mk.movie_id = ci.movie_id JOIN char_name chn ON chn.id = ci.person_role_id JOIN aka_name an ON an.person_id = ci.person_id WHERE chn.surname_pcode IN ('L236', 'S4251', 'H61', 'M13', 'G64', 'B4123') AND an.md5sum IN ('335ed401df5f248a3e329bb55d27dd0d', '7b6c3470024015d9b7509ce72ba9bdbe', '676e4dab04ea3f8b91859f8353698682', 'ae437679898b344a4c9d5b911ff41b3d', '2326d6a8ac3328a37b6196b7d6122ca1', '2f0962bd6afa28b8588a8333f39cbb4e') AND mk.keyword_id IN (SELECT id FROM movie_keyword WHERE movie_id = mk.movie_id) GROUP BY chn.surname_pcode;
SELECT cct.kind AS cast_type, AVG(t.production_year) AS average_production_year, COUNT(DISTINCT k.id) AS unique_keywords_count, SUM(CASE WHEN t.kind_id = cct.id AND cct.kind = 'complete+verified' THEN 1 ELSE 0 END) AS total_complete_verified_titles, COUNT(*) AS total_titles FROM title t LEFT JOIN comp_cast_type cct ON t.kind_id = cct.id LEFT JOIN keyword k ON k.phonetic_code = t.phonetic_code GROUP BY cct.kind ORDER BY total_complete_verified_titles DESC;
SELECT kt.kind AS movie_genre, COUNT(DISTINCT t.id) AS total_movies, AVG(t.production_year) AS average_production_year, COUNT(DISTINCT mc.company_id) AS total_production_companies, COUNT(DISTINCT n.id) AS total_unique_actors FROM title AS t JOIN kind_type AS kt ON t.kind_id = kt.id JOIN movie_companies AS mc ON t.id = mc.movie_id JOIN cast_info AS ci ON t.id = ci.movie_id JOIN name AS n ON ci.person_id = n.id WHERE t.production_year > 1990 AND mc.movie_id IN ('9013', '18754', '19628', '12173') AND mc.id IN ('2363', '1293', '1757', '2957') GROUP BY kt.kind ORDER BY total_movies DESC;
SELECT ct.kind AS cast_type, lt.LINK AS link_type, avg(at.production_year) AS average_production_year, count(distinct at.movie_id) AS number_of_movies, sum(CASE WHEN co.kind = 'distributors' THEN 1 ELSE 0 END) AS number_of_distributors, sum(CASE WHEN co.kind = 'production companies' THEN 1 ELSE 0 END) AS number_of_production_companies, sum(CASE WHEN co.kind = 'special effects companies' THEN 1 ELSE 0 END) AS number_of_special_effects_companies FROM comp_cast_type AS ct JOIN aka_title AS at ON ct.id = at.kind_id JOIN company_type AS co ON at.kind_id = co.id JOIN link_type AS lt ON at.id = lt.id WHERE ct.kind IN ('complete+verified', 'cast', 'crew', 'complete') AND lt.id IN ('13', '3', '5', '1', '10', '15') AND at.phonetic_code IN ('K4236', 'P2163', 'B5326') AND at.kind_id IN ('3', '2', '1', '4') GROUP BY ct.kind, lt.LINK;
SELECT kt.kind AS movie_kind, COUNT(DISTINCT t.id) AS number_of_movies, AVG(t.production_year) AS average_production_year, SUM(CASE WHEN ml.linked_movie_id IS NOT NULL THEN 1 ELSE 0 END) AS total_linked_movies FROM aka_title AS t JOIN kind_type AS kt ON t.kind_id = kt.id JOIN movie_link AS ml ON t.movie_id = ml.movie_id JOIN movie_companies AS mc ON t.movie_id = mc.movie_id JOIN company_name AS cn ON mc.company_id = cn.id WHERE t.production_year IN (1995, 1960, 1928, 1896) AND cn.country_code IN ('[no]', '[ao]', '[th]', '[ae]', '[ve]') AND kt.kind IN ('video movie', 'tv series', 'movie') GROUP BY kt.kind;
SELECT k.keyword, k.phonetic_code, COUNT(DISTINCT mk.movie_id) AS movies_count, COUNT(DISTINCT pi.person_id) AS people_count, SUM(CASE WHEN pi.note IS NOT NULL THEN 1 ELSE 0 END) AS noted_info_count, AVG(CASE WHEN pi.note IS NOT NULL THEN 1 ELSE 0 END) AS avg_noted_info FROM keyword AS k JOIN movie_keyword AS mk ON k.id = mk.keyword_id JOIN person_info AS pi ON mk.movie_id = pi.person_id GROUP BY k.keyword, k.phonetic_code ORDER BY movies_count DESC, people_count DESC;
SELECT it.info AS info_type, AVG(mi.production_year) AS average_production_year, COUNT(DISTINCT k.id) AS number_of_unique_keywords, COUNT(DISTINCT ml.movie_id) AS number_of_movies_linked, SUM(CASE WHEN pi.info_type_id = it.id THEN 1 ELSE 0 END) AS number_of_person_info_entries FROM movie_info_idx AS mii JOIN aka_title AS mi ON mi.movie_id = mii.movie_id JOIN info_type AS it ON mii.info_type_id = it.id JOIN keyword AS k ON k.id = mii.info_type_id JOIN movie_link AS ml ON ml.movie_id = mii.movie_id JOIN person_info AS pi ON pi.info_type_id = it.id GROUP BY it.info ORDER BY number_of_unique_keywords DESC, average_production_year DESC;
