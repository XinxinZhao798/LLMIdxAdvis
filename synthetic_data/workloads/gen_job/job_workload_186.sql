SELECT cn.name AS company_name, AVG(CAST(mi_idx.info AS NUMERIC)) AS average_rating, COUNT(DISTINCT rt.id) AS number_of_roles, SUM(CASE WHEN cn.name_pcode_sf = 'Y5214' THEN 1 ELSE 0 END) AS count_Y5214_companies, SUM(CASE WHEN cn.name_pcode_sf = 'F2536' THEN 1 ELSE 0 END) AS count_F2536_companies FROM company_name AS cn JOIN movie_companies AS mc ON mc.company_id = cn.id JOIN movie_info_idx AS mi_idx ON mi_idx.movie_id = mc.movie_id JOIN cast_info AS ci ON ci.movie_id = mc.movie_id JOIN role_type AS rt ON rt.id = ci.role_id WHERE mi_idx.info_type_id = (SELECT id FROM info_type WHERE info = 'rating') GROUP BY cn.name HAVING COUNT(DISTINCT rt.id) > 1 ORDER BY average_rating DESC;
SELECT t.production_year, COUNT(DISTINCT ci.movie_id) AS number_of_movies, COUNT(DISTINCT ci.person_id) AS number_of_actors, AVG(ci.nr_order) AS average_cast_order, SUM(CASE WHEN n.gender = 'm' THEN 1 ELSE 0 END) AS male_actors_count, SUM(CASE WHEN n.gender <> 'm' THEN 1 ELSE 0 END) AS female_and_other_actors_count, it.info AS info_type, COUNT(DISTINCT t.id) FILTER (WHERE it.info = 'budget') AS number_of_movies_with_budget, COUNT(DISTINCT t.id) FILTER (WHERE it.info = 'LD digital sound') AS number_of_movies_with_ld_digital_sound FROM cast_info ci JOIN name n ON ci.person_id = n.id JOIN title t ON ci.movie_id = t.id JOIN info_type it ON ci.role_id = it.id GROUP BY t.production_year, it.info ORDER BY t.production_year DESC, it.info;
SELECT ct.kind AS company_type, COUNT(DISTINCT mc.movie_id) AS number_of_movies, AVG(aka.production_year) AS average_production_year, COUNT(DISTINCT cn.id) AS number_of_companies, COUNT(DISTINCT char_name.id) AS number_of_unique_char_names FROM movie_companies mc JOIN aka_title aka ON mc.movie_id = aka.movie_id JOIN company_name cn ON mc.company_id = cn.id JOIN company_type ct ON mc.company_type_id = ct.id JOIN char_name ON cn.id = char_name.id WHERE ct.kind NOT IN ('subsidiary', 'division') AND char_name.id IN ('12861', '46459', '54418', '37871', '75348') AND aka.production_year BETWEEN 2000 AND 2010 GROUP BY ct.kind ORDER BY number_of_movies DESC, average_production_year;
SELECT cc.kind AS company_cast_type, COUNT(DISTINCT mc.movie_id) AS number_of_movies, COUNT(DISTINCT cn.id) AS number_of_companies, AVG(name.length) AS average_name_length FROM movie_companies AS mc JOIN comp_cast_type AS cc ON mc.company_type_id = cc.id JOIN company_name AS cn ON mc.company_id = cn.id JOIN (SELECT id, CHAR_LENGTH(name) AS length FROM name WHERE gender = 'm') AS name ON name.id = mc.movie_id WHERE mc.movie_id IN ('18930', '11158', '28073', '9831', '18529', '30177') AND cc.kind IN ('complete', 'crew', 'cast') GROUP BY cc.kind;
SELECT t.title, COUNT(DISTINCT ci.person_id) AS total_cast_members, AVG(ci.nr_order) AS average_cast_position, COUNT(DISTINCT mc.company_id) AS number_of_companies_involved, MAX(t.production_year) AS latest_production_year, SUM(CASE WHEN cct.kind = 'production' THEN 1 ELSE 0 END) AS total_production_companies FROM title t LEFT JOIN cast_info ci ON t.id = ci.movie_id LEFT JOIN movie_companies mc ON t.id = mc.movie_id LEFT JOIN comp_cast_type cct ON mc.company_type_id = cct.id WHERE t.production_year > 2000 AND mc.note LIKE '%(TV)%' GROUP BY t.title ORDER BY total_cast_members DESC, latest_production_year DESC;
SELECT ml.movie_id, lt.LINK AS link_type, COUNT(ml.id) AS total_links, AVG(cn.imdb_id) AS avg_company_imdb_id FROM movie_link AS ml JOIN link_type AS lt ON ml.link_type_id = lt.id JOIN company_name AS cn ON ml.movie_id = cn.id GROUP BY ml.movie_id, lt.LINK ORDER BY total_links DESC, avg_company_imdb_id DESC;
SELECT kt.kind AS movie_kind, COUNT(DISTINCT t.id) AS total_movies, AVG(t.production_year) AS average_production_year, COUNT(DISTINCT ci.person_id) AS total_actors, rt.role AS role, COUNT(DISTINCT cn.id) AS total_companies, COUNT(DISTINCT cc.id) AS total_complete_cast FROM title t JOIN kind_type kt ON t.kind_id = kt.id LEFT JOIN cast_info ci ON t.id = ci.movie_id LEFT JOIN role_type rt ON ci.role_id = rt.id LEFT JOIN company_name cn ON cn.imdb_id = t.imdb_id LEFT JOIN complete_cast cc ON t.id = cc.movie_id WHERE t.production_year BETWEEN 2000 AND 2010 AND kt.kind IN ('movie', 'tv series') AND rt.role IN ('producer', 'composer', 'actress', 'writer', 'costume designer', 'cinematographer') AND cc.status_id IN (3, 4) GROUP BY kt.kind, rt.role ORDER BY total_movies DESC, average_production_year DESC, total_actors DESC, total_companies DESC;
SELECT AVG(CAST(mi.info AS NUMERIC)) AS average_rating, COUNT(DISTINCT ci.movie_id) AS number_of_movies, SUM(CASE WHEN k.keyword = 'sugar' THEN 1 ELSE 0 END) AS sugar_keyword_count, SUM(CASE WHEN k.keyword = 'chair' THEN 1 ELSE 0 END) AS chair_keyword_count, COUNT(DISTINCT akn.person_id) AS unique_actors_with_alternate_names, MAX(mi.note) AS longest_note FROM movie_info mi JOIN info_type it ON mi.info_type_id = it.id AND it.info = 'rating' JOIN cast_info ci ON mi.movie_id = ci.movie_id JOIN movie_keyword mk ON ci.movie_id = mk.movie_id JOIN keyword k ON mk.keyword_id = k.id AND k.id IN ('5046', '3865') LEFT JOIN aka_name akn ON ci.person_id = akn.person_id WHERE mi.movie_id IN (SELECT movie_id FROM movie_keyword WHERE keyword_id IN ('5046', '3865')) GROUP BY it.info;
SELECT kt.kind AS movie_kind, COUNT(DISTINCT mi_idx.movie_id) AS total_movies, COUNT(DISTINCT mk.movie_id) AS total_movies_with_keywords, AVG(CAST(mi_idx.info AS NUMERIC)) AS average_info_num, SUM(CAST(CASE WHEN mi_idx.info LIKE '%1%' THEN 1 ELSE 0 END AS INTEGER)) AS count_info_with_1 FROM movie_info_idx mi_idx JOIN movie_keyword mk ON mi_idx.movie_id = mk.movie_id JOIN kind_type kt ON mi_idx.info_type_id = kt.id JOIN movie_link ml ON mi_idx.movie_id = ml.movie_id JOIN name n ON ml.movie_id = n.id WHERE n.md5sum IN ('801a5d533ecc2c88317db66319d4aad9', 'caa370cb4f3c3b62016775d613ce5575', '4fc8edf0bba0a30ce337c1c452a645f0') AND ml.linked_movie_id IN (1412141, 604005, 716090) AND mi_idx.info SIMILAR TO '%[0-9]%' AND mk.keyword_id IN ( SELECT id FROM keyword WHERE keyword IN ('wind-up-toy', 'money-in-title', 'suicide-pill') ) GROUP BY kt.kind ORDER BY total_movies_with_keywords DESC;
SELECT lt.LINK AS link_type, COUNT(DISTINCT mk.movie_id) AS total_movies, COUNT(mk.keyword_id) AS total_keywords_use, AVG(keyword_length) AS avg_keyword_length, SUM(keyword_length) AS total_keyword_length FROM movie_keyword mk JOIN keyword k ON mk.keyword_id = k.id JOIN link_type lt ON mk.id = lt.id CROSS JOIN (SELECT LENGTH(k.keyword) AS keyword_length FROM keyword k) AS subquery GROUP BY lt.LINK ORDER BY total_movies DESC;
SELECT avg(pi.info::numeric) AS average_rating, count(DISTINCT ci.person_id) AS number_of_actors, count(DISTINCT mk.keyword_id) AS number_of_keywords, kt.kind_id, kt.production_year FROM movie_keyword AS mk INNER JOIN keyword AS k ON mk.keyword_id = k.id INNER JOIN movie_companies AS mc ON mk.movie_id = mc.movie_id INNER JOIN cast_info AS ci ON mc.movie_id = ci.movie_id INNER JOIN aka_title AS kt ON mc.movie_id = kt.movie_id INNER JOIN person_info AS pi ON ci.person_id = pi.person_id AND pi.info_type_id = 101 WHERE kt.title IN ('Law & Order: Special Victims Unit', 'Plus One Minus One', 'The Searchers') AND mc.movie_id IN ('12242', '26379') AND kt.production_year BETWEEN 1990 AND 2020 GROUP BY kt.kind_id, kt.production_year ORDER BY average_rating DESC, number_of_actors DESC, number_of_keywords DESC;
SELECT rt.ROLE AS role_type, COUNT(DISTINCT cn.id) AS number_of_companies, COUNT(DISTINCT mk.movie_id) AS number_of_movies_with_keywords, AVG(cn.imdb_id) AS average_imdb_id, SUM(CASE WHEN cn.country_code = 'US' THEN 1 ELSE 0 END) AS us_based_companies_count FROM role_type rt LEFT JOIN comp_cast_type cct ON rt.id = cct.id LEFT JOIN company_name cn ON cn.name_pcode_nf = 'M5236' OR cn.name_pcode_sf = 'L5612' LEFT JOIN movie_keyword mk ON mk.keyword_id IN (3479, 3152) WHERE cn.id IN (69171, 31595, 57187, 23935, 26659, 14910) AND rt.id IN (6, 5, 1, 7, 2) GROUP BY rt.ROLE ORDER BY number_of_companies DESC, number_of_movies_with_keywords DESC;
SELECT COUNT(DISTINCT ci.person_id) AS total_actors, AVG(ci.nr_order) AS average_cast_position, SUM(CASE WHEN lt.link LIKE '%producer%' THEN 1 ELSE 0 END) AS total_producers_linked, COUNT(DISTINCT mk.keyword_id) AS total_unique_keywords, COUNT(DISTINCT mc.company_id) AS total_companies_involved FROM cast_info ci JOIN movie_companies mc ON ci.movie_id = mc.movie_id JOIN movie_keyword mk ON ci.movie_id = mk.movie_id JOIN link_type lt ON mc.company_type_id = lt.id WHERE ci.person_role_id IS NOT NULL AND mc.note IS NULL AND ci.movie_id IN (SELECT movie_id FROM movie_companies WHERE id = '3813') GROUP BY ci.movie_id;
SELECT rt.ROLE AS role_type, AVG(name.imdb_id) AS average_imdb_id, SUM(case when name.gender = 'M' then 1 else 0 end) AS number_of_male_actors, SUM(case when name.gender = 'F' then 1 else 0 end) AS number_of_female_actors, COUNT(DISTINCT ci.movie_id) AS number_of_movies, MAX(title.production_year) AS latest_movie_year, MIN(title.production_year) AS earliest_movie_year, AVG(title.production_year) AS average_movie_year FROM cast_info ci JOIN name ON ci.person_id = name.id JOIN role_type rt ON ci.role_id = rt.id JOIN title ON ci.movie_id = title.id WHERE ci.person_role_id IN (541, 657, 1059) AND name.name_pcode_cf IN ('A4545', 'A4135', 'A242') AND name.surname_pcode IN ('A42', 'A456', 'A432', 'A426', 'A461') GROUP BY rt.ROLE ORDER BY number_of_movies DESC;
SELECT ct.kind as company_type, avg(at.production_year) as average_production_year, count(distinct at.id) as total_movies, count(distinct ml.movie_id) as total_linked_movies, sum(CASE WHEN at.kind_id = 3 THEN 1 ELSE 0 END) as total_kind_id_3, sum(CASE WHEN at.kind_id = 4 THEN 1 ELSE 0 END) as total_kind_id_4 FROM aka_title at JOIN movie_link ml ON at.movie_id = ml.movie_id JOIN company_type ct ON ml.link_type_id = ct.id WHERE at.kind_id IN (3, 4) AND ml.linked_movie_id IN (766538, 436, 2392833, 1659295, 2490166) AND at.production_year > 2000 GROUP BY ct.kind;
SELECT rt.ROLE AS Role, COUNT(distinct ci.person_id) AS Number_Of_Actors, AVG(ci.nr_order) AS Average_Billing_Position, SUM(CASE WHEN n.gender = 'M' THEN 1 ELSE 0 END) AS Male_Actors, SUM(CASE WHEN n.gender = 'F' THEN 1 ELSE 0 END) AS Female_Actors, MIN(aka.production_year) AS Earliest_Film_Year, MAX(aka.production_year) AS Latest_Film_Year, COUNT(distinct mk.movie_id) AS Number_Of_Movies_With_Keywords, AVG(pi.info_type_id::integer) AS Average_Info_Type_Id FROM cast_info ci JOIN name n ON ci.person_id = n.id JOIN role_type rt ON ci.role_id = rt.id LEFT JOIN aka_title aka ON ci.movie_id = aka.movie_id LEFT JOIN movie_keyword mk ON ci.movie_id = mk.movie_id LEFT JOIN person_info pi ON n.id = pi.person_id WHERE (aka.title = 'Abduction - Riprenditi la tua vita' OR aka.title = 'Mala wielka milosc' OR aka.title = 'Great Performances: On the Town in Concert' OR aka.title = 'æÁÂÒÉËÉ Ú×ÅÚÄ. ÷ÏÚ×ÒÁÝÅÎÉÅ' OR aka.title = 'Zavoevanie ameriki') AND pi.info_type_id IN ('37', '20', '28', '32', '25') AND ci.nr_order = 93 GROUP BY rt.ROLE;
SELECT COUNT(DISTINCT ml.movie_id) AS num_movies, COUNT(DISTINCT ml.linked_movie_id) AS num_linked_movies, AVG(sub.num_keywords) AS avg_keywords_per_movie, SUM(CASE WHEN pi.info_type_id = '34' THEN 1 ELSE 0 END) AS count_info_type_34, SUM(CASE WHEN pi.info_type_id = '25' THEN 1 ELSE 0 END) AS count_info_type_25 FROM movie_link AS ml JOIN (SELECT mk.movie_id, COUNT(mk.keyword_id) AS num_keywords FROM movie_keyword AS mk GROUP BY mk.movie_id) AS sub ON ml.movie_id = sub.movie_id LEFT JOIN person_info AS pi ON ml.movie_id = pi.person_id GROUP BY ml.link_type_id;
SELECT it.info AS info_category, COUNT(DISTINCT mk.movie_id) AS number_of_movies, COUNT(mk.keyword_id) AS total_keyword_mentions, AVG(sub_query.avg_keyword_per_movie) AS average_keywords_per_movie FROM movie_keyword AS mk INNER JOIN keyword AS k ON mk.keyword_id = k.id INNER JOIN info_type AS it ON it.id = ANY(ARRAY[107, 103, 84, 8, 113]) LEFT JOIN (SELECT movie_id, AVG(keyword_count) AS avg_keyword_per_movie FROM (SELECT mk.movie_id, COUNT(mk.keyword_id) AS keyword_count FROM movie_keyword AS mk GROUP BY mk.movie_id) AS sub_query_1 GROUP BY movie_id) AS sub_query ON mk.movie_id = sub_query.movie_id WHERE mk.id IN (1632, 3030, 4546, 1918, 3771, 1414) AND mk.movie_id IN (15503, 12271, 9141) GROUP BY it.info;
SELECT rt.role AS role_type, COUNT(DISTINCT pi.person_id) AS number_of_people, AVG(CASE WHEN pi.info LIKE '%cm' THEN CAST(SUBSTRING(pi.info FROM '^[0-9]+') AS INTEGER) END) AS average_height, COUNT(DISTINCT cn.id) AS number_of_companies, cn.country_code, SUM(CASE WHEN pi.info LIKE '%Bad Faith%' THEN 1 ELSE 0 END) AS bad_faith_count FROM person_info pi JOIN role_type rt ON rt.id = pi.info_type_id JOIN name n ON n.id = pi.person_id JOIN company_name cn ON cn.imdb_id = n.imdb_id WHERE rt.role IN ('writer', 'producer', 'actor') AND cn.country_code IN ('US', 'GB', 'CA') GROUP BY rt.role, cn.country_code ORDER BY role_type, cn.country_code;
SELECT kt.kind as movie_kind, AVG(akat.production_year) as average_production_year, COUNT(DISTINCT akat.movie_id) as number_of_movies, SUM(CASE WHEN akat.episode_of_id IS NOT NULL THEN 1 ELSE 0 END) as number_of_episodes, COUNT(DISTINCT cn.id) as number_of_characters, COUNT(DISTINCT cct.id) as number_of_cast_types FROM aka_title akat JOIN kind_type kt ON akat.kind_id = kt.id JOIN char_name cn ON akat.movie_id = cn.imdb_id JOIN comp_cast_type cct ON akat.id = cct.id WHERE kt.kind = 'movie' AND akat.production_year BETWEEN 2000 AND 2010 AND akat.season_nr IN (6, 27, 1) AND akat.episode_of_id IN (23513, 23963, 12924, 12200, 8336) GROUP BY kt.kind;
SELECT lt.LINK AS link_type, COUNT(ml.id) AS total_movie_links, AVG(pi.person_id) AS average_person_id, SUM(cc.status_id) AS sum_status_id FROM movie_link AS ml JOIN link_type AS lt ON ml.link_type_id = lt.id JOIN complete_cast AS cc ON ml.movie_id = cc.movie_id JOIN person_info AS pi ON cc.subject_id = pi.person_id WHERE ml.link_type_id IN (6, 5, 15, 16, 10, 17) AND ml.id IN (3372, 310) AND cc.id = 2124 GROUP BY lt.LINK ORDER BY total_movie_links DESC;
SELECT kt.kind AS movie_kind, AVG(aka.production_year) AS average_production_year, COUNT(DISTINCT aka.movie_id) AS number_of_movies, COUNT(DISTINCT mk.keyword_id) AS number_of_unique_keywords, SUM(CASE WHEN aka.title = 'Sea of Love' THEN 1 ELSE 0 END) AS count_sea_of_love, SUM(CASE WHEN aka.title = 'Anna of Rhodes' THEN 1 ELSE 0 END) AS count_anna_of_rhodes, SUM(CASE WHEN aka.title = 'The Last Days on Earth' THEN 1 ELSE 0 END) AS count_last_days_on_earth, SUM(CASE WHEN aka.title = 'Hammer Session!' THEN 1 ELSE 0 END) AS count_hammer_session, SUM(CASE WHEN aka.title = 'Bank Vault 713' THEN 1 ELSE 0 END) AS count_bank_vault_713 FROM aka_title AS aka JOIN kind_type AS kt ON aka.kind_id = kt.id LEFT JOIN movie_keyword AS mk ON aka.movie_id = mk.movie_id GROUP BY kt.kind ORDER BY average_production_year DESC, number_of_movies DESC;
SELECT pi.person_id, COUNT(DISTINCT k.id) AS keyword_count, AVG(cn.imdb_id) AS avg_imdb_id, COUNT(DISTINCT cn.id) AS unique_char_count FROM person_info pi JOIN info_type it ON pi.info_type_id = it.id JOIN keyword k ON it.id = k.id AND k.phonetic_code IN ('S5312', 'M3243', 'W16', 'C26', 'W3616') JOIN char_name cn ON pi.person_id = cn.id AND cn.name_pcode_nf IN ('R2631', 'N', 'D2362') AND cn.surname_pcode IN ('C64', 'C145', 'W43', 'V5365', 'P6536') GROUP BY pi.person_id ORDER BY keyword_count DESC, unique_char_count DESC;
SELECT lt.LINK AS link_type, COUNT(DISTINCT ml.movie_id) AS number_of_movies, AVG(n.imdb_id) AS average_imdb_id, SUM(CASE WHEN cc.status_id = 4 THEN 1 ELSE 0 END) AS count_status_id_4, SUM(CASE WHEN cc.status_id = 3 THEN 1 ELSE 0 END) AS count_status_id_3, COUNT(DISTINCT pi.person_id) AS distinct_person_count FROM movie_link AS ml JOIN link_type AS lt ON ml.link_type_id = lt.id LEFT JOIN complete_cast AS cc ON ml.movie_id = cc.movie_id LEFT JOIN name AS n ON cc.subject_id = n.id LEFT JOIN person_info AS pi ON n.id = pi.person_id WHERE lt.id IN (6, 15, 11, 5) AND cc.subject_id = 1 AND cc.status_id IN (4,3) AND ml.id IN (2720, 2119, 4076, 1826, 498) AND ml.linked_movie_id IN (260725, 2349487, 1391927) GROUP BY lt.LINK;
SELECT AVG(CAST(mi_idx.info AS INTEGER)) AS average_rating, COUNT(DISTINCT mc.movie_id) AS number_of_movies, COUNT(DISTINCT c.name) AS number_of_companies_involved, SUM(CASE WHEN mc.company_type_id = 1 THEN 1 ELSE 0 END) AS number_of_production_companies, COUNT(DISTINCT cc.movie_id) AS movies_with_complete_cast FROM movie_info_idx mi_idx JOIN movie_companies mc ON mi_idx.movie_id = mc.movie_id JOIN complete_cast cc ON mc.movie_id = cc.movie_id JOIN char_name c ON cc.subject_id = c.id WHERE mi_idx.info_type_id = 101 AND mc.company_type_id = 1 AND mc.movie_id IN ('18480', '19586', '18553', '18572', '20750') AND (cc.movie_id = '1682331' OR cc.movie_id = '1683688') GROUP BY mc.company_type_id;
SELECT AVG(aka.production_year) AS average_production_year, COUNT(DISTINCT ci.movie_id) AS number_of_movies, SUM(mc.company_id) AS total_companies_involved, COUNT(DISTINCT aka.title) AS unique_aka_titles, COUNT(DISTINCT ci.person_id) AS number_of_cast_members, MAX(ml.link_type_id) AS highest_link_type_id FROM aka_title aka JOIN cast_info ci ON aka.movie_id = ci.movie_id JOIN movie_companies mc ON aka.movie_id = mc.movie_id JOIN movie_link ml ON aka.movie_id = ml.movie_id WHERE aka.title IS NOT NULL AND aka.production_year IS NOT NULL AND (aka.title LIKE '0....01124%' OR aka.title LIKE '...0012111%' OR aka.title LIKE '%758%') GROUP BY aka.production_year ORDER BY average_production_year DESC;
SELECT rt.ROLE AS role_type, COUNT(DISTINCT ci.person_id) AS total_actors, AVG(ci.nr_order) AS average_order, SUM(case when pi.info_type_id = 27 then 1 else 0 end) AS num_actors_with_biography, MIN(mi.info) AS earliest_movie_date, MAX(mi.info) AS latest_movie_date, COUNT(DISTINCT mi.movie_id) AS movie_count FROM cast_info ci JOIN role_type rt ON ci.role_id = rt.id LEFT JOIN person_info pi ON ci.person_id = pi.person_id AND pi.info_type_id = 27 JOIN movie_info mi ON ci.movie_id = mi.movie_id WHERE ci.role_id IN (SELECT id FROM role_type WHERE ROLE IN ('actor', 'actress')) AND mi.info_type_id = 3 GROUP BY rt.ROLE ORDER BY total_actors DESC, average_order;
SELECT AVG(cast_info.nr_order) as average_nr_order, COUNT(DISTINCT cast_info.movie_id) as total_movies, COUNT(DISTINCT person_info.person_id) as total_people_involved, SUM(case when movie_companies.company_id IN (1253, 1225, 1085, 846, 859) then 1 else 0 end) as total_movies_by_selected_companies FROM cast_info JOIN movie_companies ON cast_info.movie_id = movie_companies.movie_id JOIN person_info ON cast_info.person_id = person_info.person_id WHERE cast_info.person_role_id = 181 AND person_info.info LIKE '%(19[789][0-9])%' GROUP BY cast_info.person_role_id;
SELECT cn.name AS company_name, COUNT(DISTINCT mc.movie_id) AS number_of_movies, AVG(CAST(mk.keyword_id AS NUMERIC)) AS average_keyword_id, SUM(CASE WHEN cc.status_id = 3 THEN 1 ELSE 0 END) AS completed_movie_count FROM movie_companies mc JOIN company_name cn ON mc.company_id = cn.id LEFT JOIN movie_keyword mk ON mc.movie_id = mk.movie_id LEFT JOIN complete_cast cc ON mc.movie_id = cc.movie_id WHERE mc.company_type_id = 1 AND cn.country_code IS NOT NULL GROUP BY cn.name ORDER BY number_of_movies DESC, completed_movie_count DESC LIMIT 10;
