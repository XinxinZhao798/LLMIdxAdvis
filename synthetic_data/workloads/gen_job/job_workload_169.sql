SELECT rt.ROLE, COUNT(DISTINCT ml.movie_id) AS num_movies, AVG(CAST(mi_idx.info AS NUMERIC)) AS average_rating, COUNT(DISTINCT cn.id) AS num_companies_involved, STRING_AGG(DISTINCT it.info, ', ') AS related_info_types FROM role_type rt JOIN movie_link ml ON ml.link_type_id = rt.id AND ml.linked_movie_id IN (792877, 2127586) JOIN company_name cn ON cn.country_code LIKE '%[us]%' JOIN info_type it ON it.id IN (98, 17, 71, 5) AND it.info LIKE '%rating%' LEFT JOIN movie_info_idx mi_idx ON mi_idx.movie_id = ml.movie_id AND mi_idx.info_type_id = it.id WHERE rt.id IN (6, 7) AND rt.ROLE IN ('actor', 'cinematographer', 'producer') GROUP BY rt.ROLE ORDER BY num_movies DESC, average_rating DESC;
SELECT AVG(a.production_year) AS average_production_year, COUNT(DISTINCT c.movie_id) AS number_of_movies, rt.ROLE, MAX(p.info) AS latest_person_info, COUNT(DISTINCT cn.id) AS number_of_people_with_role FROM aka_title AS a JOIN movie_companies AS c ON a.movie_id = c.movie_id JOIN role_type AS rt ON rt.ROLE IN ('writer', 'miscellaneous crew', 'production designer', 'actress') JOIN person_info AS p ON p.info_type_id = rt.id JOIN char_name AS cn ON cn.name_pcode_nf IN ('N6361', 'F6326', 'W6356') WHERE a.note IN ('(UK) (reissue title)', '(Hong Kong: English title) (video title)', '(West Germany) (Berlin film festival title)') AND c.company_id IN ('1064', '133') AND c.company_type_id = '1' AND a.production_year >= 2000 GROUP BY rt.ROLE ORDER BY number_of_movies DESC, average_production_year DESC;
SELECT ct.kind AS company_type, AVG(at.production_year) AS avg_production_year, COUNT(DISTINCT ci.movie_id) AS num_movies_casted, SUM(CASE WHEN at.season_nr IS NOT NULL THEN 1 ELSE 0 END) AS total_seasons, COUNT(DISTINCT k.id) AS unique_keywords FROM movie_companies AS mc JOIN company_type AS ct ON mc.company_type_id = ct.id JOIN aka_title AS at ON mc.movie_id = at.movie_id JOIN cast_info AS ci ON ci.movie_id = mc.movie_id LEFT JOIN keyword AS k ON k.id = at.movie_id WHERE mc.note LIKE '%(20%)%' AND ci.nr_order IN (44, 146, 15, 7, 47) AND ci.role_id = 1 AND at.movie_id IN (879100, 610270, 1241825, 1678396, 1699805, 549252) GROUP BY ct.kind;
SELECT COUNT(DISTINCT mc.movie_id) AS number_of_movies, AVG(CAST(mi_idx.info AS NUMERIC)) AS average_rating, COUNT(DISTINCT ml.linked_movie_id) AS linked_movies_count, SUM(CASE WHEN n.gender = 'F' THEN 1 ELSE 0 END) AS female_participants_count, SUM(CASE WHEN n.gender = 'M' THEN 1 ELSE 0 END) AS male_participants_count, MAX(t.production_year) AS latest_movie_year, MIN(t.production_year) AS oldest_movie_year FROM movie_companies AS mc JOIN title AS t ON mc.movie_id = t.id JOIN movie_info_idx AS mi_idx ON t.id = mi_idx.movie_id AND mi_idx.info_type_id = 101 LEFT JOIN movie_link AS ml ON t.id = ml.movie_id LEFT JOIN name AS n ON t.id = n.id WHERE mc.company_type_id = 1 GROUP BY mc.company_id ORDER BY number_of_movies DESC, average_rating DESC;
SELECT COUNT(*) AS total_movies, AVG(aka_title.production_year) AS average_production_year, SUM(CASE WHEN comp_cast_type.kind = 'complete' THEN 1 ELSE 0 END) AS total_complete_cast_movies, SUM(CASE WHEN comp_cast_type.kind = 'complete+verified' THEN 1 ELSE 0 END) AS total_verified_cast_movies, COUNT(DISTINCT char_name.name) AS distinct_character_names, COUNT(DISTINCT keyword.id) AS total_keywords, MAX(movie_companies.company_type_id) AS max_company_type_id FROM aka_title JOIN movie_keyword ON aka_title.movie_id = movie_keyword.movie_id JOIN keyword ON movie_keyword.keyword_id = keyword.id JOIN movie_companies ON aka_title.movie_id = movie_companies.movie_id JOIN comp_cast_type ON movie_companies.company_type_id = comp_cast_type.id JOIN char_name ON char_name.name = aka_title.note WHERE aka_title.production_year BETWEEN 1990 AND 2000 AND movie_companies.company_type_id = 1 AND aka_title.kind_id = 1 AND (char_name.name IN ('Vereshchagin', 'Old Man on Street', 'Hadhod', 'Uncle Carl Ã…kerblom') OR movie_keyword.movie_id IN ('15386', '18793')) GROUP BY aka_title.kind_id ORDER BY total_movies DESC;
SELECT CN.name AS company_name, COUNT(DISTINCT AN.id) AS total_aliases, AVG(AT.production_year) AS average_production_year, SUM(CASE WHEN N.gender = 'M' THEN 1 ELSE 0 END) AS male_actors_count, SUM(CASE WHEN N.gender = 'F' THEN 1 ELSE 0 END) AS female_actors_count FROM company_name CN JOIN aka_title AT ON CN.id = AT.movie_id JOIN aka_name AN ON AN.person_id = AT.movie_id JOIN name N ON N.id = AN.person_id WHERE CN.country_code = 'US' AND AT.production_year >= 2000 AND N.gender IN ('M', 'F') GROUP BY CN.name;
SELECT cn.name AS company_name, COUNT(DISTINCT mk.movie_id) AS number_of_movies_with_keywords, COUNT(DISTINCT ml.movie_id) AS number_of_linked_movies, COUNT(DISTINCT ml.linked_movie_id) AS number_of_movies_linked_to, AVG(cn.imdb_id) AS average_imdb_id FROM company_name cn LEFT JOIN movie_companies mc ON cn.id = mc.company_id LEFT JOIN movie_keyword mk ON mc.movie_id = mk.movie_id LEFT JOIN movie_link ml ON mc.movie_id = ml.movie_id OR mc.movie_id = ml.linked_movie_id WHERE cn.country_code NOT IN ('[pl]') AND cn.name_pcode_sf IN ('V6251', 'D1253', 'A4562', 'D5351', 'T5626') AND (ml.link_type_id IN (5, 3, 13) OR ml.link_type_id IS NULL) GROUP BY cn.name ORDER BY number_of_movies_with_keywords DESC, number_of_linked_movies DESC, number_of_movies_linked_to DESC, average_imdb_id DESC LIMIT 10;
SELECT COUNT(DISTINCT t.id) AS total_movies, AVG(t.production_year) AS average_production_year, SUM(CASE WHEN mk.movie_id IN ('18308', '18764', '15408', '17206', '12185') THEN 1 ELSE 0 END) AS count_specific_movies, COUNT(DISTINCT cn.surname_pcode) AS unique_character_surnames, MIN(t.title) AS earliest_alphabetical_movie_title FROM title AS t JOIN movie_keyword AS mk ON mk.movie_id = t.id JOIN char_name AS cn ON cn.id = mk.movie_id JOIN name AS n ON n.surname_pcode = cn.surname_pcode WHERE t.series_years = '1990-1991' OR t.phonetic_code IN ('P6523', 'D162', 'R5265', 'D2453', 'F6145') AND cn.surname_pcode IN ('L3414', 'O4353', 'W16', 'I5236') GROUP BY t.kind_id HAVING COUNT(DISTINCT t.id) > 10 ORDER BY total_movies DESC, average_production_year ASC;
