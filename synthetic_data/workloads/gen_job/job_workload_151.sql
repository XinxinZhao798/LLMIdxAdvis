SELECT ct.kind AS company_type, COUNT(DISTINCT cn.id) AS number_of_companies, COUNT(DISTINCT t.id) AS number_of_movies, AVG(t.production_year) AS average_production_year, SUM(CASE WHEN cn.country_code = '[us]' THEN 1 ELSE 0 END) AS us_based_companies, COUNT(DISTINCT mk.keyword_id) AS distinct_keywords_used, COUNT(DISTINCT ml.linked_movie_id) AS distinct_linked_movies FROM company_type AS ct JOIN movie_companies AS mc ON ct.id = mc.company_type_id JOIN company_name AS cn ON mc.company_id = cn.id JOIN title AS t ON mc.movie_id = t.id LEFT JOIN movie_keyword AS mk ON t.id = mk.movie_id LEFT JOIN movie_link AS ml ON t.id = ml.movie_id WHERE ct.id IN (3, 4) AND cn.country_code IN ('[mk]', '[ua]', '[kr]', '[ir]', '[ph]') GROUP BY ct.kind ORDER BY number_of_movies DESC;
SELECT t.production_year, COUNT(DISTINCT t.id) AS number_of_movies, COUNT(DISTINCT ci.person_id) AS number_of_actors, AVG(ci.nr_order) AS average_cast_order, SUM(CASE WHEN lt.link = 'follows' THEN 1 ELSE 0 END) AS number_of_sequels, SUM(CASE WHEN lt.link = 'spoofed in' THEN 1 ELSE 0 END) AS number_of_spoofs FROM title t JOIN cast_info ci ON t.id = ci.movie_id JOIN movie_keyword mk ON t.id = mk.movie_id JOIN keyword k ON mk.keyword_id = k.id LEFT JOIN movie_companies mc ON t.id = mc.movie_id LEFT JOIN link_type lt ON lt.id = mc.company_type_id WHERE t.production_year BETWEEN 2000 AND 2010 AND k.phonetic_code IN ('U6523', 'W46', 'S3123', 'L3416', 'A3435', 'P4252') AND ci.role_id = 1 GROUP BY t.production_year ORDER BY t.production_year;
SELECT kt.kind, lt.link, COUNT(DISTINCT mi.movie_id) AS num_movies, AVG(n.imdb_id) AS avg_imdb_id, SUM(CASE WHEN mi.info = 'French' THEN 1 ELSE 0 END) AS num_french_movies, SUM(CASE WHEN mi.note = '(none)' THEN 1 ELSE 0 END) AS num_movies_without_notes, COUNT(DISTINCT c.name) FILTER (WHERE c.surname_pcode = 'M6456') AS count_characters_with_surname_pcode_M6456 FROM movie_info mi JOIN kind_type kt ON mi.movie_id = kt.id JOIN link_type lt ON lt.id = mi.info_type_id LEFT JOIN movie_info_idx mii ON mii.movie_id = mi.movie_id AND mii.info_type_id = mi.info_type_id LEFT JOIN char_name c ON c.id = mii.info_type_id LEFT JOIN name n ON n.id = c.id WHERE lt.id IN ('4', '6', '9', '1', '14') AND mi.info IN ('Albanian', 'Catalan', 'French', 'Danish') GROUP BY kt.kind, lt.link ORDER BY num_movies DESC, avg_imdb_id;
SELECT c.name AS company_name, COUNT(DISTINCT t.id) AS number_of_movies, AVG(t.production_year) AS average_production_year, COUNT(DISTINCT k.keyword_id) AS distinct_keywords, COUNT(DISTINCT ml.linked_movie_id) AS linked_movies_count, COUNT(DISTINCT n.id) AS number_of_cast_members, SUM(CASE WHEN t.kind_id = 1 THEN 1 ELSE 0 END) AS number_of_feature_films, SUM(CASE WHEN t.kind_id = 2 THEN 1 ELSE 0 END) AS number_of_tv_shows, SUM(CASE WHEN t.kind_id = 3 THEN 1 ELSE 0 END) AS number_of_video_games FROM company_name c LEFT JOIN movie_keyword mk ON mk.movie_id = c.imdb_id LEFT JOIN movie_link ml ON ml.movie_id = c.imdb_id LEFT JOIN complete_cast cc ON cc.movie_id = c.imdb_id LEFT JOIN title t ON t.id = c.imdb_id LEFT JOIN name n ON n.imdb_id = c.imdb_id LEFT JOIN movie_keyword k ON k.movie_id = t.id WHERE c.name IN ('Crown International Pictures', 'Hisa-Film-Vertrieb GmbH', 'Quality Special Products', 'Hem Films', 'H & H Warranted Productions') GROUP BY c.name ORDER BY number_of_movies DESC;
SELECT AVG(mc.company_id) AS average_company_id, COUNT(DISTINCT ml.movie_id) AS linked_movies_count, SUM(CASE WHEN mi.info = 'Tatar' THEN 1 ELSE 0 END) AS tatar_movies_count, SUM(CASE WHEN mi.info = 'Hebrew' THEN 1 ELSE 0 END) AS hebrew_movies_count, SUM(CASE WHEN mi.info = 'Inuktitut' THEN 1 ELSE 0 END) AS inuktitut_movies_count, COUNT(DISTINCT an.person_id) AS unique_actors_count FROM movie_companies AS mc JOIN movie_link AS ml ON mc.movie_id = ml.movie_id JOIN movie_info AS mi ON mc.movie_id = mi.movie_id LEFT JOIN aka_name AS an ON an.surname_pcode = mi.info WHERE an.name_pcode_cf IN ('V3415', 'A5163', 'B6525') AND mi.info IN ('Tatar', 'Hebrew', 'Inuktitut') GROUP BY mc.company_type_id;
SELECT AVG(aka_title.production_year) AS avg_production_year, COUNT(DISTINCT movie_keyword.keyword_id) AS num_keywords, COUNT(DISTINCT aka_title.movie_id) AS num_movies, AVG(COUNT(DISTINCT aka_title.movie_id)) OVER (PARTITION BY aka_title.production_year) AS avg_num_movies_per_year FROM aka_title JOIN complete_cast ON aka_title.movie_id = complete_cast.movie_id JOIN movie_keyword ON aka_title.movie_id = movie_keyword.movie_id WHERE complete_cast.status_id = 1 GROUP BY aka_title.production_year;
SELECT cn.country_code, k.keyword, COUNT(DISTINCT mc.movie_id) AS num_movies, AVG(CAST(NULLIF(REGEXP_REPLACE(mi_duration.info, '[^\d.]', '', 'g'), '') AS NUMERIC)) AS average_movie_duration, SUM(CASE WHEN mi_release.info_type_id = 4 THEN 1 ELSE 0 END) AS count_movie_releases FROM company_name AS cn JOIN movie_companies AS mc ON cn.id = mc.company_id JOIN movie_keyword AS mk ON mc.movie_id = mk.movie_id JOIN keyword AS k ON mk.keyword_id = k.id LEFT JOIN movie_info AS mi_release ON mc.movie_id = mi_release.movie_id AND mi_release.info_type_id = 4 LEFT JOIN movie_info AS mi_duration ON mc.movie_id = mi_duration.movie_id AND mi_duration.info_type_id = 3 WHERE k.keyword IN ('dead-mother', 'manipulation') AND mi_release.note IN ('(some dialogue)', '(none)', '(only a few lines)', '(a few lines)', '(a few words)') GROUP BY cn.country_code, k.keyword ORDER BY cn.country_code, k.keyword;
SELECT kt.kind AS kind_of_production, COUNT(DISTINCT mk.movie_id) AS number_of_movies, COUNT(DISTINCT mk.keyword_id) AS number_of_unique_keywords, AVG(sub.movie_keyword_count) AS average_keywords_per_movie, COUNT(DISTINCT an.person_id) AS number_of_distinct_persons FROM kind_type kt JOIN movie_keyword mk ON mk.id = ANY(ARRAY[3853, 448, 3514, 4583, 3985]) JOIN (SELECT movie_id, COUNT(keyword_id) AS movie_keyword_count FROM movie_keyword GROUP BY movie_id) AS sub ON sub.movie_id = mk.movie_id LEFT JOIN aka_name an ON an.id = mk.movie_id AND an.name IS NOT NULL WHERE kt.kind IN ('video game', 'tv series', 'tv mini series', 'episode', 'video movie') GROUP BY kt.kind ORDER BY number_of_movies DESC;
SELECT kind_id, COUNT(id) AS total_titles, AVG(production_year) AS average_production_year FROM title GROUP BY kind_id ORDER BY total_titles DESC;
SELECT rt.ROLE AS role_type, COUNT(DISTINCT ci.person_id) AS total_actors, AVG(ci.nr_order) AS average_order, SUM(case when pi.info_type_id = 27 then 1 else 0 end) AS num_actors_with_biography, MIN(mi.info) AS earliest_movie_date, MAX(mi.info) AS latest_movie_date, COUNT(DISTINCT mi.movie_id) AS movie_count FROM cast_info ci JOIN role_type rt ON ci.role_id = rt.id LEFT JOIN person_info pi ON ci.person_id = pi.person_id AND pi.info_type_id = 27 JOIN movie_info mi ON ci.movie_id = mi.movie_id WHERE ci.role_id IN (SELECT id FROM role_type WHERE ROLE IN ('actor', 'actress')) AND mi.info_type_id = 3 GROUP BY rt.ROLE ORDER BY total_actors DESC, average_order;
SELECT AVG(mi_idx.info::numeric) AS average_rating, COUNT(DISTINCT k.id) AS total_unique_keywords, COUNT(DISTINCT n.id) AS total_unique_writers, SUM(CASE WHEN cn.surname_pcode = 'M1236' THEN 1 ELSE 0 END) AS count_of_m1236_surname_writers FROM keyword AS k LEFT JOIN movie_keyword AS mk ON k.id = mk.keyword_id LEFT JOIN movie_info_idx AS mi_idx ON mk.movie_id = mi_idx.movie_id AND mi_idx.info_type_id = 101 LEFT JOIN cast_info AS ci ON mk.movie_id = ci.movie_id LEFT JOIN char_name AS cn ON ci.person_id = cn.id AND ci.role_id = 2 LEFT JOIN name AS n ON ci.person_id = n.id AND n.gender = 'm' WHERE k.keyword IN ('airforce-one', 'mexican-revolutionary', 'full-house', 'gay-hollywood', 'overactive-imagination') AND cn.surname_pcode IN ('M1236', 'H3245', 'Z12', 'F236') AND ci.role_id IN (SELECT id FROM comp_cast_type WHERE kind = 'writer') GROUP BY ci.movie_id;
SELECT ct.kind AS company_kind, COUNT(DISTINCT mc.movie_id) AS number_of_movies, AVG(CAST(mi_idx.info AS NUMERIC)) AS average_rating, SUM(CASE WHEN n.gender = 'F' THEN 1 ELSE 0 END) AS female_cast_count, SUM(CASE WHEN n.gender = 'M' THEN 1 ELSE 0 END) AS male_cast_count FROM company_type ct JOIN movie_companies mc ON ct.id = mc.company_type_id JOIN movie_info_idx mi_idx ON mc.movie_id = mi_idx.movie_id AND mi_idx.info_type_id = ( SELECT id FROM comp_cast_type WHERE kind = 'rating' ) JOIN name n ON mc.movie_id = n.id WHERE ct.kind IN ('special effects companies', 'miscellaneous companies', 'distributors') AND mc.movie_id IN ('19654', '24487', '18671', '31117', '18944') AND mc.company_id IN ('209', '936', '1140') AND n.name_pcode_cf IN ('A6232', 'A5163') GROUP BY ct.kind ORDER BY number_of_movies DESC, average_rating DESC;
SELECT AVG(CAST(mi_idx.info AS numeric)) AS average_rating, COUNT(DISTINCT t.id) AS total_movies, COUNT(DISTINCT mc.company_id) AS total_companies_involved, SUM(CASE WHEN t.production_year > 2000 THEN 1 ELSE 0 END) AS movies_after_2000 FROM title AS t JOIN movie_info_idx AS mi_idx ON t.id = mi_idx.movie_id JOIN movie_companies AS mc ON t.id = mc.movie_id JOIN company_name AS cn ON mc.company_id = cn.id JOIN company_type AS ct ON mc.company_type_id = ct.id JOIN info_type AS it ON mi_idx.info_type_id = it.id WHERE it.info = 'rating' AND cn.country_code IS NOT NULL AND ct.kind <> 'production companies' AND t.kind_id NOT IN (SELECT id FROM comp_cast_type WHERE kind = 'tv series') GROUP BY cn.country_code, ct.kind ORDER BY average_rating DESC, total_movies DESC;
SELECT mi.info AS Movie_Language, rt.ROLE AS Role_Type, COUNT(DISTINCT ci.person_id) AS Total_People, AVG(ci.nr_order) AS Average_Cast_Order FROM movie_info mi JOIN cast_info ci ON mi.movie_id = ci.movie_id JOIN role_type rt ON ci.role_id = rt.id WHERE mi.info IN ('Bosnian', 'Serbian', 'Finnish', 'Greek') GROUP BY mi.info, rt.ROLE ORDER BY Movie_Language, Total_People DESC;
SELECT kt.kind, AVG(CAST(mi_idx.info AS INTEGER)) AS average_rating, SUM(CASE WHEN mi_idx.info_type_id = 3 THEN 1 ELSE 0 END) AS total_votes, COUNT(DISTINCT mc.movie_id) AS number_of_movies, COUNT(DISTINCT p.id) AS number_of_people_involved FROM title t JOIN kind_type kt ON t.kind_id = kt.id JOIN movie_info_idx mi_idx ON t.id = mi_idx.movie_id JOIN movie_companies mc ON t.id = mc.movie_id JOIN person_info p ON p.info_type_id = mi_idx.info_type_id WHERE kt.kind = 'movie' AND t.production_year BETWEEN 2000 AND 2010 AND mi_idx.info_type_id IN (1, 3) GROUP BY kt.kind HAVING COUNT(DISTINCT mc.movie_id) > 5 ORDER BY average_rating DESC;
SELECT it.info AS genre, COUNT(DISTINCT mi.movie_id) AS total_movies, AVG(mi.info::numeric) AS average_budget, SUM(CASE WHEN n.gender = 'M' THEN 1 ELSE 0 END) AS male_actors, SUM(CASE WHEN n.gender = 'F' THEN 1 ELSE 0 END) AS female_actors, COUNT(DISTINCT ml.linked_movie_id) AS linked_movies, COUNT(DISTINCT mk.keyword_id) AS unique_keywords FROM movie_info mi JOIN info_type it ON mi.info_type_id = it.id AND it.info = 'budget' JOIN movie_keyword mk ON mi.movie_id = mk.movie_id JOIN movie_link ml ON ml.movie_id = mi.movie_id JOIN person_info pi ON pi.person_id = mi.movie_id JOIN name n ON pi.person_id = n.id WHERE mi.movie_id IN ('19606', '114', '12283', '8086') GROUP BY it.info;
SELECT kt.kind AS movie_kind, COUNT(DISTINCT at.movie_id) AS total_movies, AVG(at.production_year) AS average_production_year, SUM(CASE WHEN at.note LIKE '%(working title)%' THEN 1 ELSE 0 END) AS total_working_titles, COUNT(DISTINCT mi_idx.movie_id) AS total_movies_with_additional_info, MAX(at.season_nr) AS max_season_number, MIN(at.episode_nr) AS min_episode_number FROM aka_title at JOIN kind_type kt ON at.kind_id = kt.id LEFT JOIN movie_info_idx mi_idx ON at.movie_id = mi_idx.movie_id WHERE kt.kind IN ('tv series', 'movie', 'tv mini series', 'video game', 'episode') AND at.production_year IS NOT NULL GROUP BY kt.kind ORDER BY total_movies DESC;
SELECT kt.kind, COUNT(DISTINCT cc.movie_id) AS total_movies_with_complete_cast, AVG(mc.company_id) AS average_company_id, SUM(ml.linked_movie_id) AS total_linked_movie_ids FROM complete_cast cc JOIN kind_type kt ON cc.subject_id = kt.id JOIN movie_companies mc ON cc.movie_id = mc.movie_id JOIN movie_link ml ON cc.movie_id = ml.movie_id WHERE cc.status_id IN (1, 2) AND kt.id IN (1, 2, 5, 3) AND mc.id IN (2678, 1671, 621, 430) AND ml.movie_id IN (20571, 5979, 11130) GROUP BY kt.kind;
