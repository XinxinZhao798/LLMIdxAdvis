SELECT kt.kind, t.production_year AS production_year, COUNT(DISTINCT t.id) AS number_of_titles, AVG(CAST(mi_idx.info AS FLOAT)) FILTER (WHERE mi_idx.info_type_id = 101) AS average_rating, COUNT(cc.id) AS complete_cast_count FROM title AS t LEFT JOIN kind_type AS kt ON t.kind_id = kt.id LEFT JOIN movie_info_idx AS mi_idx ON t.id = mi_idx.movie_id LEFT JOIN complete_cast AS cc ON t.id = cc.movie_id WHERE t.kind_id IN (2, 7) GROUP BY kt.kind, production_year ORDER BY kt.kind, production_year DESC;
SELECT a.title AS alternate_title, m.title AS original_title, COUNT(DISTINCT n.id) AS number_of_actors, AVG(CAST(mi.info AS numeric)) AS average_rating, SUM(CASE WHEN n.gender = 'M' THEN 1 ELSE 0 END) AS male_actors, SUM(CASE WHEN n.gender = 'F' THEN 1 ELSE 0 END) AS female_actors FROM aka_title AS a JOIN movie_info AS mi ON a.movie_id = mi.movie_id JOIN title AS m ON a.movie_id = m.id JOIN cast_info AS ci ON m.id = ci.movie_id JOIN name AS n ON ci.person_id = n.id WHERE mi.info_type_id = (SELECT id FROM info_type WHERE info = 'rating') AND a.kind_id = (SELECT id FROM kind_type WHERE kind = 'movie') AND m.production_year BETWEEN 2000 AND 2010 AND n.name IN ('Ando, Tadao', 'Amey, Ian') GROUP BY a.title, m.title ORDER BY average_rating DESC;
SELECT ct.kind AS company_type, AVG(t.production_year) AS average_production_year, COUNT(DISTINCT t.id) AS number_of_titles, SUM(CASE WHEN cn.country_code = '[us]' THEN 1 ELSE 0 END) AS number_of_us_companies, MAX(pi.info) AS latest_info_entry FROM title AS t JOIN company_name AS cn ON t.id = cn.imdb_id JOIN company_type AS ct ON cn.id = ct.id LEFT JOIN person_info AS pi ON pi.info LIKE '%USA%' WHERE t.production_year BETWEEN 1980 AND 1990 AND cn.country_code IN ('[us]', '[ca]') GROUP BY ct.kind ORDER BY number_of_titles DESC;
SELECT kt.kind AS movie_kind, COUNT(DISTINCT mi_idx.movie_id) AS total_movies, AVG(LENGTH(mi_idx.info)) AS average_info_length, SUM(CASE WHEN mi_idx.note IS NOT NULL THEN 1 ELSE 0 END) AS noted_info_count FROM movie_info_idx AS mi_idx JOIN kind_type AS kt ON mi_idx.info_type_id = kt.id GROUP BY kt.kind ORDER BY total_movies DESC;
SELECT ct.kind AS company_kind, COUNT(DISTINCT mk.movie_id) AS number_of_movies, COUNT(DISTINCT pi.person_id) AS number_of_people, AVG(subquery.avg_keywords_per_movie) AS average_keywords_per_movie FROM company_type ct JOIN movie_keyword mk ON mk.keyword_id = ct.id JOIN person_info pi ON pi.info_type_id = mk.id LEFT JOIN (SELECT mk1.movie_id, AVG(mk1.keyword_id) AS avg_keywords_per_movie FROM movie_keyword mk1 GROUP BY mk1.movie_id) AS subquery ON mk.movie_id = subquery.movie_id WHERE ct.kind = 'distributors' AND pi.note IN ('TrendEkiD@aol.com', 'maria afsharian', 'InVerse PR/Infonet', 'sam reden', 'Mattias Thuresson', 'Turkajans') AND pi.info = 'White Lake, Michigan, USA' GROUP BY ct.kind;
SELECT ct.kind AS cast_type, COUNT(DISTINCT t.id) AS number_of_titles, AVG(t.production_year) AS average_production_year, SUM(CASE WHEN t.kind_id = 1 THEN 1 ELSE 0 END) AS number_of_movies, SUM(CASE WHEN t.kind_id = 2 THEN 1 ELSE 0 END) AS number_of_tv_shows, MIN(t.production_year) AS earliest_production_year, MAX(t.production_year) AS latest_production_year FROM title AS t JOIN comp_cast_type AS ct ON t.kind_id = ct.id JOIN aka_name AS an ON an.person_id = t.id JOIN person_info AS pi ON pi.person_id = an.person_id WHERE t.id IN (154689, 143089, 183564, 150330, 103875) AND an.surname_pcode IN ('A163', 'V625', 'S53', 'G12', 'H53') AND ct.id IN (2, 1, 4, 3) GROUP BY ct.kind;
