SELECT COUNT(DISTINCT mk.movie_id) AS number_of_movies_with_keywords, AVG(sub.avg_keywords_per_movie) AS average_keywords_per_movie, SUM(sub.keyword_count) AS total_keywords, COUNT(DISTINCT pi.person_id) AS number_of_people_with_info FROM movie_keyword AS mk JOIN keyword AS k ON mk.keyword_id = k.id JOIN (SELECT mk.movie_id, COUNT(mk.keyword_id) AS keyword_count, AVG(COUNT(mk.keyword_id)) OVER () AS avg_keywords_per_movie FROM movie_keyword AS mk GROUP BY mk.movie_id) AS sub ON mk.movie_id = sub.movie_id LEFT JOIN person_info AS pi ON pi.info = k.keyword WHERE k.phonetic_code IN ('G2532', 'R232');
SELECT c.name AS company_name, COUNT(DISTINCT t.id) AS number_of_movies, AVG(t.production_year) AS average_production_year, SUM(CASE WHEN t.kind_id = 1 THEN 1 ELSE 0 END) AS total_feature_films, SUM(CASE WHEN t.kind_id = 2 THEN 1 ELSE 0 END) AS total_tv_shows, COUNT(DISTINCT mk.keyword_id) AS total_unique_keywords FROM company_name c JOIN movie_keyword mk ON c.id = mk.keyword_id JOIN title t ON mk.movie_id = t.id WHERE c.country_code IN ('US', 'GB') AND t.production_year BETWEEN 1990 AND 2000 GROUP BY c.name HAVING COUNT(DISTINCT t.id) > 10 ORDER BY total_feature_films DESC, total_tv_shows DESC;
SELECT rt.ROLE, COUNT(DISTINCT it.id) AS info_type_count, AVG(lt.id) AS average_link_type_id, COUNT(DISTINCT lt.id) AS link_type_count FROM role_type rt LEFT JOIN info_type it ON rt.id = it.id LEFT JOIN link_type lt ON rt.id = lt.id GROUP BY rt.ROLE ORDER BY info_type_count DESC, average_link_type_id ASC;
SELECT t.production_year, it.info AS genre, COUNT(DISTINCT t.id) AS total_movies, AVG(CAST(mi_idx.info AS FLOAT)) AS average_rating FROM title t JOIN movie_info_idx mi_idx ON t.id = mi_idx.movie_id JOIN movie_keyword mk ON t.id = mk.movie_id JOIN cast_info ci ON t.id = ci.movie_id JOIN info_type it ON mi_idx.info_type_id = it.id WHERE mi_idx.info_type_id = 101 AND it.info IN ('Horror', 'Action', 'Comedy', 'Drama', 'Sci-Fi', 'Thriller') GROUP BY t.production_year, it.info ORDER BY t.production_year ASC, average_rating DESC;
SELECT AVG(t.production_year) AS average_production_year, COUNT(DISTINCT n.id) AS total_actors, COUNT(DISTINCT pi.person_id) AS actors_with_additional_info, SUM(CASE WHEN rt.ROLE = 'Actor' THEN 1 ELSE 0 END) AS total_actor_roles, SUM(CASE WHEN rt.ROLE = 'Director' THEN 1 ELSE 0 END) AS total_director_roles, COUNT(DISTINCT t.id) AS total_titles FROM title t LEFT JOIN complete_cast cc ON t.id = cc.movie_id LEFT JOIN name n ON cc.subject_id = n.id LEFT JOIN role_type rt ON cc.status_id = rt.id LEFT JOIN person_info pi ON n.id = pi.person_id WHERE t.production_year IN ('1998', '1971') GROUP BY t.kind_id ORDER BY average_production_year DESC;
SELECT AVG(t.production_year) AS average_production_year, COUNT(DISTINCT t.id) AS number_of_movies, COUNT(DISTINCT k.id) AS number_of_unique_keywords, SUM(CASE WHEN k.keyword = 'poisoning' THEN 1 ELSE 0 END) AS count_poisoning_keyword, SUM(CASE WHEN k.keyword = 'law-student' THEN 1 ELSE 0 END) AS count_law_student_keyword, MAX(t.title) AS latest_movie_title FROM title AS t JOIN movie_keyword AS mk ON t.id = mk.movie_id JOIN keyword AS k ON mk.keyword_id = k.id JOIN movie_info AS mi ON t.id = mi.movie_id JOIN company_type AS ct ON ct.id = mi.info_type_id WHERE t.production_year BETWEEN 2000 AND 2010 AND ct.kind IN ('production companies', 'distributors') GROUP BY ct.kind ORDER BY average_production_year DESC;
SELECT cn.name AS character_name, COUNT(DISTINCT cl.movie_id) AS total_linked_movies, COUNT(ci.person_id) AS total_roles_played, AVG(ci.nr_order) AS average_role_order FROM char_name AS cn JOIN cast_info AS ci ON cn.id = ci.person_id JOIN movie_link AS cl ON ci.movie_id = cl.movie_id WHERE cn.name IN ('Boy Negro''s Gang', 'Lazoglu', 'Paco Hernández Gil', 'Tedddy Hart', 'Funcionario prisión', 'Make Up Man') GROUP BY cn.name ORDER BY total_linked_movies DESC, total_roles_played DESC;
SELECT t.title AS original_title, COUNT(DISTINCT at.id) AS number_of_alternative_titles, AVG(CAST(mi_idx.info AS INTEGER)) AS average_movie_rating, SUM(CASE WHEN mc.company_type_id = 1 THEN 1 ELSE 0 END) AS number_of_production_companies, SUM(CASE WHEN mc.company_type_id = 2 THEN 1 ELSE 0 END) AS number_of_distribution_companies, COUNT(DISTINCT n.id) AS number_of_unique_actors FROM title t LEFT JOIN aka_title at ON t.id = at.movie_id LEFT JOIN movie_info_idx mi_idx ON t.id = mi_idx.movie_id AND mi_idx.info_type_id = 100 LEFT JOIN movie_companies mc ON t.id = mc.movie_id LEFT JOIN name n ON n.id IN ('7238', '8193', '11843', '6809', '6894', '6651') LEFT JOIN movie_info mi ON t.id = mi.movie_id AND mi.info_type_id = 3 WHERE t.production_year BETWEEN 1990 AND 2000 AND n.id IS NOT NULL AND mi.note IS NOT NULL GROUP BY t.title ORDER BY average_movie_rating DESC LIMIT 10;
SELECT lt.LINK AS link_type, AVG(t.production_year) AS average_production_year, COUNT(DISTINCT mc.company_id) AS number_of_companies, COUNT(DISTINCT ml.movie_id) AS number_of_movies_linked, SUM(CASE WHEN t.kind_id = 1 THEN 1 ELSE 0 END) AS number_of_movies, SUM(CASE WHEN t.kind_id = 2 THEN 1 ELSE 0 END) AS number_of_tv_shows FROM movie_link AS ml INNER JOIN link_type AS lt ON ml.link_type_id = lt.id INNER JOIN title AS t ON ml.movie_id = t.id INNER JOIN movie_companies AS mc ON t.id = mc.movie_id INNER JOIN comp_cast_type AS cct ON mc.company_type_id = cct.id WHERE lt.link IN ('alternate language version of', 'featured in') AND cct.kind IN ('complete+verified', 'cast', 'crew', 'complete') AND mc.id IN ('2868', '289') AND ml.id IN ('5', '751', '4865') AND ml.linked_movie_id IN ('1634429', '905740', '1900325', '1041780', '426055') GROUP BY lt.LINK;
SELECT ct.kind AS company_type, AVG(CAST(mi.info AS NUMERIC)) AS average_rating, COUNT(DISTINCT mk.movie_id) AS movie_count, COUNT(k.id) AS keyword_count, SUM(CASE WHEN it.info = 'LD official retail price' THEN CAST(mi.info AS NUMERIC) ELSE 0 END) AS total_official_retail_price FROM company_type ct JOIN movie_info mi ON ct.id = mi.info_type_id JOIN movie_keyword mk ON mi.movie_id = mk.movie_id JOIN keyword k ON mk.keyword_id = k.id JOIN info_type it ON mi.info_type_id = it.id WHERE mk.keyword_id IN (2506, 2862, 589, 3476, 4237) AND k.phonetic_code IN ('D1653', 'H532', 'M6321', 'H4326', 'F2426', 'A3513') AND it.id IN (15, 16, 18, 76, 39, 111) AND mi.movie_id IN (9091, 13237, 927238) AND (mi.note ILIKE '%(English subtitles)%' OR mi.note ILIKE '%(Original version)%') GROUP BY ct.kind;
SELECT AVG(mi_idx.info::integer) AS average_movie_rating, COUNT(DISTINCT k.id) AS total_unique_keywords, COUNT(DISTINCT cn.id) AS total_companies_involved, COUNT(DISTINCT pi.person_id) AS total_people_with_info, MAX(cn.name) AS largest_company_name FROM keyword AS k, movie_keyword AS mk, movie_info_idx AS mi_idx, company_name AS cn, movie_companies AS mc, person_info AS pi, comp_cast_type AS cct WHERE k.keyword IN ('hang-gliding', 'stubbornness', 'porch-swing', 'cereal', 'identical-twins') AND k.id = mk.keyword_id AND mk.movie_id = mi_idx.movie_id AND mc.movie_id = mi_idx.movie_id AND mc.company_id = cn.id AND pi.info_type_id = cct.id AND cct.kind IN ('complete+verified', 'cast', 'crew', 'complete') GROUP BY cct.kind;
SELECT t.production_year, COUNT(DISTINCT t.id) AS number_of_movies, AVG(CAST(mi.info AS NUMERIC)) AS average_box_office, SUM(CAST(mi.info AS NUMERIC)) AS total_box_office, COUNT(DISTINCT mc.company_id) AS number_of_production_companies FROM title AS t JOIN movie_info AS mi_language ON t.id = mi_language.movie_id AND mi_language.info_type_id = ( SELECT id FROM info_type WHERE info = 'language' ) JOIN movie_info AS mi ON t.id = mi.movie_id AND mi.info_type_id = ( SELECT id FROM info_type WHERE info = 'box office' ) JOIN movie_companies AS mc ON t.id = mc.movie_id WHERE mi_language.info IN ('Slovak', 'Spanish', 'Italian') AND mc.company_type_id = 1 AND t.title IN ('Freaky Friends & Fiction', 'Fait Accompli', '(#1.109)', 'Der Sheriff von Giesing', 'Dont Utter a Note') GROUP BY t.production_year ORDER BY t.production_year DESC;
SELECT AVG(cast_count) AS average_cast_per_movie, AVG(link_count) AS average_links_per_movie, COUNT(DISTINCT mi.info_type_id) AS unique_info_types FROM (SELECT movie_id, COUNT(*) AS cast_count FROM cast_info WHERE note LIKE '%(Band)%' GROUP BY movie_id) AS cast_counts JOIN (SELECT movie_id, COUNT(*) AS link_count FROM movie_link WHERE link_type_id IN (6, 5, 11, 15) GROUP BY movie_id) AS link_counts ON cast_counts.movie_id = link_counts.movie_id JOIN movie_info AS mi ON cast_counts.movie_id = mi.movie_id;
SELECT cn.country_code, COUNT(DISTINCT ci.movie_id) AS number_of_movies, AVG(ci.nr_order) AS average_cast_order, SUM(CASE WHEN mk.id = '4862' THEN 1 ELSE 0 END) AS keyword_4862_count, SUM(CASE WHEN mk.id = '1011' THEN 1 ELSE 0 END) AS keyword_1011_count, COUNT(DISTINCT ml.linked_movie_id) AS number_of_linked_movies FROM cast_info ci JOIN movie_keyword mk ON ci.movie_id = mk.movie_id JOIN company_name cn ON cn.imdb_id = ci.movie_id LEFT JOIN movie_link ml ON ci.movie_id = ml.movie_id WHERE ci.nr_order IN (2, 58, 40) AND ci.movie_id IN ('2013877', '811916', '1817302', '2485261', '163381') AND ml.movie_id IN ('19640', '12262', '11217', '7766', '14578', '16385') GROUP BY cn.country_code;
