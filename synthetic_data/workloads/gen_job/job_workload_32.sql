SELECT kt.kind, AVG(CAST(mi.info AS NUMERIC)) AS average_rating, COUNT(DISTINCT t.id) AS total_movies, COUNT(DISTINCT n.id) AS total_directors, MAX(t.production_year) AS latest_movie_year FROM title AS t JOIN kind_type AS kt ON t.kind_id = kt.id JOIN movie_info AS mi ON t.id = mi.movie_id LEFT JOIN person_info AS pi ON pi.person_id = t.id AND pi.info_type_id = mi.info_type_id JOIN name AS n ON n.id = pi.person_id WHERE mi.info_type_id = 4 AND kt.id IN (4, 5, 1, 6, 3) AND ( mi.note IS NULL OR mi.note IN ('(Original version)', '(none)', '(some dialogue)') ) GROUP BY kt.kind ORDER BY average_rating DESC, total_movies DESC;
SELECT kt.kind AS movie_type, COUNT(DISTINCT mc.movie_id) AS total_movies, COUNT(DISTINCT company_name.id) AS total_companies, AVG(CAST(movie_info_idx.info AS INTEGER)) AS average_movie_votes, SUM(CASE WHEN movie_keyword.keyword_id IN ('3511', '571', '2246', '851') THEN 1 ELSE 0 END) AS relevant_keyword_count FROM movie_companies AS mc JOIN kind_type AS kt ON mc.company_type_id = kt.id JOIN company_name ON mc.company_id = company_name.id JOIN movie_info_idx ON mc.movie_id = movie_info_idx.movie_id AND movie_info_idx.info_type_id = '100' LEFT JOIN movie_keyword ON mc.movie_id = movie_keyword.movie_id WHERE company_name.country_code = 'us' AND company_name.name_pcode_nf IN ('M3261', 'N63', 'W145') AND company_name.md5sum IN ('b38522871a3a9a6ad83d7e5843a8052f', 'c67d47f8ed0acd863dbcb8c2b928208a', 'ae19a96a34d54b7e7ee2c770489cf9fb', '5e5a159eb009ac92bde3144fdf7d7d1a', '3119ec8bdc119971f2e03179a43f5ce4', 'f07a92b898eabd85eba36a20b3df770e') AND kt.kind IN ('tv movie', 'movie', 'tv mini series', 'episode', 'video game') GROUP BY kt.kind;
SELECT kt.kind AS movie_kind, COUNT(DISTINCT ci.movie_id) AS number_of_movies, COUNT(ci.person_id) AS number_of_cast_entries, AVG(ci.nr_order) AS average_cast_order, SUM(CASE WHEN rt.role = 'actor' THEN 1 ELSE 0 END) AS total_actors, SUM(CASE WHEN rt.role = 'actress' THEN 1 ELSE 0 END) AS total_actresses, COUNT(DISTINCT CASE WHEN ct.kind = 'production' THEN ci.movie_id END) AS number_of_production_movies, COUNT(DISTINCT CASE WHEN ct.kind = 'distributor' THEN ci.movie_id END) AS number_of_distributed_movies FROM cast_info ci JOIN role_type rt ON ci.role_id = rt.id JOIN kind_type kt ON ci.person_role_id = kt.id JOIN company_type ct ON ci.person_id = ct.id WHERE kt.kind = 'tv movie' AND ct.id IN (3, 4, 2) GROUP BY kt.kind HAVING COUNT(DISTINCT ci.movie_id) > 0;
SELECT ct.kind AS company_kind, AVG(mc.id) AS average_movie_company_id, COUNT(DISTINCT k.id) AS total_distinct_keywords, SUM(CASE WHEN at.production_year > 2000 THEN 1 ELSE 0 END) AS movies_after_2000, COUNT(DISTINCT rt.id) AS total_distinct_roles FROM movie_companies AS mc JOIN company_type AS ct ON mc.company_type_id = ct.id JOIN aka_title AS at ON mc.movie_id = at.movie_id JOIN movie_link AS ml ON at.movie_id = ml.movie_id JOIN keyword AS k ON k.id = ml.id JOIN role_type AS rt ON rt.id = ml.link_type_id GROUP BY ct.kind HAVING COUNT(DISTINCT at.id) > 5;
SELECT kt.kind AS movie_kind, AVG(at.production_year) AS avg_production_year, COUNT(DISTINCT mk.movie_id) AS num_movies_with_keywords, SUM(CASE WHEN cc.status_id = '3' THEN 1 ELSE 0 END) AS count_complete_cast_status_3, SUM(CASE WHEN cc.status_id = '4' THEN 1 ELSE 0 END) AS count_complete_cast_status_4, COUNT(DISTINCT ml.movie_id) AS num_linked_movies FROM aka_title at JOIN kind_type kt ON at.kind_id = kt.id LEFT JOIN movie_keyword mk ON at.movie_id = mk.movie_id LEFT JOIN complete_cast cc ON at.movie_id = cc.movie_id LEFT JOIN movie_link ml ON at.movie_id = ml.movie_id GROUP BY kt.kind ORDER BY num_movies_with_keywords DESC, avg_production_year DESC;
SELECT COUNT(DISTINCT mi.movie_id) AS number_of_movies, AVG(CAST(mi.info AS FLOAT)) FILTER (WHERE it.info = 'rating') AS average_rating FROM movie_info mi JOIN info_type it ON mi.info_type_id = it.id WHERE it.info = 'rating' AND mi.info ~ '^[0-9]+(\.[0-9]+)?$';
