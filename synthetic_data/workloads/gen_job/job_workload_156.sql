SELECT cn.name AS company_name, COUNT(DISTINCT mc.movie_id) AS number_of_movies_produced, AVG(mi_idx.info::NUMERIC) AS average_movie_rating, SUM(CASE WHEN k.keyword = 'drama' THEN 1 ELSE 0 END) AS drama_movie_count, SUM(CASE WHEN k.keyword = 'comedy' THEN 1 ELSE 0 END) AS comedy_movie_count FROM company_name cn JOIN movie_companies mc ON cn.id = mc.company_id JOIN movie_keyword mk ON mc.movie_id = mk.movie_id JOIN keyword k ON mk.keyword_id = k.id JOIN movie_info_idx mi_idx ON mc.movie_id = mi_idx.movie_id WHERE mc.company_type_id = 1 AND mi_idx.info_type_id = (SELECT id FROM info_type WHERE info = 'rating') AND cn.country_code = 'US' GROUP BY cn.name ORDER BY average_movie_rating DESC, number_of_movies_produced DESC;
SELECT COUNT(DISTINCT mi_idx.movie_id) AS total_movies, AVG(mk_cnt.keyword_count) AS avg_keywords_per_movie, COUNT(DISTINCT ml.movie_id) AS total_linked_movies, SUM(CASE WHEN lt.link = 'similar to' THEN 1 ELSE 0 END) AS count_similar_to_links, COUNT(DISTINCT mc.company_id) AS total_companies, AVG(NULLIF(regexp_replace(mi_idx.info, '\D', '', 'g'), '')::NUMERIC) AS average_info_numeric, SUM(CASE WHEN k.phonetic_code IN ('M342', 'N2165') THEN 1 ELSE 0 END) AS count_specific_phonetic_codes FROM movie_info_idx AS mi_idx JOIN movie_keyword AS mk ON mi_idx.movie_id = mk.movie_id JOIN movie_link AS ml ON mk.movie_id = ml.movie_id JOIN movie_companies AS mc ON ml.movie_id = mc.movie_id JOIN link_type AS lt ON ml.link_type_id = lt.id JOIN keyword AS k ON mk.keyword_id = k.id JOIN (SELECT movie_id, COUNT(keyword_id) AS keyword_count FROM movie_keyword GROUP BY movie_id) AS mk_cnt ON mk.movie_id = mk_cnt.movie_id WHERE mi_idx.info_type_id = '100' AND mi_idx.info SIMILAR TO '%[0-9]{6,}%' AND (ml.movie_id IN ('11122', '14650', '11447', '7786', '14516') OR ml.id IN ('3768', '4002', '4548', '963', '430', '4309')) GROUP BY lt.link;
SELECT COUNT(DISTINCT ci.movie_id) AS number_of_movies, AVG(title.production_year) AS average_production_year, SUM(CASE WHEN n.gender = 'F' THEN 1 ELSE 0 END) AS female_cast_count, SUM(CASE WHEN n.gender = 'M' THEN 1 ELSE 0 END) AS male_cast_count, COUNT(DISTINCT n.id) AS total_cast_members, MIN(title.title) AS earliest_movie_title FROM cast_info ci INNER JOIN name n ON ci.person_id = n.id INNER JOIN title ON ci.movie_id = title.id INNER JOIN movie_info_idx mii ON title.id = mii.movie_id WHERE mii.info LIKE '1000111100' OR mii.info LIKE '....0213.2' OR mii.info LIKE '.....8...2' GROUP BY title.kind_id HAVING COUNT(DISTINCT ci.movie_id) > 5 ORDER BY average_production_year DESC;
SELECT it.info AS information_type, COUNT(DISTINCT mk.movie_id) AS number_of_movies, AVG(mc.company_id) AS average_company_id, SUM(CASE WHEN mc.company_id = 763 THEN 1 ELSE 0 END) AS count_specific_company, COUNT(DISTINCT mc.company_id) AS count_distinct_companies FROM movie_keyword AS mk INNER JOIN movie_companies AS mc ON mk.movie_id = mc.movie_id INNER JOIN complete_cast AS cc ON mc.movie_id = cc.movie_id INNER JOIN info_type AS it ON it.id = mc.company_type_id WHERE cc.status_id BETWEEN 1 AND 5 AND mc.company_id IN (763, 1012, 1500) AND mk.keyword_id BETWEEN 100 AND 200 GROUP BY it.info ORDER BY number_of_movies DESC, average_company_id;
SELECT cct.kind AS movie_kind, AVG(at.production_year) AS average_production_year, COUNT(at.id) AS number_of_titles, MAX(at.production_year) AS latest_production_year, MIN(at.production_year) AS earliest_production_year FROM aka_title at JOIN comp_cast_type cct ON at.kind_id = cct.id GROUP BY cct.kind ORDER BY average_production_year DESC;
SELECT AVG(ml_count.count) AS avg_movie_links, COUNT(DISTINCT an.person_id) AS distinct_person_count, SUM(CASE WHEN ml.link_type_id = '5' THEN 1 ELSE 0 END) AS total_sequel_links FROM movie_link AS ml JOIN (SELECT movie_id, COUNT(*) AS count FROM movie_link GROUP BY movie_id) AS ml_count ON ml.movie_id = ml_count.movie_id JOIN aka_name AS an ON ml.movie_id = an.person_id WHERE ml.link_type_id IN ('5', '11', '13', '17', '2', '1') GROUP BY ml.link_type_id;
SELECT ct.kind AS company_kind, COUNT(DISTINCT mc.movie_id) AS number_of_movies, AVG(CAST(mi_idx.info AS numeric)) AS average_rating, SUM(CASE WHEN cct.kind = 'complete+verified' THEN 1 ELSE 0 END) AS complete_verified_casts, COUNT(DISTINCT cn.id) AS number_of_actors FROM movie_companies AS mc JOIN company_type AS ct ON mc.company_type_id = ct.id LEFT JOIN movie_info_idx AS mi_idx ON mc.movie_id = mi_idx.movie_id LEFT JOIN complete_cast AS cc ON mc.movie_id = cc.movie_id LEFT JOIN comp_cast_type AS cct ON cc.status_id = cct.id LEFT JOIN char_name AS cn ON cc.subject_id = cn.id WHERE mc.movie_id IN (27359, 1639517, 1663098) AND mc.company_id IN (SELECT company_id FROM movie_companies WHERE company_type_id IN (1, 2)) GROUP BY ct.kind HAVING COUNT(DISTINCT mc.movie_id) > 1 ORDER BY number_of_movies DESC, average_rating DESC;
SELECT ct.kind AS company_type_kind, AVG(name.imdb_id) AS avg_imdb_id, COUNT(DISTINCT aka_name.person_id) AS unique_aka_person_count, SUM(CASE WHEN pi.info_type_id = '22' THEN 1 ELSE 0 END) AS count_info_type_22, MAX(mc.note) AS max_movie_company_note FROM movie_companies AS mc JOIN comp_cast_type AS cct ON mc.company_type_id = cct.id JOIN name ON name.id = mc.company_id JOIN aka_name ON aka_name.person_id = name.id LEFT JOIN person_info AS pi ON pi.person_id = name.id JOIN company_type AS ct ON ct.id = mc.company_type_id WHERE cct.kind = 'crew' AND name.surname_pcode IN ('A43', 'A432') AND name.md5sum IN ('95a7b086dc6ce3e141f3acbc8b45cc12', '27e967b3984165c80f751a75ef91e3fc') GROUP BY ct.kind;
