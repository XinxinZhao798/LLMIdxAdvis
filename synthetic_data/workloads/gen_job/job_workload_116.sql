SELECT cn.country_code, COUNT(DISTINCT mc.movie_id) AS number_of_movies, COUNT(DISTINCT mc.company_id) AS number_of_companies, AVG(ci.imdb_id) AS average_imdb_id, SUM(CASE WHEN mc.company_type_id = 1 THEN 1 ELSE 0 END) AS number_of_type_1_companies FROM movie_companies AS mc INNER JOIN company_name AS cn ON mc.company_id = cn.id LEFT JOIN name AS ci ON cn.imdb_id = ci.imdb_id WHERE cn.country_code IN ('[dm]', '[mt]', '[ph]', '[gb]', '[kz]', '[cz]') AND mc.note IN ('(1967) (USA) (TV) (original airing)', '(2009-2010) (Switzerland) (TV) (SF1)', '(2006) (Germany) (DVD)') GROUP BY cn.country_code
SELECT kt.kind AS movie_kind, COUNT(DISTINCT at.id) AS total_alternate_titles, AVG(at.production_year) AS average_production_year, COUNT(DISTINCT cn.id) AS total_companies, COUNT(DISTINCT k.id) AS total_keywords, COUNT(DISTINCT ml.id) AS total_movie_links, SUM(CASE WHEN at.imdb_index = 'III' THEN 1 ELSE 0 END) AS count_imdb_index_III, SUM(CASE WHEN at.imdb_index = 'II' THEN 1 ELSE 0 END) AS count_imdb_index_II FROM aka_title at JOIN keyword k ON at.id = k.id JOIN movie_companies mc ON at.movie_id = mc.movie_id JOIN company_name cn ON mc.company_id = cn.id LEFT JOIN movie_link ml ON at.movie_id = ml.movie_id JOIN (SELECT id, kind FROM comp_cast_type WHERE kind IN ('actor', 'actress')) kt ON at.kind_id = kt.id WHERE at.kind_id IN ('1', '4') AND k.id IN ('5500', '1630', '2267', '1048', '1589') AND cn.md5sum IN ( 'ecf8ff261534cbe4303655e3dc9d91d6', 'b62db3e43522346d25381c78513fb9f0', '558dd734341ba79634e8c1a3eb8cb0b4', '209bfa49f531585f9c54dcc6f84a6263', 'f617c567816ace229f1654cef896d37c', 'a6ab3a7e25fc36179e64a2d2f6d205e8' ) AND ml.linked_movie_id IN ('1089913', '2016615') GROUP BY kt.kind;
SELECT ct.kind AS company_type, COUNT(DISTINCT cn.id) AS number_of_companies, COUNT(DISTINCT ci.person_id) AS number_of_actors, AVG(ci.nr_order) AS average_cast_order, SUM(CASE WHEN t.production_year > 2000 THEN 1 ELSE 0 END) AS films_after_2000, MAX(t.production_year) AS latest_production_year FROM company_name cn JOIN company_type ct ON cn.id = ct.id JOIN cast_info ci ON ci.movie_id = cn.id JOIN title t ON ci.movie_id = t.id GROUP BY ct.kind ORDER BY number_of_companies DESC;
SELECT COUNT(DISTINCT a.id) AS unique_alternate_titles, AVG(a.production_year) AS average_production_year, COUNT(DISTINCT c.movie_id) AS total_movies_with_complete_cast, SUM(CASE WHEN k.keyword = 'dry-cleaners' THEN 1 ELSE 0 END) AS dry_cleaners_keyword_count, (SELECT COUNT(*) FROM link_type) AS total_link_types FROM aka_title AS a LEFT JOIN complete_cast AS c ON a.movie_id = c.movie_id LEFT JOIN movie_keyword AS mk ON a.movie_id = mk.movie_id LEFT JOIN keyword AS k ON mk.keyword_id = k.id WHERE a.production_year >= 2000 AND c.status_id IN (SELECT id FROM comp_cast_type WHERE kind = 'complete+verified') AND (k.phonetic_code = 'L2523' OR k.keyword IN ('imam', 'jug', 'greek', 'richard-nixon')) GROUP BY a.kind_id HAVING COUNT(DISTINCT c.movie_id) > 5;
SELECT COUNT(DISTINCT mi_idx.movie_id) AS total_movies, AVG(mk_cnt.keyword_count) AS avg_keywords_per_movie, COUNT(DISTINCT ml.movie_id) AS total_linked_movies, SUM(CASE WHEN lt.link = 'similar to' THEN 1 ELSE 0 END) AS count_similar_to_links, COUNT(DISTINCT mc.company_id) AS total_companies, AVG(NULLIF(regexp_replace(mi_idx.info, '\D', '', 'g'), '')::NUMERIC) AS average_info_numeric, SUM(CASE WHEN k.phonetic_code IN ('M342', 'N2165') THEN 1 ELSE 0 END) AS count_specific_phonetic_codes FROM movie_info_idx AS mi_idx JOIN movie_keyword AS mk ON mi_idx.movie_id = mk.movie_id JOIN movie_link AS ml ON mk.movie_id = ml.movie_id JOIN movie_companies AS mc ON ml.movie_id = mc.movie_id JOIN link_type AS lt ON ml.link_type_id = lt.id JOIN keyword AS k ON mk.keyword_id = k.id JOIN (SELECT movie_id, COUNT(keyword_id) AS keyword_count FROM movie_keyword GROUP BY movie_id) AS mk_cnt ON mk.movie_id = mk_cnt.movie_id WHERE mi_idx.info_type_id = '100' AND mi_idx.info SIMILAR TO '%[0-9]{6,}%' AND (ml.movie_id IN ('11122', '14650', '11447', '7786', '14516') OR ml.id IN ('3768', '4002', '4548', '963', '430', '4309')) GROUP BY lt.link;
SELECT ct.kind AS company_kind, AVG(mi_idx.info::numeric) AS average_rating, COUNT(DISTINCT mc.movie_id) AS number_of_movies, COUNT(DISTINCT c.id) AS number_of_casts, SUM(CASE WHEN mc.note IS NOT NULL THEN 1 ELSE 0 END) AS noted_movie_companies FROM company_type ct JOIN movie_companies mc ON ct.id = mc.company_type_id JOIN movie_info_idx mi_idx ON mc.movie_id = mi_idx.movie_id AND mi_idx.info_type_id = 101 JOIN complete_cast c ON mc.movie_id = c.movie_id WHERE ct.kind IN ('production companies', 'distributors') AND mi_idx.movie_id IN ('30178', '12242', '20540', '27059', '12152', '12149') AND mi_idx.info::numeric >= 1 AND mi_idx.info::numeric <= 10 GROUP BY ct.kind;
SELECT rt.ROLE, AVG(nk.count_keywords) AS average_keywords, COUNT(DISTINCT at.movie_id) AS number_of_movies, SUM(CASE WHEN at.production_year BETWEEN 2000 AND 2010 THEN 1 ELSE 0 END) AS movies_2000_to_2010, COUNT(DISTINCT n.id) AS number_of_names FROM role_type rt LEFT JOIN aka_title at ON rt.id = at.kind_id LEFT JOIN ( SELECT mk.movie_id, COUNT(mk.keyword_id) AS count_keywords FROM movie_keyword mk GROUP BY mk.movie_id ) nk ON nk.movie_id = at.movie_id LEFT JOIN name n ON n.id = at.movie_id WHERE rt.id IN (6, 7, 8) GROUP BY rt.ROLE ORDER BY average_keywords DESC;
SELECT mc.company_type_id, COUNT(DISTINCT t.id) AS number_of_movies, SUM(CASE WHEN t.kind_id = 2 THEN 1 ELSE 0 END) AS total_series_movies, ROUND(AVG(t.production_year), 2) AS average_production_year, SUM(CASE WHEN rt.role = 'producer' THEN 1 ELSE 0 END) AS total_producer_roles FROM title t JOIN movie_companies mc ON mc.movie_id = t.id LEFT JOIN role_type rt ON rt.id = mc.company_type_id WHERE t.production_year > 2000 GROUP BY mc.company_type_id HAVING COUNT(DISTINCT t.id) > 0 ORDER BY number_of_movies DESC, total_series_movies DESC;
SELECT rt.role, AVG(at.production_year) AS average_production_year, COUNT(DISTINCT at.movie_id) AS number_of_movies, COUNT(DISTINCT mi.id) AS number_of_movie_info_entries FROM role_type rt JOIN aka_name an ON rt.id = an.person_id JOIN aka_title at ON at.movie_id = an.person_id JOIN movie_info mi ON mi.movie_id = at.movie_id WHERE rt.role IN ('actor', 'actress') GROUP BY rt.role ORDER BY rt.role;
SELECT rt.role, COUNT(DISTINCT ci.movie_id) AS total_movies, AVG(ci.person_count) AS avg_people_per_role FROM ( SELECT c.movie_id, c.role_id, COUNT(c.person_id) AS person_count FROM cast_info AS c INNER JOIN movie_companies AS mc ON c.movie_id = mc.movie_id WHERE (mc.note LIKE '%(USA) (TV)%' OR mc.note LIKE '%(USA) (DVD)%') GROUP BY c.movie_id, c.role_id ) AS ci INNER JOIN role_type AS rt ON ci.role_id = rt.id GROUP BY rt.role ORDER BY total_movies DESC, avg_people_per_role DESC;
