SELECT rt.role, AVG(CAST(mi_idx.info AS INTEGER)) AS average_movie_rating, COUNT(DISTINCT pi.person_id) AS number_of_people, COUNT(DISTINCT cn.id) AS number_of_char_names, SUM(CASE WHEN n.gender = 'M' THEN 1 ELSE 0 END) AS male_count, SUM(CASE WHEN n.gender = 'F' THEN 1 ELSE 0 END) AS female_count FROM role_type rt JOIN name n ON n.id = CAST(rt.id AS INTEGER) LEFT JOIN char_name cn ON cn.md5sum = n.md5sum LEFT JOIN person_info pi ON pi.person_id = n.id LEFT JOIN movie_info_idx mi_idx ON mi_idx.movie_id = pi.person_id WHERE rt.role IN ('director', 'producer', 'composer') AND pi.info_type_id IN (SELECT id FROM info_type WHERE info IN ('trivia', 'quotes', 'birth notes')) AND (pi.note IS NULL OR pi.note <> 'Jacqeline Buono') GROUP BY rt.role;
SELECT ct.kind AS company_type, cn.country_code, COUNT(DISTINCT t.id) AS total_movies, AVG(t.imdb_id) AS average_imdb_id FROM title AS t JOIN movie_link AS ml ON t.id = ml.movie_id JOIN company_name AS cn ON cn.imdb_id = ml.linked_movie_id JOIN company_type AS ct ON cn.id = ct.id WHERE t.production_year BETWEEN 2010 AND 2020 AND cn.country_code IN ('US', 'GB', 'CA') GROUP BY ct.kind, cn.country_code ORDER BY total_movies DESC, average_imdb_id ASC;
SELECT mc.company_type_id, COUNT(DISTINCT mc.movie_id) AS num_movies, AVG(at.production_year) AS avg_production_year, COUNT(DISTINCT lt.id) AS num_link_types FROM movie_companies AS mc JOIN aka_title AS at ON mc.movie_id = at.movie_id JOIN link_type AS lt ON at.id = lt.id WHERE mc.company_type_id = 1 AND lt.link IN ('alternate language version of', 'featured in', 'edited into', 'edited from', 'spoofs', 'referenced in') GROUP BY mc.company_type_id;
SELECT ct.kind AS company_kind, COUNT(DISTINCT mc.movie_id) AS number_of_movies, AVG(CAST(mi_idx.info AS NUMERIC)) AS average_rating, SUM(CASE WHEN n.gender = 'F' THEN 1 ELSE 0 END) AS female_cast_count, SUM(CASE WHEN n.gender = 'M' THEN 1 ELSE 0 END) AS male_cast_count FROM company_type ct JOIN movie_companies mc ON ct.id = mc.company_type_id JOIN movie_info_idx mi_idx ON mc.movie_id = mi_idx.movie_id AND mi_idx.info_type_id = ( SELECT id FROM comp_cast_type WHERE kind = 'rating' ) JOIN name n ON mc.movie_id = n.id WHERE ct.kind IN ('special effects companies', 'miscellaneous companies', 'distributors') AND mc.movie_id IN ('19654', '24487', '18671', '31117', '18944') AND mc.company_id IN ('209', '936', '1140') AND n.name_pcode_cf IN ('A6232', 'A5163') GROUP BY ct.kind ORDER BY number_of_movies DESC, average_rating DESC;
SELECT ct.kind AS company_type, AVG(CAST(mi_idx.info AS INTEGER)) AS average_movie_rating, SUM(CASE WHEN k.phonetic_code IN ('S1521', 'I5315', 'A3252', 'G2436', 'P163', 'R5161') THEN 1 ELSE 0 END) AS count_specific_keywords, COUNT(DISTINCT at.id) AS count_distinct_titles, COUNT(DISTINCT cn.id) AS count_distinct_companies, MAX(at.production_year) AS latest_production_year, MIN(at.production_year) AS earliest_production_year FROM company_type AS ct JOIN company_name AS cn ON ct.id = cn.id JOIN movie_info_idx AS mi_idx ON mi_idx.movie_id = cn.imdb_id JOIN movie_keyword AS mk ON mk.movie_id = mi_idx.movie_id JOIN keyword AS k ON k.id = mk.keyword_id JOIN aka_title AS at ON at.movie_id = mk.movie_id WHERE ct.kind IN ('special effects companies', 'miscellaneous companies', 'production companies', 'distributors') AND k.id IN ('2313', '8814', '3289', '2874', '8924') GROUP BY ct.kind;
SELECT t.kind_id, min(k.kind) AS movie_kind, avg(t.production_year) AS average_production_year, count(DISTINCT mc.company_id) AS number_of_companies, count(DISTINCT ml.id) AS number_of_movie_links, count(DISTINCT mc.company_type_id) AS number_of_company_types FROM title AS t LEFT JOIN movie_companies AS mc ON t.id = mc.movie_id LEFT JOIN comp_cast_type AS k ON mc.company_type_id = k.id LEFT JOIN movie_link AS ml ON t.id = ml.movie_id AND ml.link_type_id IN ('16', '10') WHERE t.kind_id IN ('2', '7') GROUP BY t.kind_id;
SELECT COUNT(DISTINCT ci.movie_id) AS number_of_movies, AVG(LENGTH(mc.note)) AS avg_company_notes_length, COUNT(DISTINCT n.id) AS number_of_actors, SUM(CASE WHEN n.gender = 'm' THEN 1 ELSE 0 END) AS number_of_male_actors, cn.name AS production_company, COUNT(k.id) AS number_of_keywords_used, AVG(ci.nr_order) AS avg_cast_order FROM cast_info ci JOIN movie_companies mc ON ci.movie_id = mc.movie_id JOIN company_name cn ON mc.company_id = cn.id JOIN name n ON ci.person_id = n.id JOIN keyword k ON k.id = ci.role_id WHERE n.gender = 'm' AND ci.nr_order IN (23, 43, 32, 50, 117, 56) AND mc.note IS NOT NULL AND cn.country_code = 'US' GROUP BY cn.name ORDER BY number_of_movies DESC, avg_company_notes_length DESC;
SELECT kt.kind AS movie_kind, AVG(t.production_year) AS average_production_year, COUNT(DISTINCT an.person_id) AS unique_actors_with_alternate_names, COUNT(DISTINCT cn.id) AS number_of_companies, SUM(CASE WHEN t.production_year > 2000 THEN 1 ELSE 0 END) AS movies_produced_after_2000 FROM aka_name an INNER JOIN name n ON an.person_id = n.id INNER JOIN aka_title at ON n.id = at.movie_id INNER JOIN title t ON at.movie_id = t.id INNER JOIN kind_type kt ON t.kind_id = kt.id INNER JOIN company_name cn ON t.id = cn.imdb_id LEFT JOIN char_name chn ON an.person_id = chn.id WHERE (chn.name = 'Clarkson' OR chn.name = 'Miguelito' OR chn.name = 'Basket coach') GROUP BY kt.kind;
SELECT lt.LINK AS link_type, COUNT(ml.id) AS total_movie_links, AVG(pi.person_id) AS average_person_id, SUM(cc.status_id) AS sum_status_id FROM movie_link AS ml JOIN link_type AS lt ON ml.link_type_id = lt.id JOIN complete_cast AS cc ON ml.movie_id = cc.movie_id JOIN person_info AS pi ON cc.subject_id = pi.person_id WHERE ml.link_type_id IN (6, 5, 15, 16, 10, 17) AND ml.id IN (3372, 310) AND cc.id = 2124 GROUP BY lt.LINK ORDER BY total_movie_links DESC;
SELECT COUNT(DISTINCT mc.movie_id) AS number_of_movies, AVG(t.production_year) AS average_production_year, SUM(CASE WHEN t.series_years LIKE '1990-1991' THEN 1 ELSE 0 END) AS count_1990_1991_series, COUNT(DISTINCT k.id) AS unique_keywords, lt.LINK AS link_type, AVG(t.episode_nr) AS average_episode_number FROM movie_companies mc JOIN title t ON mc.movie_id = t.id LEFT JOIN keyword k ON t.id = k.id JOIN link_type lt ON lt.id = mc.company_type_id WHERE t.production_year > 1980 AND (t.series_years LIKE '1990-1991' OR t.series_years LIKE '2005-2006') AND mc.company_id IN (SELECT company_id FROM movie_companies WHERE movie_id = 22464) AND lt.id IN (2, 10) GROUP BY lt.LINK ORDER BY number_of_movies DESC;
SELECT mc.company_type_id, COUNT(DISTINCT mc.movie_id) AS total_movies, COUNT(DISTINCT mc.company_id) AS total_companies, AVG(k.id) AS average_keyword_id, COUNT(DISTINCT n.id) AS total_unique_cast_members, MAX(n.name) AS most_recent_cast_member_name FROM movie_companies mc JOIN keyword k ON mc.movie_id = k.id JOIN name n ON n.id = mc.company_id WHERE mc.company_type_id = '1' AND mc.note LIKE '%(TV)%' AND k.keyword IN ('training', 'mad-scientist', 'war-memorial') AND n.name_pcode_cf IN ('A6136', 'A2353', 'A6515', 'A4564', 'A2352', 'A265') GROUP BY mc.company_type_id;
SELECT mi.info AS genre, COUNT(DISTINCT mi.movie_id) AS number_of_movies, AVG(mii.info::numeric) AS average_movie_length, SUM(CASE WHEN lt.LINK = 'followed by' THEN 1 ELSE 0 END) AS sequel_count FROM movie_info mi JOIN movie_info_idx mii ON mi.movie_id = mii.movie_id AND mi.info_type_id = mii.info_type_id LEFT JOIN link_type lt ON lt.id = mii.info_type_id WHERE mi.info_type_id = 4 AND mii.movie_id IN ('19615', '11115', '18537', '8949', '8884') AND lt.LINK IN ('similar to', 'features', 'followed by', 'alternate language version of') GROUP BY genre ORDER BY number_of_movies DESC, average_movie_length DESC;
SELECT AVG(at.note_length) AS avg_note_length, COUNT(DISTINCT kw.id) AS num_unique_keywords, COUNT(DISTINCT at.id) AS num_titles, SUM(CASE WHEN at.episode_nr = 155 THEN 1 ELSE 0 END) AS num_episode_155, STRING_AGG(DISTINCT kw.keyword, ', ') AS keywords_list FROM ( SELECT id, movie_id, episode_nr, LENGTH(note) AS note_length FROM aka_title WHERE note LIKE '%(Australia) (fake working title)%' ) AS at JOIN movie_companies AS mc ON at.movie_id = mc.movie_id JOIN company_name AS cn ON mc.company_id = cn.id JOIN company_type AS ct ON mc.company_type_id = ct.id JOIN keyword AS kw ON cn.country_code = kw.phonetic_code WHERE kw.keyword IN ('handcuffed-to-someone', 'religious', 'drug-trafficking', 'conservatory', 'scientology', 'horse-riding') AND ct.kind = 'production companies' GROUP BY cn.country_code;
SELECT it.info AS information_type, COUNT(DISTINCT mi_idx.movie_id) AS number_of_movies, AVG(CAST(mi_idx.info AS NUMERIC)) AS average_info_value, COUNT(DISTINCT ml.movie_id) AS number_of_related_movies, COUNT(DISTINCT n.id) AS number_of_unique_actors, SUM(CASE WHEN rt.role = 'writer' THEN 1 ELSE 0 END) AS writers_count, SUM(CASE WHEN rt.role = 'composer' THEN 1 ELSE 0 END) AS composers_count, SUM(CASE WHEN rt.role = 'costume designer' THEN 1 ELSE 0 END) AS costume_designers_count FROM info_type it LEFT JOIN movie_info_idx mi_idx ON it.id = mi_idx.info_type_id LEFT JOIN movie_link ml ON mi_idx.movie_id = ml.movie_id LEFT JOIN link_type lt ON ml.link_type_id = lt.id LEFT JOIN complete_cast cc ON mi_idx.movie_id = cc.movie_id LEFT JOIN name n ON cc.subject_id = n.id LEFT JOIN role_type rt ON cc.status_id = rt.id WHERE it.info IN ('LD year', 'top 250 rank', 'keywords', 'LD disc format', 'release dates') AND lt.link IN ('spin off from', 'spoofed in', 'featured in') AND rt.role IN ('costume designer', 'composer', 'writer', 'miscellaneous crew') GROUP BY it.info;
SELECT kt.kind AS movie_kind, COUNT(DISTINCT ci.movie_id) AS num_movies, COUNT(DISTINCT ci.person_id) AS num_people, AVG(ci.nr_order) AS avg_cast_order, SUM(CASE WHEN n.gender = 'f' THEN 1 ELSE 0 END) AS female_actors_count, SUM(CASE WHEN n.gender = 'm' THEN 1 ELSE 0 END) AS male_actors_count, COUNT(DISTINCT k.id) AS num_keywords, count(DISTINCT cc.id) AS num_complete_cast_records FROM cast_info ci JOIN kind_type kt ON ci.role_id = kt.id JOIN name n ON ci.person_id = n.id LEFT JOIN keyword k ON ci.movie_id = k.id LEFT JOIN complete_cast cc ON ci.movie_id = cc.movie_id WHERE n.surname_pcode IN ('A415', 'A435') GROUP BY kt.kind ORDER BY num_movies DESC;
SELECT AVG(pi.id) AS average_person_info_id, COUNT(DISTINCT an.person_id) AS unique_aka_person_count, COUNT(DISTINCT lt.id) AS link_type_count, SUM(CASE WHEN an.name IS NOT NULL THEN 1 ELSE 0 END) AS not_null_aka_names, MAX(an.id) AS max_aka_name_id FROM aka_name AS an JOIN person_info AS pi ON an.person_id = pi.person_id JOIN link_type AS lt ON pi.info LIKE '%' || lt.link || '%' GROUP BY an.person_id HAVING COUNT(DISTINCT pi.info_type_id) > 1 ORDER BY unique_aka_person_count DESC, average_person_info_id ASC;
SELECT ct.kind AS company_kind, COUNT(DISTINCT t.id) AS total_titles, AVG(t.production_year) AS average_production_year, COUNT(DISTINCT k.id) AS distinct_keywords_count FROM company_type AS ct JOIN title AS t ON t.kind_id = ct.id LEFT JOIN keyword AS k ON k.phonetic_code = t.phonetic_code WHERE t.production_year IS NOT NULL AND ct.id IN (SELECT kind_id FROM title WHERE id IN (175843, 103199, 50713, 123396, 75890)) GROUP BY ct.kind ORDER BY total_titles DESC;
SELECT kt.kind AS content_type, COUNT(DISTINCT chn.id) AS unique_characters, AVG(comp_cast_type.id) AS average_comp_cast_type_id, COUNT(DISTINCT company_type.id) AS number_of_company_types FROM char_name AS chn JOIN kind_type AS kt ON chn.id = kt.id JOIN comp_cast_type ON chn.id = comp_cast_type.id JOIN company_type ON chn.id = company_type.id WHERE kt.kind IN ('tv movie', 'tv series', 'video game', 'movie', 'episode', 'video movie') AND company_type.kind IN ('special effects companies', 'miscellaneous companies', 'production companies', 'distributors') GROUP BY kt.kind ORDER BY unique_characters DESC, average_comp_cast_type_id;
SELECT kt.kind, COUNT(DISTINCT cc.movie_id) AS number_of_movies, AVG(cc.status_id) AS average_status_id, SUM(CASE WHEN n.gender = 'f' THEN 1 ELSE 0 END) AS female_cast_count, SUM(CASE WHEN n.gender = 'm' THEN 1 ELSE 0 END) AS male_cast_count FROM complete_cast cc JOIN kind_type kt ON cc.subject_id = kt.id JOIN name n ON cc.movie_id = n.id WHERE kt.kind IN ('video movie', 'tv series') GROUP BY kt.kind ORDER BY number_of_movies DESC;
