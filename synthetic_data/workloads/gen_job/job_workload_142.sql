SELECT kt.kind, COUNT(DISTINCT mi.movie_id) AS movie_count, AVG(CAST(NULLIF(mi.info, '') AS numeric)) FILTER (WHERE it.info = 'rating') AS average_rating, SUM(CAST(NULLIF(mi.info, '') AS numeric)) FILTER (WHERE it.info = 'budget') AS total_budget FROM movie_info mi JOIN movie_keyword mk ON mi.movie_id = mk.movie_id JOIN kind_type kt ON kt.id = mk.keyword_id JOIN (SELECT id, info FROM movie_info WHERE info_type_id IN (SELECT id FROM info_type WHERE info IN ('rating', 'budget'))) it ON mi.id = it.id WHERE mi.movie_id IN (925861, 925697, 924285) AND kt.id IN (1, 5, 7) GROUP BY kt.kind;
SELECT at.production_year, COUNT(DISTINCT at.movie_id) AS total_movies, AVG(at.episode_nr) AS average_episodes_per_season, COUNT(DISTINCT rt.id) AS distinct_roles_count FROM aka_title at JOIN role_type rt ON at.kind_id = rt.id JOIN info_type it ON at.id = it.id WHERE at.production_year IN (1972, 1934, 1943) AND rt.role IN ('production designer', 'composer', 'guest', 'producer', 'actor', 'writer') AND it.info IN ('admissions', 'votes', 'LD master format', 'soundtrack') GROUP BY at.production_year ORDER BY at.production_year;
SELECT AVG(mc.company_type_id) AS average_company_type, COUNT(DISTINCT mk.movie_id) AS total_movies_with_keywords, SUM(CASE WHEN cn.country_code = 'US' THEN 1 ELSE 0 END) AS total_us_companies, cn.name AS company_name, k.keyword AS keyword_name, COUNT(DISTINCT ml.link_type_id) AS total_link_types FROM movie_companies AS mc JOIN company_name AS cn ON mc.company_id = cn.id JOIN movie_keyword AS mk ON mc.movie_id = mk.movie_id JOIN keyword AS k ON mk.keyword_id = k.id JOIN movie_link AS ml ON mc.movie_id = ml.movie_id WHERE cn.name_pcode_nf IN ('L3424', 'T3231', 'J23') AND ml.id IN ('713', '4080', '967', '4313', '3260') AND k.phonetic_code IN ('M5', 'P4162', 'V4514', 'H452') GROUP BY cn.name, k.keyword ORDER BY total_movies_with_keywords DESC, total_us_companies DESC;
SELECT rt.role, AVG(t.production_year) AS average_production_year, COUNT(DISTINCT t.id) AS movie_count FROM role_type rt JOIN movie_info_idx mii ON rt.id = mii.info_type_id JOIN title t ON mii.movie_id = t.id JOIN info_type it ON mii.info_type_id = it.id WHERE it.info = 'LD contrast' AND it.id IN ('74', '69') GROUP BY rt.role ORDER BY movie_count DESC, average_production_year DESC;
SELECT cn.name AS company_name, cn.country_code, COUNT(DISTINCT mi.movie_id) AS number_of_movies, AVG(CAST(mi_idx.info AS NUMERIC)) FILTER (WHERE it.info = 'rating') AS average_rating, SUM(CASE WHEN mi.info = 'color' THEN 1 ELSE 0 END) AS number_of_color_movies, SUM(CASE WHEN mi.info = 'black and white' THEN 1 ELSE 0 END) AS number_of_bw_movies, COUNT(DISTINCT mk.keyword_id) FILTER (WHERE mk.keyword_id IN (4048, 2907, 2882)) AS number_of_specific_keywords FROM company_name cn LEFT JOIN movie_info mi ON mi.movie_id = cn.id LEFT JOIN movie_info_idx mi_idx ON mi_idx.movie_id = mi.movie_id LEFT JOIN info_type it ON it.id = mi_idx.info_type_id LEFT JOIN movie_keyword mk ON mk.movie_id = mi.movie_id LEFT JOIN movie_link ml ON ml.movie_id = mi.movie_id AND ml.link_type_id IN (SELECT id FROM link_type WHERE link IN ('sequel', 'prequel')) WHERE cn.country_code NOT IN ('US', 'CA') AND it.info = 'rating' AND mi.info IN ('color', 'black and white') GROUP BY cn.name, cn.country_code ORDER BY average_rating DESC, number_of_movies DESC;
SELECT ct.kind AS company_type, AVG(CAST(mi_idx.info AS INTEGER)) AS average_movie_rating, SUM(CASE WHEN k.phonetic_code IN ('S1521', 'I5315', 'A3252', 'G2436', 'P163', 'R5161') THEN 1 ELSE 0 END) AS count_specific_keywords, COUNT(DISTINCT at.id) AS count_distinct_titles, COUNT(DISTINCT cn.id) AS count_distinct_companies, MAX(at.production_year) AS latest_production_year, MIN(at.production_year) AS earliest_production_year FROM company_type AS ct JOIN company_name AS cn ON ct.id = cn.id JOIN movie_info_idx AS mi_idx ON mi_idx.movie_id = cn.imdb_id JOIN movie_keyword AS mk ON mk.movie_id = mi_idx.movie_id JOIN keyword AS k ON k.id = mk.keyword_id JOIN aka_title AS at ON at.movie_id = mk.movie_id WHERE ct.kind IN ('special effects companies', 'miscellaneous companies', 'production companies', 'distributors') AND k.id IN ('2313', '8814', '3289', '2874', '8924') GROUP BY ct.kind;
SELECT n.name AS actor_name, COUNT(DISTINCT cn.id) AS character_count, AVG(mk.keyword_id) AS average_keyword_id, SUM(CASE WHEN ml.link_type_id = 1 THEN 1 ELSE 0 END) AS direct_movie_links, COUNT(DISTINCT ml.movie_id) AS linked_movies_count FROM name n JOIN aka_name an ON n.id = an.person_id JOIN char_name cn ON an.id = cn.imdb_id JOIN movie_keyword mk ON cn.id = mk.movie_id JOIN movie_link ml ON mk.movie_id = ml.movie_id WHERE n.gender = 'm' GROUP BY n.name;
SELECT kt.kind AS movie_kind, COUNT(DISTINCT mk.movie_id) AS number_of_movies, AVG(mk.keyword_id) AS average_keyword_id FROM movie_keyword AS mk INNER JOIN kind_type AS kt ON kt.id = mk.keyword_id GROUP BY kt.kind ORDER BY number_of_movies DESC;
SELECT ct.kind AS company_kind, COUNT(DISTINCT cn.id) AS number_of_companies, COUNT(DISTINCT n.id) AS number_of_related_people, AVG(n.imdb_id) AS average_imdb_id, SUM(CASE WHEN k.keyword = 'business-deal' THEN 1 ELSE 0 END) AS count_business_deal_keywords, MAX(mi.info) AS latest_movie_info FROM company_name cn JOIN company_type ct ON cn.name_pcode_nf = ct.id::varchar JOIN movie_info mi ON mi.info_type_id = ct.id JOIN keyword k ON k.id = mi.movie_id JOIN name n ON n.imdb_id = mi.movie_id WHERE cn.country_code NOT IN ('[pl]', '[us]') AND k.keyword IN ('lunchbox', 'slipper', 'business-deal', 'child-molester') AND ct.kind IN ('special effects companies', 'miscellaneous companies', 'production companies', 'distributors') GROUP BY ct.kind ORDER BY number_of_companies DESC, count_business_deal_keywords DESC;
SELECT LEFT(cn.name_pcode_nf, 1) AS first_letter_of_pcode, COUNT(DISTINCT cn.id) AS total_characters, COUNT(DISTINCT cct.id) AS total_cast_types, lt.LINK AS link_type, COUNT(lt.id) AS link_type_count FROM char_name cn CROSS JOIN comp_cast_type cct JOIN link_type lt ON lt.id = cn.id GROUP BY first_letter_of_pcode, link_type ORDER BY first_letter_of_pcode, link_type_count DESC;
SELECT t.production_year, COUNT(DISTINCT t.id) AS number_of_movies, AVG(mi_idx.info::numeric) AS average_rating, SUM(CASE WHEN mc.company_type_id = 1 THEN 1 ELSE 0 END) AS number_of_productions, SUM(CASE WHEN mc.company_type_id = 2 THEN 1 ELSE 0 END) AS number_of_distributions FROM title AS t JOIN movie_companies AS mc ON t.id = mc.movie_id JOIN movie_info_idx AS mi_idx ON t.id = mi_idx.movie_id AND mi_idx.info_type_id = 101 LEFT JOIN movie_info AS mi ON t.id = mi.movie_id AND mi.info_type_id = 3 WHERE t.kind_id = 1 AND mc.company_type_id IN (1, 2) AND t.production_year BETWEEN 2000 AND 2020 GROUP BY t.production_year ORDER BY t.production_year;
SELECT ct.kind AS company_kind, AVG(mi_idx.info::numeric) AS average_rating, COUNT(DISTINCT mc.movie_id) AS number_of_movies, COUNT(DISTINCT c.id) AS number_of_casts, SUM(CASE WHEN mc.note IS NOT NULL THEN 1 ELSE 0 END) AS noted_movie_companies FROM company_type ct JOIN movie_companies mc ON ct.id = mc.company_type_id JOIN movie_info_idx mi_idx ON mc.movie_id = mi_idx.movie_id AND mi_idx.info_type_id = 101 JOIN complete_cast c ON mc.movie_id = c.movie_id WHERE ct.kind IN ('production companies', 'distributors') AND mi_idx.movie_id IN ('30178', '12242', '20540', '27059', '12152', '12149') AND mi_idx.info::numeric >= 1 AND mi_idx.info::numeric <= 10 GROUP BY ct.kind;
SELECT k.keyword, k.phonetic_code, COUNT(DISTINCT mk.movie_id) AS movies_count, COUNT(DISTINCT pi.person_id) AS people_count, SUM(CASE WHEN pi.note IS NOT NULL THEN 1 ELSE 0 END) AS noted_info_count, AVG(CASE WHEN pi.note IS NOT NULL THEN 1 ELSE 0 END) AS avg_noted_info FROM keyword AS k JOIN movie_keyword AS mk ON k.id = mk.keyword_id JOIN person_info AS pi ON mk.movie_id = pi.person_id GROUP BY k.keyword, k.phonetic_code ORDER BY movies_count DESC, people_count DESC;
SELECT ct.kind AS cast_type, AVG(mi_idx.info::numeric) AS average_info_numeric, COUNT(DISTINCT cn.id) AS number_of_companies, COUNT(DISTINCT k.id) AS number_of_keywords, MAX(cn.name) AS largest_company_name FROM comp_cast_type AS ct JOIN movie_info_idx AS mi_idx ON mi_idx.info_type_id = ct.id JOIN company_name AS cn ON cn.id = mi_idx.movie_id JOIN keyword AS k ON k.id = mi_idx.info_type_id JOIN movie_link AS ml ON ml.movie_id = mi_idx.movie_id JOIN role_type AS rt ON rt.id = ml.link_type_id WHERE cn.name_pcode_nf IN ('C252', 'T5252', 'D5213', 'B4242', 'K1253', 'E4261') AND rt.ROLE LIKE '%producer%' GROUP BY ct.kind ORDER BY average_info_numeric DESC;
SELECT rt.ROLE AS role_type, AVG(ci.nr_order) AS average_cast_order, COUNT(DISTINCT ci.person_id) AS unique_actors, COUNT(DISTINCT ci.movie_id) AS movies_count, MIN(t.title) AS earliest_movie_title, MAX(t.production_year) AS latest_production_year, SUM(CASE WHEN cn.country_code = 'US' THEN 1 ELSE 0 END) AS us_based_companies_count FROM cast_info AS ci JOIN role_type AS rt ON ci.role_id = rt.id JOIN title AS t ON ci.movie_id = t.id JOIN company_name AS cn ON cn.imdb_id = t.imdb_id WHERE t.production_year BETWEEN 2000 AND 2020 GROUP BY rt.ROLE ORDER BY movies_count DESC, unique_actors DESC;
SELECT t.title AS Movie_Title, COUNT(DISTINCT n.id) AS Number_of_Actors, AVG(mi_idx.info::numeric) AS Average_Rating, SUM(CASE WHEN rt.role = 'actor' THEN 1 ELSE 0 END) AS Total_Actors, SUM(CASE WHEN rt.role = 'actress' THEN 1 ELSE 0 END) AS Total_Actresses, t.production_year, COUNT(DISTINCT mk.keyword_id) AS Number_of_Keywords FROM title AS t JOIN cast_info AS ci ON t.id = ci.movie_id JOIN name AS n ON ci.person_id = n.id JOIN role_type AS rt ON ci.role_id = rt.id JOIN movie_info_idx AS mi_idx ON t.id = mi_idx.movie_id JOIN movie_keyword AS mk ON t.id = mk.movie_id JOIN info_type AS it ON mi_idx.info_type_id = it.id WHERE it.info = 'rating' AND t.production_year BETWEEN 2000 AND 2010 AND rt.role IN ('actor', 'actress') GROUP BY t.title, t.production_year HAVING COUNT(DISTINCT n.id) > 10 ORDER BY Average_Rating DESC, Number_of_Actors DESC LIMIT 10;
SELECT kt.kind AS movie_kind, COUNT(DISTINCT at.id) AS total_titles, COUNT(DISTINCT al.id) AS total_links, AVG(at.production_year) AS average_production_year, SUM(CASE WHEN at.kind_id = kt.id AND kt.kind = 'movie' THEN 1 ELSE 0 END) AS total_movies, SUM(CASE WHEN at.kind_id = kt.id AND kt.kind = 'tv series' THEN 1 ELSE 0 END) AS total_tv_series FROM aka_title AS at JOIN kind_type AS kt ON at.kind_id = kt.id LEFT JOIN movie_link AS al ON at.movie_id = al.movie_id GROUP BY kt.kind ORDER BY total_titles DESC;
SELECT cct.kind AS movie_kind, AVG(at.production_year) AS average_production_year, COUNT(at.id) AS number_of_titles, MAX(at.production_year) AS latest_production_year, MIN(at.production_year) AS earliest_production_year FROM aka_title at JOIN comp_cast_type cct ON at.kind_id = cct.id GROUP BY cct.kind ORDER BY average_production_year DESC;
SELECT ct.kind AS company_type, COUNT(DISTINCT mc.movie_id) AS total_movies, COUNT(DISTINCT mc.company_id) AS total_companies, AVG(mi_idx.info::numeric) AS average_movie_length, SUM(CASE WHEN an.name = 'Alan, Shane' THEN 1 ELSE 0 END) AS count_alan_shane_movies FROM movie_companies AS mc JOIN company_type AS ct ON mc.company_type_id = ct.id LEFT JOIN movie_info_idx AS mi_idx ON mc.movie_id = mi_idx.movie_id AND mi_idx.info_type_id = 3 LEFT JOIN aka_name AS an ON mc.movie_id = an.person_id AND an.name_pcode_nf = 'M2465' WHERE ct.kind IN ('production companies', 'special effects companies') AND mi_idx.note IS NULL GROUP BY ct.kind ORDER BY total_movies DESC;
SELECT mi_genre.info AS genre, COUNT(DISTINCT mi.movie_id) AS total_movies, AVG(cast_member_count) AS avg_cast_members_per_movie, SUM(company_count) AS total_companies_involved FROM movie_info mi_genre INNER JOIN movie_info mi ON mi.movie_id = mi_genre.movie_id AND mi_genre.info_type_id = 1 LEFT JOIN (SELECT movie_id, COUNT(DISTINCT person_id) AS cast_member_count FROM cast_info GROUP BY movie_id) AS ci_sub ON ci_sub.movie_id = mi.movie_id LEFT JOIN (SELECT movie_id, COUNT(DISTINCT company_id) AS company_count FROM movie_companies GROUP BY movie_id) AS mc_sub ON mc_sub.movie_id = mi.movie_id GROUP BY mi_genre.info ORDER BY total_movies DESC, avg_cast_members_per_movie DESC;
SELECT c.name AS company_name, it.info AS info_type, COUNT(DISTINCT mi.movie_id) AS number_of_movies, AVG(CAST(mi.info AS INTEGER)) AS average_info_numeric, SUM(CAST(CASE WHEN mi.info ~ '^\d+$' THEN mi.info ELSE '0' END AS INTEGER)) AS sum_info_numeric FROM company_name c JOIN movie_companies mc ON c.id = mc.company_id JOIN movie_info mi ON mc.movie_id = mi.movie_id JOIN info_type it ON mi.info_type_id = it.id JOIN movie_keyword mk ON mc.movie_id = mk.movie_id JOIN keyword k ON mk.keyword_id = k.id WHERE k.keyword IN ('atv', 'general-contractor', 'chance') AND k.phonetic_code IN ('C4615', 'B32', 'B3415') AND c.country_code IN ('[ddde]', '[pr]', '[nl]', '[ar]', '[xyu]') AND c.name_pcode_sf = 'B4232' AND mi.info ~ '^\d+$' GROUP BY c.name, it.info ORDER BY number_of_movies DESC, average_info_numeric DESC;
SELECT rt.role, AVG(mc.company_type_id) AS average_company_type, COUNT(DISTINCT mk.keyword_id) AS unique_keywords, SUM(CASE WHEN cc.subject_id = 1 THEN 1 ELSE 0 END) AS count_main_subject_movies FROM movie_companies mc INNER JOIN movie_keyword mk ON mc.movie_id = mk.movie_id INNER JOIN movie_info_idx mi ON mc.movie_id = mi.movie_id INNER JOIN complete_cast cc ON mc.movie_id = cc.movie_id INNER JOIN role_type rt ON rt.id = cc.subject_id WHERE rt.role IN ('costume designer', 'writer', 'guest', 'editor') AND mc.note IS NOT NULL AND mi.note IS NOT NULL GROUP BY rt.role;
SELECT kt.kind as Movie_Type, AVG(t.production_year) as Average_Production_Year, COUNT(DISTINCT t.id) as Total_Movies, COUNT(DISTINCT ml.movie_id) as Movies_With_Links, SUM(CASE WHEN t.series_years LIKE '2004-____' THEN 1 ELSE 0 END) as Movies_From_2004_onwards FROM title t JOIN kind_type kt ON t.kind_id = kt.id LEFT JOIN movie_link ml ON t.id = ml.movie_id AND ml.link_type_id IN ('16', '13', '8') WHERE kt.kind IN ('tv mini series', 'tv movie', 'video game', 'movie') GROUP BY kt.kind;
SELECT MIN(n.name) AS actor_name, AVG(CASE WHEN mi.info_type_id = (SELECT id FROM info_type WHERE info = 'runtime') THEN mi.info::FLOAT ELSE NULL END) AS average_movie_length, COUNT(DISTINCT k.id) AS unique_keywords_count, SUM(CASE WHEN ct.id = '1' THEN 1 ELSE 0 END) AS production_company_movies, SUM(CASE WHEN ct.id = '2' THEN 1 ELSE 0 END) AS distributor_movies, COUNT(DISTINCT a_t.id) AS total_movies_count FROM name AS n JOIN aka_name AS an ON n.id = an.person_id JOIN movie_info AS mi ON mi.movie_id = an.id JOIN movie_keyword AS mk ON mk.movie_id = an.id JOIN keyword AS k ON k.id = mk.keyword_id JOIN aka_title AS a_t ON a_t.movie_id = an.id JOIN movie_companies AS mc ON mc.movie_id = an.id JOIN company_type AS ct ON ct.id = mc.company_type_id WHERE n.name_pcode_nf = 'J4163' AND ct.id IN ('1', '2', '3', '4') GROUP BY n.id;
SELECT kt.kind, COUNT(DISTINCT mi_idx.movie_id) AS total_movies, AVG(mi_idx.info::NUMERIC) AS average_info, SUM(mi_idx.info::NUMERIC) AS total_info, COUNT(DISTINCT cn.id) AS total_companies, STRING_AGG(DISTINCT cn.name, ', ') AS company_names FROM movie_info_idx mi_idx JOIN info_type it ON mi_idx.info_type_id = it.id JOIN kind_type kt ON mi_idx.movie_id = kt.id JOIN company_name cn ON cn.imdb_id = mi_idx.movie_id WHERE kt.kind IN ('video movie', 'tv mini series', 'tv series', 'tv movie') AND cn.country_code = 'US' AND it.info = 'budget' GROUP BY kt.kind ORDER BY total_movies DESC;
