SELECT kt.kind, COUNT(DISTINCT mc.movie_id) AS number_of_movies, COUNT(DISTINCT ci.person_id) AS number_of_people, AVG(mc.company_id) AS average_company_id, SUM(CASE WHEN ct.kind = 'producer' THEN 1 ELSE 0 END) AS number_of_producers, MAX(ci.nr_order) AS max_cast_order FROM movie_companies mc JOIN company_type ct ON mc.company_type_id = ct.id JOIN kind_type kt ON ct.id = kt.id LEFT JOIN cast_info ci ON mc.movie_id = ci.movie_id WHERE kt.kind IN ('movie', 'tv series', 'tv movie') AND ct.kind IN ('distributor', 'producer') GROUP BY kt.kind ORDER BY number_of_movies DESC;
SELECT cn.country_code, COUNT(DISTINCT ci.movie_id) AS number_of_movies, AVG(ci.nr_order) AS average_cast_order, SUM(CASE WHEN mk.id = '4862' THEN 1 ELSE 0 END) AS keyword_4862_count, SUM(CASE WHEN mk.id = '1011' THEN 1 ELSE 0 END) AS keyword_1011_count, COUNT(DISTINCT ml.linked_movie_id) AS number_of_linked_movies FROM cast_info ci JOIN movie_keyword mk ON ci.movie_id = mk.movie_id JOIN company_name cn ON cn.imdb_id = ci.movie_id LEFT JOIN movie_link ml ON ci.movie_id = ml.movie_id WHERE ci.nr_order IN (2, 58, 40) AND ci.movie_id IN ('2013877', '811916', '1817302', '2485261', '163381') AND ml.movie_id IN ('19640', '12262', '11217', '7766', '14578', '16385') GROUP BY cn.country_code;
SELECT k.keyword, COUNT(DISTINCT ml.movie_id) AS linked_movies_count, AVG(sub_person_roles.roles_count) AS avg_roles_per_person, COUNT(DISTINCT an.id) AS unique_pseudonyms_count FROM keyword AS k LEFT JOIN movie_keyword AS mk ON k.id = mk.keyword_id LEFT JOIN movie_link AS ml ON mk.movie_id = ml.movie_id LEFT JOIN person_info AS pi ON pi.info_type_id = k.id LEFT JOIN (SELECT pi.person_id, COUNT(DISTINCT pi.info_type_id) AS roles_count FROM person_info AS pi INNER JOIN role_type AS rt ON pi.info_type_id = rt.id WHERE rt.id IN (1, 8, 7, 5) GROUP BY pi.person_id ) AS sub_person_roles ON pi.person_id = sub_person_roles.person_id LEFT JOIN aka_name AS an ON pi.person_id = an.person_id WHERE k.keyword IN ('murder', 'mystery', 'thriller') AND pi.info_type_id IN (70, 2, 75, 36, 50) GROUP BY k.keyword;
SELECT ct.kind as company_type, avg(at.production_year) as average_production_year, count(distinct at.id) as total_movies, count(distinct ml.movie_id) as total_linked_movies, sum(CASE WHEN at.kind_id = 3 THEN 1 ELSE 0 END) as total_kind_id_3, sum(CASE WHEN at.kind_id = 4 THEN 1 ELSE 0 END) as total_kind_id_4 FROM aka_title at JOIN movie_link ml ON at.movie_id = ml.movie_id JOIN company_type ct ON ml.link_type_id = ct.id WHERE at.kind_id IN (3, 4) AND ml.linked_movie_id IN (766538, 436, 2392833, 1659295, 2490166) AND at.production_year > 2000 GROUP BY ct.kind;
SELECT COUNT(DISTINCT at.id) AS num_alternate_titles, AVG(at.production_year) AS average_production_year, SUM(CASE WHEN mc.company_type_id = 9 THEN 1 ELSE 0 END) AS num_producer_companies, rt.ROLE AS role_type, COUNT(DISTINCT an.id) AS num_people_with_alternate_names FROM aka_title at JOIN movie_companies mc ON at.movie_id = mc.movie_id JOIN complete_cast compl_cast ON mc.movie_id = compl_cast.movie_id JOIN role_type rt ON compl_cast.subject_id = rt.id LEFT JOIN aka_name an ON an.person_id = compl_cast.subject_id WHERE mc.movie_id IN ('28519', '17394', '23681', '8931') AND an.md5sum IN ('0f9068a7f5499ebd1078fd242aa8d403', 'e4e7deb17d9499fb2031dfcbe39a2884', '19133574cb176a198fc5d24c24352d61', '86ce7e5bfe4997de75b05c21865ca40d', 'c42897449a530ff6921dbfdd466254ca') AND rt.id IN ('9', '2', '12', '6', '10') GROUP BY rt.ROLE ORDER BY num_producer_companies DESC, num_people_with_alternate_names DESC;
SELECT AVG(CAST(mi_idx.info AS numeric)) AS average_rating, COUNT(DISTINCT t.id) AS total_movies, COUNT(DISTINCT mc.company_id) AS total_companies_involved, SUM(CASE WHEN t.production_year > 2000 THEN 1 ELSE 0 END) AS movies_after_2000 FROM title AS t JOIN movie_info_idx AS mi_idx ON t.id = mi_idx.movie_id JOIN movie_companies AS mc ON t.id = mc.movie_id JOIN company_name AS cn ON mc.company_id = cn.id JOIN company_type AS ct ON mc.company_type_id = ct.id JOIN info_type AS it ON mi_idx.info_type_id = it.id WHERE it.info = 'rating' AND cn.country_code IS NOT NULL AND ct.kind <> 'production companies' AND t.kind_id NOT IN (SELECT id FROM comp_cast_type WHERE kind = 'tv series') GROUP BY cn.country_code, ct.kind ORDER BY average_rating DESC, total_movies DESC;
SELECT rt.ROLE, COUNT(DISTINCT ci.movie_id) AS number_of_movies, AVG(ci.nr_order) AS average_role_order, SUM(CASE WHEN cn.surname_pcode = 'G3143' THEN 1 ELSE 0 END) AS count_surname_G3143_roles, it.info AS information_type, COUNT(DISTINCT ci.person_id) AS number_of_persons FROM cast_info ci JOIN role_type rt ON ci.role_id = rt.id JOIN char_name cn ON ci.person_role_id = cn.id JOIN info_type it ON cn.imdb_id = it.id WHERE ci.person_id IN (1663, 1868, 1050, 1120) AND ci.person_role_id IN (538, 1342, 1444, 1143, 1039) AND rt.id IN (5, 3, 1, 11) GROUP BY rt.ROLE, it.info ORDER BY number_of_movies DESC, average_role_order;
SELECT rt.ROLE, COUNT(DISTINCT ci.movie_id) AS number_of_movies, AVG(ci.nr_order) AS average_cast_order, COUNT(DISTINCT name.id) AS number_of_unique_actors FROM cast_info ci JOIN role_type rt ON ci.role_id = rt.id JOIN name ON ci.person_id = name.id WHERE rt.id IN (1) AND ci.nr_order IS NOT NULL AND name.md5sum IN ('0d93c2f49007eb923f1f3983f0a8cc6b', 'c73602ee6ad37663369ca6e3bd40e7dd', 'db97c7dc12820b568f8351333075a92d', '53ebf953411448090e3e779bf1486727', 'f22535a12044b89484f9cba769cf437a', '6f608ba1bd4dd87eac0e663a877f54bc') GROUP BY rt.ROLE;
SELECT lt.LINK AS link_type, COUNT(*) AS total_links, AVG(ml.movie_id) AS average_movie_id, SUM(ml.linked_movie_id) AS total_linked_movie_id, (SELECT COUNT(*) FROM movie_companies WHERE company_type_id = 1) AS total_production_companies, (SELECT COUNT(DISTINCT person_id) FROM aka_name WHERE surname_pcode IN ('R3', 'D261')) AS distinct_actors_with_surname_codes FROM movie_link AS ml JOIN link_type AS lt ON ml.link_type_id = lt.id WHERE ml.link_type_id IN (10, 17, 8, 4) AND ml.linked_movie_id IN (18308, 2451963, 244970, 615863, 1221214, 2112428) AND EXISTS (SELECT 1 FROM movie_companies WHERE movie_id = ml.movie_id AND company_type_id = 1) GROUP BY lt.LINK ORDER BY total_links DESC;
SELECT cct.kind AS cast_type, COUNT(DISTINCT mk.movie_id) AS movie_count, COUNT(mk.id) AS keyword_count, AVG(ct.id) AS average_company_type_id FROM comp_cast_type cct JOIN movie_keyword mk ON cct.id = mk.movie_id JOIN company_type ct ON mk.keyword_id = ct.id GROUP BY cct.kind HAVING COUNT(DISTINCT mk.movie_id) > 5 ORDER BY movie_count DESC, keyword_count DESC;
SELECT ct.kind AS company_kind, AVG(t.production_year) AS average_production_year, COUNT(DISTINCT t.id) AS number_of_movies, SUM(COUNT(DISTINCT mk.keyword_id)) OVER (PARTITION BY mc.company_type_id) AS total_keywords FROM title t JOIN movie_companies mc ON t.id = mc.movie_id JOIN company_type ct ON mc.company_type_id = ct.id LEFT JOIN movie_keyword mk ON t.id = mk.movie_id GROUP BY ct.kind, mc.company_type_id ORDER BY average_production_year DESC, number_of_movies DESC;
SELECT lt.LINK AS link_type, COUNT(DISTINCT mc.movie_id) AS num_movies, AVG(n.imdb_id) AS avg_imdb_id, SUM(CASE WHEN n.gender = 'M' THEN 1 ELSE 0 END) AS male_count, SUM(CASE WHEN n.gender = 'F' THEN 1 ELSE 0 END) AS female_count FROM movie_companies AS mc JOIN link_type AS lt ON mc.company_type_id = lt.id JOIN name AS n ON mc.movie_id = n.id WHERE mc.company_type_id = 1 AND lt.link IN ('featured in', 'alternate language version of') AND mc.movie_id = 18491 GROUP BY lt.LINK;
SELECT ct.kind AS company_type, cn.country_code, COUNT(DISTINCT k.id) AS unique_keywords_count, COUNT(DISTINCT t.id) AS total_movies, SUM(CASE WHEN t.production_year > 2000 THEN 1 ELSE 0 END) AS movies_after_2000 FROM company_name cn JOIN company_type ct ON cn.id = ct.id JOIN title t ON t.production_year IS NOT NULL JOIN movie_keyword mk ON t.id = mk.movie_id JOIN keyword k ON mk.keyword_id = k.id WHERE cn.country_code != 'US' AND k.keyword IN ('high-powered-gun', 'airforce', 'harpoon', 'creek') AND t.kind_id != 1 GROUP BY ct.kind, cn.country_code ORDER BY total_movies DESC;
