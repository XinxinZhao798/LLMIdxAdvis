SELECT ct.kind AS cast_type, AVG(mc.company_id) AS average_company_id, SUM(CASE WHEN mi.info_type_id = 1 THEN 1 ELSE 0 END) AS count_genre_info, COUNT(DISTINCT k.id) AS unique_keyword_count, MAX(mi.movie_id) AS max_movie_id FROM comp_cast_type ct JOIN complete_cast cc ON ct.id = cc.subject_id JOIN movie_companies mc ON cc.movie_id = mc.movie_id JOIN movie_info mi ON mc.movie_id = mi.movie_id JOIN keyword k ON k.id = ANY(ARRAY[6997, 6526]) WHERE mc.company_type_id BETWEEN 1 AND 5 AND mi.info_type_id IN (1, 2, 3, 4) AND mi.note IS NOT NULL AND cc.status_id IN (SELECT id FROM link_type WHERE id IN (4, 8, 12)) GROUP BY ct.kind ORDER BY unique_keyword_count DESC, average_company_id;
SELECT kt.kind, COUNT(DISTINCT cn.id) AS num_companies, COUNT(DISTINCT mi.movie_id) AS num_movies, AVG(CAST(mi.info AS NUMERIC)) FILTER (WHERE it1.info = 'rating') AS avg_rating, SUM(CAST(mi.info AS NUMERIC)) FILTER (WHERE it1.info = 'budget') AS total_budget FROM kind_type AS kt JOIN movie_info AS mi ON mi.info_type_id = kt.id JOIN company_name AS cn ON cn.imdb_id = mi.movie_id JOIN movie_info AS it1 ON mi.movie_id = it1.movie_id AND it1.info_type_id = kt.id WHERE kt.id IN ('4', '5', '1') AND kt.kind IN ('episode', 'tv series', 'video game') AND mi.info_type_id IN (SELECT id FROM info_type WHERE info IN ('rating', 'budget')) GROUP BY kt.kind;
SELECT rt.ROLE, COUNT(*) AS num_roles, AVG(cn.imdb_id) AS avg_imdb_id, SUM(cct.id) AS sum_cast_type_ids FROM aka_name AS an JOIN char_name AS cn ON an.person_id = cn.id JOIN comp_cast_type AS cct ON cn.id = cct.id JOIN role_type AS rt ON cct.id = rt.id GROUP BY rt.ROLE ORDER BY num_roles DESC;
SELECT ct.kind AS company_kind, rt.ROLE AS role_description, COUNT(DISTINCT cn.id) AS number_of_companies, COUNT(DISTINCT ci.person_id) AS number_of_people, AVG(ci.nr_order) AS average_cast_order, SUM(CASE WHEN lt.LINK = 'follows' THEN 1 ELSE 0 END) AS total_follows_links FROM cast_info ci JOIN role_type rt ON ci.role_id = rt.id JOIN company_name cn ON ci.movie_id = cn.id JOIN company_type ct ON cn.id = ct.id JOIN link_type lt ON cn.id = lt.id WHERE ci.person_role_id IS NOT NULL AND cn.country_code = 'US' AND rt.ROLE IN ('actor', 'actress', 'producer', 'director') AND lt.LINK IN ('remade as', 'version of', 'spin off from', 'follows') GROUP BY ct.kind, rt.ROLE ORDER BY number_of_people DESC, average_cast_order;
SELECT COUNT(DISTINCT ci.person_id) AS total_actors, AVG(ci.nr_order) AS average_cast_order, SUM(CASE WHEN n.gender = 'F' THEN 1 ELSE 0 END) AS female_actors_count, SUM(CASE WHEN n.gender = 'M' THEN 1 ELSE 0 END) AS male_actors_count, t.production_year, COUNT(DISTINCT k.id) AS total_keywords_used, COUNT(DISTINCT t.id) AS total_movies FROM cast_info ci JOIN name n ON ci.person_id = n.id JOIN title t ON ci.movie_id = t.id JOIN movie_keyword mk ON t.id = mk.movie_id JOIN keyword k ON mk.keyword_id = k.id WHERE t.production_year >= 2000 AND t.kind_id = 1 GROUP BY t.production_year ORDER BY t.production_year DESC;
SELECT AVG(ci.nr_order) AS average_cast_order, COUNT(DISTINCT ci.person_id) AS total_unique_actors, SUM(CASE WHEN cc.status_id = 4 THEN 1 ELSE 0 END) AS count_complete_status, SUM(CASE WHEN cc.status_id = 3 THEN 1 ELSE 0 END) AS count_incomplete_status, COUNT(DISTINCT an.id) AS total_aka_names FROM cast_info AS ci JOIN complete_cast AS cc ON ci.movie_id = cc.movie_id LEFT JOIN aka_name AS an ON ci.person_id = an.person_id WHERE ci.role_id = 1 AND cc.id IN (1863, 310, 417, 31, 2902, 329) GROUP BY ci.movie_id;
SELECT ct.kind AS cast_type, AVG(movcomp_notes.note_length) AS average_note_length, COUNT(DISTINCT movcomp.movie_id) AS number_of_movies, COUNT(DISTINCT comp.name) AS number_of_companies, SUM(CASE WHEN movcomp.company_type_id = 1 THEN 1 ELSE 0 END) AS number_of_producers, MAX(comp_cast.subject_id) AS max_subject_id_for_cast_type FROM complete_cast AS comp_cast JOIN comp_cast_type AS ct ON comp_cast.subject_id = ct.id JOIN movie_companies AS movcomp ON movcomp.movie_id = comp_cast.movie_id JOIN company_name AS comp ON movcomp.company_id = comp.id LEFT JOIN (SELECT movie_id, LENGTH(note) AS note_length FROM movie_companies) AS movcomp_notes ON movcomp.movie_id = movcomp_notes.movie_id WHERE comp_cast.id IN (4264, 2513, 575, 1032) AND comp_cast.subject_id = 1 AND ct.id = 4 GROUP BY ct.kind;
SELECT a.title AS alternate_title, AVG(kt.production_year) AS avg_production_year, COUNT(DISTINCT n.id) AS number_of_contributors, SUM(CASE WHEN kw.keyword = 'ball' THEN 1 ELSE 0 END) AS ball_keyword_count, SUM(CASE WHEN kw.keyword = 'advisor' THEN 1 ELSE 0 END) AS advisor_keyword_count FROM aka_title a INNER JOIN keyword kw ON kw.phonetic_code = a.phonetic_code INNER JOIN aka_title kt ON kt.id = a.movie_id AND kt.kind_id = a.kind_id LEFT JOIN name n ON n.name_pcode_cf = a.phonetic_code WHERE a.movie_id IN ('1644521', '1664207') GROUP BY a.title;
