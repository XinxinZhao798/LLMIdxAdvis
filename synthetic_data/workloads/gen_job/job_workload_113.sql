SELECT COUNT(DISTINCT t.id) AS total_movies, AVG(t.production_year) AS average_production_year, SUM(CASE WHEN at.episode_nr IS NOT NULL THEN 1 ELSE 0 END) AS total_episodes, kt.kind AS movie_kind, COUNT(DISTINCT k.id) AS distinct_keywords FROM title AS t JOIN aka_title AS at ON t.id = at.movie_id JOIN keyword AS k ON at.id = k.id JOIN company_type AS kt ON t.kind_id = kt.id WHERE t.production_year > 1990 AND at.md5sum IN ('3fbf6cc79b437aac2b533ef93a1a1f72', '3b7d0f2a4c38d29ba47fb2bef6fdc62a', '3029182796f9ac1107d5ec5eba333955', '3f32d0b04dd67b92118e6032b58a8be4', '33e7b8cd483255b73ad813d49d5f4a46') AND at.imdb_index IN ('III', 'IV', 'I', 'II') GROUP BY kt.kind ORDER BY total_movies DESC;
SELECT ct.kind AS cast_type, COUNT(DISTINCT t.id) AS number_of_titles, AVG(t.production_year) AS average_production_year, SUM(CASE WHEN t.kind_id = 1 THEN 1 ELSE 0 END) AS number_of_movies, SUM(CASE WHEN t.kind_id = 2 THEN 1 ELSE 0 END) AS number_of_tv_shows, MIN(t.production_year) AS earliest_production_year, MAX(t.production_year) AS latest_production_year FROM title AS t JOIN comp_cast_type AS ct ON t.kind_id = ct.id JOIN aka_name AS an ON an.person_id = t.id JOIN person_info AS pi ON pi.person_id = an.person_id WHERE t.id IN (154689, 143089, 183564, 150330, 103875) AND an.surname_pcode IN ('A163', 'V625', 'S53', 'G12', 'H53') AND ct.id IN (2, 1, 4, 3) GROUP BY ct.kind;
SELECT rt.ROLE, COUNT(mc.movie_id) AS number_of_movies, AVG(alt.production_year) AS average_production_year, SUM(CASE WHEN lt.LINK = 'sequel' THEN 1 ELSE 0 END) AS sequel_count, COUNT(DISTINCT mc.company_id) AS distinct_companies_involved FROM aka_title alt INNER JOIN movie_companies mc ON alt.movie_id = mc.movie_id INNER JOIN link_type lt ON lt.id = alt.kind_id INNER JOIN role_type rt ON rt.id = mc.company_type_id WHERE rt.id IN ('1', '8') GROUP BY rt.ROLE ORDER BY number_of_movies DESC;
SELECT AVG(t.production_year) AS average_production_year, COUNT(DISTINCT t.id) AS number_of_movies, COUNT(DISTINCT k.id) AS number_of_unique_keywords, SUM(CASE WHEN k.keyword = 'poisoning' THEN 1 ELSE 0 END) AS count_poisoning_keyword, SUM(CASE WHEN k.keyword = 'law-student' THEN 1 ELSE 0 END) AS count_law_student_keyword, MAX(t.title) AS latest_movie_title FROM title AS t JOIN movie_keyword AS mk ON t.id = mk.movie_id JOIN keyword AS k ON mk.keyword_id = k.id JOIN movie_info AS mi ON t.id = mi.movie_id JOIN company_type AS ct ON ct.id = mi.info_type_id WHERE t.production_year BETWEEN 2000 AND 2010 AND ct.kind IN ('production companies', 'distributors') GROUP BY ct.kind ORDER BY average_production_year DESC;
SELECT lt.LINK AS link_type, COUNT(ml.id) AS total_links, AVG(pi.info_type_id) AS average_info_type_id, MIN(k.keyword) AS minimum_keyword, SUM(ml.movie_id) AS sum_movie_ids, MAX(ml.linked_movie_id) AS max_linked_movie_id FROM movie_link AS ml JOIN link_type AS lt ON lt.id = ml.link_type_id JOIN keyword AS k ON k.id = ml.id JOIN person_info AS pi ON pi.id = ml.id WHERE k.keyword LIKE 'physician%' AND lt.LINK IN ('similar to', 'spin off') AND pi.note ILIKE '%Director%' GROUP BY lt.LINK;
SELECT cn.country_code, k.keyword, COUNT(DISTINCT mc.movie_id) AS num_movies, AVG(CAST(NULLIF(REGEXP_REPLACE(mi_duration.info, '[^\d.]', '', 'g'), '') AS NUMERIC)) AS average_movie_duration, SUM(CASE WHEN mi_release.info_type_id = 4 THEN 1 ELSE 0 END) AS count_movie_releases FROM company_name AS cn JOIN movie_companies AS mc ON cn.id = mc.company_id JOIN movie_keyword AS mk ON mc.movie_id = mk.movie_id JOIN keyword AS k ON mk.keyword_id = k.id LEFT JOIN movie_info AS mi_release ON mc.movie_id = mi_release.movie_id AND mi_release.info_type_id = 4 LEFT JOIN movie_info AS mi_duration ON mc.movie_id = mi_duration.movie_id AND mi_duration.info_type_id = 3 WHERE k.keyword IN ('dead-mother', 'manipulation') AND mi_release.note IN ('(some dialogue)', '(none)', '(only a few lines)', '(a few lines)', '(a few words)') GROUP BY cn.country_code, k.keyword ORDER BY cn.country_code, k.keyword;
SELECT kt.kind AS movie_type, COUNT(DISTINCT t.id) AS number_of_movies, AVG(t.production_year) AS average_production_year, COUNT(DISTINCT mc.company_id) AS number_of_production_companies, COUNT(DISTINCT pi.person_id) AS number_of_individual_contributors, SUM(CASE WHEN t.md5sum IN ('1f1ce7379075bf949e40cb57616b3f4d', '0d05192e412a817cc87628ae56d58d5b') THEN 1 ELSE 0 END) AS count_of_specific_md5sum FROM title t JOIN kind_type kt ON t.kind_id = kt.id JOIN movie_companies mc ON t.id = mc.movie_id JOIN company_type ct ON mc.company_type_id = ct.id JOIN person_info pi ON pi.person_id = t.id WHERE ct.kind = 'production' AND t.production_year BETWEEN 1990 AND 2020 GROUP BY kt.kind ORDER BY number_of_movies DESC;
SELECT ml.movie_id, COUNT(DISTINCT ml.linked_movie_id) AS number_of_linked_movies, AVG(COUNT(ml.linked_movie_id)) OVER () AS average_links_per_movie, COUNT(DISTINCT mk.keyword_id) AS total_distinct_keywords FROM movie_link AS ml INNER JOIN movie_info AS mi ON ml.movie_id = mi.movie_id INNER JOIN movie_keyword AS mk ON ml.movie_id = mk.movie_id GROUP BY ml.movie_id ORDER BY number_of_linked_movies DESC, total_distinct_keywords DESC;
SELECT AVG(at.production_year) AS average_production_year, COUNT(DISTINCT at.movie_id) AS number_of_movies, COUNT(DISTINCT ml.linked_movie_id) AS number_of_linked_movies, SUM(CASE WHEN lt.link = 'similar to' THEN 1 ELSE 0 END) AS count_similar_movies, rt.role AS role_type, COUNT(DISTINCT cct.id) AS count_of_cast_types FROM aka_title at JOIN movie_link ml ON at.movie_id = ml.movie_id JOIN link_type lt ON ml.link_type_id = lt.id JOIN role_type rt ON rt.id = 4 JOIN comp_cast_type cct ON cct.kind IN ('complete+verified', 'cast', 'crew', 'complete') WHERE at.md5sum IN ('efba398a3a676bcdd49811cf868754d9', '532902abff1e92fb97a2eef43fb530a6', '803eb3353f2aeb81555223391ef4de88', 'eaf5b1adddabc3742e27581d5b19c2ac') GROUP BY rt.role;
SELECT cct.kind AS role_type, COUNT(DISTINCT ci.person_id) AS number_of_people, AVG(ci.nr_order) AS average_cast_order, COUNT(DISTINCT k.id) AS number_of_keywords FROM cast_info ci JOIN comp_cast_type cct ON ci.role_id = cct.id JOIN keyword k ON k.keyword LIKE '%murder%' OR k.keyword LIKE '%violence%' WHERE ci.person_role_id IN (2, 3, 4) GROUP BY cct.kind ORDER BY number_of_people DESC, average_cast_order;
SELECT ct.kind AS company_type, AVG(mi_idx.info::NUMERIC) AS average_movie_rating, SUM(CASE WHEN cc.status_id = 4 THEN 1 ELSE 0 END) AS total_completed_movies, COUNT(DISTINCT k.id) AS number_of_unique_keywords, COUNT(DISTINCT mc.movie_id) AS number_of_movies_with_companies FROM movie_info mi JOIN movie_info_idx mi_idx ON mi.movie_id = mi_idx.movie_id AND mi.info_type_id = mi_idx.info_type_id JOIN movie_companies mc ON mi.movie_id = mc.movie_id JOIN company_type ct ON mc.company_type_id = ct.id JOIN complete_cast cc ON mc.movie_id = cc.movie_id JOIN keyword k ON mi.movie_id = k.id WHERE ct.id IN (3, 4) AND mc.company_id IN (202, 974) AND cc.status_id IN (3, 4) AND cc.subject_id = 1 AND mi.note LIKE '%(only a few lines)%' GROUP BY ct.kind;
