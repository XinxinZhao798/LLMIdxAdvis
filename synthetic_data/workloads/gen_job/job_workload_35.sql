SELECT mc.company_type_id, COUNT(DISTINCT mc.movie_id) AS total_movies, COUNT(DISTINCT mc.company_id) AS total_companies, AVG(k.id) AS average_keyword_id, COUNT(DISTINCT n.id) AS total_unique_cast_members, MAX(n.name) AS most_recent_cast_member_name FROM movie_companies mc JOIN keyword k ON mc.movie_id = k.id JOIN name n ON n.id = mc.company_id WHERE mc.company_type_id = '1' AND mc.note LIKE '%(TV)%' AND k.keyword IN ('training', 'mad-scientist', 'war-memorial') AND n.name_pcode_cf IN ('A6136', 'A2353', 'A6515', 'A4564', 'A2352', 'A265') GROUP BY mc.company_type_id;
SELECT avg(CAST(mi_idx.info AS FLOAT)) AS average_rating, count(DISTINCT mk.keyword_id) AS number_of_keywords, count(DISTINCT an.id) AS number_of_aka_names FROM movie_info_idx AS mi_idx JOIN movie_keyword AS mk ON mi_idx.movie_id = mk.movie_id JOIN aka_name AS an ON an.person_id = mk.movie_id WHERE mi_idx.info_type_id IN (100, 101, 99) AND mk.movie_id IN (18864, 8952, 12152) AND an.surname_pcode IN ('M635', 'P14', 'A15', 'A263', 'D1', 'A261') GROUP BY mi_idx.movie_id;
SELECT ct.kind AS company_kind, COUNT(DISTINCT cct.id) AS num_comp_cast_types, AVG(mlink.movie_id) AS average_movie_id, SUM(mlink.linked_movie_id) AS total_linked_movie_id, COUNT(DISTINCT mlink.id) AS num_movie_links FROM company_type ct JOIN comp_cast_type cct ON ct.id = cct.id JOIN movie_link mlink ON mlink.link_type_id = ct.id WHERE ct.kind IN ('special effects companies', 'miscellaneous companies', 'production companies', 'distributors') GROUP BY ct.kind ORDER BY num_comp_cast_types DESC;
SELECT rt.role AS role_type, COUNT(DISTINCT pi.person_id) AS number_of_people, AVG(CASE WHEN pi.info LIKE '%cm' THEN CAST(SUBSTRING(pi.info FROM '^[0-9]+') AS INTEGER) END) AS average_height, COUNT(DISTINCT cn.id) AS number_of_companies, cn.country_code, SUM(CASE WHEN pi.info LIKE '%Bad Faith%' THEN 1 ELSE 0 END) AS bad_faith_count FROM person_info pi JOIN role_type rt ON rt.id = pi.info_type_id JOIN name n ON n.id = pi.person_id JOIN company_name cn ON cn.imdb_id = n.imdb_id WHERE rt.role IN ('writer', 'producer', 'actor') AND cn.country_code IN ('US', 'GB', 'CA') GROUP BY rt.role, cn.country_code ORDER BY role_type, cn.country_code;
SELECT COUNT(DISTINCT an.person_id) AS number_of_persons, COUNT(k.id) AS total_keyword_mentions FROM keyword AS k JOIN movie_keyword AS mk ON k.id = mk.keyword_id JOIN aka_name AS an ON mk.movie_id = an.person_id WHERE k.keyword IN ('money-tree', 'reference-to-moby-dick', 'camp', 'summons') GROUP BY an.person_id;
SELECT ct.kind AS company_kind, AVG(ti.production_year) AS average_production_year, COUNT(*) AS total_movies, SUM(CASE WHEN ml.link_type_id = 10 THEN 1 ELSE 0 END) AS total_sequels, COUNT(DISTINCT n.id) AS distinct_actors FROM title ti INNER JOIN company_type ct ON ti.kind_id = ct.id LEFT JOIN movie_link ml ON ti.id = ml.movie_id AND ml.link_type_id IN (10, 11, 5, 6, 13) LEFT JOIN cast_info ci ON ti.id = ci.movie_id LEFT JOIN name n ON ci.person_id = n.id WHERE ti.production_year BETWEEN 2000 AND 2020 GROUP BY ct.kind ORDER BY total_movies DESC, average_production_year;
SELECT COUNT(DISTINCT mc.movie_id) AS number_of_movies, AVG(mi_idx.info::NUMERIC) AS average_movie_length, SUM(CASE WHEN n.gender = 'F' THEN 1 ELSE 0 END) AS female_cast_count, SUM(CASE WHEN n.gender = 'M' THEN 1 ELSE 0 END) AS male_cast_count, COUNT(DISTINCT mk.keyword_id) AS number_of_unique_keywords FROM movie_companies AS mc JOIN movie_info_idx AS mi_idx ON mc.movie_id = mi_idx.movie_id AND mi_idx.info_type_id = 1 JOIN movie_info AS mi ON mc.movie_id = mi.movie_id JOIN movie_keyword AS mk ON mc.movie_id = mk.movie_id JOIN name AS n ON n.id = ANY (ARRAY [9129, 3874, 7033, 7761, 6454]) WHERE mc.company_type_id IN (1, 2) AND mi.note LIKE '%(a few words)%' GROUP BY mc.company_id ORDER BY number_of_movies DESC, average_movie_length;
SELECT ct.kind AS company_type, COUNT(DISTINCT cn.id) AS number_of_companies, COUNT(DISTINCT mk.movie_id) AS number_of_movies_with_keywords, AVG(mi_idx.info::numeric) AS average_movie_rating, SUM(CASE WHEN cc.status_id = '4' THEN 1 ELSE 0 END) AS completed_and_verified_casts, COUNT(DISTINCT rt.id) AS number_of_cinematographer_roles, MIN(aka.name) AS example_aka_name FROM company_name AS cn JOIN company_type AS ct ON cn.id = ct.id JOIN movie_keyword AS mk ON cn.id = mk.movie_id JOIN movie_info_idx AS mi_idx ON mk.movie_id = mi_idx.movie_id JOIN complete_cast AS cc ON mk.movie_id = cc.movie_id JOIN role_type AS rt ON rt.role = 'cinematographer' LEFT JOIN aka_name AS aka ON aka.name_pcode_cf = 'D1353' AND aka.md5sum IN ('e6b1b0cc9037b00160a143b03dc5524d', '1d440711fb046c932badfdc8121ce380', '88bcce46f057ed51b9026d05fbdb1ac0') WHERE cc.status_id IN ('3', '4') GROUP BY ct.kind
SELECT t.kind_id, t.production_year, COUNT(DISTINCT t.id) AS total_movies, AVG(CASE WHEN mi_idx.info_type_id = 3 THEN CAST(mi_idx.info AS NUMERIC) END) AS average_rating, SUM(CASE WHEN mi_idx.info_type_id = 2 THEN 1 ELSE 0 END) AS count_color_info, STRING_AGG(DISTINCT k.keyword, ', ') AS associated_keywords FROM title AS t LEFT JOIN movie_info_idx AS mi_idx ON t.id = mi_idx.movie_id LEFT JOIN movie_keyword AS mk ON t.id = mk.movie_id LEFT JOIN keyword AS k ON mk.keyword_id = k.id WHERE t.production_year BETWEEN 2000 AND 2020 AND mi_idx.info_type_id IN (2, 3) AND (mi_idx.movie_id IN ('9006', '13848', '9572', '6738', '9636', '8393') OR t.id = '12979') GROUP BY t.kind_id, t.production_year ORDER BY t.production_year DESC, t.kind_id;
SELECT lt.LINK as link_type, AVG(ml.id) as average_movie_link_id, SUM(ml.linked_movie_id) as total_linked_movie_id, COUNT(ml.movie_id) as total_movies, COUNT(DISTINCT ml.movie_id) as unique_movies_linked, CCT.kind as comp_cast_type_kind, COUNT(CCT.id) as comp_cast_type_count FROM movie_link as ml JOIN link_type as lt ON ml.link_type_id = lt.id JOIN comp_cast_type as CCT ON CCT.id = ml.link_type_id GROUP BY lt.LINK, CCT.kind ORDER BY total_movies DESC;
SELECT cn.country_code, COUNT(DISTINCT mi.movie_id) AS movie_count, AVG(pi.info_type_id::numeric) AS avg_person_info_type, COUNT(DISTINCT cn.name) AS company_count, COUNT(DISTINCT chn.name) AS character_name_count FROM movie_info mi JOIN movie_info_idx mii ON mi.movie_id = mii.movie_id AND mi.info_type_id = mii.info_type_id JOIN company_name cn ON mi.movie_id = cn.imdb_id JOIN person_info pi ON mi.movie_id = pi.person_id JOIN char_name chn ON mi.movie_id = chn.imdb_id WHERE cn.country_code IN ('[np]', '[kr]', '[cn]', '[tw]', '[sa]', '[my]') AND pi.note IN ('info@aeberhard.com', 'Chris Hendren', 'Quincy Johnson', 'Ian Adema', 'isabelleadriani@yahoo.it') AND pi.info_type_id IN ('34', '36') AND mi.info IN ('Galician', 'Flemish', 'Persian', 'Czech') GROUP BY cn.country_code ORDER BY movie_count DESC, avg_person_info_type DESC;
SELECT c.name AS company_name, p.gender, COUNT(*) AS number_of_employees, AVG(pi.info_type_id) AS average_info_type_id, SUM(mi.movie_id) AS total_movie_id_sum, COUNT(DISTINCT k.id) AS unique_keyword_count FROM company_name AS c JOIN movie_info_idx AS mi ON c.imdb_id = mi.movie_id JOIN person_info AS pi ON mi.movie_id = pi.person_id JOIN name AS p ON pi.person_id = p.id JOIN keyword AS k ON mi.info LIKE '%' || k.keyword || '%' WHERE c.name_pcode_nf IN ('E2153', 'C5125', 'M2643', 'C2425') AND c.name_pcode_sf IN ('V3252', 'C1212', 'I2416', 'T6215', 'U5163') AND mi.info_type_id IN ('100', '101', '99') GROUP BY c.name, p.gender ORDER BY number_of_employees DESC, average_info_type_id;
SELECT COUNT(DISTINCT t.id) AS number_of_movies, AVG(t.production_year) AS average_production_year, SUM(CASE WHEN mc.company_type_id = 1 THEN 1 ELSE 0 END) AS number_of_type_1_companies, COUNT(DISTINCT mk.keyword_id) AS unique_keywords_used FROM title AS t JOIN movie_companies AS mc ON t.id = mc.movie_id JOIN movie_keyword AS mk ON t.id = mk.movie_id JOIN complete_cast AS cc ON t.id = cc.movie_id JOIN link_type AS lt ON lt.id = cc.status_id WHERE t.production_year BETWEEN 2000 AND 2010 AND mc.company_type_id = 1 AND lt.link = 'similar to' GROUP BY t.kind_id ORDER BY number_of_movies DESC;
SELECT AVG(a.production_year) AS average_production_year, COUNT(DISTINCT l.id) AS total_link_types, COUNT(DISTINCT a.id) AS total_aka_titles, SUM(CASE WHEN a.episode_nr = 23 THEN 1 ELSE 0 END) AS count_episode_23, SUM(CASE WHEN a.episode_nr = 2 THEN 1 ELSE 0 END) AS count_episode_2, SUM(CASE WHEN a.episode_nr = 198 THEN 1 ELSE 0 END) AS count_episode_198 FROM aka_title AS a JOIN comp_cast_type AS c ON a.kind_id = c.id JOIN link_type AS l ON a.id = l.id WHERE a.production_year IS NOT NULL AND a.md5sum IN ('fb468fe5a2dd6cbadb547cbfcc31fe6e', 'aebc712f90712d70c4098b641cecc92c', 'f13da07aa2abf77454bb4a2209a5fc0d') GROUP BY a.kind_id;
SELECT ct.kind AS company_type, COUNT(DISTINCT cn.id) AS number_of_companies, AVG((n.gender = 'M')::int) AS avg_male_actors, AVG((n.gender = 'F')::int) AS avg_female_actors, SUM(CASE WHEN mi_idx.info_type_id = 1 THEN 1 ELSE 0 END) AS number_of_movies, COUNT(DISTINCT pi.person_id) AS number_of_person_info_entries FROM company_type AS ct JOIN company_name AS cn ON cn.country_code NOT LIKE '[pl]' JOIN movie_info_idx AS mi_idx ON mi_idx.movie_id = cn.id LEFT JOIN person_info AS pi ON pi.info_type_id = mi_idx.info_type_id LEFT JOIN name AS n ON n.id = pi.person_id WHERE cn.name LIKE '%Entertainment%' AND ct.id IN (1, 2, 3) AND n.surname_pcode LIKE 'A4%' GROUP BY ct.kind;
SELECT cct.kind AS cast_type, COUNT(DISTINCT mi.movie_id) AS total_movies, COUNT(DISTINCT k.id) AS total_keywords, AVG(COUNT(k.id)) OVER (PARTITION BY cct.kind) AS avg_keywords_per_movie FROM comp_cast_type AS cct JOIN movie_info_idx AS mi ON cct.id = mi.info_type_id JOIN keyword AS k ON mi.movie_id = k.id WHERE cct.kind IN ('complete', 'complete+verified') GROUP BY cct.kind;
SELECT mi_idx.movie_id, COUNT(DISTINCT a.person_id) AS unique_person_count, COUNT(a.id) AS total_aka_names, AVG(COUNT(a.id)) OVER () AS avg_aka_names_per_movie FROM movie_info_idx mi_idx LEFT JOIN aka_name a ON a.person_id = mi_idx.movie_id GROUP BY mi_idx.movie_id ORDER BY unique_person_count DESC, total_aka_names DESC;
SELECT ct.kind AS company_type, AVG(akat.production_year) AS average_production_year, COUNT(DISTINCT mki.movie_id) AS total_movies, COUNT(DISTINCT kw.id) AS total_unique_keywords, SUM(CASE WHEN akat.note LIKE '%(USA)%' THEN 1 ELSE 0 END) AS total_usa_dubbed_versions FROM aka_title akat JOIN movie_keyword mkw ON akat.movie_id = mkw.movie_id JOIN keyword kw ON mkw.keyword_id = kw.id JOIN movie_info_idx mki ON akat.movie_id = mki.movie_id JOIN company_type ct ON mki.info_type_id = ct.id WHERE akat.production_year BETWEEN 2000 AND 2020 GROUP BY ct.kind ORDER BY total_movies DESC;
SELECT kt.kind AS movie_kind, AVG(aka_title.production_year) AS average_production_year, COUNT(DISTINCT aka_title.movie_id) AS total_movies, COUNT(DISTINCT movie_companies.company_id) AS total_companies_involved, SUM(case when aka_title.season_nr is not null then 1 else 0 end) AS total_seasons, COUNT(DISTINCT role_type.id) AS total_unique_roles FROM aka_title JOIN kind_type AS kt ON aka_title.kind_id = kt.id JOIN movie_companies ON aka_title.movie_id = movie_companies.movie_id JOIN company_type AS ct ON movie_companies.company_type_id = ct.id JOIN role_type ON role_type.id = movie_companies.company_id WHERE ct.kind = 'production companies' AND role_type.role IN ('guest', 'writer', 'miscellaneous crew', 'cinematographer') AND aka_title.imdb_index IN ('III', 'IV', 'I', 'II') AND aka_title.production_year BETWEEN 1990 AND 2020 GROUP BY kt.kind ORDER BY total_movies DESC;
SELECT rt.role, COUNT(DISTINCT mc.movie_id) AS number_of_movies, COUNT(DISTINCT mc.company_id) AS number_of_companies, AVG(movie_count_per_company.movie_count) AS average_movies_per_company FROM movie_companies mc JOIN (SELECT company_id, COUNT(movie_id) AS movie_count FROM movie_companies GROUP BY company_id) AS movie_count_per_company ON mc.company_id = movie_count_per_company.company_id JOIN role_type rt ON mc.company_type_id = rt.id GROUP BY rt.role ORDER BY number_of_movies DESC;
