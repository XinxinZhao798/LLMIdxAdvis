SELECT wd.web_class, COUNT(DISTINCT cr.cr_item_sk) AS unique_refunded_items, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_refunded_customers, SUM(cr.cr_return_amt_inc_tax + cr.cr_fee + cr.cr_return_ship_cost) AS total_refund_cost, AVG(cr.cr_return_amt_inc_tax) AS avg_refund_amount_inc_tax, cd.cd_education_status, COUNT(*) AS number_of_returns FROM catalog_returns cr JOIN customer_demographics cd ON cr.cr_refunded_cdemo_sk = cd.cd_demo_sk JOIN web_site wd ON wd.web_country = 'United States' AND wd.web_class IS NOT NULL WHERE EXISTS (SELECT 1 FROM inventory WHERE inv_item_sk = cr.cr_item_sk AND inv_quantity_on_hand > 500) GROUP BY wd.web_class, cd.cd_education_status ORDER BY total_refund_cost DESC, avg_refund_amount_inc_tax DESC, number_of_returns DESC;
SELECT ca.ca_state as customer_state, dd.d_month_seq as month_sequence, dd.d_year as year, SUM(ss.ss_ext_sales_price) as total_sales, AVG(ss.ss_sales_price) as average_sale_price, SUM(ss.ss_ext_discount_amt) as total_discounts, SUM(ss.ss_coupon_amt) as total_coupons, SUM(ss.ss_ext_tax) as total_tax, COUNT(DISTINCT ss.ss_ticket_number) as total_transactions FROM store_sales ss JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk WHERE dd.d_month_seq IS NOT NULL AND ca.ca_state IS NOT NULL GROUP BY customer_state, month_sequence, year ORDER BY customer_state, month_sequence, year;
SELECT ca.ca_state AS state, CASE WHEN cc.cc_call_center_sk IS NOT NULL THEN 'Call Center' WHEN ws.web_site_sk IS NOT NULL THEN 'Web Site' WHEN st.s_store_sk IS NOT NULL THEN 'Store' ELSE 'Unknown' END AS return_channel, COUNT(*) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, AVG(cr.cr_return_tax) AS avg_return_tax, AVG(cr.cr_return_ship_cost) AS avg_return_ship_cost FROM catalog_returns cr LEFT JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk LEFT JOIN web_site ws ON cr.cr_call_center_sk = ws.web_site_sk LEFT JOIN store st ON cr.cr_call_center_sk = st.s_store_sk LEFT JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk GROUP BY ca.ca_state, CASE WHEN cc.cc_call_center_sk IS NOT NULL THEN 'Call Center' WHEN ws.web_site_sk IS NOT NULL THEN 'Web Site' WHEN st.s_store_sk IS NOT NULL THEN 'Store' ELSE 'Unknown' END ORDER BY state, return_channel;
SELECT hd.hd_income_band_sk, count(distinct c.c_customer_sk) AS num_customers, sum(cs.cs_quantity) AS total_sales_quantity, sum(cs.cs_net_paid) AS total_sales_amount, sum(sr.sr_return_quantity) AS total_returned_quantity, sum(sr.sr_return_amt) AS total_returned_amount, sum(cs.cs_net_profit) - sum(coalesce(sr.sr_net_loss, 0)) AS net_profit FROM customer c JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk LEFT JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk WHERE hd.hd_income_band_sk IN ('17', '12', '15', '6', '4', '19') AND (cs.cs_sold_date_sk IS NOT NULL OR sr.sr_returned_date_sk IS NOT NULL) GROUP BY hd.hd_income_band_sk ORDER BY net_profit DESC;
SELECT cp.cp_department, COUNT(*) AS total_pages, AVG(wp.wp_link_count) AS average_link_count, SUM(wp.wp_image_count) AS total_image_count, COUNT(DISTINCT hd.hd_demo_sk) AS unique_households, AVG(hd.hd_vehicle_count) AS average_vehicle_count FROM catalog_page cp JOIN web_page wp ON cp.cp_catalog_page_sk = wp.wp_customer_sk JOIN household_demographics hd ON wp.wp_customer_sk = hd.hd_demo_sk WHERE cp.cp_catalog_number IN (29, 27, 21, 36) AND wp.wp_autogen_flag = 'Y' AND wp.wp_url LIKE 'http://www.foo.com%' GROUP BY cp.cp_department ORDER BY total_pages DESC, average_link_count DESC;
SELECT s.s_state, AVG(cs.cs_net_paid) AS avg_sales, COUNT(sr.sr_ticket_number) AS total_returns, AVG(sr.sr_net_loss) AS avg_net_loss FROM catalog_sales cs JOIN store s ON cs.cs_bill_customer_sk = s.s_store_sk LEFT JOIN store_returns sr ON cs.cs_sold_date_sk = sr.sr_returned_date_sk AND cs.cs_item_sk = sr.sr_item_sk LEFT JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE r.r_reason_desc = 'Did not get it on time' GROUP BY s.s_state ORDER BY avg_sales DESC, total_returns DESC;
SELECT i.i_category, i.i_brand, COUNT(*) AS total_items_sold, SUM(ss.ss_quantity) AS total_quantity_sold_store, SUM(ws.ws_quantity) AS total_quantity_sold_web, AVG(ss.ss_sales_price) AS avg_sales_price_store, AVG(ws.ws_sales_price) AS avg_sales_price_web, SUM(ss.ss_net_paid) AS total_net_paid_store, SUM(ws.ws_net_paid) AS total_net_paid_web, SUM(ss.ss_net_profit) AS total_net_profit_store, SUM(ws.ws_net_profit) AS total_net_profit_web FROM item i LEFT JOIN store_sales ss ON i.i_item_sk = ss.ss_item_sk LEFT JOIN web_sales ws ON i.i_item_sk = ws.ws_item_sk WHERE i.i_rec_start_date <= '2001-08-16' AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date > '2001-08-16') AND EXISTS (SELECT 1 FROM inventory WHERE i.i_item_sk = inv_item_sk AND inv_date_sk = 2450815) GROUP BY i.i_category, i.i_brand ORDER BY total_net_profit_store DESC, total_net_profit_web DESC;
SELECT i_category, i_brand, sum(i_current_price) as total_sales, avg(i_current_price) as avg_price, count(i_item_sk) as item_count, sum(inv_quantity_on_hand) as total_inventory, sum(wr_return_amt_inc_tax) as total_returns, avg(wr_fee) as avg_return_fee, count(distinct wp_web_page_sk) as page_count, sum(case when wp_autogen_flag = 'Y' then 1 else 0 end) as autogen_page_count FROM item LEFT JOIN inventory ON i_item_sk = inv_item_sk LEFT JOIN web_returns ON i_item_sk = wr_item_sk LEFT JOIN web_page ON wr_web_page_sk = wp_web_page_sk LEFT JOIN promotion ON i_item_sk = p_item_sk WHERE i_rec_end_date IS NULL AND (i_category = 'Electronics' OR i_category = 'Home Goods') AND wp_url = 'http://www.foo.com' AND p_discount_active = 'Y' GROUP BY i_category, i_brand ORDER BY total_sales DESC, total_inventory DESC;
SELECT ca_state, ca_county, COUNT(DISTINCT c_customer_sk) AS total_customers, COUNT(DISTINCT ws_order_number) AS total_web_orders, SUM(ws_net_paid) AS total_web_sales, SUM(ws_net_profit) AS total_web_profit, COUNT(DISTINCT sr_ticket_number) AS total_returns, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_quantity) AS average_return_quantity, r_reason_desc FROM customer JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN web_sales ON ws_bill_customer_sk = c_customer_sk LEFT JOIN store_returns ON sr_customer_sk = c_customer_sk AND sr_reason_sk IS NOT NULL LEFT JOIN reason ON sr_reason_sk = r_reason_sk JOIN time_dim ON ws_sold_time_sk = t_time_sk JOIN warehouse ON ws_warehouse_sk = w_warehouse_sk WHERE ca_state IN ('CA', 'TX') AND ((t_hour = '1' AND t_am_pm = 'AM') OR (t_hour = '0')) AND (w_street_number IN ('534', '368', '651', '600')) AND (r_reason_id = 'AAAAAAAANAAAAAAA' OR r_reason_id IS NULL) GROUP BY ca_state, ca_county, r_reason_desc ORDER BY total_web_sales DESC, ca_state, ca_county;
SELECT cc.cc_company_name, r.r_reason_desc, COUNT(wr.wr_returned_date_sk) AS total_returns, SUM(wr.wr_return_amt_inc_tax) AS total_refund_amount, AVG(wr.wr_return_amt_inc_tax) AS average_refund_amount FROM web_returns wr JOIN call_center cc ON wr.wr_refunded_customer_sk::text LIKE '%' || cc.cc_call_center_id JOIN reason r ON wr.wr_reason_sk = r.r_reason_sk JOIN household_demographics hd ON wr.wr_refunded_hdemo_sk = hd.hd_demo_sk WHERE cc.cc_company_name IN ('able', 'pri', 'cally', 'ought') AND hd.hd_dep_count = 0 AND hd.hd_income_band_sk IN (17, 20, 13, 15, 2, 1) AND r.r_reason_desc IN ('Not working any more', 'duplicate purchase', 'reason 28', 'Stopped working', 'reason 24', 'reason 27') GROUP BY cc.cc_company_name, r.r_reason_desc ORDER BY total_refund_amount DESC;
SELECT i.i_item_id, i.i_category, w.w_state, w.w_city, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amt_inc_tax) AS avg_return_amount_incl_tax, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_incl_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_return_ship_cost) AS total_shipping_cost, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk GROUP BY ROLLUP (i.i_item_id, i.i_category, w.w_state, w.w_city) ORDER BY w.w_state, w.w_city, i.i_category, i.i_item_id;
SELECT ca_state, ca_city, ca_country, EXTRACT(YEAR FROM TO_TIMESTAMP(t_time)) AS sale_year, COUNT(DISTINCT w_warehouse_sk) AS number_of_warehouses, SUM(w_warehouse_sq_ft) AS total_warehouse_area, AVG(w_warehouse_sq_ft) AS avg_warehouse_area, COUNT(DISTINCT ca_address_sk) AS number_of_customers, AVG(ca_gmt_offset) AS avg_gmt_offset FROM customer_address JOIN warehouse ON customer_address.ca_state = warehouse.w_state JOIN time_dim ON (warehouse.w_gmt_offset = -5 OR warehouse.w_street_name IN ('Ash Laurel', '6th', 'Wilson Elm', 'View First')) WHERE ca_country = 'United States' AND t_hour BETWEEN 8 AND 17 AND EXTRACT(ISODOW FROM TO_TIMESTAMP(t_time)) < 6 GROUP BY ca_state, ca_city, ca_country, sale_year ORDER BY ca_state, ca_city, sale_year;
SELECT d.d_year, d.d_quarter_name, d.d_moy, d.d_holiday, w.w_city, w.w_gmt_offset, SUM(wp.wp_link_count) AS total_links, AVG(wp.wp_char_count) AS average_char_count, COUNT(DISTINCT wp.wp_customer_sk) AS distinct_customers, COUNT(*) AS page_count FROM web_page wp JOIN date_dim d ON wp.wp_access_date_sk = d.d_date_sk JOIN warehouse w ON w.w_gmt_offset = '-5.00' WHERE d.d_moy IN ('5', '11') AND (d.d_holiday = 'Y' OR d.d_holiday = 'N') AND w.w_city = 'Fairview' AND NOT EXISTS ( SELECT 1 FROM time_dim t WHERE t.t_time_sk = wp.wp_access_date_sk AND t.t_sub_shift = 'night' ) GROUP BY d.d_year, d.d_quarter_name, d.d_moy, d.d_holiday, w.w_city, w.w_gmt_offset ORDER BY d.d_year, d.d_quarter_name, d.d_moy, total_links DESC;
SELECT i.i_category, i.i_brand, COUNT(DISTINCT ss.ss_ticket_number) AS num_sales, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss.ss_net_profit) AS total_net_profit, hd.hd_dep_count AS avg_dep_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, AVG(ib.ib_lower_bound) AS avg_income_lower_bound, AVG(ib.ib_upper_bound) AS avg_income_upper_bound FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk JOIN warehouse w ON ss.ss_addr_sk = w.w_warehouse_sk WHERE i.i_rec_start_date <= '2023-01-01' AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date > '2023-01-01') AND t.t_second IN ('17', '49', '15', '2', '36') AND c.c_last_name IN ('Wing', 'Lemus', 'Guerra') AND w.w_warehouse_sq_ft IN (621234, 294242, 977787, 138504) GROUP BY i.i_category, i.i_brand, hd.hd_dep_count ORDER BY total_net_profit DESC, total_net_paid DESC, i.i_category, i.i_brand;
SELECT dd.d_year AS sales_year, dd.d_quarter_name AS sales_quarter, ca.ca_state AS customer_state, cd.cd_education_status AS education_status, cd.cd_gender AS gender, COUNT(DISTINCT c.c_customer_sk) AS num_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS num_preferred_customers FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN date_dim dd ON c.c_first_sales_date_sk = dd.d_date_sk WHERE dd.d_quarter_seq IN (SELECT MAX(d_quarter_seq) FROM date_dim WHERE d_current_quarter = 'Y') GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state, cd.cd_education_status, cd.cd_gender ORDER BY num_customers DESC, avg_purchase_estimate DESC;
SELECT s_store_name, i_category, cd_gender, cd_education_status, r_reason_desc, COUNT(DISTINCT wr_item_sk) AS unique_items_returned, SUM(wr_return_quantity) AS total_return_quantity, AVG(wr_return_amt) AS avg_return_amount, AVG(i_wholesale_cost) AS avg_wholesale_cost, COUNT(wr_returned_date_sk) AS total_returns FROM web_returns JOIN item ON wr_item_sk = i_item_sk JOIN store ON s_store_sk = wr_returning_addr_sk JOIN customer_demographics ON cd_demo_sk = wr_returning_cdemo_sk JOIN reason ON r_reason_sk = wr_reason_sk JOIN date_dim ON wr_returned_date_sk = d_date_sk JOIN time_dim ON wr_returned_time_sk = t_time_sk WHERE d_year = 2022 AND s_state = 'CA' AND wr_return_amt > 0 AND i_current_price > i_wholesale_cost AND t_shift = 'third' GROUP BY s_store_name, i_category, cd_gender, cd_education_status, r_reason_desc ORDER BY total_return_quantity DESC, avg_return_amount DESC LIMIT 100;
SELECT ca_state, ca_city, COUNT(DISTINCT c_customer_sk) AS number_of_customers, SUM(ss_net_paid) AS total_sales_amount, AVG(ss_quantity) AS average_quantity_sold, SUM(ss_net_profit) AS total_profit, MAX(ib_upper_bound) AS max_income_band_upper_bound, AVG(wr_return_amt) AS average_return_amount FROM customer_address JOIN customer ON c_current_addr_sk = ca_address_sk JOIN store_sales ON ss_customer_sk = c_customer_sk JOIN income_band ON ib_income_band_sk = (SELECT hd_income_band_sk FROM household_demographics WHERE hd_demo_sk = c_current_hdemo_sk) LEFT OUTER JOIN web_returns ON wr_order_number = ss_ticket_number AND wr_item_sk = ss_item_sk WHERE ca_street_type IN ('Dr.', 'Blvd', 'Ln', 'Cir.', 'Boulevard', 'Wy') AND ss_net_paid > 1000 AND ss_quantity < 50 GROUP BY ca_state, ca_city ORDER BY total_sales_amount DESC, average_quantity_sold DESC LIMIT 10;
SELECT s_state, cd_gender, cd_marital_status, cd_education_status, hd_buy_potential, AVG(cd_purchase_estimate) AS avg_purchase_estimate, SUM(s_number_employees) AS total_employees, COUNT(DISTINCT s_store_sk) AS num_stores, MIN(s_floor_space) AS min_floor_space, MAX(s_floor_space) AS max_floor_space, AVG(s_floor_space) AS avg_floor_space, COUNT(DISTINCT hd_demo_sk) AS num_households, SUM(hd_vehicle_count) AS total_vehicles, AVG(hd_vehicle_count) AS avg_vehicles_per_household FROM store JOIN household_demographics ON (s_store_sk = hd_demo_sk) JOIN customer_demographics ON (hd_demo_sk = cd_demo_sk) WHERE s_country = 'United States' AND s_state IN ('CA', 'TX', 'FL') AND cd_dep_employed_count = 0 AND hd_buy_potential LIKE 'Unknown%' AND cd_education_status IN ('College', '4 yr Degree', 'Graduate Degree') AND s_market_id IS NOT NULL GROUP BY s_state, cd_gender, cd_marital_status, cd_education_status, hd_buy_potential ORDER BY s_state, avg_purchase_estimate DESC, total_employees DESC LIMIT 50;
SELECT i.i_category, ib.ib_income_band_sk, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_paid_inc_ship_tax) AS total_sales, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cr.cr_return_amount) AS total_returns, COUNT(DISTINCT cr.cr_order_number) AS total_return_orders FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN income_band ib ON c.c_current_cdemo_sk = ib.ib_income_band_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number WHERE cs.cs_sold_date_sk IS NOT NULL AND ( ib.ib_lower_bound IN (110001, 190001, 30001) OR ib.ib_income_band_sk IN (1, 9, 3) ) GROUP BY i.i_category, ib.ib_income_band_sk ORDER BY total_sales DESC, total_returns DESC;
SELECT c.c_first_name, c.c_last_name, cs_total_sales, ws_total_sales, (cs_total_net_sales + ws_total_net_sales) AS total_combined_net_sales FROM customer c JOIN (SELECT cs_bill_customer_sk, SUM(cs_net_paid) AS cs_total_sales FROM catalog_sales GROUP BY cs_bill_customer_sk) cs_sales ON c.c_customer_sk = cs_sales.cs_bill_customer_sk JOIN (SELECT ws_bill_customer_sk, SUM(ws_net_paid) AS ws_total_sales FROM web_sales GROUP BY ws_bill_customer_sk) ws_sales ON c.c_customer_sk = ws_sales.ws_bill_customer_sk JOIN (SELECT cs_bill_customer_sk, SUM(cs_net_paid_inc_ship_tax) AS cs_total_net_sales FROM catalog_sales GROUP BY cs_bill_customer_sk) total_cs_sales ON c.c_customer_sk = total_cs_sales.cs_bill_customer_sk JOIN (SELECT ws_bill_customer_sk, SUM(ws_net_paid_inc_ship_tax) AS ws_total_net_sales FROM web_sales GROUP BY ws_bill_customer_sk) total_ws_sales ON c.c_customer_sk = total_ws_sales.ws_bill_customer_sk WHERE c.c_birth_country IN ('BRAZIL', 'ROMANIA', 'ICELAND') AND EXISTS (SELECT 1 FROM call_center WHERE cc_call_center_sk = cs_sales.cs_bill_customer_sk AND cc_company_name LIKE 'pri%') AND EXISTS (SELECT 1 FROM web_site WHERE web_site_sk = ws_sales.ws_bill_customer_sk AND web_street_type IN ('Road', 'Way', 'Dr.', 'Cir.', 'Parkway') AND web_street_number IN ('292', '409', '887', '805')) ORDER BY total_combined_net_sales DESC LIMIT 100;
SELECT cd.cd_gender, ib.ib_lower_bound AS income_lower_bound, ib.ib_upper_bound AS income_upper_bound, sm.sm_type AS shipping_type, COUNT(sr.sr_return_amt) AS total_returns, SUM(sr.sr_return_amt) AS total_value_of_returns, AVG(sr.sr_return_amt) AS average_return_value, SUM(sr.sr_return_quantity) AS total_quantity_returned FROM store_returns sr JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound JOIN ship_mode sm ON sm.sm_ship_mode_sk = sr.sr_item_sk WHERE sm.sm_type IN ('OVERNIGHT') AND cd.cd_gender IN ('M', 'F') GROUP BY cd.cd_gender, income_lower_bound, income_upper_bound, shipping_type ORDER BY total_value_of_returns DESC, total_returns DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(cr.cr_order_number) AS total_returns, AVG(cr.cr_return_amount) AS avg_refund_amount, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN customer_demographics cd ON cr.cr_refunded_cdemo_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk AND w.w_street_name IN ('Wilson Elm', 'Ash Laurel', '6th') JOIN time_dim t ON cr.cr_returned_time_sk = t.t_time_sk WHERE t.t_hour BETWEEN 9 AND 17 AND w.w_suite_number IN ('Suite 80', 'Suite 470', 'Suite 0') AND ib.ib_upper_bound IN (130000, 120000, 40000, 200000) GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_net_loss DESC;
SELECT dd.d_year, dd.d_quarter_name, cc.cc_division_name, SUM(wp.wp_char_count) AS total_char_count, AVG(wp.wp_link_count) AS average_link_count, COUNT(*) AS num_web_pages_accessed, COUNT(DISTINCT cc.cc_call_center_sk) AS num_call_centers_involved, COUNT(DISTINCT r.r_reason_sk) AS num_distinct_reasons FROM date_dim AS dd JOIN web_page AS wp ON dd.d_date_sk = wp.wp_access_date_sk JOIN call_center AS cc ON wp.wp_customer_sk = cc.cc_call_center_sk LEFT JOIN reason AS r ON r.r_reason_sk = wp.wp_customer_sk WHERE dd.d_year = 2022 AND dd.d_quarter_name IN ('Q1', 'Q2', 'Q3', 'Q4') AND r.r_reason_sk IN ('15', '31', '3', '32', '5') GROUP BY dd.d_year, dd.d_quarter_name, cc.cc_division_name ORDER BY dd.d_year, dd.d_quarter_name, cc.cc_division_name;
SELECT d_year, d_quarter_name, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_profit) AS total_profit, AVG(cs_net_profit) AS avg_profit_per_order, SUM(cs_quantity) AS total_items_sold, SUM(cr_net_loss) AS total_returns_loss, COUNT(DISTINCT cr_order_number) AS total_return_orders, AVG(cr_return_amount) AS avg_return_amount, COUNT(DISTINCT inv_item_sk) AS distinct_items_in_inventory, AVG(inv_quantity_on_hand) AS avg_inventory_quantity FROM date_dim JOIN catalog_sales ON (cs_sold_date_sk = date_dim.d_date_sk) JOIN catalog_returns ON (cr_returned_date_sk = date_dim.d_date_sk) JOIN inventory ON (inv_date_sk = date_dim.d_date_sk) JOIN store ON (store.s_rec_start_date <= date_dim.d_date AND (store.s_rec_end_date IS NULL OR store.s_rec_end_date >= date_dim.d_date)) WHERE d_year = 2001 AND cs_item_sk = 24 AND cr_refunded_customer_sk IN ('87999', '35845', '11067') AND inv_quantity_on_hand IN (801, 112, 394, 739, 17, 940) AND cr_net_loss IN (30.69, 55.49) AND inv_date_sk = 2450815 AND store.s_company_id = 1 AND store.s_suite_number IN ('Suite 410', 'Suite 80', 'Suite T', 'Suite 190') GROUP BY d_year, d_quarter_name ORDER BY d_year, d_quarter_name;
SELECT r.r_reason_desc, COUNT(sr.sr_ticket_number) AS return_count, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_return_amt_inc_tax) AS total_amount_incl_tax, SUM(sr.sr_fee) AS total_fees, AVG(wp.wp_link_count) AS average_link_count, AVG(wp.wp_image_count) AS average_image_count FROM store_returns sr JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk LEFT JOIN web_page wp ON c.c_customer_sk = wp.wp_customer_sk WHERE sr.sr_return_quantity > 1 AND c.c_birth_country IN ('YEMEN', 'POLAND', 'SWITZERLAND') AND wp.wp_image_count IN (2, 4, 5) GROUP BY r.r_reason_desc ORDER BY total_returned_quantity DESC, average_return_amount DESC;
SELECT ws.ws_web_site_sk, ws_site.web_site_id, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS avg_sales_price, SUM(ws.ws_net_profit) AS total_net_profit, cc.cc_call_center_id, cc.cc_name, AVG(cc.cc_employees) AS avg_cc_employees, cd.cd_marital_status, COUNT(DISTINCT cd.cd_demo_sk) AS total_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, hd.hd_buy_potential, AVG(hd.hd_income_band_sk) AS avg_income_band FROM web_sales ws JOIN web_site ws_site ON ws.ws_web_site_sk = ws_site.web_site_sk JOIN call_center cc ON ws_site.web_mkt_id = cc.cc_mkt_id JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk WHERE ws.ws_sales_price > 0 AND ws.ws_sold_date_sk BETWEEN 2451569 AND 2452306 AND ws.ws_web_site_sk IN (4, 18, 20, 29, 27) AND cc.cc_call_center_sk IN (1, 4, 2) AND cd.cd_purchase_estimate > 5000 AND cd.cd_marital_status IN ('D', 'U', 'S', 'M', 'W') AND hd.hd_buy_potential IS NOT NULL GROUP BY ws.ws_web_site_sk, ws_site.web_site_id, cc.cc_call_center_id, cc.cc_name, cd.cd_marital_status, hd.hd_buy_potential ORDER BY total_net_profit DESC, avg_sales_price DESC LIMIT 100;
