SELECT s.s_store_name, s.s_store_id, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_net_sales, SUM(ss.ss_net_paid_inc_tax) AS total_net_sales_including_tax, SUM(cr.cr_return_quantity) AS total_returned_quantity, SUM(cr.cr_return_amount) AS total_return_amount, r.r_reason_desc AS return_reason, AVG(ss.ss_net_profit) AS average_net_profit_per_sale, COUNT(DISTINCT cr.cr_order_number) AS total_return_transactions, SUM(cr.cr_net_loss) AS total_net_loss_from_returns FROM store s LEFT JOIN store_sales ss ON s.s_store_sk = ss.ss_store_sk LEFT JOIN catalog_returns cr ON ss.ss_item_sk = cr.cr_item_sk AND ss.ss_ticket_number = cr.cr_order_number LEFT JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk WHERE s.s_gmt_offset = '-5.00' AND s.s_division_id = 1 AND ( r.r_reason_desc = 'its is a boy' OR r.r_reason_desc = 'reason 25' OR r.r_reason_desc = 'Found a better extended warranty in a store' OR r.r_reason_desc = 'reason 27' ) GROUP BY s.s_store_name, s.s_store_id, r.r_reason_desc ORDER BY s.s_store_name, s.s_store_id, r.r_reason_desc;
SELECT age_group, hd_buy_potential, AVG(ss_net_paid) AS avg_sales, SUM(ss_quantity) AS total_quantity_sold, COUNT(DISTINCT ss_customer_sk) AS unique_customers FROM customer c JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk CROSS JOIN (SELECT CASE WHEN c_birth_year BETWEEN 1946 AND 1964 THEN 'Baby Boomers' WHEN c_birth_year BETWEEN 1965 AND 1980 THEN 'Generation X' WHEN c_birth_year BETWEEN 1981 AND 1996 THEN 'Millennials' WHEN c_birth_year >= 1997 THEN 'Generation Z' ELSE 'Unknown' END AS age_group, c_customer_sk FROM customer) AS cust_age_group WHERE cust_age_group.c_customer_sk = c.c_customer_sk GROUP BY age_group, hd_buy_potential ORDER BY age_group, hd_buy_potential;
SELECT ca.ca_state as customer_state, dd.d_month_seq as month_sequence, dd.d_year as year, SUM(ss.ss_ext_sales_price) as total_sales, AVG(ss.ss_sales_price) as average_sale_price, SUM(ss.ss_ext_discount_amt) as total_discounts, SUM(ss.ss_coupon_amt) as total_coupons, SUM(ss.ss_ext_tax) as total_tax, COUNT(DISTINCT ss.ss_ticket_number) as total_transactions FROM store_sales ss JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk WHERE dd.d_month_seq IS NOT NULL AND ca.ca_state IS NOT NULL GROUP BY customer_state, month_sequence, year ORDER BY customer_state, month_sequence, year;
SELECT cp_department, SUM(ws_quantity) AS total_quantity_sold, AVG(ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws_bill_customer_sk) AS unique_customers, COUNT(DISTINCT ws_web_page_sk) AS page_views, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_profit) AS total_net_profit FROM web_sales JOIN catalog_page ON web_sales.ws_web_page_sk = catalog_page.cp_catalog_page_sk WHERE catalog_page.cp_catalog_number IN (20, 25, 19) AND catalog_page.cp_department = 'DEPARTMENT' GROUP BY cp_department ORDER BY total_net_profit DESC;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, hd.hd_buy_potential, hd.hd_income_band_sk, COUNT(DISTINCT cr.cr_order_number) AS total_returned_orders, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, AVG(cr.cr_return_tax) AS avg_return_tax, AVG(cr.cr_net_loss) AS avg_net_loss FROM catalog_returns cr JOIN customer_demographics cd ON cr.cr_returning_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk WHERE cr.cr_call_center_sk IN (1, 2, 4) AND hd.hd_buy_potential IN ('0-500', '501-1000', '>10000') AND hd.hd_income_band_sk = 20 AND cd.cd_dep_employed_count = 0 AND cd.cd_gender IN ('M', 'F') GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, hd.hd_buy_potential, hd.hd_income_band_sk ORDER BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, hd.hd_buy_potential, hd.hd_income_band_sk;
SELECT cd.cd_education_status, cd.cd_marital_status, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, AVG(CASE WHEN cd.cd_credit_rating LIKE 'Good%' THEN 1 WHEN cd.cd_credit_rating LIKE 'Fair%' THEN 2 WHEN cd.cd_credit_rating LIKE 'Poor%' THEN 3 ELSE NULL END) AS avg_credit_rating_score, COUNT(DISTINCT wp.wp_web_page_sk) AS web_page_count, wp.wp_type, AVG(wp.wp_link_count) AS avg_link_count, AVG(wp.wp_image_count) AS avg_image_count FROM customer_demographics cd LEFT JOIN web_page wp ON cd.cd_demo_sk = wp.wp_customer_sk LEFT JOIN time_dim td ON wp.wp_access_date_sk = td.t_time_sk WHERE cd.cd_marital_status IN ('D', 'U', 'S', 'M', 'W') AND td.t_hour > 18 AND (td.t_am_pm = 'PM') GROUP BY cd.cd_education_status, cd.cd_marital_status, wp.wp_type ORDER BY cd.cd_education_status, cd.cd_marital_status, web_page_count DESC;
SELECT ca_state, ca_city, ca_country, EXTRACT(YEAR FROM TO_TIMESTAMP(t_time)) AS sale_year, COUNT(DISTINCT w_warehouse_sk) AS number_of_warehouses, SUM(w_warehouse_sq_ft) AS total_warehouse_area, AVG(w_warehouse_sq_ft) AS avg_warehouse_area, COUNT(DISTINCT ca_address_sk) AS number_of_customers, AVG(ca_gmt_offset) AS avg_gmt_offset FROM customer_address JOIN warehouse ON customer_address.ca_state = warehouse.w_state JOIN time_dim ON (warehouse.w_gmt_offset = -5 OR warehouse.w_street_name IN ('Ash Laurel', '6th', 'Wilson Elm', 'View First')) WHERE ca_country = 'United States' AND t_hour BETWEEN 8 AND 17 AND EXTRACT(ISODOW FROM TO_TIMESTAMP(t_time)) < 6 GROUP BY ca_state, ca_city, ca_country, sale_year ORDER BY ca_state, ca_city, sale_year;
SELECT i.i_category, i.i_color, COUNT(DISTINCT cr.cr_item_sk) AS num_returns, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_return_quantity) AS total_returned_quantity, cc.cc_name AS call_center, w.w_warehouse_name AS warehouse, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages, COUNT(DISTINCT wp.wp_web_page_sk) AS num_web_pages FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN web_page wp ON cp.cp_start_date_sk = wp.wp_creation_date_sk WHERE i.i_color IN ('linen', 'midnight', 'powder', 'tan') AND cp.cp_catalog_number IN (46, 18, 2) AND w.w_gmt_offset = -5.00 GROUP BY i.i_category, i.i_color, cc.cc_name, w.w_warehouse_name ORDER BY total_return_amount DESC;
SELECT item.i_product_name, promotion.p_promo_name, call_center.cc_name, COUNT(DISTINCT catalog_sales.cs_item_sk) AS item_sold_count, SUM(catalog_sales.cs_net_paid) AS total_sales, AVG(catalog_sales.cs_ext_discount_amt / NULLIF(catalog_sales.cs_quantity, 0)) AS average_discount_per_item, SUM(catalog_sales.cs_quantity) AS total_units_sold, promotion.p_channel_dmail, promotion.p_channel_email, promotion.p_channel_catalog, promotion.p_channel_tv, promotion.p_channel_radio, promotion.p_channel_press, promotion.p_channel_event, promotion.p_channel_demo FROM catalog_sales INNER JOIN item ON catalog_sales.cs_item_sk = item.i_item_sk INNER JOIN promotion ON catalog_sales.cs_promo_sk = promotion.p_promo_sk INNER JOIN call_center ON catalog_sales.cs_call_center_sk = call_center.cc_call_center_sk WHERE item.i_product_name IN ('barationbarought', 'ableoughtoughtese', 'ablebarn stpri', 'prioughteingable', 'priationanti') AND promotion.p_promo_sk IN (169, 149, 296, 99) AND call_center.cc_call_center_id IN ('AAAAAAAAEAAAAAAA', 'AAAAAAAABAAAAAAA', 'AAAAAAAACAAAAAAA') AND catalog_sales.cs_sold_date_sk IS NOT NULL AND catalog_sales.cs_sold_date_sk BETWEEN 20000101 AND 20001231 GROUP BY item.i_product_name, promotion.p_promo_name, call_center.cc_name, promotion.p_channel_dmail, promotion.p_channel_email, promotion.p_channel_catalog, promotion.p_channel_tv, promotion.p_channel_radio, promotion.p_channel_press, promotion.p_channel_event, promotion.p_channel_demo ORDER BY total_sales DESC, item_sold_count DESC, average_discount_per_item DESC;
SELECT c.c_salutation, sm.sm_type AS shipping_type, AVG(cs.cs_net_paid) AS average_net_paid, SUM(cs.cs_quantity) AS total_quantity_sold, COUNT(DISTINCT cs.cs_order_number) AS total_orders, ca.ca_state AS customer_state, ca.ca_country AS customer_country, COUNT(DISTINCT ca.ca_city) AS number_of_cities_sold_to FROM catalog_sales cs JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk WHERE cs.cs_ext_sales_price > 2500 AND sm.sm_ship_mode_id = 'AAAAAAAAGAAAAAAA' AND c.c_salutation = 'Mr.' GROUP BY c.c_salutation, sm.sm_type, ca.ca_state, ca.ca_country ORDER BY average_net_paid DESC, total_quantity_sold DESC;
SELECT cd.cd_education_status, ib.ib_income_band_sk, COUNT(DISTINCT ws.ws_order_number) AS number_of_orders, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_sales_price) AS average_sales_price FROM web_sales ws JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE cd.cd_purchase_estimate IS NOT NULL AND ib.ib_upper_bound <= 110000 AND ib.ib_income_band_sk IN (4, 1, 14, 13, 8) GROUP BY ROLLUP (cd.cd_education_status, ib.ib_income_band_sk) ORDER BY total_net_profit DESC, cd.cd_education_status, ib.ib_income_band_sk;
SELECT p.p_promo_id, p.p_promo_name, COUNT(DISTINCT cs.cs_item_sk) AS number_of_items_sold, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_selling_price, SUM(cs.cs_ext_sales_price) AS total_sales_amount, SUM(cs.cs_ext_discount_amt) AS total_discount_amount, AVG((cs.cs_ext_discount_amt / cs.cs_ext_list_price) * 100) AS average_discount_percentage, SUM(cs.cs_net_profit) AS total_net_profit, AVG(inv.inv_quantity_on_hand) AS average_inventory_quantity_on_hand FROM catalog_sales cs JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk LEFT JOIN inventory inv ON cs.cs_item_sk = inv.inv_item_sk AND cs.cs_sold_date_sk = inv.inv_date_sk WHERE cs.cs_ext_list_price IN (8856.28, 4863.95, 651.00, 4727.68) GROUP BY p.p_promo_id, p.p_promo_name ORDER BY total_sales_amount DESC;
SELECT wp.wp_type, sm.sm_type, COUNT(DISTINCT wr.wr_refunded_customer_sk) AS unique_customers, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amt_inc_tax, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_net_loss) AS total_net_loss FROM web_returns wr JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk JOIN ship_mode sm ON wr.wr_returning_addr_sk = sm.sm_ship_mode_sk WHERE wp.wp_type IN ('feedback', 'order', 'general') AND sm.sm_type = 'TWO DAY' AND wr.wr_returning_addr_sk IN ('28100', '12237', '16942', '45981', '17051', '17924') AND wr.wr_refunded_customer_sk IN ('91486', '46332', '17456', '11868', '724', '87845') GROUP BY wp.wp_type, sm.sm_type;
SELECT ws_order_number, COUNT(DISTINCT ws_item_sk) AS item_count, SUM(ws_quantity) AS total_quantity, AVG(ws_sales_price) AS avg_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ws_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(ws_net_profit) AS total_net_profit, MIN(ws_ext_ship_cost) AS min_shipping_cost, MAX(ws_ext_ship_cost) AS max_shipping_cost FROM web_sales JOIN catalog_sales ON ws_item_sk = cs_item_sk AND ws_order_number = cs_order_number JOIN store_sales ON ws_item_sk = ss_item_sk AND ws_order_number = ss_ticket_number JOIN web_page ON ws_web_page_sk = wp_web_page_sk JOIN inventory ON ws_item_sk = inv_item_sk WHERE ws_sales_price BETWEEN 100 AND 200 AND cs_sales_price BETWEEN 100 AND 200 AND ss_sales_price BETWEEN 100 AND 200 AND ws_ext_ship_cost BETWEEN 10 AND 1360 AND wp_type = 'Product Review' GROUP BY ws_order_number HAVING COUNT(DISTINCT ws_item_sk) > 1 ORDER BY total_net_profit DESC;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, COUNT(*) AS total_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, AVG(ss.ss_sales_price) AS avg_sales_price, s.s_state, s.s_city, t.t_shift FROM customer_demographics cd JOIN store_sales ss ON cd.cd_demo_sk = ss.ss_cdemo_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE cd.cd_dep_count IN (1, 2) AND s.s_market_id IS NOT NULL GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, s.s_state, s.s_city, t.t_shift ORDER BY total_net_paid DESC, s.s_state, s.s_city LIMIT 100;
SELECT dd.d_year, dd.d_quarter_name, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, SUM(sr.sr_return_amt_inc_tax) AS total_store_return_value, AVG(sr.sr_return_amt_inc_tax) AS avg_store_return_value, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_returns, SUM(cr.cr_return_amt_inc_tax) AS total_catalog_return_value, AVG(cr.cr_return_amt_inc_tax) AS avg_catalog_return_value, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(inv.inv_quantity_on_hand) AS avg_inventory, COUNT(DISTINCT p.p_promo_sk) AS total_promotions, SUM(p.p_cost) AS total_promotion_cost, AVG(p.p_cost) AS avg_promotion_cost FROM date_dim dd LEFT JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk LEFT JOIN catalog_returns cr ON dd.d_date_sk = cr.cr_returned_date_sk LEFT JOIN inventory inv ON dd.d_date_sk = inv.inv_date_sk LEFT JOIN promotion p ON dd.d_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk WHERE dd.d_current_quarter = 'N' AND dd.d_dow IN ('2', '1', '3') AND dd.d_week_seq IN ('357', '270', '599') AND dd.d_day_name IN ('Friday', 'Wednesday', 'Thursday') AND cr.cr_refunded_cash IN ('41.98', '2827.18', '326.60') AND cr.cr_return_tax IN ('78.35', '1.90', '17.50') AND cr.cr_reason_sk IN ('10', '6', '34') AND inv.inv_date_sk = '2450815' AND inv.inv_quantity_on_hand IN ('527', '833', '192') AND sr.sr_store_credit IN ('65.83', '69.57', '46.64') AND sr.sr_return_amt_inc_tax IN ('1345.99', '37.28', '546.00') AND sr.sr_hdemo_sk IN ('5161', '6269', '797') AND p.p_channel_radio = 'N' AND p.p_channel_press = 'N' GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT dd.d_year, dd.d_quarter_name, w.w_state, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(inv.inv_quantity_on_hand) AS avg_inventory, COUNT(DISTINCT inv.inv_warehouse_sk) AS number_of_warehouses, COUNT(DISTINCT web.web_site_sk) AS number_of_websites, SUM(cc.cc_employees) AS total_employees, AVG(cc.cc_tax_percentage) AS avg_tax_percentage FROM inventory inv JOIN date_dim dd ON inv.inv_date_sk = dd.d_date_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN web_site web ON web.web_state = w.w_state JOIN call_center cc ON cc.cc_state = w.w_state WHERE inv.inv_quantity_on_hand IN (232, 844, 624) AND dd.d_year = 2023 AND web.web_open_date_sk <= dd.d_date_sk AND (web.web_close_date_sk IS NULL OR web.web_close_date_sk >= dd.d_date_sk) AND cc.cc_open_date_sk <= dd.d_date_sk AND (cc.cc_closed_date_sk IS NULL OR cc.cc_closed_date_sk >= dd.d_date_sk) GROUP BY dd.d_year, dd.d_quarter_name, w.w_state ORDER BY dd.d_year, dd.d_quarter_name, w.w_state;
SELECT i.i_category AS category, i.i_brand AS brand, SUM(cs.cs_sales_price) AS total_sales, AVG(cs.cs_sales_price) AS avg_sales_price, COUNT(cs.cs_order_number) AS total_orders, AVG(hd.hd_dep_count) AS avg_dependency_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk WHERE w.w_city = 'Fairview' AND w.w_zip = '35709' AND hd.hd_demo_sk IN ('3429', '3835', '1080', '381', '3354') AND cs.cs_sold_time_sk = '67862' GROUP BY i.i_category, i.i_brand ORDER BY total_sales DESC;
SELECT r.r_reason_desc AS reason_for_return, COUNT(*) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, cd.cd_gender AS customer_gender, cd.cd_education_status AS customer_education, w.w_warehouse_name AS warehouse_name, w.w_city AS warehouse_city, w.w_state AS warehouse_state FROM catalog_returns cr JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN customer_demographics cd ON cr.cr_returning_cdemo_sk = cd.cd_demo_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk GROUP BY r.r_reason_desc, cd.cd_gender, cd.cd_education_status, w.w_warehouse_name, w.w_city, w.w_state ORDER BY total_returns DESC, total_return_amount DESC LIMIT 100;
SELECT sm.sm_type, sm.sm_carrier, w.web_site_sk, w.web_mkt_class, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, SUM(ws.ws_net_paid) AS total_net_paid, AVG(ws.ws_net_paid_inc_ship_tax) AS avg_net_paid_inc_ship_tax, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN web_site w ON ws.ws_web_site_sk = w.web_site_sk WHERE ws.ws_net_paid BETWEEN 100 AND 3000 AND sm.sm_code IN ('SEA', 'SURFACE') AND w.web_street_type = 'Road' AND w.web_mkt_class LIKE 'Broad, new groups show car%' GROUP BY ROLLUP(sm.sm_type, sm.sm_carrier, w.web_site_sk, w.web_mkt_class) ORDER BY total_net_profit DESC, total_quantity DESC, avg_net_paid_inc_ship_tax DESC;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_state, ca.ca_city, COUNT(DISTINCT sr.sr_customer_sk) AS number_of_returning_customers, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(sr.sr_fee) AS total_fees_collected, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr INNER JOIN date_dim dd ON sr.sr_returned_date_sk = dd.d_date_sk INNER JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk INNER JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk WHERE dd.d_year = 2022 AND hd.hd_buy_potential = '>10000' AND dd.d_quarter_seq = 52 GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state, ca.ca_city ORDER BY total_net_loss DESC, avg_return_amount_inc_tax DESC LIMIT 10;
