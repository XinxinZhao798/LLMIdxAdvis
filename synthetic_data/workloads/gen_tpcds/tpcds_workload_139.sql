SELECT r.r_reason_desc, ca.ca_state, d.d_moy AS month_of_year, COUNT(sr.sr_ticket_number) AS return_count, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_amt) AS avg_return_amount FROM store_returns sr JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk JOIN date_dim d ON sr.sr_returned_date_sk = d.d_date_sk JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk WHERE d.d_current_year = 'Y' GROUP BY r.r_reason_desc, ca.ca_state, month_of_year ORDER BY r.r_reason_desc, ca.ca_state, month_of_year;
SELECT ca_state, ca_city, SUM(ws_quantity) AS total_quantity_sold, AVG(ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws_order_number) AS number_of_orders, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_profit) AS total_net_profit FROM web_sales JOIN customer_address ON web_sales.ws_ship_addr_sk = customer_address.ca_address_sk JOIN inventory ON web_sales.ws_item_sk = inventory.inv_item_sk WHERE web_sales.ws_web_site_sk IN ('16', '29', '24', '23', '3') AND inventory.inv_warehouse_sk IN ('1', '2') AND inventory.inv_item_sk IN ('9766', '15184', '10474', '14785', '12391') GROUP BY ca_state, ca_city ORDER BY total_net_profit DESC, total_quantity_sold DESC LIMIT 100;
SELECT ca.ca_state AS customer_state, EXTRACT(YEAR FROM d_date) AS year_of_return, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, SUM(wr.wr_return_amt) AS total_return_amount, SUM(wr.wr_return_tax) AS total_tax, SUM(wr.wr_return_amt_inc_tax) AS total_amount_including_tax, SUM(wr.wr_return_ship_cost) AS total_shipping_cost, SUM(wr.wr_refunded_cash) AS total_refunded_cash, SUM(wr.wr_reversed_charge) AS total_reversed_charge, SUM(wr.wr_account_credit) AS total_account_credit, SUM(wr.wr_net_loss) AS total_net_loss FROM web_returns wr JOIN customer c ON wr.wr_returning_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN date_dim d ON wr.wr_returned_date_sk = d.d_date_sk WHERE d.d_year >= 2003 GROUP BY ca.ca_state, year_of_return ORDER BY ca.ca_state, year_of_return;
SELECT i.i_category, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_items_sold, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(wr.wr_return_quantity) AS total_items_returned, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk LEFT JOIN web_returns wr ON cs.cs_order_number = wr.wr_order_number AND cs.cs_item_sk = wr.wr_item_sk WHERE cd.cd_purchase_estimate >= 10000 AND cd.cd_dep_employed_count = 0 GROUP BY i.i_category ORDER BY i.i_category;
SELECT i.i_category, i.i_brand, t.t_shift, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantities_sold, AVG(ss.ss_sales_price) AS average_selling_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) - SUM(ss.ss_net_paid) AS total_tax_collected, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE ss.ss_sold_date_sk IN (2451375, 2451147, 2451762, 2451572, 2452439, 2452222) AND ss.ss_sales_price BETWEEN 4.90 AND 95.65 GROUP BY i.i_category, i.i_brand, t.t_shift ORDER BY total_net_profit DESC, i.i_category, i.i_brand, t.t_shift;
SELECT ca_state, ca_country, COUNT(DISTINCT ca_address_sk) AS num_addresses, SUM(p_cost) AS total_promotion_cost, AVG(p_cost) AS avg_promotion_cost, COUNT(DISTINCT p_promo_sk) AS num_promotions, COUNT(DISTINCT web_site_sk) AS num_websites, SUM(web_tax_percentage) AS total_tax_percentage, AVG(web_tax_percentage) AS avg_tax_percentage FROM customer_address JOIN promotion ON ca_address_sk = p_item_sk JOIN web_site ON ca_address_sk = web_mkt_id WHERE ca_state IN ('DE', 'NH', 'MI', 'MA', 'ID', 'NY') AND ca_country = 'United States' AND p_discount_active = '1' AND web_rec_start_date <= CURRENT_DATE AND (web_rec_end_date IS NULL OR web_rec_end_date >= CURRENT_DATE) GROUP BY ca_state, ca_country ORDER BY ca_state, ca_country;
SELECT i_category, sm_type, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_ext_discount_amt) AS total_discount_amount, AVG(hd_dep_count) AS avg_dependent_count, AVG(hd_vehicle_count) AS avg_vehicle_count FROM catalog_sales JOIN item ON cs_item_sk = i_item_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk JOIN household_demographics ON cs_bill_hdemo_sk = hd_demo_sk JOIN income_band ON hd_income_band_sk = ib_income_band_sk WHERE i_category_id IN ('10', '4', '5', '8') AND ib_upper_bound IN (190000, 120000, 160000, 20000) AND cs_net_paid IN (1406.09, 1460.25, 1011.02, 3996.59, 188.33) GROUP BY i_category, sm_type ORDER BY total_net_paid DESC;
SELECT dd.d_year, dd.d_quarter_name, COUNT(sr.sr_ticket_number) AS store_return_count, SUM(sr.sr_return_amt_inc_tax) AS store_total_return_amount_inc_tax, AVG(sr.sr_return_quantity) AS store_avg_return_quantity, SUM(sr.sr_net_loss) AS store_total_net_loss, COUNT(wr.wr_order_number) AS web_return_count, SUM(wr.wr_return_amt_inc_tax) AS web_total_return_amount_inc_tax, AVG(wr.wr_return_quantity) AS web_avg_return_quantity, SUM(wr.wr_net_loss) AS web_total_net_loss FROM date_dim dd LEFT JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk LEFT JOIN web_returns wr ON dd.d_date_sk = wr.wr_returned_date_sk AND wr.wr_returning_addr_sk = '49674' WHERE dd.d_year = 2023 AND dd.d_quarter_seq BETWEEN 202301 AND 202304 GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT d_year, i_category, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, SUM(cs_net_paid) AS total_sales, AVG(cs_net_profit) AS average_profit_per_sale, SUM(cr_return_quantity) AS total_quantity_returned, SUM(cr_return_amount) AS total_returns, AVG(cr_net_loss) AS average_loss_per_return FROM catalog_sales JOIN item ON cs_item_sk = i_item_sk JOIN date_dim ON cs_sold_date_sk = d_date_sk LEFT JOIN catalog_returns ON cs_order_number = cr_order_number AND cs_item_sk = cr_item_sk WHERE (i_class_id IN (7, 14, 9)) AND (cr_reason_sk IN (17, 4, 20, 34, 25) OR cr_reason_sk IS NULL) AND (cs_coupon_amt IN (1589.39, 1893.80, 3358.21) OR cs_coupon_amt IS NULL) AND (catalog_sales.cs_ext_wholesale_cost IN (936.76, 3257.86) OR catalog_sales.cs_ext_wholesale_cost IS NULL) GROUP BY d_year, i_category ORDER BY d_year DESC, i_category;
SELECT s.s_state, AVG(cs.cs_net_paid) AS avg_sales, COUNT(sr.sr_ticket_number) AS total_returns, AVG(sr.sr_net_loss) AS avg_net_loss FROM catalog_sales cs JOIN store s ON cs.cs_bill_customer_sk = s.s_store_sk LEFT JOIN store_returns sr ON cs.cs_sold_date_sk = sr.sr_returned_date_sk AND cs.cs_item_sk = sr.sr_item_sk LEFT JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE r.r_reason_desc = 'Did not get it on time' GROUP BY s.s_state ORDER BY avg_sales DESC, total_returns DESC;
SELECT cp.cp_department, cp.cp_catalog_number, sm.sm_carrier, COUNT(*) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt_inc_tax) AS average_return_amount_inc_tax, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN catalog_page cp ON sr.sr_item_sk = cp.cp_catalog_page_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = sr.sr_item_sk WHERE cp.cp_catalog_page_number IN (20, 88, 103, 108, 56, 9) AND cp.cp_catalog_page_id IN ('AAAAAAAAMECBAAAA', 'AAAAAAAAPENAAAAA', 'AAAAAAAAHKMAAAAA', 'AAAAAAAADBGAAAAA', 'AAAAAAAADEPAAAAA', 'AAAAAAAALIDAAAAA') AND sm.sm_ship_mode_id IN ('AAAAAAAAABAAAAAA', 'AAAAAAAACBAAAAAA', 'AAAAAAAAJAAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAAEBAAAAAA') AND sm.sm_carrier IN ('TBS', 'DIAMOND', 'AIRBORNE', 'GREAT EASTERN', 'LATVIAN') GROUP BY cp.cp_department, cp.cp_catalog_number, sm.sm_carrier;
SELECT c.ca_county, COUNT(distinct ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid_inc_tax) AS total_revenue_inc_tax, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN customer_address c ON ws.ws_bill_addr_sk = c.ca_address_sk JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk JOIN store s ON c.ca_state = s.s_state WHERE wp.wp_char_count IN ('5918', '3732', '4894', '2129', '1526') AND c.ca_county IN ('Calloway County', 'Mifflin County', 'Dutchess County', 'Rowan County') AND s.s_number_employees = 297 AND ws.ws_bill_customer_sk IN ('50106', '534', '23933', '77910', '39966') GROUP BY c.ca_county ORDER BY total_revenue_inc_tax DESC, total_net_profit DESC;
SELECT d_year, cd_gender, cd_marital_status, cd_education_status, ib_lower_bound, ib_upper_bound, COUNT(DISTINCT c_customer_sk) AS num_customers, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_net_profit) AS total_net_profit, SUM(wr_return_quantity) AS total_quantity_returned, AVG(wr_return_amt) AS avg_return_amount, SUM(inv_quantity_on_hand) AS total_inventory_quantity FROM date_dim JOIN catalog_sales ON (date_dim.d_date_sk = catalog_sales.cs_sold_date_sk) JOIN customer ON (catalog_sales.cs_bill_customer_sk = customer.c_customer_sk) JOIN customer_demographics ON (customer.c_current_cdemo_sk = customer_demographics.cd_demo_sk) JOIN income_band ON (customer_demographics.cd_purchase_estimate BETWEEN income_band.ib_lower_bound AND income_band.ib_upper_bound) LEFT JOIN web_returns ON (catalog_sales.cs_item_sk = web_returns.wr_item_sk AND catalog_sales.cs_order_number = web_returns.wr_order_number) LEFT JOIN inventory ON (catalog_sales.cs_item_sk = inventory.inv_item_sk AND date_dim.d_date_sk = inventory.inv_date_sk) WHERE cd_gender IN ('M', 'F') AND cd_marital_status IN ('M', 'U') AND cd_education_status IN ('4 yr Degree', '2 yr Degree') AND d_year IN (2001, 2002, 2003) AND d_moy BETWEEN 1 AND 6 AND ib_income_band_sk IN (1, 2, 3) AND d_current_year = 'N' GROUP BY d_year, cd_gender, cd_marital_status, cd_education_status, ib_lower_bound, ib_upper_bound ORDER BY d_year, cd_gender, cd_marital_status, cd_education_status, ib_lower_bound, ib_upper_bound;
SELECT cd.cd_education_status, cd.cd_gender, cd.cd_marital_status, cd.cd_credit_rating, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_incl_tax, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amount_incl_tax, COUNT(wr.wr_returned_date_sk) AS total_returns, p.p_channel_email, p.p_channel_dmail, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo FROM web_returns wr JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk JOIN promotion p ON wr.wr_item_sk = p.p_item_sk WHERE wr.wr_fee IN (16.46, 25.83, 12.23, 28.11, 82.98) AND wr.wr_reversed_charge = 33.99 AND cd.cd_dep_employed_count = 0 GROUP BY cd.cd_education_status, cd.cd_gender, cd.cd_marital_status, cd.cd_credit_rating, p.p_channel_email, p.p_channel_dmail, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo ORDER BY total_return_amount_incl_tax DESC;
SELECT cc.cc_name AS call_center_name, cc.cc_city AS call_center_city, cc.cc_state AS call_center_state, hd.hd_income_band_sk AS income_band, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_items, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_including_tax, SUM(sr.sr_net_loss) AS total_net_loss FROM call_center cc JOIN store_returns sr ON cc.cc_call_center_sk = sr.sr_store_sk JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk JOIN warehouse w ON cc.cc_state = w.w_state WHERE w.w_county = 'Williamson County' AND hd.hd_demo_sk = 1887 AND cc.cc_rec_start_date <= CURRENT_DATE AND (cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date > CURRENT_DATE) GROUP BY call_center_name, call_center_city, call_center_state, income_band ORDER BY total_returns DESC, total_returned_items DESC;
SELECT c.c_first_name, c.c_last_name, ca.ca_city, ca.ca_state, ca.ca_country, SUM(cs.cs_sales_price) AS total_sales, AVG(cs.cs_sales_price) AS average_sale_amount, COUNT(cs.cs_order_number) AS number_of_orders, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_return_amount) AS average_return_amount, COUNT(DISTINCT cr.cr_order_number) AS number_of_returns, SUM(cr.cr_net_loss) AS total_net_loss FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number AND cs.cs_item_sk = cr.cr_item_sk WHERE ca.ca_country = 'United States' AND ca.ca_gmt_offset IN ('-10.00', '-6.00', '-5.00') AND cs.cs_ext_list_price > 0 GROUP BY c.c_first_name, c.c_last_name, ca.ca_city, ca.ca_state, ca.ca_country HAVING SUM(cs.cs_sales_price) > 0 ORDER BY total_sales DESC, total_returns DESC LIMIT 100;
SELECT dd.d_year, dd.d_quarter_name, ib.ib_lower_bound, ib.ib_upper_bound, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk WHERE wp.wp_type = 'welcome' AND wp.wp_autogen_flag = 'N' AND dd.d_quarter_seq IN (SELECT DISTINCT d_quarter_seq FROM date_dim WHERE d_year = 2023) AND td.t_hour BETWEEN 8 AND 20 GROUP BY dd.d_year, dd.d_quarter_name, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY dd.d_year, dd.d_quarter_name, ib.ib_lower_bound, ib.ib_upper_bound;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address, sum(i.i_current_price) AS total_spent, avg(i.i_wholesale_cost) AS average_wholesale_cost, count(DISTINCT cp.cp_catalog_page_sk) AS number_of_catalog_pages, count(DISTINCT web.web_site_sk) AS number_of_websites_visited, sm.sm_type AS shipping_type, sm.sm_code AS shipping_code FROM customer c JOIN catalog_page cp ON c.c_first_shipto_date_sk = cp.cp_start_date_sk JOIN item i ON i.i_category_id = cp.cp_catalog_number JOIN web_site web ON web.web_open_date_sk = c.c_first_sales_date_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = web.web_site_sk WHERE i.i_brand_id IN ('6016004', '7006002', '6004007') AND i.i_manufact_id IN ('86', '35', '590') AND web.web_suite_number IN ('Suite 330', 'Suite R', 'Suite Q') AND web.web_open_date_sk IN ('2450798', '2450654', '2450756') AND cp.cp_catalog_page_number IN ('93', '92', '1') AND cp.cp_start_date_sk IN ('2451088', '2451180', '2451271') AND cp.cp_department = 'DEPARTMENT' AND cp.cp_catalog_number IN ('19', '13', '33') AND sm.sm_code IN ('BIKE', 'SURFACE', 'SEA') AND sm.sm_type IN ('REGULAR', 'NEXT DAY', 'LIBRARY') AND c.c_salutation IN ('Ms.', 'Mr.', 'Miss') AND c.c_first_name IN ('Arturo', 'Gudrun', 'Douglas') AND c.c_birth_country IN ('ISLE OF MAN', 'AMERICAN SAMOA', 'EQUATORIAL GUINEA') AND c.c_customer_sk IN ('4875', '3748', '2364') GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address, sm.sm_type, sm.sm_code ORDER BY total_spent DESC LIMIT 100;
