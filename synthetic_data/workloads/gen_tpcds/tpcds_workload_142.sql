SELECT cd.cd_education_status, cd.cd_marital_status, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, AVG(CASE WHEN cd.cd_credit_rating LIKE 'Good%' THEN 1 WHEN cd.cd_credit_rating LIKE 'Fair%' THEN 2 WHEN cd.cd_credit_rating LIKE 'Poor%' THEN 3 ELSE NULL END) AS avg_credit_rating_score, COUNT(DISTINCT wp.wp_web_page_sk) AS web_page_count, wp.wp_type, AVG(wp.wp_link_count) AS avg_link_count, AVG(wp.wp_image_count) AS avg_image_count FROM customer_demographics cd LEFT JOIN web_page wp ON cd.cd_demo_sk = wp.wp_customer_sk LEFT JOIN time_dim td ON wp.wp_access_date_sk = td.t_time_sk WHERE cd.cd_marital_status IN ('D', 'U', 'S', 'M', 'W') AND td.t_hour > 18 AND (td.t_am_pm = 'PM') GROUP BY cd.cd_education_status, cd.cd_marital_status, wp.wp_type ORDER BY cd.cd_education_status, cd.cd_marital_status, web_page_count DESC;
SELECT d_year AS "Year", p_promo_name AS "Promotion Name", COUNT(cr_order_number) AS "Total Returns", SUM(cr_return_quantity) AS "Total Returned Quantity", SUM(cr_return_amount) AS "Total Returned Amount", AVG(cr_return_amount) AS "Average Return Amount", SUM(cr_net_loss) AS "Total Net Loss" FROM catalog_returns cr JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk JOIN promotion p ON d.d_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk WHERE p.p_end_date_sk IN ('2450731', '2450673', '2450658', '2450718') GROUP BY "Year", "Promotion Name" ORDER BY "Year", "Total Returned Amount" DESC;
SELECT CAST(SUBSTRING(CAST(cr.cr_returned_date_sk AS VARCHAR), 1, 4) AS INTEGER) AS return_year, CAST(SUBSTRING(CAST(cr.cr_returned_date_sk AS VARCHAR), 5, 2) AS INTEGER) AS return_month, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_customers, COUNT(*) AS total_returns, SUM(p.p_cost) AS promotion_cost, s.s_store_name, s.s_city FROM catalog_returns cr JOIN promotion p ON cr.cr_item_sk = p.p_item_sk JOIN store s ON s.s_store_sk = cr.cr_returning_addr_sk WHERE CAST(SUBSTRING(CAST(cr.cr_returned_date_sk AS VARCHAR), 1, 4) AS INTEGER) = 2023 AND s.s_number_employees BETWEEN 200 AND 300 AND s.s_store_id IN ('AAAAAAAABAAAAAAA', 'AAAAAAAAHAAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAAKAAAAAAA', 'AAAAAAAAEAAAAAAA') AND cr.cr_refunded_addr_sk = 30891 AND p.p_channel_press = 'N' GROUP BY return_year, return_month, s.s_store_name, s.s_city ORDER BY total_return_amount DESC, s.s_store_name, s.s_city;
SELECT p.p_promo_name AS promotion_name, ib.ib_lower_bound AS income_band_lower_bound, ib.ib_upper_bound AS income_band_upper_bound, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_ext_sales_price) AS total_sales, SUM(ss.ss_ext_discount_amt) AS total_discount_amount, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_customer_sk) AS distinct_customers, SUM(CASE WHEN ss.ss_sales_price < ss.ss_list_price THEN 1 ELSE 0 END) AS count_discounted_sales FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN income_band ib ON ss.ss_cdemo_sk = ib.ib_income_band_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE p.p_discount_active = 'N' AND d.d_year IN (1901, 1903, 1906, 1908) AND ss.ss_ext_sales_price IN (2209.06, 2248.08) AND ib.ib_lower_bound IN (0, 90001, 170001, 120001, 50001) AND ib.ib_upper_bound = 160000 GROUP BY p.p_promo_name, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_sales DESC, promotion_name, income_band_lower_bound, income_band_upper_bound;
SELECT w_state, w_city, COUNT(DISTINCT w_warehouse_sk) AS number_of_warehouses, SUM(w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(w_warehouse_sq_ft) AS avg_warehouse_sq_ft, p_channel_dmail, p_channel_email, COUNT(DISTINCT p_promo_sk) AS number_of_promotions, SUM(p_cost) AS total_promotion_cost, AVG(p_cost) AS avg_promotion_cost, s_state, s_city, COUNT(DISTINCT s_store_sk) AS number_of_stores, SUM(s_number_employees) AS total_employees, AVG(s_floor_space) AS avg_store_floor_space, SUM(s_tax_precentage) AS total_tax_percentage, AVG(s_tax_precentage) AS avg_tax_percentage FROM warehouse JOIN promotion ON w_warehouse_sk = p_item_sk JOIN store ON w_state = s_state AND w_city = s_city WHERE promotion.p_channel_press = 'N' AND promotion.p_purpose = 'Unknown' AND store.s_rec_start_date <= CURRENT_DATE AND (store.s_rec_end_date IS NULL OR store.s_rec_end_date > CURRENT_DATE) GROUP BY w_state, w_city, p_channel_dmail, p_channel_email, s_state, s_city ORDER BY w_state, w_city;
SELECT cp.cp_department, COUNT(DISTINCT cs.cs_item_sk) AS distinct_items_sold, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_ext_sales_price) AS total_sales, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_ext_discount_amt) AS total_discount_amount FROM catalog_sales cs JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk WHERE cs.cs_sold_date_sk BETWEEN cp.cp_start_date_sk AND cp.cp_end_date_sk GROUP BY cp.cp_department ORDER BY total_sales DESC;
SELECT ws.ws_web_site_sk, web.web_name, web.web_class, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, SUM(ws.ws_quantity) as total_quantity_sold, AVG(ws.ws_sales_price) as average_sales_price, COUNT(DISTINCT ws.ws_order_number) as total_orders, SUM(ws.ws_net_paid) as total_net_paid, SUM(ws.ws_net_paid_inc_tax) as total_net_paid_inc_tax, SUM(ws.ws_net_profit) as total_net_profit FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk AND p.p_response_target = '1' WHERE p.p_start_date_sk IN (2451635, 2451362, 2451818, 2451605, 2451420, 2451665) GROUP BY ws.ws_web_site_sk, web.web_name, web.web_class, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY total_net_profit DESC, web.web_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status;
SELECT ca.ca_state, ca.ca_city, COUNT(DISTINCT c.c_customer_sk) AS num_customers, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_ext_discount_amt) AS total_discount_amount, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_net_loss) AS avg_net_loss, SUM(CASE WHEN r.r_reason_sk IS NOT NULL THEN 1 ELSE 0 END) AS num_returns_with_reason FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN web_returns wr ON wr.wr_refunded_customer_sk = c.c_customer_sk LEFT JOIN reason r ON wr.wr_reason_sk = r.r_reason_sk GROUP BY ca.ca_state, ca.ca_city HAVING COUNT(DISTINCT c.c_customer_sk) > 5 AND SUM(ss.ss_quantity) > 50 ORDER BY total_discount_amount DESC, avg_sales_price DESC LIMIT 100;
SELECT cp.cp_department, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_sales_price) AS avg_sales_price, AVG(cs.cs_net_profit) AS avg_profit FROM catalog_sales cs JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN web_site ws ON cp.cp_department = ws.web_class JOIN income_band ib ON cs.cs_bill_cdemo_sk = ib.ib_income_band_sk WHERE cp.cp_end_date_sk < 2450934 AND ws.web_tax_percentage IN (0.07, 0.08) AND ws.web_state = 'TN' AND ib.ib_upper_bound = 170000 GROUP BY cp.cp_department ORDER BY total_sales DESC;
SELECT d_year, d_quarter_name, cc_class, COUNT(DISTINCT ss_ticket_number) AS total_tickets, SUM(ss_quantity) AS total_quantity, SUM(ss_net_paid) AS total_net_paid, SUM(ss_net_paid_inc_tax) AS total_net_paid_inc_tax, AVG(ss_sales_price) AS average_sales_price, SUM(ss_net_profit) AS total_net_profit FROM store_sales JOIN date_dim ON (store_sales.ss_sold_date_sk = date_dim.d_date_sk) JOIN call_center ON (store_sales.ss_store_sk = call_center.cc_call_center_sk) WHERE store_sales.ss_customer_sk IN ('21757', '11218') GROUP BY d_year, d_quarter_name, cc_class ORDER BY d_year, d_quarter_name, cc_class;
SELECT i_category, cd_gender, cd_marital_status, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(ws_net_profit) AS total_web_net_profit, AVG(wr_fee) AS average_return_fee FROM store_sales JOIN item ON ss_item_sk = i_item_sk JOIN web_sales ON ws_item_sk = ss_item_sk JOIN web_returns ON wr_item_sk = ws_item_sk JOIN customer_demographics ON (ss_cdemo_sk = cd_demo_sk AND ws_bill_cdemo_sk = cd_demo_sk AND wr_refunded_cdemo_sk = cd_demo_sk) WHERE i_wholesale_cost > 14.32 AND (cd_gender = 'M' OR cd_gender = 'F') AND (cd_marital_status = 'M' OR cd_marital_status = 'U') AND ws_net_paid_inc_tax > 100 AND wr_return_amt > 0 GROUP BY i_category, cd_gender, cd_marital_status ORDER BY total_quantity_sold DESC, average_sales_price DESC;
SELECT s.s_store_name, w.web_name, SUM(i.i_current_price) AS total_sales_price, AVG(i.i_wholesale_cost) AS average_wholesale_cost, COUNT(DISTINCT c.cp_catalog_page_sk) AS num_catalog_pages, COUNT(DISTINCT w.web_site_sk) AS num_websites, COUNT(DISTINCT wp.wp_web_page_sk) AS num_web_pages, COUNT(DISTINCT sm.sm_ship_mode_sk) AS num_ship_modes, MAX(i.i_current_price) AS max_item_price, MIN(i.i_current_price) AS min_item_price FROM store s JOIN web_site w ON s.s_market_id = w.web_mkt_id JOIN web_page wp ON w.web_site_sk = wp.wp_customer_sk JOIN catalog_page c ON c.cp_department = s.s_geography_class JOIN item i ON i.i_category = c.cp_description JOIN ship_mode sm ON sm.sm_type = wp.wp_type WHERE s.s_company_name = 'Unknown' AND wp.wp_autogen_flag = 'N' AND s.s_street_name IN ('Park Green', 'Park Laurel', '4th') AND w.web_city IN ('Fairview', 'Midway') GROUP BY s.s_store_name, w.web_name ORDER BY total_sales_price DESC, average_wholesale_cost DESC LIMIT 100;
SELECT i.i_category AS item_category, COUNT(DISTINCT i.i_item_sk) AS unique_items_sold, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid) AS total_sales, AVG(ws.ws_sales_price) AS average_sales_price, AVG(ws.ws_net_profit) AS average_net_profit FROM item i JOIN web_sales ws ON i.i_item_sk = ws.ws_item_sk JOIN inventory inv ON ws.ws_item_sk = inv.inv_item_sk WHERE i.i_current_price > 50 AND inv.inv_warehouse_sk IN (1, 2) AND ws.ws_ship_date_sk IN (2452335, 2452146, 2450987, 2452543) GROUP BY i.i_category ORDER BY total_sales DESC;
SELECT ws.ws_web_site_sk, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, ws_site.web_tax_percentage, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(cd.cd_dep_college_count) AS total_college_dependents FROM web_sales ws JOIN web_site ws_site ON ws.ws_web_site_sk = ws_site.web_site_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk WHERE ws.ws_sales_price BETWEEN 6.61 AND 60.51 AND ws_site.web_tax_percentage IN ('0.07', '0.02') AND ws_site.web_zip IN ('35709', '31904') AND ws.ws_sold_date_sk IS NOT NULL AND ws.ws_sold_time_sk IS NOT NULL GROUP BY ws.ws_web_site_sk, ws_site.web_tax_percentage, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY ws.ws_web_site_sk, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(wr.wr_return_quantity) AS total_quantity_returned, AVG(wr.wr_return_amt) AS average_return_amount, COUNT(DISTINCT wr.wr_order_number) AS number_of_return_transactions FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN web_returns wr ON ss.ss_item_sk = wr.wr_item_sk AND ss.ss_ticket_number = wr.wr_order_number WHERE cc.cc_mkt_class IN ('Silly particles could pro', 'Dealers make most historical, direct students', 'Wrong troops shall work sometimes in a opti', 'A bit narrow forms matter animals. Consist', 'More than other authori') AND cc.cc_sq_ft IN (795, 4134, 3514) AND wr.wr_refunded_addr_sk IN ('15506', '16033', '22303') AND ss.ss_item_sk IN (5893, 944) AND ss.ss_ticket_number IN (3473, 3634, 3530) GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_quantity_sold DESC, total_quantity_returned DESC;
