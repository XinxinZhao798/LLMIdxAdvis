SELECT d_year, i_category, SUM(ss_quantity) AS total_store_sales_quantity, AVG(ss_sales_price) AS avg_store_sales_price, AVG(cs_sales_price) AS avg_catalog_sales_price, AVG(ws_sales_price) AS avg_web_sales_price, SUM(ss_net_paid) AS total_store_net_paid, SUM(cs_net_paid) AS total_catalog_net_paid, SUM(ws_net_paid) AS total_web_net_paid, COUNT(DISTINCT ss_store_sk) AS number_of_stores, COUNT(DISTINCT cs_catalog_page_sk) AS number_of_catalog_pages, COUNT(DISTINCT ws_web_site_sk) AS number_of_websites FROM store_sales JOIN date_dim ON (ss_sold_date_sk = d_date_sk) JOIN item ON (ss_item_sk = i_item_sk) LEFT JOIN catalog_sales ON (ss_item_sk = cs_item_sk AND ss_sold_date_sk = cs_sold_date_sk) LEFT JOIN web_sales ON (ss_item_sk = ws_item_sk AND ss_sold_date_sk = ws_sold_date_sk) WHERE d_year = 1999 AND (ss_net_paid > 900 OR cs_net_paid > 900 OR ws_net_paid > 900) AND i_manager_id IN (65, 2, 85) GROUP BY d_year, i_category ORDER BY total_store_sales_quantity DESC, total_store_net_paid DESC, i_category;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, dd.d_year, SUM(ws.ws_ext_sales_price) AS total_sales, AVG(ws.ws_ext_sales_price) AS avg_sales, COUNT(*) AS number_of_sales, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_return_amount) AS avg_returns, COUNT(DISTINCT cr.cr_order_number) AS number_of_returns FROM web_sales ws JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk LEFT JOIN catalog_returns cr ON cr.cr_returned_date_sk = dd.d_date_sk AND cr.cr_refunded_customer_sk = c.c_customer_sk WHERE dd.d_year = 2001 GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, dd.d_year ORDER BY total_sales DESC, total_returns DESC LIMIT 100;
SELECT dd.d_year, dd.d_quarter_name, cp.cp_department, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_net_paid) AS total_net_paid, AVG(cs.cs_net_paid / cs.cs_quantity) AS avg_net_paid_per_item, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk WHERE dd.d_current_day = 'N' AND dd.d_qoy = '3' AND cs.cs_ship_hdemo_sk IN ('340', '2787', '2515', '487', '576', '6271') AND cp.cp_catalog_page_sk IN ('1948', '1122', '4477', '1780') GROUP BY dd.d_year, dd.d_quarter_name, cp.cp_department ORDER BY dd.d_year, dd.d_quarter_name, cp.cp_department;
SELECT sm.sm_type AS shipping_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_items_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_revenue, SUM(cs.cs_net_profit) AS total_profit, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_items_returned, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_net_loss) AS total_loss FROM catalog_sales cs JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN web_returns wr ON cs.cs_order_number = wr.wr_order_number AND cs.cs_item_sk = wr.wr_item_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk WHERE sm.sm_type IN ('REGULAR', 'OVERNIGHT') AND cd.cd_gender IN ('M', 'F') AND cs.cs_quantity IN (91, 62, 46, 68, 45) AND (wr.wr_returned_time_sk = 74117 OR wr.wr_returned_time_sk IS NULL) GROUP BY sm.sm_type ORDER BY total_revenue DESC, total_loss ASC;
SELECT c.ca_state, c.ca_city, COUNT(DISTINCT cust.c_customer_sk) AS total_customers, SUM(CASE WHEN p.p_channel_dmail = 'Y' THEN 1 ELSE 0 END) AS dmail_promo_count, AVG(p.p_cost) AS avg_promotion_cost, MAX(cust.c_birth_year) AS latest_birth_year FROM customer_address c JOIN customer cust ON c.ca_address_sk = cust.c_current_addr_sk LEFT JOIN promotion p ON p.p_start_date_sk <= cust.c_first_sales_date_sk AND p.p_end_date_sk >= cust.c_first_sales_date_sk WHERE cust.c_birth_year > 1980 AND c.ca_country = 'United States' AND (p.p_channel_dmail = 'Y' OR p.p_channel_dmail = 'N') GROUP BY c.ca_state, c.ca_city ORDER BY total_customers DESC, avg_promotion_cost DESC, dmail_promo_count DESC LIMIT 100;
SELECT dd.d_year, ca.ca_state, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS order_count, SUM(cs.cs_net_paid_inc_tax) AS total_revenue_inc_tax, SUM(cs.cs_net_profit) AS total_profit FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON cs.cs_bill_addr_sk = ca.ca_address_sk JOIN store s ON ca.ca_state = s.s_state JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk WHERE dd.d_fy_year = 1912 GROUP BY dd.d_year, ca.ca_state ORDER BY total_revenue_inc_tax DESC, ca.ca_state;
SELECT c.c_birth_country, i.i_category, ss.ss_sold_date_sk AS sales_period, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(inv.inv_quantity_on_hand) AS total_inventory_on_hand, (SUM(ss.ss_net_paid) - SUM(ss.ss_quantity * i.i_wholesale_cost)) AS total_profit FROM store_sales ss JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk AND ss.ss_item_sk = inv.inv_item_sk WHERE i.i_size IN ('extra large', 'large', 'economy') AND i.i_manufact_id IN ('302', '74', '552') AND c.c_birth_country IN ('ANDORRA', 'HONG KONG', 'SUDAN') AND c.c_birth_month IN ('12', '3', '5') AND ss.ss_sales_price IN ('71.33', '20.06', '18.34') AND ss.ss_net_paid IN ('2427.39', '6300.00', '3723.80') AND ss.ss_promo_sk IN ('148', '58', '30') AND inv.inv_date_sk = '2450815' AND inv.inv_warehouse_sk IN ('2', '1') AND inv.inv_item_sk IN ('7018', '8266', '13327') AND inv.inv_quantity_on_hand IN ('693', '377', '403') GROUP BY c.c_birth_country, i.i_category, sales_period ORDER BY total_profit DESC, total_net_paid DESC, total_quantity_sold DESC, average_sales_price DESC;
SELECT d_year AS year, d_quarter_name AS quarter, sm_type AS shipping_type, p_promo_name AS promotion_name, COUNT(*) AS total_shipments, AVG(cd_purchase_estimate) AS average_purchase_estimate, SUM(p_cost) AS total_promotion_cost, COUNT(DISTINCT r_reason_sk) AS unique_reasons_count FROM date_dim JOIN promotion ON (d_date_sk = p_start_date_sk OR d_date_sk = p_end_date_sk) JOIN ship_mode ON sm_ship_mode_sk = 9 JOIN customer_demographics ON cd_credit_rating = 'Good' LEFT JOIN reason ON r_reason_desc IN ('Does not work with a product that I have', 'reason 32') WHERE d_year = 2023 AND sm_contract = 'O9V6oF8RJnLMmZYd1' AND p_discount_active = 'Y' GROUP BY year, quarter, shipping_type, promotion_name ORDER BY year, quarter, total_promotion_cost DESC;
SELECT ws.web_site_id, ws.web_class, ws.web_name, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(wr.wr_refunded_cash) AS total_refunded_cash, SUM(sr.sr_return_quantity) AS store_total_returned_quantity, AVG(sr.sr_return_amt_inc_tax) AS store_avg_return_amount_inc_tax, SUM(sr.sr_refunded_cash) AS store_total_refunded_cash FROM web_site ws JOIN web_page wp ON ws.web_site_sk = wp.wp_web_page_sk JOIN web_returns wr ON wp.wp_web_page_sk = wr.wr_web_page_sk LEFT JOIN store_returns sr ON wr.wr_item_sk = sr.sr_item_sk AND wr.wr_refunded_customer_sk = sr.sr_customer_sk WHERE ws.web_class = 'Unknown' AND ws.web_rec_end_date IN ('2001-08-15', '2000-08-15', '1999-08-16') AND wp.wp_rec_start_date IN ('2000-09-03', '2001-09-03', '1997-09-03') AND wp.wp_link_count IN (7, 11, 19) AND wr.wr_return_amt_inc_tax IN (43.31, 378.40, 532.83) AND wr.wr_refunded_cash IN (2425.04, 1694.98, 8.69) AND sr.sr_customer_sk IN (38344, 71012, 20816) AND sr.sr_cdemo_sk IN (1443482, 746161, 1430182) GROUP BY ws.web_site_id, ws.web_class, ws.web_name ORDER BY total_returns DESC, total_refunded_cash DESC;
SELECT s.s_store_name, w.w_warehouse_name, COUNT(ss.ss_ticket_number) AS total_sales_transactions, AVG(ss.ss_net_paid) AS avg_transaction_amount, SUM(ss.ss_net_paid_inc_tax) AS total_revenue_inc_tax, SUM(wr.wr_return_amt_inc_tax) AS total_returns_inc_tax, (SUM(ss.ss_net_paid_inc_tax) - SUM(wr.wr_return_amt_inc_tax)) AS net_revenue_inc_tax, AVG(wr.wr_fee) AS avg_return_fee, SUM(wr.wr_net_loss) AS total_net_loss_from_returns FROM store s JOIN store_sales ss ON s.s_store_sk = ss.ss_store_sk LEFT JOIN web_returns wr ON ss.ss_ticket_number = wr.wr_order_number JOIN warehouse w ON s.s_state = w.w_state GROUP BY s.s_store_name, w.w_warehouse_name ORDER BY net_revenue_inc_tax DESC, s.s_store_name;
SELECT c.c_customer_id, AVG(ss.ss_net_profit) AS avg_net_profit, SUM(sr.sr_return_amt_inc_tax) AS total_returns, COUNT(DISTINCT ws.web_site_sk) AS number_of_websites, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid_inc_tax) AS total_sales_inc_tax FROM customer c LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk LEFT JOIN web_site ws ON ws.web_zip = c.c_current_addr_sk::character varying WHERE (ss.ss_hdemo_sk IN ('4776', '3144', '2508', '6460') OR c.c_current_hdemo_sk IN ('5414', '1065', '4963', '3942', '5655', '758')) AND (ws.web_zip IN ('35709', '31904') OR ws.web_rec_end_date IN ('1999-08-16', '2000-08-15', '2001-08-15')) GROUP BY c.c_customer_id ORDER BY avg_net_profit DESC, total_returns DESC, number_of_websites DESC, total_quantity_sold DESC, total_sales_inc_tax DESC;
SELECT p.p_promo_name, p.p_purpose, p.p_discount_active, SUM(ss.ss_quantity) as total_store_sales_quantity, AVG(ss.ss_sales_price) as avg_store_sales_price, SUM(ws.ws_quantity) as total_web_sales_quantity, AVG(ws.ws_sales_price) as avg_web_sales_price, (SUM(ss.ss_net_paid) + SUM(ws.ws_net_paid)) as total_net_paid, (SUM(ss.ss_net_paid_inc_tax) + SUM(ws.ws_net_paid_inc_tax)) as total_net_paid_inc_tax, (SUM(ss.ss_net_profit) + SUM(ws.ws_net_profit)) as total_net_profit FROM promotion p LEFT JOIN store_sales ss ON p.p_promo_sk = ss.ss_promo_sk LEFT JOIN web_sales ws ON p.p_promo_sk = ws.ws_promo_sk WHERE p.p_channel_tv = 'N' AND p.p_purpose <> 'Unknown' GROUP BY p.p_promo_name, p.p_purpose, p.p_discount_active ORDER BY total_net_profit DESC, total_net_paid DESC, avg_store_sales_price DESC, avg_web_sales_price DESC;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, AVG(cc.cc_employees) AS average_employee_count, SUM(cc.cc_sq_ft) AS total_call_center_sq_ft, COUNT(DISTINCT w.w_warehouse_sk) AS number_of_warehouses, AVG(w.w_warehouse_sq_ft) AS average_warehouse_sq_ft, SUM(wp.wp_link_count) AS total_web_page_link_count, COUNT(DISTINCT cp.cp_catalog_page_sk) AS number_of_catalog_pages FROM call_center cc LEFT JOIN warehouse w ON cc.cc_city = w.w_city AND cc.cc_state = w.w_state LEFT JOIN web_page wp ON wp.wp_url LIKE '%' || cc.cc_state || '%' LEFT JOIN catalog_page cp ON cc.cc_division = cp.cp_catalog_number WHERE cc.cc_class IN ('small', 'medium', 'large') AND wp.wp_autogen_flag = 'N' AND cp.cp_start_date_sk IN ('2451636', '2451271') AND w.w_suite_number = 'Suite 0' AND w.w_warehouse_sq_ft IN ('621234', '294242', '977787', '138504') GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_call_center_sq_ft DESC, average_employee_count DESC LIMIT 100;
SELECT cd.cd_gender, cd.cd_marital_status, SUM(ss.ss_ext_sales_price) AS total_sales, AVG(ss.ss_coupon_amt) AS average_coupon_amt, COUNT(ss.ss_item_sk) AS total_items_sold, AVG(inv.inv_quantity_on_hand) AS average_inventory_on_hand FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN inventory inv ON ss.ss_item_sk = inv.inv_item_sk WHERE cd.cd_gender IN ('M', 'F') AND ss.ss_ext_sales_price IN (672.96, 2541.35, 528.00, 4835.54, 2912.12, 416.88) AND ss.ss_promo_sk IN (144, 107, 228, 186, 28, 37) AND inv.inv_warehouse_sk IN (1, 2) AND inv.inv_quantity_on_hand = 24 GROUP BY cd.cd_gender, cd.cd_marital_status ORDER BY cd.cd_gender, cd.cd_marital_status;
SELECT d_year, i_category, i_class, SUM(ws_sales_price) AS total_sales, AVG(ws_sales_price) AS avg_sales_price, COUNT(DISTINCT ws_order_number) AS num_orders, SUM(sr_return_amt) AS total_returns, AVG(sr_return_amt) AS avg_return_amt, COUNT(DISTINCT sr_ticket_number) AS num_returns, SUM(ws_net_profit) - SUM(sr_net_loss) AS net_profit FROM web_sales JOIN item ON ws_item_sk = i_item_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk LEFT JOIN store_returns ON sr_item_sk = ws_item_sk AND sr_returned_date_sk = ws_sold_date_sk WHERE d_year = 2002 AND (i_category = 'Electronics' OR i_category = 'Books') AND ws_sales_price > 0 GROUP BY d_year, i_category, i_class ORDER BY d_year, i_category, i_class;
SELECT s_state, EXTRACT(YEAR FROM s_rec_start_date) AS year_started, COUNT(DISTINCT s_store_sk) AS number_of_stores, SUM(s_number_employees) AS total_employees, SUM(s_floor_space) AS total_floor_space, AVG(s_tax_precentage) AS avg_tax_percentage, SUM(inv_quantity_on_hand) AS total_inventory, AVG(hd_dep_count) AS avg_dependents, AVG(hd_vehicle_count) AS avg_vehicles, COUNT(DISTINCT p_promo_sk) AS num_promotions, SUM(CASE WHEN p_channel_email = 'Y' THEN p_cost ELSE 0 END) AS email_promotion_cost, SUM(CASE WHEN p_channel_tv = 'Y' THEN p_cost ELSE 0 END) AS tv_promotion_cost, SUM(CASE WHEN p_discount_active = 'Y' THEN 1 ELSE 0 END) AS active_discounts, COUNT(DISTINCT wp_web_page_sk) AS webpage_count, SUM(wp_link_count) AS total_links FROM store LEFT JOIN inventory ON s_store_sk = inv_warehouse_sk AND inv_date_sk = 2450815 LEFT JOIN household_demographics ON s_market_id = hd_income_band_sk LEFT JOIN promotion ON s_store_sk = p_item_sk LEFT JOIN web_page ON wp_access_date_sk = inv_date_sk GROUP BY s_state, year_started ORDER BY s_state, year_started;
SELECT ca_state, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT sr_customer_sk) AS unique_customers_returning, SUM(CASE WHEN p_channel_press = 'N' AND p_channel_catalog = 'N' THEN sr_return_amt ELSE 0 END) AS total_return_amount_no_press_no_catalog, wm.warehouse_count, sm.sm_count, ib.ib_count FROM store_returns sr JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN (SELECT w_state, COUNT(*) AS warehouse_count FROM warehouse GROUP BY w_state) wm ON ca.ca_state = wm.w_state JOIN (SELECT sm_carrier, COUNT(*) AS sm_count FROM ship_mode WHERE sm_carrier IN ('ALLIANCE', 'ZOUROS', 'UPS') GROUP BY sm_carrier) sm ON 1=1 JOIN (SELECT ib_lower_bound, COUNT(*) AS ib_count FROM income_band GROUP BY ib_lower_bound) ib ON 1=1 LEFT JOIN promotion p ON sr.sr_reason_sk = p.p_promo_sk WHERE sr.sr_reason_sk IN (19, 26, 34, 7, 29) AND ca.ca_street_name IN ('Johnson Spruce', '12th View', 'Dogwood 12th', '15th Third', 'Ninth Fourth', '1st 7th') AND sr_return_amt > 0 GROUP BY ca_state, wm.warehouse_count, sm.sm_count, ib.ib_count ORDER BY total_return_amount DESC LIMIT 100;
SELECT ca.ca_state AS customer_state, EXTRACT(YEAR FROM d.d_date) AS year_of_return, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_customers, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_refund_amount, AVG(cr.cr_return_amount) AS average_refund_amount, SUM(cr.cr_return_quantity) AS total_returned_quantity, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk WHERE ca.ca_state IS NOT NULL AND cr.cr_returned_date_sk IS NOT NULL GROUP BY customer_state, year_of_return ORDER BY customer_state, year_of_return;
SELECT d_year, c_preferred_cust_flag, cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT cr_order_number) AS total_returns, COUNT(DISTINCT cr_returning_customer_sk) AS distinct_returning_customers FROM catalog_returns JOIN date_dim ON catalog_returns.cr_returned_date_sk = date_dim.d_date_sk JOIN customer ON catalog_returns.cr_returning_customer_sk = customer.c_customer_sk JOIN customer_demographics ON customer.c_current_cdemo_sk = customer_demographics.cd_demo_sk WHERE d_year = 2003 AND cd_dep_count IN ('1', '2') AND c_birth_day IN (6, 20) AND cr_warehouse_sk IN (1, 2, 4) AND c_current_addr_sk IN (28702, 39227, 11533, 21702) GROUP BY d_year, c_preferred_cust_flag, cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate ORDER BY total_return_amount DESC, avg_return_quantity DESC, total_returns DESC, distinct_returning_customers DESC;
SELECT i.i_category, i.i_color, COUNT(DISTINCT cr.cr_item_sk) AS num_returns, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_return_quantity) AS total_returned_quantity, cc.cc_name AS call_center, w.w_warehouse_name AS warehouse, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages, COUNT(DISTINCT wp.wp_web_page_sk) AS num_web_pages FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN web_page wp ON cp.cp_start_date_sk = wp.wp_creation_date_sk WHERE i.i_color IN ('linen', 'midnight', 'powder', 'tan') AND cp.cp_catalog_number IN (46, 18, 2) AND w.w_gmt_offset = -5.00 GROUP BY i.i_category, i.i_color, cc.cc_name, w.w_warehouse_name ORDER BY total_return_amount DESC;
SELECT AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_ext_discount_amt) AS total_discount_amount, COUNT(DISTINCT p.p_promo_sk) AS number_of_promotions FROM web_sales ws JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk JOIN store s ON s.s_zip = '31904' JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk WHERE wp.wp_image_count IN (2, 3, 5) AND wp.wp_autogen_flag = 'N' AND (s.s_street_name = 'Lee 6th' OR s.s_street_name = '4th') AND p.p_channel_press = 'N' AND ws.ws_bill_hdemo_sk IN (2055, 5724, 3336) AND p.p_cost = 1000.00 GROUP BY s.s_market_id;
SELECT reason.r_reason_desc AS Return_Reason, COUNT(DISTINCT web_returns.wr_order_number) AS Total_Returns, SUM(web_returns.wr_return_amt) AS Total_Return_Amount, AVG(web_returns.wr_return_amt) AS Average_Return_Amount, promotion.p_promo_name AS Promotion_Name, COUNT(DISTINCT promotion.p_promo_sk) AS Total_Promotions_Affected, ship_mode.sm_type AS Shipping_Type, COUNT(DISTINCT ship_mode.sm_ship_mode_sk) AS Total_Shipping_Modes_Used FROM web_returns JOIN reason ON web_returns.wr_reason_sk = reason.r_reason_sk LEFT JOIN promotion ON web_returns.wr_item_sk = promotion.p_item_sk JOIN web_page ON web_returns.wr_web_page_sk = web_page.wp_web_page_sk JOIN ship_mode ON web_returns.wr_order_number = ship_mode.sm_ship_mode_sk WHERE web_returns.wr_return_amt > 0 AND reason.r_reason_desc IN ('No service location in my area', 'Did not like the warranty', 'Stopped working') AND web_page.wp_link_count BETWEEN 15 AND 24 GROUP BY Return_Reason, Promotion_Name, Shipping_Type ORDER BY Total_Returns DESC, Total_Return_Amount DESC;
SELECT i_category, i_brand, EXTRACT(YEAR FROM i_rec_start_date) AS year_started, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_profit) AS total_net_profit, SUM(cs_coupon_amt) AS total_coupon_amount, AVG(cs_net_paid_inc_ship_tax) AS average_net_paid_including_shipping_and_tax FROM item JOIN catalog_sales ON i_item_sk = cs_item_sk WHERE cs_net_paid > 10000 GROUP BY i_category, i_brand, year_started ORDER BY total_net_paid DESC, i_category, i_brand;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, SUM(cr.cr_return_quantity) AS total_catalog_return_quantity, SUM(cr.cr_return_amount) AS total_catalog_return_amt, AVG(cr.cr_return_amount) AS avg_catalog_return_amt, COUNT(cr.cr_return_amount) AS count_catalog_returns, AVG(cc.cc_tax_percentage) AS avg_call_center_tax_percentage, ws.web_site_id, ws.web_name, ws.web_city, ws.web_state, SUM(wr.wr_return_quantity) AS total_web_return_quantity, SUM(wr.wr_return_amt) AS total_web_return_amt, AVG(wr.wr_return_amt) AS avg_web_return_amt, COUNT(wr.wr_return_amt) AS count_web_returns, AVG(ws.web_tax_percentage) AS avg_web_tax_percentage FROM call_center cc LEFT JOIN catalog_returns cr ON cc.cc_call_center_sk = cr.cr_call_center_sk LEFT JOIN web_site ws ON cc.cc_company = ws.web_company_id LEFT JOIN web_returns wr ON ws.web_site_sk = wr.wr_web_page_sk WHERE (cr.cr_returning_hdemo_sk IN (1311, 6200, 1588, 925, 5366, 4174) OR cr.cr_returning_hdemo_sk IS NULL) AND (cr.cr_reason_sk = 16 OR cr.cr_reason_sk IS NULL) AND cc.cc_rec_start_date <= CURRENT_DATE AND (cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date > CURRENT_DATE) AND ws.web_rec_start_date <= CURRENT_DATE AND (ws.web_rec_end_date IS NULL OR ws.web_rec_end_date > CURRENT_DATE) GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, ws.web_site_id, ws.web_name, ws.web_city, ws.web_state ORDER BY total_catalog_return_amt DESC, total_web_return_amt DESC;
SELECT s.s_store_name, s.s_city, s.s_manager, COUNT(DISTINCT sm.sm_ship_mode_sk) AS distinct_shipping_modes, SUM(s.s_floor_space) AS total_floor_space, AVG(s.s_number_employees) AS average_number_of_employees, SUM(s.s_tax_precentage) AS total_tax_percentage, COUNT(*) AS count_of_stores FROM store s LEFT JOIN ship_mode sm ON s.s_store_sk = sm.sm_ship_mode_sk LEFT JOIN reason r ON r.r_reason_sk = s.s_closed_date_sk WHERE s.s_manager IN ('Scott Smith', 'William Ward') AND s.s_city IN ('Fairview', 'Midway') AND r.r_reason_id IN ('AAAAAAAAOBAAAAAA', 'AAAAAAAAMBAAAAAA', 'AAAAAAAAGAAAAAAA', 'AAAAAAAAJBAAAAAA') AND sm.sm_type IN ('NEXT DAY', 'TWO DAY', 'LIBRARY', 'EXPRESS', 'REGULAR', 'OVERNIGHT') GROUP BY s.s_store_name, s.s_city, s.s_manager ORDER BY s.s_city, s.s_store_name;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, ib.ib_income_band_sk, COUNT(sr.sr_item_sk) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(sr.sr_net_loss) AS total_net_loss FROM customer c JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN income_band ib ON c.c_current_hdemo_sk = ib.ib_income_band_sk WHERE sr.sr_return_quantity > 5 AND ib.ib_lower_bound >= 120001 AND (c.c_birth_year BETWEEN 1980 AND 1990) GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, ib.ib_income_band_sk ORDER BY total_net_loss DESC, avg_return_amount DESC LIMIT 100;
SELECT ca.ca_country, ca.ca_state, cp.cp_type, AVG(inv.inv_quantity_on_hand) AS avg_quantity_on_hand, SUM(wr.wr_return_quantity) AS total_returned_quantity, SUM(wr.wr_return_amt) AS total_return_amount, SUM(wr.wr_fee) AS total_return_fees, COUNT(DISTINCT wr.wr_returning_customer_sk) AS distinct_returning_customers FROM web_returns wr JOIN customer_address ca ON wr.wr_returning_addr_sk = ca.ca_address_sk JOIN catalog_page cp ON wr.wr_web_page_sk = cp.cp_catalog_page_sk JOIN inventory inv ON wr.wr_item_sk = inv.inv_item_sk AND wr.wr_returned_date_sk = inv.inv_date_sk WHERE ca.ca_country = 'United States' AND cp.cp_type IN ('bi-annual', 'monthly') AND wr.wr_returning_customer_sk IN ('48847', '59684', '67712', '64182', '84117') GROUP BY ca.ca_country, ca.ca_state, cp.cp_type ORDER BY ca.ca_state, cp.cp_type;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(DISTINCT cs.cs_order_number) AS total_catalog_orders, SUM(cs.cs_quantity) AS total_catalog_quantity, AVG(cs.cs_sales_price) AS avg_catalog_sales_price, SUM(ss.ss_net_profit) AS total_store_net_profit, AVG(ss.ss_sales_price) AS avg_store_sales_price, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_page_visits, SUM(wp.wp_link_count) AS total_web_page_links, ws.web_name, ws.web_company_name, ib.ib_lower_bound, ib.ib_upper_bound, s.s_store_name, s.s_number_employees, s.s_floor_space FROM customer_demographics cd LEFT JOIN catalog_sales cs ON cd.cd_demo_sk = cs.cs_bill_cdemo_sk LEFT JOIN store_sales ss ON cd.cd_demo_sk = ss.ss_cdemo_sk LEFT JOIN web_page wp ON cd.cd_demo_sk = wp.wp_customer_sk LEFT JOIN web_site ws ON wp.wp_web_page_id = ws.web_site_id LEFT JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound LEFT JOIN store s ON ss.ss_store_sk = s.s_store_sk LEFT JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk WHERE ib.ib_income_band_sk IN (6, 11, 7) AND (s.s_rec_end_date IN ('1999-03-13', '2000-03-12', '2001-03-12') OR s.s_rec_end_date IS NULL) AND (s.s_store_name LIKE '%cally%' OR s.s_store_name LIKE '%ation%' OR s.s_store_name LIKE '%eing%') AND wp.wp_web_page_id IN ('AAAAAAAAJBAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAAMCAAAAAA') AND wp.wp_web_page_sk IN (30, 40, 9) AND wp.wp_rec_end_date IN ('2000-09-02', '1999-09-03', '2001-09-02') AND cd.cd_dep_college_count = 0 AND cd.cd_marital_status IN ('U', 'W', 'S') AND cd.cd_dep_employed_count = 0 AND ss.ss_sales_price IN (6.97, 54.53, 6.01) AND ss.ss_net_profit IN (-2115.52, -1765.80, -614.39) AND cs.cs_ext_tax IN (18.59, 2.99, 205.24) AND cs.cs_sold_date_sk IN (2450841, 2450829, 2450825) AND ws.web_name IN ('site_2', 'site_4', 'site_0') AND ws.web_street_number IN ('887', '973', '892') AND cp.cp_type IN ('quarterly', 'monthly', 'bi-annual') AND cp.cp_catalog_number IN (31, 32, 13) AND cp.cp_end_date_sk IN (2451574, 2451539, 2451299) GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, ws.web_name, ws.web_company_name, ib.ib_lower_bound, ib.ib_upper_bound, s.s_store_name, s.s_number_employees, s.s_floor_space ORDER BY total_catalog_orders DESC, total_store_net_profit DESC, total_web_page_visits DESC;
SELECT w_country, cr_returned_date_sk AS return_date_sk, i_category, COUNT(DISTINCT cr_order_number) AS total_returns, SUM(cr_return_quantity) AS total_returned_quantity, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN promotion p ON i.i_item_sk = p.p_item_sk AND p.p_discount_active = 'N' WHERE cr.cr_returning_hdemo_sk IN (7008, 2246, 3148, 584, 6843) GROUP BY w_country, return_date_sk, i_category ORDER BY total_net_loss DESC, total_returns DESC;
SELECT d_year, SUM(ws_net_profit) AS total_net_profit, AVG(ws_quantity) AS average_quantity_sold, COUNT(DISTINCT ws.ws_web_page_sk) AS count_distinct_pages, SUM(wr_return_amt) AS total_return_amount, AVG(wr_return_quantity) AS average_return_quantity, COUNT(DISTINCT wr.wr_item_sk) AS count_distinct_returned_items FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk LEFT JOIN web_returns wr ON ws.ws_item_sk = wr.wr_item_sk AND ws.ws_order_number = wr.wr_order_number LEFT JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk WHERE dd.d_moy IN ('8', '11') AND dd.d_current_week = 'N' AND ws.ws_web_page_sk IN ('58', '41', '42', '15', '20') AND ws.ws_ext_list_price = 4407.89 AND (wp.wp_rec_end_date IN ('1999-09-03', '2001-09-02', '2000-09-02') OR wp.wp_creation_date_sk IN (2450815, 2450812, 2450813)) AND wr.wr_return_amt IN (78.84, 5987.96, 1527.93, 522.48, 1155.36, 2771.56) AND wr.wr_return_amt_inc_tax = 191.45 GROUP BY dd.d_year;
