SELECT cd.cd_credit_rating, wp.wp_type, AVG(ws.ws_sales_price) AS avg_sales_amount, SUM(ws.ws_ext_ship_cost) AS total_shipping_cost, AVG(ws.ws_quantity) AS avg_items_per_order, SUM(wr.wr_return_amt) AS total_return_amount, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_inc_tax FROM web_sales ws JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number WHERE cd.cd_credit_rating IN ('Unknown', 'Good', 'High Risk') AND wp.wp_url = 'http://www.foo.com' AND ws.ws_ship_customer_sk IN ('68344', '31854', '75904', '57654') AND ws.ws_ext_ship_cost = 1302.64 AND wp.wp_creation_date_sk IN ('2450810', '2450815', '2450813') AND wr.wr_refunded_customer_sk IN ('21890', '47305', '48588', '57226', '74434') AND wr.wr_order_number IN ('3277', '3156') GROUP BY cd.cd_credit_rating, wp.wp_type ORDER BY total_shipping_cost DESC, avg_sales_amount DESC;
SELECT w_country, cr_returned_date_sk AS return_date_sk, i_category, COUNT(DISTINCT cr_order_number) AS total_returns, SUM(cr_return_quantity) AS total_returned_quantity, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN promotion p ON i.i_item_sk = p.p_item_sk AND p.p_discount_active = 'N' WHERE cr.cr_returning_hdemo_sk IN (7008, 2246, 3148, 584, 6843) GROUP BY w_country, return_date_sk, i_category ORDER BY total_net_loss DESC, total_returns DESC;
SELECT dd.d_year AS fiscal_year, dd.d_quarter_name AS quarter, COUNT(DISTINCT ws.web_site_sk) AS number_of_websites, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(hd.hd_dep_count) AS avg_dependency_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, SUM(CASE WHEN hd.hd_buy_potential = '>10000' THEN 1 ELSE 0 END) AS high_buy_potential_count, AVG(ws.web_tax_percentage) AS avg_web_tax_percentage FROM date_dim dd JOIN web_site ws ON dd.d_date_sk = ws.web_open_date_sk OR dd.d_date_sk = ws.web_close_date_sk JOIN warehouse w ON ws.web_zip = w.w_zip JOIN household_demographics hd ON hd.hd_income_band_sk IS NOT NULL WHERE dd.d_fy_year IN (1913, 1900, 1909, 1901, 1902) AND dd.d_weekend = 'N' AND hd.hd_dep_count IN (3, 9, 4, 5, 2, 0) AND hd.hd_buy_potential IN ('5001-10000', '1001-5000', '>10000', 'Unknown', '0-500', '501-1000') AND w.w_warehouse_sq_ft IN (977787, 294242, 621234, 138504) AND ws.web_street_type IN ('ST', 'Drive', 'Wy') GROUP BY fiscal_year, quarter ORDER BY fiscal_year, quarter;
SELECT d_year, d_quarter_name, COUNT(DISTINCT ss_store_sk) AS num_stores, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_net_sales, AVG(ss_net_profit) AS average_net_profit_per_sale, SUM(wr_return_quantity) AS total_quantity_returned, SUM(wr_net_loss) AS total_net_loss_from_returns, SUM(CASE WHEN hd_vehicle_count = 1 THEN ss_quantity ELSE 0 END) AS quantity_sold_to_1_vehicle_households, AVG(ib_upper_bound) AS average_income_upper_bound, COUNT(DISTINCT r_reason_sk) AS num_unique_return_reasons FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN web_returns ON ss_item_sk = wr_item_sk AND ss_ticket_number = wr_order_number JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN income_band ON hd_income_band_sk = ib_income_band_sk JOIN reason ON wr_reason_sk = r_reason_sk WHERE d_moy IN ('5', '1', '8') AND d_quarter_seq IN ('2', '1', '23') AND ss_sold_time_sk IN ('39484', '37900', '53685') AND ss_cdemo_sk IN ('933209', '1833335', '684959') AND ss_promo_sk IN ('42', '2', '164') AND ss_ext_list_price IN ('528.86', '6921.13', '4979.70') GROUP BY d_year, d_quarter_name ORDER BY d_year, d_quarter_name;
SELECT w_state, w_city, ib.ib_income_band_sk AS income_band_sk, p_promo_name, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_sq_ft, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, COUNT(DISTINCT wr.wr_returned_date_sk) AS num_return_days, AVG(wr_return_amt_inc_tax) AS avg_return_amount_inc_tax FROM warehouse w JOIN web_returns wr ON w.w_warehouse_sk = wr.wr_returning_addr_sk JOIN income_band ib ON ib.ib_income_band_sk = wr.wr_returning_hdemo_sk JOIN promotion p ON p.p_item_sk = wr.wr_item_sk WHERE w_state = 'TN' AND w_city = 'Fairview' AND wr_reason_sk IN (7, 17, 21, 6) AND ib_upper_bound IN (50000, 190000, 80000) AND wr_returning_hdemo_sk IN (4812, 3393, 981, 1249) GROUP BY w_state, w_city, ib.ib_income_band_sk, p_promo_name ORDER BY total_return_amount_inc_tax DESC LIMIT 100;
SELECT ws.ws_web_site_sk, ws.ws_item_sk, i.i_product_name, i.i_category, sm.sm_type AS shipping_type, w.w_state AS warehouse_state, ca.ca_state AS customer_state, COUNT(*) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_net_profit) AS average_net_profit FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk JOIN customer_address ca ON ws.ws_ship_addr_sk = ca.ca_address_sk WHERE ca.ca_gmt_offset IN ('-8.00', '-10.00', '-5.00', '-9.00', '-7.00') AND (w.w_zip = '35709' OR w.w_zip = '31904') GROUP BY ws.ws_web_site_sk, ws.ws_item_sk, i.i_product_name, i.i_category, sm.sm_type, w.w_state, ca.ca_state ORDER BY total_net_profit DESC, total_orders DESC LIMIT 100;
SELECT s.s_state, s.s_city, ca.ca_zip, COUNT(DISTINCT p.p_promo_sk) AS num_promotions, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(s.s_number_employees) AS avg_num_employees, AVG(s.s_floor_space) AS avg_floor_space, SUM(CASE WHEN s.s_tax_precentage > 0 THEN 1 ELSE 0 END) AS stores_with_tax FROM store s LEFT JOIN inventory inv ON s.s_store_sk = inv.inv_warehouse_sk LEFT JOIN customer_address ca ON s.s_zip = ca.ca_zip LEFT JOIN promotion p ON p.p_start_date_sk <= inv.inv_date_sk AND p.p_end_date_sk >= inv.inv_date_sk WHERE s.s_state = 'TN' AND (s.s_city = 'Fairview' OR s.s_city = 'Midway') AND ca.ca_street_name IN ('Oak 4th', '13th Mill', 'Railroad 1st') AND inv.inv_item_sk IN ('15379', '8284', '9997', '14116') GROUP BY s.s_state, s.s_city, ca.ca_zip ORDER BY s.s_state, s.s_city, ca.ca_zip;
SELECT s.s_store_name, ib.hd_income_band_sk, hd.hd_buy_potential, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS transaction_count FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk LEFT JOIN household_demographics ib ON hd.hd_income_band_sk = ib.hd_income_band_sk WHERE hd.hd_income_band_sk = 9 GROUP BY s.s_store_name, ib.hd_income_band_sk, hd.hd_buy_potential ORDER BY total_sales DESC, average_sales_price DESC;
SELECT c.ca_country, c.ca_city, i.i_category_id, i.i_category, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_net_paid) AS average_sales, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(cr.cr_return_quantity) AS total_quantity_returned, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_customers_returned FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN income_band ib ON ss.ss_hdemo_sk = ib.ib_income_band_sk JOIN customer_address c ON ss.ss_addr_sk = c.ca_address_sk LEFT JOIN catalog_returns cr ON cr.cr_order_number = ss.ss_ticket_number WHERE c.ca_country = 'United States' AND (c.ca_city = 'Gravel Hill' OR c.ca_city = 'Montague') AND (ib.ib_income_band_sk IN (1, 6, 19)) AND (ss.ss_cdemo_sk IN (854925, 898884, 94461)) GROUP BY c.ca_country, c.ca_city, i.i_category_id, i.i_category, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_sales DESC, i.i_category_id;
SELECT ca.ca_city, ca.ca_state, COUNT(DISTINCT cc.cc_call_center_id) AS num_call_centers, SUM(cc.cc_employees) AS total_employees, AVG(hd.hd_dep_count) AS avg_household_dep_count, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_return_quantity) AS total_returned_items, COUNT(DISTINCT sr.sr_ticket_number) AS num_return_transactions, AVG(sr.sr_fee) AS avg_return_fee FROM call_center cc JOIN customer_address ca ON cc.cc_city = ca.ca_city AND cc.cc_state = ca.ca_state JOIN household_demographics hd ON hd.hd_income_band_sk BETWEEN 9 AND 15 JOIN store_returns sr ON sr.sr_addr_sk = ca.ca_address_sk JOIN ship_mode sm ON sm.sm_contract IN ('A5BYO1qH8HGTTN', 'Xjy3ZPuiDjzHlRx14Z3', '2mM8l', '6Hzzp4JkzjqD8MGXLCDa') WHERE ca.ca_city IN ('Lewisburg', 'Wright', 'Valley View', 'Argyle', 'Plainview', 'Andover') AND sm.sm_type = 'REGULAR' AND ca.ca_gmt_offset IN (-6.00, -9.00, -5.00, -10.00) AND (hd.hd_dep_count IN (0, 3, 7, 8, 9) OR hd.hd_dep_count IS NULL) GROUP BY ca.ca_city, ca.ca_state ORDER BY total_return_amount DESC, total_employees DESC, num_return_transactions DESC;
SELECT sm.sm_type AS shipping_mode_type, sm.sm_carrier AS carrier, cp.cp_department AS catalog_department, COUNT(DISTINCT wr.wr_order_number) AS number_of_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_return_tax) AS total_tax, SUM(wr.wr_return_ship_cost) AS total_shipping_cost, SUM(wr.wr_net_loss) AS total_net_loss FROM web_returns wr JOIN ship_mode sm ON wr.wr_returned_date_sk = sm.sm_ship_mode_sk JOIN catalog_page cp ON wr.wr_web_page_sk = cp.cp_catalog_page_sk WHERE wr.wr_returned_date_sk = 2451368 AND cp.cp_catalog_page_sk IN ('859', '3510', '105', '4419') GROUP BY shipping_mode_type, carrier, catalog_department ORDER BY total_net_loss DESC;
SELECT d_year, d_qoy, cc_name, COUNT(DISTINCT cr_order_number) AS num_returns, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, COUNT(DISTINCT sr_ticket_number) AS num_store_returns, SUM(sr_return_amt) AS total_store_return_amount, AVG(sr_return_amt) AS avg_store_return_amount, SUM(hd_dep_count) AS total_dependants, AVG(hd_vehicle_count) AS avg_vehicles FROM date_dim JOIN catalog_returns ON cr_returned_date_sk = d_date_sk JOIN call_center ON cr_call_center_sk = cc_call_center_sk JOIN store_returns ON sr_returned_date_sk = d_date_sk JOIN household_demographics ON cr_returning_hdemo_sk = hd_demo_sk AND sr_hdemo_sk = hd_demo_sk WHERE d_qoy = 2 AND d_following_holiday = 'Y' AND hd_income_band_sk = 15 AND (cr_item_sk IN (10036, 2977) OR sr_item_sk IN (10036, 2977)) AND (cr_refunded_customer_sk IN (78674, 95319, 63625, 45060, 53817, 43545) OR sr_customer_sk IN (78674, 95319, 63625, 45060, 53817, 43545)) AND cc_street_name IN ('Center Hill', 'Pine Ridge', 'Ash Hill') GROUP BY d_year, d_qoy, cc_name ORDER BY d_year, d_qoy, cc_name;
SELECT c.c_first_name, c.c_last_name, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_quantity) AS average_quantity, COUNT(DISTINCT ss.ss_ticket_number) AS total_transactions, i.i_category, s.s_store_name, sm.sm_type FROM store_sales ss JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = ss.ss_sold_date_sk WHERE c.c_customer_sk IN (179, 972, 3529, 2285, 1595) AND i.i_units = 'Tsp' AND s.s_division_name = 'Unknown' AND ss.ss_sold_date_sk BETWEEN 20000101 AND 20001231 GROUP BY c.c_first_name, c.c_last_name, i.i_category, s.s_store_name, sm.sm_type ORDER BY total_sales DESC, c.c_last_name ASC, c.c_first_name ASC;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_ext_discount_amt) AS avg_discount, COUNT(cs.cs_item_sk) AS items_sold, SUM(sr.sr_return_amt) AS total_returns, COUNT(DISTINCT p.p_promo_sk) AS distinct_promotions_used FROM customer c LEFT JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk LEFT JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE c.c_salutation = 'Mr.' AND c.c_email_address IN ('Karen.Phifer@QY.edu', 'Allen.Turner@4.com', 'Larry.Olivas@7r7DYaK8.org', 'Shelly.Yang@LQxk.edu', 'Michelle.Sonnier@UFxKCExi4F.edu', 'John.Howard@2FPvikS8CVIG.edu') AND p.p_discount_active = 'N' AND cs.cs_ext_list_price IN (2280.36, 12094.39, 702.72, 3046.89, 8066.16) AND cs.cs_net_profit IN (-3051.02, -1521.74, -449.68) AND sr.sr_reversed_charge IN (41.31, 103.80, 2.35, 10.21) AND sr.sr_return_ship_cost IN (1284.78, 122.50) GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address ORDER BY total_sales DESC, avg_discount;
SELECT i_category, i_class, web_state, web_name, avg_hd_vehicle_count, avg_ib_lower_bound, sum_i_current_price, avg_i_wholesale_cost, count_distinct_items FROM ( SELECT i.i_category, i.i_class, ws.web_state, ws.web_name, AVG(hd.hd_vehicle_count) AS avg_hd_vehicle_count, AVG(ib.ib_lower_bound) AS avg_ib_lower_bound, SUM(i.i_current_price) AS sum_i_current_price, AVG(i.i_wholesale_cost) AS avg_i_wholesale_cost, COUNT(DISTINCT i.i_item_sk) AS count_distinct_items FROM item i JOIN household_demographics hd ON i.i_manager_id = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN web_site ws ON i.i_manufact_id = ws.web_company_id WHERE i.i_category IN ('Home', 'Men', 'Women') AND i.i_class IN ('toddlers', 'basketball', 'bedding') AND hd.hd_buy_potential IN ('0-500', 'Unknown', '501-1000') AND hd.hd_vehicle_count IN (4, 3, 0) AND ws.web_state = 'TN' AND ws.web_name IN ('site_0', 'site_3', 'site_4') AND ib.ib_lower_bound IN (150001, 160001, 120001) AND ib.ib_upper_bound IN (70000, 200000, 10000) AND ib.ib_income_band_sk IN (6, 11, 18) GROUP BY i.i_category, i.i_class, ws.web_state, ws.web_name ) AS derived_table ORDER BY i_category, i_class, web_state, web_name;
SELECT c.c_first_name, c.c_last_name, cd.cd_gender, cd.cd_education_status, hd.hd_buy_potential, hd.hd_vehicle_count, COUNT(sr.sr_item_sk) AS total_returns, SUM(sr.sr_return_amt_inc_tax) AS total_return_value, AVG(sr.sr_return_amt_inc_tax) AS avg_return_value, ib.ib_lower_bound, ib.ib_upper_bound, w.w_warehouse_name, w.w_city, w.w_state, ws.web_name, ws.web_manager, COUNT(wr.wr_item_sk) AS total_web_returns, SUM(wr.wr_return_amt_inc_tax) AS total_web_return_value, AVG(wr.wr_return_amt_inc_tax) AS avg_web_return_value FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN warehouse w ON sr.sr_store_sk = w.w_warehouse_sk JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk WHERE cd.cd_credit_rating = 'Good' AND hd.hd_dep_count BETWEEN 1 AND 3 AND ib.ib_lower_bound >= 50000 AND sr.sr_return_amt > 0 AND wr.wr_return_amt > 0 AND ws.web_county = 'Williamson County' GROUP BY c.c_first_name, c.c_last_name, cd.cd_gender, cd.cd_education_status, hd.hd_buy_potential, hd.hd_vehicle_count, ib.ib_lower_bound, ib.ib_upper_bound, w.w_warehouse_name, w.w_city, w.w_state, ws.web_name, ws.web_manager ORDER BY total_return_value DESC, total_web_return_value DESC LIMIT 100;
SELECT c.c_first_name, c.c_last_name, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(s.s_number_employees) AS avg_store_employees, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages, MAX(sm.sm_code) AS max_ship_mode_code FROM customer c JOIN web_page wp ON c.c_customer_sk = wp.wp_customer_sk JOIN store s ON s.s_zip = CAST(c.c_current_addr_sk AS CHAR(10)) JOIN warehouse w ON w.w_zip = s.s_zip JOIN ship_mode sm ON sm.sm_code = w.w_zip WHERE w.w_gmt_offset = '-5.00' AND (wp.wp_char_count = '2129' OR wp.wp_char_count = '2531') AND (wp.wp_rec_end_date = '1999-09-03' OR wp.wp_rec_end_date = '2001-09-02' OR wp.wp_rec_end_date = '2000-09-02') GROUP BY c.c_first_name, c.c_last_name;
SELECT cc.cc_state, AVG(cc.cc_employees) AS avg_employees, SUM(cc.cc_sq_ft) AS total_sq_ft, COUNT(DISTINCT hd.hd_demo_sk) AS households_with_buy_potential, SUM(CASE WHEN p.p_discount_active = 'Y' THEN p.p_cost ELSE 0 END) AS total_active_promo_cost FROM call_center cc LEFT JOIN household_demographics hd ON hd.hd_income_band_sk IN (5, 1, 17, 14) AND hd.hd_buy_potential IS NOT NULL LEFT JOIN promotion p ON p.p_discount_active = 'Y' AND p.p_channel_press = 'N' WHERE cc.cc_state = 'TN' GROUP BY cc.cc_state;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, SUM(cs.cs_net_paid_inc_tax) AS total_revenue, SUM(cs.cs_net_profit) AS total_profit, AVG(cs.cs_net_paid_inc_tax) AS average_revenue_per_sale, COUNT(DISTINCT cs.cs_order_number) AS total_orders, s.s_store_name, s.s_company_name AS store_company_name FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN store s ON s.s_store_sk = cc.cc_call_center_sk WHERE cc.cc_rec_start_date <= CURRENT_DATE AND (cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date > CURRENT_DATE) AND s.s_rec_start_date <= CURRENT_DATE AND (s.s_rec_end_date IS NULL OR s.s_rec_end_date > CURRENT_DATE) AND cs.cs_net_paid_inc_tax > 300 GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, s.s_store_name, s.s_company_name ORDER BY total_revenue DESC, total_profit DESC LIMIT 100;
SELECT cs_state, SUM(cs_total_sales) AS total_sales, SUM(cr_total_returns) AS total_returns, (SUM(cs_net_profit) - SUM(cr_net_loss)) AS net_profit FROM (SELECT ca_state AS cs_state, SUM(ss_ext_sales_price) AS cs_total_sales, SUM(ss_net_profit) AS cs_net_profit FROM store_sales JOIN customer ON ss_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk GROUP BY ca_state) sales LEFT JOIN (SELECT ca_state AS cr_state, SUM(cr_return_amount) AS cr_total_returns, SUM(cr_net_loss) AS cr_net_loss FROM catalog_returns JOIN customer ON cr_returning_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk GROUP BY ca_state) returns ON sales.cs_state = returns.cr_state GROUP BY cs_state ORDER BY net_profit DESC;
SELECT c.c_first_name, c.c_last_name, ca.ca_state, w.w_warehouse_name, SUM(i.inv_quantity_on_hand) AS total_inventory, AVG(cc.cc_tax_percentage) AS average_tax_percentage, COUNT(DISTINCT cc.cc_call_center_sk) AS number_of_call_centers FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN inventory i ON ca.ca_address_sk = i.inv_warehouse_sk JOIN warehouse w ON i.inv_warehouse_sk = w.w_warehouse_sk JOIN call_center cc ON w.w_state = cc.cc_state WHERE ca.ca_state IN ('MA', 'FL') AND w.w_warehouse_id IN ('AAAAAAAADAAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAABAAAAAAA') AND cc.cc_tax_percentage IN (0.01, 0.05, 0.11, 0.12) GROUP BY c.c_first_name, c.c_last_name, ca.ca_state, w.w_warehouse_name ORDER BY total_inventory DESC, average_tax_percentage, number_of_call_centers DESC;
SELECT web.web_name AS website_name, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, t.t_shift AS sales_shift, s.s_store_name AS store_name, s.s_number_employees AS number_of_employees, s.s_city AS store_city, SUM(s.s_tax_precentage) AS total_tax_percentage_collected FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk JOIN time_dim t ON ws.ws_sold_time_sk = t.t_time_sk JOIN store s ON web.web_mkt_id = s.s_market_id WHERE web.web_mkt_id IN ('1', '4', '3') AND t.t_shift = 'third' AND s.s_gmt_offset = '-5.00' AND s.s_number_employees IN ('297', '278', '229', '245') GROUP BY web.web_name, t.t_shift, s.s_store_name, s.s_number_employees, s.s_city ORDER BY total_net_profit DESC;
SELECT cc.cc_division_name, COUNT(DISTINCT cc.cc_call_center_sk) AS num_call_centers, SUM(cc.cc_employees) AS total_employees, AVG(cc.cc_employees) AS avg_employees, SUM(cc.cc_sq_ft) AS total_square_footage, AVG(cc.cc_sq_ft) AS avg_square_footage, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages, AVG(cp.cp_catalog_number) AS avg_catalog_number, COUNT(DISTINCT r.r_reason_sk) AS num_reasons, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses, SUM(w.w_warehouse_sq_ft) AS total_warehouse_square_footage, AVG(ib.ib_lower_bound) AS avg_income_band_lower_bound, AVG(ib.ib_upper_bound) AS avg_income_band_upper_bound FROM call_center cc LEFT JOIN catalog_page cp ON cc.cc_call_center_sk = cp.cp_catalog_page_sk LEFT JOIN reason r ON cc.cc_call_center_sk = r.r_reason_sk LEFT JOIN warehouse w ON cc.cc_call_center_sk = w.w_warehouse_sk LEFT JOIN income_band ib ON cc.cc_call_center_sk = ib.ib_income_band_sk WHERE cc.cc_division_name IN ('ese', 'ought') GROUP BY cc.cc_division_name ORDER BY cc.cc_division_name;
SELECT r.r_reason_desc, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_items, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_net_loss) AS total_net_loss, SUM(cs.cs_quantity) AS total_sold_quantity, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_sales_price) AS total_sales, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_returns cr JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN catalog_sales cs ON cr.cr_item_sk = cs.cs_item_sk AND cr.cr_order_number = cs.cs_order_number WHERE cr.cr_returned_date_sk IS NOT NULL AND (cr.cr_refunded_addr_sk IN (18593, 5341, 29829) OR r.r_reason_desc IN ('reason 29', 'reason 28', 'reason 31', 'Lost my job', 'Did not get it on time')) GROUP BY r.r_reason_desc ORDER BY total_returns DESC, total_return_amount DESC;
SELECT hd.hd_buy_potential, COUNT(hd.hd_demo_sk) AS households_count, AVG(hd.hd_dep_count) AS avg_dependents_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, SUM(CASE WHEN ib.ib_lower_bound >= 60001 AND ib.ib_upper_bound <= 180001 THEN 1 ELSE 0 END) AS mid_income_band_households, SUM(CASE WHEN ib.ib_lower_bound < 60001 THEN 1 ELSE 0 END) AS low_income_band_households, SUM(CASE WHEN ib.ib_lower_bound > 180001 THEN 1 ELSE 0 END) AS high_income_band_households FROM household_demographics hd JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk GROUP BY hd.hd_buy_potential ORDER BY hd.hd_buy_potential;
SELECT dd.d_year, dd.d_quarter_name, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, COUNT(DISTINCT ca.ca_city) AS number_of_cities, COUNT(DISTINCT ws.web_site_sk) AS number_of_websites, SUM(cr.cr_return_quantity) AS total_return_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_net_loss) AS total_net_loss FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk JOIN web_site ws ON ws.web_open_date_sk = dd.d_date_sk LEFT JOIN catalog_returns cr ON cr.cr_returned_date_sk = dd.d_date_sk WHERE dd.d_year IN (2001, 2002) AND ca.ca_street_number = '789' AND ws.web_city IN ('Fairview', 'Midway') AND dd.d_quarter_seq IN (20, 49, 51) AND cr.cr_reason_sk IS NOT NULL AND EXISTS (SELECT 1 FROM reason WHERE cr_reason_sk = r_reason_sk AND r_reason_desc IN ('Gift exchange', 'Found a better price in a store', 'Not the product that was ordred')) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT cc.cc_name AS call_center_name, i.i_brand AS item_brand, sum(ws.ws_sales_price) AS total_sales, avg(ws.ws_sales_price) AS average_sales_price, count(ws.ws_order_number) AS total_orders, sum(wr.wr_return_amt) AS total_returns, avg(wr.wr_return_amt) AS average_return_amount, count(DISTINCT wr.wr_order_number) AS total_return_orders, sum(hd.hd_dep_count) AS total_dependents, sum(hd.hd_vehicle_count) AS total_vehicles FROM call_center cc JOIN web_sales ws ON cc.cc_call_center_sk = ws.ws_warehouse_sk JOIN web_returns wr ON ws.ws_item_sk = wr.wr_item_sk AND ws.ws_order_number = wr.wr_order_number JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk WHERE cc.cc_name IN ('North Midwest', 'NY Metro') AND i.i_brand_id IN ('6007005', '10003009', '4001002') AND i.i_wholesale_cost IN (24.96, 1.76, 2.66, 5.22) GROUP BY cc.cc_name, i.i_brand ORDER BY total_sales DESC, total_returns DESC;
SELECT d_year, i_brand, i_class, i_category, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, SUM(cs_net_paid) AS total_revenue, AVG(cs_net_paid_inc_tax) AS avg_revenue_inc_tax, AVG(cs_net_paid_inc_ship_tax) AS avg_revenue_inc_ship_tax, SUM(cs_net_profit) AS total_profit, COUNT(DISTINCT cs_item_sk) AS distinct_items_sold, MAX(cs_sales_price) AS max_sales_price, MIN(cs_sales_price) AS min_sales_price FROM catalog_sales JOIN date_dim ON (cs_sold_date_sk = d_date_sk) JOIN item ON (cs_item_sk = i_item_sk) JOIN time_dim ON (cs_sold_time_sk = t_time_sk) WHERE d_year = 2000 AND t_hour BETWEEN 0 AND 1 AND t_sub_shift = 'night' AND i_rec_end_date >= '1999-10-27' AND i_rec_end_date <= '2001-10-26' AND cs_sold_date_sk IN ('2450821', '2450823') GROUP BY d_year, i_brand, i_class, i_category ORDER BY total_revenue DESC;
