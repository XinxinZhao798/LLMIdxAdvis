SELECT dd.d_year, dd.d_quarter_name, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, SUM(sr.sr_return_amt_inc_tax) AS total_store_return_value, AVG(sr.sr_return_amt_inc_tax) AS avg_store_return_value, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_returns, SUM(cr.cr_return_amt_inc_tax) AS total_catalog_return_value, AVG(cr.cr_return_amt_inc_tax) AS avg_catalog_return_value, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(inv.inv_quantity_on_hand) AS avg_inventory, COUNT(DISTINCT p.p_promo_sk) AS total_promotions, SUM(p.p_cost) AS total_promotion_cost, AVG(p.p_cost) AS avg_promotion_cost FROM date_dim dd LEFT JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk LEFT JOIN catalog_returns cr ON dd.d_date_sk = cr.cr_returned_date_sk LEFT JOIN inventory inv ON dd.d_date_sk = inv.inv_date_sk LEFT JOIN promotion p ON dd.d_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk WHERE dd.d_current_quarter = 'N' AND dd.d_dow IN ('2', '1', '3') AND dd.d_week_seq IN ('357', '270', '599') AND dd.d_day_name IN ('Friday', 'Wednesday', 'Thursday') AND cr.cr_refunded_cash IN ('41.98', '2827.18', '326.60') AND cr.cr_return_tax IN ('78.35', '1.90', '17.50') AND cr.cr_reason_sk IN ('10', '6', '34') AND inv.inv_date_sk = '2450815' AND inv.inv_quantity_on_hand IN ('527', '833', '192') AND sr.sr_store_credit IN ('65.83', '69.57', '46.64') AND sr.sr_return_amt_inc_tax IN ('1345.99', '37.28', '546.00') AND sr.sr_hdemo_sk IN ('5161', '6269', '797') AND p.p_channel_radio = 'N' AND p.p_channel_press = 'N' GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_ext_discount_amt) AS total_discount_amount, COUNT(DISTINCT p.p_promo_sk) AS number_of_promotions FROM web_sales ws JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk JOIN store s ON s.s_zip = '31904' JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk WHERE wp.wp_image_count IN (2, 3, 5) AND wp.wp_autogen_flag = 'N' AND (s.s_street_name = 'Lee 6th' OR s.s_street_name = '4th') AND p.p_channel_press = 'N' AND ws.ws_bill_hdemo_sk IN (2055, 5724, 3336) AND p.p_cost = 1000.00 GROUP BY s.s_market_id;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, r.r_reason_desc, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_items, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_tax) AS total_tax, SUM(cr.cr_return_ship_cost) AS total_ship_cost, SUM(cr.cr_net_loss) AS total_net_loss FROM call_center cc JOIN catalog_returns cr ON cc.cc_call_center_sk = cr.cr_call_center_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk WHERE cc.cc_zip = '31904' AND cr.cr_return_amt_inc_tax > 0 AND r.r_reason_desc IN ('Found a better price in a store', 'its is a boy') GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, r.r_reason_desc ORDER BY total_returns DESC, total_returned_items DESC;
SELECT sm.sm_type, p.p_promo_name, hd.hd_income_band_sk, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs.cs_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(cs.cs_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk JOIN household_demographics hd ON cs.cs_ship_hdemo_sk = hd.hd_demo_sk WHERE sm.sm_ship_mode_sk IN (15, 11, 1) AND sm.sm_type IN ('TWO DAY', 'EXPRESS', 'NEXT DAY') AND p.p_channel_details IN ('Only red systems ring right b', 'Strong cells could dis', 'Finally glad reasons mobili') AND p.p_channel_dmail IN ('N', 'Y') AND p.p_promo_name LIKE '%ese%' OR p.p_promo_name LIKE '%eing%' OR p.p_promo_name LIKE '%able%' AND p.p_purpose = 'Unknown' AND hd.hd_income_band_sk IN (11, 1, 6) AND hd.hd_dep_count IN (5, 0, 2) AND cs.cs_ship_customer_sk IN (6024, 65323, 92049) AND cs.cs_ext_ship_cost IN (36.27, 943.02, 662.47) GROUP BY sm.sm_type, p.p_promo_name, hd.hd_income_band_sk ORDER BY total_net_profit DESC, avg_sales_price DESC, total_orders DESC;
SELECT i.i_category AS item_category, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, COUNT(DISTINCT ws.ws_order_number) AS number_of_orders, COUNT(DISTINCT h.hd_demo_sk) AS number_of_customers_by_demographics, sm.sm_type AS shipping_type, AVG(inv.inv_quantity_on_hand) AS average_inventory_on_hand FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk JOIN household_demographics h ON ws.ws_bill_hdemo_sk = h.hd_demo_sk WHERE i.i_category_id BETWEEN 1 AND 5 AND ws.ws_ship_mode_sk IN (6, 4, 18, 1, 5, 8) AND inv.inv_warehouse_sk IN (1, 2) AND h.hd_income_band_sk IN (20, 11, 4) GROUP BY i.i_category, sm.sm_type ORDER BY total_net_profit DESC, item_category;
SELECT ca_state, cc_division_name, AVG(cc_employees) AS avg_cc_employees, COUNT(DISTINCT cc_call_center_sk) AS num_call_centers, SUM(hd_dep_count) AS total_dependents, AVG(hd_vehicle_count) AS avg_num_vehicles, COUNT(DISTINCT c_customer_sk) AS num_customers, COUNT(CASE WHEN hd_buy_potential = '0-500' THEN 1 END) AS count_low_buy_potential, COUNT(CASE WHEN hd_buy_potential = '>10000' THEN 1 END) AS count_high_buy_potential FROM call_center JOIN customer ON c_current_cdemo_sk = cc_call_center_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk WHERE (cc_rec_end_date = '2000-12-31' OR cc_rec_end_date = '2001-12-31') AND hd_dep_count IN (4, 7, 0, 3) AND ca_street_name = 'Fourth Lakeview' GROUP BY ca_state, cc_division_name ORDER BY ca_state, cc_division_name;
SELECT ca_state, count(*) AS address_count, avg(ca_gmt_offset) AS average_gmt_offset, sm_type, sm_carrier, count(DISTINCT sm_ship_mode_sk) AS unique_ship_mode_count, ib_lower_bound, ib_upper_bound, sum(CASE WHEN ib_upper_bound <= 20000 THEN 1 ELSE 0 END) AS low_income_band_count, sum(CASE WHEN ib_upper_bound > 20000 AND ib_upper_bound <= 40000 THEN 1 ELSE 0 END) AS mid_income_band_count, sum(CASE WHEN ib_upper_bound > 170000 THEN 1 ELSE 0 END) AS high_income_band_count, avg(ib_lower_bound + ib_upper_bound) / 2 AS average_income_band FROM customer_address JOIN ship_mode ON ca_zip = left(sm_ship_mode_id, 5) JOIN income_band ON ib_income_band_sk::text = right(sm_ship_mode_id, length(sm_ship_mode_id) - 5) GROUP BY ca_state, sm_type, sm_carrier, ib_lower_bound, ib_upper_bound ORDER BY ca_state, sm_type, sm_carrier, ib_lower_bound;
SELECT c.c_customer_sk, ca.ca_state, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(hd.hd_dep_count) AS avg_dependency_count, COUNT(DISTINCT w.w_warehouse_sk) AS number_of_warehouses, MAX(t.t_time) AS latest_time FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN inventory inv ON inv.inv_warehouse_sk = ca.ca_address_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN time_dim t ON inv.inv_date_sk = t.t_time_sk WHERE ca.ca_state IN ('TX', 'NV') AND hd.hd_vehicle_count = 2 AND t.t_sub_shift = 'night' AND c.c_birth_month IN (2, 9, 12, 4, 5) AND c.c_birth_year IN (1928, 1924) GROUP BY c.c_customer_sk, ca.ca_state ORDER BY total_inventory DESC, avg_dependency_count, number_of_warehouses, latest_time;
SELECT ca.ca_state, ca.ca_country, COUNT(DISTINCT c.c_customer_sk) AS num_customers, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_return_tax) AS total_return_tax, AVG(sr.sr_return_amt) AS avg_return_amount_per_customer, SUM(sr.sr_net_loss) AS total_net_loss FROM customer c JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN income_band ib ON c.c_current_hdemo_sk = ib.ib_income_band_sk WHERE c.c_preferred_cust_flag = 'Y' AND ib.ib_income_band_sk IN (2, 6, 14, 17, 19) AND ib.ib_upper_bound <= 30000 GROUP BY ca.ca_state, ca.ca_country ORDER BY total_return_amount DESC, ca.ca_state, ca.ca_country;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, AVG(cc.cc_employees) AS average_employee_count, SUM(cc.cc_sq_ft) AS total_call_center_sq_ft, COUNT(DISTINCT w.w_warehouse_sk) AS number_of_warehouses, AVG(w.w_warehouse_sq_ft) AS average_warehouse_sq_ft, SUM(wp.wp_link_count) AS total_web_page_link_count, COUNT(DISTINCT cp.cp_catalog_page_sk) AS number_of_catalog_pages FROM call_center cc LEFT JOIN warehouse w ON cc.cc_city = w.w_city AND cc.cc_state = w.w_state LEFT JOIN web_page wp ON wp.wp_url LIKE '%' || cc.cc_state || '%' LEFT JOIN catalog_page cp ON cc.cc_division = cp.cp_catalog_number WHERE cc.cc_class IN ('small', 'medium', 'large') AND wp.wp_autogen_flag = 'N' AND cp.cp_start_date_sk IN ('2451636', '2451271') AND w.w_suite_number = 'Suite 0' AND w.w_warehouse_sq_ft IN ('621234', '294242', '977787', '138504') GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_call_center_sq_ft DESC, average_employee_count DESC LIMIT 100;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_class, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, COUNT(DISTINCT cp.cp_catalog_page_sk) AS catalog_pages_used, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_including_tax, SUM(ss.ss_net_profit) AS total_net_profit, AVG(t.t_hour) AS average_hour_of_sale FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN catalog_page cp ON c.c_current_cdemo_sk = cp.cp_catalog_page_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE (cc.cc_rec_start_date IS NULL OR cc.cc_rec_start_date <= CURRENT_DATE) AND (cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date >= CURRENT_DATE) AND t.t_second IN ('16', '11') AND ss.ss_hdemo_sk IN ('1989', '6188') AND c.c_current_hdemo_sk IN ('3971', '3131', '4808', '7162', '6897', '2935') AND cc.cc_call_center_sk = 5 GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_class ORDER BY total_net_profit DESC, average_sales_price DESC;
SELECT cd.cd_gender, ib.ib_lower_bound AS income_lower_bound, ib.ib_upper_bound AS income_upper_bound, sm.sm_type AS shipping_type, COUNT(sr.sr_return_amt) AS total_returns, SUM(sr.sr_return_amt) AS total_value_of_returns, AVG(sr.sr_return_amt) AS average_return_value, SUM(sr.sr_return_quantity) AS total_quantity_returned FROM store_returns sr JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound JOIN ship_mode sm ON sm.sm_ship_mode_sk = sr.sr_item_sk WHERE sm.sm_type IN ('OVERNIGHT') AND cd.cd_gender IN ('M', 'F') GROUP BY cd.cd_gender, income_lower_bound, income_upper_bound, shipping_type ORDER BY total_value_of_returns DESC, total_returns DESC;
SELECT s.s_state, w.w_country, p.p_promo_name, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN warehouse w ON s.s_state = w.w_state LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk AND p.p_channel_catalog = 'N' GROUP BY s.s_state, w.w_country, p.p_promo_name ORDER BY s.s_state, w.w_country, p.p_promo_name;
SELECT ca_state, EXTRACT(YEAR FROM d_date) AS sale_year, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, SUM(cs_ext_sales_price) AS total_sales, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_net_profit) AS total_profit FROM catalog_sales JOIN customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN date_dim ON cs_sold_date_sk = d_date_sk WHERE ca_country = 'United States' AND ca_state IN ('LA', 'NC', 'KS', 'MI') AND cs_ext_sales_price > 100.00 AND cs_ext_sales_price < 15000.00 AND d_year = 2022 AND d_moy BETWEEN 1 AND 6 GROUP BY ca_state, sale_year ORDER BY total_sales DESC;
