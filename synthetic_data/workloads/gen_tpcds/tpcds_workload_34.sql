SELECT dd.d_year AS sale_year, dd.d_moy AS sale_month, dd.d_dom AS sale_day, COUNT(DISTINCT ss.ss_ticket_number) AS store_sales_count, SUM(ss.ss_quantity) AS store_items_sold, AVG(ss.ss_sales_price) AS avg_store_sale_price, SUM(cs.cs_net_paid_inc_tax) AS catalog_total_revenue_inc_tax, SUM(ws.ws_net_paid_inc_ship_tax) AS web_total_revenue_inc_ship_tax, AVG(cc.cc_employees) AS avg_call_center_employees, ws.ws_web_site_sk, web_site.web_name FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN catalog_sales cs ON ss.ss_sold_date_sk = cs.cs_sold_date_sk JOIN web_sales ws ON ss.ss_sold_date_sk = ws.ws_sold_date_sk JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk JOIN web_site ON ws.ws_web_site_sk = web_site.web_site_sk WHERE dd.d_year = 2000 AND ss.ss_list_price BETWEEN 100 AND 200 AND ws.ws_quantity IN (64, 84, 57) AND cc.cc_open_date_sk IS NOT NULL AND ws.ws_web_page_sk IN (211, 510, 171, 90, 132, 78) AND dd.d_last_dom IN ('2418669', '2418489', '2415993', '2419340', '2418000', '2417392') GROUP BY sale_year, sale_month, sale_day, ws.ws_web_site_sk, web_site.web_name ORDER BY sale_year, sale_month, sale_day, ws.ws_web_site_sk;
SELECT cp.cp_department, AVG(cr.cr_return_amt_inc_tax) AS avg_return_amount, SUM(cr.cr_return_quantity) AS total_return_quantity, COUNT(cr.cr_item_sk) AS return_count, AVG(t.t_time) AS avg_time_spent_on_page FROM catalog_returns cr JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN customer c ON cr.cr_returning_customer_sk = c.c_customer_sk JOIN web_page wp ON c.c_customer_sk = wp.wp_customer_sk JOIN time_dim t ON cr.cr_returned_time_sk = t.t_time_sk WHERE c.c_preferred_cust_flag = 'Y' AND cp.cp_catalog_number IN (4, 47) AND cp.cp_catalog_page_id IN ('AAAAAAAALNKAAAAA', 'AAAAAAAAEHFAAAAA', 'AAAAAAAAMAIAAAAA', 'AAAAAAAAAAKAAAAA') AND wp.wp_web_page_sk IN (57, 25, 50, 44, 55) AND wp.wp_customer_sk IN (10897, 84146, 37285, 92078) AND t.t_time_id IN ('AAAAAAAAAKCBAAAA', 'AAAAAAAACKOAAAAA') GROUP BY cp.cp_department ORDER BY avg_return_amount DESC, total_return_quantity DESC, return_count DESC;
SELECT s_store_name, s_state, s_city, d_fy_year, ca_location_type, SUM(ss_quantity) AS total_items_sold, SUM(ss_net_paid) AS total_sales, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(CASE WHEN d_holiday = 'Y' THEN ss_quantity ELSE 0 END) AS holiday_items_sold, SUM(CASE WHEN d_holiday = 'Y' THEN ss_net_paid ELSE 0 END) AS holiday_sales FROM store_sales JOIN store ON store.s_store_sk = store_sales.ss_store_sk JOIN date_dim ON date_dim.d_date_sk = store_sales.ss_sold_date_sk JOIN customer_address ON customer_address.ca_address_sk = store_sales.ss_addr_sk WHERE d_fy_year = (SELECT MAX(d_fy_year) FROM date_dim WHERE d_current_year = 'Y') AND store_sales.ss_list_price BETWEEN 51.03 AND 142.73 AND store_sales.ss_hdemo_sk IN ('3633', '6235', '1050') AND customer_address.ca_location_type IN ('single family', 'apartment') GROUP BY s_store_name, s_state, s_city, d_fy_year, ca_location_type ORDER BY total_sales DESC, s_store_name, s_state, s_city;
SELECT d_year, d_quarter_name, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN date_dim ON catalog_sales.cs_sold_date_sk = date_dim.d_date_sk JOIN customer ON catalog_sales.cs_bill_customer_sk = customer.c_customer_sk JOIN warehouse ON catalog_sales.cs_warehouse_sk = warehouse.w_warehouse_sk WHERE d_year = 2003 AND d_quarter_seq IN (1, 27, 15, 31, 53, 21) AND c_birth_country = 'United States' AND w_country = 'United States' GROUP BY d_year, d_quarter_name ORDER BY d_year, d_quarter_name;
SELECT c.cc_name, c.cc_city, c.cc_state, AVG(c.cc_employees) AS avg_employees, COUNT(DISTINCT c.cc_call_center_id) AS total_call_centers, SUM(hd.hd_vehicle_count) AS total_vehicles, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, COUNT(DISTINCT sm.sm_ship_mode_id) AS total_ship_modes, MAX(cd.cd_credit_rating) AS max_credit_rating FROM call_center c JOIN household_demographics hd ON c.cc_call_center_sk = hd.hd_demo_sk JOIN customer_demographics cd ON hd.hd_demo_sk = cd.cd_demo_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = c.cc_call_center_sk WHERE c.cc_state IN ('TX', 'CA', 'NY') AND cd.cd_purchase_estimate BETWEEN 7000 AND 8000 AND sm.sm_contract IN ('2mM8l', 'yVfotg7Tio3MVhBg6Bkn', 'HVDFCcQ') AND hd.hd_buy_potential IN ('>10000', '5001-10000', '1001-5000', 'Unknown') AND hd.hd_vehicle_count BETWEEN 0 AND 3 GROUP BY c.cc_name, c.cc_city, c.cc_state ORDER BY avg_employees DESC, total_call_centers DESC;
SELECT cd.cd_education_status, cd.cd_credit_rating, AVG(sr.sr_return_amt) AS avg_store_return_amt, SUM(cr.cr_return_amount) AS sum_catalog_return_amt, COUNT(DISTINCT sr.sr_customer_sk) AS unique_store_customers, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_catalog_customers FROM customer_demographics cd LEFT JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk LEFT JOIN catalog_returns cr ON cd.cd_demo_sk = cr.cr_returning_cdemo_sk LEFT JOIN household_demographics hd ON cd.cd_demo_sk = hd.hd_demo_sk WHERE cd.cd_purchase_estimate IN (3500, 1500, 10000) AND cd.cd_dep_college_count = 0 AND hd.hd_income_band_sk IN (19, 8, 15, 3, 1) GROUP BY cd.cd_education_status, cd.cd_credit_rating ORDER BY avg_store_return_amt DESC, sum_catalog_return_amt DESC;
SELECT s.s_store_name, s.s_city, s.s_state, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_quantity) AS average_quantity_sold, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_ext_sales_price) AS total_sales, sm.sm_carrier, sm.sm_type, COUNT(DISTINCT ws.ws_item_sk) AS total_items_sold, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT ws.ws_bill_customer_sk) AS total_customers, cp.cp_department, cp.cp_catalog_number, COUNT(DISTINCT cp.cp_catalog_page_sk) AS total_catalog_pages FROM store s JOIN web_sales ws ON s.s_store_sk = ws.ws_warehouse_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN income_band ib ON ws.ws_bill_cdemo_sk = ib.ib_income_band_sk JOIN catalog_page cp ON ws.ws_web_page_sk = cp.cp_catalog_page_sk JOIN web_site w ON ws.ws_web_site_sk = w.web_site_sk WHERE s.s_company_id = '1' AND s.s_county = 'Williamson County' AND ws.ws_ship_addr_sk IN ('9319', '42828', '27709') AND ws.ws_net_profit IN ('1416.80', '918.75', '-485.10') AND sm.sm_carrier IN ('ZOUROS', 'HARMSTORF', 'GERMA') AND sm.sm_ship_mode_sk IN ('11', '3', '9') AND sm.sm_code IN ('BIKE', 'SURFACE', 'AIR') AND w.web_rec_start_date IN ('1999-08-17', '2001-08-16', '2000-08-16') AND w.web_suite_number IN ('Suite 130', 'Suite 150', 'Suite R') AND w.web_tax_percentage IN ('0.01', '0.10', '0.12') AND w.web_company_name IN ('able', 'cally', 'pri') AND ib.ib_upper_bound IN ('110000', '190000', '130000') AND ib.ib_income_band_sk IN ('8', '15', '6') AND ib.ib_lower_bound IN ('20001', '100001', '10001') AND cp.cp_catalog_number IN ('10', '44', '19') AND cp.cp_department = 'DEPARTMENT' AND cp.cp_catalog_page_number IN ('49', '102', '25') AND cp.cp_catalog_page_sk IN ('3484', '375', '1590') GROUP BY s.s_store_name, s.s_city, s.s_state, sm.sm_carrier, sm.sm_type, ib.ib_lower_bound, ib.ib_upper_bound, cp.cp_department, cp.cp_catalog_number ORDER BY total_net_profit DESC, total_sales DESC, total_orders DESC;
SELECT td.t_shift, sum(ws.ws_quantity) AS total_quantity_sold, avg(ws.ws_sales_price) AS average_sales_price, count(distinct ws.ws_order_number) AS total_orders, count(distinct hd.hd_demo_sk) AS unique_customers, sum(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk WHERE ws.ws_sold_date_sk IS NOT NULL AND ws.ws_warehouse_sk IN (1, 2) AND hd.hd_demo_sk IN (821, 42, 4135, 4677, 808) GROUP BY ROLLUP(td.t_shift) ORDER BY total_net_profit DESC, td.t_shift;
SELECT cs.cs_order_number AS order_number, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_profit) AS total_net_profit, COUNT(DISTINCT cs.cs_bill_customer_sk) AS unique_customers, ib.ib_lower_bound AS income_lower_bound, ib.ib_upper_bound AS income_upper_bound, SUM(ws.ws_quantity) AS web_total_quantity, AVG(ws.ws_sales_price) AS web_average_sales_price, SUM(ws.ws_net_paid) AS web_total_net_paid, SUM(ws.ws_net_profit) AS web_total_net_profit, COUNT(DISTINCT ws.ws_bill_customer_sk) AS web_unique_customers FROM catalog_sales cs JOIN income_band ib ON cs.cs_bill_hdemo_sk = ib.ib_income_band_sk JOIN web_sales ws ON cs.cs_item_sk = ws.ws_item_sk AND cs.cs_order_number = ws.ws_order_number WHERE cs.cs_ext_tax IN (0.56, 96.57, 30.68, 46.59, 64.13) AND ib.ib_income_band_sk IN (19, 17, 16, 10, 1) GROUP BY cs.cs_order_number, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_net_profit DESC, web_total_net_profit DESC LIMIT 100;
SELECT ca.ca_state, ca.ca_country, COUNT(DISTINCT c.c_customer_sk) AS num_customers, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_return_tax) AS total_return_tax, AVG(sr.sr_return_amt) AS avg_return_amount_per_customer, SUM(sr.sr_net_loss) AS total_net_loss FROM customer c JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN income_band ib ON c.c_current_hdemo_sk = ib.ib_income_band_sk WHERE c.c_preferred_cust_flag = 'Y' AND ib.ib_income_band_sk IN (2, 6, 14, 17, 19) AND ib.ib_upper_bound <= 30000 GROUP BY ca.ca_state, ca.ca_country ORDER BY total_return_amount DESC, ca.ca_state, ca.ca_country;
SELECT cp.cp_department, COUNT(DISTINCT ss.ss_item_sk) AS num_products_sold, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid_inc_tax) AS total_sales, AVG(ss.ss_sales_price) AS average_sales_price FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN catalog_page cp ON ss.ss_item_sk = cp.cp_catalog_page_sk JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk WHERE s.s_floor_space IN (6995995, 9078805) AND s.s_market_desc IN ('Mysterious employe', 'Little expectations include yet forward meetings.', 'Events develop i', 'Architects coul') AND p.p_discount_active = '1' AND cd.cd_dep_count IN (1, 2) AND cd.cd_marital_status IN ('D', 'U', 'S', 'M', 'W') AND ss.ss_ext_discount_amt IN (24.03, 205.34) GROUP BY cp.cp_department ORDER BY total_sales DESC;
SELECT c.cc_class, c.cc_city, AVG(c.cc_employees) AS avg_employees, AVG(c.cc_sq_ft) AS avg_sq_ft, AVG(c.cc_tax_percentage) AS avg_tax_percentage, i.i_class, i.i_category, AVG(i.i_current_price) AS avg_current_price, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, COUNT(DISTINCT s.s_store_sk) AS total_stores, AVG(s.s_floor_space) AS avg_floor_space FROM call_center c JOIN item i ON c.cc_class = i.i_class JOIN store s ON c.cc_city = s.s_city WHERE c.cc_open_date_sk IS NOT NULL AND c.cc_rec_start_date <= CURRENT_DATE AND (c.cc_rec_end_date IS NULL OR c.cc_rec_end_date > CURRENT_DATE) AND i.i_rec_start_date <= CURRENT_DATE AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date > CURRENT_DATE) AND s.s_rec_start_date <= CURRENT_DATE AND (s.s_rec_end_date IS NULL OR s.s_rec_end_date > CURRENT_DATE) GROUP BY c.cc_class, c.cc_city, i.i_class, i.i_category ORDER BY avg_employees DESC, avg_current_price DESC;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, dd.d_year, SUM(ws.ws_ext_sales_price) AS total_sales, AVG(ws.ws_ext_sales_price) AS avg_sales, COUNT(*) AS number_of_sales, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_return_amount) AS avg_returns, COUNT(DISTINCT cr.cr_order_number) AS number_of_returns FROM web_sales ws JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk LEFT JOIN catalog_returns cr ON cr.cr_returned_date_sk = dd.d_date_sk AND cr.cr_refunded_customer_sk = c.c_customer_sk WHERE dd.d_year = 2001 GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, dd.d_year ORDER BY total_sales DESC, total_returns DESC LIMIT 100;
SELECT dd.d_year, dd.d_quarter_name, ib.ib_lower_bound, ib.ib_upper_bound, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk WHERE wp.wp_type = 'welcome' AND wp.wp_autogen_flag = 'N' AND dd.d_quarter_seq IN (SELECT DISTINCT d_quarter_seq FROM date_dim WHERE d_year = 2023) AND td.t_hour BETWEEN 8 AND 20 GROUP BY dd.d_year, dd.d_quarter_name, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY dd.d_year, dd.d_quarter_name, ib.ib_lower_bound, ib.ib_upper_bound;
SELECT d_year, web_name, COUNT(DISTINCT ws_order_number) AS total_orders, SUM(ws_quantity) AS total_quantity_sold, AVG(ws_net_paid_inc_tax) AS average_net_paid_inc_tax, SUM(ws_net_profit) AS total_net_profit FROM web_sales JOIN web_site ON web_sales.ws_web_site_sk = web_site.web_site_sk JOIN date_dim ON web_sales.ws_sold_date_sk = date_dim.d_date_sk WHERE d_year IN (1911, 1912) AND ws_net_paid_inc_tax > 100 AND ws_wholesale_cost < 100 AND web_sales.ws_web_site_sk IN ( SELECT web_site_sk FROM web_site WHERE web_class = 'Platinum' ) GROUP BY d_year, web_name ORDER BY total_net_profit DESC, d_year, web_name;
SELECT p.p_promo_name, avg(cs.cs_sales_price) AS avg_sales_price, sum(cs.cs_ext_discount_amt) AS total_discount_amount, sum(cs.cs_net_profit) AS total_net_profit, cd.cd_gender, cd.cd_education_status, count(cs.cs_order_number) AS total_orders FROM catalog_sales cs JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk WHERE p.p_channel_email = 'N' AND d.d_year = 2022 GROUP BY p.p_promo_name, cd.cd_gender, cd.cd_education_status ORDER BY total_net_profit DESC;
SELECT s.s_store_name, s.s_city, s.s_state, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN warehouse w ON s.s_zip = w.w_zip JOIN ship_mode sm ON w.w_country = sm.sm_carrier WHERE ss.ss_sold_date_sk BETWEEN 2451189 AND 2451200 AND ss.ss_quantity > 50 GROUP BY s.s_store_name, s.s_city, s.s_state ORDER BY total_net_profit DESC, total_quantity_sold DESC LIMIT 10;
SELECT ca.ca_city, ca.ca_county, AVG(hd.hd_income_band_sk) AS avg_income_band, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, COUNT(DISTINCT wp.wp_web_page_sk) AS num_web_pages_created, COUNT(DISTINCT wp.wp_access_date_sk) AS num_web_pages_accessed, AVG(wp.wp_char_count) AS avg_web_page_char_count FROM customer_address ca JOIN household_demographics hd ON ca.ca_address_sk = hd.hd_demo_sk LEFT JOIN web_page wp ON ca.ca_address_sk = wp.wp_customer_sk WHERE ca.ca_city IN ('Morgantown', 'Forestville', 'Sutton', 'Mount Olive', 'Texas', 'Bridgeport') AND ca.ca_county IN ('Carlton County', 'Bonneville County') AND wp.wp_type IN ('blog', 'article', 'product_review') AND wp.wp_autogen_flag = 'N' GROUP BY ca.ca_city, ca.ca_county ORDER BY ca.ca_city, ca.ca_county;
SELECT d_year, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT sr_customer_sk) AS unique_customers_returning, COUNT(DISTINCT p_promo_sk) AS distinct_promotions, SUM(inv_quantity_on_hand) AS total_inventory_quantity, COUNT(DISTINCT cp_catalog_page_sk) AS num_catalog_pages FROM store_returns JOIN date_dim ON store_returns.sr_returned_date_sk = date_dim.d_date_sk JOIN promotion ON store_returns.sr_item_sk = promotion.p_item_sk JOIN inventory ON store_returns.sr_item_sk = inventory.inv_item_sk JOIN catalog_page ON promotion.p_item_sk = catalog_page.cp_catalog_page_sk WHERE d_fy_year IN ('1900', '1901', '1902', '1904', '1910', '1912') AND p_channel_tv = 'N' AND sr_return_time_sk IN ('42714', '34148', '59678') AND inv_item_sk IN ('9572', '12640', '8512', '13724') AND inv_warehouse_sk IN ('1', '2') GROUP BY d_year ORDER BY d_year;
SELECT d_year, p_channel_details, COUNT(DISTINCT ws_order_number) AS web_order_count, SUM(ws_net_paid) AS total_web_sales, SUM(ws_net_profit) AS total_web_profit, AVG(ws_quantity) AS average_quantity_sold, SUM(ss_net_paid) AS total_store_sales, SUM(ss_net_profit) AS total_store_profit, AVG(ss_quantity) AS average_store_quantity_sold FROM web_sales JOIN store_sales ON ws_item_sk = ss_item_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN promotion ON ws_promo_sk = p_promo_sk WHERE d_year IN (1902, 1903, 1904) AND p_channel_details IS NOT NULL AND (ws_net_paid > 0 OR ss_net_paid > 0) GROUP BY d_year, p_channel_details ORDER BY d_year, p_channel_details;
SELECT s.s_store_name, s.s_state, cc.cc_name AS call_center_name, cc.cc_class, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_quantity) AS average_return_quantity, COUNT(DISTINCT sr.sr_customer_sk) AS unique_customers_returning, COUNT(*) AS total_returns FROM store_returns sr JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN call_center cc ON s.s_market_id = cc.cc_mkt_id WHERE sr.sr_return_amt > 0 AND s.s_rec_end_date IN ('1999-03-13', '2000-03-12') AND s.s_floor_space IN (9294113, 5285950, 6995995, 5219562) AND sr.sr_store_sk IN (4, 2, 1, 10, 7) AND cc.cc_country = 'United States' GROUP BY s.s_store_name, s.s_state, cc.cc_name, cc.cc_class ORDER BY total_return_amount DESC, s.s_store_name, cc.cc_name;
SELECT s.s_store_name, s.s_city, s.s_state, s_market_desc, AVG(s.s_number_employees) AS average_employees, AVG(s.s_floor_space) AS average_floor_space, COUNT(DISTINCT s.s_store_sk) AS total_stores, SUM(wp.wp_char_count) AS total_char_count, SUM(wp.wp_link_count) AS total_link_count, SUM(wp.wp_image_count) AS total_image_count, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages, AVG(ib.ib_upper_bound - ib.ib_lower_bound) AS average_income_band_range FROM store s JOIN web_page wp ON s.s_store_sk = wp.wp_customer_sk LEFT JOIN income_band ib ON s.s_market_id = ib.ib_income_band_sk WHERE s.s_rec_start_date <= CURRENT_DATE AND (s.s_rec_end_date IS NULL OR s.s_rec_end_date > CURRENT_DATE) AND (wp.wp_web_page_sk = 33 OR wp.wp_web_page_sk = 6) GROUP BY s.s_store_name, s.s_city, s.s_state, s_market_desc ORDER BY s.s_state, s.s_city, s.s_store_name;
