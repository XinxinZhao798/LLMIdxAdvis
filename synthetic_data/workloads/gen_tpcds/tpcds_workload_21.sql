SELECT cp_type, sm_type, w_city, w_state, SUM(cs_sales_price) AS total_sales, COUNT(DISTINCT cs_order_number) AS number_of_sales_orders, SUM(cr_return_amount) AS total_returns, COUNT(DISTINCT cr_order_number) AS number_of_return_orders, (SUM(cs_sales_price) - SUM(cr_return_amount)) AS net_sales, AVG(cs_sales_price) AS average_sales_price, CASE WHEN SUM(cs_sales_price) > 0 THEN SUM(cr_return_amount) / SUM(cs_sales_price) ELSE 0 END AS return_rate FROM catalog_sales JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk LEFT JOIN catalog_returns ON cs_order_number = cr_order_number GROUP BY cp_type, sm_type, w_city, w_state ORDER BY cp_type, sm_type, w_city, w_state;
SELECT COALESCE(customer_sales.cd_gender, customer_returns.cd_gender) AS cd_gender, SUM(total_sales) AS total_sales_amount, AVG(average_sales) AS average_sales_amount, COUNT(DISTINCT customer_sales.c_customer_sk) AS number_of_customers, SUM(total_returns) AS total_returns_amount, AVG(average_returns) AS average_returns_amount, COUNT(DISTINCT customer_returns.c_customer_sk) AS number_of_returning_customers FROM ( SELECT c_customer_sk, cd_gender, ss_sold_date_sk, SUM(ss_sales_price) AS total_sales, AVG(ss_sales_price) AS average_sales FROM customer JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk JOIN store_sales ON ss_customer_sk = c_customer_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year = 2023 AND cd_gender IN ('M', 'F') GROUP BY c_customer_sk, cd_gender, ss_sold_date_sk ) AS customer_sales FULL OUTER JOIN ( SELECT c_customer_sk, cd_gender, sr_returned_date_sk, SUM(sr_return_amt) AS total_returns, AVG(sr_return_amt) AS average_returns FROM customer JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk JOIN store_returns ON sr_customer_sk = c_customer_sk JOIN date_dim ON sr_returned_date_sk = d_date_sk WHERE d_year = 2023 AND cd_gender IN ('M', 'F') GROUP BY c_customer_sk, cd_gender, sr_returned_date_sk ) AS customer_returns ON customer_sales.c_customer_sk = customer_returns.c_customer_sk GROUP BY COALESCE(customer_sales.cd_gender, customer_returns.cd_gender);
SELECT i.i_category, COUNT(DISTINCT cs.cs_order_number) AS total_catalog_orders, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, AVG(cs.cs_sales_price) AS avg_catalog_sales_price, AVG(ws.ws_sales_price) AS avg_web_sales_price, SUM(cs.cs_net_profit) AS total_catalog_net_profit, SUM(ws.ws_net_profit) AS total_web_net_profit, SUM(CASE WHEN cs.cs_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS promo_catalog_sales, SUM(CASE WHEN ws.ws_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS promo_web_sales, COUNT(DISTINCT d.d_date_sk) AS days_in_Q4 FROM item i LEFT JOIN catalog_sales cs ON i.i_item_sk = cs.cs_item_sk LEFT JOIN web_sales ws ON i.i_item_sk = ws.ws_item_sk LEFT JOIN date_dim d ON (cs.cs_sold_date_sk = d.d_date_sk OR ws.ws_sold_date_sk = d.d_date_sk) WHERE d.d_quarter_name = 'Q4' GROUP BY i.i_category ORDER BY total_catalog_net_profit DESC, total_web_net_profit DESC;
SELECT sm.sm_ship_mode_id, sm.sm_type, sm.sm_carrier, COUNT(DISTINCT cr.cr_order_number) AS total_orders_returned, SUM(cr.cr_return_quantity) AS total_quantity_returned, AVG(cr.cr_return_amt_inc_tax) AS avg_refunded_amount_inc_tax, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN time_dim t ON cr.cr_returned_time_sk = t.t_time_sk JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk WHERE d.d_year = 2003 AND sm.sm_carrier IN ('HARMSTORF', 'TBS', 'ZOUROS', 'MSC', 'DIAMOND', 'AIRBORNE') GROUP BY sm.sm_ship_mode_id, sm.sm_type, sm.sm_carrier ORDER BY total_net_loss DESC;
SELECT cp.cp_department, cp.cp_catalog_number, ca.ca_state, cd.cd_education_status, COUNT(DISTINCT c.c_customer_sk) AS number_of_customers, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN catalog_page cp ON cp.cp_catalog_number = ANY('{42, 25, 9}'::integer[]) WHERE cd.cd_education_status = 'College' AND ca.ca_street_number IN ('2', '843', '939', '802', '540') AND sr.sr_returned_date_sk IS NOT NULL GROUP BY cp.cp_department, cp.cp_catalog_number, ca.ca_state, cd.cd_education_status ORDER BY total_net_loss DESC, total_returned_quantity DESC;
SELECT s.s_store_name, i.i_category, r.r_reason_desc, COUNT(DISTINCT wr_order_number) AS total_returns, SUM(wr_return_quantity) AS total_returned_quantity, AVG(wr_return_amt) AS avg_return_amount, AVG(wr_return_ship_cost) AS avg_shipping_cost, SUM(wr_net_loss) AS total_net_loss FROM web_returns wr JOIN store s ON s.s_store_sk = wr.wr_refunded_addr_sk JOIN item i ON i.i_item_sk = wr.wr_item_sk JOIN reason r ON r.r_reason_sk = wr.wr_reason_sk WHERE s.s_market_id = 7 AND s.s_rec_start_date IN ('2001-03-13', '1997-03-13') AND i.i_manager_id = 52 AND wr.wr_reason_sk = 13 GROUP BY ROLLUP(s.s_store_name, i.i_category, r.r_reason_desc) ORDER BY s.s_store_name, i.i_category, r.r_reason_desc;
SELECT d_year, d_quarter_name, ca_state, COUNT(DISTINCT ws_order_number) AS total_orders, SUM(ws_quantity) AS total_quantity, AVG(ws_sales_price) AS average_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_profit) AS total_net_profit, SUM(ws_ext_tax) AS total_tax_collected FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN customer_address ON ws_bill_addr_sk = ca_address_sk JOIN customer_demographics ON ws_bill_cdemo_sk = cd_demo_sk JOIN catalog_page ON ws_web_page_sk = cp_catalog_page_sk JOIN store ON ws_warehouse_sk = s_store_sk WHERE d_current_quarter = 'N' AND cd_dep_employed_count = 0 AND cp_department = 'DEPARTMENT' AND ws_order_number IN ('25231', '23240', '18952', '15512', '28993', '33703') GROUP BY d_year, d_quarter_name, ca_state ORDER BY d_year, d_quarter_name, ca_state;
SELECT p.p_promo_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_net_paid) AS avg_net_paid, SUM(cs.cs_net_paid_inc_tax) AS sum_net_paid_inc_tax, SUM(ws.ws_net_profit) AS sum_web_net_profit, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_fee) AS avg_return_fee FROM catalog_sales cs JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN web_sales ws ON cs.cs_order_number = ws.ws_order_number AND cs.cs_item_sk = ws.ws_item_sk LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk WHERE cd.cd_credit_rating IN ('Good', 'Unknown') AND p.p_discount_active = 'N' AND cs.cs_net_paid_inc_tax NOT IN ('5209.58', '3100.79') AND NOT EXISTS ( SELECT 1 FROM reason r WHERE r.r_reason_sk = wr.wr_reason_sk AND r.r_reason_desc LIKE 'Wrong size' ) GROUP BY p.p_promo_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY sum_net_paid_inc_tax DESC, total_orders DESC;
SELECT sm.sm_type AS shipping_type, cc.cc_name AS call_center_name, COUNT(ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, SUM(CASE WHEN cd.cd_credit_rating = 'High Risk' THEN ws.ws_net_profit ELSE 0 END) AS high_risk_profit, SUM(CASE WHEN cd.cd_credit_rating = 'Low Risk' THEN ws.ws_net_profit ELSE 0 END) AS low_risk_profit, COUNT(DISTINCT cd.cd_demo_sk) AS unique_customers FROM web_sales ws JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN call_center cc ON ws.ws_order_number = cc.cc_call_center_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk GROUP BY shipping_type, call_center_name ORDER BY total_net_profit DESC;
SELECT w_state, i_category, i_brand, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_customer_sk) AS unique_customer_count, SUM(ss_net_profit) AS total_net_profit FROM store_sales JOIN item ON ss_item_sk = i_item_sk JOIN inventory ON inv_item_sk = i_item_sk JOIN warehouse ON w_warehouse_sk = inventory.inv_warehouse_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk WHERE (i_rec_start_date BETWEEN '2000-01-01' AND '2002-12-31') AND (inv_date_sk BETWEEN 20010101 AND 20021231) AND (w_street_name IN ('Ash Laurel', '6th', 'Wilson Elm', 'View First')) AND (hd_demo_sk IN (156, 867, 379)) AND (ss_sold_time_sk IN (48439, 35208, 48824, 49199, 58065, 67684)) AND (ss_ext_wholesale_cost IN (2791.40, 1191.68, 2550.20, 1499.76, 3663.96, 2041.47)) GROUP BY w_state, i_category, i_brand ORDER BY total_net_profit DESC, total_quantity_sold DESC LIMIT 100;
SELECT sm_type, AVG(ws_quantity) AS avg_quantity, AVG(ws_sales_price) AS avg_sales_price, SUM(ws_ext_sales_price) AS total_sales, COUNT(DISTINCT ws_bill_customer_sk) AS unique_customers, COUNT(DISTINCT ws_ship_customer_sk) AS unique_ship_to_customers, AVG(cd_purchase_estimate) AS avg_purchase_estimate, SUM(cd_dep_count) AS total_dependents, AVG(hd_income_band_sk) AS avg_income_band, SUM(hd_vehicle_count) AS total_vehicles FROM web_sales JOIN ship_mode ON ws_ship_mode_sk = sm_ship_mode_sk JOIN customer_demographics ON ws_bill_cdemo_sk = cd_demo_sk JOIN household_demographics ON ws_bill_hdemo_sk = hd_demo_sk JOIN customer ON ws_bill_customer_sk = c_customer_sk WHERE ws_sales_price BETWEEN 100.00 AND 200.00 AND cd_credit_rating = 'Good' AND hd_buy_potential = '5001-10000' AND c_current_addr_sk IN ('45401', '18617', '42292', '26887', '5997') GROUP BY sm_type;
SELECT p.p_promo_id, p.p_promo_name, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_tickets, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_ext_discount_amt) AS avg_ticket_discount, SUM(ss.ss_net_paid) AS total_net_sales, SUM(ss.ss_net_profit) AS total_net_profit, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, CASE WHEN hd.hd_buy_potential = '0-500' THEN 'Low' WHEN hd.hd_buy_potential = '501-1000' THEN 'Below Average' WHEN hd.hd_buy_potential = '1001-5000' THEN 'Average' WHEN hd.hd_buy_potential = '5001-10000' THEN 'Above Average' WHEN hd.hd_buy_potential = '>10000' THEN 'High' ELSE 'Unknown' END AS avg_buy_potential, COUNT(DISTINCT hd.hd_income_band_sk) AS distinct_income_bands FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk LEFT JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk GROUP BY p.p_promo_id, p.p_promo_name, hd.hd_buy_potential ORDER BY total_net_sales DESC, total_net_profit DESC;
SELECT s_state AS state, AVG(ws_sales_price) AS avg_web_sales_price, SUM(ws_quantity) AS total_web_sales_quantity, COUNT(DISTINCT s_store_sk) AS num_stores, COUNT(DISTINCT w_warehouse_sk) AS num_warehouses FROM web_sales JOIN store ON web_sales.ws_ship_addr_sk = store.s_store_sk JOIN warehouse ON web_sales.ws_warehouse_sk = warehouse.w_warehouse_sk GROUP BY state ORDER BY state;
SELECT sm.sm_type AS shipping_mode_type, sm.sm_carrier AS carrier, cp.cp_department AS catalog_department, COUNT(DISTINCT wr.wr_order_number) AS number_of_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_return_tax) AS total_tax, SUM(wr.wr_return_ship_cost) AS total_shipping_cost, SUM(wr.wr_net_loss) AS total_net_loss FROM web_returns wr JOIN ship_mode sm ON wr.wr_returned_date_sk = sm.sm_ship_mode_sk JOIN catalog_page cp ON wr.wr_web_page_sk = cp.cp_catalog_page_sk WHERE wr.wr_returned_date_sk = 2451368 AND cp.cp_catalog_page_sk IN ('859', '3510', '105', '4419') GROUP BY shipping_mode_type, carrier, catalog_department ORDER BY total_net_loss DESC;
SELECT p.p_promo_name, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE cs.cs_sold_date_sk IN (SELECT d_date_sk FROM date_dim WHERE d_year = 2003) AND p.p_channel_email = 'Y' AND cs.cs_net_paid > 0 AND cs.cs_net_profit > 0 GROUP BY p.p_promo_name ORDER BY total_net_profit DESC, total_quantity_sold DESC;
SELECT ca.ca_state AS customer_state, ib.ib_income_band_sk AS income_band, COUNT(DISTINCT c.c_customer_sk) AS num_customers, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_profit) AS total_profit FROM catalog_sales cs JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN income_band ib ON c.c_current_hdemo_sk = ib.ib_income_band_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE ib.ib_income_band_sk IN (19, 16) AND ca.ca_state IS NOT NULL AND p.p_discount_active = '1' AND cs.cs_sales_price IS NOT NULL GROUP BY ca.ca_state, ib.ib_income_band_sk ORDER BY total_profit DESC, avg_sales_price DESC, num_customers DESC;
SELECT hd.hd_buy_potential, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_quantity) AS total_quantity_sold, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_incl_tax, COUNT(DISTINCT sr.sr_customer_sk) AS unique_customers_returned FROM store_sales ss LEFT JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk LEFT JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk LEFT JOIN store_returns sr ON ss.ss_customer_sk = sr.sr_customer_sk AND ss.ss_item_sk = sr.sr_item_sk GROUP BY hd.hd_buy_potential ORDER BY total_return_amount_incl_tax DESC;
SELECT s.s_store_name, s.s_city, ca.ca_state, COUNT(DISTINCT ss.ss_ticket_number) AS store_sales_count, SUM(ss.ss_net_paid) AS total_store_sales_revenue, COUNT(DISTINCT sr.sr_ticket_number) AS store_returns_count, SUM(sr.sr_return_amt) AS total_store_returns_revenue, COUNT(DISTINCT cs.cs_order_number) AS catalog_sales_count, SUM(cs.cs_net_paid) AS total_catalog_sales_revenue, COUNT(DISTINCT cr.cr_order_number) AS catalog_returns_count, SUM(cr.cr_return_amount) AS total_catalog_returns_revenue, w.w_warehouse_name, SUM(cr.cr_fee) AS total_cr_fee, AVG(cr.cr_return_amount) AS avg_catalog_return_amount, MAX(ss.ss_net_profit) AS max_store_sale_profit FROM store AS s LEFT JOIN store_sales AS ss ON s.s_store_sk = ss.ss_store_sk LEFT JOIN store_returns AS sr ON s.s_store_sk = sr.sr_store_sk LEFT JOIN warehouse AS w ON w.w_city = s.s_city AND w.w_county = s.s_county LEFT JOIN catalog_sales AS cs ON cs.cs_warehouse_sk = w.w_warehouse_sk LEFT JOIN catalog_returns AS cr ON cr.cr_warehouse_sk = w.w_warehouse_sk LEFT JOIN customer_address AS ca ON ca.ca_address_sk = sr.sr_addr_sk WHERE s.s_company_id = 1 AND s.s_geography_class = 'Unknown' AND w.w_city = 'Fairview' AND w.w_county = 'Williamson County' AND cr.cr_fee IN ('26.50', '75.45', '76.31', '11.75', '16.52', '56.95') AND cr.cr_ship_mode_sk IN ('8', '20', '4', '1', '11') AND sr.sr_addr_sk IN ('11867', '40243') AND sr.sr_reversed_charge IN ('0.68', '96.26', '6.63', '3.63') GROUP BY s.s_store_name, s.s_city, ca.ca_state, w.w_warehouse_name ORDER BY total_store_sales_revenue DESC;
SELECT i.i_category AS item_category, COUNT(DISTINCT i.i_item_sk) AS unique_items_sold, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid) AS total_sales, AVG(ws.ws_sales_price) AS average_sales_price, AVG(ws.ws_net_profit) AS average_net_profit FROM item i JOIN web_sales ws ON i.i_item_sk = ws.ws_item_sk JOIN inventory inv ON ws.ws_item_sk = inv.inv_item_sk WHERE i.i_current_price > 50 AND inv.inv_warehouse_sk IN (1, 2) AND ws.ws_ship_date_sk IN (2452335, 2452146, 2450987, 2452543) GROUP BY i.i_category ORDER BY total_sales DESC;
SELECT s.s_store_name, s.s_manager, SUM(cs.cs_net_profit) AS total_profit, AVG(cs.cs_quantity) AS average_quantity_sold, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(wr.wr_net_loss) AS total_net_loss, AVG(wr.wr_fee) AS average_return_fee, COUNT(DISTINCT wr.wr_order_number) AS total_returns, r.r_reason_desc, d.d_year, d.d_quarter_name FROM store s JOIN catalog_sales cs ON s.s_store_sk = cs.cs_ship_addr_sk JOIN web_returns wr ON cs.cs_order_number = wr.wr_order_number JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN reason r ON wr.wr_reason_sk = r.r_reason_sk WHERE s.s_manager IN ('Raymond Jacobs', 'William Ward') AND r.r_reason_desc IN ('duplicate purchase', 'Did not fit') AND d.d_year = 2001 AND d.d_quarter_name IN ('Q1', 'Q2', 'Q3', 'Q4') GROUP BY s.s_store_name, s.s_manager, r.r_reason_desc, d.d_year, d.d_quarter_name ORDER BY total_profit DESC, total_net_loss DESC;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, r.r_reason_desc, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_items, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_tax) AS total_tax, SUM(cr.cr_return_ship_cost) AS total_ship_cost, SUM(cr.cr_net_loss) AS total_net_loss FROM call_center cc JOIN catalog_returns cr ON cc.cc_call_center_sk = cr.cr_call_center_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk WHERE cc.cc_zip = '31904' AND cr.cr_return_amt_inc_tax > 0 AND r.r_reason_desc IN ('Found a better price in a store', 'its is a boy') GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, r.r_reason_desc ORDER BY total_returns DESC, total_returned_items DESC;
SELECT d_year, d_quarter_name, cp_department, c_birth_country, COUNT(DISTINCT ws_order_number) AS total_orders, SUM(ws_quantity) AS total_quantity, AVG(ws_sales_price) AS average_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_profit) AS total_net_profit FROM web_sales JOIN date_dim ON web_sales.ws_sold_date_sk = date_dim.d_date_sk JOIN customer ON web_sales.ws_bill_customer_sk = customer.c_customer_sk JOIN catalog_page ON web_sales.ws_web_page_sk = catalog_page.cp_catalog_page_sk WHERE d_year = 2001 AND d_quarter_name IN ('1901Q1', '1911Q1', '1910Q2') AND ws_ext_discount_amt IN (262.20, 1117.90, 736.02) AND c_birth_country IS NOT NULL GROUP BY d_year, d_quarter_name, cp_department, c_birth_country ORDER BY d_year, d_quarter_name, cp_department, c_birth_country;
SELECT ca.ca_state AS customer_state, r.r_reason_desc AS return_reason, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_amt) AS total_return_amt, SUM(sr.sr_return_tax) AS total_return_tax, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk GROUP BY ca.ca_state, r.r_reason_desc ORDER BY ca.ca_state, r.r_reason_desc;
SELECT p.p_promo_name, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo, SUM(p.p_cost) AS total_promotion_cost, COUNT(p.p_promo_sk) AS number_of_promotions, AVG(cd.cd_dep_count) AS average_number_of_dependents FROM promotion p JOIN web_page wp ON p.p_item_sk = wp.wp_web_page_sk JOIN customer_demographics cd ON wp.wp_customer_sk = cd.cd_demo_sk WHERE wp.wp_creation_date_sk IN ('2450808', '2450809') AND p.p_response_target = 1 AND cd.cd_marital_status IN ('W', 'D', 'U', 'S') GROUP BY p.p_promo_name, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo ORDER BY total_promotion_cost DESC, number_of_promotions DESC;
SELECT w_state, sm_type, EXTRACT(YEAR FROM wp_rec_start_date) AS year, EXTRACT(QUARTER FROM wp_rec_start_date) AS quarter, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk JOIN web_page ON cs_catalog_page_sk = wp_web_page_sk JOIN time_dim ON cs_sold_time_sk = t_time_sk JOIN inventory ON cs_warehouse_sk = inv_warehouse_sk AND cs_item_sk = inv_item_sk WHERE t_time_sk IN (1701, 993, 898, 4227, 3566, 3142) AND sm_carrier IN ('GERMA', 'DHL', 'ORIENTAL', 'PRIVATECARRIER') AND inv_date_sk = 2450815 GROUP BY w_state, sm_type, year, quarter ORDER BY total_net_profit DESC, total_net_paid DESC, total_orders DESC;
SELECT ca_state, SUM(hd_dep_count) AS total_dependents, AVG(hd_vehicle_count) AS avg_vehicles, COUNT(DISTINCT ca_address_sk) AS total_addresses, SUM(CASE WHEN p_channel_email = '1' THEN p_response_target ELSE 0 END) AS email_promo_targets, AVG(inv_quantity_on_hand) AS avg_inventory_on_hand FROM customer_address ca JOIN household_demographics hd ON ca.ca_address_sk = hd.hd_demo_sk JOIN promotion p ON ca.ca_address_sk = p.p_promo_sk JOIN inventory i ON ca.ca_address_sk = i.inv_warehouse_sk GROUP BY ca_state ORDER BY ca_state;
SELECT c.c_first_name, c.c_last_name, c.c_email_address, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, COUNT(DISTINCT sr.sr_ticket_number) AS number_of_returns, w.web_name, w.web_country FROM customer c JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN web_site w ON w.web_country = 'United States' WHERE sr.sr_return_quantity > 0 AND sr.sr_returned_date_sk BETWEEN w.web_open_date_sk AND w.web_close_date_sk AND w.web_rec_start_date BETWEEN '1997-08-16' AND '2001-08-16' GROUP BY c.c_customer_sk, w.web_site_sk ORDER BY total_returned_quantity DESC, average_return_amount DESC;
