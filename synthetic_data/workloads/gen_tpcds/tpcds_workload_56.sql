SELECT r.r_reason_desc, i.i_item_id, i.i_category, p.p_promo_name, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(wr.wr_net_loss) AS total_net_loss, COUNT(*) AS num_of_returns FROM web_returns wr JOIN reason r ON wr.wr_reason_sk = r.r_reason_sk JOIN item i ON wr.wr_item_sk = i.i_item_sk JOIN promotion p ON p.p_item_sk = i.i_item_sk JOIN call_center cc ON cc.cc_call_center_sk = wr.wr_refunded_addr_sk WHERE i.i_current_price > 100.00 AND cc.cc_gmt_offset = -5.00 GROUP BY r.r_reason_desc, i.i_item_id, i.i_category, p.p_promo_name ORDER BY total_net_loss DESC, avg_return_amount_inc_tax DESC;
SELECT i_category, i_class, i_brand, SUM(i_current_price) AS total_sales_value, AVG(i_current_price) AS avg_sales_price, COUNT(DISTINCT i_item_sk) AS unique_items_sold, COUNT(DISTINCT c_customer_sk) AS unique_customers, c_birth_country, AVG(EXTRACT(YEAR FROM AGE(MAKE_DATE(c_birth_year, c_birth_month, c_birth_day)))) AS avg_customer_age FROM item JOIN customer ON i_manager_id = c_current_addr_sk JOIN time_dim ON t_time_sk = c_first_sales_date_sk WHERE i_rec_start_date <= NOW() AND (i_rec_end_date IS NULL OR i_rec_end_date > NOW()) AND c_preferred_cust_flag = 'Y' AND t_minute IN ('6', '3', '48', '49') GROUP BY ROLLUP(i_category, i_class, i_brand, c_birth_country) ORDER BY total_sales_value DESC, unique_items_sold DESC, i_category, i_class, i_brand, c_birth_country;
SELECT c.ca_county, COUNT(distinct ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid_inc_tax) AS total_revenue_inc_tax, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN customer_address c ON ws.ws_bill_addr_sk = c.ca_address_sk JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk JOIN store s ON c.ca_state = s.s_state WHERE wp.wp_char_count IN ('5918', '3732', '4894', '2129', '1526') AND c.ca_county IN ('Calloway County', 'Mifflin County', 'Dutchess County', 'Rowan County') AND s.s_number_employees = 297 AND ws.ws_bill_customer_sk IN ('50106', '534', '23933', '77910', '39966') GROUP BY c.ca_county ORDER BY total_revenue_inc_tax DESC, total_net_profit DESC;
SELECT ca.ca_state, ib.ib_lower_bound, ib.ib_upper_bound, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(sr.sr_return_ship_cost) AS total_return_shipping_cost, COUNT(sr.sr_return_amt) AS num_of_returns FROM store_returns sr JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN income_band ib ON sr.sr_hdemo_sk = ib.ib_income_band_sk JOIN web_site ws ON sr.sr_store_sk = ws.web_site_sk WHERE ws.web_market_manager IN ('Gerald Craft', 'Donald Mckinney', 'Jeffrey Campbell', 'Eldon Snow', 'Keith Frazier', 'Gilbert Chapman') GROUP BY ca.ca_state, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ca.ca_state, ib.ib_lower_bound;
SELECT s.s_store_name, s.s_state, sum(inv.inv_quantity_on_hand) AS total_inventory, avg(hd.hd_dep_count) AS avg_dependents, avg(hd.hd_vehicle_count) AS avg_vehicles, count(DISTINCT sr.sr_ticket_number) AS num_store_returns, sum(sr.sr_return_amt_inc_tax) AS total_store_return_value, sum(wr.wr_return_amt_inc_tax) AS total_web_return_value, sum(sr.sr_net_loss) AS total_store_net_loss, sum(wr.wr_net_loss) AS total_web_net_loss FROM store s LEFT JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk LEFT JOIN web_returns wr ON wr.wr_returning_hdemo_sk = sr.sr_hdemo_sk LEFT JOIN inventory inv ON inv.inv_warehouse_sk = s.s_store_sk LEFT JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk WHERE s.s_gmt_offset = '-5.00' AND inv.inv_date_sk = 2450815 AND s.s_store_id = 'AAAAAAAABAAAAAAA' AND ( inv.inv_item_sk IN ('14480', '13390', '12130', '9782', '14476', '8896') OR wr.wr_item_sk IN ('8516', '362') ) AND ( hd.hd_vehicle_count IN (3, 1, 0, 4, 2) OR hd.hd_buy_potential IN ('5001-10000', 'Unknown', '0-500', '1001-5000', '>10000') ) GROUP BY s.s_store_name, s.s_state ORDER BY total_inventory DESC, total_store_return_value DESC;
SELECT ca_state, cc_division_name, AVG(cc_employees) AS avg_cc_employees, COUNT(DISTINCT cc_call_center_sk) AS num_call_centers, SUM(hd_dep_count) AS total_dependents, AVG(hd_vehicle_count) AS avg_num_vehicles, COUNT(DISTINCT c_customer_sk) AS num_customers, COUNT(CASE WHEN hd_buy_potential = '0-500' THEN 1 END) AS count_low_buy_potential, COUNT(CASE WHEN hd_buy_potential = '>10000' THEN 1 END) AS count_high_buy_potential FROM call_center JOIN customer ON c_current_cdemo_sk = cc_call_center_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk WHERE (cc_rec_end_date = '2000-12-31' OR cc_rec_end_date = '2001-12-31') AND hd_dep_count IN (4, 7, 0, 3) AND ca_street_name = 'Fourth Lakeview' GROUP BY ca_state, cc_division_name ORDER BY ca_state, cc_division_name;
SELECT cc.cc_name, cc.cc_class, cc.cc_hours, ca.ca_city, ca.ca_state, hd.hd_buy_potential, hd.hd_vehicle_count, SUM(cs.cs_net_paid_inc_ship_tax) AS total_sales, AVG(cs.cs_net_paid_inc_ship_tax) AS avg_sales, COUNT(DISTINCT cs.cs_order_number) AS number_of_orders, SUM(wr.wr_return_amt_inc_tax) AS total_returns, AVG(wr.wr_return_amt_inc_tax) AS avg_returns, COUNT(DISTINCT wr.wr_order_number) AS number_of_returns FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number WHERE cc.cc_hours IN ('8AM-4PM', '8AM-8AM') AND cc.cc_class IN ('large', 'small', 'medium') AND cc.cc_county = 'Williamson County' AND cc.cc_division_name IN ('pri', 'ese', 'ought') AND hd.hd_buy_potential IN ('Unknown', '5001-10000', '501-1000') AND hd.hd_vehicle_count IN (4, 2, 0) AND ca.ca_zip IN ('73951', '52565', '72297') AND ca.ca_city IN ('Millwood', 'Forest', 'Newport') AND cs.cs_net_paid_inc_ship_tax IN (5723.12, 5673.95, 2697.52) AND cs.cs_ship_addr_sk IN (9885, 17067, 29571) AND wr.wr_return_tax IN (46.49, 3.87, 51.37) AND wr.wr_return_ship_cost IN (547.26, 948.48, 764.52) AND wr.wr_item_sk IN (10976, 17844, 12276) GROUP BY cc.cc_name, cc.cc_class, cc.cc_hours, ca.ca_city, ca.ca_state, hd.hd_buy_potential, hd.hd_vehicle_count ORDER BY total_sales DESC, total_returns DESC;
SELECT cp.cp_department, cp.cp_catalog_number, w.w_city, w.w_state, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(ss.ss_quantity) AS total_sales_quantity, SUM(ss.ss_sales_price) AS total_sales_amount, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions FROM catalog_page cp JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk JOIN store_sales ss ON cr.cr_item_sk = ss.ss_item_sk AND cr.cr_order_number = ss.ss_ticket_number JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE w.w_gmt_offset = '-5.00' AND (cp.cp_start_date_sk IS NOT NULL AND cp.cp_end_date_sk IS NOT NULL) AND (ib.ib_lower_bound > 10000 OR ss.ss_sales_price > 50) AND (cr.cr_return_amount > 0 AND ss.ss_sales_price > 0) AND ss.ss_ticket_number IN ('3322', '3479', '3625', '3649') GROUP BY cp.cp_department, cp.cp_catalog_number, w.w_city, w.w_state, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_sales_amount DESC, average_sales_price DESC, total_returns DESC;
SELECT cp_department, i_category, i_class, COUNT(DISTINCT i_item_sk) AS item_count, SUM(i_current_price) AS total_price, AVG(i_current_price) AS average_price, AVG(i_wholesale_cost) AS average_cost, SUM(i_wholesale_cost) AS total_cost, sm_type, COUNT(DISTINCT sm_ship_mode_sk) AS ship_mode_count FROM catalog_page JOIN item ON (cp_catalog_page_sk = i_item_sk) JOIN ship_mode ON (i_item_sk = sm_ship_mode_sk) WHERE cp_catalog_page_sk IN (2547, 2038, 1714) GROUP BY cp_department, i_category, i_class, sm_type ORDER BY cp_department, i_category, i_class;
SELECT ca.ca_state, COUNT(DISTINCT cr.cr_order_number) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_net_loss) AS total_net_loss, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_net_profit FROM customer_address ca LEFT JOIN catalog_returns cr ON ca.ca_address_sk = cr.cr_returning_addr_sk LEFT JOIN store_sales ss ON ca.ca_address_sk = ss.ss_addr_sk LEFT JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk LEFT JOIN inventory inv ON ss.ss_item_sk = inv.inv_item_sk AND cr.cr_item_sk = inv.inv_item_sk WHERE ss.ss_net_paid IN (2118.53, 811.65, 477.37) OR ss.ss_ext_sales_price IN (43.89, 681.72, 440.10, 1852.62, 93.60, 2554.68) GROUP BY ca.ca_state ORDER BY total_net_profit DESC, total_net_loss DESC
SELECT t.t_shift, ib.ib_income_band_sk, COUNT(DISTINCT ws.web_site_sk) AS total_websites, AVG(ws.web_tax_percentage) AS avg_tax_percentage, SUM(CASE WHEN ws.web_class = 'Unknown' THEN 1 ELSE 0 END) AS unknown_class_count, MIN(ib.ib_lower_bound) AS min_income_lower_bound, MAX(ib.ib_upper_bound) AS max_income_upper_bound FROM time_dim t JOIN web_site ws ON t.t_time_sk = ws.web_open_date_sk LEFT JOIN income_band ib ON ws.web_mkt_id = ib.ib_income_band_sk WHERE t.t_time_sk IN (1002, 2003, 4384, 955, 433, 1796) AND ws.web_company_id IN (5, 2, 1) AND ws.web_class != 'Unknown' GROUP BY t.t_shift, ib.ib_income_band_sk ORDER BY t.t_shift, ib.ib_income_band_sk;
SELECT p.p_promo_name, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, SUM(cs_net_paid) AS total_net_paid, AVG(cs_net_profit) AS average_net_profit, COUNT(DISTINCT cr_order_number) AS total_returns, SUM(cr_return_quantity) AS total_quantity_returned, SUM(cr_net_loss) AS total_net_loss, AVG(hd.hd_vehicle_count) AS average_vehicle_count FROM catalog_sales cs JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk LEFT JOIN catalog_returns cr ON cs.cs_item_sk = cr.cr_item_sk AND cs.cs_order_number = cr.cr_order_number JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk WHERE cs.cs_ext_wholesale_cost > 100 AND hd.hd_vehicle_count IN (0, 2, 3, 4) AND (cr.cr_returned_time_sk IS NULL OR cr.cr_returned_time_sk IN (80039, 82096, 81103)) GROUP BY p.p_promo_name ORDER BY total_net_paid DESC, total_net_loss ASC LIMIT 100;
SELECT cd.cd_gender, cd.cd_marital_status, s.s_state, COUNT(wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount, AVG(wr.wr_return_amt_inc_tax) AS average_return_amount, AVG(wr.wr_fee) AS average_fee FROM web_returns wr JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk JOIN store s ON wr.wr_returning_addr_sk = s.s_store_sk WHERE wr.wr_returning_addr_sk IN (38908, 38512, 43731, 22184, 44035) AND wr.wr_refunded_hdemo_sk IN (3650, 1143, 1326, 7105) AND s.s_state = 'CA' GROUP BY cd.cd_gender, cd.cd_marital_status, s.s_state ORDER BY total_return_amount DESC, total_returns DESC;
SELECT ca_state, cd_education_status, COUNT(DISTINCT c_customer_sk) AS total_customers, SUM(cd_purchase_estimate) AS total_purchase_estimate, AVG(cd_dep_count) AS average_dependents, SUM(CASE WHEN cd_gender = 'F' THEN 1 ELSE 0 END) AS female_customers, SUM(CASE WHEN cd_gender = 'M' THEN 1 ELSE 0 END) AS male_customers, COUNT(DISTINCT r_reason_sk) AS total_return_reasons, COUNT(DISTINCT i_item_sk) AS total_items_sold, SUM(inv_quantity_on_hand) AS total_inventory_quantity, AVG(i_current_price) AS average_item_price FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN inventory inv ON inv.inv_warehouse_sk = c.c_current_addr_sk JOIN item i ON i.i_item_sk = inv.inv_item_sk LEFT JOIN reason r ON r.r_reason_sk = inv.inv_warehouse_sk WHERE ca.ca_street_number IN ('470', '984', '743') AND cd_education_status IN ('College', 'Unknown', 'Advanced Degree', '2 yr Degree') AND cd_dep_employed_count = '0' AND ca_state IN (SELECT cc_state FROM call_center WHERE cc_street_name IN ('Center Hill', 'Pine Ridge', 'Ash Hill')) GROUP BY ca_state, cd_education_status ORDER BY total_customers DESC, total_purchase_estimate DESC;
SELECT ca_state, ca_country, COUNT(DISTINCT ca_address_sk) AS num_addresses, SUM(p_cost) AS total_promotion_cost, AVG(p_cost) AS avg_promotion_cost, COUNT(DISTINCT p_promo_sk) AS num_promotions, COUNT(DISTINCT web_site_sk) AS num_websites, SUM(web_tax_percentage) AS total_tax_percentage, AVG(web_tax_percentage) AS avg_tax_percentage FROM customer_address JOIN promotion ON ca_address_sk = p_item_sk JOIN web_site ON ca_address_sk = web_mkt_id WHERE ca_state IN ('DE', 'NH', 'MI', 'MA', 'ID', 'NY') AND ca_country = 'United States' AND p_discount_active = '1' AND web_rec_start_date <= CURRENT_DATE AND (web_rec_end_date IS NULL OR web_rec_end_date >= CURRENT_DATE) GROUP BY ca_state, ca_country ORDER BY ca_state, ca_country;
SELECT d_year, d_qoy, hd_income_band_sk, COUNT(DISTINCT ss_customer_sk) AS total_customers, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS avg_sales_price, SUM(ss_net_paid_inc_tax) AS total_revenue, AVG(ws_wholesale_cost) AS avg_wholesale_cost, SUM(ws_net_profit) AS total_web_profit, COUNT(DISTINCT ws_order_number) AS total_web_orders, SUM(wr_return_quantity) AS total_return_quantity, SUM(wr_return_amt_inc_tax) AS total_return_amount FROM date_dim JOIN store_sales ON ss_sold_date_sk = d_date_sk JOIN web_sales ON ws_sold_date_sk = d_date_sk JOIN web_returns ON wr_returned_date_sk = d_date_sk AND ws_item_sk = wr_item_sk JOIN household_demographics ON (ss_hdemo_sk = hd_demo_sk OR ws_ship_hdemo_sk = hd_demo_sk OR wr_returning_hdemo_sk = hd_demo_sk) WHERE d_year = 1999 AND hd_income_band_sk IN (8, 9, 10) AND ss_addr_sk IN (43285, 30010, 21588) AND ss_net_paid_inc_tax > 5000 AND wr_refunded_cdemo_sk IN ('55573', '303149', '71175') AND wr_return_tax IN (12.36, 35.06, 21.54, 6.11, 363.36, 106.37) GROUP BY d_year, d_qoy, hd_income_band_sk ORDER BY total_revenue DESC, total_web_profit DESC;
SELECT dd.d_year, dd.d_quarter_name, SUM(ws.ws_net_paid) AS total_net_paid, AVG(ws.ws_quantity) AS average_quantity, COUNT(*) AS sales_transactions, SUM(inv.inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT ws.ws_item_sk) AS distinct_items_sold, COUNT(DISTINCT s.s_store_sk) AS number_of_stores, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_quantity) AS average_return_quantity, COUNT(DISTINCT cr.cr_item_sk) AS distinct_items_returned FROM date_dim AS dd JOIN web_sales AS ws ON dd.d_date_sk = ws.ws_sold_date_sk JOIN inventory AS inv ON ws.ws_item_sk = inv.inv_item_sk AND ws.ws_sold_date_sk = inv.inv_date_sk JOIN store AS s ON ws.ws_bill_customer_sk = s.s_store_sk LEFT JOIN catalog_returns AS cr ON ws.ws_item_sk = cr.cr_item_sk AND ws.ws_order_number = cr.cr_order_number WHERE dd.d_current_year = 'N' AND ws.ws_promo_sk IS NOT NULL AND s.s_market_id IN (8, 2, 4, 7) AND inv.inv_warehouse_sk IN (1, 2) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT ca.ca_state, COUNT(DISTINCT c.c_customer_sk) AS num_customers, COUNT(wr.wr_order_number) AS num_returns, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_return_amt) AS avg_return_amount FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_refunded_customer_sk WHERE c.c_customer_sk IN (2939, 1085, 4773) GROUP BY ca.ca_state ORDER BY total_return_amount DESC, num_returns DESC;
SELECT d_year, i_category, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(ss_net_profit) AS total_profit FROM store_sales JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk JOIN item ON store_sales.ss_item_sk = item.i_item_sk JOIN promotion ON store_sales.ss_promo_sk = promotion.p_promo_sk WHERE promotion.p_channel_event = 'N' AND item.i_manager_id = 40 AND item.i_container = 'Unknown' AND promotion.p_item_sk IN ('11194', '2314', '17593') AND EXISTS ( SELECT 1 FROM household_demographics WHERE household_demographics.hd_demo_sk = store_sales.ss_hdemo_sk AND household_demographics.hd_buy_potential IN ('>10000', 'Unknown') AND household_demographics.hd_vehicle_count IN ('3', '1', '0', '4', '2') ) GROUP BY d_year, i_category ORDER BY total_profit DESC, total_quantity_sold DESC;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_state, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, SUM(ws.ws_net_paid) AS total_net_paid, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON ws.ws_bill_addr_sk = ca.ca_address_sk WHERE dd.d_year = 2002 AND ca.ca_country = 'United States' AND ws.ws_net_paid_inc_ship_tax > 1000 GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state ORDER BY dd.d_year, dd.d_quarter_name, ca.ca_state;
SELECT s.s_store_id, s.s_store_name, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS preferred_customers, AVG(s.s_number_employees) AS average_number_of_employees, AVG(s.s_floor_space) AS average_floor_space, SUM(CASE WHEN r.r_reason_desc = 'Did not get it on time' THEN 1 ELSE 0 END) AS complaints_not_ontime, SUM(CASE WHEN r.r_reason_desc = 'duplicate purchase' THEN 1 ELSE 0 END) AS complaints_duplicate_purchases, SUM(CASE WHEN r.r_reason_desc = 'Does not work with a product that I have' THEN 1 ELSE 0 END) AS complaints_incompatibility, SUM(CASE WHEN r.r_reason_desc = 'Did not like the make' THEN 1 ELSE 0 END) AS complaints_dislike_make, COUNT(DISTINCT CASE WHEN c.c_first_sales_date_sk BETWEEN 2449741 AND 2452333 THEN c.c_customer_sk END) AS customers_with_first_purchase FROM store s LEFT JOIN customer c ON s.s_store_sk = c.c_current_addr_sk LEFT JOIN reason r ON r.r_reason_sk = c.c_last_review_date_sk WHERE c.c_birth_day IN (24, 1, 22, 4) GROUP BY s.s_store_id, s.s_store_name ORDER BY s.s_store_id;
SELECT d_year, d_quarter_name, s_state, COUNT(DISTINCT s_store_sk) AS number_of_stores, SUM(s_number_employees) AS total_employees, AVG(s_floor_space) AS avg_floor_space, SUM(wp_char_count) AS total_char_count, AVG(wp_link_count) AS avg_link_count, AVG(wp_image_count) AS avg_image_count, COUNT(DISTINCT wp_web_page_sk) AS number_of_web_pages, SUM(CASE WHEN wp_max_ad_count = 3 THEN 1 ELSE 0 END) AS count_max_ad_3, AVG(s_tax_precentage) AS avg_tax_percentage FROM store JOIN date_dim ON s_rec_end_date = d_date LEFT JOIN web_page ON wp_access_date_sk = d_date_sk WHERE s_rec_end_date BETWEEN '1999-01-01' AND '2001-12-31' AND wp_url LIKE 'http://www.foo.com%' AND wp_max_ad_count IN ('1', '2', '3', '4') GROUP BY d_year, d_quarter_name, s_state ORDER BY d_year DESC, d_quarter_name, s_state;
