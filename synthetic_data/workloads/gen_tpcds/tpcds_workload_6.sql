SELECT p.p_purpose, COUNT(DISTINCT p.p_promo_sk) AS num_promotions, AVG(p.p_cost) AS avg_promo_cost, SUM(CASE WHEN p.p_channel_dmail = 'Y' THEN 1 ELSE 0 END) AS dmail_channel_count, SUM(CASE WHEN p.p_channel_email = 'Y' THEN 1 ELSE 0 END) AS email_channel_count, COUNT(DISTINCT CASE WHEN cd.cd_purchase_estimate > 10000 THEN cd.cd_demo_sk END) AS high_value_customers, COUNT(DISTINCT CASE WHEN cd.cd_gender = 'M' THEN cd.cd_demo_sk END) AS male_customers, COUNT(DISTINCT CASE WHEN cd.cd_gender = 'F' THEN cd.cd_demo_sk END) AS female_customers, COUNT(DISTINCT CASE WHEN cd.cd_marital_status = 'S' THEN cd.cd_demo_sk END) AS single_customers, COUNT(DISTINCT CASE WHEN cd.cd_marital_status = 'M' THEN cd.cd_demo_sk END) AS married_customers FROM promotion p LEFT JOIN customer_demographics cd ON p.p_promo_sk = cd.cd_demo_sk WHERE p.p_discount_active = 'Y' GROUP BY p.p_purpose ORDER BY avg_promo_cost DESC, num_promotions DESC;
SELECT d_year, web_name, COUNT(DISTINCT ws_order_number) AS total_orders, SUM(ws_quantity) AS total_quantity_sold, AVG(ws_net_paid_inc_tax) AS average_net_paid_inc_tax, SUM(ws_net_profit) AS total_net_profit FROM web_sales JOIN web_site ON web_sales.ws_web_site_sk = web_site.web_site_sk JOIN date_dim ON web_sales.ws_sold_date_sk = date_dim.d_date_sk WHERE d_year IN (1911, 1912) AND ws_net_paid_inc_tax > 100 AND ws_wholesale_cost < 100 AND web_sales.ws_web_site_sk IN ( SELECT web_site_sk FROM web_site WHERE web_class = 'Platinum' ) GROUP BY d_year, web_name ORDER BY total_net_profit DESC, d_year, web_name;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, hd.hd_income_band_sk, hd.hd_buy_potential, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo, AVG(ss.ss_sales_price) AS avg_sales_price, AVG(ss.ss_coupon_amt) AS avg_coupon_amt, SUM(ss.ss_quantity) AS total_quantity_sold, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, AVG((ss.ss_list_price - ss.ss_sales_price) / ss.ss_list_price * 100) AS avg_discount_rate FROM store_sales ss JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk GROUP BY ROLLUP ( cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, hd.hd_income_band_sk, hd.hd_buy_potential, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo ) ORDER BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, hd.hd_income_band_sk, hd.hd_buy_potential, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, COUNT(cp.cp_catalog_page_sk) AS number_of_catalog_pages, SUM(case when p.p_channel_press = 'N' then 1 else 0 end) AS promotions_without_press, AVG(p.p_cost) AS average_promotion_cost, MAX(cc.cc_employees) AS max_employees_per_call_center, MIN(cc.cc_sq_ft) AS min_sq_ft_per_call_center FROM call_center cc LEFT JOIN catalog_page cp ON cc.cc_call_center_sk = cp.cp_catalog_page_sk LEFT JOIN promotion p ON cc.cc_call_center_sk = p.p_promo_sk WHERE cc.cc_sq_ft IN ('3514', '649', '1138', '795', '2268') GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY number_of_catalog_pages DESC, average_promotion_cost ASC;
SELECT d_year, sm_type, COUNT(DISTINCT inv_warehouse_sk) AS number_of_warehouses, SUM(inv_quantity_on_hand) AS total_quantity_on_hand, AVG(inv_quantity_on_hand) AS average_quantity_per_warehouse, MAX(inv_quantity_on_hand) AS max_quantity_in_warehouse, MIN(inv_quantity_on_hand) AS min_quantity_in_warehouse FROM inventory JOIN date_dim ON inv_date_sk = d_date_sk JOIN ship_mode ON sm_ship_mode_id = 'AAAAAAAAEAAAAAAA' WHERE d_year = 2023 AND d_day_name = 'Saturday' AND inv_warehouse_sk IN (1, 2) AND d_current_week = 'N' GROUP BY d_year, sm_type ORDER BY total_quantity_on_hand DESC, average_quantity_per_warehouse DESC LIMIT 100;
SELECT dd.d_year, dd.d_quarter_name, sm.sm_type, COUNT(DISTINCT ws.web_site_sk) AS num_websites, COUNT(DISTINCT cc.cc_call_center_sk) AS num_call_centers, COUNT(DISTINCT st.s_store_sk) AS num_stores, SUM(wr.wr_return_amt) AS total_return_amount, AVG(st.s_number_employees) AS avg_store_employees, AVG(wr.wr_fee) AS avg_return_fee FROM date_dim dd JOIN web_returns wr ON dd.d_date_sk = wr.wr_returned_date_sk JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk JOIN call_center cc ON ws.web_market_manager = cc.cc_manager JOIN store st ON cc.cc_mkt_id = st.s_market_id JOIN ship_mode sm ON sm.sm_ship_mode_sk = wr.wr_item_sk WHERE dd.d_dom = 7 AND dd.d_weekend = 'Y' AND st.s_country = 'United States' AND st.s_number_employees IN (271, 297) AND sm.sm_type IN ('LIBRARY', 'REGULAR', 'TWO DAY', 'OVERNIGHT') AND sm.sm_contract IN ('P7FBIt8yd', 'Xjy3ZPuiDjzHlRx14Z3', '2mM8l', 'Ek') AND ws.web_zip IN ('35709', '31904') AND ws.web_street_number IN ('671', '247', '973', '730') GROUP BY dd.d_year, dd.d_quarter_name, sm.sm_type ORDER BY total_return_amount DESC, avg_store_employees DESC;
SELECT ca_state, ca_city, SUM(cs_net_paid_inc_tax) AS total_sales, AVG(cs_net_paid_inc_tax) AS avg_sales, COUNT(DISTINCT cs_order_number) AS num_sales_orders, SUM(cr_return_amt_inc_tax) AS total_returns, AVG(cr_return_amt_inc_tax) AS avg_returns, COUNT(DISTINCT cr_order_number) AS num_return_orders, SUM(cr_net_loss) AS total_net_loss FROM customer_address JOIN catalog_sales ON cs_bill_addr_sk = ca_address_sk LEFT JOIN catalog_returns ON cr_order_number = cs_order_number JOIN web_sales ON ws_order_number = cs_order_number JOIN time_dim ON ws_sold_time_sk = t_time_sk JOIN web_page ON ws_web_page_sk = wp_web_page_sk WHERE t_sub_shift = 'night' AND ws_ship_date_sk = 2450935 AND ws_web_page_sk IN (41, 3, 18, 4, 45) AND wp_creation_date_sk IN (2450810, 2450808, 2450812, 2450809) GROUP BY ca_state, ca_city ORDER BY ca_state, ca_city;
SELECT ws.ws_item_sk, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_ext_discount_amt) AS avg_discount_amt, AVG(ws.ws_sales_price) AS avg_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, hd.hd_dep_count AS avg_dependents, hd.hd_vehicle_count AS avg_vehicles, s.s_store_name, s.s_city, s.s_state, SUM(inv.inv_quantity_on_hand) AS total_inventory_on_hand FROM web_sales ws JOIN household_demographics hd ON ws.ws_ship_hdemo_sk = hd.hd_demo_sk JOIN store s ON ws.ws_warehouse_sk = s.s_store_sk JOIN inventory inv ON (ws.ws_item_sk = inv.inv_item_sk AND ws.ws_warehouse_sk = inv.inv_warehouse_sk) WHERE ws.ws_ship_customer_sk IN ('14120', '70023', '31659', '86542') AND ws.ws_ship_addr_sk IN ('8368', '47705', '32703', '24892') AND inv.inv_date_sk = '2450815' AND hd.hd_vehicle_count IN (1, 0, 3, 2) AND s.s_number_employees IN (245, 271, 236, 218, 288, 278) GROUP BY ws.ws_item_sk, hd.hd_dep_count, hd.hd_vehicle_count, s.s_store_name, s.s_city, s.s_state ORDER BY total_net_paid DESC, total_orders DESC;
SELECT ca.ca_city, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_profit) AS total_net_profit, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(CASE WHEN p.p_channel_tv = 'N' THEN cs.cs_net_paid_inc_tax ELSE 0 END) AS net_paid_no_tv_promo, AVG(cs.cs_ext_ship_cost) AS average_shipping_cost FROM catalog_sales cs JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk LEFT JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE ca.ca_city IN ('Murphy', 'Hubbard', 'Mount Olive') AND c.c_email_address IN ( 'Joe.Singer@R26XcAkIUF5.org', 'Johanna.Ross@EiP23U7Cb5aeav.org', 'Laurie.Johnson@0P2bV5aT.org', 'Jeanne.Clark@v1rrdNtTL7dd0hh.org' ) GROUP BY ca.ca_city ORDER BY total_net_paid DESC;
SELECT wsit.web_site_id, wsit.web_name, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_paid) AS total_sales, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(DISTINCT wr.wr_order_number) AS total_returns, AVG(wr.wr_return_amt) AS avg_return_amt, SUM(CASE WHEN ws.ws_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS promo_sales_count, SUM(CASE WHEN ws.ws_promo_sk IS NULL THEN 1 ELSE 0 END) AS non_promo_sales_count, AVG(hd.hd_dep_count) AS avg_household_dependents, AVG(hd.hd_vehicle_count) AS avg_household_vehicles FROM web_sales ws LEFT JOIN web_site wsit ON ws.ws_web_site_sk = wsit.web_site_sk LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk LEFT JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk LEFT JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk LEFT JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk GROUP BY wsit.web_site_id, wsit.web_name ORDER BY total_sales DESC;
SELECT ca_state, ca_country, COUNT(DISTINCT ca_address_sk) AS num_addresses, SUM(p_cost) AS total_promotion_cost, AVG(p_cost) AS avg_promotion_cost, COUNT(DISTINCT p_promo_sk) AS num_promotions, COUNT(DISTINCT web_site_sk) AS num_websites, SUM(web_tax_percentage) AS total_tax_percentage, AVG(web_tax_percentage) AS avg_tax_percentage FROM customer_address JOIN promotion ON ca_address_sk = p_item_sk JOIN web_site ON ca_address_sk = web_mkt_id WHERE ca_state IN ('DE', 'NH', 'MI', 'MA', 'ID', 'NY') AND ca_country = 'United States' AND p_discount_active = '1' AND web_rec_start_date <= CURRENT_DATE AND (web_rec_end_date IS NULL OR web_rec_end_date >= CURRENT_DATE) GROUP BY ca_state, ca_country ORDER BY ca_state, ca_country;
SELECT r_reason_desc, w_state, COUNT(DISTINCT cr_order_number) AS total_catalog_returns, SUM(cr_return_quantity) AS total_returned_quantity, SUM(cr_return_amount) AS total_refund_amount, AVG(cr_return_amount) AS avg_refund_amount_per_return, SUM(cr_fee) AS total_fees, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns JOIN reason ON catalog_returns.cr_reason_sk = reason.r_reason_sk JOIN warehouse ON catalog_returns.cr_warehouse_sk = warehouse.w_warehouse_sk GROUP BY r_reason_desc, w_state ORDER BY total_refund_amount DESC, total_returned_quantity DESC;
SELECT ca_state, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_net_sales, AVG(ss_net_profit) AS avg_profit_per_sale, SUM(ss_net_paid_inc_tax) - SUM(ss_net_paid) AS total_tax_collected, web_company_name FROM store_sales JOIN customer_address ON store_sales.ss_addr_sk = customer_address.ca_address_sk JOIN web_site ON store_sales.ss_store_sk = web_site.web_site_sk WHERE web_site.web_company_id IN ('5', '1', '4', '6', '2') AND customer_address.ca_country = 'United States' AND EXTRACT(YEAR FROM CURRENT_DATE) - EXTRACT(YEAR FROM web_rec_start_date) <= 10 GROUP BY ca_state, web_company_name ORDER BY total_net_sales DESC, total_quantity_sold DESC;
SELECT web.web_name AS website_name, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, t.t_shift AS sales_shift, s.s_store_name AS store_name, s.s_number_employees AS number_of_employees, s.s_city AS store_city, SUM(s.s_tax_precentage) AS total_tax_percentage_collected FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk JOIN time_dim t ON ws.ws_sold_time_sk = t.t_time_sk JOIN store s ON web.web_mkt_id = s.s_market_id WHERE web.web_mkt_id IN ('1', '4', '3') AND t.t_shift = 'third' AND s.s_gmt_offset = '-5.00' AND s.s_number_employees IN ('297', '278', '229', '245') GROUP BY web.web_name, t.t_shift, s.s_store_name, s.s_number_employees, s.s_city ORDER BY total_net_profit DESC;
SELECT p.p_promo_name, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, SUM(cs_net_paid) AS total_net_paid, AVG(cs_net_profit) AS average_net_profit, COUNT(DISTINCT cr_order_number) AS total_returns, SUM(cr_return_quantity) AS total_quantity_returned, SUM(cr_net_loss) AS total_net_loss, AVG(hd.hd_vehicle_count) AS average_vehicle_count FROM catalog_sales cs JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk LEFT JOIN catalog_returns cr ON cs.cs_item_sk = cr.cr_item_sk AND cs.cs_order_number = cr.cr_order_number JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk WHERE cs.cs_ext_wholesale_cost > 100 AND hd.hd_vehicle_count IN (0, 2, 3, 4) AND (cr.cr_returned_time_sk IS NULL OR cr.cr_returned_time_sk IN (80039, 82096, 81103)) GROUP BY p.p_promo_name ORDER BY total_net_paid DESC, total_net_loss ASC LIMIT 100;
SELECT sm.sm_type AS shipping_type, COUNT(DISTINCT cr.cr_order_number) AS total_return_transactions, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, COUNT(DISTINCT wr.wr_order_number) AS total_web_return_transactions, SUM(wr.wr_return_amt_inc_tax) AS total_web_return_amount, AVG(wr.wr_return_amt) AS average_web_return_amount FROM ship_mode sm LEFT JOIN catalog_returns cr ON sm.sm_ship_mode_sk = cr.cr_ship_mode_sk LEFT JOIN web_returns wr ON cr.cr_catalog_page_sk = wr.wr_web_page_sk LEFT JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk WHERE wr.wr_refunded_customer_sk IN ('49270', '61504', '79520') OR ws.web_city IN ('Fairview', 'Midway') GROUP BY sm.sm_type ORDER BY total_return_amount DESC, total_web_return_amount DESC;
SELECT c.c_first_name, c.c_last_name, w.w_state, dd.d_quarter_name, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amt_inc_tax) AS total_refund_amount, AVG(cr.cr_return_amt_inc_tax) AS avg_refund_amount, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN date_dim dd ON cr.cr_returned_date_sk = dd.d_date_sk JOIN customer c ON cr.cr_refunded_customer_sk = c.c_customer_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk WHERE dd.d_quarter_name IN ('1904Q4', '1908Q2', '1910Q1', '1903Q2', '1905Q1', '1912Q2') AND cr.cr_call_center_sk IN (1, 2, 4) AND cr.cr_refunded_customer_sk IN (1743, 46684, 78996, 36586, 29127, 56750) GROUP BY c.c_first_name, c.c_last_name, w.w_state, dd.d_quarter_name ORDER BY w.w_state, dd.d_quarter_name, c.c_last_name, c.c_first_name;
SELECT d_year, w_state, p_promo_name, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_profit) AS total_profit FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk JOIN promotion ON cs_promo_sk = p_promo_sk WHERE d_year = 2001 AND w_state IN ('WA', 'CA', 'TX') AND p_promo_id IN ('AAAAAAAAKDAAAAAA', 'AAAAAAAAKJAAAAAA', 'AAAAAAAACKAAAAAA') GROUP BY d_year, w_state, p_promo_name ORDER BY total_profit DESC, average_sales_price DESC LIMIT 10;
