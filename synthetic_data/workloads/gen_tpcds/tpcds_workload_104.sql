SELECT ib.ib_lower_bound, ib.ib_upper_bound, COUNT(hd.hd_demo_sk) AS household_count, AVG(hd.hd_dep_count) AS average_dependency_count, AVG(hd.hd_vehicle_count) AS average_vehicle_count, SUM(CASE WHEN p.p_channel_email = 'N' THEN p.p_cost ELSE 0 END) AS total_cost_non_email_promotions, SUM(CASE WHEN p.p_channel_tv = 'Y' THEN 1 ELSE 0 END) AS number_of_tv_promotions, SUM(CASE WHEN p.p_discount_active = 'Y' THEN p.p_response_target ELSE 0 END) AS total_target_with_active_discount, COUNT(DISTINCT CASE WHEN r.r_reason_desc = 'reason 27' THEN hd.hd_demo_sk ELSE NULL END) AS count_households_reason_27 FROM household_demographics hd LEFT JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk LEFT JOIN promotion p ON hd.hd_demo_sk = p.p_item_sk LEFT JOIN reason r ON p.p_promo_sk = r.r_reason_sk WHERE hd.hd_income_band_sk IN (15, 9, 18, 20) AND p.p_purpose <> 'Unknown' AND ib.ib_lower_bound IN (110001, 100001, 130001) AND ib.ib_upper_bound <> 70000 GROUP BY ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ib.ib_lower_bound, ib.ib_upper_bound;
SELECT ws_order_number, COUNT(DISTINCT ws_item_sk) AS item_count, SUM(ws_quantity) AS total_quantity, AVG(ws_sales_price) AS avg_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ws_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(ws_net_profit) AS total_net_profit, MIN(ws_ext_ship_cost) AS min_shipping_cost, MAX(ws_ext_ship_cost) AS max_shipping_cost FROM web_sales JOIN catalog_sales ON ws_item_sk = cs_item_sk AND ws_order_number = cs_order_number JOIN store_sales ON ws_item_sk = ss_item_sk AND ws_order_number = ss_ticket_number JOIN web_page ON ws_web_page_sk = wp_web_page_sk JOIN inventory ON ws_item_sk = inv_item_sk WHERE ws_sales_price BETWEEN 100 AND 200 AND cs_sales_price BETWEEN 100 AND 200 AND ss_sales_price BETWEEN 100 AND 200 AND ws_ext_ship_cost BETWEEN 10 AND 1360 AND wp_type = 'Product Review' GROUP BY ws_order_number HAVING COUNT(DISTINCT ws_item_sk) > 1 ORDER BY total_net_profit DESC;
SELECT w.w_state AS warehouse_state, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_profit) AS total_net_profit, COUNT(DISTINCT cr.cr_order_number) AS total_returns, AVG(cr.cr_return_amount) AS average_return_amount FROM web_sales ws LEFT JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk LEFT JOIN catalog_returns cr ON ws.ws_item_sk = cr.cr_item_sk AND ws.ws_order_number = cr.cr_order_number WHERE ws.ws_sold_date_sk = 2450976 GROUP BY w.w_state ORDER BY total_net_profit DESC;
SELECT ss.ss_store_sk AS store_id, hd.hd_vehicle_count AS vehicle_count, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_items_sold, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_sales_net_profit, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions, SUM(sr.sr_return_quantity) AS total_items_returned, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(sr.sr_net_loss) AS total_returns_net_loss, ARRAY_AGG(DISTINCT r.r_reason_desc) FILTER (WHERE sr.sr_reason_sk IS NOT NULL) AS return_reasons FROM store_sales ss JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk LEFT JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE ss.ss_store_sk IN ('10', '4', '7', '8') AND hd.hd_vehicle_count IN ('3', '2', '1', '4') GROUP BY ss.ss_store_sk, hd.hd_vehicle_count ORDER BY total_sales_net_profit DESC, total_returns_net_loss ASC;
SELECT r.r_reason_desc, sm.sm_type AS shipping_type, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_qty, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_inc_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_net_loss) AS total_net_loss, COUNT(DISTINCT s.s_store_sk) AS num_stores_with_returns, AVG(s.s_number_employees) AS avg_store_employees, AVG(s.s_floor_space) AS avg_store_floor_space, SUM(sr.sr_return_amt) AS total_store_return_amt, SUM(sr.sr_return_amt_inc_tax) AS total_store_return_inc_tax FROM catalog_returns cr JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN store_returns sr ON cr.cr_item_sk = sr.sr_item_sk AND cr.cr_order_number = sr.sr_ticket_number LEFT JOIN store s ON sr.sr_store_sk = s.s_store_sk WHERE r.r_reason_desc IN ('Gift exchange', 'duplicate purchase', 'Did not like the make', 'Found a better extended warranty in a store') AND sm.sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') AND (s.s_street_number IN ('337', '255', '175') OR s.s_state = 'TN') GROUP BY r.r_reason_desc, shipping_type ORDER BY total_returns DESC;
SELECT s.s_store_name, SUM(inv.inv_quantity_on_hand) AS Total_Inventory, AVG(inv.inv_quantity_on_hand) AS Average_Inventory, COUNT(DISTINCT inv.inv_item_sk) AS Unique_Items, COUNT(DISTINCT ca.ca_address_sk) AS Number_of_Customers, SUM(CASE WHEN cd.cd_credit_rating = 'High Risk' THEN cd.cd_purchase_estimate ELSE 0 END) AS High_Risk_Estimated_Purchases, AVG(cd.cd_purchase_estimate) AS Avg_Customer_Purchase_Estimate, SUM(cd.cd_dep_count) AS Total_Dependents, COUNT(DISTINCT sm.sm_ship_mode_sk) AS Shipping_Modes_Used FROM store s JOIN inventory inv ON s.s_store_sk = inv.inv_warehouse_sk JOIN customer_address ca ON ca.ca_city = s.s_city AND ca.ca_state = s.s_state JOIN customer_demographics cd ON ca.ca_address_sk = cd.cd_demo_sk JOIN ship_mode sm ON sm.sm_type = 'AIR' WHERE s.s_market_desc = 'Mysterious employe' AND inv.inv_quantity_on_hand IN (794, 3, 631, 744, 849) AND inv.inv_item_sk IN (10984, 6848, 7628) GROUP BY s.s_store_name ORDER BY Total_Inventory DESC, Number_of_Customers DESC LIMIT 100;
SELECT dd.d_year, dd.d_quarter_name, sm.sm_type, COUNT(DISTINCT inv.inv_item_sk) AS distinct_items_count, SUM(inv.inv_quantity_on_hand) AS total_quantity, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, AVG(i.i_current_price) AS avg_current_price, (SUM(i.i_current_price * inv.inv_quantity_on_hand) - SUM(i.i_wholesale_cost * inv.inv_quantity_on_hand)) AS total_profit, COUNT(DISTINCT cc.cc_call_center_sk) AS call_centers_count, COUNT(DISTINCT w.w_warehouse_sk) AS warehouses_count, COUNT(DISTINCT ws.web_site_sk) AS web_sites_count FROM inventory inv JOIN item i ON inv.inv_item_sk = i.i_item_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN date_dim dd ON inv.inv_date_sk = dd.d_date_sk JOIN call_center cc ON cc.cc_open_date_sk <= dd.d_date_sk AND (cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date >= dd.d_date) JOIN web_site ws ON ws.web_open_date_sk <= dd.d_date_sk AND (ws.web_rec_end_date IS NULL OR ws.web_rec_end_date >= dd.d_date) JOIN ship_mode sm ON sm.sm_code = 'AIR' WHERE dd.d_current_month = 'N' AND w.w_state = 'TN' AND w.w_city = 'Fairview' AND w.w_county = 'Williamson County' AND (cc.cc_class = 'large' OR cc.cc_class = 'medium') AND (i.i_color = 'forest' OR i.i_color = 'navy') AND ws.web_class <> 'Unknown' AND ws.web_gmt_offset = '-5.00' AND ws.web_company_id IN (3, 4, 5) GROUP BY dd.d_year, dd.d_quarter_name, sm.sm_type ORDER BY dd.d_year, dd.d_quarter_name, sm.sm_type;
SELECT w_state, web_name, ca_city, COUNT(DISTINCT cr_order_number) AS total_returns, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_quantity) AS total_returned_quantity, SUM(cr_return_amount) AS total_returned_amount, SUM(cr_fee) AS total_fees, SUM(cr_net_loss) AS total_net_loss, COUNT(DISTINCT ss_ticket_number) AS total_sales_transactions, AVG(ss_sales_price) AS avg_sales_price, SUM(ss_quantity) AS total_sold_quantity, SUM(ss_net_profit) AS total_net_profit FROM warehouse JOIN catalog_returns ON w_warehouse_sk = cr_warehouse_sk JOIN reason ON cr_reason_sk = r_reason_sk JOIN customer_address ON cr_returning_addr_sk = ca_address_sk JOIN store_sales ON cr_item_sk = ss_item_sk AND cr_order_number = ss_ticket_number JOIN store ON ss_store_sk = s_store_sk JOIN web_site ON s_store_sk = web_site_sk WHERE w_country = 'United States' AND ca_street_number IN ('125', '871', '690') AND ca_city = 'Glenville' AND web_rec_end_date IN ('1999-08-16', '2000-08-15', '2001-08-15') AND web_site_sk IN ('25', '29', '21', '17') GROUP BY w_state, web_name, ca_city ORDER BY total_returns DESC, total_net_profit DESC;
SELECT s.s_state AS store_state, s.s_city AS store_city, SUM(s.s_floor_space) AS total_store_floor_space, SUM(s.s_number_employees) AS total_store_employees, AVG(s.s_tax_precentage) AS avg_store_tax_percentage, COUNT(DISTINCT w.w_warehouse_sk) AS total_warehouses, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(wp.wp_image_count) AS avg_webpage_image_count, AVG(wp.wp_link_count) AS avg_webpage_link_count FROM store s LEFT JOIN warehouse w ON s.s_city = w.w_city AND s.s_state = w.w_state LEFT JOIN web_page wp ON s.s_store_sk = wp.wp_customer_sk WHERE s.s_geography_class = 'Unknown' AND w.w_street_name IN ('View First', 'Wilson Elm', '6th', 'Ash Laurel') AND w.w_warehouse_id IN ('AAAAAAAACAAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAADAAAAAAA') AND wp.wp_url = 'http://www.foo.com' AND wp.wp_web_page_sk IN ('33', '24', '36', '14', '7', '49') GROUP BY s.s_state, s.s_city ORDER BY s.s_state, s.s_city;
SELECT c.c_birth_country, COUNT(DISTINCT c.c_customer_sk) AS total_customers, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_sq_ft FROM customer c JOIN warehouse w ON c.c_birth_country = w.w_country GROUP BY c.c_birth_country ORDER BY total_customers DESC, avg_warehouse_sq_ft DESC;
SELECT ca.ca_state AS customer_state, r.r_reason_desc AS return_reason, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_amt) AS total_return_amt, SUM(sr.sr_return_tax) AS total_return_tax, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk GROUP BY ca.ca_state, r.r_reason_desc ORDER BY ca.ca_state, r.r_reason_desc;
SELECT d_year, cd_gender, cd_marital_status, cd_education_status, ib_lower_bound, ib_upper_bound, COUNT(DISTINCT c_customer_sk) AS num_customers, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_net_profit) AS total_net_profit, SUM(wr_return_quantity) AS total_quantity_returned, AVG(wr_return_amt) AS avg_return_amount, SUM(inv_quantity_on_hand) AS total_inventory_quantity FROM date_dim JOIN catalog_sales ON (date_dim.d_date_sk = catalog_sales.cs_sold_date_sk) JOIN customer ON (catalog_sales.cs_bill_customer_sk = customer.c_customer_sk) JOIN customer_demographics ON (customer.c_current_cdemo_sk = customer_demographics.cd_demo_sk) JOIN income_band ON (customer_demographics.cd_purchase_estimate BETWEEN income_band.ib_lower_bound AND income_band.ib_upper_bound) LEFT JOIN web_returns ON (catalog_sales.cs_item_sk = web_returns.wr_item_sk AND catalog_sales.cs_order_number = web_returns.wr_order_number) LEFT JOIN inventory ON (catalog_sales.cs_item_sk = inventory.inv_item_sk AND date_dim.d_date_sk = inventory.inv_date_sk) WHERE cd_gender IN ('M', 'F') AND cd_marital_status IN ('M', 'U') AND cd_education_status IN ('4 yr Degree', '2 yr Degree') AND d_year IN (2001, 2002, 2003) AND d_moy BETWEEN 1 AND 6 AND ib_income_band_sk IN (1, 2, 3) AND d_current_year = 'N' GROUP BY d_year, cd_gender, cd_marital_status, cd_education_status, ib_lower_bound, ib_upper_bound ORDER BY d_year, cd_gender, cd_marital_status, cd_education_status, ib_lower_bound, ib_upper_bound;
SELECT cd.cd_gender, cd.cd_marital_status, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(ws.ws_net_paid) AS total_web_sales, COUNT(DISTINCT ws.ws_order_number) AS total_orders FROM web_sales ws JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN web_site wsit ON ws.ws_web_site_sk = wsit.web_site_sk WHERE wsit.web_city IN ('Midway', 'Fairview') AND wsit.web_manager IN ('Lewis Wolf', 'William Carter') GROUP BY cd.cd_gender, cd.cd_marital_status ORDER BY total_web_sales DESC, avg_purchase_estimate DESC;
SELECT cd.cd_education_status, cd.cd_credit_rating, AVG(sr.sr_return_amt) AS avg_store_return_amt, SUM(cr.cr_return_amount) AS sum_catalog_return_amt, COUNT(DISTINCT sr.sr_customer_sk) AS unique_store_customers, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_catalog_customers FROM customer_demographics cd LEFT JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk LEFT JOIN catalog_returns cr ON cd.cd_demo_sk = cr.cr_returning_cdemo_sk LEFT JOIN household_demographics hd ON cd.cd_demo_sk = hd.hd_demo_sk WHERE cd.cd_purchase_estimate IN (3500, 1500, 10000) AND cd.cd_dep_college_count = 0 AND hd.hd_income_band_sk IN (19, 8, 15, 3, 1) GROUP BY cd.cd_education_status, cd.cd_credit_rating ORDER BY avg_store_return_amt DESC, sum_catalog_return_amt DESC;
SELECT s.s_division_name, AVG(s.s_number_employees) as avg_employees, SUM(s.s_floor_space) as total_floor_space, COUNT(DISTINCT c.c_customer_sk) as total_customers, AVG(i.ib_upper_bound) as avg_income_upper_bound, MIN(i.ib_lower_bound) as min_income_lower_bound, COUNT(DISTINCT wp.wp_web_page_sk) as total_web_pages, SUM(wp.wp_image_count) as total_images FROM store s JOIN customer c ON s.s_store_sk = c.c_current_addr_sk LEFT JOIN income_band i ON i.ib_income_band_sk = c.c_current_hdemo_sk LEFT JOIN web_page wp ON wp.wp_customer_sk = c.c_customer_sk WHERE s.s_division_name <> 'Unknown' AND c.c_current_addr_sk IN (13536, 17282) AND c.c_first_shipto_date_sk = 2451994 AND i.ib_upper_bound IN (90000, 30000, 20000, 200000, 70000, 60000) AND i.ib_lower_bound > 110001 GROUP BY s.s_division_name ORDER BY total_customers DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT hd.hd_demo_sk) AS household_count, SUM(cs.cs_ext_sales_price) AS total_sales_amount, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders FROM catalog_sales cs JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN time_dim t ON cs.cs_sold_time_sk = t.t_time_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk WHERE t.t_shift = 'Morning' AND ib.ib_upper_bound <= 190000 AND w.w_gmt_offset = -5.00 AND w.w_street_name IN ('Ash Laurel', '6th', 'Wilson Elm', 'View First') GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ib.ib_income_band_sk;
SELECT ws.ws_web_site_sk, web.web_name, web.web_class, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_inc_tax, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_coupon_amt) AS total_coupon_amt_used, sm.sm_type AS shipping_type, sm.sm_carrier AS shipping_carrier, COUNT(DISTINCT ws.ws_warehouse_sk) AS total_warehouses_used, t.t_shift AS time_shift, COUNT(DISTINCT ws.ws_ship_mode_sk) AS total_ship_modes_used FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk JOIN time_dim t ON ws.ws_sold_time_sk = t.t_time_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk WHERE web.web_country = 'United States' AND ws.ws_coupon_amt IN (1426.08, 70.99, 196.19) AND t.t_minute IN (33, 5, 49, 22, 42, 10) AND ws.ws_web_site_sk IN (4, 3, 28, 16, 7, 26) GROUP BY ws.ws_web_site_sk, web.web_name, web.web_class, sm.sm_type, sm.sm_carrier, t.t_shift ORDER BY total_net_paid DESC;
SELECT dd.d_year, dd.d_quarter_name, cd.cd_education_status, sum(cr.cr_return_quantity) AS total_returned_quantity, avg(cr.cr_return_amount) AS avg_return_amount, count(distinct cr.cr_refunded_customer_sk) AS unique_customers_refunded, sum(inv.inv_quantity_on_hand) AS total_inventory_on_hand, sum(p.p_cost) AS total_promotion_cost FROM catalog_returns cr JOIN date_dim dd ON cr.cr_returned_date_sk = dd.d_date_sk JOIN customer_demographics cd ON cr.cr_returning_cdemo_sk = cd.cd_demo_sk JOIN inventory inv ON cr.cr_item_sk = inv.inv_item_sk AND inv.inv_date_sk = dd.d_date_sk JOIN promotion p ON p.p_item_sk = cr.cr_item_sk AND p.p_start_date_sk <= dd.d_date_sk AND p.p_end_date_sk >= dd.d_date_sk WHERE dd.d_year = 2022 AND cd.cd_dep_college_count = 0 AND dd.d_qoy IN (1, 2, 3, 4) AND cr.cr_item_sk IN (12109, 7004, 944, 13729, 16502) GROUP BY dd.d_year, dd.d_quarter_name, cd.cd_education_status ORDER BY dd.d_year, dd.d_quarter_name, cd.cd_education_status;
SELECT dt.d_year, dt.d_quarter_name, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ws.ws_net_paid_inc_tax) AS total_web_net_paid_inc_tax, cc.cc_city, AVG(hd.hd_dep_count) AS average_household_dependency_count, SUM(inv.inv_quantity_on_hand) AS total_inventory_on_hand FROM date_dim dt JOIN store_sales ss ON dt.d_date_sk = ss.ss_sold_date_sk JOIN web_sales ws ON dt.d_date_sk = ws.ws_sold_date_sk JOIN customer c ON (ss.ss_customer_sk = c.c_customer_sk OR ws.ws_bill_customer_sk = c.c_customer_sk) JOIN call_center cc ON (cc.cc_open_date_sk = dt.d_date_sk OR cc.cc_closed_date_sk = dt.d_date_sk) JOIN household_demographics hd ON (c.c_current_hdemo_sk = hd.hd_demo_sk OR ws.ws_bill_hdemo_sk = hd.hd_demo_sk) JOIN inventory inv ON dt.d_date_sk = inv.inv_date_sk WHERE dt.d_moy = 5 AND (dt.d_qoy = 1 OR dt.d_qoy = 2 OR dt.d_qoy = 3) AND (c.c_first_shipto_date_sk IN (2449442, 2451172, 2452404)) AND cc.cc_city = 'Midway' AND (ws.ws_item_sk IN (4, 103, 60)) AND (ws.ws_sales_price IN (38.82, 43.63, 82.62, 63.23)) GROUP BY dt.d_year, dt.d_quarter_name, cc.cc_city ORDER BY total_quantity_sold DESC, average_sales_price DESC, total_inventory_on_hand DESC, dt.d_year, dt.d_quarter_name;
SELECT cp.cp_department, cp.cp_type, COUNT(DISTINCT ws.ws_web_page_sk) AS total_web_pages, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ws.ws_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(ws.ws_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(ws.ws_net_profit) AS total_net_profit FROM catalog_page cp JOIN web_sales ws ON cp.cp_catalog_page_sk = ws.ws_web_page_sk WHERE cp.cp_end_date_sk = 2451114 AND ws.ws_ext_discount_amt = 2691.00 GROUP BY cp.cp_department, cp.cp_type ORDER BY total_net_paid DESC;
SELECT ca_state, ca_country, w_state, w_country, SUM(sr_return_quantity) AS total_returned_quantity, AVG(sr_return_amt) AS average_return_amount, SUM(sr_fee) AS total_fees, COUNT(DISTINCT sr_customer_sk) AS unique_customers_returning, COUNT(DISTINCT sr_ticket_number) AS total_return_transactions FROM store_returns JOIN customer_address ON store_returns.sr_addr_sk = customer_address.ca_address_sk JOIN warehouse ON store_returns.sr_store_sk = warehouse.w_warehouse_sk WHERE customer_address.ca_gmt_offset IN (-6.00, -10.00, -8.00, -9.00, -7.00) AND warehouse.w_zip = '35709' AND store_returns.sr_addr_sk = '47239' GROUP BY ca_state, ca_country, w_state, w_country ORDER BY ca_state, ca_country;
SELECT c.c_first_name, c.c_last_name, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(s.s_number_employees) AS avg_store_employees, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages, MAX(sm.sm_code) AS max_ship_mode_code FROM customer c JOIN web_page wp ON c.c_customer_sk = wp.wp_customer_sk JOIN store s ON s.s_zip = CAST(c.c_current_addr_sk AS CHAR(10)) JOIN warehouse w ON w.w_zip = s.s_zip JOIN ship_mode sm ON sm.sm_code = w.w_zip WHERE w.w_gmt_offset = '-5.00' AND (wp.wp_char_count = '2129' OR wp.wp_char_count = '2531') AND (wp.wp_rec_end_date = '1999-09-03' OR wp.wp_rec_end_date = '2001-09-02' OR wp.wp_rec_end_date = '2000-09-02') GROUP BY c.c_first_name, c.c_last_name;
SELECT cc.cc_name, cc.cc_class, cc.cc_hours, ca.ca_city, ca.ca_state, hd.hd_buy_potential, hd.hd_vehicle_count, SUM(cs.cs_net_paid_inc_ship_tax) AS total_sales, AVG(cs.cs_net_paid_inc_ship_tax) AS avg_sales, COUNT(DISTINCT cs.cs_order_number) AS number_of_orders, SUM(wr.wr_return_amt_inc_tax) AS total_returns, AVG(wr.wr_return_amt_inc_tax) AS avg_returns, COUNT(DISTINCT wr.wr_order_number) AS number_of_returns FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number WHERE cc.cc_hours IN ('8AM-4PM', '8AM-8AM') AND cc.cc_class IN ('large', 'small', 'medium') AND cc.cc_county = 'Williamson County' AND cc.cc_division_name IN ('pri', 'ese', 'ought') AND hd.hd_buy_potential IN ('Unknown', '5001-10000', '501-1000') AND hd.hd_vehicle_count IN (4, 2, 0) AND ca.ca_zip IN ('73951', '52565', '72297') AND ca.ca_city IN ('Millwood', 'Forest', 'Newport') AND cs.cs_net_paid_inc_ship_tax IN (5723.12, 5673.95, 2697.52) AND cs.cs_ship_addr_sk IN (9885, 17067, 29571) AND wr.wr_return_tax IN (46.49, 3.87, 51.37) AND wr.wr_return_ship_cost IN (547.26, 948.48, 764.52) AND wr.wr_item_sk IN (10976, 17844, 12276) GROUP BY cc.cc_name, cc.cc_class, cc.cc_hours, ca.ca_city, ca.ca_state, hd.hd_buy_potential, hd.hd_vehicle_count ORDER BY total_sales DESC, total_returns DESC;
SELECT s.s_store_name, cp.cp_department, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(ss.ss_net_profit) AS total_net_profit, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN cs.cs_quantity ELSE 0 END) AS preferred_customer_quantity_sold, AVG(hd.hd_dep_count) AS average_household_dependency_count, AVG(hd.hd_vehicle_count) AS average_household_vehicle_count FROM store s JOIN store_sales ss ON ss.ss_store_sk = s.s_store_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN catalog_sales cs ON cs.cs_ship_customer_sk = c.c_customer_sk JOIN catalog_page cp ON cp.cp_catalog_page_sk = cs.cs_catalog_page_sk WHERE s.s_rec_end_date IS NULL AND ss.ss_sales_price BETWEEN 11.33 AND 139.32 AND ss.ss_quantity IN (11, 33) AND cs.cs_bill_addr_sk IN (20241, 24240, 324) GROUP BY s.s_store_name, cp.cp_department ORDER BY total_net_profit DESC, total_orders DESC LIMIT 10;
SELECT w_state, w_city, p_promo_name, COUNT(DISTINCT wr_order_number) AS total_returns, SUM(wr_return_quantity) AS total_returned_quantity, AVG(wr_return_amt) AS avg_return_amount, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(wr_fee) AS total_fees, SUM(wr_net_loss) AS total_net_loss FROM warehouse JOIN web_returns ON w_warehouse_sk = wr_returning_addr_sk JOIN promotion ON p_promo_sk = wr_web_page_sk WHERE w_street_name = 'Ash Laurel' AND p_channel_catalog = 'N' AND p_channel_press = 'N' AND wr_account_credit IN ('618.25', '63.54', '2191.76', '19.59', '469.21', '464.73') GROUP BY w_state, w_city, p_promo_name ORDER BY total_net_loss DESC, w_state, w_city;
SELECT i.i_category, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(inv.inv_quantity_on_hand) AS total_inventory_on_hand, SUM(ss.ss_net_profit) AS total_net_profit FROM item i JOIN store_sales ss ON i.i_item_sk = ss.ss_item_sk JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE i.i_wholesale_cost BETWEEN 4 AND 7 AND inv.inv_date_sk = '2450815' AND ss.ss_ext_sales_price < 5000 AND t.t_hour BETWEEN 0 AND 1 GROUP BY i.i_category ORDER BY total_net_profit DESC;
SELECT COALESCE(customer_sales.cd_gender, customer_returns.cd_gender) AS cd_gender, SUM(total_sales) AS total_sales_amount, AVG(average_sales) AS average_sales_amount, COUNT(DISTINCT customer_sales.c_customer_sk) AS number_of_customers, SUM(total_returns) AS total_returns_amount, AVG(average_returns) AS average_returns_amount, COUNT(DISTINCT customer_returns.c_customer_sk) AS number_of_returning_customers FROM ( SELECT c_customer_sk, cd_gender, ss_sold_date_sk, SUM(ss_sales_price) AS total_sales, AVG(ss_sales_price) AS average_sales FROM customer JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk JOIN store_sales ON ss_customer_sk = c_customer_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year = 2023 AND cd_gender IN ('M', 'F') GROUP BY c_customer_sk, cd_gender, ss_sold_date_sk ) AS customer_sales FULL OUTER JOIN ( SELECT c_customer_sk, cd_gender, sr_returned_date_sk, SUM(sr_return_amt) AS total_returns, AVG(sr_return_amt) AS average_returns FROM customer JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk JOIN store_returns ON sr_customer_sk = c_customer_sk JOIN date_dim ON sr_returned_date_sk = d_date_sk WHERE d_year = 2023 AND cd_gender IN ('M', 'F') GROUP BY c_customer_sk, cd_gender, sr_returned_date_sk ) AS customer_returns ON customer_sales.c_customer_sk = customer_returns.c_customer_sk GROUP BY COALESCE(customer_sales.cd_gender, customer_returns.cd_gender);
SELECT sm.sm_type AS shipping_type, web.web_site_sk, web.web_name AS website_name, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_paid) AS total_revenue, AVG(ws.ws_quantity) AS average_quantity, AVG(ws.ws_ext_discount_amt) AS average_discount, SUM(ws.ws_coupon_amt) AS total_coupon_amount, SUM(ws.ws_net_profit) AS total_profit FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk WHERE web.web_name IN ('site_3', 'site_4', 'site_1', 'site_0', 'site_2') AND sm.sm_contract IN ('GNJr3g5i7oorKqtX', 'uukTktPYycct8', 'ldhM8IvpzHgdbBgDfI', '2mM8l') AND ws.ws_sold_date_sk BETWEEN 20230101 AND 20231231 GROUP BY sm.sm_type, web.web_site_sk, web.web_name ORDER BY total_revenue DESC;
SELECT s.s_store_name, s.s_company_name, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_return_quantity) AS average_return_quantity, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_incl_tax, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_net_loss) AS total_net_loss, cd.cd_education_status, AVG(cd.cd_purchase_estimate) AS average_purchase_estimate, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages_involved, td.t_shift, SUM(CASE WHEN td.t_am_pm = 'PM' THEN 1 ELSE 0 END) AS returns_in_pm, SUM(CASE WHEN td.t_am_pm = 'AM' THEN 1 ELSE 0 END) AS returns_in_am FROM store s JOIN web_returns wr ON s.s_store_sk = wr.wr_returning_addr_sk JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk JOIN time_dim td ON wr.wr_returned_time_sk = td.t_time_sk WHERE s.s_tax_precentage BETWEEN 0.06 AND 0.08 AND s.s_company_name <> 'Unknown' AND wp.wp_type = 'feedback' AND wp.wp_rec_start_date > '1999-09-04' AND td.t_minute IN (50, 18) GROUP BY s.s_store_name, s.s_company_name, cd.cd_education_status, td.t_shift ORDER BY total_returns DESC, total_return_amount DESC;
