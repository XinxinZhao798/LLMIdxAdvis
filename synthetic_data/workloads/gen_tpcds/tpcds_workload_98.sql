SELECT d_year, i_category, SUM(ss_quantity) AS total_store_sales_quantity, AVG(ss_sales_price) AS avg_store_sales_price, AVG(cs_sales_price) AS avg_catalog_sales_price, AVG(ws_sales_price) AS avg_web_sales_price, SUM(ss_net_paid) AS total_store_net_paid, SUM(cs_net_paid) AS total_catalog_net_paid, SUM(ws_net_paid) AS total_web_net_paid, COUNT(DISTINCT ss_store_sk) AS number_of_stores, COUNT(DISTINCT cs_catalog_page_sk) AS number_of_catalog_pages, COUNT(DISTINCT ws_web_site_sk) AS number_of_websites FROM store_sales JOIN date_dim ON (ss_sold_date_sk = d_date_sk) JOIN item ON (ss_item_sk = i_item_sk) LEFT JOIN catalog_sales ON (ss_item_sk = cs_item_sk AND ss_sold_date_sk = cs_sold_date_sk) LEFT JOIN web_sales ON (ss_item_sk = ws_item_sk AND ss_sold_date_sk = ws_sold_date_sk) WHERE d_year = 1999 AND (ss_net_paid > 900 OR cs_net_paid > 900 OR ws_net_paid > 900) AND i_manager_id IN (65, 2, 85) GROUP BY d_year, i_category ORDER BY total_store_sales_quantity DESC, total_store_net_paid DESC, i_category;
SELECT ws_item_sk, AVG(ws_net_profit) AS avg_web_net_profit, AVG(ss_net_profit) AS avg_store_net_profit, (AVG(ws_net_profit) - AVG(ss_net_profit)) AS profit_difference FROM web_sales JOIN web_page ON ws_web_page_sk = wp_web_page_sk LEFT JOIN store_sales ON ws_item_sk = ss_item_sk WHERE wp_char_count > 3000 GROUP BY ws_item_sk HAVING AVG(ws_net_profit) IS NOT NULL AND AVG(ss_net_profit) IS NOT NULL ORDER BY profit_difference DESC;
SELECT cc.cc_name, COUNT(ws.ws_order_number) AS total_online_orders, SUM(ws.ws_quantity) AS total_items_sold, SUM(ws.ws_net_paid) AS total_revenue, SUM(ws.ws_net_profit) AS total_profit, AVG(ws.ws_quantity) AS avg_items_per_order, SUM(sr.sr_return_quantity) AS total_items_returned, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_quantity) AS avg_items_returned_per_order, SUM(wr.wr_return_quantity) AS web_total_items_returned, SUM(wr.wr_return_amt) AS web_total_return_amount, AVG(wr.wr_return_quantity) AS web_avg_items_returned_per_order, COUNT(DISTINCT sm.sm_ship_mode_sk) AS distinct_shipping_modes_used, SUM(promo.p_cost) AS total_promotional_cost FROM call_center cc LEFT JOIN web_sales ws ON cc.cc_call_center_sk = ws.ws_web_page_sk LEFT JOIN store_returns sr ON ws.ws_order_number = sr.sr_ticket_number LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number LEFT JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN promotion promo ON ws.ws_promo_sk = promo.p_promo_sk WHERE cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date > CURRENT_DATE GROUP BY cc.cc_name ORDER BY total_revenue DESC;
SELECT c.c_salutation, cd.cd_gender, cd.cd_education_status, cd.cd_credit_rating, COUNT(*) AS total_customers, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, COUNT(DISTINCT ws.ws_promo_sk) AS number_of_promotions_used FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk WHERE c.c_salutation IN ('Sir', 'Miss', 'Mrs.', 'Ms.') AND cd.cd_demo_sk IN ('17361', '17821', '17056', '18235') AND ws.ws_list_price = '160.03' AND ws.ws_ship_cdemo_sk IN ('887064', '1910407', '1755166', '369305', '1188209') GROUP BY c.c_salutation, cd.cd_gender, cd.cd_education_status, cd.cd_credit_rating ORDER BY total_net_profit DESC, total_customers DESC, average_sales_price DESC;
SELECT c.c_customer_id, hd.hd_buy_potential, COUNT(*) AS number_of_customers, AVG(hd.hd_vehicle_count) AS average_vehicle_count, SUM(hd.hd_dep_count) AS total_dependents, sm.sm_type AS shipping_type, COUNT(DISTINCT sm.sm_carrier) AS number_of_unique_carriers FROM customer c JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN ship_mode sm ON sm.sm_code = c.c_login WHERE c.c_birth_year > 1980 AND c.c_preferred_cust_flag = 'Y' AND sm.sm_code IN ('BIKE', 'SURFACE', 'SEA') GROUP BY c.c_customer_id, hd.hd_buy_potential, sm.sm_type HAVING COUNT(*) > 1 ORDER BY number_of_customers DESC, average_vehicle_count DESC LIMIT 100;
SELECT cd.cd_education_status, ca.ca_state, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(ss.ss_ticket_number) AS total_sales_transactions FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE d.d_weekend = 'Y' AND d.d_year = 2022 GROUP BY cd.cd_education_status, ca.ca_state ORDER BY cd.cd_education_status, ca.ca_state;
SELECT c.c_birth_year, r.r_reason_desc, AVG(sr.sr_return_amt_inc_tax) AS avg_store_return_amount_inc_tax, AVG(wr.wr_return_amt_inc_tax) AS avg_web_return_amount_inc_tax, SUM(sr.sr_return_quantity) AS total_store_return_quantity, SUM(wr.wr_return_quantity) AS total_web_return_quantity, AVG(sr.sr_fee) AS avg_store_fee, AVG(wr.wr_fee) AS avg_web_fee, COUNT(DISTINCT sr.sr_customer_sk) AS num_customers_store, COUNT(DISTINCT wr.wr_refunded_customer_sk) AS num_customers_web FROM customer c LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_refunded_customer_sk LEFT JOIN reason r ON r.r_reason_sk = sr.sr_reason_sk OR r.r_reason_sk = wr.wr_reason_sk WHERE c.c_preferred_cust_flag = 'Y' AND (sr.sr_return_amt IS NOT NULL OR wr.wr_return_amt IS NOT NULL) GROUP BY c.c_birth_year, r.r_reason_desc ORDER BY c.c_birth_year, avg_store_return_amount_inc_tax DESC, avg_web_return_amount_inc_tax DESC;
SELECT i.i_category AS item_category, i.i_brand AS item_brand, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid_inc_ship_tax) AS total_sales, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT i.i_item_sk) AS item_count FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN web_site w ON ws.ws_web_site_sk = w.web_site_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk WHERE w.web_mkt_class = 'Right efforts must no' AND sm.sm_code = 'SEA' AND w.web_company_id = 1 GROUP BY i.i_category, i.i_brand ORDER BY total_sales DESC, item_category, item_brand;
SELECT ca_state, cd_marital_status, hd_buy_potential, COUNT(DISTINCT c_customer_sk) AS num_customers, AVG(ws_quantity) AS avg_quantity_sold, SUM(ws_net_paid_inc_tax) AS total_paid_inc_tax, SUM(ws_net_profit) AS total_net_profit FROM customer JOIN web_sales ON c_customer_sk = ws_bill_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk WHERE ca_county IN ('Esmeralda County', 'Clallam County', 'Henderson County', 'Plumas County', 'Wells County') AND hd_buy_potential IN ('>10000', 'Unknown', '0-500', '5001-10000', '1001-5000', '501-1000') AND cd_marital_status IN ('D', 'M', 'U', 'S', 'W') GROUP BY ROLLUP (ca_state, cd_marital_status, hd_buy_potential) ORDER BY ca_state, cd_marital_status, hd_buy_potential;
SELECT i.i_category, i.i_brand, ca.ca_state, ca.ca_city, SUM(sr.sr_return_amt) AS total_return_amount, AVG(i.i_current_price) AS average_item_price, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(CASE WHEN p.p_promo_sk IS NOT NULL THEN sr.sr_return_quantity ELSE 0 END) AS promo_return_quantity, SUM(CASE WHEN p.p_promo_sk IS NULL THEN sr.sr_return_quantity ELSE 0 END) AS no_promo_return_quantity FROM store_returns sr JOIN item i ON sr.sr_item_sk = i.i_item_sk LEFT JOIN promotion p ON i.i_item_sk = p.p_item_sk JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk WHERE i.i_category_id IN ('4', '2') AND i.i_container <> 'Unknown' GROUP BY i.i_category, i.i_brand, ca.ca_state, ca.ca_city ORDER BY total_return_amount DESC, average_item_price DESC, total_returns DESC;
