SELECT d.d_year, d.d_quarter_name, COUNT(distinct wp.wp_web_page_sk) AS webpage_count, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(sr.sr_fee) AS total_return_fees, MAX(cp.cp_catalog_page_number) AS max_catalog_page_number, sm.sm_type AS ship_mode_type, COUNT(distinct ib.ib_income_band_sk) AS income_band_count FROM date_dim d LEFT JOIN web_page wp ON d.d_date_sk = wp.wp_access_date_sk LEFT JOIN store_returns sr ON d.d_date_sk = sr.sr_returned_date_sk LEFT JOIN catalog_page cp ON (d.d_date_sk >= cp.cp_start_date_sk AND d.d_date_sk <= cp.cp_end_date_sk) LEFT JOIN ship_mode sm ON sr.sr_return_ship_cost BETWEEN 36.08 AND 716.95 LEFT JOIN income_band ib ON sr.sr_return_amt_inc_tax BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound WHERE d.d_current_quarter = 'N' AND d.d_year = 2022 AND sm.sm_contract IN ('UaAJjKDnL4gTOqbpj', 'O9V6oF8RJnLMmZYd1', 'fop0bcSd91J26IVpR', 'A5BYO1qH8HGTTN', '5FKNB0j8aaqTB') AND cp.cp_catalog_page_id IN ('AAAAAAAAAEIAAAAA', 'AAAAAAAAMNNAAAAA') GROUP BY d.d_year, d.d_quarter_name, sm.sm_type ORDER BY d.d_year, d.d_quarter_name;
SELECT ws.ws_web_site_sk, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(ws.ws_order_number) AS total_orders, AVG(ws.ws_quantity) AS avg_quantity, SUM(ws.ws_net_paid_inc_tax) AS total_revenue, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_coupon_amt) AS total_coupon_amt, AVG(hd.hd_dep_count) AS avg_dependency_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, wp.wp_type, COUNT(DISTINCT hd.hd_demo_sk) AS unique_households FROM web_sales ws JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk JOIN household_demographics hd ON ws.ws_ship_hdemo_sk = hd.hd_demo_sk JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk JOIN web_site wsit ON ws.ws_web_site_sk = wsit.web_site_sk WHERE wsit.web_gmt_offset = '-5.00' AND wsit.web_site_sk IN (6, 17, 14) AND td.t_time IN (3552, 4450, 1742) AND ws.ws_sales_price BETWEEN 17.54 AND 205.36 AND ws.ws_item_sk IN (51, 14, 107, 50, 104, 108) GROUP BY ws.ws_web_site_sk, wp.wp_type ORDER BY total_revenue DESC;
SELECT cs_state, SUM(cs_total_sales) AS total_sales, SUM(cr_total_returns) AS total_returns, (SUM(cs_net_profit) - SUM(cr_net_loss)) AS net_profit FROM (SELECT ca_state AS cs_state, SUM(ss_ext_sales_price) AS cs_total_sales, SUM(ss_net_profit) AS cs_net_profit FROM store_sales JOIN customer ON ss_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk GROUP BY ca_state) sales LEFT JOIN (SELECT ca_state AS cr_state, SUM(cr_return_amount) AS cr_total_returns, SUM(cr_net_loss) AS cr_net_loss FROM catalog_returns JOIN customer ON cr_returning_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk GROUP BY ca_state) returns ON sales.cs_state = returns.cr_state GROUP BY cs_state ORDER BY net_profit DESC;
SELECT cr.cr_returned_date_sk AS return_date, wp.wp_type AS web_page_type, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_including_tax, SUM(ws.ws_quantity) AS total_sold_quantity, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM catalog_returns cr JOIN web_sales ws ON cr.cr_item_sk = ws.ws_item_sk AND cr.cr_order_number = ws.ws_order_number JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk GROUP BY cr.cr_returned_date_sk, wp.wp_type ORDER BY cr.cr_returned_date_sk, wp.wp_type;
SELECT p.p_promo_name, sm.sm_type AS shipping_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_net_paid) AS average_sales_per_order, SUM(cs.cs_net_profit) AS total_profit, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_quantity) AS total_web_quantity, SUM(ws.ws_net_paid) AS total_web_sales, AVG(ws.ws_net_paid) AS average_web_sales_per_order, SUM(ws.ws_net_profit) AS total_web_profit FROM promotion p LEFT JOIN catalog_sales cs ON p.p_promo_sk = cs.cs_promo_sk LEFT JOIN web_sales ws ON p.p_promo_sk = ws.ws_promo_sk LEFT JOIN ship_mode sm ON (cs.cs_ship_mode_sk = sm.sm_ship_mode_sk OR ws.ws_ship_mode_sk = sm.sm_ship_mode_sk) WHERE p.p_start_date_sk IN ('2450688', '2450248', '2450699', '2450857', '2450196', '2450745') AND (sm.sm_type IN ('EXPRESS', 'OVERNIGHT', 'TWO DAY', 'NEXT DAY') OR sm.sm_type IS NULL) AND (cs.cs_ship_customer_sk IN ('65147', '83434', '5487', '82518') OR ws.ws_ship_customer_sk IN ('65147', '83434', '5487', '82518')) AND p.p_channel_tv = 'N' GROUP BY p.p_promo_name, sm.sm_type ORDER BY total_sales DESC, total_web_sales DESC;
SELECT w_state, s_county, p_promo_name, COUNT(*) AS num_sales, SUM(cs_net_paid) AS total_net_sales, AVG(cs_net_profit) AS avg_net_profit, SUM(ws_net_paid) AS total_web_net_sales, AVG(ws_net_profit) AS avg_web_net_profit FROM warehouse JOIN catalog_sales ON cs_warehouse_sk = w_warehouse_sk JOIN web_sales ON ws_warehouse_sk = w_warehouse_sk JOIN promotion ON cs_promo_sk = p_promo_sk AND ws_promo_sk = p_promo_sk JOIN store ON w_state = s_state WHERE w_state = 'TN' AND s_county = 'Williamson County' AND (p_promo_id = 'AAAAAAAAIAAAAAAA' OR p_promo_id = 'AAAAAAAACAAAAAAA') GROUP BY w_state, s_county, p_promo_name ORDER BY total_net_sales DESC, total_web_net_sales DESC;
SELECT s_state AS state, AVG(ws_sales_price) AS avg_web_sales_price, SUM(ws_quantity) AS total_web_sales_quantity, COUNT(DISTINCT s_store_sk) AS num_stores, COUNT(DISTINCT w_warehouse_sk) AS num_warehouses FROM web_sales JOIN store ON web_sales.ws_ship_addr_sk = store.s_store_sk JOIN warehouse ON web_sales.ws_warehouse_sk = warehouse.w_warehouse_sk GROUP BY state ORDER BY state;
SELECT c.c_customer_sk, ca.ca_state, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(hd.hd_dep_count) AS avg_dependency_count, COUNT(DISTINCT w.w_warehouse_sk) AS number_of_warehouses, MAX(t.t_time) AS latest_time FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN inventory inv ON inv.inv_warehouse_sk = ca.ca_address_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN time_dim t ON inv.inv_date_sk = t.t_time_sk WHERE ca.ca_state IN ('TX', 'NV') AND hd.hd_vehicle_count = 2 AND t.t_sub_shift = 'night' AND c.c_birth_month IN (2, 9, 12, 4, 5) AND c.c_birth_year IN (1928, 1924) GROUP BY c.c_customer_sk, ca.ca_state ORDER BY total_inventory DESC, avg_dependency_count, number_of_warehouses, latest_time;
SELECT cp.cp_department, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_items_sold, SUM(ss.ss_net_paid) AS total_net_sales, AVG(ss.ss_ext_discount_amt) AS average_discount_amount, AVG(ss.ss_coupon_amt) AS average_coupon_amount, COUNT(DISTINCT ws.ws_order_number) AS total_web_transactions, SUM(ws.ws_quantity) AS total_web_items_sold, SUM(ws.ws_net_paid) AS total_web_net_sales, AVG(ws.ws_ext_discount_amt) AS average_web_discount_amount, AVG(ws.ws_coupon_amt) AS average_web_coupon_amount FROM catalog_page cp LEFT JOIN store_sales ss ON cp.cp_catalog_page_sk = ss.ss_item_sk LEFT JOIN web_sales ws ON cp.cp_catalog_page_sk = ws.ws_item_sk LEFT JOIN customer c ON (ss.ss_customer_sk = c.c_customer_sk OR ws.ws_bill_customer_sk = c.c_customer_sk) LEFT JOIN promotion p ON (ss.ss_promo_sk = p.p_promo_sk OR ws.ws_promo_sk = p.p_promo_sk) WHERE c.c_current_addr_sk IN ('19802', '46929', '21311', '47125', '38184', '20733') AND ss.ss_customer_sk IN ('4421', '99300', '61176', '55450', '48911', '11041') AND cp.cp_department = 'DEPARTMENT' AND p.p_response_target = 1 AND p.p_channel_event = 'N' GROUP BY cp.cp_department, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo ORDER BY cp.cp_department, total_net_sales DESC;
SELECT c.cc_name, c.cc_state, AVG(s.s_number_employees) as avg_store_employees, SUM(sr.sr_return_amt) as total_return_amount, SUM(sr.sr_return_quantity) as total_returned_quantity, COUNT(DISTINCT hd.hd_demo_sk) as unique_household_count, AVG(cd.cd_purchase_estimate) as avg_purchase_estimate FROM call_center c JOIN store s ON c.cc_state = s.s_state AND c.cc_mkt_id = s.s_market_id JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk WHERE c.cc_class = 'small' AND cd.cd_purchase_estimate > 5000 AND hd.hd_income_band_sk IS NOT NULL AND sr.sr_return_ship_cost > 100 AND sr.sr_returned_date_sk IS NOT NULL GROUP BY c.cc_name, c.cc_state ORDER BY total_return_amount DESC, avg_store_employees DESC, unique_household_count DESC;
SELECT sm.sm_type AS shipping_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_items_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_revenue, SUM(cs.cs_net_profit) AS total_profit, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_items_returned, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_net_loss) AS total_loss FROM catalog_sales cs JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN web_returns wr ON cs.cs_order_number = wr.wr_order_number AND cs.cs_item_sk = wr.wr_item_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk WHERE sm.sm_type IN ('REGULAR', 'OVERNIGHT') AND cd.cd_gender IN ('M', 'F') AND cs.cs_quantity IN (91, 62, 46, 68, 45) AND (wr.wr_returned_time_sk = 74117 OR wr.wr_returned_time_sk IS NULL) GROUP BY sm.sm_type ORDER BY total_revenue DESC, total_loss ASC;
SELECT sm.sm_type AS shipping_type, web.web_site_sk AS website_id, web.web_name AS website_name, i.i_category AS product_category, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_incl_tax, SUM(ws.ws_net_paid_inc_ship) AS total_net_paid_incl_shipping, SUM(ws.ws_net_paid_inc_ship_tax) AS total_net_paid_incl_shipping_tax, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk WHERE sm.sm_type IN ('REGULAR', 'EXPRESS', 'OVERNIGHT') AND web.web_country = 'United States' AND ws.ws_warehouse_sk IN (2, 4) AND i.i_category IN ('Electronics', 'Women', 'Children', 'Home', 'Sports', 'Books') AND dd.d_year = 1999 GROUP BY shipping_type, website_id, website_name, product_category ORDER BY total_net_profit DESC, total_net_paid DESC, website_name, product_category;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address, SUM(cr.cr_return_amount) AS total_catalog_returns, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_return_orders, AVG(cr.cr_return_quantity) AS avg_catalog_return_quantity, SUM(wr.wr_return_amt) AS total_web_returns, COUNT(DISTINCT wr.wr_order_number) AS total_web_return_orders, AVG(wr.wr_return_quantity) AS avg_web_return_quantity, SUM(ws.ws_sales_price) AS total_web_sales, AVG(ws.ws_quantity) AS avg_web_sales_quantity, COUNT(DISTINCT ws.ws_order_number) AS total_web_sales_orders, SUM(ws.ws_net_profit) AS total_web_net_profit FROM customer c LEFT JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_returning_customer_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk LEFT JOIN web_sales ws ON c.c_customer_sk = ws.ws_ship_customer_sk GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address ORDER BY total_web_net_profit DESC, total_catalog_returns DESC, total_web_returns DESC LIMIT 100;
SELECT w_state, w_city, p_promo_name, COUNT(DISTINCT wr_order_number) AS total_returns, SUM(wr_return_quantity) AS total_returned_quantity, AVG(wr_return_amt) AS avg_return_amount, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(wr_fee) AS total_fees, SUM(wr_net_loss) AS total_net_loss FROM warehouse JOIN web_returns ON w_warehouse_sk = wr_returning_addr_sk JOIN promotion ON p_promo_sk = wr_web_page_sk WHERE w_street_name = 'Ash Laurel' AND p_channel_catalog = 'N' AND p_channel_press = 'N' AND wr_account_credit IN ('618.25', '63.54', '2191.76', '19.59', '469.21', '464.73') GROUP BY w_state, w_city, p_promo_name ORDER BY total_net_loss DESC, w_state, w_city;
SELECT ca_state, w_state, AVG(c_hd.hd_dep_count) AS avg_household_dep_count, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_profit) AS total_net_profit, SUM(ss_net_profit) AS total_store_net_profit FROM customer_address ca JOIN catalog_sales cs ON ca.ca_address_sk = cs.cs_bill_addr_sk JOIN household_demographics c_hd ON cs.cs_bill_hdemo_sk = c_hd.hd_demo_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN store_sales ss ON cs.cs_item_sk = ss.ss_item_sk AND cs.cs_order_number = ss.ss_ticket_number WHERE ca.ca_country = 'United States' AND w.w_country = 'United States' AND ss.ss_quantity > 5 AND cs.cs_quantity > 5 AND ca.ca_state IN ('CA', 'TX', 'NY') GROUP BY ca_state, w_state ORDER BY total_net_profit DESC, total_store_net_profit DESC, ca_state, w_state;
SELECT p_channel_dmail AS direct_mail, p_channel_email AS email, p_channel_catalog AS catalog, p_channel_tv AS tv, p_channel_radio AS radio, p_channel_press AS press, p_channel_event AS event, p_channel_demo AS demo, SUM(p_cost) AS total_promo_cost, COUNT(p_promo_sk) AS num_promotions, AVG(sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, COUNT(sr_returned_date_sk) AS total_returns FROM promotion p LEFT JOIN store_returns sr ON p.p_item_sk = sr.sr_item_sk LEFT JOIN date_dim d1 ON p.p_start_date_sk = d1.d_date_sk LEFT JOIN date_dim d2 ON sr.sr_returned_date_sk = d2.d_date_sk LEFT JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE d1.d_fy_year = 1911 AND r.r_reason_sk IN ('15', '19', '29', '8') GROUP BY p_channel_dmail, p_channel_email, p_channel_catalog, p_channel_tv, p_channel_radio, p_channel_press, p_channel_event, p_channel_demo ORDER BY total_promo_cost DESC;
SELECT ca.ca_city, ca.ca_state, COUNT(DISTINCT cc.cc_call_center_id) AS num_call_centers, SUM(cc.cc_employees) AS total_employees, AVG(hd.hd_dep_count) AS avg_household_dep_count, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_return_quantity) AS total_returned_items, COUNT(DISTINCT sr.sr_ticket_number) AS num_return_transactions, AVG(sr.sr_fee) AS avg_return_fee FROM call_center cc JOIN customer_address ca ON cc.cc_city = ca.ca_city AND cc.cc_state = ca.ca_state JOIN household_demographics hd ON hd.hd_income_band_sk BETWEEN 9 AND 15 JOIN store_returns sr ON sr.sr_addr_sk = ca.ca_address_sk JOIN ship_mode sm ON sm.sm_contract IN ('A5BYO1qH8HGTTN', 'Xjy3ZPuiDjzHlRx14Z3', '2mM8l', '6Hzzp4JkzjqD8MGXLCDa') WHERE ca.ca_city IN ('Lewisburg', 'Wright', 'Valley View', 'Argyle', 'Plainview', 'Andover') AND sm.sm_type = 'REGULAR' AND ca.ca_gmt_offset IN (-6.00, -9.00, -5.00, -10.00) AND (hd.hd_dep_count IN (0, 3, 7, 8, 9) OR hd.hd_dep_count IS NULL) GROUP BY ca.ca_city, ca.ca_state ORDER BY total_return_amount DESC, total_employees DESC, num_return_transactions DESC;
SELECT w.w_warehouse_name, cc.cc_name AS call_center_name, cd.cp_department, sm.sm_type AS ship_mode_type, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_quantity) AS total_quantity_sold, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(CASE WHEN hd.hd_vehicle_count > 2 THEN ss.ss_net_paid ELSE 0 END) AS net_paid_more_than_2_vehicles, SUM(CASE WHEN cd.cp_type = 'quarterly' THEN ss.ss_net_paid_inc_tax ELSE 0 END) AS net_paid_inc_tax_for_quarterly_pages FROM store_sales ss JOIN warehouse w ON ss.ss_store_sk = w.w_warehouse_sk JOIN call_center cc ON w.w_zip = cc.cc_zip JOIN catalog_page cd ON ss.ss_promo_sk = cd.cp_catalog_page_sk JOIN ship_mode sm ON sm.sm_code = 'AIR' JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk WHERE cc.cc_street_type = 'Boulevard' AND cd.cp_type IN ('quarterly', 'bi-annual') AND w.w_suite_number IN ('Suite 80', 'Suite P') GROUP BY w.w_warehouse_name, cc.cc_name, cd.cp_department, sm.sm_type ORDER BY avg_sales_price DESC, total_quantity_sold DESC, unique_customers DESC, net_paid_more_than_2_vehicles DESC, net_paid_inc_tax_for_quarterly_pages DESC;
SELECT hd.hd_income_band_sk, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, COUNT(DISTINCT sr.sr_customer_sk) AS unique_customers_returned, SUM(CASE WHEN p.p_channel_email = 'Y' THEN sr.sr_return_quantity ELSE 0 END) AS email_promo_returned_quantity, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk JOIN promotion p ON sr.sr_item_sk = p.p_item_sk JOIN inventory i ON sr.sr_item_sk = i.inv_item_sk AND i.inv_warehouse_sk = 1 WHERE hd.hd_demo_sk IN (1588, 4700) AND sr.sr_refunded_cash IN (10.38, 1818.70) GROUP BY hd.hd_income_band_sk ORDER BY total_net_loss DESC;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_state, ca.ca_country, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_paid_inc_ship_tax) AS total_revenue, SUM(cs.cs_net_profit) AS total_profit FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON cs.cs_bill_addr_sk = ca.ca_address_sk JOIN store s ON cs.cs_warehouse_sk = s.s_store_sk WHERE dd.d_year = 2002 AND ca.ca_country = 'United States' AND s.s_division_id = 1 AND ( dd.d_week_seq IN (54, 685, 542) OR dd.d_quarter_seq IN (43, 26, 39) ) AND ( cs.cs_item_sk IN (58, 10, 49) OR cs.cs_warehouse_sk IN (3, 2, 4) ) AND cs.cs_net_paid_inc_ship_tax IN (2242.98, 10093.84, 2662.12) GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state, ca.ca_country ORDER BY total_revenue DESC, total_profit DESC LIMIT 100;
SELECT ca_state, COUNT(DISTINCT ca_address_sk) AS num_addresses, SUM(s_number_employees) AS total_employees, AVG(s_floor_space) AS avg_floor_space, SUM(CASE WHEN s_hours LIKE '%24%' THEN 1 ELSE 0 END) AS stores_open_24h, SUM(CASE WHEN web_gmt_offset = '-5.00' THEN 1 ELSE 0 END) AS websites_gmt_minus_5, COUNT(DISTINCT r_reason_sk) AS num_distinct_reasons, AVG(web_tax_percentage) AS avg_web_tax_percentage FROM customer_address JOIN store ON ca_county = s_county AND ca_state = s_state JOIN web_site ON s_state = web_state LEFT JOIN reason ON r_reason_id IN ('AAAAAAAAFAAAAAAA', 'AAAAAAAABCAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAAMAAAAAAA', 'AAAAAAAAJBAAAAAA', 'AAAAAAAAGAAAAAAA') WHERE ca_street_type IN ('Court', 'Cir.') AND web_close_date_sk IN ('2447148', '2447046') GROUP BY ca_state ORDER BY num_addresses DESC;
SELECT sm.sm_type AS shipping_type, COUNT(DISTINCT cr.cr_order_number) AS total_return_transactions, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, COUNT(DISTINCT wr.wr_order_number) AS total_web_return_transactions, SUM(wr.wr_return_amt_inc_tax) AS total_web_return_amount, AVG(wr.wr_return_amt) AS average_web_return_amount FROM ship_mode sm LEFT JOIN catalog_returns cr ON sm.sm_ship_mode_sk = cr.cr_ship_mode_sk LEFT JOIN web_returns wr ON cr.cr_catalog_page_sk = wr.wr_web_page_sk LEFT JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk WHERE wr.wr_refunded_customer_sk IN ('49270', '61504', '79520') OR ws.web_city IN ('Fairview', 'Midway') GROUP BY sm.sm_type ORDER BY total_return_amount DESC, total_web_return_amount DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, td.t_am_pm, AVG(ws.ws_sales_price) AS avg_sales_price, SUM(ws.ws_quantity) AS total_sales_quantity, SUM(wr.wr_return_quantity) AS total_return_quantity, SUM(wr.wr_net_loss) AS total_net_loss FROM web_sales ws JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND td.t_time_sk = wr.wr_returned_time_sk WHERE td.t_am_pm = 'AM' GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, td.t_am_pm ORDER BY ib.ib_income_band_sk, td.t_am_pm;
SELECT i.i_category AS item_category, i.i_brand AS item_brand, p.p_channel_details AS promotion_channel, SUM(cs.cs_ext_sales_price) AS total_sales, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(cs.cs_item_sk) AS items_sold_count FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE p.p_channel_dmail = 'N' AND p.p_channel_event = 'N' AND i.i_units IN ('Oz', 'Ounce', 'Tsp', 'Dozen') GROUP BY i.i_category, i.i_brand, p.p_channel_details ORDER BY total_sales DESC, i.i_category, i.i_brand;
SELECT cp.cp_department, COUNT(*) AS total_catalog_pages, AVG(cp.cp_catalog_number) AS average_catalog_number, SUM(inv.inv_quantity_on_hand) AS total_inventory_quantity, AVG(wr.wr_return_amt_inc_tax) AS average_return_amount_inc_tax, COUNT(DISTINCT wr.wr_order_number) AS total_returned_orders, COUNT(DISTINCT cd.cd_demo_sk) AS unique_customers, SUM(CASE WHEN hd.hd_income_band_sk IS NOT NULL THEN 1 ELSE 0 END) AS households_with_income_band, sm.sm_type AS shipping_type, COUNT(DISTINCT sm.sm_ship_mode_sk) AS count_shipping_modes, ROUND(SUM(wr.wr_fee)::numeric, 2) AS total_fees_collected, ROUND(SUM(wr.wr_reversed_charge)::numeric, 2) AS total_reversed_charges FROM catalog_page cp LEFT JOIN inventory inv ON cp.cp_catalog_page_sk = inv.inv_item_sk LEFT JOIN web_returns wr ON inv.inv_item_sk = wr.wr_item_sk LEFT JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk LEFT JOIN household_demographics hd ON wr.wr_returning_hdemo_sk = hd.hd_demo_sk LEFT JOIN ship_mode sm ON sm.sm_ship_mode_sk IN (9, 10) WHERE cp.cp_start_date_sk IS NOT NULL AND cp.cp_end_date_sk IS NOT NULL AND (wr.wr_reversed_charge IN ('35.79', '219.13', '107.56', '7.03') OR wr.wr_fee IN ('60.42', '16.01', '7.56', '22.38')) AND (inv.inv_quantity_on_hand IN (932, 682, 540) OR inv.inv_item_sk IN (12650, 13507, 12682, 13526)) GROUP BY cp.cp_department, sm.sm_type ORDER BY total_catalog_pages DESC, average_return_amount_inc_tax DESC;
