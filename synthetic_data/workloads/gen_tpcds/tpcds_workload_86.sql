SELECT d.d_year, d.d_quarter_name, COUNT(distinct wp.wp_web_page_sk) AS webpage_count, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(sr.sr_fee) AS total_return_fees, MAX(cp.cp_catalog_page_number) AS max_catalog_page_number, sm.sm_type AS ship_mode_type, COUNT(distinct ib.ib_income_band_sk) AS income_band_count FROM date_dim d LEFT JOIN web_page wp ON d.d_date_sk = wp.wp_access_date_sk LEFT JOIN store_returns sr ON d.d_date_sk = sr.sr_returned_date_sk LEFT JOIN catalog_page cp ON (d.d_date_sk >= cp.cp_start_date_sk AND d.d_date_sk <= cp.cp_end_date_sk) LEFT JOIN ship_mode sm ON sr.sr_return_ship_cost BETWEEN 36.08 AND 716.95 LEFT JOIN income_band ib ON sr.sr_return_amt_inc_tax BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound WHERE d.d_current_quarter = 'N' AND d.d_year = 2022 AND sm.sm_contract IN ('UaAJjKDnL4gTOqbpj', 'O9V6oF8RJnLMmZYd1', 'fop0bcSd91J26IVpR', 'A5BYO1qH8HGTTN', '5FKNB0j8aaqTB') AND cp.cp_catalog_page_id IN ('AAAAAAAAAEIAAAAA', 'AAAAAAAAMNNAAAAA') GROUP BY d.d_year, d.d_quarter_name, sm.sm_type ORDER BY d.d_year, d.d_quarter_name;
SELECT dd.d_year, dd.d_quarter_name, sm.sm_type, COUNT(DISTINCT inv.inv_item_sk) AS distinct_items_count, SUM(inv.inv_quantity_on_hand) AS total_quantity, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, AVG(i.i_current_price) AS avg_current_price, (SUM(i.i_current_price * inv.inv_quantity_on_hand) - SUM(i.i_wholesale_cost * inv.inv_quantity_on_hand)) AS total_profit, COUNT(DISTINCT cc.cc_call_center_sk) AS call_centers_count, COUNT(DISTINCT w.w_warehouse_sk) AS warehouses_count, COUNT(DISTINCT ws.web_site_sk) AS web_sites_count FROM inventory inv JOIN item i ON inv.inv_item_sk = i.i_item_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN date_dim dd ON inv.inv_date_sk = dd.d_date_sk JOIN call_center cc ON cc.cc_open_date_sk <= dd.d_date_sk AND (cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date >= dd.d_date) JOIN web_site ws ON ws.web_open_date_sk <= dd.d_date_sk AND (ws.web_rec_end_date IS NULL OR ws.web_rec_end_date >= dd.d_date) JOIN ship_mode sm ON sm.sm_code = 'AIR' WHERE dd.d_current_month = 'N' AND w.w_state = 'TN' AND w.w_city = 'Fairview' AND w.w_county = 'Williamson County' AND (cc.cc_class = 'large' OR cc.cc_class = 'medium') AND (i.i_color = 'forest' OR i.i_color = 'navy') AND ws.web_class <> 'Unknown' AND ws.web_gmt_offset = '-5.00' AND ws.web_company_id IN (3, 4, 5) GROUP BY dd.d_year, dd.d_quarter_name, sm.sm_type ORDER BY dd.d_year, dd.d_quarter_name, sm.sm_type;
SELECT s_state AS state, AVG(ws_sales_price) AS avg_web_sales_price, SUM(ws_quantity) AS total_web_sales_quantity, COUNT(DISTINCT s_store_sk) AS num_stores, COUNT(DISTINCT w_warehouse_sk) AS num_warehouses FROM web_sales JOIN store ON web_sales.ws_ship_addr_sk = store.s_store_sk JOIN warehouse ON web_sales.ws_warehouse_sk = warehouse.w_warehouse_sk GROUP BY state ORDER BY state;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(cr.cr_order_number) AS total_returns, AVG(cr.cr_return_amount) AS avg_refund_amount, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN customer_demographics cd ON cr.cr_refunded_cdemo_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk AND w.w_street_name IN ('Wilson Elm', 'Ash Laurel', '6th') JOIN time_dim t ON cr.cr_returned_time_sk = t.t_time_sk WHERE t.t_hour BETWEEN 9 AND 17 AND w.w_suite_number IN ('Suite 80', 'Suite 470', 'Suite 0') AND ib.ib_upper_bound IN (130000, 120000, 40000, 200000) GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_net_loss DESC;
SELECT d_year, i_category, s_state, SUM(i_current_price) AS total_price, AVG(i_current_price) AS avg_price, COUNT(DISTINCT i_item_sk) AS unique_items_sold, COUNT(DISTINCT s_store_sk) AS number_of_stores, SUM(p_cost) AS total_promotion_cost, AVG(p_cost) AS avg_promotion_cost, COUNT(DISTINCT p_promo_sk) AS number_of_promotions, MAX(wp_max_ad_count) AS max_ad_count_webpage FROM date_dim, item, store, promotion, web_page, ship_mode WHERE i_rec_start_date <= d_date AND (i_rec_end_date IS NULL OR i_rec_end_date > d_date) AND s_rec_start_date <= d_date AND (s_rec_end_date IS NULL OR s_rec_end_date > d_date) AND wp_rec_start_date <= d_date AND (wp_rec_end_date IS NULL OR wp_rec_end_date > d_date) AND p_start_date_sk = d_date_sk AND (p_end_date_sk IS NULL OR p_end_date_sk >= d_date_sk) AND sm_type IN ('REGULAR', 'LIBRARY') AND i_class IN ('sports-apparel', 'decor', 'dvd/vcr players', 'shirts', 'bedding', 'fishing') AND p_channel_event = 'N' AND p_purpose <> 'Unknown' GROUP BY d_year, i_category, s_state ORDER BY d_year, i_category, s_state;
SELECT s.s_store_name, s.s_division_name, c.cc_name, c.cc_manager, hd.hd_buy_potential, COUNT(sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, AVG(sr.sr_return_quantity) AS avg_return_quantity, SUM(wr.wr_return_amt_inc_tax) AS total_web_return_amount_inc_tax, AVG(wr.wr_return_quantity) AS avg_web_return_quantity, COUNT(DISTINCT cu.c_customer_sk) AS unique_customers_returning, SUM(hd.hd_dep_count) AS total_dependents, AVG(hd.hd_vehicle_count) AS avg_vehicles_per_household FROM store s JOIN store_returns sr ON sr.sr_store_sk = s.s_store_sk JOIN call_center c ON c.cc_mkt_id = s.s_market_id JOIN customer cu ON cu.c_customer_sk = sr.sr_customer_sk JOIN household_demographics hd ON cu.c_current_hdemo_sk = hd.hd_demo_sk JOIN web_returns wr ON wr.wr_returning_customer_sk = cu.c_customer_sk WHERE c.cc_manager IN ('Bob Belcher', 'Felipe Perkins', 'Larry Mccray', 'Mark Hightower') AND hd.hd_buy_potential IN ('501-1000', '>10000', 'Unknown') AND s.s_division_name = 'Unknown' AND wr.wr_returning_hdemo_sk IN (2871, 6633, 6615, 4553) GROUP BY s.s_store_name, s.s_division_name, c.cc_name, c.cc_manager, hd.hd_buy_potential ORDER BY total_return_amount_inc_tax DESC, total_web_return_amount_inc_tax DESC LIMIT 100;
SELECT i_category, i_class, w_city, p_promo_name, SUM(ws_quantity) AS total_quantity_sold, AVG(ws_sales_price) AS average_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_paid_inc_tax) AS total_net_paid_inc_tax, COUNT(DISTINCT ws_order_number) AS total_orders, COUNT(DISTINCT ws_bill_cdemo_sk) AS total_unique_customers FROM web_sales JOIN item ON ws_item_sk = i_item_sk JOIN warehouse ON ws_warehouse_sk = w_warehouse_sk JOIN promotion ON ws_promo_sk = p_promo_sk JOIN customer_demographics ON ws_bill_cdemo_sk = cd_demo_sk WHERE w_city = 'Fairview' AND p_cost = 1000.00 AND p_channel_demo = 'N' GROUP BY i_category, i_class, w_city, p_promo_name ORDER BY total_net_paid DESC, total_quantity_sold DESC;
SELECT d_year, d_quarter_name, ca_state, COUNT(DISTINCT ws_order_number) AS total_orders, SUM(ws_quantity) AS total_quantity, AVG(ws_sales_price) AS average_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_profit) AS total_net_profit, SUM(ws_ext_tax) AS total_tax_collected FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN customer_address ON ws_bill_addr_sk = ca_address_sk JOIN customer_demographics ON ws_bill_cdemo_sk = cd_demo_sk JOIN catalog_page ON ws_web_page_sk = cp_catalog_page_sk JOIN store ON ws_warehouse_sk = s_store_sk WHERE d_current_quarter = 'N' AND cd_dep_employed_count = 0 AND cp_department = 'DEPARTMENT' AND ws_order_number IN ('25231', '23240', '18952', '15512', '28993', '33703') GROUP BY d_year, d_quarter_name, ca_state ORDER BY d_year, d_quarter_name, ca_state;
SELECT cc.cc_name, ws.web_name, i.i_category, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS avg_sales_price, COUNT(DISTINCT cs.cs_bill_customer_sk) AS unique_customers, SUM(wr.wr_return_quantity) AS total_quantity_returned, SUM(wr.wr_net_loss) AS total_net_loss FROM catalog_sales cs JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk JOIN web_site ws ON cc.cc_mkt_id = ws.web_mkt_id JOIN item i ON cs.cs_item_sk = i.i_item_sk LEFT JOIN web_returns wr ON wr.wr_item_sk = i.i_item_sk AND wr.wr_order_number = cs.cs_order_number JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk WHERE cc.cc_class = 'small' AND ws.web_site_sk IN (25, 3) AND d.d_date BETWEEN '2022-01-01' AND '2022-12-31' AND (wr.wr_reason_sk IS NULL OR wr.wr_reason_sk IN (34, 25)) GROUP BY cc.cc_name, ws.web_name, i.i_category ORDER BY total_quantity_sold DESC, total_net_loss ASC;
SELECT s_state, cp_department, COUNT(DISTINCT s_store_sk) AS store_count, AVG(s_number_employees) AS avg_number_employees, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, AVG(wr_return_quantity) AS avg_return_quantity, SUM(wr_net_loss) AS total_net_loss FROM store JOIN catalog_page ON (s_store_sk = cp_catalog_page_sk) JOIN web_returns ON (s_store_sk = wr_returning_addr_sk) WHERE s_suite_number IN ('Suite T', 'Suite 140') AND cp_start_date_sk IS NOT NULL AND wr_returned_date_sk IS NOT NULL GROUP BY ROLLUP(s_state, cp_department) ORDER BY s_state, cp_department;
SELECT ca_state, count(*) AS address_count, avg(ca_gmt_offset) AS average_gmt_offset, sm_type, sm_carrier, count(DISTINCT sm_ship_mode_sk) AS unique_ship_mode_count, ib_lower_bound, ib_upper_bound, sum(CASE WHEN ib_upper_bound <= 20000 THEN 1 ELSE 0 END) AS low_income_band_count, sum(CASE WHEN ib_upper_bound > 20000 AND ib_upper_bound <= 40000 THEN 1 ELSE 0 END) AS mid_income_band_count, sum(CASE WHEN ib_upper_bound > 170000 THEN 1 ELSE 0 END) AS high_income_band_count, avg(ib_lower_bound + ib_upper_bound) / 2 AS average_income_band FROM customer_address JOIN ship_mode ON ca_zip = left(sm_ship_mode_id, 5) JOIN income_band ON ib_income_band_sk::text = right(sm_ship_mode_id, length(sm_ship_mode_id) - 5) GROUP BY ca_state, sm_type, sm_carrier, ib_lower_bound, ib_upper_bound ORDER BY ca_state, sm_type, sm_carrier, ib_lower_bound;
SELECT ws_order_number, COUNT(DISTINCT ws_item_sk) AS item_count, SUM(ws_quantity) AS total_quantity, AVG(ws_sales_price) AS avg_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ws_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(ws_net_profit) AS total_net_profit, MIN(ws_ext_ship_cost) AS min_shipping_cost, MAX(ws_ext_ship_cost) AS max_shipping_cost FROM web_sales JOIN catalog_sales ON ws_item_sk = cs_item_sk AND ws_order_number = cs_order_number JOIN store_sales ON ws_item_sk = ss_item_sk AND ws_order_number = ss_ticket_number JOIN web_page ON ws_web_page_sk = wp_web_page_sk JOIN inventory ON ws_item_sk = inv_item_sk WHERE ws_sales_price BETWEEN 100 AND 200 AND cs_sales_price BETWEEN 100 AND 200 AND ss_sales_price BETWEEN 100 AND 200 AND ws_ext_ship_cost BETWEEN 10 AND 1360 AND wp_type = 'Product Review' GROUP BY ws_order_number HAVING COUNT(DISTINCT ws_item_sk) > 1 ORDER BY total_net_profit DESC;
SELECT ws.web_name, d.d_year, d.d_quarter_name, i.i_category, SUM(cs_quantity) AS total_quantity_sold, SUM(cs_ext_sales_price) AS total_sales, AVG(cs_sales_price) AS avg_sales_price, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(wr_return_quantity) AS total_returned_quantity, SUM(wr_return_amt) AS total_return_amount, (SUM(cs_ext_sales_price) - SUM(cs_ext_discount_amt)) AS net_sales_after_discounts, (SUM(cs_ext_sales_price) - SUM(wr_return_amt)) AS net_sales_after_returns FROM web_site ws JOIN catalog_sales cs ON ws.web_site_sk = cs.cs_warehouse_sk JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk LEFT JOIN web_returns wr ON cs.cs_order_number = wr.wr_order_number AND cs.cs_item_sk = wr.wr_item_sk WHERE d.d_year = 2001 AND ws.web_zip IN ('35709', '31904') AND i.i_units IN ('Gross', 'Oz') AND d.d_current_day = 'N' GROUP BY ws.web_name, d.d_year, d.d_quarter_name, i.i_category ORDER BY total_sales DESC, net_sales_after_discounts DESC, net_sales_after_returns DESC;
SELECT cc.cc_city, i.i_category, COUNT(DISTINCT cc.cc_call_center_sk) AS total_call_centers, SUM(cc.cc_employees) AS total_employees, AVG(cc.cc_sq_ft) AS avg_square_footage, COUNT(DISTINCT i.i_item_sk) AS total_items, AVG(i.i_current_price) AS avg_item_price, MIN(ib.ib_lower_bound) AS min_income_band_lower_bound, MAX(ib.ib_upper_bound) AS max_income_band_upper_bound, AVG(cc.cc_tax_percentage) AS avg_tax_percentage FROM call_center cc JOIN item i ON cc.cc_division = i.i_manufact_id JOIN income_band ib ON ib.ib_income_band_sk = cc.cc_mkt_id WHERE cc.cc_street_type IN ('Boulevard', 'RD', 'Way') AND i.i_units IN ('Dram', 'Ounce', 'Gram') AND ib.ib_income_band_sk IN (3, 5, 7, 8) AND cc.cc_tax_percentage BETWEEN 0.01 AND 0.12 GROUP BY cc.cc_city, i.i_category ORDER BY total_call_centers DESC, avg_item_price ASC LIMIT 10;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_ext_discount_amt) AS avg_discount_amount, COUNT(DISTINCT ss.ss_ticket_number) AS total_tickets, COUNT(DISTINCT p.p_promo_sk) AS total_promotions FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE p.p_channel_dmail = 'Y' AND ss.ss_sold_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_sales DESC, avg_discount_amount DESC;
SELECT w_state, COUNT(DISTINCT w_warehouse_sk) AS total_warehouses, SUM(w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(w_warehouse_sq_ft) AS avg_warehouse_sq_ft, SUM(sr_return_amt) AS total_return_amt, AVG(sr_return_amt) AS avg_return_amt, COUNT(DISTINCT sr_ticket_number) AS total_return_transactions, SUM(wp_char_count) AS total_webpage_char_count, AVG(wp_link_count) AS avg_webpage_link_count, COUNT(DISTINCT web_site_sk) AS total_websites, SUM(web_tax_percentage) AS total_web_tax_percentage, AVG(web_tax_percentage) AS avg_web_tax_percentage FROM warehouse w LEFT JOIN store_returns sr ON w.w_warehouse_sk = sr.sr_store_sk LEFT JOIN web_page wp ON w.w_warehouse_sk = wp.wp_customer_sk LEFT JOIN web_site ws ON wp.wp_web_page_sk = ws.web_site_sk GROUP BY w_state ORDER BY total_return_amt DESC;
SELECT dd.d_dow AS day_of_week, cd.cd_gender AS gender, cd.cd_marital_status AS marital_status, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, AVG(CASE WHEN cd.cd_credit_rating = 'Good' THEN 1 WHEN cd.cd_credit_rating = 'Bad' THEN 0 ELSE NULL END) AS avg_credit_good, COUNT(*) AS customer_count FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN date_dim dd ON c.c_first_sales_date_sk = dd.d_date_sk WHERE dd.d_dow = '6' AND cd.cd_dep_count = '2' AND cd.cd_marital_status IN ('M', 'U') AND c.c_first_shipto_date_sk = 2451880 GROUP BY dd.d_dow, cd.cd_gender, cd.cd_marital_status ORDER BY cd.cd_gender, cd.cd_marital_status, avg_purchase_estimate DESC;
SELECT SUM(ss.ss_net_profit) AS total_net_profit, AVG(ss.ss_quantity) AS average_quantity_sold, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, COUNT(DISTINCT sr.sr_reason_sk) AS number_of_return_reasons, SUM(sr.sr_return_amt_inc_tax) AS total_returns_with_tax, AVG(p.p_cost) AS average_promotion_cost, COUNT(DISTINCT w.w_warehouse_sk) AS number_of_warehouses_used, AVG(w.w_gmt_offset) AS average_warehouse_gmt_offset, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS preferred_customer_count FROM store_sales ss LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk AND p.p_discount_active = 'N' LEFT JOIN warehouse w ON w.w_suite_number IN ('Suite 80', 'Suite 0', 'Suite P', 'Suite 470') LEFT JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk WHERE (ss.ss_sold_date_sk BETWEEN 20180101 AND 20181231 OR ss.ss_sold_date_sk IS NULL) AND (sr.sr_returned_date_sk BETWEEN 20180101 AND 20181231 OR sr.sr_returned_date_sk IS NULL) AND (c.c_customer_sk IN ('824', '4397', '807', '476') OR c.c_customer_sk IS NULL) AND (sr.sr_reason_sk IN (SELECT r_reason_sk FROM reason WHERE r_reason_desc IN ('duplicate purchase', 'reason 34', 'Found a better price in a store', 'Gift exchange', 'Parts missing', 'Lost my job')) OR sr.sr_reason_sk IS NULL) GROUP BY w.w_city, c.c_birth_year;
SELECT i.i_category AS category, i.i_brand AS brand, SUM(cs.cs_sales_price) AS total_sales, AVG(cs.cs_sales_price) AS avg_sales_price, COUNT(cs.cs_order_number) AS total_orders, AVG(hd.hd_dep_count) AS avg_dependency_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk WHERE w.w_city = 'Fairview' AND w.w_zip = '35709' AND hd.hd_demo_sk IN ('3429', '3835', '1080', '381', '3354') AND cs.cs_sold_time_sk = '67862' GROUP BY i.i_category, i.i_brand ORDER BY total_sales DESC;
SELECT s.s_store_name, s.s_company_name, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_return_quantity) AS average_return_quantity, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_incl_tax, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_net_loss) AS total_net_loss, cd.cd_education_status, AVG(cd.cd_purchase_estimate) AS average_purchase_estimate, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages_involved, td.t_shift, SUM(CASE WHEN td.t_am_pm = 'PM' THEN 1 ELSE 0 END) AS returns_in_pm, SUM(CASE WHEN td.t_am_pm = 'AM' THEN 1 ELSE 0 END) AS returns_in_am FROM store s JOIN web_returns wr ON s.s_store_sk = wr.wr_returning_addr_sk JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk JOIN time_dim td ON wr.wr_returned_time_sk = td.t_time_sk WHERE s.s_tax_precentage BETWEEN 0.06 AND 0.08 AND s.s_company_name <> 'Unknown' AND wp.wp_type = 'feedback' AND wp.wp_rec_start_date > '1999-09-04' AND td.t_minute IN (50, 18) GROUP BY s.s_store_name, s.s_company_name, cd.cd_education_status, td.t_shift ORDER BY total_returns DESC, total_return_amount DESC;
