SELECT sm_type, sm_carrier, t_shift, cd_gender, cd_marital_status, cd_education_status, AVG(cd_purchase_estimate) AS avg_purchase_estimate, COUNT(DISTINCT wr_refunded_customer_sk) AS count_distinct_refunded_customers, SUM(wr_return_quantity) AS total_return_quantity, SUM(wr_return_amt) AS total_return_amount, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(wr_net_loss) AS total_net_loss FROM web_returns JOIN ship_mode ON sm_ship_mode_sk = wr_item_sk JOIN time_dim ON t_time_sk = wr_returned_time_sk JOIN customer_demographics ON cd_demo_sk = wr_returning_cdemo_sk GROUP BY ROLLUP(sm_type, sm_carrier, t_shift, cd_gender, cd_marital_status, cd_education_status) ORDER BY sm_type, sm_carrier, t_shift, cd_gender, cd_marital_status, cd_education_status;
SELECT c.c_first_name, c.c_last_name, cs_total_sales, ws_total_sales, (cs_total_net_sales + ws_total_net_sales) AS total_combined_net_sales FROM customer c JOIN (SELECT cs_bill_customer_sk, SUM(cs_net_paid) AS cs_total_sales FROM catalog_sales GROUP BY cs_bill_customer_sk) cs_sales ON c.c_customer_sk = cs_sales.cs_bill_customer_sk JOIN (SELECT ws_bill_customer_sk, SUM(ws_net_paid) AS ws_total_sales FROM web_sales GROUP BY ws_bill_customer_sk) ws_sales ON c.c_customer_sk = ws_sales.ws_bill_customer_sk JOIN (SELECT cs_bill_customer_sk, SUM(cs_net_paid_inc_ship_tax) AS cs_total_net_sales FROM catalog_sales GROUP BY cs_bill_customer_sk) total_cs_sales ON c.c_customer_sk = total_cs_sales.cs_bill_customer_sk JOIN (SELECT ws_bill_customer_sk, SUM(ws_net_paid_inc_ship_tax) AS ws_total_net_sales FROM web_sales GROUP BY ws_bill_customer_sk) total_ws_sales ON c.c_customer_sk = total_ws_sales.ws_bill_customer_sk WHERE c.c_birth_country IN ('BRAZIL', 'ROMANIA', 'ICELAND') AND EXISTS (SELECT 1 FROM call_center WHERE cc_call_center_sk = cs_sales.cs_bill_customer_sk AND cc_company_name LIKE 'pri%') AND EXISTS (SELECT 1 FROM web_site WHERE web_site_sk = ws_sales.ws_bill_customer_sk AND web_street_type IN ('Road', 'Way', 'Dr.', 'Cir.', 'Parkway') AND web_street_number IN ('292', '409', '887', '805')) ORDER BY total_combined_net_sales DESC LIMIT 100;
SELECT w_state, w_city, ib.ib_income_band_sk AS income_band_sk, p_promo_name, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_sq_ft, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, COUNT(DISTINCT wr.wr_returned_date_sk) AS num_return_days, AVG(wr_return_amt_inc_tax) AS avg_return_amount_inc_tax FROM warehouse w JOIN web_returns wr ON w.w_warehouse_sk = wr.wr_returning_addr_sk JOIN income_band ib ON ib.ib_income_band_sk = wr.wr_returning_hdemo_sk JOIN promotion p ON p.p_item_sk = wr.wr_item_sk WHERE w_state = 'TN' AND w_city = 'Fairview' AND wr_reason_sk IN (7, 17, 21, 6) AND ib_upper_bound IN (50000, 190000, 80000) AND wr_returning_hdemo_sk IN (4812, 3393, 981, 1249) GROUP BY w_state, w_city, ib.ib_income_band_sk, p_promo_name ORDER BY total_return_amount_inc_tax DESC LIMIT 100;
SELECT d_year, i_category, s_store_name, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS avg_sales_price, SUM(ss_net_profit) AS total_net_profit, COUNT(DISTINCT ss_customer_sk) AS unique_customers, AVG(hd_dep_count) AS avg_household_dep_count, AVG(hd_vehicle_count) AS avg_household_vehicle_count FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN item ON ss_item_sk = i_item_sk JOIN store ON ss_store_sk = s_store_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk WHERE d_year = 2001 AND i_category_id IN ('3', '7', '4', '6') AND hd_income_band_sk IN ('7', '3', '9', '15', '20', '18') GROUP BY d_year, i_category, s_store_name ORDER BY total_net_profit DESC, avg_sales_price DESC LIMIT 100;
SELECT ws.web_name, COUNT(DISTINCT wp.wp_web_page_sk) AS total_pages, AVG(wp.wp_char_count) AS average_char_count, AVG(wp.wp_link_count) AS average_link_count, AVG(wp.wp_image_count) AS average_image_count, SUM(wr.wr_return_quantity) AS total_return_quantity, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_return_amt_inc_tax) AS average_return_with_tax, SUM(wr.wr_net_loss) AS total_net_loss FROM web_site ws JOIN web_page wp ON ws.web_site_sk = wp.wp_customer_sk LEFT JOIN web_returns wr ON wp.wp_web_page_sk = wr.wr_web_page_sk WHERE ws.web_name IN ('site_3', 'site_4', 'site_1', 'site_0', 'site_2') AND ws.web_open_date_sk = 2450645 AND wp.wp_web_page_id IN ('AAAAAAAABAAAAAAA', 'AAAAAAAAGBAAAAAA') AND wr.wr_refunded_addr_sk IN (47075, 5271, 7334) GROUP BY ws.web_name ORDER BY total_return_amount DESC;
SELECT s.s_store_sk, s.s_store_name, s.s_city, s.s_state, dd.d_quarter_name, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_units_sold, SUM(ss.ss_net_paid) AS total_revenue, SUM(ss.ss_net_profit) AS total_profit, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions, SUM(sr.sr_return_quantity) AS total_units_returned, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_net_loss) AS total_return_loss, AVG(cd.cd_dep_count) AS avg_customer_dependants, AVG(hd.hd_income_band_sk) AS avg_customer_income_band, r.r_reason_desc AS most_common_return_reason FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk LEFT JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk LEFT JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk LEFT JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE dd.d_quarter_name IS NOT NULL GROUP BY s.s_store_sk, s.s_store_name, s.s_city, s.s_state, dd.d_quarter_name, r.r_reason_desc ORDER BY s.s_store_sk, dd.d_quarter_name;
SELECT c.c_first_name, c.c_last_name, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(s.s_number_employees) AS avg_store_employees, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages, MAX(sm.sm_code) AS max_ship_mode_code FROM customer c JOIN web_page wp ON c.c_customer_sk = wp.wp_customer_sk JOIN store s ON s.s_zip = CAST(c.c_current_addr_sk AS CHAR(10)) JOIN warehouse w ON w.w_zip = s.s_zip JOIN ship_mode sm ON sm.sm_code = w.w_zip WHERE w.w_gmt_offset = '-5.00' AND (wp.wp_char_count = '2129' OR wp.wp_char_count = '2531') AND (wp.wp_rec_end_date = '1999-09-03' OR wp.wp_rec_end_date = '2001-09-02' OR wp.wp_rec_end_date = '2000-09-02') GROUP BY c.c_first_name, c.c_last_name;
SELECT p.p_purpose, COUNT(DISTINCT p.p_promo_sk) AS num_promotions, AVG(p.p_cost) AS avg_promo_cost, SUM(CASE WHEN p.p_channel_dmail = 'Y' THEN 1 ELSE 0 END) AS dmail_channel_count, SUM(CASE WHEN p.p_channel_email = 'Y' THEN 1 ELSE 0 END) AS email_channel_count, COUNT(DISTINCT CASE WHEN cd.cd_purchase_estimate > 10000 THEN cd.cd_demo_sk END) AS high_value_customers, COUNT(DISTINCT CASE WHEN cd.cd_gender = 'M' THEN cd.cd_demo_sk END) AS male_customers, COUNT(DISTINCT CASE WHEN cd.cd_gender = 'F' THEN cd.cd_demo_sk END) AS female_customers, COUNT(DISTINCT CASE WHEN cd.cd_marital_status = 'S' THEN cd.cd_demo_sk END) AS single_customers, COUNT(DISTINCT CASE WHEN cd.cd_marital_status = 'M' THEN cd.cd_demo_sk END) AS married_customers FROM promotion p LEFT JOIN customer_demographics cd ON p.p_promo_sk = cd.cd_demo_sk WHERE p.p_discount_active = 'Y' GROUP BY p.p_purpose ORDER BY avg_promo_cost DESC, num_promotions DESC;
SELECT cd.cd_education_status, cd.cd_gender, cd.cd_marital_status, cd.cd_credit_rating, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_incl_tax, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amount_incl_tax, COUNT(wr.wr_returned_date_sk) AS total_returns, p.p_channel_email, p.p_channel_dmail, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo FROM web_returns wr JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk JOIN promotion p ON wr.wr_item_sk = p.p_item_sk WHERE wr.wr_fee IN (16.46, 25.83, 12.23, 28.11, 82.98) AND wr.wr_reversed_charge = 33.99 AND cd.cd_dep_employed_count = 0 GROUP BY cd.cd_education_status, cd.cd_gender, cd.cd_marital_status, cd.cd_credit_rating, p.p_channel_email, p.p_channel_dmail, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo ORDER BY total_return_amount_incl_tax DESC;
SELECT c.cp_department, i.i_category, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_fee) AS total_fees_collected, SUM(cr.cr_net_loss) AS total_net_loss, w.w_state, hd.hd_buy_potential FROM catalog_returns cr JOIN catalog_page c ON cr.cr_catalog_page_sk = c.cp_catalog_page_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk WHERE cr.cr_returning_addr_sk IN ('31623', '47914', '49311', '38890', '49597') AND w.w_state = 'TN' AND hd.hd_buy_potential IN ('501-1000', '5001-10000') GROUP BY c.cp_department, i.i_category, w.w_state, hd.hd_buy_potential ORDER BY total_return_amount DESC, c.cp_department, i.i_category;
SELECT sm.sm_type AS shipping_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_items_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_revenue, SUM(cs.cs_net_profit) AS total_profit, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_items_returned, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_net_loss) AS total_loss FROM catalog_sales cs JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN web_returns wr ON cs.cs_order_number = wr.wr_order_number AND cs.cs_item_sk = wr.wr_item_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk WHERE sm.sm_type IN ('REGULAR', 'OVERNIGHT') AND cd.cd_gender IN ('M', 'F') AND cs.cs_quantity IN (91, 62, 46, 68, 45) AND (wr.wr_returned_time_sk = 74117 OR wr.wr_returned_time_sk IS NULL) GROUP BY sm.sm_type ORDER BY total_revenue DESC, total_loss ASC;
SELECT dd.d_year, dd.d_month_seq, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(promo.p_response_target) AS avg_response_target, COUNT(DISTINCT cc.cc_call_center_id) AS num_call_centers, SUM(CASE WHEN promo.p_channel_dmail = 'Y' THEN 1 ELSE 0 END) AS dmail_promo_count, SUM(CASE WHEN promo.p_channel_tv = 'N' THEN 1 ELSE 0 END) AS non_tv_promo_count, ib.ib_income_band_sk, COUNT(DISTINCT inv.inv_item_sk) AS unique_items, COUNT(DISTINCT inv.inv_warehouse_sk) AS unique_warehouses FROM date_dim AS dd JOIN inventory AS inv ON dd.d_date_sk = inv.inv_date_sk JOIN promotion AS promo ON dd.d_date_sk BETWEEN promo.p_start_date_sk AND promo.p_end_date_sk JOIN call_center AS cc ON cc.cc_open_date_sk <= dd.d_date_sk AND (cc.cc_closed_date_sk IS NULL OR cc.cc_closed_date_sk >= dd.d_date_sk) JOIN income_band AS ib ON cc.cc_mkt_id = ib.ib_income_band_sk WHERE dd.d_year = 2000 AND inv.inv_warehouse_sk IN (1, 2) AND inv.inv_item_sk IN (8690, 8431, 8896, 6346) AND dd.d_moy BETWEEN 1 AND 6 GROUP BY dd.d_year, dd.d_month_seq, ib.ib_income_band_sk ORDER BY dd.d_year, dd.d_month_seq, total_inventory DESC;
SELECT p.p_promo_name, COUNT(DISTINCT sr.sr_customer_sk) AS number_of_customers, COUNT(sr.sr_ticket_number) AS number_of_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, SUM(sr.sr_return_amt) AS total_return_amount, AVG(hd.hd_vehicle_count) AS avg_vehicles_per_household, ib.ib_lower_bound AS income_band_lower_bound, ib.ib_upper_bound AS income_band_upper_bound, COUNT(DISTINCT cd.cd_demo_sk) AS number_of_unique_customers_demographics, SUM(CASE WHEN cd.cd_gender = 'M' THEN 1 ELSE 0 END) AS male_customer_count, SUM(CASE WHEN cd.cd_gender = 'F' THEN 1 ELSE 0 END) AS female_customer_count, SUM(CASE WHEN cd.cd_credit_rating = 'Low Risk' THEN 1 ELSE 0 END) AS low_risk_credit_customers, SUM(CASE WHEN cd.cd_credit_rating = 'High Risk' THEN 1 ELSE 0 END) AS high_risk_credit_customers FROM store_returns sr JOIN promotion p ON sr.sr_reason_sk = p.p_promo_sk AND p.p_channel_catalog = 'N' LEFT JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk LEFT JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk LEFT JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE p.p_purpose = 'Unknown' AND ib.ib_income_band_sk IN (19, 7, 13, 8, 15, 10) AND sr.sr_customer_sk IN (77634, 47097) AND cd.cd_credit_rating IN ('Low Risk', 'High Risk', 'Unknown') GROUP BY p.p_promo_name, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_return_amount DESC;
SELECT cp.cp_department, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_sales_price) AS avg_sales_price, AVG(cs.cs_net_profit) AS avg_profit FROM catalog_sales cs JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN web_site ws ON cp.cp_department = ws.web_class JOIN income_band ib ON cs.cs_bill_cdemo_sk = ib.ib_income_band_sk WHERE cp.cp_end_date_sk < 2450934 AND ws.web_tax_percentage IN (0.07, 0.08) AND ws.web_state = 'TN' AND ib.ib_upper_bound = 170000 GROUP BY cp.cp_department ORDER BY total_sales DESC;
