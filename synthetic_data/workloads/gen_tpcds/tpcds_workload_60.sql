SELECT w.w_warehouse_name, w.w_state, w.w_county, sm.sm_type, sm.sm_carrier, p.p_promo_name, p.p_channel_details, s.s_store_name, s.s_city, s.s_state, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_net_paid, AVG(ss.ss_net_profit) AS average_net_profit, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(wr.wr_return_quantity) AS total_return_quantity, SUM(wr.wr_net_loss) AS total_net_loss FROM warehouse w JOIN store_sales ss ON ss.ss_store_sk = w.w_warehouse_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = ss.ss_sold_date_sk LEFT JOIN web_returns wr ON wr.wr_item_sk = ss.ss_item_sk AND wr.wr_order_number = ss.ss_ticket_number WHERE w.w_county = 'Williamson County' AND w.w_street_name IN ('Ash Laurel', 'Wilson Elm', '6th') AND w.w_warehouse_name IN ('Bad cards must make.', 'Important issues liv', 'Doors canno') AND w.w_state = 'TN' AND wr.wr_web_page_sk IN ('18', '44', '3') AND wr.wr_returned_date_sk IN ('2451082', '2451321', '2452281') AND p.p_channel_event = 'N' AND p.p_channel_press = 'N' AND p.p_item_sk IN ('10297', '13006', '12968') AND p.p_promo_name LIKE '%cally%' OR p.p_promo_name LIKE '%able%' OR p.p_promo_name LIKE '%eing%' AND s.s_rec_start_date IN ('1997-03-13', '2001-03-13', '2000-03-13') AND s.s_closed_date_sk IN ('2451044', '2450910', '2451189') AND sm.sm_type IN ('NEXT DAY', 'TWO DAY', 'LIBRARY') AND sm.sm_carrier IN ('AIRBORNE', 'USPS', 'DHL') AND sm.sm_ship_mode_id IN ('AAAAAAAABBAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAAOAAAAAAA') AND ss.ss_store_sk IN ('10', '1', '7') AND ss.ss_net_profit IN ('182.58', '990.60', '525.80') AND ss.ss_ext_sales_price IN ('6976.75', '971.85', '10.15') GROUP BY w.w_warehouse_name, w.w_state, w.w_county, sm.sm_type, sm.sm_carrier, p.p_promo_name, p.p_channel_details, s.s_store_name, s.s_city, s.s_state ORDER BY total_net_paid DESC, average_net_profit DESC, total_net_loss ASC;
SELECT sm.sm_type, sm.sm_code, COUNT(wr.wr_order_number) AS total_returns, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_return_quantity) AS total_returned_quantity, SUM(wr.wr_return_ship_cost) AS total_return_shipping_cost, AVG(hd.hd_dep_count) AS average_dependent_count, AVG(hd.hd_vehicle_count) AS average_vehicle_count, td.t_shift, SUM(CASE WHEN td.t_am_pm = 'AM' THEN 1 ELSE 0 END) AS returns_in_am, SUM(CASE WHEN td.t_am_pm = 'PM' THEN 1 ELSE 0 END) AS returns_in_pm FROM web_returns wr JOIN ship_mode sm ON wr.wr_order_number = sm.sm_ship_mode_sk JOIN household_demographics hd ON wr.wr_returning_hdemo_sk = hd.hd_demo_sk JOIN time_dim td ON wr.wr_returned_time_sk = td.t_time_sk WHERE sm.sm_type IN ('NEXT DAY', 'TWO DAY', 'LIBRARY', 'EXPRESS', 'REGULAR', 'OVERNIGHT') AND sm.sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') AND td.t_second IN ('18', '2', '56', '30') AND wr.wr_return_ship_cost IN ('3700.56', '275.65', '284.48') GROUP BY sm.sm_type, sm.sm_code, td.t_shift ORDER BY total_returns DESC, total_return_shipping_cost DESC;
SELECT cd_gender, cd_marital_status, cd_education_status, sm_carrier, SUM(cs_net_paid_inc_tax) AS total_net_paid_inc_tax, AVG(cs_quantity) AS average_quantity, COUNT(*) AS num_transactions FROM catalog_sales JOIN customer_demographics ON catalog_sales.cs_bill_cdemo_sk = customer_demographics.cd_demo_sk JOIN ship_mode ON catalog_sales.cs_ship_mode_sk = ship_mode.sm_ship_mode_sk JOIN time_dim ON catalog_sales.cs_sold_time_sk = time_dim.t_time_sk WHERE cd_credit_rating = 'Good' AND sm_carrier IN ('UPS', 'FEDEX') AND t_hour BETWEEN 8 AND 17 GROUP BY cd_gender, cd_marital_status, cd_education_status, sm_carrier ORDER BY total_net_paid_inc_tax DESC, average_quantity DESC, num_transactions DESC;
SELECT ca_state, COUNT(DISTINCT c_customer_sk) AS total_customers, SUM(wr_return_amt_inc_tax) AS total_refunds, AVG(wr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT wr_order_number) AS total_return_orders, s_store_name, s_city, s_state FROM customer_address JOIN customer ON customer.c_current_addr_sk = customer_address.ca_address_sk JOIN web_returns ON customer_address.ca_address_sk = web_returns.wr_refunded_addr_sk JOIN store ON customer_address.ca_state = store.s_state WHERE customer.c_preferred_cust_flag = 'Y' AND web_returns.wr_returned_date_sk BETWEEN '20210101' AND '20211231' GROUP BY ca_state, s_store_name, s_city, s_state ORDER BY total_refunds DESC, avg_return_quantity DESC LIMIT 100;
SELECT s_state, COUNT(DISTINCT ss_customer_sk) as total_customers, SUM(ss_quantity) as total_quantity_sold, AVG(ss_sales_price) as average_sales_price, SUM(ss_net_profit) as total_net_profit, SUM(cr_return_amount) as total_return_amount, AVG(hd_dep_count) as average_dependent_count FROM store_sales JOIN store ON ss_store_sk = s_store_sk JOIN catalog_returns ON ss_item_sk = cr_item_sk AND ss_ticket_number = cr_order_number JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk GROUP BY s_state ORDER BY total_net_profit DESC LIMIT 10;
SELECT sm_type, sm_carrier, t_shift, cd_gender, cd_marital_status, cd_education_status, AVG(cd_purchase_estimate) AS avg_purchase_estimate, COUNT(DISTINCT wr_refunded_customer_sk) AS count_distinct_refunded_customers, SUM(wr_return_quantity) AS total_return_quantity, SUM(wr_return_amt) AS total_return_amount, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(wr_net_loss) AS total_net_loss FROM web_returns JOIN ship_mode ON sm_ship_mode_sk = wr_item_sk JOIN time_dim ON t_time_sk = wr_returned_time_sk JOIN customer_demographics ON cd_demo_sk = wr_returning_cdemo_sk GROUP BY ROLLUP(sm_type, sm_carrier, t_shift, cd_gender, cd_marital_status, cd_education_status) ORDER BY sm_type, sm_carrier, t_shift, cd_gender, cd_marital_status, cd_education_status;
SELECT p.p_promo_name, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo, SUM(p.p_cost) AS total_promotion_cost, COUNT(p.p_promo_sk) AS number_of_promotions, AVG(cd.cd_dep_count) AS average_number_of_dependents FROM promotion p JOIN web_page wp ON p.p_item_sk = wp.wp_web_page_sk JOIN customer_demographics cd ON wp.wp_customer_sk = cd.cd_demo_sk WHERE wp.wp_creation_date_sk IN ('2450808', '2450809') AND p.p_response_target = 1 AND cd.cd_marital_status IN ('W', 'D', 'U', 'S') GROUP BY p.p_promo_name, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo ORDER BY total_promotion_cost DESC, number_of_promotions DESC;
SELECT p.p_promo_name, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, AVG(sr.sr_return_amt) AS avg_return_amount, r.r_reason_desc AS most_common_return_reason, COUNT(*) AS reason_count FROM store_returns sr JOIN promotion p ON sr.sr_item_sk = p.p_item_sk JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk LEFT JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE sr.sr_store_sk IN (1, 4, 8) AND p.p_item_sk IN (13903, 4790, 11371, 10280, 11452) AND hd.hd_vehicle_count IN (3, 1) GROUP BY p.p_promo_name, r.r_reason_desc ORDER BY total_returns DESC, avg_return_amount DESC, reason_count DESC LIMIT 100;
SELECT cp_department, cd_gender, cd_marital_status, cd_education_status, COUNT(DISTINCT sr_ticket_number) AS total_returns, SUM(sr_return_quantity) AS total_returned_quantity, AVG(sr_return_amt) AS average_return_amount, SUM(sr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(sr_fee) AS total_fees, SUM(sr_net_loss) AS total_net_loss FROM catalog_page JOIN store_returns ON cp_catalog_page_sk = sr_returned_date_sk JOIN customer_demographics ON cd_demo_sk = sr_cdemo_sk WHERE cp_department = 'DEPARTMENT' AND (cp_start_date_sk = 2451665 OR cp_start_date_sk = 2451360) GROUP BY cp_department, cd_gender, cd_marital_status, cd_education_status ORDER BY total_returned_quantity DESC;
SELECT dd.d_year, dd.d_month_seq, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(promo.p_response_target) AS avg_response_target, COUNT(DISTINCT cc.cc_call_center_id) AS num_call_centers, SUM(CASE WHEN promo.p_channel_dmail = 'Y' THEN 1 ELSE 0 END) AS dmail_promo_count, SUM(CASE WHEN promo.p_channel_tv = 'N' THEN 1 ELSE 0 END) AS non_tv_promo_count, ib.ib_income_band_sk, COUNT(DISTINCT inv.inv_item_sk) AS unique_items, COUNT(DISTINCT inv.inv_warehouse_sk) AS unique_warehouses FROM date_dim AS dd JOIN inventory AS inv ON dd.d_date_sk = inv.inv_date_sk JOIN promotion AS promo ON dd.d_date_sk BETWEEN promo.p_start_date_sk AND promo.p_end_date_sk JOIN call_center AS cc ON cc.cc_open_date_sk <= dd.d_date_sk AND (cc.cc_closed_date_sk IS NULL OR cc.cc_closed_date_sk >= dd.d_date_sk) JOIN income_band AS ib ON cc.cc_mkt_id = ib.ib_income_band_sk WHERE dd.d_year = 2000 AND inv.inv_warehouse_sk IN (1, 2) AND inv.inv_item_sk IN (8690, 8431, 8896, 6346) AND dd.d_moy BETWEEN 1 AND 6 GROUP BY dd.d_year, dd.d_month_seq, ib.ib_income_band_sk ORDER BY dd.d_year, dd.d_month_seq, total_inventory DESC;
SELECT ca.ca_state, ca.ca_country, COUNT(DISTINCT c.c_customer_sk) AS num_customers, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_return_tax) AS total_return_tax, AVG(sr.sr_return_amt) AS avg_return_amount_per_customer, SUM(sr.sr_net_loss) AS total_net_loss FROM customer c JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN income_band ib ON c.c_current_hdemo_sk = ib.ib_income_band_sk WHERE c.c_preferred_cust_flag = 'Y' AND ib.ib_income_band_sk IN (2, 6, 14, 17, 19) AND ib.ib_upper_bound <= 30000 GROUP BY ca.ca_state, ca.ca_country ORDER BY total_return_amount DESC, ca.ca_state, ca.ca_country;
SELECT d_year, cp_department, COUNT(DISTINCT c_customer_sk) AS number_of_customers, SUM(cr_return_quantity) AS total_return_quantity, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_fee) AS total_fee, SUM(cr_return_amt_inc_tax) AS total_return_amount_inc_tax, p_promo_name, COUNT(DISTINCT p_promo_sk) AS number_of_promotions_used FROM date_dim, customer, catalog_page, catalog_returns LEFT JOIN promotion ON cr_item_sk = p_item_sk WHERE cr_returned_date_sk = d_date_sk AND cr_refunded_customer_sk = c_customer_sk AND cr_catalog_page_sk = cp_catalog_page_sk AND d_year = 2022 AND p_channel_details = 'Good, foreign problems will n' AND cp_department IN ('Books', 'Electronics') AND c_preferred_cust_flag = 'Y' GROUP BY d_year, cp_department, p_promo_name ORDER BY d_year, avg_return_amount DESC, total_return_quantity DESC;
SELECT i.inv_item_sk, AVG(i.inv_quantity_on_hand) AS avg_quantity_on_hand, AVG(ws.ws_net_profit) AS avg_net_profit, SUM(ws.ws_net_paid_inc_ship_tax) AS total_sales, w.w_warehouse_name, COUNT(DISTINCT ws.ws_order_number) AS orders_count FROM inventory i JOIN warehouse w ON i.inv_warehouse_sk = w.w_warehouse_sk JOIN web_sales ws ON i.inv_item_sk = ws.ws_item_sk AND i.inv_warehouse_sk = ws.ws_warehouse_sk JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk WHERE i.inv_date_sk = '2450815' AND td.t_am_pm = 'AM' AND w.w_city = 'Fairview' AND w.w_warehouse_id = 'AAAAAAAAFAAAAAAA' GROUP BY i.inv_item_sk, w.w_warehouse_name ORDER BY avg_quantity_on_hand DESC, avg_net_profit DESC;
SELECT ca.ca_state, c.c_preferred_cust_flag, COUNT(DISTINCT p.p_promo_sk) AS num_promotions, AVG(p.p_cost) AS avg_promo_cost, COUNT(DISTINCT c.c_customer_sk) AS num_customers, SUM(CASE WHEN t.t_shift = 'third' THEN 1 ELSE 0 END) AS num_third_shift_accesses, AVG(wp.wp_link_count) AS avg_web_page_link_count FROM promotion p JOIN customer c ON p.p_item_sk = c.c_current_cdemo_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN web_page wp ON wp.wp_customer_sk = c.c_customer_sk JOIN time_dim t ON t.t_time_sk = wp.wp_access_date_sk WHERE ca.ca_county IN ('Nobles County', 'Otoe County', 'Vilas County', 'Conway County') AND p.p_channel_catalog = 'N' AND t.t_minute IN ('17', '30', '53', '4', '24') AND p.p_channel_details LIKE '%criteria must%' GROUP BY ca.ca_state, c.c_preferred_cust_flag ORDER BY ca.ca_state, c.c_preferred_cust_flag;
SELECT cp.cp_department, EXTRACT(YEAR FROM TO_DATE(cp.cp_end_date_sk::varchar, 'YYYYMMDD')) AS year_ended, hd.hd_income_band_sk, COUNT(DISTINCT sr.sr_customer_sk) AS num_customers_returned, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_net_loss) AS average_net_loss, SUM(ss.ss_quantity) AS total_sold_quantity, SUM(ss.ss_net_profit) AS total_net_profit, AVG(c.c_birth_year) AS average_customer_birth_year FROM catalog_page cp JOIN store_returns sr ON cp.cp_catalog_page_sk = sr.sr_reason_sk JOIN store_sales ss ON sr.sr_item_sk = ss.ss_item_sk AND sr.sr_ticket_number = ss.ss_ticket_number JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE cp.cp_end_date_sk IN ('2451114', '2451084', '2451479') AND hd.hd_dep_count IN (3, 6, 7) AND c.c_birth_month IN (2, 6, 12) GROUP BY cp.cp_department, year_ended, hd.hd_income_band_sk ORDER BY total_net_profit DESC, average_net_loss, num_customers_returned;
SELECT ca_state, cd_gender, cd_marital_status, sm_type, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(sr_return_quantity) AS total_quantity_returned, AVG(sr_return_amt) AS average_return_amount, SUM(sr_net_loss) AS total_net_loss FROM store_sales JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN customer_demographics ON ss_cdemo_sk = cd_demo_sk JOIN ship_mode ON sm_ship_mode_sk = ss_promo_sk LEFT JOIN store_returns ON sr_ticket_number = ss_ticket_number AND sr_item_sk = ss_item_sk WHERE ca_state IS NOT NULL AND cd_gender IN ('M', 'F') AND cd_marital_status IN ('M', 'U', 'S', 'D') GROUP BY ca_state, cd_gender, cd_marital_status, sm_type ORDER BY total_quantity_sold DESC, average_sales_price DESC;
SELECT 'Web' AS return_channel, COUNT(wr_order_number) AS total_returns, SUM(wr_return_quantity) AS total_returned_items, SUM(wr_net_loss) AS total_net_loss, AVG(wr_net_loss) AS avg_net_loss_per_return FROM web_returns UNION ALL SELECT 'Catalog' AS return_channel, COUNT(cr_order_number) AS total_returns, SUM(cr_return_quantity) AS total_returned_items, SUM(cr_net_loss) AS total_net_loss, AVG(cr_net_loss) AS avg_net_loss_per_return FROM catalog_returns UNION ALL SELECT 'Store' AS return_channel, COUNT(sr_ticket_number) AS total_returns, SUM(sr_return_quantity) AS total_returned_items, SUM(sr_net_loss) AS total_net_loss, AVG(sr_net_loss) AS avg_net_loss_per_return FROM store_returns ORDER BY total_net_loss DESC;
SELECT cp_department, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_profit) AS total_net_profit, COUNT(DISTINCT ss_ticket_number) AS total_store_sales_tickets, SUM(ss_quantity) AS total_store_quantity_sold, AVG(ss_sales_price) AS average_store_sales_price, SUM(ss_net_paid_inc_tax) AS total_store_net_paid_inc_tax FROM catalog_sales JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk JOIN store_sales ON catalog_sales.cs_item_sk = store_sales.ss_item_sk JOIN store ON store_sales.ss_store_sk = s_store_sk JOIN customer ON store_sales.ss_customer_sk = c_customer_sk WHERE c_birth_country IN ('MOLDOVA, REPUBLIC OF', 'TOGO', 'IRAQ', 'BURUNDI') AND cp_department IS NOT NULL AND cp_start_date_sk IS NOT NULL AND cp_end_date_sk IS NOT NULL AND (cp_end_date_sk - cp_start_date_sk) > 0 AND s_market_id IS NOT NULL GROUP BY cp_department ORDER BY total_net_profit DESC, total_orders DESC LIMIT 10;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(sr_return_amt) AS avg_return_amount, COUNT(DISTINCT sr.sr_ticket_number) AS num_of_returns, COUNT(DISTINCT sm.sm_ship_mode_id) AS num_of_shipping_modes_used FROM customer c JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN inventory inv ON sr.sr_item_sk = inv.inv_item_sk JOIN ship_mode sm ON sm.sm_type = 'NEXT DAY' OR sm.sm_type = 'TWO DAY' WHERE c.c_email_address IN ('Bruce.Ratliff@FDMnSp6ETps.org', 'Louis.Luna@LrZBOvDJ842PiFOfe.edu', 'Anthony.Wilson@BebfByYiKCcg.com') AND c.c_current_hdemo_sk IN ('3673', '5606') GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address ORDER BY c.c_last_name, c.c_first_name;
SELECT s.s_store_name, c.c_first_name, c.c_last_name, COUNT(ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_items_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk WHERE s.s_floor_space IN (9026222, 7557959, 9341467, 6995995, 5219562) AND c.c_current_hdemo_sk IN (6755, 780, 352, 3208, 1770) AND c.c_email_address IN ('Joseph.Hilton@io2VIr.org', 'Scott.Goodman@EN4g6ehG4eh1.com', 'Charles.Fink@5cPLD.com', 'Rosa.Nixon@ghkTsItbO5o8hKtVkdI.com') GROUP BY s.s_store_name, c.c_first_name, c.c_last_name ORDER BY total_net_profit DESC, total_net_paid DESC;
SELECT w_state, p_purpose, COUNT(DISTINCT wp_web_page_sk) AS total_web_pages, SUM(wp_image_count) AS total_images, AVG(wp_char_count) AS avg_char_count, SUM(CASE WHEN wp_web_page_id IN ('AAAAAAAAOAAAAAAA', 'AAAAAAAAJBAAAAAA', 'AAAAAAAAEBAAAAAA', 'AAAAAAAALCAAAAAA', 'AAAAAAAACAAAAAAA', 'AAAAAAAAGBAAAAAA') THEN 1 ELSE 0 END) AS targeted_web_pages_count, SUM(CASE WHEN t_shift = 'third' THEN 1 ELSE 0 END) AS third_shift_count, AVG(w_warehouse_sq_ft) AS avg_warehouse_size FROM warehouse JOIN promotion ON w_warehouse_sk = p_item_sk JOIN web_page ON wp_customer_sk = w_warehouse_sk JOIN time_dim ON t_time_sk = wp_creation_date_sk WHERE w_state = 'TN' AND (wp_image_count = 4 OR wp_image_count = 1) AND w_warehouse_sk = 2 GROUP BY w_state, p_purpose ORDER BY total_web_pages DESC;
SELECT i.i_category, sm.sm_type, w.w_state, SUM(ws.ws_sales_price) AS total_sales, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(sr.sr_return_amt) AS total_returns, AVG(sr.sr_return_amt) AS avg_return_amt, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_tickets FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk LEFT JOIN store_returns sr ON ws.ws_item_sk = sr.sr_item_sk WHERE sm.sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') AND i.i_class IN ('loose stones', 'swimwear', 'semi-precious', 'maternity', 'camping') AND i.i_manager_id IN ('92', '83') AND w.w_street_name LIKE '%6th%' GROUP BY i.i_category, sm.sm_type, w.w_state ORDER BY total_sales DESC, total_returns DESC;
SELECT s.s_store_name, s.s_city, s.s_state, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_quantity) AS average_quantity_sold, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_ext_sales_price) AS total_sales, sm.sm_carrier, sm.sm_type, COUNT(DISTINCT ws.ws_item_sk) AS total_items_sold, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT ws.ws_bill_customer_sk) AS total_customers, cp.cp_department, cp.cp_catalog_number, COUNT(DISTINCT cp.cp_catalog_page_sk) AS total_catalog_pages FROM store s JOIN web_sales ws ON s.s_store_sk = ws.ws_warehouse_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN income_band ib ON ws.ws_bill_cdemo_sk = ib.ib_income_band_sk JOIN catalog_page cp ON ws.ws_web_page_sk = cp.cp_catalog_page_sk JOIN web_site w ON ws.ws_web_site_sk = w.web_site_sk WHERE s.s_company_id = '1' AND s.s_county = 'Williamson County' AND ws.ws_ship_addr_sk IN ('9319', '42828', '27709') AND ws.ws_net_profit IN ('1416.80', '918.75', '-485.10') AND sm.sm_carrier IN ('ZOUROS', 'HARMSTORF', 'GERMA') AND sm.sm_ship_mode_sk IN ('11', '3', '9') AND sm.sm_code IN ('BIKE', 'SURFACE', 'AIR') AND w.web_rec_start_date IN ('1999-08-17', '2001-08-16', '2000-08-16') AND w.web_suite_number IN ('Suite 130', 'Suite 150', 'Suite R') AND w.web_tax_percentage IN ('0.01', '0.10', '0.12') AND w.web_company_name IN ('able', 'cally', 'pri') AND ib.ib_upper_bound IN ('110000', '190000', '130000') AND ib.ib_income_band_sk IN ('8', '15', '6') AND ib.ib_lower_bound IN ('20001', '100001', '10001') AND cp.cp_catalog_number IN ('10', '44', '19') AND cp.cp_department = 'DEPARTMENT' AND cp.cp_catalog_page_number IN ('49', '102', '25') AND cp.cp_catalog_page_sk IN ('3484', '375', '1590') GROUP BY s.s_store_name, s.s_city, s.s_state, sm.sm_carrier, sm.sm_type, ib.ib_lower_bound, ib.ib_upper_bound, cp.cp_department, cp.cp_catalog_number ORDER BY total_net_profit DESC, total_sales DESC, total_orders DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT ss.ss_customer_sk) AS num_customers, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_net_profit, SUM(sr.sr_return_quantity) AS total_return_quantity, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_fee) AS avg_return_fee, COUNT(DISTINCT wp.wp_web_page_sk) AS num_visited_pages, SUM(wp.wp_link_count) AS total_link_count FROM income_band ib LEFT JOIN store_sales ss ON ib.ib_income_band_sk = ss.ss_cdemo_sk LEFT JOIN store_returns sr ON ss.ss_customer_sk = sr.sr_customer_sk AND sr.sr_reason_sk IN (21, 2, 14, 30) LEFT JOIN web_page wp ON ss.ss_customer_sk = wp.wp_customer_sk AND wp.wp_type IN ('protected', 'ad') WHERE ss.ss_sold_date_sk IN (2451298, 2450872, 2451390, 2451634) AND ib.ib_upper_bound IN (30000, 130000, 90000) AND ib.ib_income_band_sk IN (17, 6) GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ib.ib_income_band_sk;
SELECT ca.ca_state, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_return_quantity) AS total_return_quantity, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, COUNT(DISTINCT CASE WHEN c.c_preferred_cust_flag = 'Y' THEN sr.sr_ticket_number ELSE NULL END) AS preferred_customer_returns FROM store_returns sr JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE sr.sr_return_tax BETWEEN 5 AND 130 AND c.c_last_review_date_sk IN (2452499, 2452496, 2452479, 2452342) AND sr.sr_item_sk IN (13538, 16733, 1766, 2599, 3017, 9220) GROUP BY ca.ca_state ORDER BY total_return_amount DESC;
SELECT c.c_customer_id, i.i_product_name, i.i_category, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs.cs_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(cs.cs_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_fee) AS total_return_fee, SUM(sr.sr_net_loss) AS total_net_loss, SUM(wr.wr_return_amt) AS total_web_return_amount, SUM(wr.wr_fee) AS total_web_return_fee, SUM(wr.wr_net_loss) AS total_web_net_loss FROM customer c JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk LEFT JOIN store_returns sr ON cs.cs_item_sk = sr.sr_item_sk AND cs.cs_order_number = sr.sr_ticket_number LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk WHERE c.c_preferred_cust_flag = 'Y' AND d.d_year = 2023 GROUP BY c.c_customer_id, i.i_product_name, i.i_category ORDER BY total_net_paid DESC LIMIT 100;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, SUM(cs.cs_net_paid) AS total_sales, SUM(cr.cr_return_amount) AS total_returns, (SUM(cs.cs_net_paid) - SUM(cr.cr_return_amount)) AS net_profit, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS number_of_orders, COUNT(DISTINCT cr.cr_order_number) AS number_of_returns FROM customer c LEFT JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name HAVING COUNT(DISTINCT cs.cs_order_number) > 0 AND COUNT(DISTINCT cr.cr_order_number) > 0 ORDER BY net_profit DESC, total_sales DESC LIMIT 100;
SELECT cd.cd_purchase_estimate AS purchase_estimate, ib.ib_lower_bound AS income_band_lower_bound, ib.ib_upper_bound AS income_band_upper_bound, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt) AS total_returned_amount, AVG(wr.wr_return_amt) AS average_return_amount, AVG(wr.wr_fee) AS average_fee, AVG(wr.wr_net_loss) AS average_net_loss FROM web_returns wr INNER JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk INNER JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound WHERE wr.wr_return_quantity > 0 AND cd.cd_purchase_estimate IN (8500, 7000, 1000, 9000, 4500, 5500) AND ib.ib_lower_bound IN (70001, 90001, 180001) GROUP BY cd.cd_purchase_estimate, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_returned_amount DESC;
SELECT state, item_category, SUM(total_sales_amount) AS total_sales_amount, SUM(total_return_amount) AS total_return_amount, AVG(avg_net_loss_per_return) AS avg_net_loss_per_return FROM ( SELECT web_site.web_state AS state, i.i_category AS item_category, SUM(ws.ws_sales_price) AS total_sales_amount, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_net_loss) AS avg_net_loss_per_return FROM web_sales ws INNER JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk INNER JOIN web_site ON ws.ws_web_site_sk = web_site.web_site_sk INNER JOIN item i ON ws.ws_item_sk = i.i_item_sk WHERE web_site.web_state IN ('TN') GROUP BY web_site.web_state, i.i_category UNION ALL SELECT 'Catalog' AS state, i.i_category AS item_category, 0 AS total_sales_amount, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_net_loss) AS avg_net_loss_per_return FROM catalog_returns cr INNER JOIN item i ON cr.cr_item_sk = i.i_item_sk GROUP BY i.i_category ) AS combined_results GROUP BY state, item_category ORDER BY state, item_category;
SELECT p.p_promo_name, avg(cs.cs_sales_price) AS avg_sales_price, sum(cs.cs_ext_discount_amt) AS total_discount_amount, sum(cs.cs_net_profit) AS total_net_profit, cd.cd_gender, cd.cd_education_status, count(cs.cs_order_number) AS total_orders FROM catalog_sales cs JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk WHERE p.p_channel_email = 'N' AND d.d_year = 2022 GROUP BY p.p_promo_name, cd.cd_gender, cd.cd_education_status ORDER BY total_net_profit DESC;
