SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_net_paid) AS total_sales_amount, AVG(cs.cs_sales_price) AS average_sales_amount_per_order, MAX(cs.cs_sales_price) AS max_sale_amount, AVG(cs.cs_ext_discount_amt) AS average_discount_amount, SUM(cs.cs_ext_tax) AS total_tax_collected, COUNT(DISTINCT cs.cs_bill_customer_sk) AS unique_customers FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk WHERE d.d_date BETWEEN '2023-01-01'::DATE AND '2023-12-31'::DATE AND cs.cs_list_price > 100 GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_sales_amount DESC, average_sales_amount_per_order DESC;
SELECT cc.cc_name AS call_center_name, w.w_warehouse_name AS warehouse_name, s.s_state AS state, SUM(cs.cs_quantity) AS total_items_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_item_sk) AS number_of_unique_items_sold FROM catalog_sales cs INNER JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk INNER JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk INNER JOIN store s ON cc.cc_division = s.s_division_id WHERE cc.cc_market_manager IN ('Matthew Clifton', 'Gary Colburn') AND s.s_country = 'United States' GROUP BY call_center_name, warehouse_name, state ORDER BY total_items_sold DESC, average_sales_price DESC;
SELECT p.p_promo_name AS promotion_name, ib.ib_lower_bound AS income_band_lower_bound, ib.ib_upper_bound AS income_band_upper_bound, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_ext_sales_price) AS total_sales, SUM(ss.ss_ext_discount_amt) AS total_discount_amount, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_customer_sk) AS distinct_customers, SUM(CASE WHEN ss.ss_sales_price < ss.ss_list_price THEN 1 ELSE 0 END) AS count_discounted_sales FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN income_band ib ON ss.ss_cdemo_sk = ib.ib_income_band_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE p.p_discount_active = 'N' AND d.d_year IN (1901, 1903, 1906, 1908) AND ss.ss_ext_sales_price IN (2209.06, 2248.08) AND ib.ib_lower_bound IN (0, 90001, 170001, 120001, 50001) AND ib.ib_upper_bound = 160000 GROUP BY p.p_promo_name, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_sales DESC, promotion_name, income_band_lower_bound, income_band_upper_bound;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, SUM(ws.ws_net_paid_inc_ship_tax) AS total_sales, SUM(ws.ws_ext_ship_cost) AS total_shipping_costs, COUNT(DISTINCT ws.ws_order_number) AS number_of_orders, AVG(ws.ws_net_paid_inc_ship_tax) AS avg_order_value, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_value, COUNT(DISTINCT cr.cr_order_number) AS number_of_returns, SUM(cr.cr_store_credit) AS total_store_credit_issued, SUM(wr.wr_net_loss) AS total_web_net_loss FROM customer c LEFT JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk LEFT JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_returning_customer_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk WHERE ws.ws_ext_ship_cost IN ('445.80', '1378.08') OR ws.ws_net_paid_inc_ship_tax IN ('3521.86', '4835.64', '451.77', '1948.62') OR cr.cr_return_tax IN ('8.78', '157.04', '14.40', '364.85', '21.09', '27.15') OR cr.cr_store_credit IN ('1.34', '1072.41', '2042.86', '1698.25', '143.92') GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name ORDER BY total_sales DESC, number_of_orders DESC, total_returns DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_type, sm.sm_carrier, COUNT(i.i_item_sk) AS total_items_sold, AVG(i.i_current_price) AS average_selling_price, AVG(i.i_wholesale_cost) AS average_wholesale_cost FROM item i JOIN ship_mode sm ON i.i_container = sm.sm_code JOIN income_band ib ON i.i_manager_id = ib.ib_income_band_sk WHERE i.i_product_name = 'antin steing' AND ib.ib_income_band_sk IN (13, 18, 17, 3, 11, 16) AND sm.sm_contract IN ('uukTktPYycct8', '6Hzzp4JkzjqD8MGXLCDa', 'Xjy3ZPuiDjzHlRx14Z3', 'A5BYO1qH8HGTTN') AND i.i_item_id = 'AAAAAAAAMFLAAAAA' AND sm.sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_type, sm.sm_carrier ORDER BY average_selling_price DESC, total_items_sold DESC;
SELECT ca_state, cd_gender, cd_marital_status, cd_education_status, AVG(cd_purchase_estimate) AS avg_purchase_estimate, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_net_paid, SUM(ss_net_profit) AS total_net_profit FROM store_sales JOIN customer_address ON store_sales.ss_addr_sk = customer_address.ca_address_sk JOIN customer_demographics ON store_sales.ss_cdemo_sk = customer_demographics.cd_demo_sk WHERE ca_zip IN ('22562', '41934', '39101', '43301', '36549') GROUP BY ca_state, cd_gender, cd_marital_status, cd_education_status ORDER BY ca_state, cd_gender, cd_marital_status, cd_education_status;
SELECT ca_state, ca_country, COUNT(DISTINCT ca_address_sk) AS num_addresses, SUM(p_cost) AS total_promotion_cost, AVG(p_cost) AS avg_promotion_cost, COUNT(DISTINCT p_promo_sk) AS num_promotions, COUNT(DISTINCT web_site_sk) AS num_websites, SUM(web_tax_percentage) AS total_tax_percentage, AVG(web_tax_percentage) AS avg_tax_percentage FROM customer_address JOIN promotion ON ca_address_sk = p_item_sk JOIN web_site ON ca_address_sk = web_mkt_id WHERE ca_state IN ('DE', 'NH', 'MI', 'MA', 'ID', 'NY') AND ca_country = 'United States' AND p_discount_active = '1' AND web_rec_start_date <= CURRENT_DATE AND (web_rec_end_date IS NULL OR web_rec_end_date >= CURRENT_DATE) GROUP BY ca_state, ca_country ORDER BY ca_state, ca_country;
SELECT cc.cc_name, COUNT(ws.ws_order_number) AS total_online_orders, SUM(ws.ws_quantity) AS total_items_sold, SUM(ws.ws_net_paid) AS total_revenue, SUM(ws.ws_net_profit) AS total_profit, AVG(ws.ws_quantity) AS avg_items_per_order, SUM(sr.sr_return_quantity) AS total_items_returned, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_quantity) AS avg_items_returned_per_order, SUM(wr.wr_return_quantity) AS web_total_items_returned, SUM(wr.wr_return_amt) AS web_total_return_amount, AVG(wr.wr_return_quantity) AS web_avg_items_returned_per_order, COUNT(DISTINCT sm.sm_ship_mode_sk) AS distinct_shipping_modes_used, SUM(promo.p_cost) AS total_promotional_cost FROM call_center cc LEFT JOIN web_sales ws ON cc.cc_call_center_sk = ws.ws_web_page_sk LEFT JOIN store_returns sr ON ws.ws_order_number = sr.sr_ticket_number LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number LEFT JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN promotion promo ON ws.ws_promo_sk = promo.p_promo_sk WHERE cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date > CURRENT_DATE GROUP BY cc.cc_name ORDER BY total_revenue DESC;
SELECT cp.cp_department, ca.ca_state, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs.cs_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(cs.cs_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk WHERE cs.cs_net_paid_inc_ship > 500 AND cp.cp_catalog_page_sk IN (621, 2091, 4644, 4608, 3010) AND ca.ca_state IS NOT NULL GROUP BY cp.cp_department, ca.ca_state ORDER BY cp.cp_department, ca.ca_state;
SELECT sm.sm_type AS shipping_mode, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, AVG(sr.sr_return_quantity) AS average_returned_quantity, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(CASE WHEN p.p_discount_active = 'Y' THEN 1 ELSE 0 END) AS promotions_with_discount, AVG(p.p_cost) AS average_promotion_cost, COUNT(DISTINCT p.p_promo_sk) AS number_of_promotions_used FROM store_returns sr JOIN promotion p ON sr.sr_item_sk = p.p_item_sk JOIN ship_mode sm ON sm.sm_type IN ('TWO DAY', 'OVERNIGHT', 'EXPRESS') JOIN time_dim t ON sr.sr_return_time_sk = t.t_time_sk WHERE sr.sr_addr_sk::text IN ('38052', '30541', '12047', '37071', '23460', '3442') AND t.t_second::text IN ('51', '12', '16', '37', '57') GROUP BY sm.sm_type ORDER BY total_return_amount DESC;
SELECT ca_state, cd_education_status, AVG(cs_net_paid) AS avg_sales_amount, SUM(cs_net_paid) AS total_sales_amount, COUNT(DISTINCT cs_bill_customer_sk) AS unique_customers FROM catalog_sales JOIN date_dim ON catalog_sales.cs_sold_date_sk = date_dim.d_date_sk JOIN customer_demographics ON catalog_sales.cs_bill_cdemo_sk = customer_demographics.cd_demo_sk JOIN customer_address ON catalog_sales.cs_bill_addr_sk = customer_address.ca_address_sk WHERE date_dim.d_quarter_name IN ('1901Q4', '1913Q3', '1902Q3') AND date_dim.d_current_quarter = 'N' AND customer_address.ca_county IN ('Claiborne County', 'Scott County', 'Borden County', 'Juneau County') GROUP BY ca_state, cd_education_status ORDER BY ca_state, cd_education_status, total_sales_amount DESC;
SELECT ca_state, w_city, wp_type, SUM(cs_net_paid) as total_catalog_sales, AVG(ws_net_paid_inc_ship_tax) as avg_web_sales_inc_ship_tax, COUNT(DISTINCT ws_web_page_sk) as distinct_web_pages_accessed, COUNT(DISTINCT sr_reason_sk) as count_distinct_return_reasons, SUM(sr_return_amt) as total_return_amount, MIN(cs_sales_price) as min_catalog_sales_price, MAX(ws_sales_price) as max_web_sales_price FROM customer_address JOIN catalog_sales ON ca_address_sk = cs_ship_addr_sk JOIN web_sales ON ca_address_sk = ws_bill_addr_sk JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk JOIN web_page ON ws_web_page_sk = wp_web_page_sk LEFT JOIN store_returns ON sr_addr_sk = ca_address_sk WHERE w_city = 'Fairview' AND wp_type IN ('feedback', 'dynamic', 'protected', 'welcome', 'general') AND ws_web_site_sk IN ('22', '17', '24', '18', '2') AND cs_ship_customer_sk IN ('47431', '33123', '91253') GROUP BY ca_state, w_city, wp_type ORDER BY total_catalog_sales DESC, avg_web_sales_inc_ship_tax DESC;
SELECT ws_item_sk, AVG(ws_net_profit) AS avg_web_net_profit, AVG(ss_net_profit) AS avg_store_net_profit, (AVG(ws_net_profit) - AVG(ss_net_profit)) AS profit_difference FROM web_sales JOIN web_page ON ws_web_page_sk = wp_web_page_sk LEFT JOIN store_sales ON ws_item_sk = ss_item_sk WHERE wp_char_count > 3000 GROUP BY ws_item_sk HAVING AVG(ws_net_profit) IS NOT NULL AND AVG(ss_net_profit) IS NOT NULL ORDER BY profit_difference DESC;
SELECT d_year, d_month_seq, c_birth_country, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_paid) AS total_sales, AVG(cs_sales_price) AS avg_sales_price, SUM(cr_return_amount) AS total_returns, AVG(cr_return_amount) AS avg_return_amount, COUNT(DISTINCT sr_ticket_number) AS total_return_transactions, SUM(sr_return_amt) AS total_returned_amount, AVG(sr_return_amt) AS avg_returned_amount, COUNT(DISTINCT CASE WHEN sr_reason_sk = 26 THEN sr_ticket_number ELSE NULL END) AS total_returns_reason_26, COUNT(DISTINCT CASE WHEN sr_reason_sk = 20 THEN sr_ticket_number ELSE NULL END) AS total_returns_reason_20, SUM(CASE WHEN sr_reason_sk = 26 THEN sr_return_amt ELSE 0 END) AS total_amount_returned_for_reason_26, SUM(CASE WHEN sr_reason_sk = 20 THEN sr_return_amt ELSE 0 END) AS total_amount_returned_for_reason_20 FROM date_dim JOIN catalog_sales ON (cs_sold_date_sk = d_date_sk) JOIN customer ON (cs_bill_customer_sk = c_customer_sk) LEFT JOIN catalog_returns ON (cs_order_number = cr_order_number AND cs_item_sk = cr_item_sk) LEFT JOIN store_returns ON (cs_order_number = sr_ticket_number AND cs_item_sk = sr_item_sk) WHERE d_year = 2023 AND c_birth_country IN ('United States', 'Canada') GROUP BY d_year, d_month_seq, c_birth_country ORDER BY total_sales DESC, total_returns DESC, d_year, d_month_seq, c_birth_country;
