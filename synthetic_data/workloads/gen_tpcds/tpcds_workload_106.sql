SELECT ca_state, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT sr_customer_sk) AS unique_customers_returning, SUM(CASE WHEN p_channel_press = 'N' AND p_channel_catalog = 'N' THEN sr_return_amt ELSE 0 END) AS total_return_amount_no_press_no_catalog, wm.warehouse_count, sm.sm_count, ib.ib_count FROM store_returns sr JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN (SELECT w_state, COUNT(*) AS warehouse_count FROM warehouse GROUP BY w_state) wm ON ca.ca_state = wm.w_state JOIN (SELECT sm_carrier, COUNT(*) AS sm_count FROM ship_mode WHERE sm_carrier IN ('ALLIANCE', 'ZOUROS', 'UPS') GROUP BY sm_carrier) sm ON 1=1 JOIN (SELECT ib_lower_bound, COUNT(*) AS ib_count FROM income_band GROUP BY ib_lower_bound) ib ON 1=1 LEFT JOIN promotion p ON sr.sr_reason_sk = p.p_promo_sk WHERE sr.sr_reason_sk IN (19, 26, 34, 7, 29) AND ca.ca_street_name IN ('Johnson Spruce', '12th View', 'Dogwood 12th', '15th Third', 'Ninth Fourth', '1st 7th') AND sr_return_amt > 0 GROUP BY ca_state, wm.warehouse_count, sm.sm_count, ib.ib_count ORDER BY total_return_amount DESC LIMIT 100;
SELECT cs.cs_order_number AS order_number, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_profit) AS total_net_profit, COUNT(DISTINCT cs.cs_bill_customer_sk) AS unique_customers, ib.ib_lower_bound AS income_lower_bound, ib.ib_upper_bound AS income_upper_bound, SUM(ws.ws_quantity) AS web_total_quantity, AVG(ws.ws_sales_price) AS web_average_sales_price, SUM(ws.ws_net_paid) AS web_total_net_paid, SUM(ws.ws_net_profit) AS web_total_net_profit, COUNT(DISTINCT ws.ws_bill_customer_sk) AS web_unique_customers FROM catalog_sales cs JOIN income_band ib ON cs.cs_bill_hdemo_sk = ib.ib_income_band_sk JOIN web_sales ws ON cs.cs_item_sk = ws.ws_item_sk AND cs.cs_order_number = ws.ws_order_number WHERE cs.cs_ext_tax IN (0.56, 96.57, 30.68, 46.59, 64.13) AND ib.ib_income_band_sk IN (19, 17, 16, 10, 1) GROUP BY cs.cs_order_number, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_net_profit DESC, web_total_net_profit DESC LIMIT 100;
SELECT cp.cp_type, cp.cp_department, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS avg_sales_price, COUNT(DISTINCT cs.cs_order_number) AS unique_orders, SUM(sr.sr_return_quantity) AS total_return_quantity, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(inv.inv_quantity_on_hand) AS total_inventory_on_hand, SUM(ss.ss_quantity) AS total_store_sales_quantity, AVG(ss.ss_net_paid) AS avg_net_paid_store_sales FROM catalog_page cp JOIN catalog_sales cs ON cp.cp_catalog_page_sk = cs.cs_catalog_page_sk LEFT JOIN store_returns sr ON cs.cs_item_sk = sr.sr_item_sk AND cs.cs_order_number = CAST(sr.sr_ticket_number AS integer) LEFT JOIN inventory inv ON cs.cs_item_sk = inv.inv_item_sk LEFT JOIN store_sales ss ON cs.cs_item_sk = ss.ss_item_sk AND cs.cs_order_number = CAST(ss.ss_ticket_number AS integer) WHERE cp.cp_catalog_number IN (36, 10, 1, 39, 15, 23) AND cp.cp_type IN ('quarterly', 'bi-annual', 'monthly') AND inv.inv_date_sk = 2450815 AND cs.cs_ship_date_sk = 2450901 AND cs.cs_list_price IN (127.89, 61.80, 132.26) GROUP BY cp.cp_type, cp.cp_department ORDER BY cp.cp_type, cp.cp_department;
SELECT c.ca_county, COUNT(distinct ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid_inc_tax) AS total_revenue_inc_tax, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN customer_address c ON ws.ws_bill_addr_sk = c.ca_address_sk JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk JOIN store s ON c.ca_state = s.s_state WHERE wp.wp_char_count IN ('5918', '3732', '4894', '2129', '1526') AND c.ca_county IN ('Calloway County', 'Mifflin County', 'Dutchess County', 'Rowan County') AND s.s_number_employees = 297 AND ws.ws_bill_customer_sk IN ('50106', '534', '23933', '77910', '39966') GROUP BY c.ca_county ORDER BY total_revenue_inc_tax DESC, total_net_profit DESC;
SELECT i_category, ca_state, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_amt) AS avg_return_amount, COUNT(DISTINCT sr_customer_sk) AS unique_customers_returning, COUNT(*) AS total_returns FROM store_returns sr JOIN item i ON sr.sr_item_sk = i.i_item_sk JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ca.ca_gmt_offset IN ('-5.00', '-6.00', '-10.00', '-7.00', '-9.00') AND c.c_birth_month IN (6, 1, 3, 10, 9, 8) AND ca.ca_suite_number IN ('Suite 10', 'Suite I', 'Suite 60', 'Suite 360', 'Suite C', 'Suite 320') GROUP BY i_category, ca_state ORDER BY total_return_amount DESC, unique_customers_returning DESC;
SELECT s.s_store_name, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_items_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_ext_discount_amt) AS total_discount_amount, SUM(ss.ss_net_paid) AS total_net_sales, SUM(ss.ss_net_paid_inc_tax) AS net_sales_including_tax, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(DISTINCT wr.wr_order_number) AS total_returns_transactions, SUM(wr.wr_return_quantity) AS total_items_returned, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_fee) AS total_return_fees, SUM(wr.wr_net_loss) AS total_net_loss FROM store s JOIN store_sales ss ON s.s_store_sk = ss.ss_store_sk LEFT JOIN web_returns wr ON ss.ss_item_sk = wr.wr_item_sk AND ss.ss_ticket_number = wr.wr_order_number WHERE s.s_county = 'Williamson County' AND ss.ss_coupon_amt IN (215.60, 1007.22, 1869.51) GROUP BY s.s_store_name ORDER BY s.s_store_name;
SELECT sm.sm_type AS shipping_type, COUNT(DISTINCT c.c_customer_sk) AS number_of_customers, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_return_quantity) AS average_return_quantity, SUM(wr.wr_fee) AS total_return_fees, AVG(wr.wr_net_loss) AS average_net_loss, COUNT(DISTINCT cp.cp_catalog_page_sk) AS total_catalog_pages, AVG(hd.hd_vehicle_count) AS average_vehicle_count, SUM(CASE WHEN d.d_weekend = 'Y' THEN 1 ELSE 0 END) AS weekend_dates_count, SUM(CASE WHEN d.d_holiday = 'Y' THEN 1 ELSE 0 END) AS holiday_dates_count FROM ship_mode sm JOIN web_returns wr ON sm.sm_ship_mode_sk = wr.wr_returned_time_sk JOIN customer c ON wr.wr_returning_customer_sk = c.c_customer_sk JOIN catalog_page cp ON cp.cp_start_date_sk = wr.wr_returned_date_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN date_dim d ON wr.wr_returned_date_sk = d.d_date_sk WHERE sm.sm_ship_mode_id IN ('AAAAAAAADBAAAAAA', 'AAAAAAAAMAAAAAAA', 'AAAAAAAAOAAAAAAA') AND sm.sm_type IN ('EXPRESS', 'NEXT DAY', 'OVERNIGHT') AND c.c_last_name IN ('Kyle', 'Reddy', 'Bishop') AND cp.cp_type IN ('quarterly', 'monthly', 'bi-annual') AND hd.hd_vehicle_count IN (3, 1, 0) AND hd.hd_buy_potential IN ('5001-10000', '>10000', 'Unknown') AND d.d_weekend IN ('N', 'Y') GROUP BY sm.sm_type;
SELECT w.w_state, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(w.w_gmt_offset) AS average_gmt_offset, COUNT(r.r_reason_sk) AS gift_exchange_occurrences FROM warehouse w LEFT JOIN reason r ON r.r_reason_desc = 'Gift exchange' JOIN time_dim t ON t.t_minute BETWEEN 25 AND 35 GROUP BY w.w_state ORDER BY total_warehouse_sq_ft DESC, average_gmt_offset DESC;
SELECT s.s_store_name, s.s_city, s.s_state, td.t_shift, COUNT(*) AS total_returns, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(CASE WHEN sr.sr_return_amt_inc_tax > 100 THEN 1 ELSE 0 END) AS returns_over_100, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN time_dim td ON sr.sr_return_time_sk = td.t_time_sk JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN web_page wp ON sr.sr_store_sk = wp.wp_customer_sk JOIN web_returns wr ON sr.sr_item_sk = wr.wr_item_sk AND sr.sr_ticket_number = wr.wr_order_number WHERE td.t_shift = 'third' AND s.s_gmt_offset = '-5.00' AND ca.ca_address_id IN ('AAAAAAAAGGKAAAAA', 'AAAAAAAANCEAAAAA', 'AAAAAAAAOKGAAAAA') AND (wr.wr_return_amt_inc_tax = '6344.70' OR wr.wr_return_amt_inc_tax = '72.90' OR wr.wr_return_amt_inc_tax = '705.96') GROUP BY s.s_store_name, s.s_city, s.s_state, td.t_shift ORDER BY total_returns DESC, avg_return_amount_inc_tax DESC LIMIT 100;
