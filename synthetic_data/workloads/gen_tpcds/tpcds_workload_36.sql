SELECT ca.ca_state AS customer_state, r.r_reason_desc AS return_reason, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_amt) AS total_return_amt, SUM(sr.sr_return_tax) AS total_return_tax, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk GROUP BY ca.ca_state, r.r_reason_desc ORDER BY ca.ca_state, r.r_reason_desc;
SELECT dd.d_year AS sales_year, dd.d_quarter_name AS sales_quarter, ca.ca_state AS customer_state, cd.cd_education_status AS education_status, cd.cd_gender AS gender, COUNT(DISTINCT c.c_customer_sk) AS num_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS num_preferred_customers FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN date_dim dd ON c.c_first_sales_date_sk = dd.d_date_sk WHERE dd.d_quarter_seq IN (SELECT MAX(d_quarter_seq) FROM date_dim WHERE d_current_quarter = 'Y') GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state, cd.cd_education_status, cd.cd_gender ORDER BY num_customers DESC, avg_purchase_estimate DESC;
SELECT sm.sm_type AS shipping_type, sm.sm_code AS shipping_code, sm.sm_carrier AS carrier, COUNT(DISTINCT inv.inv_item_sk) AS unique_items_shipped, SUM(inv.inv_quantity_on_hand) AS total_quantity_on_hand, AVG(wr.wr_return_amt_inc_tax) AS average_return_amount_incl_tax, SUM(wr.wr_fee) AS total_return_fees, SUM(wr.wr_net_loss) AS total_net_loss, COUNT(DISTINCT wr.wr_order_number) AS total_return_orders, td.t_shift AS time_shift, COUNT(DISTINCT td.t_time_sk) AS total_shift_times FROM ship_mode sm JOIN inventory inv ON sm.sm_ship_mode_sk = inv.inv_warehouse_sk LEFT JOIN web_returns wr ON inv.inv_item_sk = wr.wr_item_sk LEFT JOIN time_dim td ON wr.wr_returned_time_sk = td.t_time_sk WHERE td.t_shift = 'third' AND inv.inv_warehouse_sk IN (1, 2) AND inv.inv_item_sk IN (15820, 14284, 6472) AND td.t_time_sk IN ('4753', '787', '4258') GROUP BY sm.sm_type, sm.sm_code, sm.sm_carrier, td.t_shift ORDER BY total_net_loss DESC;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_state, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, SUM(cs.cs_net_paid) AS total_net_paid, AVG(cs.cs_net_profit) AS avg_net_profit FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN store s ON ca.ca_state = s.s_state WHERE dd.d_current_quarter = 'N' AND dd.d_following_holiday = 'N' AND cd.cd_credit_rating = 'Good' AND s.s_market_id IS NOT NULL GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state ORDER BY dd.d_year, dd.d_quarter_name, ca.ca_state;
SELECT c.c_customer_id, AVG(ss.ss_net_profit) AS avg_net_profit, SUM(sr.sr_return_amt_inc_tax) AS total_returns, COUNT(DISTINCT ws.web_site_sk) AS number_of_websites, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid_inc_tax) AS total_sales_inc_tax FROM customer c LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk LEFT JOIN web_site ws ON ws.web_zip = c.c_current_addr_sk::character varying WHERE (ss.ss_hdemo_sk IN ('4776', '3144', '2508', '6460') OR c.c_current_hdemo_sk IN ('5414', '1065', '4963', '3942', '5655', '758')) AND (ws.web_zip IN ('35709', '31904') OR ws.web_rec_end_date IN ('1999-08-16', '2000-08-15', '2001-08-15')) GROUP BY c.c_customer_id ORDER BY avg_net_profit DESC, total_returns DESC, number_of_websites DESC, total_quantity_sold DESC, total_sales_inc_tax DESC;
SELECT SUM(cr_return_amount) AS total_catalog_returns, AVG(sr_return_amt) AS average_store_returns, COUNT(DISTINCT ss_customer_sk) AS unique_customers_making_purchases, SUM(ss_net_paid_inc_tax) AS total_sales_revenue_inc_tax, SUM(ss_net_profit) AS total_sales_net_profit FROM catalog_returns JOIN store_returns ON cr_item_sk = sr_item_sk AND cr_order_number = sr_ticket_number JOIN store_sales ON cr_item_sk = ss_item_sk AND cr_order_number = ss_ticket_number WHERE cr_refunded_addr_sk IN ('48782', '39638', '44776', '9470') AND cr_catalog_page_sk IN ('238', '365', '2') AND sr_return_tax IN ('34.09', '13.62') GROUP BY cr_refunded_addr_sk;
SELECT w.w_warehouse_name, cc.cc_name AS call_center_name, cd.cp_department, sm.sm_type AS ship_mode_type, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_quantity) AS total_quantity_sold, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(CASE WHEN hd.hd_vehicle_count > 2 THEN ss.ss_net_paid ELSE 0 END) AS net_paid_more_than_2_vehicles, SUM(CASE WHEN cd.cp_type = 'quarterly' THEN ss.ss_net_paid_inc_tax ELSE 0 END) AS net_paid_inc_tax_for_quarterly_pages FROM store_sales ss JOIN warehouse w ON ss.ss_store_sk = w.w_warehouse_sk JOIN call_center cc ON w.w_zip = cc.cc_zip JOIN catalog_page cd ON ss.ss_promo_sk = cd.cp_catalog_page_sk JOIN ship_mode sm ON sm.sm_code = 'AIR' JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk WHERE cc.cc_street_type = 'Boulevard' AND cd.cp_type IN ('quarterly', 'bi-annual') AND w.w_suite_number IN ('Suite 80', 'Suite P') GROUP BY w.w_warehouse_name, cc.cc_name, cd.cp_department, sm.sm_type ORDER BY avg_sales_price DESC, total_quantity_sold DESC, unique_customers DESC, net_paid_more_than_2_vehicles DESC, net_paid_inc_tax_for_quarterly_pages DESC;
SELECT cd.cd_education_status, cd.cd_gender, cd.cd_marital_status, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(sr.sr_return_amt_inc_tax) AS total_returns_inc_tax, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, COUNT(sr.sr_item_sk) AS total_returned_items, SUM(sr.sr_net_loss) AS total_net_loss FROM customer_demographics cd JOIN customer c ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN web_page wp ON c.c_customer_sk = wp.wp_customer_sk WHERE c.c_first_shipto_date_sk IN ('2452105', '2451393') AND c.c_first_sales_date_sk IN ('2450519', '2451079') AND cd.cd_gender IN ('M', 'F') AND wp.wp_type IN ('feedback', 'general', 'protected') GROUP BY cd.cd_education_status, cd.cd_gender, cd.cd_marital_status ORDER BY total_returns_inc_tax DESC, avg_purchase_estimate DESC;
SELECT ws_site.web_market_manager, SUM(ws.ws_sales_price) AS total_sales, AVG(ws.ws_sales_price) AS average_sales, COUNT(ws.ws_order_number) AS number_of_orders, COUNT(DISTINCT ws.ws_item_sk) AS number_of_items_sold, SUM(sr.sr_return_amt) AS total_returns, AVG(sr.sr_return_amt) AS average_return_amount, COUNT(DISTINCT sr.sr_ticket_number) AS number_of_returns FROM web_sales ws JOIN web_site ws_site ON ws.ws_web_site_sk = ws_site.web_site_sk LEFT JOIN store_returns sr ON ws.ws_bill_customer_sk = sr.sr_customer_sk AND ws.ws_item_sk = sr.sr_item_sk WHERE ws_site.web_open_date_sk IN (2450594, 2450798, 2450747, 2450577, 2450807, 2450645) GROUP BY ws_site.web_market_manager ORDER BY total_sales DESC;
SELECT w_warehouse_name, cd_credit_rating, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_quantity) AS total_return_quantity, COUNT(DISTINCT cr_order_number) AS total_orders_returned, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns INNER JOIN warehouse ON catalog_returns.cr_warehouse_sk = warehouse.w_warehouse_sk INNER JOIN customer_demographics ON catalog_returns.cr_refunded_cdemo_sk = customer_demographics.cd_demo_sk INNER JOIN household_demographics ON catalog_returns.cr_refunded_hdemo_sk = household_demographics.hd_demo_sk WHERE cr_returned_date_sk IN (2451154, 2451037, 2450875, 2450957, 2450981) AND household_demographics.hd_income_band_sk IN ('12', '7', '9', '5', '16', '3') AND household_demographics.hd_vehicle_count = 3 AND customer_demographics.cd_dep_employed_count = 0 AND catalog_returns.cr_store_credit IN (950.05, 59.82, 39.71) GROUP BY w_warehouse_name, cd_credit_rating ORDER BY total_net_loss DESC, avg_return_amount DESC;
SELECT d_year, cc_city, sm_carrier, cd_gender, cd_marital_status, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_quantity) AS average_return_quantity, COUNT(sr_ticket_number) AS number_of_returns, MAX(sr_return_amt_inc_tax) AS max_return_amount_including_tax, MIN(sr_fee) AS min_return_fee FROM store_returns sr JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN date_dim d ON sr.sr_returned_date_sk = d.d_date_sk JOIN call_center cc ON cc.cc_call_center_sk = sr.sr_store_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = sr.sr_reason_sk WHERE d_year = 2002 AND cd_gender = 'F' AND sm_carrier IN ('RUPEKSA', 'DIAMOND') AND cc_market_manager IN ('Julius Durham', 'Matthew Clifton', 'Gary Colburn', 'Julius Tran') AND sr_return_tax IN (8.58, 50.84) GROUP BY d_year, cc_city, sm_carrier, cd_gender, cd_marital_status ORDER BY total_return_amount DESC, number_of_returns DESC LIMIT 100;
SELECT i.i_category AS item_category, cc.cc_state AS call_center_state, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_sales_price) AS average_sales_price, AVG(ss.ss_ext_discount_amt) AS average_discount_amount FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN call_center cc ON cc.cc_call_center_sk = ss.ss_store_sk WHERE i.i_current_price BETWEEN 4.63 AND 18.31 AND ss.ss_sold_date_sk IS NOT NULL GROUP BY i.i_category, cc.cc_state ORDER BY total_sales DESC, item_category, call_center_state;
SELECT i.i_category, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(wr.wr_return_quantity) AS total_quantity_returned, SUM(wr.wr_return_amt) AS total_return_amount, AVG(inv.inv_quantity_on_hand) AS average_inventory_on_hand FROM item i LEFT JOIN store_sales ss ON ss.ss_item_sk = i.i_item_sk LEFT JOIN web_returns wr ON wr.wr_item_sk = i.i_item_sk LEFT JOIN inventory inv ON inv.inv_item_sk = i.i_item_sk WHERE i.i_category IN ('Electronics', 'Clothing', 'Furniture') AND ss.ss_sold_date_sk BETWEEN 2451453 AND 2451553 AND wr.wr_returned_date_sk BETWEEN 2451453 AND 2451553 AND inv.inv_date_sk BETWEEN 2451453 AND 2451553 GROUP BY i.i_category ORDER BY total_quantity_sold DESC;
SELECT s.s_store_name, s.s_city, ca.ca_state, COUNT(DISTINCT ss.ss_ticket_number) AS store_sales_count, SUM(ss.ss_net_paid) AS total_store_sales_revenue, COUNT(DISTINCT sr.sr_ticket_number) AS store_returns_count, SUM(sr.sr_return_amt) AS total_store_returns_revenue, COUNT(DISTINCT cs.cs_order_number) AS catalog_sales_count, SUM(cs.cs_net_paid) AS total_catalog_sales_revenue, COUNT(DISTINCT cr.cr_order_number) AS catalog_returns_count, SUM(cr.cr_return_amount) AS total_catalog_returns_revenue, w.w_warehouse_name, SUM(cr.cr_fee) AS total_cr_fee, AVG(cr.cr_return_amount) AS avg_catalog_return_amount, MAX(ss.ss_net_profit) AS max_store_sale_profit FROM store AS s LEFT JOIN store_sales AS ss ON s.s_store_sk = ss.ss_store_sk LEFT JOIN store_returns AS sr ON s.s_store_sk = sr.sr_store_sk LEFT JOIN warehouse AS w ON w.w_city = s.s_city AND w.w_county = s.s_county LEFT JOIN catalog_sales AS cs ON cs.cs_warehouse_sk = w.w_warehouse_sk LEFT JOIN catalog_returns AS cr ON cr.cr_warehouse_sk = w.w_warehouse_sk LEFT JOIN customer_address AS ca ON ca.ca_address_sk = sr.sr_addr_sk WHERE s.s_company_id = 1 AND s.s_geography_class = 'Unknown' AND w.w_city = 'Fairview' AND w.w_county = 'Williamson County' AND cr.cr_fee IN ('26.50', '75.45', '76.31', '11.75', '16.52', '56.95') AND cr.cr_ship_mode_sk IN ('8', '20', '4', '1', '11') AND sr.sr_addr_sk IN ('11867', '40243') AND sr.sr_reversed_charge IN ('0.68', '96.26', '6.63', '3.63') GROUP BY s.s_store_name, s.s_city, ca.ca_state, w.w_warehouse_name ORDER BY total_store_sales_revenue DESC;
