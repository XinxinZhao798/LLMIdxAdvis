SELECT ca_state, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT sr_customer_sk) AS unique_customers_returning, SUM(CASE WHEN p_channel_press = 'N' AND p_channel_catalog = 'N' THEN sr_return_amt ELSE 0 END) AS total_return_amount_no_press_no_catalog, wm.warehouse_count, sm.sm_count, ib.ib_count FROM store_returns sr JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN (SELECT w_state, COUNT(*) AS warehouse_count FROM warehouse GROUP BY w_state) wm ON ca.ca_state = wm.w_state JOIN (SELECT sm_carrier, COUNT(*) AS sm_count FROM ship_mode WHERE sm_carrier IN ('ALLIANCE', 'ZOUROS', 'UPS') GROUP BY sm_carrier) sm ON 1=1 JOIN (SELECT ib_lower_bound, COUNT(*) AS ib_count FROM income_band GROUP BY ib_lower_bound) ib ON 1=1 LEFT JOIN promotion p ON sr.sr_reason_sk = p.p_promo_sk WHERE sr.sr_reason_sk IN (19, 26, 34, 7, 29) AND ca.ca_street_name IN ('Johnson Spruce', '12th View', 'Dogwood 12th', '15th Third', 'Ninth Fourth', '1st 7th') AND sr_return_amt > 0 GROUP BY ca_state, wm.warehouse_count, sm.sm_count, ib.ib_count ORDER BY total_return_amount DESC LIMIT 100;
SELECT p.p_promo_id, p.p_promo_name, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_tickets, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_ext_discount_amt) AS avg_ticket_discount, SUM(ss.ss_net_paid) AS total_net_sales, SUM(ss.ss_net_profit) AS total_net_profit, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, CASE WHEN hd.hd_buy_potential = '0-500' THEN 'Low' WHEN hd.hd_buy_potential = '501-1000' THEN 'Below Average' WHEN hd.hd_buy_potential = '1001-5000' THEN 'Average' WHEN hd.hd_buy_potential = '5001-10000' THEN 'Above Average' WHEN hd.hd_buy_potential = '>10000' THEN 'High' ELSE 'Unknown' END AS avg_buy_potential, COUNT(DISTINCT hd.hd_income_band_sk) AS distinct_income_bands FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk LEFT JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk GROUP BY p.p_promo_id, p.p_promo_name, hd.hd_buy_potential ORDER BY total_net_sales DESC, total_net_profit DESC;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_class, ca.ca_street_type, COUNT(distinct ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_net_paid, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(distinct ss.ss_customer_sk) AS unique_customers_served FROM store_sales ss JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk JOIN call_center cc ON cc.cc_class IN ('small', 'medium', 'large') LEFT JOIN reason r ON r.r_reason_desc = 'reason 31' WHERE ca.ca_street_type IN ('Pkwy', 'Court') AND r.r_reason_sk IS NULL GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_class, ca.ca_street_type ORDER BY total_net_profit DESC, total_sales_transactions DESC;
SELECT sm.sm_carrier, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_profit, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_quantity_returned, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_net_loss) AS total_loss, COUNT(DISTINCT ss.ss_ticket_number) AS total_store_sales, SUM(ss.ss_quantity) AS total_store_quantity_sold, AVG(ss.ss_sales_price) AS average_store_sales_price, SUM(ss.ss_net_profit) AS total_store_profit FROM ship_mode sm LEFT JOIN catalog_sales cs ON sm.sm_ship_mode_sk = cs.cs_ship_mode_sk LEFT JOIN store_returns sr ON sr.sr_store_sk = cs.cs_bill_customer_sk LEFT JOIN store_sales ss ON ss.ss_store_sk = sr.sr_store_sk WHERE sm.sm_carrier IN ('UPS', 'BARIAN') AND sm.sm_ship_mode_id IN ('AAAAAAAAOAAAAAAA', 'AAAAAAAADAAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAACAAAAAAA') AND cs.cs_bill_hdemo_sk = 3987 AND sr.sr_return_time_sk IN (60750, 41614, 39692, 44726) AND EXISTS (SELECT 1 FROM web_site WHERE web_zip IN ('35709', '31904') AND web_site_sk = cs.cs_warehouse_sk) GROUP BY sm.sm_carrier ORDER BY total_profit DESC, total_loss ASC;
SELECT i.i_category AS product_category, AVG(i.i_current_price) AS avg_item_price, COUNT(DISTINCT w.wr_order_number) AS total_orders, SUM(w.wr_return_quantity) AS total_items_returned, SUM(w.wr_return_amt) AS total_amount_returned, SUM(w.wr_net_loss) AS total_net_loss FROM item i JOIN web_returns w ON i.i_item_sk = w.wr_item_sk JOIN time_dim t ON t.t_time_sk = w.wr_returned_time_sk JOIN web_page wp ON w.wr_web_page_sk = wp.wp_web_page_sk JOIN customer c ON w.wr_refunded_customer_sk = c.c_customer_sk WHERE w.wr_return_quantity > 0 AND i.i_category IS NOT NULL AND c.c_last_review_date_sk = 2452428 AND (w.wr_refunded_cdemo_sk IN (1473865, 1053973, 323984, 999712) OR w.wr_return_quantity IN (92, 41)) GROUP BY i.i_category ORDER BY total_net_loss DESC, total_amount_returned DESC;
SELECT c.c_birth_country, COUNT(DISTINCT c.c_customer_sk) AS num_customers, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_net_paid_inc_tax) AS avg_net_paid_inc_tax, SUM(CASE WHEN ss.ss_net_paid_inc_tax > 1000 THEN ss.ss_quantity ELSE 0 END) AS quantity_sold_above_1000, COUNT(DISTINCT p.p_promo_sk) AS num_promotions, SUM(p.p_cost) AS total_promotion_cost, w.w_state, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft FROM customer c JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN warehouse w ON w.w_zip = c.c_current_addr_sk::character varying WHERE c.c_birth_country IN ('THAILAND', 'ITALY') AND ss.ss_net_paid_inc_tax::text IN ('307.45', '859.21', '1169.72', '3293.51', '222.26') GROUP BY c.c_birth_country, w.w_state ORDER BY total_quantity_sold DESC;
SELECT i.i_category AS category, ca.ca_state AS customer_state, EXTRACT(MONTH FROM (DATE '1970-01-01' + c.c_first_sales_date_sk * INTERVAL '1 day')) AS sale_month, COUNT(DISTINCT s.s_store_sk) AS num_stores, SUM(i.i_current_price) AS total_sales_amount, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, COUNT(i.i_item_sk) AS items_sold, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_amt) AS avg_return_amount, COUNT(sr.sr_item_sk) AS items_returned FROM store s JOIN customer c ON s.s_store_sk = c.c_current_addr_sk JOIN item i ON s.s_store_sk = i.i_manufact_id JOIN store_returns sr ON i.i_item_sk = sr.sr_item_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ca.ca_state IN ('TN', 'DE', 'VA', 'CO') AND i.i_category_id IS NOT NULL AND c.c_first_sales_date_sk IS NOT NULL AND (c.c_birth_month = 1 OR c.c_birth_month IS NULL) AND sr.sr_returned_date_sk IS NOT NULL GROUP BY category, customer_state, sale_month ORDER BY total_sales_amount DESC, avg_wholesale_cost DESC, total_return_amount DESC LIMIT 100;
SELECT w.w_warehouse_name, w.w_city, w.w_state, w.w_country, t.t_shift, COUNT(*) AS num_transactions, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_sq_ft, MAX(t.t_hour) AS latest_hour, MIN(t.t_hour) AS earliest_hour FROM warehouse w JOIN time_dim t ON w.w_warehouse_sk = t.t_time_sk WHERE w.w_warehouse_sq_ft IN (621234, 294242, 977787, 138504) AND t.t_hour IN (1, 0) AND t.t_second IN (53, 8, 34, 52) GROUP BY w.w_warehouse_name, w.w_city, w.w_state, w.w_country, t.t_shift ORDER BY total_warehouse_sq_ft DESC, num_transactions DESC;
SELECT ws.web_site_id, ws.web_name, c.c_birth_country, SUM(wsl.ws_sales_price) AS total_sales, AVG(wsl.ws_sales_price) AS average_sales, COUNT(DISTINCT wsl.ws_order_number) AS total_orders, COUNT(DISTINCT wsl.ws_item_sk) AS total_items_sold, s.s_store_name, s.s_market_manager FROM web_sales wsl JOIN web_site ws ON wsl.ws_web_site_sk = ws.web_site_sk JOIN customer c ON wsl.ws_bill_customer_sk = c.c_customer_sk JOIN store s ON s.s_market_id = ws.web_mkt_id WHERE (s.s_store_name LIKE '%ought%' OR s.s_store_name LIKE '%ation%' OR s.s_store_name LIKE '%anti%') AND s.s_market_manager = 'Charles Bartley' AND ws.web_suite_number IN ('Suite 150', 'Suite 260', 'Suite 350', 'Suite 450', 'Suite 280', 'Suite 470') AND c.c_first_sales_date_sk = '2451321' GROUP BY ws.web_site_id, ws.web_name, c.c_birth_country, s.s_store_name, s.s_market_manager ORDER BY total_sales DESC, average_sales DESC;
SELECT i.i_category, i.i_class, i.i_brand, SUM(ws.ws_net_paid) AS total_sales, AVG(ws.ws_quantity) AS average_quantity_sold, SUM(sr.sr_return_amt) AS total_returns, AVG(sr.sr_return_quantity) AS average_quantity_returned, (SUM(ws.ws_net_paid) - SUM(sr.sr_return_amt)) AS net_sales FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN store_returns sr ON ws.ws_item_sk = sr.sr_item_sk LEFT JOIN ( SELECT wr_item_sk, wr_returned_date_sk, SUM(wr_return_amt) AS wr_total_return_amt, SUM(wr_return_ship_cost) AS wr_total_return_ship_cost FROM web_returns GROUP BY wr_item_sk, wr_returned_date_sk ) wr ON ws.ws_item_sk = wr.wr_item_sk WHERE ws.ws_warehouse_sk IN (5, 1, 2) AND ws.ws_wholesale_cost IN (16.07, 45.38, 66.57) AND ws.ws_order_number IN (42297, 10912, 13297) AND sr.sr_ticket_number IN (36370, 38622, 39874) AND sr.sr_return_quantity IN (41, 16, 8) AND i.i_manufact IN ('baresecally', 'ationableought', 'ableationeing') AND i.i_item_id IN ('AAAAAAAAJKDAAAAA', 'AAAAAAAAIACAAAAA', 'AAAAAAAAACIAAAAA') AND wr.wr_returned_date_sk IN (2451906, 2452157, 2451313) AND wr.wr_total_return_ship_cost IN (209.65, 2559.79, 887.24) AND wr.wr_total_return_amt IN (32.76, 437.16, 23.35) GROUP BY i.i_category, i.i_class, i.i_brand ORDER BY net_sales DESC, total_sales DESC, total_returns DESC, i.i_category, i.i_class, i.i_brand;
SELECT s.s_store_name, s.s_city, s.s_state, p.p_promo_name, p.p_channel_details, SUM(wr.wr_return_amt) AS total_refund_amount, AVG(wr.wr_fee) AS average_fee, COUNT(DISTINCT wr.wr_returned_date_sk) AS unique_return_days, COUNT(*) AS total_returns, cd.cd_gender, cd.cd_education_status, COUNT(DISTINCT cd.cd_demo_sk) AS unique_customers FROM web_returns wr JOIN store s ON wr.wr_returning_addr_sk = s.s_store_sk JOIN promotion p ON wr.wr_item_sk = p.p_item_sk JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk WHERE s.s_tax_precentage = '0.01' AND s.s_gmt_offset = '-5.00' AND p.p_discount_active = 'N' AND wr.wr_refunded_cdemo_sk IN ('991117', '972552', '90047') AND wr.wr_returning_addr_sk IN ('33543', '41829') GROUP BY s.s_store_name, s.s_city, s.s_state, p.p_promo_name, p.p_channel_details, cd.cd_gender, cd.cd_education_status ORDER BY total_refund_amount DESC, unique_return_days DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_net_profit, AVG(hd.hd_dep_count) AS average_dependency_count, AVG(hd.hd_vehicle_count) AS average_vehicle_count, SUM(ws.ws_net_paid_inc_ship) AS total_web_net_paid_inc_ship, AVG(ws.ws_net_paid_inc_ship) AS average_web_net_paid_inc_ship, SUM(ws.ws_quantity) AS total_web_quantity_sold, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, s.s_country, s.s_tax_precentage, MAX(t.t_time) AS max_time_of_purchase, MIN(t.t_time) AS min_time_of_purchase FROM income_band ib LEFT JOIN household_demographics hd ON ib.ib_income_band_sk = hd.hd_income_band_sk LEFT JOIN catalog_sales cs ON hd.hd_demo_sk = cs.cs_bill_hdemo_sk LEFT JOIN web_sales ws ON hd.hd_demo_sk = ws.ws_bill_hdemo_sk LEFT JOIN store s ON s.s_store_sk = cs.cs_warehouse_sk LEFT JOIN time_dim t ON t.t_time_sk = cs.cs_sold_time_sk WHERE s.s_country = 'United States' AND t.t_am_pm = 'AM' AND s.s_tax_precentage IN (0.08, 0.01) AND ws.ws_net_paid_inc_ship IN (1475.10, 4030.95, 1226.89, 21728.07) AND t.t_second = 36 GROUP BY ib.ib_income_band_sk, s.s_country, s.s_tax_precentage ORDER BY total_net_profit DESC, total_web_net_paid_inc_ship DESC;
SELECT s_state, cp_department, COUNT(DISTINCT s_store_sk) AS store_count, AVG(s_number_employees) AS avg_number_employees, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, AVG(wr_return_quantity) AS avg_return_quantity, SUM(wr_net_loss) AS total_net_loss FROM store JOIN catalog_page ON (s_store_sk = cp_catalog_page_sk) JOIN web_returns ON (s_store_sk = wr_returning_addr_sk) WHERE s_suite_number IN ('Suite T', 'Suite 140') AND cp_start_date_sk IS NOT NULL AND wr_returned_date_sk IS NOT NULL GROUP BY ROLLUP(s_state, cp_department) ORDER BY s_state, cp_department;
SELECT i_category, i_brand, EXTRACT(YEAR FROM i_rec_start_date) AS year_started, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_profit) AS total_net_profit, SUM(cs_coupon_amt) AS total_coupon_amount, AVG(cs_net_paid_inc_ship_tax) AS average_net_paid_including_shipping_and_tax FROM item JOIN catalog_sales ON i_item_sk = cs_item_sk WHERE cs_net_paid > 10000 GROUP BY i_category, i_brand, year_started ORDER BY total_net_paid DESC, i_category, i_brand;
SELECT ib.ib_lower_bound, ib.ib_upper_bound, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_tickets, SUM(ss.ss_net_paid_inc_tax) AS total_revenue_inc_tax, SUM(ss.ss_net_profit) AS total_profit, AVG(hd.hd_dep_count) AS average_dependency_count, AVG(hd.hd_vehicle_count) AS average_vehicle_count FROM store_sales ss JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk GROUP BY ib.ib_lower_bound, ib.ib_upper_bound HAVING COUNT(DISTINCT ss.ss_ticket_number) > 10 ORDER BY total_revenue_inc_tax DESC;
SELECT dd.d_year, dd.d_quarter_name, cc.cc_class, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(DISTINCT ss.ss_store_sk) AS number_of_stores, COUNT(DISTINCT w.w_warehouse_sk) AS number_of_warehouses FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN call_center cc ON ss.ss_store_sk = cc.cc_open_date_sk JOIN warehouse w ON ss.ss_store_sk = w.w_warehouse_sk WHERE dd.d_fy_year IN ('1904', '1902', '1903', '1912', '1901', '1907') AND ss.ss_store_sk IN ('8', '4', '7', '10', '1', '2') AND cc.cc_open_date_sk IN ('2451063', '2450952', '2450806') AND cc.cc_suite_number IN ('Suite 0', 'Suite 70', 'Suite U') AND w.w_warehouse_name IN ('Important issues liv', 'Bad cards must make.', 'Conventional childr', 'Doors canno') GROUP BY dd.d_year, dd.d_quarter_name, cc.cc_class ORDER BY dd.d_year, dd.d_quarter_name, cc.cc_class;
