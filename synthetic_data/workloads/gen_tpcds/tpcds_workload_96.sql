SELECT i.i_category, i.i_brand, COUNT(DISTINCT i.i_item_sk) AS num_items, SUM(i.i_current_price) AS total_current_price, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, COUNT(DISTINCT c.c_customer_sk) AS num_customers, AVG(c.c_birth_year) AS avg_customer_birth_year, r.r_reason_desc, COUNT(*) AS num_return_reasons FROM item i JOIN customer c ON i.i_manager_id = c.c_current_cdemo_sk LEFT JOIN reason r ON r.r_reason_desc IN ('Package was damaged', 'Did not like the make', 'Parts missing') WHERE i.i_rec_start_date >= '2020-01-01' AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date > CURRENT_DATE) GROUP BY i.i_category, i.i_brand, r.r_reason_desc ORDER BY i.i_category, i.i_brand, r.r_reason_desc;
SELECT c.c_birth_month, COUNT(DISTINCT ss.ss_customer_sk) AS total_customers_made_purchase, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_sales_price) AS avg_sale_amount, COUNT(DISTINCT cr.cr_returning_customer_sk) AS total_customers_made_return, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount FROM customer c LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_returning_customer_sk LEFT JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk AND cp.cp_catalog_page_number = 104 LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk LEFT JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk AND ws.web_open_date_sk = 2450628 WHERE c.c_birth_month IN (5, 6, 11) GROUP BY c.c_birth_month ORDER BY c.c_birth_month;
SELECT p.p_promo_name, p.p_start_date_sk, p.p_end_date_sk, p.p_purpose, COUNT(DISTINCT cc.cc_call_center_sk) AS number_of_call_centers_involved, SUM(inv.inv_quantity_on_hand) AS total_inventory, SUM(wr.wr_return_quantity) AS total_returns, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_net_loss) AS total_net_loss FROM promotion p LEFT JOIN inventory inv ON p.p_item_sk = inv.inv_item_sk LEFT JOIN web_returns wr ON p.p_item_sk = wr.wr_item_sk LEFT JOIN call_center cc ON wr.wr_returned_date_sk BETWEEN cc.cc_open_date_sk AND cc.cc_closed_date_sk WHERE p.p_purpose <> 'Unknown' AND p.p_end_date_sk <= 2450916 GROUP BY p.p_promo_name, p.p_start_date_sk, p.p_end_date_sk, p.p_purpose ORDER BY total_returns DESC, avg_return_amount_inc_tax DESC LIMIT 100;
SELECT ws.ws_item_sk, hd.hd_income_band_sk, AVG(ws.ws_net_profit) AS avg_net_profit_web_sales, SUM(cr.cr_net_loss) AS total_net_loss_catalog_returns FROM web_sales ws JOIN catalog_returns cr ON ws.ws_item_sk = cr.cr_item_sk AND ws.ws_order_number = cr.cr_order_number JOIN household_demographics hd ON (ws.ws_bill_hdemo_sk = hd.hd_demo_sk OR ws.ws_ship_hdemo_sk = hd.hd_demo_sk) AND (cr.cr_refunded_hdemo_sk = hd.hd_demo_sk OR cr.cr_returning_hdemo_sk = hd.hd_demo_sk) WHERE hd.hd_buy_potential IN ('0-500', '5001-10000', '>10000', '1001-5000') AND ws.ws_warehouse_sk IN (1, 2) AND cr.cr_warehouse_sk IN (1, 2) AND ws.ws_item_sk IN (8530, 14257, 11258, 15637, 6283) AND cr.cr_item_sk IN (9044, 17656, 9802) GROUP BY ws.ws_item_sk, hd.hd_income_band_sk;
SELECT i_brand, i_class, i_category, i_manufact, avg(i_current_price) AS avg_price, avg(i_wholesale_cost) AS avg_cost, sum(inv_quantity_on_hand) AS total_inventory, count(DISTINCT inv_item_sk) AS unique_items_stocked, count(DISTINCT wp_web_page_sk) AS web_pages_count, avg(wp_char_count) AS avg_web_page_char_count FROM item JOIN inventory ON i_item_sk = inv_item_sk JOIN web_page ON wp_web_page_id = i_item_id WHERE inv_date_sk = 2450815 AND i_formulation = '537582860saddle45401' AND wp_web_page_id IN ('AAAAAAAACAAAAAAA', 'AAAAAAAAHDAAAAAA', 'AAAAAAAABDAAAAAA', 'AAAAAAAACDAAAAAA', 'AAAAAAAAABAAAAAA') GROUP BY i_brand, i_class, i_category, i_manufact ORDER BY total_inventory DESC, avg_price DESC;
SELECT d_year, w_state AS warehouse_state, sm_type AS shipping_type, p_promo_name, COUNT(DISTINCT cc_call_center_sk) AS number_of_call_centers, SUM(inv_quantity_on_hand) AS total_inventory, AVG(w_warehouse_sq_ft) AS average_warehouse_size, MAX(p_cost) AS max_promotion_cost, MIN(p_cost) AS min_promotion_cost, AVG(p_cost) AS average_promotion_cost, SUM(CASE WHEN p_channel_demo = 'N' THEN p_cost ELSE 0 END) AS sum_cost_non_demo_promotions FROM date_dim JOIN inventory ON inv_date_sk = d_date_sk JOIN warehouse ON w_warehouse_sk = inv_warehouse_sk JOIN ship_mode ON w_zip = sm_ship_mode_id JOIN call_center ON cc_zip = w_zip LEFT JOIN promotion ON p_promo_sk = inv_item_sk WHERE d_year = 1998 AND w_warehouse_sq_ft IN (977787, 294242, 621234, 138504) AND w_zip = '35709' AND d_quarter_seq IN (24, 3) AND d_fy_week_seq IN (444, 401, 706, 517, 70) AND inv_item_sk IN (6008, 6322, 13964, 9541) AND p_channel_demo = 'N' GROUP BY d_year, warehouse_state, shipping_type, p_promo_name ORDER BY d_year, warehouse_state, shipping_type, p_promo_name;
SELECT d_year, sm_type, COUNT(DISTINCT inv_warehouse_sk) AS number_of_warehouses, SUM(inv_quantity_on_hand) AS total_quantity_on_hand, AVG(inv_quantity_on_hand) AS average_quantity_per_warehouse, MAX(inv_quantity_on_hand) AS max_quantity_in_warehouse, MIN(inv_quantity_on_hand) AS min_quantity_in_warehouse FROM inventory JOIN date_dim ON inv_date_sk = d_date_sk JOIN ship_mode ON sm_ship_mode_id = 'AAAAAAAAEAAAAAAA' WHERE d_year = 2023 AND d_day_name = 'Saturday' AND inv_warehouse_sk IN (1, 2) AND d_current_week = 'N' GROUP BY d_year, sm_type ORDER BY total_quantity_on_hand DESC, average_quantity_per_warehouse DESC LIMIT 100;
SELECT w_country, cr_returned_date_sk AS return_date_sk, i_category, COUNT(DISTINCT cr_order_number) AS total_returns, SUM(cr_return_quantity) AS total_returned_quantity, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN promotion p ON i.i_item_sk = p.p_item_sk AND p.p_discount_active = 'N' WHERE cr.cr_returning_hdemo_sk IN (7008, 2246, 3148, 584, 6843) GROUP BY w_country, return_date_sk, i_category ORDER BY total_net_loss DESC, total_returns DESC;
SELECT i.i_category, sm.sm_type, w.w_state, SUM(ws.ws_sales_price) AS total_sales, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(sr.sr_return_amt) AS total_returns, AVG(sr.sr_return_amt) AS avg_return_amt, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_tickets FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk LEFT JOIN store_returns sr ON ws.ws_item_sk = sr.sr_item_sk WHERE sm.sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') AND i.i_class IN ('loose stones', 'swimwear', 'semi-precious', 'maternity', 'camping') AND i.i_manager_id IN ('92', '83') AND w.w_street_name LIKE '%6th%' GROUP BY i.i_category, sm.sm_type, w.w_state ORDER BY total_sales DESC, total_returns DESC;
SELECT ca.ca_city, ca.ca_state, COUNT(DISTINCT ca.ca_address_sk) AS num_addresses, AVG(hd.hd_dep_count) AS avg_dependency_count, SUM(hd.hd_vehicle_count) AS total_vehicles, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT sm.sm_ship_mode_sk) AS num_ship_modes, COUNT(DISTINCT r.r_reason_sk) AS num_reasons, SUM(CASE WHEN cp.cp_department = 'Electronics' THEN 1 ELSE 0 END) AS num_electronics_pages, SUM(CASE WHEN sm.sm_type = 'OVERNIGHT' THEN 1 ELSE 0 END) AS overnight_shipments, AVG(CASE WHEN t.t_am_pm = 'PM' THEN t.t_hour END) AS avg_hour_pm FROM customer_address ca JOIN household_demographics hd ON ca.ca_address_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN ship_mode sm ON sm.sm_carrier = 'UPS' JOIN reason r ON r.r_reason_desc LIKE 'reason %' LEFT JOIN catalog_page cp ON cp.cp_department = ca.ca_city LEFT JOIN time_dim t ON t.t_shift = 'Evening' WHERE r.r_reason_sk IN ('9', '6', '11', '2') AND ib.ib_income_band_sk IN ('20', '6') AND hd.hd_buy_potential = 'Unknown' AND sm.sm_type IN ('LIBRARY', 'OVERNIGHT', 'NEXT DAY') GROUP BY ca.ca_city, ca.ca_state, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ca.ca_city, ca.ca_state;
SELECT d.d_year AS year, d.d_moy AS month, SUM(s.sr_return_amt_inc_tax) AS total_returns_amount, AVG(s.sr_return_amt_inc_tax) AS avg_returns_amount, COUNT(s.sr_ticket_number) AS return_count, SUM(i.inv_quantity_on_hand) AS total_inventory_quantity, AVG(i.inv_quantity_on_hand) AS avg_inventory_quantity FROM date_dim d LEFT JOIN store_returns s ON d.d_date_sk = s.sr_returned_date_sk LEFT JOIN inventory i ON d.d_date_sk = i.inv_date_sk WHERE d.d_year = 2023 GROUP BY d.d_year, d.d_moy ORDER BY d.d_year, d.d_moy;
SELECT c.c_customer_id, c.c_email_address, hd.hd_buy_potential, SUM(wr.wr_return_quantity) AS total_return_quantity, AVG(wr.wr_return_amt) AS avg_return_amount, COUNT(DISTINCT wr.wr_order_number) AS num_orders, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_return_ship_cost) AS total_shipping_cost, SUM(wr.wr_refunded_cash) AS total_refunded_cash, SUM(wr.wr_reversed_charge) AS total_reversed_charges, SUM(wr.wr_account_credit) AS total_account_credits, SUM(wr.wr_net_loss) AS total_net_loss FROM customer c JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk GROUP BY c.c_customer_id, c.c_email_address, hd.hd_buy_potential ORDER BY total_return_amount_inc_tax DESC LIMIT 100;
SELECT s.s_city, COUNT(DISTINCT s.s_store_sk) AS number_of_stores, SUM(s.s_number_employees) AS total_employees, SUM(s.s_floor_space) AS total_floor_space, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_sq_ft, COUNT(DISTINCT cp.cp_catalog_page_sk) AS number_of_catalog_pages FROM store s LEFT JOIN warehouse w ON s.s_city = w.w_city LEFT JOIN catalog_page cp ON cp.cp_catalog_page_number BETWEEN 80 AND 90 WHERE s.s_city IN ('Fairview', 'Midway') AND (s.s_closed_date_sk IS NULL OR s.s_closed_date_sk > CAST(to_char(CURRENT_DATE, 'J') AS INTEGER)) GROUP BY s.s_city ORDER BY s.s_city;
SELECT p.p_promo_id AS promotion_id, p.p_promo_name AS promotion_name, p.p_channel_dmail AS channel_direct_mail, p.p_channel_email AS channel_email, p.p_channel_catalog AS channel_catalog, p.p_channel_tv AS channel_tv, p.p_channel_radio AS channel_radio, p.p_channel_press AS channel_press, p.p_channel_event AS channel_event, p.p_channel_demo AS channel_demo, s.s_state AS store_state, SUM(sr.sr_return_amt_inc_tax) AS total_returns_incl_tax, SUM(sr.sr_return_quantity) AS total_returned_quantity, COUNT(sr.sr_ticket_number) AS total_return_transactions, AVG(sr.sr_return_amt) AS avg_return_amount, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_incl_tax FROM promotion p JOIN store_returns sr ON p.p_promo_sk = sr.sr_reason_sk JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN date_dim d ON sr.sr_returned_date_sk = d.d_date_sk WHERE d.d_fy_year = 2003 AND p.p_discount_active = 'Y' GROUP BY p.p_promo_id, p.p_promo_name, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo, s.s_state ORDER BY total_returns_incl_tax DESC, promotion_id;
SELECT ws.web_manager, ws.web_class, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_return_transactions, SUM(cr.cr_return_amt_inc_tax) AS total_catalog_return_amount_inc_tax, COUNT(DISTINCT p.p_promo_sk) AS total_promotions, SUM(p.p_cost) AS total_promotion_cost FROM web_site ws LEFT JOIN store_returns sr ON ws.web_site_sk = sr.sr_store_sk LEFT JOIN catalog_returns cr ON ws.web_site_sk = cr.cr_catalog_page_sk LEFT JOIN promotion p ON cr.cr_item_sk = p.p_item_sk AND cr.cr_returned_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk WHERE ws.web_manager = 'Jimmy Pope' AND (ws.web_zip = '35709' OR ws.web_zip = '31904') GROUP BY ws.web_manager, ws.web_class ORDER BY total_return_amount_inc_tax DESC, total_catalog_return_amount_inc_tax DESC;
SELECT c.c_first_name, c.c_last_name, c.c_birth_country, c.c_email_address, COUNT(sr.sr_return_quantity) AS total_returns, SUM(sr.sr_return_amt) AS total_return_amt, AVG(sr.sr_return_amt) AS avg_return_amt, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_return_ship_cost) AS total_ship_cost, SUM(sr.sr_net_loss) AS total_net_loss, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_carrier FROM customer c JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN income_band ib ON c.c_current_cdemo_sk = ib.ib_income_band_sk JOIN ship_mode sm ON sm.sm_ship_mode_id = 'AAAAAAAABBAAAAAA' WHERE c.c_preferred_cust_flag = 'Y' GROUP BY c.c_first_name, c.c_last_name, c.c_birth_country, c.c_email_address, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_carrier ORDER BY total_return_amt DESC;
SELECT ws.web_name, d.d_year, d.d_moy, COUNT(DISTINCT wp.wp_web_page_sk) AS total_pages, SUM(wp.wp_char_count) AS total_char_count, SUM(wp.wp_link_count) AS total_link_count, SUM(wp.wp_image_count) AS total_image_count, AVG(p.p_cost) AS average_promo_cost, SUM(CASE WHEN p.p_discount_active = 'Y' THEN p.p_cost ELSE 0 END) AS total_discounted_promo_cost, COUNT(DISTINCT c.c_customer_sk) AS total_customers, COUNT(DISTINCT CASE WHEN c.c_preferred_cust_flag = 'Y' THEN c.c_customer_sk ELSE NULL END) AS preferred_customers FROM web_site ws JOIN web_page wp ON wp.wp_customer_sk = ws.web_site_sk JOIN date_dim d ON wp.wp_access_date_sk = d.d_date_sk LEFT JOIN promotion p ON p.p_start_date_sk <= d.d_date_sk AND p.p_end_date_sk >= d.d_date_sk LEFT JOIN customer c ON c.c_customer_sk = wp.wp_customer_sk WHERE ws.web_manager IN ('John Isaacs', 'James Bernard') AND wp.wp_autogen_flag = 'N' AND c.c_birth_year = 1973 GROUP BY ws.web_name, d.d_year, d.d_moy ORDER BY ws.web_name, d.d_year, d.d_moy;
SELECT d_year, d_month_seq, cc_state, p_channel_tv, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_ticket_number) AS unique_tickets, SUM(ss_coupon_amt) AS total_coupon_amount_used, SUM(ss_net_paid_inc_tax) AS total_sales_with_tax, SUM(ss_net_profit) AS total_net_profit FROM date_dim JOIN store_sales ON d_date_sk = ss_sold_date_sk JOIN call_center ON cc_call_center_sk = ss_store_sk JOIN promotion ON p_promo_sk = ss_promo_sk WHERE d_year = 1999 AND p_channel_tv = 'Y' AND ss_addr_sk IN ('31017', '33096', '32929') AND ss_coupon_amt IN (65.92, 3048.43) AND (cc_state = 'CA' OR cc_state = 'NY') GROUP BY d_year, d_month_seq, cc_state, p_channel_tv ORDER BY d_year, d_month_seq, cc_state, p_channel_tv;
SELECT s.s_division_id AS store_division_id, s.s_division_name AS store_division_name, hd.hd_income_band_sk AS household_income_band, COUNT(DISTINCT ws.ws_order_number) AS total_web_sales, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, AVG(sr.sr_return_amt) AS average_return_amount FROM store s LEFT JOIN web_sales ws ON s.s_store_sk = ws.ws_ship_customer_sk LEFT JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk LEFT JOIN household_demographics hd ON (ws.ws_ship_hdemo_sk = hd.hd_demo_sk OR sr.sr_hdemo_sk = hd.hd_demo_sk) WHERE ws.ws_order_number IS NOT NULL OR sr.sr_ticket_number IS NOT NULL GROUP BY s.s_division_id, s.s_division_name, hd.hd_income_band_sk ORDER BY s.s_division_id, hd.hd_income_band_sk;
SELECT ca.ca_country, ca.ca_state, cp.cp_type, AVG(inv.inv_quantity_on_hand) AS avg_quantity_on_hand, SUM(wr.wr_return_quantity) AS total_returned_quantity, SUM(wr.wr_return_amt) AS total_return_amount, SUM(wr.wr_fee) AS total_return_fees, COUNT(DISTINCT wr.wr_returning_customer_sk) AS distinct_returning_customers FROM web_returns wr JOIN customer_address ca ON wr.wr_returning_addr_sk = ca.ca_address_sk JOIN catalog_page cp ON wr.wr_web_page_sk = cp.cp_catalog_page_sk JOIN inventory inv ON wr.wr_item_sk = inv.inv_item_sk AND wr.wr_returned_date_sk = inv.inv_date_sk WHERE ca.ca_country = 'United States' AND cp.cp_type IN ('bi-annual', 'monthly') AND wr.wr_returning_customer_sk IN ('48847', '59684', '67712', '64182', '84117') GROUP BY ca.ca_country, ca.ca_state, cp.cp_type ORDER BY ca.ca_state, cp.cp_type;
SELECT i.i_category, i.i_class, i.i_brand, sum(ss.ss_quantity) AS total_quantity_sold, avg(ss.ss_sales_price) AS average_sales_price, sum(ss.ss_net_profit) AS total_net_profit, count(DISTINCT ss.ss_ticket_number) AS number_of_transactions, sum(ss.ss_coupon_amt) AS total_coupon_amount, ib.ib_lower_bound, ib.ib_upper_bound, date_dim.d_year, date_dim.d_quarter_name, COUNT(DISTINCT case when ss.ss_coupon_amt > 0 THEN ss.ss_ticket_number END) AS transactions_with_coupons FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN date_dim ON ss.ss_sold_date_sk = date_dim.d_date_sk WHERE date_dim.d_year IN (2019, 2020) AND ib.ib_lower_bound >= 0 AND ib.ib_upper_bound <= 130000 GROUP BY i.i_category, i.i_class, i.i_brand, ib.ib_lower_bound, ib.ib_upper_bound, date_dim.d_year, date_dim.d_quarter_name ORDER BY total_net_profit DESC, total_quantity_sold DESC LIMIT 100;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_net_paid) AS total_sales_amount, AVG(cs.cs_sales_price) AS average_sales_amount_per_order, MAX(cs.cs_sales_price) AS max_sale_amount, AVG(cs.cs_ext_discount_amt) AS average_discount_amount, SUM(cs.cs_ext_tax) AS total_tax_collected, COUNT(DISTINCT cs.cs_bill_customer_sk) AS unique_customers FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk WHERE d.d_date BETWEEN '2023-01-01'::DATE AND '2023-12-31'::DATE AND cs.cs_list_price > 100 GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_sales_amount DESC, average_sales_amount_per_order DESC;
