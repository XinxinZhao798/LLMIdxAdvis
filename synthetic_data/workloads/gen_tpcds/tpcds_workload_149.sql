SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, SUM(cr.cr_return_quantity) AS total_catalog_return_quantity, SUM(cr.cr_return_amount) AS total_catalog_return_amt, AVG(cr.cr_return_amount) AS avg_catalog_return_amt, COUNT(cr.cr_return_amount) AS count_catalog_returns, AVG(cc.cc_tax_percentage) AS avg_call_center_tax_percentage, ws.web_site_id, ws.web_name, ws.web_city, ws.web_state, SUM(wr.wr_return_quantity) AS total_web_return_quantity, SUM(wr.wr_return_amt) AS total_web_return_amt, AVG(wr.wr_return_amt) AS avg_web_return_amt, COUNT(wr.wr_return_amt) AS count_web_returns, AVG(ws.web_tax_percentage) AS avg_web_tax_percentage FROM call_center cc LEFT JOIN catalog_returns cr ON cc.cc_call_center_sk = cr.cr_call_center_sk LEFT JOIN web_site ws ON cc.cc_company = ws.web_company_id LEFT JOIN web_returns wr ON ws.web_site_sk = wr.wr_web_page_sk WHERE (cr.cr_returning_hdemo_sk IN (1311, 6200, 1588, 925, 5366, 4174) OR cr.cr_returning_hdemo_sk IS NULL) AND (cr.cr_reason_sk = 16 OR cr.cr_reason_sk IS NULL) AND cc.cc_rec_start_date <= CURRENT_DATE AND (cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date > CURRENT_DATE) AND ws.web_rec_start_date <= CURRENT_DATE AND (ws.web_rec_end_date IS NULL OR ws.web_rec_end_date > CURRENT_DATE) GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, ws.web_site_id, ws.web_name, ws.web_city, ws.web_state ORDER BY total_catalog_return_amt DESC, total_web_return_amt DESC;
SELECT ws.web_name, d.d_year, d.d_quarter_name, i.i_category, SUM(cs_quantity) AS total_quantity_sold, SUM(cs_ext_sales_price) AS total_sales, AVG(cs_sales_price) AS avg_sales_price, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(wr_return_quantity) AS total_returned_quantity, SUM(wr_return_amt) AS total_return_amount, (SUM(cs_ext_sales_price) - SUM(cs_ext_discount_amt)) AS net_sales_after_discounts, (SUM(cs_ext_sales_price) - SUM(wr_return_amt)) AS net_sales_after_returns FROM web_site ws JOIN catalog_sales cs ON ws.web_site_sk = cs.cs_warehouse_sk JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk LEFT JOIN web_returns wr ON cs.cs_order_number = wr.wr_order_number AND cs.cs_item_sk = wr.wr_item_sk WHERE d.d_year = 2001 AND ws.web_zip IN ('35709', '31904') AND i.i_units IN ('Gross', 'Oz') AND d.d_current_day = 'N' GROUP BY ws.web_name, d.d_year, d.d_quarter_name, i.i_category ORDER BY total_sales DESC, net_sales_after_discounts DESC, net_sales_after_returns DESC;
SELECT cd.cd_gender, ib.ib_lower_bound AS income_lower_bound, ib.ib_upper_bound AS income_upper_bound, sm.sm_type AS shipping_type, COUNT(sr.sr_return_amt) AS total_returns, SUM(sr.sr_return_amt) AS total_value_of_returns, AVG(sr.sr_return_amt) AS average_return_value, SUM(sr.sr_return_quantity) AS total_quantity_returned FROM store_returns sr JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound JOIN ship_mode sm ON sm.sm_ship_mode_sk = sr.sr_item_sk WHERE sm.sm_type IN ('OVERNIGHT') AND cd.cd_gender IN ('M', 'F') GROUP BY cd.cd_gender, income_lower_bound, income_upper_bound, shipping_type ORDER BY total_value_of_returns DESC, total_returns DESC;
SELECT w.w_warehouse_name, w.w_city, w.w_state, w.w_country, d.d_year, d.d_quarter_name, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_quantity) AS total_web_quantity, AVG(ws.ws_sales_price) AS avg_web_sales_price, SUM(ws.ws_net_paid) AS total_web_net_paid, COUNT(DISTINCT ss.ss_ticket_number) AS total_store_sales, SUM(ss.ss_quantity) AS total_store_quantity, AVG(ss.ss_sales_price) AS avg_store_sales_price, SUM(ss.ss_net_paid) AS total_store_net_paid, SUM(CASE WHEN hd.hd_dep_count BETWEEN 3 AND 5 THEN 1 ELSE 0 END) AS households_with_3_to_5_dependents, SUM(CASE WHEN hd.hd_vehicle_count BETWEEN 1 AND 4 THEN 1 ELSE 0 END) AS households_with_1_to_4_vehicles FROM warehouse w LEFT JOIN web_sales ws ON w.w_warehouse_sk = ws.ws_warehouse_sk LEFT JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk LEFT JOIN household_demographics hd ON ws.ws_ship_hdemo_sk = hd.hd_demo_sk LEFT JOIN store_sales ss ON d.d_date_sk = ss.ss_sold_date_sk AND hd.hd_demo_sk = ss.ss_hdemo_sk WHERE w.w_city = 'Fairview' AND w.w_suite_number IN ('Suite P', 'Suite 0', 'Suite 80') AND w.w_street_type IN ('Avenue', 'Parkway', 'Drive') AND w.w_country = 'United States' AND hd.hd_dep_count IN (3, 4, 5) AND hd.hd_buy_potential IN ('5001-10000', 'Unknown', '501-1000') AND hd.hd_vehicle_count IN (1, 3, 4) AND d.d_following_holiday IN ('N', 'Y') AND d.d_last_dom IN ('2418672', '2418852', '2416539') AND d.d_month_seq IN (24, 151, 94) AND d.d_holiday IN ('N', 'Y') GROUP BY w.w_warehouse_name, w.w_city, w.w_state, w.w_country, d.d_year, d.d_quarter_name ORDER BY w.w_warehouse_name, d.d_year, d.d_quarter_name;
SELECT dd.d_year, dd.d_moy, sm.sm_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_net_paid) AS total_net_sales, AVG(cs.cs_net_paid) AS avg_net_sales_per_order, SUM(sr.sr_return_quantity) AS total_quantity_returned, SUM(sr.sr_net_loss) AS total_net_loss, AVG(sr.sr_net_loss) AS avg_net_loss_per_return, SUM(wr.wr_return_quantity) AS total_web_quantity_returned, SUM(wr.wr_net_loss) AS total_web_net_loss, AVG(wr.wr_net_loss) AS avg_web_net_loss_per_return, COUNT(DISTINCT hd.hd_demo_sk) AS unique_customers FROM date_dim dd LEFT JOIN catalog_sales cs ON dd.d_date_sk = cs.cs_sold_date_sk LEFT JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk LEFT JOIN web_returns wr ON dd.d_date_sk = wr.wr_returned_date_sk LEFT JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk WHERE dd.d_year = 2003 AND sm.sm_carrier IN ('ZOUROS', 'ALLIANCE', 'GREAT EASTERN') AND hd.hd_income_band_sk IN (10, 3, 16) AND hd.hd_buy_potential IN ('Unknown', '501-1000', '1001-5000') GROUP BY dd.d_year, dd.d_moy, sm.sm_type ORDER BY dd.d_year, dd.d_moy, sm.sm_type;
SELECT i.i_category_id, i.i_category, COUNT(DISTINCT sr.sr_item_sk) AS total_returned_items, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount FROM store_returns sr JOIN item i ON sr.sr_item_sk = i.i_item_sk JOIN web_page wp ON wp.wp_access_date_sk = sr.sr_returned_date_sk JOIN catalog_page cp ON sr.sr_returned_date_sk BETWEEN cp.cp_start_date_sk AND cp.cp_end_date_sk WHERE wp.wp_access_date_sk IN ('2452566', '2452648', '2452619', '2452639') AND i.i_category_id IN ('9', '10', '4') GROUP BY i.i_category_id, i.i_category ORDER BY total_return_amount DESC LIMIT 5;
SELECT sm.sm_type, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_wholesale_cost) AS avg_wholesale_cost, AVG(ws.ws_sales_price) AS avg_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk WHERE w.w_zip = '35709' AND ws.ws_web_site_sk IN (30, 17, 4, 15, 14, 2) AND sm.sm_ship_mode_sk IN (4, 9, 13, 10, 8, 20) GROUP BY sm.sm_type ORDER BY total_net_profit DESC;
SELECT d.d_year AS year, d.d_month_seq AS month_sequence, COUNT(DISTINCT ss.ss_store_sk) AS num_stores, SUM(ss.ss_quantity) AS total_items_sold, SUM(ss.ss_net_paid_inc_tax) AS total_sales_inc_tax, AVG(ss.ss_ext_discount_amt) AS average_discount, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_fee) AS average_return_fee, COUNT(DISTINCT cr.cr_call_center_sk) FILTER (WHERE cc.cc_class = 'small') AS num_small_class_call_centers, COUNT(DISTINCT cr.cr_call_center_sk) FILTER (WHERE cc.cc_class = 'medium') AS num_medium_class_call_centers, COUNT(DISTINCT cr.cr_call_center_sk) FILTER (WHERE cc.cc_class = 'large') AS num_large_class_call_centers FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk LEFT JOIN catalog_returns cr ON ss.ss_ticket_number = cr.cr_order_number LEFT JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk WHERE d.d_month_seq IS NOT NULL AND ss.ss_store_sk IS NOT NULL GROUP BY year, month_sequence ORDER BY year, month_sequence;
SELECT dd.d_month_seq, dd.d_quarter_seq, dd.d_year, cp.cp_type, COUNT(DISTINCT inv.inv_item_sk) AS low_stock_items, AVG(inv.inv_quantity_on_hand) AS avg_quantity_on_hand, MIN(inv.inv_quantity_on_hand) AS min_quantity_on_hand, MAX(inv.inv_quantity_on_hand) AS max_quantity_on_hand, COUNT(DISTINCT inv.inv_warehouse_sk) AS affected_warehouses FROM inventory inv JOIN date_dim dd ON inv.inv_date_sk = dd.d_date_sk JOIN catalog_page cp ON inv.inv_item_sk = cp.cp_catalog_page_sk WHERE inv.inv_quantity_on_hand < 750 AND dd.d_year = 2022 GROUP BY dd.d_month_seq, dd.d_quarter_seq, dd.d_year, cp.cp_type ORDER BY dd.d_year, dd.d_quarter_seq, dd.d_month_seq, cp.cp_type;
