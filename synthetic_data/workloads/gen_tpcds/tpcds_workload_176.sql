SELECT i.i_category, s.s_state, s.s_market_id, COUNT(DISTINCT i.i_item_sk) AS total_items, AVG(i.i_current_price) AS avg_price, SUM(i.i_wholesale_cost) AS total_wholesale_cost, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages, wp.wp_type, COUNT(DISTINCT wp.wp_customer_sk) AS total_customers_accessed FROM item i JOIN store s ON i.i_manufact_id = s.s_company_id JOIN web_page wp ON wp.wp_type = 'order' WHERE i.i_category IN ('Books', 'Sports', 'Women', 'Men') AND s.s_state = 'TN' AND s.s_market_id = '7' AND i.i_current_price BETWEEN 2.21 AND 81.80 AND (wp.wp_creation_date_sk BETWEEN '2450811' AND '2450813' OR wp.wp_creation_date_sk = '2450808') GROUP BY i.i_category, s.s_state, s.s_market_id, wp.wp_type ORDER BY total_items DESC, avg_price DESC, total_wholesale_cost DESC;
SELECT s.s_state, COUNT(sr.sr_ticket_number) AS total_returns_count, SUM(sr.sr_return_amt) AS total_returns_amount, AVG(sr.sr_return_amt) AS average_return_amount, AVG(w.w_warehouse_sq_ft) AS average_warehouse_sq_footage FROM store s JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk LEFT JOIN warehouse w ON s.s_state = w.w_state WHERE s.s_closed_date_sk IS NULL GROUP BY s.s_state ORDER BY s.s_state;
SELECT s.s_store_name, s.s_company_name, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_return_quantity) AS average_return_quantity, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_incl_tax, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_net_loss) AS total_net_loss, cd.cd_education_status, AVG(cd.cd_purchase_estimate) AS average_purchase_estimate, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages_involved, td.t_shift, SUM(CASE WHEN td.t_am_pm = 'PM' THEN 1 ELSE 0 END) AS returns_in_pm, SUM(CASE WHEN td.t_am_pm = 'AM' THEN 1 ELSE 0 END) AS returns_in_am FROM store s JOIN web_returns wr ON s.s_store_sk = wr.wr_returning_addr_sk JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk JOIN time_dim td ON wr.wr_returned_time_sk = td.t_time_sk WHERE s.s_tax_precentage BETWEEN 0.06 AND 0.08 AND s.s_company_name <> 'Unknown' AND wp.wp_type = 'feedback' AND wp.wp_rec_start_date > '1999-09-04' AND td.t_minute IN (50, 18) GROUP BY s.s_store_name, s.s_company_name, cd.cd_education_status, td.t_shift ORDER BY total_returns DESC, total_return_amount DESC;
SELECT ca.ca_state, i.i_category, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_ext_sales_price) AS total_sales, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(inv.inv_quantity_on_hand) AS total_inventory FROM catalog_sales cs JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk AND cs.cs_sold_date_sk = inv.inv_date_sk WHERE cs.cs_wholesale_cost != 26.15 AND i.i_item_sk IN (2, 27, 23, 43, 36, 38) AND inv.inv_date_sk = 2450815 GROUP BY ca.ca_state, i.i_category ORDER BY total_sales DESC, ca.ca_state, i.i_category;
SELECT cp.cp_department AS department, i.i_category AS category, i.i_class AS class, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, AVG(hd.hd_dep_count) AS average_dependents, AVG(hd.hd_vehicle_count) AS average_vehicles FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN catalog_page cp ON i.i_item_sk = cp.cp_catalog_page_sk JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE hd.hd_vehicle_count IN (0, 3) AND hd.hd_buy_potential IN ('>10000', '5001-10000', '501-1000', '0-500') AND cp.cp_start_date_sk <= ws.ws_sold_date_sk AND (cp.cp_end_date_sk IS NULL OR cp.cp_end_date_sk >= ws.ws_sold_date_sk) GROUP BY cp.cp_department, i.i_category, i.i_class ORDER BY total_net_profit DESC, total_orders DESC;
SELECT wp_type AS web_page_type, ca_country AS customer_country, COUNT(DISTINCT wp_web_page_sk) AS num_web_pages, AVG(wp_char_count) AS avg_char_count, SUM(wp_link_count) AS total_link_count, SUM(wp_image_count) AS total_image_count FROM web_page JOIN customer_address ON wp_customer_sk = ca_address_sk JOIN reason ON wp_web_page_sk = r_reason_sk WHERE ca_county IN ('Worcester County', 'Tooele County', 'Page County', 'Wabaunsee County') AND r_reason_desc IN ('reason 27', 'unauthorized purchase', 'Did not get it on time', 'Gift exchange') AND r_reason_sk IN (26, 15, 5) GROUP BY web_page_type, customer_country ORDER BY avg_char_count DESC, total_link_count DESC;
SELECT dd.d_year, dd.d_month_seq, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_profit) AS total_profit, COUNT(cs.cs_order_number) AS total_orders, SUM(sr.sr_return_amt) AS total_return_amt, COUNT(sr.sr_ticket_number) AS total_returns, (COUNT(sr.sr_ticket_number)::numeric / COUNT(cs.cs_order_number)) * 100 AS return_rate FROM customer_demographics cd JOIN customer c ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk LEFT JOIN store_returns sr ON cs.cs_order_number = sr.sr_ticket_number AND cs.cs_item_sk = sr.sr_item_sk WHERE dd.d_year = 2001 AND cs.cs_sales_price BETWEEN 50.00 AND 200.00 AND cd.cd_credit_rating = 'Good' GROUP BY dd.d_year, dd.d_month_seq, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY dd.d_year, dd.d_month_seq, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status;
SELECT w.w_warehouse_name, w.w_state, w.w_county, sm.sm_type, sm.sm_carrier, p.p_promo_name, p.p_channel_details, s.s_store_name, s.s_city, s.s_state, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_net_paid, AVG(ss.ss_net_profit) AS average_net_profit, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(wr.wr_return_quantity) AS total_return_quantity, SUM(wr.wr_net_loss) AS total_net_loss FROM warehouse w JOIN store_sales ss ON ss.ss_store_sk = w.w_warehouse_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = ss.ss_sold_date_sk LEFT JOIN web_returns wr ON wr.wr_item_sk = ss.ss_item_sk AND wr.wr_order_number = ss.ss_ticket_number WHERE w.w_county = 'Williamson County' AND w.w_street_name IN ('Ash Laurel', 'Wilson Elm', '6th') AND w.w_warehouse_name IN ('Bad cards must make.', 'Important issues liv', 'Doors canno') AND w.w_state = 'TN' AND wr.wr_web_page_sk IN ('18', '44', '3') AND wr.wr_returned_date_sk IN ('2451082', '2451321', '2452281') AND p.p_channel_event = 'N' AND p.p_channel_press = 'N' AND p.p_item_sk IN ('10297', '13006', '12968') AND p.p_promo_name LIKE '%cally%' OR p.p_promo_name LIKE '%able%' OR p.p_promo_name LIKE '%eing%' AND s.s_rec_start_date IN ('1997-03-13', '2001-03-13', '2000-03-13') AND s.s_closed_date_sk IN ('2451044', '2450910', '2451189') AND sm.sm_type IN ('NEXT DAY', 'TWO DAY', 'LIBRARY') AND sm.sm_carrier IN ('AIRBORNE', 'USPS', 'DHL') AND sm.sm_ship_mode_id IN ('AAAAAAAABBAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAAOAAAAAAA') AND ss.ss_store_sk IN ('10', '1', '7') AND ss.ss_net_profit IN ('182.58', '990.60', '525.80') AND ss.ss_ext_sales_price IN ('6976.75', '971.85', '10.15') GROUP BY w.w_warehouse_name, w.w_state, w.w_county, sm.sm_type, sm.sm_carrier, p.p_promo_name, p.p_channel_details, s.s_store_name, s.s_city, s.s_state ORDER BY total_net_paid DESC, average_net_profit DESC, total_net_loss ASC;
SELECT cc.cc_country, cc.cc_open_date_sk, i.i_category, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_paid_inc_tax) - SUM(cs.cs_net_paid) AS total_tax_collected, SUM(cs.cs_net_profit) AS total_net_profit, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_net_loss) AS total_net_loss FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number WHERE cc.cc_country = 'United States' AND cc.cc_open_date_sk IN ('2450952', '2450806', '2451063') GROUP BY ROLLUP(cc.cc_country, cc.cc_open_date_sk, i.i_category) ORDER BY cc.cc_country, cc.cc_open_date_sk, i.i_category;
SELECT s.s_store_name, s.s_city, s.s_state, p.p_promo_name, p.p_channel_details, SUM(wr.wr_return_amt) AS total_refund_amount, AVG(wr.wr_fee) AS average_fee, COUNT(DISTINCT wr.wr_returned_date_sk) AS unique_return_days, COUNT(*) AS total_returns, cd.cd_gender, cd.cd_education_status, COUNT(DISTINCT cd.cd_demo_sk) AS unique_customers FROM web_returns wr JOIN store s ON wr.wr_returning_addr_sk = s.s_store_sk JOIN promotion p ON wr.wr_item_sk = p.p_item_sk JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk WHERE s.s_tax_precentage = '0.01' AND s.s_gmt_offset = '-5.00' AND p.p_discount_active = 'N' AND wr.wr_refunded_cdemo_sk IN ('991117', '972552', '90047') AND wr.wr_returning_addr_sk IN ('33543', '41829') GROUP BY s.s_store_name, s.s_city, s.s_state, p.p_promo_name, p.p_channel_details, cd.cd_gender, cd.cd_education_status ORDER BY total_refund_amount DESC, unique_return_days DESC;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, COUNT(DISTINCT c.c_customer_sk) AS num_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid_inc_tax) AS total_sales_with_tax, SUM(wr.wr_return_quantity) AS total_quantity_returned, SUM(wr.wr_return_amt_inc_tax) AS total_returns_with_tax, SUM(ss.ss_net_profit) - SUM(wr.wr_net_loss) AS net_profit FROM customer_demographics cd JOIN customer c ON cd.cd_demo_sk = c.c_current_cdemo_sk LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk WHERE (ss.ss_sold_date_sk BETWEEN 20030101 AND 20031231 OR wr.wr_returned_date_sk BETWEEN 20030101 AND 20031231) GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating ORDER BY net_profit DESC;
SELECT d.d_year, d.d_quarter_name, SUM(ss_net_profit) AS total_profit, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(wr_return_amt) AS total_returns, COUNT(DISTINCT wr_refunded_customer_sk) AS unique_refunded_customers, COUNT(wr_return_quantity) AS total_returned_items FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk LEFT JOIN web_returns wr ON ss.ss_item_sk = wr.wr_item_sk AND ss.ss_ticket_number = wr.wr_order_number WHERE d.d_year = 2002 AND ss.ss_ext_discount_amt > 0 GROUP BY d.d_year, d.d_quarter_name ORDER BY d.d_year, d.d_quarter_name;
SELECT dd.d_year, dd.d_quarter_name, i.i_category, i.i_brand, s.s_store_name, s.s_state, s.s_country, COUNT(distinct ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, SUM(ws.ws_ext_sales_price) AS total_sales, AVG(ws.ws_sales_price) AS avg_sales_price, SUM(ws.ws_net_paid) AS net_paid, SUM(ws.ws_net_paid_inc_tax) AS net_paid_inc_tax, SUM(ws.ws_net_profit) AS net_profit FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN store s ON s.s_store_sk = ws.ws_bill_customer_sk WHERE s.s_country = 'United States' AND dd.d_year = 2001 AND i.i_category IN ('Shoes', 'Sports') AND i.i_rec_start_date BETWEEN '2000-01-01' AND '2001-12-31' AND s.s_tax_precentage IN ('0.06', '0.01', '0.11', '0.03', '0.08') GROUP BY dd.d_year, dd.d_quarter_name, i.i_category, i.i_brand, s.s_store_name, s.s_state, s.s_country ORDER BY total_sales DESC, net_profit DESC;
SELECT cd.cd_gender, ib.ib_lower_bound AS income_lower_bound, ib.ib_upper_bound AS income_upper_bound, sm.sm_type AS shipping_type, COUNT(sr.sr_return_amt) AS total_returns, SUM(sr.sr_return_amt) AS total_value_of_returns, AVG(sr.sr_return_amt) AS average_return_value, SUM(sr.sr_return_quantity) AS total_quantity_returned FROM store_returns sr JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound JOIN ship_mode sm ON sm.sm_ship_mode_sk = sr.sr_item_sk WHERE sm.sm_type IN ('OVERNIGHT') AND cd.cd_gender IN ('M', 'F') GROUP BY cd.cd_gender, income_lower_bound, income_upper_bound, shipping_type ORDER BY total_value_of_returns DESC, total_returns DESC;
SELECT ca.ca_state, sm.sm_type, ws.ws_web_site_sk, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN customer_address ca ON ws.ws_ship_addr_sk = ca.ca_address_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk WHERE ca.ca_state IN ('CT', 'SD') AND sm.sm_type = 'OVERNIGHT' AND ws.ws_web_site_sk IN (SELECT web_site_sk FROM web_site WHERE web_market_manager = 'John Doe') AND dd.d_year = 2023 AND dd.d_moy BETWEEN 1 AND 6 GROUP BY ca.ca_state, sm.sm_type, ws.ws_web_site_sk ORDER BY total_net_profit DESC;
SELECT sm.sm_type, sm.sm_carrier, COUNT(DISTINCT inv.inv_item_sk) AS distinct_items_shipped, SUM(inv.inv_quantity_on_hand) AS total_quantity_on_hand, AVG(inv.inv_quantity_on_hand) AS avg_quantity_per_item, s.s_store_name, s.s_company_name, s.s_city, s.s_state, COUNT(DISTINCT s.s_store_sk) AS number_of_stores, AVG(s.s_number_employees) AS avg_employees_per_store, SUM(s.s_floor_space) AS total_floor_space FROM ship_mode sm JOIN inventory inv ON sm.sm_ship_mode_sk = inv.inv_warehouse_sk JOIN store s ON inv.inv_warehouse_sk = s.s_store_sk WHERE inv.inv_item_sk = 11749 AND s.s_rec_end_date IS NULL GROUP BY sm.sm_type, sm.sm_carrier, s.s_store_name, s.s_company_name, s.s_city, s.s_state ORDER BY total_quantity_on_hand DESC, avg_employees_per_store DESC LIMIT 100;
SELECT ws.web_site_id, ws.web_name, td.t_shift, td.t_hour, COUNT(wr.wr_order_number) AS return_count, SUM(wr.wr_return_quantity) AS total_return_quantity, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amt_inc_tax, SUM(wr.wr_return_amt_inc_tax) AS sum_return_amt_inc_tax, SUM(wr.wr_fee) AS total_fee, SUM(wr.wr_return_ship_cost) AS total_return_ship_cost, SUM(wr.wr_net_loss) AS total_net_loss FROM web_returns wr JOIN time_dim td ON wr.wr_returned_time_sk = td.t_time_sk JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk WHERE wr.wr_return_amt_inc_tax >= 100.00 AND td.t_shift = 'Evening' GROUP BY ws.web_site_id, ws.web_name, td.t_shift, td.t_hour ORDER BY ws.web_site_id, td.t_hour;
SELECT st.s_store_name AS store_name, SUM(sales.ss_net_paid) AS total_sales, AVG(sales.ss_quantity) AS average_quantity_sold, COUNT(DISTINCT customer.c_customer_sk) AS unique_customers, cd.cd_education_status AS education_status, cd.cd_gender AS gender, COUNT(promo.p_promo_sk) AS promotion_count, AVG(promo.p_cost) AS average_promotion_cost FROM store_sales sales JOIN store st ON sales.ss_store_sk = st.s_store_sk JOIN customer ON sales.ss_customer_sk = customer.c_customer_sk JOIN customer_demographics cd ON customer.c_current_cdemo_sk = cd.cd_demo_sk JOIN promotion promo ON sales.ss_promo_sk = promo.p_promo_sk WHERE st.s_hours IN ('8AM-12AM', '8AM-4PM') AND cd.cd_education_status IN ('Unknown', 'Advanced Degree', '2 yr Degree', 'College') AND cd.cd_gender IN ('M', 'F') AND sales.ss_sold_date_sk BETWEEN promo.p_start_date_sk AND promo.p_end_date_sk GROUP BY st.s_store_name, cd.cd_education_status, cd.cd_gender ORDER BY total_sales DESC, average_quantity_sold DESC;
SELECT i.i_category AS item_category, s.s_state AS store_state, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales, AVG(ss.ss_net_paid_inc_tax) AS avg_sale_amount, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages, SUM(wp.wp_image_count) AS total_images, AVG(wp.wp_image_count) AS avg_images_per_page FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number LEFT JOIN web_page wp ON ss.ss_customer_sk = wp.wp_customer_sk WHERE s.s_state IN ('CA', 'TX', 'NY') AND i.i_category IN ('Electronics', 'Home Appliances', 'Books') AND ss.ss_sold_date_sk BETWEEN 20020101 AND 20021231 AND (wp.wp_image_count IS NULL OR wp.wp_image_count >= 3) GROUP BY item_category, store_state ORDER BY total_sales DESC, total_return_amount DESC;
SELECT cp.cp_department, r.r_reason_desc, COUNT(DISTINCT cr.cr_order_number) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_quantity) AS avg_return_quantity, SUM(cr.cr_return_quantity) AS total_return_quantity, AVG(cr.cr_net_loss) AS avg_net_loss, SUM(cr.cr_net_loss) AS total_net_loss, AVG(ws.ws_net_paid_inc_ship_tax) AS avg_sale_amount_inc_ship_tax, SUM(ws.ws_net_paid_inc_ship_tax) AS total_sale_amount_inc_ship_tax FROM catalog_returns cr JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN web_sales ws ON cr.cr_item_sk = ws.ws_item_sk AND cr.cr_order_number = ws.ws_order_number JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk WHERE cp.cp_start_date_sk IS NOT NULL AND cp.cp_end_date_sk IS NOT NULL AND i.i_size IN ('large', 'petite', 'N/A') AND hd.hd_dep_count IN (6, 2, 0) AND hd.hd_income_band_sk IN (15, 14, 17, 18, 8) AND cr.cr_return_ship_cost IN (1215.68, 5.50, 311.58, 319.00, 3656.16, 1740.04) AND ws.ws_net_paid_inc_ship_tax = 1414.78 AND i.i_formulation IN ('ivory457370549352452', '77416linen1913860202', '32linen2899537977429', '61439655670steel4120') GROUP BY cp.cp_department, r.r_reason_desc ORDER BY total_return_amount DESC, avg_return_amount DESC, total_returns DESC;
SELECT dd.d_year, dd.d_quarter_name, SUM(cs.cs_quantity) AS total_catalog_quantity, AVG(cs.cs_sales_price) AS average_catalog_sales_price, SUM(cs.cs_net_profit) AS total_catalog_net_profit, SUM(ws.ws_quantity) AS total_web_quantity, AVG(ws.ws_sales_price) AS average_web_sales_price, SUM(ws.ws_net_profit) AS total_web_net_profit, SUM(cs.cs_quantity) + SUM(ws.ws_quantity) AS total_combined_quantity, AVG(cs.cs_sales_price * cs.cs_quantity + ws.ws_sales_price * ws.ws_quantity) / AVG(cs.cs_quantity + ws.ws_quantity) AS average_combined_sales_price, SUM(cs.cs_net_profit) + SUM(ws.ws_net_profit) AS total_combined_net_profit FROM date_dim dd LEFT JOIN catalog_sales cs ON dd.d_date_sk = cs.cs_sold_date_sk LEFT JOIN web_sales ws ON dd.d_date_sk = ws.ws_sold_date_sk WHERE dd.d_year = 2001 AND dd.d_current_quarter = 'N' GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT cp.cp_department, sm.sm_type, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_net_profit, AVG(cs.cs_net_profit) AS average_net_profit, SUM(wr.wr_return_quantity) AS total_return_quantity, SUM(wr.wr_net_loss) AS total_net_loss FROM catalog_sales cs JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number WHERE cp.cp_type IN ('quarterly', 'bi-annual', 'monthly') AND cs.cs_ext_tax IN (10.31, 370.42, 9.07) GROUP BY cp.cp_department, sm.sm_type ORDER BY total_net_profit DESC, total_net_loss ASC;
SELECT ca.ca_state, cd.cd_education_status, COUNT(DISTINCT c.c_customer_sk) AS total_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(cd.cd_dep_count) AS total_dependents, SUM(cd.cd_dep_employed_count) AS total_employed_dependents, SUM(cd.cd_dep_college_count) AS total_college_dependents, AVG(hd.hd_income_band_sk) AS avg_income_band, AVG(hd.hd_vehicle_count) AS avg_vehicle_count FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE ca.ca_state IS NOT NULL AND cd.cd_education_status IS NOT NULL GROUP BY ca.ca_state, cd.cd_education_status ORDER BY ca.ca_state, cd.cd_education_status;
SELECT dd.d_year, dd.d_moy, sm.sm_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_net_paid) AS total_net_sales, AVG(cs.cs_net_paid) AS avg_net_sales_per_order, SUM(sr.sr_return_quantity) AS total_quantity_returned, SUM(sr.sr_net_loss) AS total_net_loss, AVG(sr.sr_net_loss) AS avg_net_loss_per_return, SUM(wr.wr_return_quantity) AS total_web_quantity_returned, SUM(wr.wr_net_loss) AS total_web_net_loss, AVG(wr.wr_net_loss) AS avg_web_net_loss_per_return, COUNT(DISTINCT hd.hd_demo_sk) AS unique_customers FROM date_dim dd LEFT JOIN catalog_sales cs ON dd.d_date_sk = cs.cs_sold_date_sk LEFT JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk LEFT JOIN web_returns wr ON dd.d_date_sk = wr.wr_returned_date_sk LEFT JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk WHERE dd.d_year = 2003 AND sm.sm_carrier IN ('ZOUROS', 'ALLIANCE', 'GREAT EASTERN') AND hd.hd_income_band_sk IN (10, 3, 16) AND hd.hd_buy_potential IN ('Unknown', '501-1000', '1001-5000') GROUP BY dd.d_year, dd.d_moy, sm.sm_type ORDER BY dd.d_year, dd.d_moy, sm.sm_type;
SELECT dd.d_year, dd.d_quarter_name, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, COUNT(DISTINCT cc.cc_call_center_sk) AS participating_call_centers, SUM(ss.ss_net_paid_inc_tax) AS total_revenue_including_tax, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN call_center cc ON cc.cc_mkt_id::integer = ss.ss_store_sk JOIN catalog_page cp ON ss.ss_sold_date_sk BETWEEN cp.cp_start_date_sk AND cp.cp_end_date_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk WHERE dd.d_year = 2001 AND cc.cc_class = 'small' AND cd.cd_credit_rating = 'Good' AND (cp.cp_type = 'monthly' OR cp.cp_type = 'bi-annual') AND (cc.cc_street_type = 'Way' OR cc.cc_street_type = 'RD' OR cc.cc_street_type = 'Boulevard') AND c.c_last_review_date_sk IN ('2452332', '2452464', '2452647', '2452396', '2452311') AND cd.cd_demo_sk IN ('20368', '16978', '19750', '17504') GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT i.i_item_id, i.i_category, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_sales_price) AS avg_sales_price, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_net_profit) AS avg_net_profit, COUNT(DISTINCT w.w_warehouse_sk) AS number_of_warehouses_used FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk WHERE i.i_category IN ('Electronics', 'Clothing') AND c.c_email_address LIKE '%@%' AND cs.cs_sold_date_sk BETWEEN 20000101 AND 20001231 GROUP BY i.i_item_id, i.i_category ORDER BY total_sales DESC, avg_sales_price DESC LIMIT 10;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, AVG(cd.cd_dep_count) AS avg_dependents, AVG(cd.cd_dep_employed_count) AS avg_employed_dependents, AVG(cd.cd_dep_college_count) AS avg_college_dependents, COUNT(DISTINCT sr.sr_customer_sk) AS num_returning_customers, SUM(sr.sr_return_quantity) AS total_returned_quantity, SUM(sr.sr_return_amt) AS total_returned_amount, SUM(sr.sr_return_amt_inc_tax) AS total_returned_amount_inc_tax, AVG(sr.sr_return_amt) AS avg_return_amount, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, MAX(sr.sr_return_amt_inc_tax) AS max_return_amount_inc_tax, MIN(sr.sr_return_amt_inc_tax) AS min_return_amount_inc_tax, td.t_shift, COUNT(DISTINCT wp.wp_web_page_sk) AS num_web_pages, SUM(wp.wp_char_count) AS total_char_count FROM customer_demographics cd JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk JOIN time_dim td ON sr.sr_return_time_sk = td.t_time_sk LEFT JOIN web_page wp ON cd.cd_demo_sk = wp.wp_customer_sk WHERE cd.cd_gender = 'M' AND sr.sr_return_amt_inc_tax BETWEEN 8.31 AND 5055.81 AND wp.wp_url LIKE 'http://www.foo.com%' AND wp.wp_char_count IN (5676, 3034) GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, td.t_shift ORDER BY total_returned_amount_inc_tax DESC, avg_dependents DESC LIMIT 100;
SELECT st.s_store_name, wh.w_warehouse_name, pm.p_promo_name, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_customers_returned, SUM(cr.cr_fee) AS total_fees_collected, SUM(cr.cr_return_amt_inc_tax) AS total_return_with_tax, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN store st ON cr.cr_returning_addr_sk = st.s_store_sk JOIN warehouse wh ON cr.cr_warehouse_sk = wh.w_warehouse_sk JOIN promotion pm ON cr.cr_item_sk = pm.p_item_sk WHERE cr.cr_returned_date_sk IS NOT NULL AND st.s_hours IN ('8AM-12AM', '8AM-4PM') AND wh.w_county = 'Williamson County' AND wh.w_gmt_offset = '-5.00' AND pm.p_channel_tv = 'N' AND cr.cr_fee IN ('50.79', '65.23', '83.26', '68.14') AND cr.cr_returning_hdemo_sk IN ('6329', '1804', '2496') GROUP BY st.s_store_name, wh.w_warehouse_name, pm.p_promo_name ORDER BY total_returned_quantity DESC, average_return_amount DESC, unique_customers_returned DESC;
SELECT w_state, COUNT(DISTINCT c_customer_sk) AS number_of_customers, AVG(inv_quantity_on_hand) AS average_inventory, SUM(case when c_preferred_cust_flag = 'Y' then 1 else 0 end) AS preferred_customer_count, MAX(wp_link_count) AS max_webpage_link_count, MIN(web_tax_percentage) AS min_tax_percentage FROM customer JOIN warehouse ON c_current_addr_sk = w_warehouse_sk JOIN inventory ON inv_warehouse_sk = w_warehouse_sk JOIN web_page ON wp_customer_sk = c_customer_sk JOIN web_site ON wp_web_page_sk = web_site_sk AND web_class <> 'Unknown' WHERE web_close_date_sk IN ('2446944', '2446978', '2447046') GROUP BY w_state ORDER BY number_of_customers DESC, average_inventory DESC;
