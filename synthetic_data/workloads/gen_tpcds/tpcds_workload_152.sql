SELECT d_year, s_state, COUNT(DISTINCT cr_order_number) AS total_returns, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_quantity) AS avg_return_quantity, SUM(cr_net_loss) AS total_net_loss, COUNT(DISTINCT hd_demo_sk) AS unique_customers_returning, AVG(w_warehouse_sq_ft) AS avg_warehouse_size, SUM(wp_image_count) AS total_images_on_web_pages FROM catalog_returns JOIN date_dim ON catalog_returns.cr_returned_date_sk = date_dim.d_date_sk JOIN store ON store.s_store_sk = catalog_returns.cr_warehouse_sk JOIN household_demographics ON household_demographics.hd_demo_sk = catalog_returns.cr_returning_hdemo_sk JOIN warehouse ON warehouse.w_warehouse_sk = catalog_returns.cr_warehouse_sk JOIN web_page ON web_page.wp_web_page_sk = catalog_returns.cr_catalog_page_sk WHERE web_page.wp_web_page_id IN ('AAAAAAAAJBAAAAAA', 'AAAAAAAANAAAAAAA', 'AAAAAAAAGBAAAAAA') AND web_page.wp_image_count IN (5, 6, 3) AND store.s_geography_class = 'Unknown' AND store.s_store_sk IN (2, 1, 3) AND store.s_gmt_offset = '-5.00' AND store.s_rec_end_date IN ('1999-03-13', '2000-03-12', '2001-03-12') AND date_dim.d_first_dom IN (2419007, 2415690, 2416481) AND date_dim.d_dom IN (16, 4, 9) AND warehouse.w_warehouse_sq_ft IN (294242, 621234, 138504) AND warehouse.w_street_name IN ('Wilson Elm', 'Ash Laurel', 'View First') AND warehouse.w_zip = '35709' AND warehouse.w_warehouse_sk IN (1, 2, 5) AND household_demographics.hd_buy_potential IN ('501-1000', '0-500', '5001-10000') AND household_demographics.hd_vehicle_count IN (4, 3, 0) AND catalog_returns.cr_item_sk IN (16927, 16472, 1372) AND catalog_returns.cr_catalog_page_sk IN (402, 110, 207) AND catalog_returns.cr_refunded_customer_sk IN (57217, 356, 4491) AND catalog_returns.cr_returning_customer_sk IN (45137, 1961, 8472) GROUP BY d_year, s_state ORDER BY d_year, s_state;
SELECT cc.cc_name, i.i_category, cd.cd_education_status, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN call_center cc ON cc.cc_gmt_offset = '-5.00' JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk WHERE i.i_units = 'Pallet' AND c.c_birth_day IN (3, 20) AND cd.cd_education_status IN ('2 yr Degree', 'Advanced Degree', 'Secondary', 'College') AND ws.ws_sold_date_sk IS NOT NULL GROUP BY cc.cc_name, i.i_category, cd.cd_education_status ORDER BY total_net_profit DESC, total_orders DESC;
SELECT s.s_state, s.s_city, ca.ca_zip, COUNT(DISTINCT p.p_promo_sk) AS num_promotions, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(s.s_number_employees) AS avg_num_employees, AVG(s.s_floor_space) AS avg_floor_space, SUM(CASE WHEN s.s_tax_precentage > 0 THEN 1 ELSE 0 END) AS stores_with_tax FROM store s LEFT JOIN inventory inv ON s.s_store_sk = inv.inv_warehouse_sk LEFT JOIN customer_address ca ON s.s_zip = ca.ca_zip LEFT JOIN promotion p ON p.p_start_date_sk <= inv.inv_date_sk AND p.p_end_date_sk >= inv.inv_date_sk WHERE s.s_state = 'TN' AND (s.s_city = 'Fairview' OR s.s_city = 'Midway') AND ca.ca_street_name IN ('Oak 4th', '13th Mill', 'Railroad 1st') AND inv.inv_item_sk IN ('15379', '8284', '9997', '14116') GROUP BY s.s_state, s.s_city, ca.ca_zip ORDER BY s.s_state, s.s_city, ca.ca_zip;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, SUM(ss.ss_net_paid_inc_tax) AS total_sales_including_tax, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customer_count, COUNT(DISTINCT CASE WHEN c.c_preferred_cust_flag = 'Y' THEN ss.ss_customer_sk END) AS preferred_customer_count, SUM(sr.sr_return_amt_inc_tax) AS total_returns_including_tax, COUNT(DISTINCT sr.sr_customer_sk) AS total_return_customers FROM call_center cc LEFT JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk LEFT JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk WHERE cc.cc_rec_start_date > '1998-01-01' AND cc.cc_sq_ft = '1138' GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_sales_including_tax DESC;
SELECT i.i_category, i.i_class, i.i_brand, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(wr.wr_return_quantity) AS total_quantity_returned, SUM(wr.wr_return_amt) AS total_return_amt, AVG(wr.wr_fee) AS avg_return_fee, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN cs.cs_net_paid ELSE 0 END) AS preferred_customer_sales, COUNT(DISTINCT CASE WHEN c.c_preferred_cust_flag = 'Y' THEN c.c_customer_sk ELSE NULL END) AS preferred_customer_count FROM item i JOIN catalog_sales cs ON i.i_item_sk = cs.cs_item_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk GROUP BY i.i_category, i.i_class, i.i_brand ORDER BY total_net_paid DESC, total_return_amt DESC, avg_sales_price DESC LIMIT 100;
