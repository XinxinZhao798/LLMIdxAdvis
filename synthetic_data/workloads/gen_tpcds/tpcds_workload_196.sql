SELECT dd.d_year, dd.d_quarter_name, SUM(i.inv_quantity_on_hand) AS total_quantity_on_hand, AVG(i.inv_quantity_on_hand) AS avg_quantity_on_hand, COUNT(DISTINCT i.inv_warehouse_sk) AS number_of_warehouses, COUNT(DISTINCT i.inv_item_sk) AS number_of_items, SUM(CASE WHEN dd.d_holiday = 'Y' THEN i.inv_quantity_on_hand ELSE 0 END) AS holiday_stock, SUM(CASE WHEN dd.d_weekend = 'Y' THEN i.inv_quantity_on_hand ELSE 0 END) AS weekend_stock, r.r_reason_desc, COUNT(*) FILTER (WHERE r.r_reason_sk IN (33, 17, 35, 12)) AS count_reasons FROM inventory i JOIN date_dim dd ON i.inv_date_sk = dd.d_date_sk LEFT JOIN reason r ON r.r_reason_sk IN (33, 17, 35, 12) WHERE dd.d_year = 2023 GROUP BY dd.d_year, dd.d_quarter_name, r.r_reason_desc ORDER BY dd.d_year, dd.d_quarter_name, r.r_reason_desc;
SELECT ca_state, ca_city, ca_country, EXTRACT(YEAR FROM TO_TIMESTAMP(t_time)) AS sale_year, COUNT(DISTINCT w_warehouse_sk) AS number_of_warehouses, SUM(w_warehouse_sq_ft) AS total_warehouse_area, AVG(w_warehouse_sq_ft) AS avg_warehouse_area, COUNT(DISTINCT ca_address_sk) AS number_of_customers, AVG(ca_gmt_offset) AS avg_gmt_offset FROM customer_address JOIN warehouse ON customer_address.ca_state = warehouse.w_state JOIN time_dim ON (warehouse.w_gmt_offset = -5 OR warehouse.w_street_name IN ('Ash Laurel', '6th', 'Wilson Elm', 'View First')) WHERE ca_country = 'United States' AND t_hour BETWEEN 8 AND 17 AND EXTRACT(ISODOW FROM TO_TIMESTAMP(t_time)) < 6 GROUP BY ca_state, ca_city, ca_country, sale_year ORDER BY ca_state, ca_city, sale_year;
SELECT s.s_city, sm.sm_type, COUNT(sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, SUM(sr.sr_return_amt) AS total_returned_amount, AVG(sr.sr_return_amt) AS average_returned_amount, SUM(sr.sr_return_tax) AS total_returned_tax, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN ship_mode sm ON sr.sr_reason_sk = sm.sm_ship_mode_sk WHERE s.s_city IN ('Midway', 'Fairview') AND sm.sm_type = 'LIBRARY' AND sr.sr_returned_date_sk BETWEEN 20180101 AND 20181231 GROUP BY s.s_city, sm.sm_type ORDER BY s.s_city, sm.sm_type;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, cc.cc_tax_percentage, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amt_inc_tax, SUM(wr.wr_return_amt) AS total_return_amt, SUM(wr.wr_return_tax) AS total_return_tax, COUNT(DISTINCT wr.wr_returning_customer_sk) AS distinct_returning_customers FROM web_returns wr JOIN customer c ON wr.wr_returning_customer_sk = c.c_customer_sk JOIN call_center cc ON cc.cc_city = c.c_login JOIN catalog_page cp ON wr.wr_web_page_sk = cp.cp_catalog_page_sk WHERE cp.cp_start_date_sk BETWEEN 2451088 AND 2451510 AND wr.wr_return_amt > 0 AND cc.cc_tax_percentage IS NOT NULL GROUP BY cc.cc_name, cc.cc_city, cc.cc_state, cc.cc_tax_percentage ORDER BY total_return_amt DESC, avg_return_amt_inc_tax DESC;
SELECT ib.ib_lower_bound, ib.ib_upper_bound, cc.cc_state, d.d_year, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_ext_discount_amt) AS average_discount, COUNT(DISTINCT cs.cs_order_number) AS total_orders FROM catalog_sales cs JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN income_band ib ON cs.cs_bill_customer_sk = ib.ib_income_band_sk JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk WHERE d.d_year = 2003 AND ib.ib_upper_bound IN (40000, 90000, 100000, 20000, 140000, 180000) AND cc.cc_state = 'TN' GROUP BY ib.ib_lower_bound, ib.ib_upper_bound, cc.cc_state, d.d_year ORDER BY ib.ib_lower_bound, total_sales DESC;
SELECT t.t_shift, ib.ib_income_band_sk, COUNT(DISTINCT ws.web_site_sk) AS total_websites, AVG(ws.web_tax_percentage) AS avg_tax_percentage, SUM(CASE WHEN ws.web_class = 'Unknown' THEN 1 ELSE 0 END) AS unknown_class_count, MIN(ib.ib_lower_bound) AS min_income_lower_bound, MAX(ib.ib_upper_bound) AS max_income_upper_bound FROM time_dim t JOIN web_site ws ON t.t_time_sk = ws.web_open_date_sk LEFT JOIN income_band ib ON ws.web_mkt_id = ib.ib_income_band_sk WHERE t.t_time_sk IN (1002, 2003, 4384, 955, 433, 1796) AND ws.web_company_id IN (5, 2, 1) AND ws.web_class != 'Unknown' GROUP BY t.t_shift, ib.ib_income_band_sk ORDER BY t.t_shift, ib.ib_income_band_sk;
SELECT cc.cc_division_name, COUNT(DISTINCT cc.cc_call_center_sk) AS num_call_centers, SUM(cc.cc_employees) AS total_employees, AVG(cc.cc_employees) AS avg_employees, SUM(cc.cc_sq_ft) AS total_square_footage, AVG(cc.cc_sq_ft) AS avg_square_footage, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages, AVG(cp.cp_catalog_number) AS avg_catalog_number, COUNT(DISTINCT r.r_reason_sk) AS num_reasons, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses, SUM(w.w_warehouse_sq_ft) AS total_warehouse_square_footage, AVG(ib.ib_lower_bound) AS avg_income_band_lower_bound, AVG(ib.ib_upper_bound) AS avg_income_band_upper_bound FROM call_center cc LEFT JOIN catalog_page cp ON cc.cc_call_center_sk = cp.cp_catalog_page_sk LEFT JOIN reason r ON cc.cc_call_center_sk = r.r_reason_sk LEFT JOIN warehouse w ON cc.cc_call_center_sk = w.w_warehouse_sk LEFT JOIN income_band ib ON cc.cc_call_center_sk = ib.ib_income_band_sk WHERE cc.cc_division_name IN ('ese', 'ought') GROUP BY cc.cc_division_name ORDER BY cc.cc_division_name;
SELECT cp.cp_department, i.i_category, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(CASE WHEN sr.sr_return_amt > 0 THEN sr.sr_return_amt_inc_tax ELSE 0 END) AS total_return_amount_incl_tax, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_net_loss) AS total_net_loss, t.t_shift AS return_shift, EXTRACT(HOUR FROM TIME '00:00' + sr_return_time_sk * INTERVAL '1 second') AS return_hour FROM store_returns sr JOIN item i ON sr.sr_item_sk = i.i_item_sk JOIN catalog_page cp ON i.i_category_id = cp.cp_catalog_number JOIN time_dim t ON sr.sr_return_time_sk = t.t_time_sk WHERE sr.sr_addr_sk IN (17337, 36342) GROUP BY cp.cp_department, i.i_category, t.t_shift, return_hour ORDER BY total_returns DESC, total_returned_quantity DESC, average_return_amount DESC, total_return_amount_incl_tax DESC, total_fees DESC, total_net_loss DESC;
SELECT wp.wp_type, sm.sm_type, COUNT(DISTINCT wr.wr_refunded_customer_sk) AS unique_customers, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amt_inc_tax, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_net_loss) AS total_net_loss FROM web_returns wr JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk JOIN ship_mode sm ON wr.wr_returning_addr_sk = sm.sm_ship_mode_sk WHERE wp.wp_type IN ('feedback', 'order', 'general') AND sm.sm_type = 'TWO DAY' AND wr.wr_returning_addr_sk IN ('28100', '12237', '16942', '45981', '17051', '17924') AND wr.wr_refunded_customer_sk IN ('91486', '46332', '17456', '11868', '724', '87845') GROUP BY wp.wp_type, sm.sm_type;
SELECT p.p_promo_name, COUNT(DISTINCT sr.sr_customer_sk) AS number_of_customers, COUNT(sr.sr_ticket_number) AS number_of_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, SUM(sr.sr_return_amt) AS total_return_amount, AVG(hd.hd_vehicle_count) AS avg_vehicles_per_household, ib.ib_lower_bound AS income_band_lower_bound, ib.ib_upper_bound AS income_band_upper_bound, COUNT(DISTINCT cd.cd_demo_sk) AS number_of_unique_customers_demographics, SUM(CASE WHEN cd.cd_gender = 'M' THEN 1 ELSE 0 END) AS male_customer_count, SUM(CASE WHEN cd.cd_gender = 'F' THEN 1 ELSE 0 END) AS female_customer_count, SUM(CASE WHEN cd.cd_credit_rating = 'Low Risk' THEN 1 ELSE 0 END) AS low_risk_credit_customers, SUM(CASE WHEN cd.cd_credit_rating = 'High Risk' THEN 1 ELSE 0 END) AS high_risk_credit_customers FROM store_returns sr JOIN promotion p ON sr.sr_reason_sk = p.p_promo_sk AND p.p_channel_catalog = 'N' LEFT JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk LEFT JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk LEFT JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE p.p_purpose = 'Unknown' AND ib.ib_income_band_sk IN (19, 7, 13, 8, 15, 10) AND sr.sr_customer_sk IN (77634, 47097) AND cd.cd_credit_rating IN ('Low Risk', 'High Risk', 'Unknown') GROUP BY p.p_promo_name, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_return_amount DESC;
SELECT ca.ca_state AS customer_state, cp.cp_department AS department, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(cr.cr_item_sk) AS total_return_count, SUM(cr.cr_net_loss) AS total_net_loss, SUM(p.p_cost) AS total_promotion_cost FROM catalog_returns cr JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN promotion p ON cp.cp_catalog_page_sk = p.p_item_sk WHERE cp.cp_department IN ('Electronics', 'Home & Garden', 'Books') AND p.p_cost > 1000 AND cp.cp_end_date_sk IN (2450934, 2451664) AND ca.ca_state = 'CA' AND ca.ca_gmt_offset = -8.00 GROUP BY customer_state, department ORDER BY total_net_loss DESC, total_return_count DESC;
SELECT p.p_promo_name AS promotion_name, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_return_amt_inc_tax) - SUM(wr.wr_fee) AS net_loss_after_fees, COUNT(DISTINCT wp.wp_web_page_id) AS distinct_pages_involved, sm.sm_type AS ship_method_type, MAX(wr.wr_return_amt_inc_tax) AS max_return_amount_incl_tax, MIN(wr.wr_return_amt_inc_tax) AS min_return_amount_incl_tax, COUNT(DISTINCT CASE WHEN cd.cd_gender = 'M' THEN wr.wr_returning_customer_sk END) AS male_customers, COUNT(DISTINCT CASE WHEN cd.cd_gender = 'F' THEN wr.wr_returning_customer_sk END) AS female_customers FROM web_returns wr INNER JOIN promotion p ON wr.wr_reason_sk = p.p_promo_sk INNER JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk INNER JOIN ship_mode sm ON CAST(SUBSTRING(wp.wp_url FROM 'http://www.%#"sm"#"%' FOR '#') AS INTEGER) = sm.sm_ship_mode_sk LEFT JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk WHERE wr.wr_returned_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk AND wp.wp_url = 'http://www.foo.com' AND wp.wp_link_count IN (15, 11) AND wr.wr_return_tax = 52.13 GROUP BY p.p_promo_name, sm.sm_type ORDER BY total_returns DESC, net_loss_after_fees DESC;
SELECT s.s_division_id, s.s_division_name, sm.sm_type, AVG(i.i_current_price) AS avg_item_price, COUNT(DISTINCT i.i_item_sk) AS total_items_sold, SUM(i.i_current_price) AS total_sales FROM item i JOIN store s ON i.i_manufact_id = s.s_store_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = s.s_store_sk WHERE i.i_item_id IN ('AAAAAAAABPCBAAAA', 'AAAAAAAAKEPAAAAA', 'AAAAAAAAHIBAAAAA') AND sm.sm_type IN ('EXPRESS', 'TWO DAY', 'NEXT DAY') AND sm.sm_ship_mode_id IN ('AAAAAAAALAAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAACBAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAABAAAAAAA') AND i.i_rec_start_date BETWEEN '1997-01-01' AND '2001-12-31' AND s.s_rec_start_date BETWEEN '1997-01-01' AND '2001-12-31' GROUP BY s.s_division_id, s.s_division_name, sm.sm_type ORDER BY s.s_division_id, sm.sm_type;
SELECT cp.cp_department, AVG(cr.cr_return_amt_inc_tax) AS avg_return_amount, SUM(cr.cr_return_quantity) AS total_return_quantity, COUNT(cr.cr_item_sk) AS return_count, AVG(t.t_time) AS avg_time_spent_on_page FROM catalog_returns cr JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN customer c ON cr.cr_returning_customer_sk = c.c_customer_sk JOIN web_page wp ON c.c_customer_sk = wp.wp_customer_sk JOIN time_dim t ON cr.cr_returned_time_sk = t.t_time_sk WHERE c.c_preferred_cust_flag = 'Y' AND cp.cp_catalog_number IN (4, 47) AND cp.cp_catalog_page_id IN ('AAAAAAAALNKAAAAA', 'AAAAAAAAEHFAAAAA', 'AAAAAAAAMAIAAAAA', 'AAAAAAAAAAKAAAAA') AND wp.wp_web_page_sk IN (57, 25, 50, 44, 55) AND wp.wp_customer_sk IN (10897, 84146, 37285, 92078) AND t.t_time_id IN ('AAAAAAAAAKCBAAAA', 'AAAAAAAACKOAAAAA') GROUP BY cp.cp_department ORDER BY avg_return_amount DESC, total_return_quantity DESC, return_count DESC;
SELECT ws.web_name, ws.web_manager, i.i_category, i.i_class, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_items, SUM(wr.wr_return_amt) AS total_returned_amount, AVG(wr.wr_return_amt/wr.wr_return_quantity) AS avg_return_amount_per_item, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_net_loss) AS total_net_loss FROM web_returns wr JOIN item i ON wr.wr_item_sk = i.i_item_sk JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk JOIN web_site ws ON wp.wp_web_page_id = ws.web_site_id WHERE ws.web_open_date_sk IN ('2450645', '2450679', '2450781') AND (wr.wr_returning_addr_sk = '7213' OR wr.wr_returning_addr_sk = '17875') GROUP BY ws.web_name, ws.web_manager, i.i_category, i.i_class ORDER BY total_returned_amount DESC, ws.web_name, i.i_category, i.i_class;
SELECT sm.sm_type AS ship_mode_type, s.s_state AS store_state, COUNT(DISTINCT cr.cr_order_number) AS num_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT ss.ss_ticket_number) AS num_sales, SUM(ss.ss_net_paid) AS total_sales_net_paid, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sales_price FROM catalog_returns cr JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN store_sales ss ON ss.ss_store_sk = cr.cr_returning_customer_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk WHERE cp.cp_type = 'monthly' GROUP BY sm.sm_type, s.s_state ORDER BY total_return_amount DESC, total_sales_net_paid DESC;
SELECT cd.cd_education_status, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(case when c.c_preferred_cust_flag = 'Y' then 1 else 0 end) AS preferred_customer_count, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(hd.hd_vehicle_count) AS total_vehicles, MIN(p.p_cost) AS min_promo_cost, MAX(p.p_cost) AS max_promo_cost, SUM(inv.inv_quantity_on_hand) AS total_inventory FROM customer_demographics cd JOIN customer c ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN promotion p ON p.p_start_date_sk BETWEEN 2450688 AND 2450740 JOIN inventory inv ON inv.inv_date_sk = 2450815 WHERE cd.cd_education_status IN ('Secondary', 'Primary', '2 yr Degree', 'Advanced Degree') AND c.c_email_address IN ('Bruce.Goodwin@3mtLAZrvaCRJ9p.org', 'Douglas.Smith@hF9KfOktaH5qz3.edu', 'Ana.Cary@imJui63o9G08Nas.com') AND p.p_promo_sk IN ('260', '238', '124', '179', '203') GROUP BY cd.cd_education_status;
SELECT i.i_category, i.i_brand, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_profit) AS total_net_profit, AVG(hd_dep_count) AS average_dependency_count, AVG(hd_vehicle_count) AS average_vehicle_count FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN household_demographics hd ON cs.cs_ship_hdemo_sk = hd.hd_demo_sk WHERE i.i_category = 'Men' AND (i.i_color = 'lawn' OR i.i_color = 'peach' OR i.i_color = 'red') AND cs.cs_catalog_page_sk IN (118, 44) AND hd.hd_demo_sk IN (714, 1213, 4049, 4231, 2781, 3780) GROUP BY i.i_category, i.i_brand ORDER BY total_net_profit DESC, total_orders DESC;
SELECT s.s_store_name, s.s_state, sum(inv.inv_quantity_on_hand) AS total_inventory, avg(hd.hd_dep_count) AS avg_dependents, avg(hd.hd_vehicle_count) AS avg_vehicles, count(DISTINCT sr.sr_ticket_number) AS num_store_returns, sum(sr.sr_return_amt_inc_tax) AS total_store_return_value, sum(wr.wr_return_amt_inc_tax) AS total_web_return_value, sum(sr.sr_net_loss) AS total_store_net_loss, sum(wr.wr_net_loss) AS total_web_net_loss FROM store s LEFT JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk LEFT JOIN web_returns wr ON wr.wr_returning_hdemo_sk = sr.sr_hdemo_sk LEFT JOIN inventory inv ON inv.inv_warehouse_sk = s.s_store_sk LEFT JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk WHERE s.s_gmt_offset = '-5.00' AND inv.inv_date_sk = 2450815 AND s.s_store_id = 'AAAAAAAABAAAAAAA' AND ( inv.inv_item_sk IN ('14480', '13390', '12130', '9782', '14476', '8896') OR wr.wr_item_sk IN ('8516', '362') ) AND ( hd.hd_vehicle_count IN (3, 1, 0, 4, 2) OR hd.hd_buy_potential IN ('5001-10000', 'Unknown', '0-500', '1001-5000', '>10000') ) GROUP BY s.s_store_name, s.s_state ORDER BY total_inventory DESC, total_store_return_value DESC;
SELECT cc.cc_name, cc.cc_class, cc.cc_employees, cc.cc_city, COUNT(*) AS num_promotions, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(CASE WHEN cd.cd_marital_status = 'D' THEN 1 ELSE 0 END) AS divorced_customer_count, SUM(CASE WHEN p.p_channel_email = 'N' THEN p.p_cost ELSE 0 END) AS total_promotion_cost_non_email FROM call_center cc JOIN promotion p ON cc.cc_call_center_sk = p.p_item_sk JOIN customer c ON cc.cc_call_center_sk = c.c_current_addr_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk WHERE cc.cc_company = '2' AND cd.cd_dep_college_count = 0 AND p.p_promo_name LIKE '%pri%' OR p.p_promo_name LIKE '%eing%' GROUP BY cc.cc_name, cc.cc_class, cc.cc_employees, cc.cc_city HAVING COUNT(*) > 5 ORDER BY avg_purchase_estimate DESC;
SELECT d_year, d_quarter_name, ca_state, SUM(ws_net_profit) AS total_net_profit, AVG(sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, COUNT(DISTINCT ws_order_number) AS total_orders, COUNT(DISTINCT sr_ticket_number) AS total_returns FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN customer_address ON ws_ship_addr_sk = ca_address_sk JOIN store_returns ON ws_order_number = sr_ticket_number AND ws_item_sk = sr_item_sk AND ws_bill_customer_sk = sr_customer_sk WHERE d_year = 2001 AND ca_state IN ('CA', 'NY', 'TX') AND ws_ship_mode_sk IN (15, 9, 19) AND ws_net_profit > 0 AND ws_ship_customer_sk IN (91411, 13153, 53110, 78552, 62671) AND sr_return_amt_inc_tax IN (211.69, 1118.88) AND sr_customer_sk IN (30509, 42705, 90022, 87597) GROUP BY d_year, d_quarter_name, ca_state ORDER BY total_net_profit DESC, avg_return_amount_inc_tax DESC;
SELECT i_category, i_class, web_state, web_name, avg_hd_vehicle_count, avg_ib_lower_bound, sum_i_current_price, avg_i_wholesale_cost, count_distinct_items FROM ( SELECT i.i_category, i.i_class, ws.web_state, ws.web_name, AVG(hd.hd_vehicle_count) AS avg_hd_vehicle_count, AVG(ib.ib_lower_bound) AS avg_ib_lower_bound, SUM(i.i_current_price) AS sum_i_current_price, AVG(i.i_wholesale_cost) AS avg_i_wholesale_cost, COUNT(DISTINCT i.i_item_sk) AS count_distinct_items FROM item i JOIN household_demographics hd ON i.i_manager_id = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN web_site ws ON i.i_manufact_id = ws.web_company_id WHERE i.i_category IN ('Home', 'Men', 'Women') AND i.i_class IN ('toddlers', 'basketball', 'bedding') AND hd.hd_buy_potential IN ('0-500', 'Unknown', '501-1000') AND hd.hd_vehicle_count IN (4, 3, 0) AND ws.web_state = 'TN' AND ws.web_name IN ('site_0', 'site_3', 'site_4') AND ib.ib_lower_bound IN (150001, 160001, 120001) AND ib.ib_upper_bound IN (70000, 200000, 10000) AND ib.ib_income_band_sk IN (6, 11, 18) GROUP BY i.i_category, i.i_class, ws.web_state, ws.web_name ) AS derived_table ORDER BY i_category, i_class, web_state, web_name;
SELECT r.r_reason_desc, COUNT(DISTINCT sr.sr_ticket_number) AS num_store_returns, SUM(sr.sr_refunded_cash) AS total_store_refunded, AVG(sr.sr_return_amt_inc_tax) AS avg_store_return, COUNT(DISTINCT cr.cr_order_number) AS num_catalog_returns, SUM(cr.cr_refunded_cash) AS total_catalog_refunded, AVG(cr.cr_return_amt_inc_tax) AS avg_catalog_return FROM store_returns sr FULL OUTER JOIN catalog_returns cr ON sr.sr_reason_sk = cr.cr_reason_sk JOIN reason r ON r.r_reason_sk = sr.sr_reason_sk OR r.r_reason_sk = cr.cr_reason_sk LEFT JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk WHERE (sr.sr_customer_sk IN (67809, 3762, 6067) OR cr.cr_returning_hdemo_sk IN (6684, 3972, 3528, 1943, 4100, 4193)) AND (r.r_reason_id IN ('AAAAAAAANBAAAAAA', 'AAAAAAAADCAAAAAA', 'AAAAAAAAACAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAAFBAAAAAA', 'AAAAAAAAOBAAAAAA')) AND w.w_street_number = '651' AND w.w_county = 'Williamson County' GROUP BY r.r_reason_desc ORDER BY total_store_refunded DESC, total_catalog_refunded DESC;
SELECT hd.hd_demo_sk, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, COUNT(DISTINCT wr.wr_order_number) AS total_web_returns, SUM(sr.sr_return_amt) AS total_store_return_amount, AVG(sr.sr_return_amt) AS avg_store_return_amount, SUM(wr.wr_return_amt) AS total_web_return_amount, AVG(wr.wr_return_amt) AS avg_web_return_amount, SUM(CASE WHEN p.p_channel_radio = 'N' AND p.p_channel_demo = 'N' THEN p.p_cost ELSE 0 END) AS non_radio_demo_promo_cost, AVG(CASE WHEN p.p_channel_radio = 'N' AND p.p_channel_demo = 'N' THEN p.p_response_target ELSE NULL END) AS avg_non_radio_demo_response_target FROM household_demographics hd LEFT JOIN store_returns sr ON hd.hd_demo_sk = sr.sr_hdemo_sk LEFT JOIN web_returns wr ON (hd.hd_demo_sk = wr.wr_refunded_hdemo_sk OR hd.hd_demo_sk = wr.wr_returning_hdemo_sk) LEFT JOIN promotion p ON p.p_promo_sk = sr.sr_reason_sk WHERE hd.hd_demo_sk IN (560, 4858) AND (sr.sr_store_sk IN (8, 10) OR sr.sr_store_sk IS NULL) GROUP BY hd.hd_demo_sk ORDER BY hd.hd_demo_sk;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_state, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_ext_sales_price) AS total_sales, AVG(ss.ss_sales_price) AS avg_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(sr.sr_return_quantity) AS total_quantity_returned, SUM(sr.sr_return_amt) AS total_returns, AVG(sr.sr_return_amt) AS avg_return_amt, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions, SUM(wr.wr_return_quantity) AS total_web_quantity_returned, SUM(wr.wr_return_amt) AS total_web_returns, AVG(wr.wr_return_amt) AS avg_web_return_amt, COUNT(DISTINCT wr.wr_order_number) AS total_web_return_transactions FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk LEFT JOIN store_returns sr ON ss.ss_item_sk = sr.sr_item_sk AND ss.ss_ticket_number = sr.sr_ticket_number LEFT JOIN web_returns wr ON ss.ss_item_sk = wr.wr_item_sk AND ss.ss_ticket_number = wr.wr_order_number WHERE dd.d_year = 2001 AND ca.ca_country = 'United States' AND (sr.sr_returned_date_sk IS NULL OR dd.d_date_sk = sr.sr_returned_date_sk) AND (wr.wr_returned_date_sk IS NULL OR dd.d_date_sk = wr.wr_returned_date_sk) GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state ORDER BY dd.d_year, dd.d_quarter_name, ca.ca_state;
