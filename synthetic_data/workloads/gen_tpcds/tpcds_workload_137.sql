SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT ws.ws_order_number) AS web_order_count, SUM(ws.ws_net_paid) AS total_web_sales, AVG(ws.ws_quantity) AS average_web_quantity, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_quantity) AS average_return_quantity, COUNT(DISTINCT sr.sr_ticket_number) AS return_ticket_count FROM customer_demographics cd JOIN web_sales ws ON cd.cd_demo_sk = ws.ws_bill_cdemo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound LEFT JOIN store_returns sr ON ws.ws_bill_customer_sk = sr.sr_customer_sk AND ws.ws_item_sk = sr.sr_item_sk WHERE cd.cd_dep_count IN ('1', '2') AND ib.ib_income_band_sk IN ('1', '10', '19', '16', '6') AND ws.ws_bill_addr_sk IN ('46947', '12502', '40790', '6718') AND sr.sr_ticket_number IN ('40231', '36947', '37079', '39174', '39687') AND sr.sr_store_credit IN ('113.23', '47.72', '298.96', '136.00', '370.20', '203.23') GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_web_sales DESC, total_return_amount DESC;
SELECT c.c_birth_country, COUNT(DISTINCT c.c_customer_sk) AS num_customers, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_net_paid_inc_tax) AS avg_net_paid_inc_tax, SUM(CASE WHEN ss.ss_net_paid_inc_tax > 1000 THEN ss.ss_quantity ELSE 0 END) AS quantity_sold_above_1000, COUNT(DISTINCT p.p_promo_sk) AS num_promotions, SUM(p.p_cost) AS total_promotion_cost, w.w_state, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft FROM customer c JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN warehouse w ON w.w_zip = c.c_current_addr_sk::character varying WHERE c.c_birth_country IN ('THAILAND', 'ITALY') AND ss.ss_net_paid_inc_tax::text IN ('307.45', '859.21', '1169.72', '3293.51', '222.26') GROUP BY c.c_birth_country, w.w_state ORDER BY total_quantity_sold DESC;
SELECT s.s_state, AVG(cs.cs_net_paid) AS avg_sales, COUNT(sr.sr_ticket_number) AS total_returns, AVG(sr.sr_net_loss) AS avg_net_loss FROM catalog_sales cs JOIN store s ON cs.cs_bill_customer_sk = s.s_store_sk LEFT JOIN store_returns sr ON cs.cs_sold_date_sk = sr.sr_returned_date_sk AND cs.cs_item_sk = sr.sr_item_sk LEFT JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE r.r_reason_desc = 'Did not get it on time' GROUP BY s.s_state ORDER BY avg_sales DESC, total_returns DESC;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, SUM(ws.ws_net_paid_inc_ship_tax) AS total_sales, SUM(ws.ws_ext_ship_cost) AS total_shipping_costs, COUNT(DISTINCT ws.ws_order_number) AS number_of_orders, AVG(ws.ws_net_paid_inc_ship_tax) AS avg_order_value, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_value, COUNT(DISTINCT cr.cr_order_number) AS number_of_returns, SUM(cr.cr_store_credit) AS total_store_credit_issued, SUM(wr.wr_net_loss) AS total_web_net_loss FROM customer c LEFT JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk LEFT JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_returning_customer_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk WHERE ws.ws_ext_ship_cost IN ('445.80', '1378.08') OR ws.ws_net_paid_inc_ship_tax IN ('3521.86', '4835.64', '451.77', '1948.62') OR cr.cr_return_tax IN ('8.78', '157.04', '14.40', '364.85', '21.09', '27.15') OR cr.cr_store_credit IN ('1.34', '1072.41', '2042.86', '1698.25', '143.92') GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name ORDER BY total_sales DESC, number_of_orders DESC, total_returns DESC;
SELECT r.r_reason_desc, cc.cc_name AS call_center_name, cc.cc_city AS call_center_city, cc.cc_state AS call_center_state, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_items, SUM(cr.cr_fee) AS total_fees_collected, SUM(cr.cr_store_credit) AS total_store_credit_issued, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk WHERE cr.cr_returned_date_sk BETWEEN 20000101 AND 20001231 AND cr.cr_returning_hdemo_sk IN (5491, 6517, 636, 7063, 3950, 2509) GROUP BY r.r_reason_desc, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_return_amount DESC, total_returns DESC;
SELECT i.i_category, COUNT(DISTINCT cs.cs_order_number) AS total_catalog_orders, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, AVG(cs.cs_sales_price) AS avg_catalog_sales_price, AVG(ws.ws_sales_price) AS avg_web_sales_price, SUM(cs.cs_net_profit) AS total_catalog_net_profit, SUM(ws.ws_net_profit) AS total_web_net_profit, SUM(CASE WHEN cs.cs_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS promo_catalog_sales, SUM(CASE WHEN ws.ws_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS promo_web_sales, COUNT(DISTINCT d.d_date_sk) AS days_in_Q4 FROM item i LEFT JOIN catalog_sales cs ON i.i_item_sk = cs.cs_item_sk LEFT JOIN web_sales ws ON i.i_item_sk = ws.ws_item_sk LEFT JOIN date_dim d ON (cs.cs_sold_date_sk = d.d_date_sk OR ws.ws_sold_date_sk = d.d_date_sk) WHERE d.d_quarter_name = 'Q4' GROUP BY i.i_category ORDER BY total_catalog_net_profit DESC, total_web_net_profit DESC;
SELECT c.c_birth_year, r.r_reason_desc, AVG(sr.sr_return_amt_inc_tax) AS avg_store_return_amount_inc_tax, AVG(wr.wr_return_amt_inc_tax) AS avg_web_return_amount_inc_tax, SUM(sr.sr_return_quantity) AS total_store_return_quantity, SUM(wr.wr_return_quantity) AS total_web_return_quantity, AVG(sr.sr_fee) AS avg_store_fee, AVG(wr.wr_fee) AS avg_web_fee, COUNT(DISTINCT sr.sr_customer_sk) AS num_customers_store, COUNT(DISTINCT wr.wr_refunded_customer_sk) AS num_customers_web FROM customer c LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_refunded_customer_sk LEFT JOIN reason r ON r.r_reason_sk = sr.sr_reason_sk OR r.r_reason_sk = wr.wr_reason_sk WHERE c.c_preferred_cust_flag = 'Y' AND (sr.sr_return_amt IS NOT NULL OR wr.wr_return_amt IS NOT NULL) GROUP BY c.c_birth_year, r.r_reason_desc ORDER BY c.c_birth_year, avg_store_return_amount_inc_tax DESC, avg_web_return_amount_inc_tax DESC;
SELECT cp.cp_department, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(ws.ws_net_profit) AS total_net_profit FROM catalog_page cp JOIN web_sales ws ON cp.cp_catalog_page_sk = ws.ws_web_page_sk JOIN customer c ON ws.ws_ship_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk WHERE cp.cp_end_date_sk IN (2450996, 2451087) AND cp.cp_catalog_page_number IN (3, 25, 96, 38, 39) AND wp.wp_rec_end_date IS NOT NULL AND wp.wp_image_count IN (5, 6, 7, 1, 4) AND cd.cd_purchase_estimate IS NOT NULL GROUP BY cp.cp_department ORDER BY total_net_profit DESC;
SELECT s.s_store_name, s.s_city, s.s_state, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(sr.sr_net_loss) AS total_net_loss, cd.cd_gender, cd.cd_education_status, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_page_visits, ib.ib_lower_bound, ib.ib_upper_bound FROM store_returns sr JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN web_page wp ON wp.wp_customer_sk = sr.sr_customer_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound WHERE s.s_street_type IN ('Dr.', 'Lane', 'Wy') AND s.s_market_desc IN ('Mysterious employe', 'Architects coul', 'Little expectations include yet forward meetings.') AND s.s_city IN ('Fairview', 'Midway') AND s.s_street_number IN ('337', '767', '175') AND sr.sr_reversed_charge IN ('17.91', '2.40', '5.43') AND sr.sr_return_time_sk IN ('55806', '33650', '38681') AND sr.sr_net_loss IN ('386.38', '1608.66', '1058.95') AND sr.sr_reason_sk IN ('1', '3', '23') AND cd.cd_gender IN ('F', 'M') AND cd.cd_purchase_estimate IN ('9000', '5500', '4000') AND wp.wp_web_page_id IN ('AAAAAAAAKDAAAAAA', 'AAAAAAAAACAAAAAA', 'AAAAAAAAMBAAAAAA') AND wp.wp_url = 'http://www.foo.com' AND wp.wp_autogen_flag IN ('N', 'Y') AND ib.ib_income_band_sk IN ('18', '7', '2') GROUP BY s.s_store_name, s.s_city, s.s_state, cd.cd_gender, cd.cd_education_status, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_net_loss DESC, total_returns DESC, s.s_store_name, cd.cd_gender;
SELECT w_state, t_shift, sm_type as shipping_type, avg(hd_income_band_sk) as avg_income_band, sum(case when hd_buy_potential = 'High' then 1 else 0 end) as high_buy_potential_count, avg(hd_dep_count) as avg_dependent_count, avg(hd_vehicle_count) as avg_vehicle_count, count(distinct sm_ship_mode_sk) as shipping_mode_count FROM household_demographics hd JOIN warehouse w ON hd.hd_demo_sk = w.w_warehouse_sk JOIN time_dim td ON td.t_time_sk = w.w_warehouse_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = w.w_warehouse_sk WHERE hd.hd_dep_count IN (2, 3, 6, 9) AND hd.hd_vehicle_count IN (0, 1, 2, 3, 4) AND td.t_shift IS NOT NULL AND sm.sm_type IS NOT NULL GROUP BY w_state, t_shift, sm_type ORDER BY avg_income_band DESC, high_buy_potential_count DESC, avg_vehicle_count DESC;
SELECT ca_state, ca_city, SUM(ws_quantity) AS total_quantity_sold, AVG(ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws_order_number) AS number_of_orders, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_profit) AS total_net_profit FROM web_sales JOIN customer_address ON web_sales.ws_ship_addr_sk = customer_address.ca_address_sk JOIN inventory ON web_sales.ws_item_sk = inventory.inv_item_sk WHERE web_sales.ws_web_site_sk IN ('16', '29', '24', '23', '3') AND inventory.inv_warehouse_sk IN ('1', '2') AND inventory.inv_item_sk IN ('9766', '15184', '10474', '14785', '12391') GROUP BY ca_state, ca_city ORDER BY total_net_profit DESC, total_quantity_sold DESC LIMIT 100;
SELECT cp.cp_department, i.i_category, i.i_brand, sm.sm_carrier, s.s_store_name, s.s_company_name, COUNT(DISTINCT inv.inv_item_sk) AS num_items, SUM(inv.inv_quantity_on_hand) AS total_quantity, AVG(i.i_current_price) AS avg_current_price, MAX(i.i_wholesale_cost) AS max_wholesale_cost, MIN(s.s_number_employees) AS min_num_employees, AVG(s.s_tax_precentage) AS avg_tax_percentage FROM catalog_page cp JOIN item i ON cp.cp_catalog_page_sk = i.i_item_sk JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = inv.inv_warehouse_sk JOIN store s ON s.s_store_sk = inv.inv_warehouse_sk WHERE i.i_brand = 'exportibrand #7' AND s.s_number_employees = 271 AND sm.sm_carrier IN ('BOXBUNDLES', 'ALLIANCE', 'PRIVATECARRIER', 'ORIENTAL', 'UPS') AND inv.inv_warehouse_sk IN (1, 2) GROUP BY cp.cp_department, i.i_category, i.i_brand, sm.sm_carrier, s.s_store_name, s.s_company_name ORDER BY total_quantity DESC, avg_current_price DESC;
SELECT ca.ca_state AS customer_state, EXTRACT(YEAR FROM d.d_date) AS year_of_return, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_customers, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_refund_amount, AVG(cr.cr_return_amount) AS average_refund_amount, SUM(cr.cr_return_quantity) AS total_returned_quantity, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk WHERE ca.ca_state IS NOT NULL AND cr.cr_returned_date_sk IS NOT NULL GROUP BY customer_state, year_of_return ORDER BY customer_state, year_of_return;
SELECT cp.cp_department, i.i_category, sum(ss.ss_quantity) AS total_quantity_sold, avg(ss.ss_sales_price) AS average_sales_price, count(DISTINCT w.w_warehouse_sk) AS number_of_warehouses, count(DISTINCT ss.ss_customer_sk) AS number_of_customers, sum(wr.wr_return_quantity) AS total_quantity_returned, sum(wr.wr_return_amt) AS total_return_amount FROM catalog_page cp JOIN item i ON cp.cp_catalog_page_sk = i.i_item_sk JOIN store_sales ss ON i.i_item_sk = ss.ss_item_sk JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk LEFT JOIN web_returns wr ON i.i_item_sk = wr.wr_item_sk WHERE cp.cp_department LIKE 'DEPARTMENT%' AND i.i_manager_id IN ('54', '71', '14') AND i.i_brand_id IN ('7014003', '9006005', '10012001') AND cp.cp_catalog_page_number IN ('24', '68', '70', '62', '42') AND w.w_warehouse_id IN ('AAAAAAAAFAAAAAAA', 'AAAAAAAACAAAAAAA', 'AAAAAAAABAAAAAAA') GROUP BY cp.cp_department, i.i_category;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(DISTINCT sr.sr_ticket_number) AS num_returns, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_net_loss) AS average_net_loss, COUNT(DISTINCT ss.ss_ticket_number) AS num_sales, SUM(ss.ss_sales_price) AS total_sales_amount, AVG(ss.ss_quantity) AS average_quantity_sold, SUM(ws.ws_net_paid_inc_tax) AS total_web_net_paid_inc_tax, ws.ws_web_site_sk AS website_id FROM customer_demographics cd LEFT JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk LEFT JOIN store_sales ss ON cd.cd_demo_sk = ss.ss_cdemo_sk LEFT JOIN web_sales ws ON cd.cd_demo_sk = ws.ws_bill_cdemo_sk OR cd.cd_demo_sk = ws.ws_ship_cdemo_sk WHERE cd.cd_dep_count IN ('1', '2') AND cd.cd_marital_status IN ('D', 'S', 'W') AND (sr.sr_return_amt = '225.00' OR sr.sr_return_amt = '3027.92') AND (sr.sr_net_loss = '440.72' OR sr.sr_net_loss = '800.95') AND ss.ss_promo_sk IS NOT NULL AND ws.ws_web_site_sk IS NOT NULL GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, ws.ws_web_site_sk ORDER BY total_return_amount DESC;
SELECT dd.d_year, dd.d_quarter_name, SUM(cs.cs_net_paid_inc_ship_tax) AS total_sales, AVG(cs.cs_net_paid_inc_ship_tax) AS avg_sales, COUNT(*) AS number_of_sales, SUM(cr.cr_return_amt_inc_tax) AS total_returns, AVG(cr.cr_return_amt_inc_tax) AS avg_returns, COUNT(cr.cr_order_number) AS number_of_returns, SUM(hd.hd_dep_count) AS total_dependants, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_size FROM date_dim dd LEFT JOIN catalog_sales cs ON dd.d_date_sk = cs.cs_sold_date_sk LEFT JOIN catalog_returns cr ON dd.d_date_sk = cr.cr_returned_date_sk LEFT JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk LEFT JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk WHERE dd.d_year = 1999 AND (cs.cs_net_paid_inc_ship_tax > 1000 OR cr.cr_return_amt_inc_tax > 100) AND hd.hd_buy_potential = '1001-5000' AND hd.hd_dep_count BETWEEN 4 AND 9 AND cr.cr_ship_mode_sk IN (4, 7) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT i.i_category AS item_category, i.i_brand AS item_brand, p.p_channel_details AS promotion_channel, SUM(cs.cs_ext_sales_price) AS total_sales, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(cs.cs_item_sk) AS items_sold_count FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE p.p_channel_dmail = 'N' AND p.p_channel_event = 'N' AND i.i_units IN ('Oz', 'Ounce', 'Tsp', 'Dozen') GROUP BY i.i_category, i.i_brand, p.p_channel_details ORDER BY total_sales DESC, i.i_category, i.i_brand;
SELECT i.i_category, r.r_reason_desc, COUNT(*) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_quantity) AS total_return_quantity, AVG(cr.cr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_customers_returned, COUNT(DISTINCT ss.ss_store_sk) AS stores_involved, SUM(ss.ss_sales_price) AS total_sales_amount, AVG(ss.ss_sales_price) AS average_sales_price FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk LEFT JOIN store_sales ss ON cr.cr_item_sk = ss.ss_item_sk AND cr.cr_order_number = ss.ss_ticket_number WHERE i.i_size IN ('medium', 'large') AND (cr.cr_returned_date_sk BETWEEN 19990101 AND 19991231 OR cr.cr_returned_date_sk IS NULL) AND i.i_rec_end_date > '2000-01-01' GROUP BY i.i_category, r.r_reason_desc ORDER BY total_return_amount DESC, total_returns DESC LIMIT 10;
SELECT cd.cd_education_status, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_type, AVG(cd.cd_purchase_estimate) AS average_purchase_estimate, COUNT(cd.cd_demo_sk) AS customer_count, AVG(w.web_tax_percentage) AS average_tax_percentage FROM customer_demographics cd JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound JOIN ship_mode sm ON sm.sm_contract = 'qENFQ' AND sm.sm_type IN ('EXPRESS', 'LIBRARY', 'OVERNIGHT', 'TWO DAY') JOIN web_site w ON w.web_class IN ('B2C', 'B2B', 'Small Business', 'Enterprise') AND w.web_tax_percentage IS NOT NULL WHERE cd.cd_education_status IN ('College', 'Secondary', '2 yr Degree', 'Primary') AND cd.cd_purchase_estimate IN (1000, 2500, 7000, 3000) AND sm.sm_type IN ('EXPRESS', 'LIBRARY', 'OVERNIGHT', 'TWO DAY') GROUP BY cd.cd_education_status, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_type ORDER BY cd.cd_education_status, ib.ib_lower_bound, sm.sm_type;
SELECT i.i_category, i.i_brand, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN web_page wp ON cr.cr_catalog_page_sk = wp.wp_web_page_sk WHERE i.i_brand_id IN ('10003002', '8008007', '7015003', '9001006', '10011007', '10010015') AND wp.wp_url = 'http://www.foo.com' AND wp.wp_customer_sk IN ('98633', '80555') AND cr.cr_ship_mode_sk IN ('10', '18', '12', '2', '6', '8') GROUP BY i.i_category, i.i_brand ORDER BY total_returns DESC, total_returned_quantity DESC;
SELECT c.c_customer_sk, ca.ca_state, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(hd.hd_dep_count) AS avg_dependency_count, COUNT(DISTINCT w.w_warehouse_sk) AS number_of_warehouses, MAX(t.t_time) AS latest_time FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN inventory inv ON inv.inv_warehouse_sk = ca.ca_address_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN time_dim t ON inv.inv_date_sk = t.t_time_sk WHERE ca.ca_state IN ('TX', 'NV') AND hd.hd_vehicle_count = 2 AND t.t_sub_shift = 'night' AND c.c_birth_month IN (2, 9, 12, 4, 5) AND c.c_birth_year IN (1928, 1924) GROUP BY c.c_customer_sk, ca.ca_state ORDER BY total_inventory DESC, avg_dependency_count, number_of_warehouses, latest_time;
