SELECT d_year, i_category, COUNT(DISTINCT ss_ticket_number) AS total_sales_transactions, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, SUM(ss_net_profit) AS total_net_profit, SUM(cr_return_amount) AS total_return_amount, COUNT(DISTINCT cr_order_number) AS total_return_transactions, (SUM(ss_net_profit) - SUM(cr_net_loss)) AS net_profit_after_returns FROM store_sales JOIN item ON store_sales.ss_item_sk = item.i_item_sk JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk LEFT JOIN catalog_returns ON store_sales.ss_item_sk = catalog_returns.cr_item_sk AND store_sales.ss_ticket_number = catalog_returns.cr_order_number WHERE store_sales.ss_addr_sk = '19253' AND d_year = 1999 GROUP BY d_year, i_category ORDER BY net_profit_after_returns DESC LIMIT 10;
SELECT r.r_reason_desc, sm.sm_type, sm.sm_code, COUNT(*) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_return_quantity) AS total_return_quantity, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk WHERE cr.cr_returned_date_sk IS NOT NULL AND sm.sm_code = 'AIR' AND sm.sm_type IN ('TWO DAY', 'NEXT DAY') AND cr.cr_return_amt_inc_tax IN (93.14, 49.54, 370.20, 5187.66) GROUP BY r.r_reason_desc, sm.sm_type, sm.sm_code ORDER BY total_return_amount DESC, total_return_quantity DESC;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk WHERE cc.cc_market_manager IN ('Julius Durham', 'Matthew Clifton', 'Gary Colburn', 'Julius Tran') GROUP BY ROLLUP(cc.cc_name, cc.cc_city, cc.cc_state, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status) ORDER BY cc.cc_name, cc.cc_city, cc.cc_state, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status;
SELECT ca.ca_state, ca.ca_county, ca.ca_city, AVG(inv.inv_quantity_on_hand) AS avg_quantity_on_hand, COUNT(DISTINCT sm.sm_ship_mode_sk) AS num_shipment_modes, COUNT(DISTINCT ca.ca_address_sk) AS num_addresses FROM inventory inv JOIN customer_address ca ON inv.inv_warehouse_sk = ca.ca_address_sk JOIN time_dim td ON inv.inv_date_sk = td.t_time_sk JOIN ship_mode sm ON sm.sm_ship_mode_id LIKE 'AAAAAAA%' WHERE td.t_time_id = 'AAAAAAAAAGCAAAAA' AND ca.ca_address_sk IN (3195, 2241, 86, 2256, 3606) AND inv.inv_date_sk = 2450815 AND sm.sm_ship_mode_id IN ('AAAAAAAAEBAAAAAA', 'AAAAAAAAKAAAAAAA', 'AAAAAAAAMAAAAAAA', 'AAAAAAAAOAAAAAAA') GROUP BY ROLLUP (ca.ca_state, ca.ca_county, ca.ca_city) ORDER BY ca.ca_state, ca.ca_county, ca.ca_city;
SELECT ca.ca_state, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_return_quantity) AS total_return_quantity, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, COUNT(DISTINCT CASE WHEN c.c_preferred_cust_flag = 'Y' THEN sr.sr_ticket_number ELSE NULL END) AS preferred_customer_returns FROM store_returns sr JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE sr.sr_return_tax BETWEEN 5 AND 130 AND c.c_last_review_date_sk IN (2452499, 2452496, 2452479, 2452342) AND sr.sr_item_sk IN (13538, 16733, 1766, 2599, 3017, 9220) GROUP BY ca.ca_state ORDER BY total_return_amount DESC;
SELECT cd.cd_education_status, cd.cd_marital_status, ca.ca_state, cd.cd_credit_rating, AVG(cd.cd_purchase_estimate) AS average_purchase_estimate, COUNT(DISTINCT ca.ca_address_sk) AS number_of_addresses, SUM(hd.hd_vehicle_count) AS total_vehicles, AVG(t.t_hour + (t.t_minute / 60.0) + (t.t_second / 3600.0)) AS average_time_of_day FROM customer_demographics cd JOIN customer_address ca ON cd.cd_demo_sk = ca.ca_address_sk JOIN household_demographics hd ON cd.cd_demo_sk = hd.hd_demo_sk JOIN time_dim t ON t.t_time_sk = ca.ca_address_sk WHERE cd.cd_credit_rating IN ('Low Risk', 'High Risk', 'Good') AND t.t_time IN (775, 962) AND t.t_second IN (52, 26, 34) AND ca.ca_address_id IN ('AAAAAAAANJCAAAAA', 'AAAAAAAAFMCAAAAA', 'AAAAAAAAHGOAAAAA', 'AAAAAAAAHEEAAAAA') AND cd.cd_dep_count IN (1, 2) AND hd.hd_dep_count IN (0, 6, 4, 1) AND hd.hd_vehicle_count IN (3, 4) GROUP BY cd.cd_education_status, cd.cd_marital_status, ca.ca_state, cd.cd_credit_rating ORDER BY average_purchase_estimate DESC;
SELECT p.p_promo_name, COUNT(DISTINCT s.sr_customer_sk) AS num_customers_affected, SUM(s.sr_return_quantity) AS total_returned_quantity, AVG(s.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(s.sr_fee) AS total_fees_collected, SUM(s.sr_net_loss) AS total_net_loss, r.r_reason_desc, cd.cd_credit_rating, sm.sm_carrier FROM store_returns s JOIN promotion p ON s.sr_item_sk = p.p_item_sk JOIN reason r ON s.sr_reason_sk = r.r_reason_sk JOIN customer_demographics cd ON s.sr_cdemo_sk = cd.cd_demo_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = s.sr_item_sk WHERE p.p_start_date_sk >= 2450905 AND (s.sr_return_ship_cost = 482.43 OR s.sr_return_ship_cost = 95.68 OR s.sr_return_ship_cost = 82.62 OR s.sr_return_ship_cost = 37.74 OR s.sr_return_ship_cost = 670.08 OR s.sr_return_ship_cost = 40.56) AND p.p_purpose = 'Unknown' AND r.r_reason_sk = 11 GROUP BY p.p_promo_name, r.r_reason_desc, cd.cd_credit_rating, sm.sm_carrier ORDER BY num_customers_affected DESC, total_net_loss DESC;
SELECT i.i_category, i.i_brand, t.t_shift, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantities_sold, AVG(ss.ss_sales_price) AS average_selling_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) - SUM(ss.ss_net_paid) AS total_tax_collected, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE ss.ss_sold_date_sk IN (2451375, 2451147, 2451762, 2451572, 2452439, 2452222) AND ss.ss_sales_price BETWEEN 4.90 AND 95.65 GROUP BY i.i_category, i.i_brand, t.t_shift ORDER BY total_net_profit DESC, i.i_category, i.i_brand, t.t_shift;
SELECT i.i_category, sm.sm_type, w.w_state, SUM(ws.ws_sales_price) AS total_sales, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(sr.sr_return_amt) AS total_returns, AVG(sr.sr_return_amt) AS avg_return_amt, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_tickets FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk LEFT JOIN store_returns sr ON ws.ws_item_sk = sr.sr_item_sk WHERE sm.sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') AND i.i_class IN ('loose stones', 'swimwear', 'semi-precious', 'maternity', 'camping') AND i.i_manager_id IN ('92', '83') AND w.w_street_name LIKE '%6th%' GROUP BY i.i_category, sm.sm_type, w.w_state ORDER BY total_sales DESC, total_returns DESC;
SELECT p.p_promo_id, p.p_promo_name, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_tickets, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_ext_discount_amt) AS avg_ticket_discount, SUM(ss.ss_net_paid) AS total_net_sales, SUM(ss.ss_net_profit) AS total_net_profit, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, CASE WHEN hd.hd_buy_potential = '0-500' THEN 'Low' WHEN hd.hd_buy_potential = '501-1000' THEN 'Below Average' WHEN hd.hd_buy_potential = '1001-5000' THEN 'Average' WHEN hd.hd_buy_potential = '5001-10000' THEN 'Above Average' WHEN hd.hd_buy_potential = '>10000' THEN 'High' ELSE 'Unknown' END AS avg_buy_potential, COUNT(DISTINCT hd.hd_income_band_sk) AS distinct_income_bands FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk LEFT JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk GROUP BY p.p_promo_id, p.p_promo_name, hd.hd_buy_potential ORDER BY total_net_sales DESC, total_net_profit DESC;
SELECT r.r_reason_desc, sm.sm_type AS shipping_type, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_qty, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_inc_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_net_loss) AS total_net_loss, COUNT(DISTINCT s.s_store_sk) AS num_stores_with_returns, AVG(s.s_number_employees) AS avg_store_employees, AVG(s.s_floor_space) AS avg_store_floor_space, SUM(sr.sr_return_amt) AS total_store_return_amt, SUM(sr.sr_return_amt_inc_tax) AS total_store_return_inc_tax FROM catalog_returns cr JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN store_returns sr ON cr.cr_item_sk = sr.sr_item_sk AND cr.cr_order_number = sr.sr_ticket_number LEFT JOIN store s ON sr.sr_store_sk = s.s_store_sk WHERE r.r_reason_desc IN ('Gift exchange', 'duplicate purchase', 'Did not like the make', 'Found a better extended warranty in a store') AND sm.sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') AND (s.s_street_number IN ('337', '255', '175') OR s.s_state = 'TN') GROUP BY r.r_reason_desc, shipping_type ORDER BY total_returns DESC;
SELECT dd.d_year, dd.d_month_seq, dd.d_quarter_seq, cc.cc_class, SUM(sr.sr_return_amt) AS total_store_returns, AVG(sr.sr_return_quantity) AS avg_store_return_quantity, COUNT(DISTINCT sr.sr_ticket_number) AS count_store_return_tickets, SUM(wr.wr_return_amt) AS total_web_returns, AVG(wr.wr_return_quantity) AS avg_web_return_quantity, COUNT(DISTINCT wr.wr_order_number) AS count_web_return_orders FROM date_dim dd JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk JOIN web_returns wr ON dd.d_date_sk = wr.wr_returned_date_sk JOIN call_center cc ON cc.cc_open_date_sk = dd.d_date_sk WHERE dd.d_year = 2002 AND cc.cc_rec_start_date = '2002-01-01' AND (cc.cc_street_name = 'Center Hill' OR cc.cc_street_name = 'Ash Hill') AND (wr.wr_returned_time_sk IS NOT NULL AND sr.sr_return_time_sk IS NOT NULL) AND (wr.wr_returned_time_sk IN (SELECT t_time_sk FROM time_dim WHERE t_minute IN ('51', '4', '29', '2', '14', '12'))) AND EXISTS (SELECT 1 FROM warehouse w WHERE w.w_warehouse_sk = sr.sr_item_sk AND w.w_county = 'Williamson County' AND w.w_state = 'TN') GROUP BY dd.d_year, dd.d_month_seq, dd.d_quarter_seq, cc.cc_class ORDER BY dd.d_year, dd.d_month_seq, dd.d_quarter_seq, cc.cc_class;
SELECT state, item_category, SUM(total_sales_amount) AS total_sales_amount, SUM(total_return_amount) AS total_return_amount, AVG(avg_net_loss_per_return) AS avg_net_loss_per_return FROM ( SELECT web_site.web_state AS state, i.i_category AS item_category, SUM(ws.ws_sales_price) AS total_sales_amount, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_net_loss) AS avg_net_loss_per_return FROM web_sales ws INNER JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk INNER JOIN web_site ON ws.ws_web_site_sk = web_site.web_site_sk INNER JOIN item i ON ws.ws_item_sk = i.i_item_sk WHERE web_site.web_state IN ('TN') GROUP BY web_site.web_state, i.i_category UNION ALL SELECT 'Catalog' AS state, i.i_category AS item_category, 0 AS total_sales_amount, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_net_loss) AS avg_net_loss_per_return FROM catalog_returns cr INNER JOIN item i ON cr.cr_item_sk = i.i_item_sk GROUP BY i.i_category ) AS combined_results GROUP BY state, item_category ORDER BY state, item_category;
SELECT dd.d_year, dd.d_quarter_name, SUM(ws.ws_sales_price) AS total_sales, AVG(ws.ws_quantity) AS average_quantity, COUNT(DISTINCT ws.ws_order_number) AS order_count, SUM(CASE WHEN ca.ca_location_type = 'condo' THEN ws.ws_net_paid_inc_tax ELSE 0 END) AS condo_sales_tax, SUM(CASE WHEN ca.ca_location_type = 'single family' THEN ws.ws_net_paid_inc_tax ELSE 0 END) AS single_family_sales_tax, SUM(CASE WHEN ib.ib_income_band_sk = 17 THEN ws.ws_net_paid ELSE 0 END) AS band_17_net_paid, COUNT(DISTINCT CASE WHEN ca.ca_county IN ('Telfair County', 'Cherokee County') THEN ws.ws_bill_addr_sk ELSE NULL END) AS unique_addresses_in_counties, COUNT(DISTINCT CASE WHEN p.p_discount_active = '1' THEN ws.ws_promo_sk ELSE NULL END) AS active_promo_count FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON ws.ws_bill_addr_sk = ca.ca_address_sk JOIN income_band ib ON ws.ws_bill_cdemo_sk = ib.ib_income_band_sk LEFT JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk WHERE dd.d_year = 2023 AND ib.ib_lower_bound >= 0 AND (ca.ca_location_type IN ('condo', 'single family') OR ca.ca_county IN ('Telfair County', 'Cherokee County')) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT cc.cc_name, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_net_paid) AS total_net_paid, AVG(cs.cs_net_paid) AS avg_net_paid_per_order, SUM(cs.cs_net_profit) AS total_net_profit, AVG(cs.cs_net_profit) AS avg_net_profit_per_order, p.p_promo_name, COUNT(DISTINCT p.p_promo_sk) FILTER (WHERE cs.cs_promo_sk IS NOT NULL) AS promo_count, cd.cd_gender, COUNT(DISTINCT cd.cd_demo_sk) FILTER (WHERE cd.cd_gender = 'M') AS male_customers, COUNT(DISTINCT cd.cd_demo_sk) FILTER (WHERE cd.cd_gender = 'F') AS female_customers FROM call_center cc LEFT JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk LEFT JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk LEFT JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk GROUP BY cc.cc_name, p.p_promo_name, cd.cd_gender ORDER BY total_net_paid DESC, total_net_profit DESC;
