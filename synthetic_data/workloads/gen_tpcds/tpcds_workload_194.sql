SELECT cpg.cp_department, it.i_category, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN item it ON cs.cs_item_sk = it.i_item_sk JOIN catalog_page cpg ON cs.cs_catalog_page_sk = cpg.cp_catalog_page_sk JOIN web_site ws ON cpg.cp_catalog_number = ws.web_mkt_id WHERE it.i_category_id IS NOT NULL AND cpg.cp_department IS NOT NULL AND ws.web_class <> 'Unknown' GROUP BY cpg.cp_department, it.i_category ORDER BY total_net_profit DESC, cpg.cp_department, it.i_category;
SELECT ca.ca_city, sm.sm_type AS shipping_type, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_quantity) AS total_web_quantity_sold, AVG(ws.ws_sales_price) AS average_web_sales_price, SUM(ws.ws_net_profit) AS total_web_net_profit, COUNT(DISTINCT cs.cs_order_number) AS total_catalog_orders, SUM(cs.cs_quantity) AS total_catalog_quantity_sold, AVG(cs.cs_sales_price) AS average_catalog_sales_price, SUM(cs.cs_net_profit) AS total_catalog_net_profit, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_net_loss) AS total_net_loss FROM customer_address ca LEFT JOIN web_sales ws ON ca.ca_address_sk = ws.ws_bill_addr_sk LEFT JOIN catalog_sales cs ON ca.ca_address_sk = cs.cs_bill_addr_sk LEFT JOIN store_returns sr ON ca.ca_address_sk = sr.sr_addr_sk LEFT JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk WHERE ca.ca_city IN ('Ruth', 'Tabor', 'Altamont', 'Morgantown', 'Hartland', 'Richville') AND (ws.ws_wholesale_cost IN (9.45, 10.23, 52.95, 12.11, 47.17) OR cs.cs_bill_customer_sk IN (79309, 53472, 7567, 9353, 49484) OR sr.sr_returned_date_sk IN (2452085, 2451229)) GROUP BY ca.ca_city, sm.sm_type ORDER BY ca.ca_city, shipping_type;
SELECT inv.inv_item_sk, SUM(inv.inv_quantity_on_hand) AS total_quantity_on_hand, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, COUNT(wr.wr_item_sk) AS count_returns, wp.wp_type FROM inventory inv LEFT JOIN web_returns wr ON inv.inv_item_sk = wr.wr_item_sk LEFT JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk WHERE inv.inv_date_sk = 2450815 AND wp.wp_type IN ('protected', 'feedback', 'ad', 'dynamic', 'welcome', 'general') AND wp.wp_max_ad_count IN (0, 1, 2) GROUP BY inv.inv_item_sk, wp.wp_type ORDER BY inv.inv_item_sk, wp.wp_type;
SELECT ws.web_site_id, ws.web_name, ws.web_manager, ws.web_gmt_offset, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_paid) AS total_revenue, AVG(cs_net_profit) AS average_profit, SUM(cr_return_amount) AS total_returns, AVG(cr_return_quantity) AS average_return_quantity, COUNT(DISTINCT cr_returned_date_sk) AS return_days_count, SUM(cd_purchase_estimate) AS total_purchase_estimate, AVG(cd_dep_count) AS average_dependents, COUNT(DISTINCT wp_web_page_sk) AS total_web_pages_accessed, SUM(wp_image_count) AS total_images_counted FROM web_site ws LEFT JOIN catalog_sales cs ON ws.web_site_sk = cs.cs_warehouse_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number AND cs.cs_item_sk = cr.cr_item_sk LEFT JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk LEFT JOIN web_page wp ON ws.web_site_sk = wp.wp_customer_sk WHERE ws.web_site_id IN ('AAAAAAAAKAAAAAAA', 'AAAAAAAAKBAAAAAA', 'AAAAAAAANAAAAAAA') AND ws.web_manager IN ('John Thomas', 'Charles Castillo', 'Jimmy Pope') AND ws.web_gmt_offset = '-5.00' AND cr.cr_ship_mode_sk IN ('2', '3', '12') AND cr.cr_refunded_hdemo_sk IN ('5787', '111', '6091') AND cr.cr_returning_customer_sk IN ('39980', '67407', '42477') AND cr.cr_returning_addr_sk IN ('22557', '8862', '28393') AND cd.cd_credit_rating IN ('Good', 'Unknown', 'Low Risk') AND cd.cd_purchase_estimate IN ('3500', '2500', '5500') AND cd.cd_dep_employed_count = '0' AND cd.cd_marital_status IN ('U', 'S', 'W') AND wp.wp_access_date_sk IN ('2452555', '2452619', '2452568') AND wp.wp_url = 'http://www.foo.com' AND wp.wp_image_count IN ('2', '3', '5') GROUP BY ws.web_site_id, ws.web_name, ws.web_manager, ws.web_gmt_offset ORDER BY total_revenue DESC, average_profit DESC;
SELECT cd.cd_education_status, ib.ib_income_band_sk, COUNT(DISTINCT ws.ws_order_number) AS number_of_orders, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_sales_price) AS average_sales_price FROM web_sales ws JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE cd.cd_purchase_estimate IS NOT NULL AND ib.ib_upper_bound <= 110000 AND ib.ib_income_band_sk IN (4, 1, 14, 13, 8) GROUP BY ROLLUP (cd.cd_education_status, ib.ib_income_band_sk) ORDER BY total_net_profit DESC, cd.cd_education_status, ib.ib_income_band_sk;
SELECT c.c_birth_country, sm.sm_type AS shipping_type, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_ext_tax) AS total_tax_collected, SUM(ws.ws_coupon_amt) AS total_coupon_amount, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk GROUP BY c.c_birth_country, sm.sm_type ORDER BY c.c_birth_country, sm.sm_type;
SELECT cc.cc_city, cc.cc_state, r.r_reason_desc, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, hd.hd_income_band_sk, COUNT(cr.cr_item_sk) AS total_returned_items, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_return_amt_inc_tax) AS total_amount_incl_tax, SUM(cr.cr_net_loss) AS total_net_loss, COUNT(DISTINCT p.p_promo_sk) AS total_promotions_impacted FROM catalog_returns cr LEFT JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk LEFT JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk LEFT JOIN customer_demographics cd ON cr.cr_returning_cdemo_sk = cd.cd_demo_sk LEFT JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk LEFT JOIN promotion p ON p.p_item_sk = cr.cr_item_sk AND p.p_channel_press = 'N' WHERE cr.cr_return_amount BETWEEN 300 AND 4500 AND r.r_reason_desc IN ('reason 24', 'reason 26', 'Parts missing', 'unauthoized purchase') AND cd.cd_purchase_estimate = 9000 GROUP BY cc.cc_city, cc.cc_state, r.r_reason_desc, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, hd.hd_income_band_sk ORDER BY total_return_amount DESC, total_returned_items DESC, cc.cc_city, cc.cc_state;
SELECT cc_state, COUNT(sr_ticket_number) AS num_of_returns, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_amt) AS avg_return_amount, AVG(sr_fee) AS avg_fee FROM store_returns sr JOIN date_dim dd ON sr.sr_returned_date_sk = dd.d_date_sk JOIN call_center cc ON sr.sr_store_sk = cc.cc_call_center_sk WHERE dd.d_year = 1900 GROUP BY cc_state ORDER BY total_return_amount DESC;
