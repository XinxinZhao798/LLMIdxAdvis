SELECT dd.d_year, cc.cc_country, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sales_price, COUNT(DISTINCT wp.wp_web_page_sk) AS webpage_count, SUM(ss.ss_net_paid) - SUM(ss.ss_net_paid_inc_tax) AS total_tax_collected FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN call_center cc ON cc.cc_call_center_sk = ss.ss_store_sk LEFT JOIN web_page wp ON dd.d_date_sk = wp.wp_access_date_sk WHERE dd.d_current_week = 'N' AND cc.cc_country = 'United States' AND cc.cc_call_center_sk IN ('3', '1', '5') AND wp.wp_image_count IN ('1', '2', '4', '5', '6', '7') GROUP BY dd.d_year, cc.cc_country ORDER BY dd.d_year, total_quantity_sold DESC;
SELECT i.i_category, ib.ib_income_band_sk, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_paid_inc_ship_tax) AS total_sales, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cr.cr_return_amount) AS total_returns, COUNT(DISTINCT cr.cr_order_number) AS total_return_orders FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN income_band ib ON c.c_current_cdemo_sk = ib.ib_income_band_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number WHERE cs.cs_sold_date_sk IS NOT NULL AND ( ib.ib_lower_bound IN (110001, 190001, 30001) OR ib.ib_income_band_sk IN (1, 9, 3) ) GROUP BY i.i_category, ib.ib_income_band_sk ORDER BY total_sales DESC, total_returns DESC;
SELECT i.i_category AS item_category, s.s_division_name AS store_division, AVG(i.i_current_price) AS avg_current_price, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages FROM item i JOIN store s ON i.i_manufact_id = s.s_store_sk LEFT JOIN catalog_page cp ON cp.cp_department = s.s_division_name GROUP BY item_category, store_division ORDER BY item_category, store_division;
SELECT ca.ca_state, ca.ca_country, COUNT(DISTINCT c.c_customer_sk) AS num_customers, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_return_tax) AS total_return_tax, AVG(sr.sr_return_amt) AS avg_return_amount_per_customer, SUM(sr.sr_net_loss) AS total_net_loss FROM customer c JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN income_band ib ON c.c_current_hdemo_sk = ib.ib_income_band_sk WHERE c.c_preferred_cust_flag = 'Y' AND ib.ib_income_band_sk IN (2, 6, 14, 17, 19) AND ib.ib_upper_bound <= 30000 GROUP BY ca.ca_state, ca.ca_country ORDER BY total_return_amount DESC, ca.ca_state, ca.ca_country;
SELECT i_category, i_class, COUNT(DISTINCT i_item_sk) AS num_items, AVG(i_current_price) AS avg_price, SUM(inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT wr_order_number) AS num_returns, SUM(wr_return_quantity) AS total_returned_quantity, SUM(wr_return_amt) AS total_return_amount, cd_gender, AVG(cd_purchase_estimate) AS avg_purchase_estimate, SUM(CASE WHEN cd_gender = 'M' THEN 1 ELSE 0 END) AS male_customers, SUM(CASE WHEN cd_gender = 'F' THEN 1 ELSE 0 END) AS female_customers, web_name, SUM(wr_return_amt_inc_tax) AS total_return_amount_incl_tax FROM item JOIN inventory ON i_item_sk = inv_item_sk JOIN web_returns ON i_item_sk = wr_item_sk JOIN customer_demographics ON wr_returning_cdemo_sk = cd_demo_sk JOIN web_site ON wr_web_page_sk = web_site_sk WHERE inv_date_sk = 2450815 AND i_rec_start_date >= '1997-08-16' AND (i_rec_end_date IS NULL OR i_rec_end_date > CURRENT_DATE) AND web_rec_start_date BETWEEN '1999-08-17' AND '2001-08-16' AND cd_dep_employed_count = 0 AND wr_returning_customer_sk IN (77230, 88571, 67431) GROUP BY i_category, i_class, cd_gender, web_name ORDER BY total_return_amount DESC, avg_price DESC, total_inventory DESC;
SELECT s.s_store_name, s.s_city, s.s_state, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_quantity) AS average_quantity_sold, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_ext_sales_price) AS total_sales, sm.sm_carrier, sm.sm_type, COUNT(DISTINCT ws.ws_item_sk) AS total_items_sold, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT ws.ws_bill_customer_sk) AS total_customers, cp.cp_department, cp.cp_catalog_number, COUNT(DISTINCT cp.cp_catalog_page_sk) AS total_catalog_pages FROM store s JOIN web_sales ws ON s.s_store_sk = ws.ws_warehouse_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN income_band ib ON ws.ws_bill_cdemo_sk = ib.ib_income_band_sk JOIN catalog_page cp ON ws.ws_web_page_sk = cp.cp_catalog_page_sk JOIN web_site w ON ws.ws_web_site_sk = w.web_site_sk WHERE s.s_company_id = '1' AND s.s_county = 'Williamson County' AND ws.ws_ship_addr_sk IN ('9319', '42828', '27709') AND ws.ws_net_profit IN ('1416.80', '918.75', '-485.10') AND sm.sm_carrier IN ('ZOUROS', 'HARMSTORF', 'GERMA') AND sm.sm_ship_mode_sk IN ('11', '3', '9') AND sm.sm_code IN ('BIKE', 'SURFACE', 'AIR') AND w.web_rec_start_date IN ('1999-08-17', '2001-08-16', '2000-08-16') AND w.web_suite_number IN ('Suite 130', 'Suite 150', 'Suite R') AND w.web_tax_percentage IN ('0.01', '0.10', '0.12') AND w.web_company_name IN ('able', 'cally', 'pri') AND ib.ib_upper_bound IN ('110000', '190000', '130000') AND ib.ib_income_band_sk IN ('8', '15', '6') AND ib.ib_lower_bound IN ('20001', '100001', '10001') AND cp.cp_catalog_number IN ('10', '44', '19') AND cp.cp_department = 'DEPARTMENT' AND cp.cp_catalog_page_number IN ('49', '102', '25') AND cp.cp_catalog_page_sk IN ('3484', '375', '1590') GROUP BY s.s_store_name, s.s_city, s.s_state, sm.sm_carrier, sm.sm_type, ib.ib_lower_bound, ib.ib_upper_bound, cp.cp_department, cp.cp_catalog_number ORDER BY total_net_profit DESC, total_sales DESC, total_orders DESC;
SELECT cc.cc_name, cc.cc_city, st.s_store_name, st.s_city, SUM(ss.ss_net_profit) AS total_net_profit, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_quantity) AS total_quantity_sold, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions FROM call_center AS cc JOIN store_sales AS ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN store AS st ON ss.ss_store_sk = st.s_store_sk WHERE cc.cc_rec_start_date >= '2020-01-01' AND cc.cc_rec_end_date <= '2020-12-31' AND ss.ss_wholesale_cost BETWEEN 40 AND 90 AND (st.s_city = 'Fairview' OR st.s_city = 'Midway') AND cc.cc_employees >= 3 GROUP BY cc.cc_name, cc.cc_city, st.s_store_name, st.s_city HAVING SUM(ss.ss_net_profit) > 0 ORDER BY total_net_profit DESC, average_sales_price DESC;
SELECT p.p_promo_name, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE cs.cs_sold_date_sk IN (SELECT d_date_sk FROM date_dim WHERE d_year = 2003) AND p.p_channel_email = 'Y' AND cs.cs_net_paid > 0 AND cs.cs_net_profit > 0 GROUP BY p.p_promo_name ORDER BY total_net_profit DESC, total_quantity_sold DESC;
SELECT r_reason_desc, w_state, COUNT(DISTINCT cr_order_number) AS total_catalog_returns, SUM(cr_return_quantity) AS total_returned_quantity, SUM(cr_return_amount) AS total_refund_amount, AVG(cr_return_amount) AS avg_refund_amount_per_return, SUM(cr_fee) AS total_fees, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns JOIN reason ON catalog_returns.cr_reason_sk = reason.r_reason_sk JOIN warehouse ON catalog_returns.cr_warehouse_sk = warehouse.w_warehouse_sk GROUP BY r_reason_desc, w_state ORDER BY total_refund_amount DESC, total_returned_quantity DESC;
SELECT w.w_warehouse_name, cc.cc_name AS call_center_name, cd.cp_department, sm.sm_type AS ship_mode_type, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_quantity) AS total_quantity_sold, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(CASE WHEN hd.hd_vehicle_count > 2 THEN ss.ss_net_paid ELSE 0 END) AS net_paid_more_than_2_vehicles, SUM(CASE WHEN cd.cp_type = 'quarterly' THEN ss.ss_net_paid_inc_tax ELSE 0 END) AS net_paid_inc_tax_for_quarterly_pages FROM store_sales ss JOIN warehouse w ON ss.ss_store_sk = w.w_warehouse_sk JOIN call_center cc ON w.w_zip = cc.cc_zip JOIN catalog_page cd ON ss.ss_promo_sk = cd.cp_catalog_page_sk JOIN ship_mode sm ON sm.sm_code = 'AIR' JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk WHERE cc.cc_street_type = 'Boulevard' AND cd.cp_type IN ('quarterly', 'bi-annual') AND w.w_suite_number IN ('Suite 80', 'Suite P') GROUP BY w.w_warehouse_name, cc.cc_name, cd.cp_department, sm.sm_type ORDER BY avg_sales_price DESC, total_quantity_sold DESC, unique_customers DESC, net_paid_more_than_2_vehicles DESC, net_paid_inc_tax_for_quarterly_pages DESC;
SELECT i.i_category AS item_category, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, COUNT(DISTINCT ws.ws_order_number) AS number_of_orders, COUNT(DISTINCT h.hd_demo_sk) AS number_of_customers_by_demographics, sm.sm_type AS shipping_type, AVG(inv.inv_quantity_on_hand) AS average_inventory_on_hand FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk JOIN household_demographics h ON ws.ws_bill_hdemo_sk = h.hd_demo_sk WHERE i.i_category_id BETWEEN 1 AND 5 AND ws.ws_ship_mode_sk IN (6, 4, 18, 1, 5, 8) AND inv.inv_warehouse_sk IN (1, 2) AND h.hd_income_band_sk IN (20, 11, 4) GROUP BY i.i_category, sm.sm_type ORDER BY total_net_profit DESC, item_category;
SELECT COUNT(DISTINCT cr.cr_item_sk) AS total_returned_items, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(ss.ss_quantity) AS total_sold_quantity, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ws.ws_quantity) AS total_web_sold_quantity, AVG(ws.ws_sales_price) AS average_web_sales_price FROM catalog_returns cr JOIN store_sales ss ON cr.cr_item_sk = ss.ss_item_sk JOIN web_sales ws ON cr.cr_item_sk = ws.ws_item_sk WHERE cr.cr_returned_date_sk IN (2450960, 2450989, 2451134, 2450922, 2451018) AND ws.ws_ext_discount_amt IN (415.26, 663.25) GROUP BY cr.cr_returned_date_sk;
SELECT d_year, web_name, COUNT(DISTINCT ws_order_number) AS total_orders, SUM(ws_quantity) AS total_quantity_sold, AVG(ws_net_paid_inc_tax) AS average_net_paid_inc_tax, SUM(ws_net_profit) AS total_net_profit FROM web_sales JOIN web_site ON web_sales.ws_web_site_sk = web_site.web_site_sk JOIN date_dim ON web_sales.ws_sold_date_sk = date_dim.d_date_sk WHERE d_year IN (1911, 1912) AND ws_net_paid_inc_tax > 100 AND ws_wholesale_cost < 100 AND web_sales.ws_web_site_sk IN ( SELECT web_site_sk FROM web_site WHERE web_class = 'Platinum' ) GROUP BY d_year, web_name ORDER BY total_net_profit DESC, d_year, web_name;
SELECT dd.d_year, dd.d_quarter_name, sm.sm_carrier, sm.sm_code, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_net_paid) AS total_revenue, AVG(cs.cs_net_profit) AS average_profit, SUM(cr.cr_return_quantity) AS total_quantity_returned, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_net_loss) AS average_net_loss, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT cr.cr_returning_customer_sk) AS total_returning_customers FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN income_band ib ON cs.cs_bill_cdemo_sk = ib.ib_income_band_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number AND cs.cs_item_sk = cr.cr_item_sk WHERE cs.cs_net_profit BETWEEN -140.39 AND 2770.24 AND cs.cs_ship_date_sk IN (2451009, 2450882, 2450900) AND sm.sm_carrier IN ('ORIENTAL', 'ZOUROS', 'ALLIANCE') AND sm.sm_code IN ('SURFACE', 'AIR', 'BIKE') AND ib.ib_upper_bound IN (140000, 130000, 30000) AND ib.ib_income_band_sk IN (4, 11, 1) AND ib.ib_lower_bound IN (160001, 100001, 170001) AND dd.d_date_id IN ('AAAAAAAAHBLNECAA', 'AAAAAAAAEDBOECAA', 'AAAAAAAADAKNECAA') AND dd.d_quarter_seq IN (21, 43, 22) AND dd.d_month_seq IN (135, 159, 125) AND dd.d_moy IN (4, 6, 7) AND cr.cr_order_number IN (3796, 710, 4775) AND cr.cr_return_tax IN (28.41, 24.46, 171.99) AND cr.cr_returning_customer_sk IN (14182, 22448, 94068) GROUP BY dd.d_year, dd.d_quarter_name, sm.sm_carrier, sm.sm_code, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_revenue DESC, average_profit DESC;
SELECT p.p_promo_name, p.p_purpose, COUNT(DISTINCT ss.ss_ticket_number) AS num_sales, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sale_price, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(DISTINCT sr.sr_ticket_number) AS num_returns, SUM(sr.sr_return_quantity) AS total_quantity_returned, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(sr.sr_net_loss) AS total_net_loss, (SUM(ss.ss_net_profit) - SUM(sr.sr_net_loss)) AS net_effect_of_promotions FROM promotion p LEFT JOIN store_sales ss ON p.p_promo_sk = ss.ss_promo_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number WHERE p.p_cost::decimal > 500.00 AND p.p_purpose <> 'Unknown' AND ss.ss_sold_date_sk IS NOT NULL AND sr.sr_returned_date_sk IS NOT NULL GROUP BY p.p_promo_name, p.p_purpose ORDER BY net_effect_of_promotions DESC;
SELECT p.p_promo_id, p.p_promo_name, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(DISTINCT ws.ws_item_sk) AS number_of_items_sold, SUM(cr.cr_return_amount) AS total_returns, COUNT(DISTINCT cr.cr_item_sk) AS number_of_items_returned FROM web_sales ws JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk LEFT JOIN catalog_returns cr ON ws.ws_item_sk = cr.cr_item_sk AND ws.ws_order_number = cr.cr_order_number JOIN item i ON ws.ws_item_sk = i.i_item_sk WHERE i.i_class_id = 4 AND c.c_birth_country IN ('GABON', 'ALBANIA', 'RUSSIAN FEDERATION', 'CHINA', 'BELGIUM', 'PORTUGAL') GROUP BY p.p_promo_id, p.p_promo_name ORDER BY total_net_profit DESC;
SELECT s.s_store_name, cp.cp_department, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(ss.ss_net_profit) AS total_net_profit, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN cs.cs_quantity ELSE 0 END) AS preferred_customer_quantity_sold, AVG(hd.hd_dep_count) AS average_household_dependency_count, AVG(hd.hd_vehicle_count) AS average_household_vehicle_count FROM store s JOIN store_sales ss ON ss.ss_store_sk = s.s_store_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN catalog_sales cs ON cs.cs_ship_customer_sk = c.c_customer_sk JOIN catalog_page cp ON cp.cp_catalog_page_sk = cs.cs_catalog_page_sk WHERE s.s_rec_end_date IS NULL AND ss.ss_sales_price BETWEEN 11.33 AND 139.32 AND ss.ss_quantity IN (11, 33) AND cs.cs_bill_addr_sk IN (20241, 24240, 324) GROUP BY s.s_store_name, cp.cp_department ORDER BY total_net_profit DESC, total_orders DESC LIMIT 10;
SELECT d.d_year, d.d_quarter_name, SUM(ss_net_profit) AS total_profit, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(wr_return_amt) AS total_returns, COUNT(DISTINCT wr_refunded_customer_sk) AS unique_refunded_customers, COUNT(wr_return_quantity) AS total_returned_items FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk LEFT JOIN web_returns wr ON ss.ss_item_sk = wr.wr_item_sk AND ss.ss_ticket_number = wr.wr_order_number WHERE d.d_year = 2002 AND ss.ss_ext_discount_amt > 0 GROUP BY d.d_year, d.d_quarter_name ORDER BY d.d_year, d.d_quarter_name;
