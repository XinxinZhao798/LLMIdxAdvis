SELECT i.i_category, i.i_class, i.i_brand, sum(ss.ss_quantity) AS total_quantity_sold, avg(ss.ss_sales_price) AS average_sales_price, sum(ss.ss_net_profit) AS total_net_profit, count(DISTINCT ss.ss_ticket_number) AS number_of_transactions, sum(ss.ss_coupon_amt) AS total_coupon_amount, ib.ib_lower_bound, ib.ib_upper_bound, date_dim.d_year, date_dim.d_quarter_name, COUNT(DISTINCT case when ss.ss_coupon_amt > 0 THEN ss.ss_ticket_number END) AS transactions_with_coupons FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN date_dim ON ss.ss_sold_date_sk = date_dim.d_date_sk WHERE date_dim.d_year IN (2019, 2020) AND ib.ib_lower_bound >= 0 AND ib.ib_upper_bound <= 130000 GROUP BY i.i_category, i.i_class, i.i_brand, ib.ib_lower_bound, ib.ib_upper_bound, date_dim.d_year, date_dim.d_quarter_name ORDER BY total_net_profit DESC, total_quantity_sold DESC LIMIT 100;
SELECT cc.cc_name, cc.cc_city, st.s_store_name, st.s_city, SUM(ss.ss_net_profit) AS total_net_profit, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_quantity) AS total_quantity_sold, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions FROM call_center AS cc JOIN store_sales AS ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN store AS st ON ss.ss_store_sk = st.s_store_sk WHERE cc.cc_rec_start_date >= '2020-01-01' AND cc.cc_rec_end_date <= '2020-12-31' AND ss.ss_wholesale_cost BETWEEN 40 AND 90 AND (st.s_city = 'Fairview' OR st.s_city = 'Midway') AND cc.cc_employees >= 3 GROUP BY cc.cc_name, cc.cc_city, st.s_store_name, st.s_city HAVING SUM(ss.ss_net_profit) > 0 ORDER BY total_net_profit DESC, average_sales_price DESC;
SELECT cd_gender, cd_marital_status, cd_education_status, cd_credit_rating, AVG(cd_purchase_estimate) AS avg_purchase_estimate, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_net_paid, SUM(ss_net_paid_inc_tax) AS total_net_paid_inc_tax, COUNT(DISTINCT ss_ticket_number) AS number_of_sales_tickets, COUNT(DISTINCT ss_customer_sk) AS number_of_customers FROM store_sales JOIN customer_demographics ON ss_cdemo_sk = cd_demo_sk JOIN time_dim ON ss_sold_time_sk = t_time_sk WHERE t_shift = 'Day' AND cd_credit_rating IN ('Good', 'Excellent') AND ss_sales_price >= 100 AND ss_sold_date_sk IS NOT NULL GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_credit_rating ORDER BY total_net_paid DESC, cd_gender, cd_marital_status;
SELECT reason.r_reason_desc AS Return_Reason, COUNT(DISTINCT web_returns.wr_order_number) AS Total_Returns, SUM(web_returns.wr_return_amt) AS Total_Return_Amount, AVG(web_returns.wr_return_amt) AS Average_Return_Amount, promotion.p_promo_name AS Promotion_Name, COUNT(DISTINCT promotion.p_promo_sk) AS Total_Promotions_Affected, ship_mode.sm_type AS Shipping_Type, COUNT(DISTINCT ship_mode.sm_ship_mode_sk) AS Total_Shipping_Modes_Used FROM web_returns JOIN reason ON web_returns.wr_reason_sk = reason.r_reason_sk LEFT JOIN promotion ON web_returns.wr_item_sk = promotion.p_item_sk JOIN web_page ON web_returns.wr_web_page_sk = web_page.wp_web_page_sk JOIN ship_mode ON web_returns.wr_order_number = ship_mode.sm_ship_mode_sk WHERE web_returns.wr_return_amt > 0 AND reason.r_reason_desc IN ('No service location in my area', 'Did not like the warranty', 'Stopped working') AND web_page.wp_link_count BETWEEN 15 AND 24 GROUP BY Return_Reason, Promotion_Name, Shipping_Type ORDER BY Total_Returns DESC, Total_Return_Amount DESC;
SELECT ca_state, sm_type, COUNT(DISTINCT ca_address_sk) AS num_addresses, AVG(w_warehouse_sq_ft) AS avg_warehouse_sq_ft, SUM(CASE WHEN ib_upper_bound <= 70000 THEN 1 ELSE 0 END) AS count_income_band_70k_and_below, SUM(CASE WHEN ib_upper_bound > 70000 AND ib_upper_bound <= 80000 THEN 1 ELSE 0 END) AS count_income_band_70k_to_80k FROM customer_address JOIN warehouse ON ca_county = w_county AND ca_state = w_state JOIN ship_mode ON ca_zip = LEFT(w_zip, 5) JOIN income_band ON ca_gmt_offset = w_gmt_offset WHERE ca_street_name IN ('Sixth 2nd', 'Lincoln 5th', '15th Broadway') AND sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') GROUP BY ca_state, sm_type ORDER BY ca_state, sm_type;
SELECT d_year, d_qoy, cc_name, COUNT(DISTINCT cr_order_number) AS num_returns, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, COUNT(DISTINCT sr_ticket_number) AS num_store_returns, SUM(sr_return_amt) AS total_store_return_amount, AVG(sr_return_amt) AS avg_store_return_amount, SUM(hd_dep_count) AS total_dependants, AVG(hd_vehicle_count) AS avg_vehicles FROM date_dim JOIN catalog_returns ON cr_returned_date_sk = d_date_sk JOIN call_center ON cr_call_center_sk = cc_call_center_sk JOIN store_returns ON sr_returned_date_sk = d_date_sk JOIN household_demographics ON cr_returning_hdemo_sk = hd_demo_sk AND sr_hdemo_sk = hd_demo_sk WHERE d_qoy = 2 AND d_following_holiday = 'Y' AND hd_income_band_sk = 15 AND (cr_item_sk IN (10036, 2977) OR sr_item_sk IN (10036, 2977)) AND (cr_refunded_customer_sk IN (78674, 95319, 63625, 45060, 53817, 43545) OR sr_customer_sk IN (78674, 95319, 63625, 45060, 53817, 43545)) AND cc_street_name IN ('Center Hill', 'Pine Ridge', 'Ash Hill') GROUP BY d_year, d_qoy, cc_name ORDER BY d_year, d_qoy, cc_name;
SELECT w_state, cd_education_status, SUM(inv_quantity_on_hand) AS total_inventory, AVG(sr_return_amt) AS avg_return_amount, COUNT(DISTINCT p_promo_sk) AS num_promotions, SUM(CASE WHEN wp_max_ad_count = 0 THEN 1 ELSE 0 END) AS num_pages_no_ads, AVG(cd_purchase_estimate) AS avg_purchase_estimate, SUM(sr_return_quantity) AS total_returned_quantity FROM warehouse w JOIN inventory i ON w.w_warehouse_sk = i.inv_warehouse_sk JOIN store_returns sr ON i.inv_item_sk = sr.sr_item_sk JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN promotion p ON p.p_item_sk = i.inv_item_sk JOIN web_page wp ON wp.wp_customer_sk = sr.sr_customer_sk WHERE w.w_gmt_offset = -5.00 AND w.w_zip = '35709' AND cd.cd_education_status IN ('4 yr Degree', 'Secondary', '2 yr Degree') AND sr.sr_cdemo_sk = 1839405 AND (wp.wp_max_ad_count = 3 OR wp.wp_max_ad_count = 0) AND wp.wp_rec_end_date = '2001-09-02' GROUP BY w_state, cd_education_status ORDER BY w_state, cd_education_status;
SELECT dd.d_year, dd.d_quarter_name, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, SUM(sr.sr_return_amt_inc_tax) AS total_store_return_value, AVG(sr.sr_return_amt_inc_tax) AS avg_store_return_value, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_returns, SUM(cr.cr_return_amt_inc_tax) AS total_catalog_return_value, AVG(cr.cr_return_amt_inc_tax) AS avg_catalog_return_value, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(inv.inv_quantity_on_hand) AS avg_inventory, COUNT(DISTINCT p.p_promo_sk) AS total_promotions, SUM(p.p_cost) AS total_promotion_cost, AVG(p.p_cost) AS avg_promotion_cost FROM date_dim dd LEFT JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk LEFT JOIN catalog_returns cr ON dd.d_date_sk = cr.cr_returned_date_sk LEFT JOIN inventory inv ON dd.d_date_sk = inv.inv_date_sk LEFT JOIN promotion p ON dd.d_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk WHERE dd.d_current_quarter = 'N' AND dd.d_dow IN ('2', '1', '3') AND dd.d_week_seq IN ('357', '270', '599') AND dd.d_day_name IN ('Friday', 'Wednesday', 'Thursday') AND cr.cr_refunded_cash IN ('41.98', '2827.18', '326.60') AND cr.cr_return_tax IN ('78.35', '1.90', '17.50') AND cr.cr_reason_sk IN ('10', '6', '34') AND inv.inv_date_sk = '2450815' AND inv.inv_quantity_on_hand IN ('527', '833', '192') AND sr.sr_store_credit IN ('65.83', '69.57', '46.64') AND sr.sr_return_amt_inc_tax IN ('1345.99', '37.28', '546.00') AND sr.sr_hdemo_sk IN ('5161', '6269', '797') AND p.p_channel_radio = 'N' AND p.p_channel_press = 'N' GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT ws.web_site_id, ws.web_class, ws.web_name, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(wr.wr_refunded_cash) AS total_refunded_cash, SUM(sr.sr_return_quantity) AS store_total_returned_quantity, AVG(sr.sr_return_amt_inc_tax) AS store_avg_return_amount_inc_tax, SUM(sr.sr_refunded_cash) AS store_total_refunded_cash FROM web_site ws JOIN web_page wp ON ws.web_site_sk = wp.wp_web_page_sk JOIN web_returns wr ON wp.wp_web_page_sk = wr.wr_web_page_sk LEFT JOIN store_returns sr ON wr.wr_item_sk = sr.sr_item_sk AND wr.wr_refunded_customer_sk = sr.sr_customer_sk WHERE ws.web_class = 'Unknown' AND ws.web_rec_end_date IN ('2001-08-15', '2000-08-15', '1999-08-16') AND wp.wp_rec_start_date IN ('2000-09-03', '2001-09-03', '1997-09-03') AND wp.wp_link_count IN (7, 11, 19) AND wr.wr_return_amt_inc_tax IN (43.31, 378.40, 532.83) AND wr.wr_refunded_cash IN (2425.04, 1694.98, 8.69) AND sr.sr_customer_sk IN (38344, 71012, 20816) AND sr.sr_cdemo_sk IN (1443482, 746161, 1430182) GROUP BY ws.web_site_id, ws.web_class, ws.web_name ORDER BY total_returns DESC, total_refunded_cash DESC;
SELECT d_year, d_quarter_name, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN date_dim ON catalog_sales.cs_sold_date_sk = date_dim.d_date_sk JOIN customer ON catalog_sales.cs_bill_customer_sk = customer.c_customer_sk JOIN warehouse ON catalog_sales.cs_warehouse_sk = warehouse.w_warehouse_sk WHERE d_year = 2003 AND d_quarter_seq IN (1, 27, 15, 31, 53, 21) AND c_birth_country = 'United States' AND w_country = 'United States' GROUP BY d_year, d_quarter_name ORDER BY d_year, d_quarter_name;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales, SUM(CASE WHEN p.p_discount_active = '1' THEN ss.ss_net_paid_inc_tax ELSE 0 END) AS total_revenue_with_discount, SUM(CASE WHEN p.p_discount_active = '0' THEN ss.ss_net_paid_inc_tax ELSE 0 END) AS total_revenue_without_discount FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE cc.cc_sq_ft IN ('1138', '4134', '649', '3514', '2268') AND ss.ss_net_paid_inc_tax IN ('3576.44', '1406.62', '935.06', '961.29', '3070.18', '6397.11') AND ss.ss_list_price = '158.68' GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_quantity_sold DESC, average_sales_price DESC;
SELECT cd.cd_gender, ib.ib_lower_bound AS income_lower_bound, ib.ib_upper_bound AS income_upper_bound, sm.sm_type AS shipping_type, COUNT(sr.sr_return_amt) AS total_returns, SUM(sr.sr_return_amt) AS total_value_of_returns, AVG(sr.sr_return_amt) AS average_return_value, SUM(sr.sr_return_quantity) AS total_quantity_returned FROM store_returns sr JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound JOIN ship_mode sm ON sm.sm_ship_mode_sk = sr.sr_item_sk WHERE sm.sm_type IN ('OVERNIGHT') AND cd.cd_gender IN ('M', 'F') GROUP BY cd.cd_gender, income_lower_bound, income_upper_bound, shipping_type ORDER BY total_value_of_returns DESC, total_returns DESC;
SELECT w_state, cp_department, COUNT(DISTINCT cr_order_number) AS num_returns, SUM(cr_return_quantity) AS total_returned_qty, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_amount) AS total_return_amount, SUM(cr_fee) AS total_fees, SUM(cr_return_ship_cost) AS total_shipping_cost, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns JOIN catalog_page ON catalog_returns.cr_catalog_page_sk = catalog_page.cp_catalog_page_sk JOIN warehouse ON catalog_returns.cr_warehouse_sk = warehouse.w_warehouse_sk GROUP BY w_state, cp_department ORDER BY total_return_amount DESC, total_net_loss DESC LIMIT 10;
SELECT ca_state, COUNT(DISTINCT c_customer_sk) AS total_customers, SUM(wr_return_amt_inc_tax) AS total_refunds, AVG(wr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT wr_order_number) AS total_return_orders, s_store_name, s_city, s_state FROM customer_address JOIN customer ON customer.c_current_addr_sk = customer_address.ca_address_sk JOIN web_returns ON customer_address.ca_address_sk = web_returns.wr_refunded_addr_sk JOIN store ON customer_address.ca_state = store.s_state WHERE customer.c_preferred_cust_flag = 'Y' AND web_returns.wr_returned_date_sk BETWEEN '20210101' AND '20211231' GROUP BY ca_state, s_store_name, s_city, s_state ORDER BY total_refunds DESC, avg_return_quantity DESC LIMIT 100;
SELECT c.c_birth_month, COUNT(DISTINCT ss.ss_customer_sk) AS total_customers_made_purchase, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_sales_price) AS avg_sale_amount, COUNT(DISTINCT cr.cr_returning_customer_sk) AS total_customers_made_return, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount FROM customer c LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_returning_customer_sk LEFT JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk AND cp.cp_catalog_page_number = 104 LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk LEFT JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk AND ws.web_open_date_sk = 2450628 WHERE c.c_birth_month IN (5, 6, 11) GROUP BY c.c_birth_month ORDER BY c.c_birth_month;
SELECT dd.d_year, ca.ca_state, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS order_count, SUM(cs.cs_net_paid_inc_tax) AS total_revenue_inc_tax, SUM(cs.cs_net_profit) AS total_profit FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON cs.cs_bill_addr_sk = ca.ca_address_sk JOIN store s ON ca.ca_state = s.s_state JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk WHERE dd.d_fy_year = 1912 GROUP BY dd.d_year, ca.ca_state ORDER BY total_revenue_inc_tax DESC, ca.ca_state;
SELECT r_reason_desc, w_state, COUNT(DISTINCT cr_order_number) AS total_catalog_returns, SUM(cr_return_quantity) AS total_returned_quantity, SUM(cr_return_amount) AS total_refund_amount, AVG(cr_return_amount) AS avg_refund_amount_per_return, SUM(cr_fee) AS total_fees, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns JOIN reason ON catalog_returns.cr_reason_sk = reason.r_reason_sk JOIN warehouse ON catalog_returns.cr_warehouse_sk = warehouse.w_warehouse_sk GROUP BY r_reason_desc, w_state ORDER BY total_refund_amount DESC, total_returned_quantity DESC;
