SELECT r.r_reason_desc, COUNT(DISTINCT sr.sr_ticket_number) AS num_store_returns, SUM(sr.sr_refunded_cash) AS total_store_refunded, AVG(sr.sr_return_amt_inc_tax) AS avg_store_return, COUNT(DISTINCT cr.cr_order_number) AS num_catalog_returns, SUM(cr.cr_refunded_cash) AS total_catalog_refunded, AVG(cr.cr_return_amt_inc_tax) AS avg_catalog_return FROM store_returns sr FULL OUTER JOIN catalog_returns cr ON sr.sr_reason_sk = cr.cr_reason_sk JOIN reason r ON r.r_reason_sk = sr.sr_reason_sk OR r.r_reason_sk = cr.cr_reason_sk LEFT JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk WHERE (sr.sr_customer_sk IN (67809, 3762, 6067) OR cr.cr_returning_hdemo_sk IN (6684, 3972, 3528, 1943, 4100, 4193)) AND (r.r_reason_id IN ('AAAAAAAANBAAAAAA', 'AAAAAAAADCAAAAAA', 'AAAAAAAAACAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAAFBAAAAAA', 'AAAAAAAAOBAAAAAA')) AND w.w_street_number = '651' AND w.w_county = 'Williamson County' GROUP BY r.r_reason_desc ORDER BY total_store_refunded DESC, total_catalog_refunded DESC;
SELECT s.s_store_id, s.s_store_name, d.d_year, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS preferred_customers, AVG(s.s_number_employees) AS average_employees, AVG(s.s_floor_space) AS average_floor_space, SUM(s.s_tax_precentage) AS total_tax_percentage FROM store s JOIN customer c ON s.s_store_sk = c.c_current_addr_sk JOIN date_dim d ON c.c_first_sales_date_sk = d.d_date_sk WHERE s.s_division_name <> 'Unknown' AND c.c_last_review_date_sk IN ('2452522', '2452308', '2452629', '2452335', '2452592', '2452622') AND c.c_first_name IN ('Tyler', 'Rhona', 'Mohammad') AND d.d_last_dom IN ('2417208', '2418853') AND d.d_following_holiday = 'Y' GROUP BY s.s_store_id, s.s_store_name, d.d_year ORDER BY total_customers DESC, preferred_customers DESC, average_employees DESC, average_floor_space DESC, total_tax_percentage DESC;
SELECT p.p_promo_name, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, AVG(sr.sr_return_amt) AS avg_return_amount, r.r_reason_desc AS most_common_return_reason, COUNT(*) AS reason_count FROM store_returns sr JOIN promotion p ON sr.sr_item_sk = p.p_item_sk JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk LEFT JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE sr.sr_store_sk IN (1, 4, 8) AND p.p_item_sk IN (13903, 4790, 11371, 10280, 11452) AND hd.hd_vehicle_count IN (3, 1) GROUP BY p.p_promo_name, r.r_reason_desc ORDER BY total_returns DESC, avg_return_amount DESC, reason_count DESC LIMIT 100;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_credit_rating, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, COUNT(sr.sr_ticket_number) AS total_returns FROM customer_demographics cd JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk WHERE hd.hd_buy_potential IN ('5001-10000', '>10000') AND sr.sr_reversed_charge > 50 GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_credit_rating HAVING AVG(cd.cd_purchase_estimate) > 500 ORDER BY avg_purchase_estimate DESC, total_return_amount_inc_tax DESC;
SELECT ca_state, EXTRACT(YEAR FROM d_date) AS sale_year, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, SUM(cs_ext_sales_price) AS total_sales, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_net_profit) AS total_profit FROM catalog_sales JOIN customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN date_dim ON cs_sold_date_sk = d_date_sk WHERE ca_country = 'United States' AND ca_state IN ('LA', 'NC', 'KS', 'MI') AND cs_ext_sales_price > 100.00 AND cs_ext_sales_price < 15000.00 AND d_year = 2022 AND d_moy BETWEEN 1 AND 6 GROUP BY ca_state, sale_year ORDER BY total_sales DESC;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_ext_discount_amt) AS avg_discount_amount, COUNT(DISTINCT ss.ss_ticket_number) AS total_tickets, COUNT(DISTINCT p.p_promo_sk) AS total_promotions FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE p.p_channel_dmail = 'Y' AND ss.ss_sold_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_sales DESC, avg_discount_amount DESC;
SELECT ws_site.web_market_manager, SUM(ws.ws_sales_price) AS total_sales, AVG(ws.ws_sales_price) AS average_sales, COUNT(ws.ws_order_number) AS number_of_orders, COUNT(DISTINCT ws.ws_item_sk) AS number_of_items_sold, SUM(sr.sr_return_amt) AS total_returns, AVG(sr.sr_return_amt) AS average_return_amount, COUNT(DISTINCT sr.sr_ticket_number) AS number_of_returns FROM web_sales ws JOIN web_site ws_site ON ws.ws_web_site_sk = ws_site.web_site_sk LEFT JOIN store_returns sr ON ws.ws_bill_customer_sk = sr.sr_customer_sk AND ws.ws_item_sk = sr.sr_item_sk WHERE ws_site.web_open_date_sk IN (2450594, 2450798, 2450747, 2450577, 2450807, 2450645) GROUP BY ws_site.web_market_manager ORDER BY total_sales DESC;
SELECT c.c_first_name, c.c_last_name, ca.ca_city, ca.ca_state, ca.ca_country, SUM(cs.cs_sales_price) AS total_sales, AVG(cs.cs_sales_price) AS average_sale_amount, COUNT(cs.cs_order_number) AS number_of_orders, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_return_amount) AS average_return_amount, COUNT(DISTINCT cr.cr_order_number) AS number_of_returns, SUM(cr.cr_net_loss) AS total_net_loss FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number AND cs.cs_item_sk = cr.cr_item_sk WHERE ca.ca_country = 'United States' AND ca.ca_gmt_offset IN ('-10.00', '-6.00', '-5.00') AND cs.cs_ext_list_price > 0 GROUP BY c.c_first_name, c.c_last_name, ca.ca_city, ca.ca_state, ca.ca_country HAVING SUM(cs.cs_sales_price) > 0 ORDER BY total_sales DESC, total_returns DESC LIMIT 100;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT hd.hd_demo_sk) AS household_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, SUM(CASE WHEN cp.cp_department = 'DEPARTMENT' THEN 1 ELSE 0 END) AS department_page_count, sm.sm_carrier, COUNT(DISTINCT sm.sm_ship_mode_sk) AS ship_mode_count FROM household_demographics hd JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk LEFT JOIN catalog_page cp ON cp.cp_catalog_number = hd.hd_income_band_sk AND cp.cp_catalog_page_number IN (100, 52, 68) LEFT JOIN ship_mode sm ON sm.sm_ship_mode_sk = hd.hd_vehicle_count AND sm.sm_carrier IN ('ORIENTAL', 'GREAT EASTERN', 'USPS') WHERE hd.hd_income_band_sk IN (7, 19, 4) AND hd.hd_dep_count IN (0, 4, 1) AND hd.hd_demo_sk IN (390, 179, 2543) AND ib.ib_upper_bound IN (130000, 160000, 20000) AND ib.ib_lower_bound IN (130001, 10001, 140001) AND sm.sm_contract IN ('qENFQ', 'I3uCelXtjP', 'GNJr3g5i7oorKqtX') GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_carrier ORDER BY ib.ib_upper_bound DESC, household_count DESC;
SELECT ib.ib_income_band_sk, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages, AVG(wp.wp_char_count) AS avg_char_count, SUM(wp.wp_link_count) AS total_link_count, AVG(wp.wp_image_count) AS avg_image_count, SUM(wr.wr_return_quantity) AS total_return_quantity, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_fee) AS avg_return_fee, SUM(wr.wr_net_loss) AS total_net_loss FROM income_band ib LEFT JOIN web_page wp ON wp.wp_customer_sk = ib.ib_income_band_sk LEFT JOIN web_returns wr ON wr.wr_web_page_sk = wp.wp_web_page_sk WHERE wp.wp_rec_start_date BETWEEN '1997-09-03' AND '2001-09-03' AND wp.wp_char_count > 4000 AND wr.wr_return_ship_cost BETWEEN 45.88 AND 361.10 GROUP BY ib.ib_income_band_sk ORDER BY ib.ib_income_band_sk;
SELECT c.c_birth_country, COUNT(DISTINCT c.c_customer_sk) AS total_customers, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_sq_ft FROM customer c JOIN warehouse w ON c.c_birth_country = w.w_country GROUP BY c.c_birth_country ORDER BY total_customers DESC, avg_warehouse_sq_ft DESC;
SELECT site.web_name AS website_name, COUNT(DISTINCT ss.ss_ticket_number) AS store_sales_transactions, COUNT(DISTINCT ws.ws_order_number) AS web_sales_transactions, SUM(ss.ss_net_paid_inc_tax) AS total_store_sales, SUM(ws.ws_net_paid_inc_ship_tax) AS total_web_sales, AVG(ss.ss_quantity) AS avg_store_quantity_sold, AVG(ws.ws_quantity) AS avg_web_quantity_sold, cp.cp_department AS department, SUM(CASE WHEN ss.ss_hdemo_sk IN (1437, 496, 6460, 2527, 4508, 4026) THEN ss.ss_net_profit ELSE 0 END) AS store_profit_from_selected_hdemo, SUM(CASE WHEN ws.ws_web_site_sk IN (SELECT web_site_sk FROM web_site WHERE web_company_id IN (3, 5, 2)) THEN ws.ws_net_profit ELSE 0 END) AS web_profit_from_selected_companies FROM store_sales ss FULL OUTER JOIN web_sales ws ON ss.ss_item_sk = ws.ws_item_sk AND ss.ss_sold_date_sk = ws.ws_sold_date_sk LEFT JOIN catalog_page cp ON ws.ws_web_page_sk = cp.cp_catalog_page_sk LEFT JOIN web_site site ON ws.ws_web_site_sk = site.web_site_sk WHERE (cp.cp_catalog_page_sk IN (10, 2795, 1844, 4860) OR cp.cp_catalog_page_sk IS NULL) GROUP BY site.web_name, cp.cp_department ORDER BY total_store_sales DESC, total_web_sales DESC;
SELECT ca_state, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, COUNT(*) AS return_count, SUM(ss_net_profit) AS total_store_sales_profit, AVG(ss_net_profit) AS avg_store_sales_profit, COUNT(DISTINCT ss_customer_sk) AS store_customer_count, SUM(ws_net_profit) AS total_web_sales_profit, AVG(ws_net_profit) AS avg_web_sales_profit, COUNT(DISTINCT ws_bill_customer_sk) AS web_customer_count FROM catalog_returns JOIN customer_address ON cr_returning_addr_sk = ca_address_sk JOIN store_sales ON catalog_returns.cr_item_sk = store_sales.ss_item_sk JOIN web_sales ON catalog_returns.cr_item_sk = web_sales.ws_item_sk JOIN promotion ON store_sales.ss_promo_sk = promotion.p_promo_sk AND web_sales.ws_promo_sk = promotion.p_promo_sk JOIN household_demographics ON (catalog_returns.cr_returning_hdemo_sk = household_demographics.hd_demo_sk OR store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk OR web_sales.ws_ship_hdemo_sk = household_demographics.hd_demo_sk) WHERE promotion.p_channel_demo = 'N' AND household_demographics.hd_income_band_sk IN (8, 10) AND household_demographics.hd_buy_potential IN ('>10000', 'Unknown', '0-500', '5001-10000', '1001-5000', '501-1000') AND catalog_returns.cr_reason_sk IN (9, 32, 23, 19) AND promotion.p_end_date_sk IN (2450545, 2450776) GROUP BY ca_state ORDER BY total_return_amount DESC;
SELECT c.c_customer_id AS customer_id, cd.cd_gender AS customer_gender, cd.cd_education_status AS customer_education_status, cd.cd_credit_rating AS customer_credit_rating, cd.cd_purchase_estimate AS estimated_purchase, SUM(cd.cd_dep_college_count) AS total_college_dependents, hd.hd_income_band_sk AS household_income_band, hd.hd_buy_potential AS household_buying_potential, COUNT(DISTINCT ws.web_site_id) AS number_of_websites_visited, AVG(ws.web_tax_percentage) AS average_tax_percentage FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN time_dim t ON c.c_first_shipto_date_sk = t.t_time_sk JOIN web_site ws ON c.c_current_addr_sk = ws.web_site_sk WHERE cd.cd_credit_rating = 'High' AND cd.cd_dep_college_count = 0 AND hd.hd_income_band_sk IN (10, 6, 17, 13, 15) AND hd.hd_buy_potential = '501-1000' AND t.t_sub_shift = 'night' AND t.t_minute IN (0, 30, 40) AND ws.web_gmt_offset = -5.00 AND ws.web_zip = '35709' GROUP BY c.c_customer_id, cd.cd_gender, cd.cd_education_status, cd.cd_credit_rating, cd.cd_purchase_estimate, hd.hd_income_band_sk, hd.hd_buy_potential ORDER BY estimated_purchase DESC, total_college_dependents DESC, household_income_band;
SELECT i.inv_item_sk, AVG(i.inv_quantity_on_hand) AS avg_quantity_on_hand, AVG(ws.ws_net_profit) AS avg_net_profit, SUM(ws.ws_net_paid_inc_ship_tax) AS total_sales, w.w_warehouse_name, COUNT(DISTINCT ws.ws_order_number) AS orders_count FROM inventory i JOIN warehouse w ON i.inv_warehouse_sk = w.w_warehouse_sk JOIN web_sales ws ON i.inv_item_sk = ws.ws_item_sk AND i.inv_warehouse_sk = ws.ws_warehouse_sk JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk WHERE i.inv_date_sk = '2450815' AND td.t_am_pm = 'AM' AND w.w_city = 'Fairview' AND w.w_warehouse_id = 'AAAAAAAAFAAAAAAA' GROUP BY i.inv_item_sk, w.w_warehouse_name ORDER BY avg_quantity_on_hand DESC, avg_net_profit DESC;
SELECT s_state, s_city, COUNT(DISTINCT s_store_sk) AS num_stores, SUM(inv_quantity_on_hand) AS total_inventory, AVG(cd_purchase_estimate) AS avg_purchase_estimate, COUNT(DISTINCT wp_web_page_sk) AS num_web_pages, SUM(wp_link_count) AS total_link_count, COUNT(CASE WHEN cd_credit_rating = 'High Risk' THEN 1 END) AS high_risk_customers, COUNT(CASE WHEN cd_credit_rating = 'Low Risk' THEN 1 END) AS low_risk_customers, AVG(cd_dep_count) AS avg_dep_count, SUM(cd_dep_employed_count) AS total_dep_employed_count, AVG(s_number_employees) AS avg_store_employees, AVG(s_floor_space) AS avg_store_floor_space FROM store LEFT JOIN inventory ON s_store_sk = inv_warehouse_sk LEFT JOIN customer_demographics ON s_market_id = cd_demo_sk LEFT JOIN web_page ON s_store_sk = wp_customer_sk WHERE s_rec_end_date IS NULL AND wp_char_count IN (1147, 1711, 6577) AND inv_quantity_on_hand IN (505, 375, 593, 141, 402, 949) AND s_suite_number IN ('Suite D', 'Suite 80', 'Suite 190', 'Suite 100') AND s_division_name = 'Unknown' AND cd_dep_employed_count = 0 AND cd_credit_rating IN ('High Risk', 'Low Risk', 'Good', 'Unknown') GROUP BY s_state, s_city ORDER BY s_state, s_city;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, hd.hd_buy_potential, hd.hd_dep_count, hd.hd_vehicle_count, r.r_reason_desc, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_return_amount) AS total_return_amount FROM catalog_returns cr JOIN customer_demographics cd ON cr.cr_returning_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN store s ON cr.cr_warehouse_sk = s.s_store_sk WHERE hd.hd_buy_potential IN ('5001-10000', '1001-5000', '>10000', '0-500', '501-1000') AND s.s_number_employees IN ('297', '294', '236', '245', '278') GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, hd.hd_buy_potential, hd.hd_dep_count, hd.hd_vehicle_count, r.r_reason_desc ORDER BY total_return_amount DESC, total_returned_quantity DESC, cd.cd_credit_rating, hd.hd_buy_potential;
SELECT st.s_store_name, wh.w_warehouse_name, pm.p_promo_name, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_customers_returned, SUM(cr.cr_fee) AS total_fees_collected, SUM(cr.cr_return_amt_inc_tax) AS total_return_with_tax, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN store st ON cr.cr_returning_addr_sk = st.s_store_sk JOIN warehouse wh ON cr.cr_warehouse_sk = wh.w_warehouse_sk JOIN promotion pm ON cr.cr_item_sk = pm.p_item_sk WHERE cr.cr_returned_date_sk IS NOT NULL AND st.s_hours IN ('8AM-12AM', '8AM-4PM') AND wh.w_county = 'Williamson County' AND wh.w_gmt_offset = '-5.00' AND pm.p_channel_tv = 'N' AND cr.cr_fee IN ('50.79', '65.23', '83.26', '68.14') AND cr.cr_returning_hdemo_sk IN ('6329', '1804', '2496') GROUP BY st.s_store_name, wh.w_warehouse_name, pm.p_promo_name ORDER BY total_returned_quantity DESC, average_return_amount DESC, unique_customers_returned DESC;
