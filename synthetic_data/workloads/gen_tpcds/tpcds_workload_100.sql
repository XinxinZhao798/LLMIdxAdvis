SELECT dd.d_year, dd.d_quarter_name, wa.w_country, ca.ca_state, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, AVG(cd.cd_purchase_estimate) AS avg_customer_purchase_estimate, SUM(CASE WHEN pr.p_channel_email = '1' THEN ws.ws_quantity ELSE 0 END) as total_quantity_sold_via_email, SUM(CASE WHEN pr.p_channel_tv = '1' THEN ws.ws_quantity ELSE 0 END) as total_quantity_sold_via_tv FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON ws.ws_bill_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN warehouse wa ON ws.ws_warehouse_sk = wa.w_warehouse_sk JOIN promotion pr ON ws.ws_promo_sk = pr.p_promo_sk WHERE dd.d_quarter_seq IN (25, 41) AND wa.w_country = 'United States' AND wa.w_street_name IN ('Ash Laurel', '6th', 'Wilson Elm', 'View First') AND cd.cd_purchase_estimate BETWEEN 1000 AND 5500 GROUP BY ROLLUP(dd.d_year, dd.d_quarter_name, wa.w_country, ca.ca_state) ORDER BY dd.d_year, dd.d_quarter_name, wa.w_country, ca.ca_state;
SELECT sm.sm_type AS shipping_type, web.web_site_sk AS website_id, web.web_name AS website_name, i.i_category AS product_category, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_incl_tax, SUM(ws.ws_net_paid_inc_ship) AS total_net_paid_incl_shipping, SUM(ws.ws_net_paid_inc_ship_tax) AS total_net_paid_incl_shipping_tax, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk WHERE sm.sm_type IN ('REGULAR', 'EXPRESS', 'OVERNIGHT') AND web.web_country = 'United States' AND ws.ws_warehouse_sk IN (2, 4) AND i.i_category IN ('Electronics', 'Women', 'Children', 'Home', 'Sports', 'Books') AND dd.d_year = 1999 GROUP BY shipping_type, website_id, website_name, product_category ORDER BY total_net_profit DESC, total_net_paid DESC, website_name, product_category;
SELECT c.cd_gender, c.cd_marital_status, c.cd_education_status, c.cd_credit_rating, AVG(c.cd_purchase_estimate) AS avg_purchase_estimate, SUM(c.cd_dep_count) AS total_dep_count, SUM(c.cd_dep_employed_count) AS total_dep_employed_count, SUM(c.cd_dep_college_count) AS total_dep_college_count, w.w_state, w.w_country, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_size, web.web_class, web.web_market_manager, COUNT(DISTINCT web.web_site_sk) AS num_websites, AVG(web.web_tax_percentage) AS avg_web_tax_percentage FROM customer_demographics c JOIN warehouse w ON c.cd_demo_sk = w.w_warehouse_sk JOIN web_site web ON w.w_state = web.web_state GROUP BY c.cd_gender, c.cd_marital_status, c.cd_education_status, c.cd_credit_rating, w.w_state, w.w_country, web.web_class, web.web_market_manager ORDER BY w.w_country, w.w_state, c.cd_education_status, c.cd_credit_rating;
SELECT c.c_customer_id, i.i_category, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(ss.ss_quantity) AS total_sales_quantity, SUM(ss.ss_net_paid) AS total_sales_net_paid, AVG(ss.ss_sales_price) AS avg_sales_price, (SUM(ss.ss_net_paid) - SUM(cr.cr_net_loss)) AS net_profit_after_returns FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN customer c ON cr.cr_returning_customer_sk = c.c_customer_sk JOIN store_sales ss ON i.i_item_sk = ss.ss_item_sk AND c.c_customer_sk = ss.ss_customer_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk WHERE ss.ss_hdemo_sk IN (863, 2132, 2496) GROUP BY c.c_customer_id, i.i_category ORDER BY net_profit_after_returns DESC, total_sales_net_paid DESC;
SELECT w_state, i_category, SUM(i_current_price * inv_quantity_on_hand) AS total_value, AVG(i_current_price) AS average_price, COUNT(DISTINCT i_item_sk) AS unique_items_count, COUNT(DISTINCT w_warehouse_sk) AS warehouses_count FROM inventory INNER JOIN item ON inventory.inv_item_sk = item.i_item_sk INNER JOIN warehouse ON inventory.inv_warehouse_sk = warehouse.w_warehouse_sk GROUP BY w_state, i_category ORDER BY total_value DESC, average_price DESC;
SELECT cc_state, i_category, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS avg_sales_price, COUNT(DISTINCT cs_order_number) AS unique_orders, SUM(ss_net_profit) AS total_store_profit, AVG(ss_wholesale_cost) AS avg_store_wholesale_cost, COUNT(DISTINCT ss_ticket_number) AS unique_store_tickets, SUM(inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT p_promo_sk) AS distinct_promotions FROM call_center JOIN catalog_sales ON cc_call_center_sk = cs_call_center_sk JOIN item ON cs_item_sk = i_item_sk JOIN store_sales ON ss_item_sk = i_item_sk JOIN inventory ON inv_item_sk = i_item_sk JOIN promotion ON (cs_promo_sk = p_promo_sk OR ss_promo_sk = p_promo_sk) JOIN store ON ss_store_sk = s_store_sk WHERE cc_mkt_id IN ('6', '2', '5') AND cc_state = 'TN' AND inv_item_sk IN ('15746', '11656', '6211', '11858') AND i_item_sk IN ('2579', '2638', '2347', '3924', '3976', '4905') AND s_store_sk IN ('8', '11', '6') GROUP BY cc_state, i_category;
SELECT s.s_store_name, d.d_year, d.d_quarter_name, SUM(ss.ss_wholesale_cost) AS total_wholesale_cost, SUM(ss.ss_list_price) AS total_list_price, SUM(ss.ss_sales_price) AS total_sales, AVG(ss.ss_sales_price) AS average_sales, COUNT(DISTINCT ss.ss_ticket_number) AS total_transactions, SUM(CASE WHEN p.p_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS promo_sales_count, SUM(CASE WHEN p.p_promo_sk IS NOT NULL THEN ss.ss_sales_price ELSE 0 END) AS promo_sales_amount, SUM(CASE WHEN d.d_weekend = 'Y' THEN ss.ss_quantity ELSE 0 END) AS weekend_quantity_sold, AVG(CASE WHEN d.d_weekend = 'Y' THEN ss.ss_sales_price ELSE NULL END) AS weekend_avg_sale_price FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE s.s_country = 'United States' AND d.d_year = 2000 AND d.d_quarter_seq BETWEEN 1 AND 4 GROUP BY s.s_store_name, d.d_year, d.d_quarter_name ORDER BY s.s_store_name, d.d_year, d.d_quarter_name;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_net_paid_inc_tax) AS avg_sales_inc_tax, COUNT(*) AS number_of_sales, SUM(ws.ws_quantity) AS total_web_quantity_sold, AVG(ws.ws_net_profit) AS avg_web_net_profit FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN web_sales ws ON cs.cs_item_sk = ws.ws_item_sk AND cs.cs_order_number = ws.ws_order_number JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk AND ws.ws_promo_sk = p.p_promo_sk WHERE cs.cs_ship_customer_sk IN (17646, 63607, 15126, 61460) AND p.p_discount_active = '1' AND cc.cc_rec_start_date <= CURRENT_DATE AND (cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date > CURRENT_DATE) GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_sales DESC LIMIT 10;
SELECT i_category, i_brand, i_class, i_size, ca_state, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_profit) AS total_profit FROM catalog_sales JOIN item ON cs_item_sk = i_item_sk JOIN customer_address ON cs_ship_addr_sk = ca_address_sk WHERE cs_sold_date_sk IS NOT NULL AND i_rec_start_date <= '1999-10-28' AND i_formulation IN ('47violet063986294269', '99894237tan735493935', '3tan0939360655141073', 'snow8893404317305605') AND cs_ext_discount_amt IN ('4923.36', '6952.68', '1512.42', '81.69') AND ca_state IN ('NY', 'CA', 'TX') GROUP BY i_category, i_brand, i_class, i_size, ca_state ORDER BY total_profit DESC, total_quantity_sold DESC LIMIT 100;
SELECT ca_state, ca_country, COUNT(DISTINCT ca_address_sk) AS num_addresses, SUM(p_cost) AS total_promotion_cost, AVG(p_cost) AS avg_promotion_cost, COUNT(DISTINCT p_promo_sk) AS num_promotions, COUNT(DISTINCT web_site_sk) AS num_websites, SUM(web_tax_percentage) AS total_tax_percentage, AVG(web_tax_percentage) AS avg_tax_percentage FROM customer_address JOIN promotion ON ca_address_sk = p_item_sk JOIN web_site ON ca_address_sk = web_mkt_id WHERE ca_state IN ('DE', 'NH', 'MI', 'MA', 'ID', 'NY') AND ca_country = 'United States' AND p_discount_active = '1' AND web_rec_start_date <= CURRENT_DATE AND (web_rec_end_date IS NULL OR web_rec_end_date >= CURRENT_DATE) GROUP BY ca_state, ca_country ORDER BY ca_state, ca_country;
SELECT d.d_year, d.d_quarter_name, s.s_state, sm.sm_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_net_paid) AS total_revenue, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_profit FROM catalog_sales cs JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN store s ON cs.cs_ship_addr_sk = s.s_store_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk WHERE d.d_year = (SELECT MAX(d_year) FROM date_dim) - 1 AND s.s_rec_end_date IS NULL GROUP BY d.d_year, d.d_quarter_name, s.s_state, sm.sm_type ORDER BY d.d_year, d.d_quarter_name, s.s_state, sm.sm_type;
SELECT cp.cp_department, i.i_category, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_quantity) AS total_return_quantity, r.r_reason_desc, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_customers_refunded, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_customers_returning, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk WHERE cp.cp_end_date_sk IN ('2451087', '2451239', '2450904', '2450844') GROUP BY cp.cp_department, i.i_category, r.r_reason_desc ORDER BY total_return_amount DESC, total_returns DESC LIMIT 100;
SELECT ib.ib_income_band_sk, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages, AVG(wp.wp_char_count) AS avg_char_count, SUM(wp.wp_link_count) AS total_link_count, AVG(wp.wp_image_count) AS avg_image_count, SUM(wr.wr_return_quantity) AS total_return_quantity, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_fee) AS avg_return_fee, SUM(wr.wr_net_loss) AS total_net_loss FROM income_band ib LEFT JOIN web_page wp ON wp.wp_customer_sk = ib.ib_income_band_sk LEFT JOIN web_returns wr ON wr.wr_web_page_sk = wp.wp_web_page_sk WHERE wp.wp_rec_start_date BETWEEN '1997-09-03' AND '2001-09-03' AND wp.wp_char_count > 4000 AND wr.wr_return_ship_cost BETWEEN 45.88 AND 361.10 GROUP BY ib.ib_income_band_sk ORDER BY ib.ib_income_band_sk;
SELECT td.t_shift, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, ib.ib_upper_bound, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws.ws_order_number) AS count_orders, SUM(wr.wr_return_quantity) AS total_quantity_returned, AVG(wr.wr_return_amt) AS average_return_amount, COUNT(DISTINCT wr.wr_order_number) AS count_returns FROM web_sales ws INNER JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk INNER JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk INNER JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk WHERE td.t_shift = 'third' AND td.t_sub_shift = 'night' AND (ib.ib_upper_bound = 10000 OR ib.ib_upper_bound = 20000 OR ib.ib_upper_bound = 130000) GROUP BY td.t_shift, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, ib.ib_upper_bound ORDER BY total_quantity_sold DESC, average_sales_price DESC;
SELECT cc.cc_division_name, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_paid_inc_tax) AS total_sales_revenue, AVG(ws.ws_net_paid_inc_tax) AS average_order_value, SUM(sr.sr_return_amt_inc_tax) AS total_returns_revenue, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns_count, (SUM(ws.ws_net_paid_inc_tax) - SUM(sr.sr_return_amt_inc_tax)) AS net_revenue_after_returns FROM call_center cc LEFT JOIN web_sales ws ON cc.cc_call_center_sk = ws.ws_web_site_sk LEFT JOIN store_returns sr ON ws.ws_item_sk = sr.sr_item_sk WHERE cc.cc_division_name IN ('ought', 'ese', 'pri', 'anti') AND ws.ws_sold_date_sk IS NOT NULL AND sr.sr_returned_date_sk IS NOT NULL GROUP BY cc.cc_division_name ORDER BY net_revenue_after_returns DESC;
SELECT cp.cp_department, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(ss.ss_ext_sales_price) AS total_sales, AVG(ss.ss_coupon_amt) AS avg_coupon_amount, AVG(ss.ss_sales_price) AS avg_sales_price FROM store_sales ss JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN catalog_page cp ON cp.cp_start_date_sk <= ss.ss_sold_date_sk AND cp.cp_end_date_sk >= ss.ss_sold_date_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE c.c_birth_year = 1981 AND ss.ss_coupon_amt > 0 AND t.t_shift = 'third' GROUP BY cp.cp_department ORDER BY total_sales DESC, avg_sales_price DESC;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, cd.cd_education_status, sum(cs.cs_quantity) as total_quantity_sold, avg(cs.cs_sales_price) as average_sales_price, count(distinct cs.cs_order_number) as number_of_orders, sum(cs.cs_net_profit) as total_net_profit FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE cd.cd_education_status IN ('College', 'Advanced Degree', '4 yr Degree') AND i.i_manager_id IN (69, 90) AND (cs.cs_sold_date_sk BETWEEN 2004001 AND 2004003 OR cs.cs_sold_date_sk BETWEEN 2004025 AND 2004028) AND (w.w_state = 'TN' OR w.w_country = 'United States') AND p.p_channel_email = 'Y' AND cs.cs_quantity >= 5 AND cs.cs_net_profit > 0 GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, cd.cd_education_status HAVING count(distinct cs.cs_order_number) > 1 ORDER BY total_net_profit DESC, number_of_orders DESC, cd.cd_education_status, c.c_last_name, c.c_first_name;
SELECT c.cc_name, c.cc_state, AVG(s.s_number_employees) as avg_store_employees, SUM(sr.sr_return_amt) as total_return_amount, SUM(sr.sr_return_quantity) as total_returned_quantity, COUNT(DISTINCT hd.hd_demo_sk) as unique_household_count, AVG(cd.cd_purchase_estimate) as avg_purchase_estimate FROM call_center c JOIN store s ON c.cc_state = s.s_state AND c.cc_mkt_id = s.s_market_id JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk WHERE c.cc_class = 'small' AND cd.cd_purchase_estimate > 5000 AND hd.hd_income_band_sk IS NOT NULL AND sr.sr_return_ship_cost > 100 AND sr.sr_returned_date_sk IS NOT NULL GROUP BY c.cc_name, c.cc_state ORDER BY total_return_amount DESC, avg_store_employees DESC, unique_household_count DESC;
SELECT c.c_customer_id, c.c_email_address, hd.hd_buy_potential, SUM(wr.wr_return_quantity) AS total_return_quantity, AVG(wr.wr_return_amt) AS avg_return_amount, COUNT(DISTINCT wr.wr_order_number) AS num_orders, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_return_ship_cost) AS total_shipping_cost, SUM(wr.wr_refunded_cash) AS total_refunded_cash, SUM(wr.wr_reversed_charge) AS total_reversed_charges, SUM(wr.wr_account_credit) AS total_account_credits, SUM(wr.wr_net_loss) AS total_net_loss FROM customer c JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk GROUP BY c.c_customer_id, c.c_email_address, hd.hd_buy_potential ORDER BY total_return_amount_inc_tax DESC LIMIT 100;
SELECT hd.hd_demo_sk, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, COUNT(DISTINCT wr.wr_order_number) AS total_web_returns, SUM(sr.sr_return_amt) AS total_store_return_amount, AVG(sr.sr_return_amt) AS avg_store_return_amount, SUM(wr.wr_return_amt) AS total_web_return_amount, AVG(wr.wr_return_amt) AS avg_web_return_amount, SUM(CASE WHEN p.p_channel_radio = 'N' AND p.p_channel_demo = 'N' THEN p.p_cost ELSE 0 END) AS non_radio_demo_promo_cost, AVG(CASE WHEN p.p_channel_radio = 'N' AND p.p_channel_demo = 'N' THEN p.p_response_target ELSE NULL END) AS avg_non_radio_demo_response_target FROM household_demographics hd LEFT JOIN store_returns sr ON hd.hd_demo_sk = sr.sr_hdemo_sk LEFT JOIN web_returns wr ON (hd.hd_demo_sk = wr.wr_refunded_hdemo_sk OR hd.hd_demo_sk = wr.wr_returning_hdemo_sk) LEFT JOIN promotion p ON p.p_promo_sk = sr.sr_reason_sk WHERE hd.hd_demo_sk IN (560, 4858) AND (sr.sr_store_sk IN (8, 10) OR sr.sr_store_sk IS NULL) GROUP BY hd.hd_demo_sk ORDER BY hd.hd_demo_sk;
SELECT d_year, cp_department, w_warehouse_name, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_quantity) AS total_quantity_sold, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk WHERE d_year IN (2019, 2020) AND cp_type = 'quarterly' AND w_warehouse_id IN ('AAAAAAAADAAAAAAA', 'AAAAAAAACAAAAAAA') GROUP BY d_year, cp_department, w_warehouse_name ORDER BY d_year DESC, total_net_profit DESC;
SELECT s_store_name AS store_name, s_state AS store_state, CONCAT(s_city, ', ', s_state) AS store_location, d_year AS sales_year, d_quarter_name AS sales_quarter, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_sales, AVG(ss_net_paid) AS average_sales_per_transaction, SUM(ss_net_paid_inc_tax) AS total_sales_including_tax, SUM(ss_ext_tax) AS total_tax_collected, COUNT(DISTINCT ss_customer_sk) AS unique_customers, COUNT(DISTINCT ss_ticket_number) AS total_transactions, SUM(wr_return_amt) AS total_returns, SUM(wr_fee) AS total_return_fees, AVG(wr_return_ship_cost) AS average_return_shipping_cost, COUNT(DISTINCT wr_refunded_customer_sk) AS unique_customers_returned, COUNT(DISTINCT wr_order_number) AS total_return_transactions, SUM(wr_net_loss) AS total_net_loss_from_returns, r_reason_desc AS most_common_return_reason FROM store_sales JOIN store ON ss_store_sk = s_store_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk LEFT JOIN web_returns ON ss_item_sk = wr_item_sk AND ss_ticket_number = wr_order_number LEFT JOIN reason ON wr_reason_sk = r_reason_sk WHERE s_state IN ('NY', 'CA') AND d_year = 2023 GROUP BY s_store_name, s_state, s_city, d_year, d_quarter_name, r_reason_desc ORDER BY total_sales DESC, total_quantity_sold DESC LIMIT 10;
SELECT cp.cp_department, dd.d_year, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount, AVG(cr.cr_return_quantity) AS avg_return_quantity, COUNT(cr.cr_order_number) AS total_returned_orders FROM catalog_returns cr JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN date_dim dd ON cr.cr_returned_date_sk = dd.d_date_sk JOIN household_demographics hd ON cr.cr_returning_cdemo_sk = hd.hd_demo_sk WHERE cp.cp_type = 'monthly' AND hd.hd_buy_potential = 'Unknown' GROUP BY cp.cp_department, dd.d_year ORDER BY total_return_amount DESC, cp.cp_department, dd.d_year;
SELECT c.ca_country, c.ca_city, i.i_category_id, i.i_category, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_net_paid) AS average_sales, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(cr.cr_return_quantity) AS total_quantity_returned, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_customers_returned FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN income_band ib ON ss.ss_hdemo_sk = ib.ib_income_band_sk JOIN customer_address c ON ss.ss_addr_sk = c.ca_address_sk LEFT JOIN catalog_returns cr ON cr.cr_order_number = ss.ss_ticket_number WHERE c.ca_country = 'United States' AND (c.ca_city = 'Gravel Hill' OR c.ca_city = 'Montague') AND (ib.ib_income_band_sk IN (1, 6, 19)) AND (ss.ss_cdemo_sk IN (854925, 898884, 94461)) GROUP BY c.ca_country, c.ca_city, i.i_category_id, i.i_category, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_sales DESC, i.i_category_id;
