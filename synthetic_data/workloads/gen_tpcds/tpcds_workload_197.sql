SELECT d_year, cp_department, COUNT(DISTINCT c_customer_sk) AS number_of_customers, SUM(cr_return_quantity) AS total_return_quantity, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_fee) AS total_fee, SUM(cr_return_amt_inc_tax) AS total_return_amount_inc_tax, p_promo_name, COUNT(DISTINCT p_promo_sk) AS number_of_promotions_used FROM date_dim, customer, catalog_page, catalog_returns LEFT JOIN promotion ON cr_item_sk = p_item_sk WHERE cr_returned_date_sk = d_date_sk AND cr_refunded_customer_sk = c_customer_sk AND cr_catalog_page_sk = cp_catalog_page_sk AND d_year = 2022 AND p_channel_details = 'Good, foreign problems will n' AND cp_department IN ('Books', 'Electronics') AND c_preferred_cust_flag = 'Y' GROUP BY d_year, cp_department, p_promo_name ORDER BY d_year, avg_return_amount DESC, total_return_quantity DESC;
SELECT c.c_birth_year, r.r_reason_desc, AVG(sr.sr_return_amt_inc_tax) AS avg_store_return_amount_inc_tax, AVG(wr.wr_return_amt_inc_tax) AS avg_web_return_amount_inc_tax, SUM(sr.sr_return_quantity) AS total_store_return_quantity, SUM(wr.wr_return_quantity) AS total_web_return_quantity, AVG(sr.sr_fee) AS avg_store_fee, AVG(wr.wr_fee) AS avg_web_fee, COUNT(DISTINCT sr.sr_customer_sk) AS num_customers_store, COUNT(DISTINCT wr.wr_refunded_customer_sk) AS num_customers_web FROM customer c LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_refunded_customer_sk LEFT JOIN reason r ON r.r_reason_sk = sr.sr_reason_sk OR r.r_reason_sk = wr.wr_reason_sk WHERE c.c_preferred_cust_flag = 'Y' AND (sr.sr_return_amt IS NOT NULL OR wr.wr_return_amt IS NOT NULL) GROUP BY c.c_birth_year, r.r_reason_desc ORDER BY c.c_birth_year, avg_store_return_amount_inc_tax DESC, avg_web_return_amount_inc_tax DESC;
SELECT cd.cd_education_status, cd.cd_credit_rating, AVG(sr.sr_return_amt) AS avg_store_return_amt, SUM(cr.cr_return_amount) AS sum_catalog_return_amt, COUNT(DISTINCT sr.sr_customer_sk) AS unique_store_customers, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_catalog_customers FROM customer_demographics cd LEFT JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk LEFT JOIN catalog_returns cr ON cd.cd_demo_sk = cr.cr_returning_cdemo_sk LEFT JOIN household_demographics hd ON cd.cd_demo_sk = hd.hd_demo_sk WHERE cd.cd_purchase_estimate IN (3500, 1500, 10000) AND cd.cd_dep_college_count = 0 AND hd.hd_income_band_sk IN (19, 8, 15, 3, 1) GROUP BY cd.cd_education_status, cd.cd_credit_rating ORDER BY avg_store_return_amt DESC, sum_catalog_return_amt DESC;
SELECT w.w_warehouse_name, w.w_warehouse_sq_ft, w.w_city, w.w_state, ib.ib_lower_bound, ib.ib_upper_bound, AVG(cs.cs_sales_price) AS avg_sales_price, AVG(cs.cs_ext_discount_amt) AS avg_discount_amount, SUM(cs.cs_quantity) AS total_quantity_sold, COUNT(DISTINCT cs.cs_order_number) AS total_orders, COUNT(DISTINCT p.p_promo_sk) AS total_promotions_applied FROM catalog_sales cs JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk JOIN income_band ib ON cs.cs_bill_customer_sk = ib.ib_income_band_sk WHERE d.d_year = 2021 AND w.w_county = 'Williamson County' AND p.p_discount_active = 'Y' AND p.p_response_target > 50 AND cs.cs_sales_price IS NOT NULL AND cs.cs_ext_discount_amt IS NOT NULL GROUP BY w.w_warehouse_name, w.w_warehouse_sq_ft, w.w_city, w.w_state, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY avg_sales_price DESC, avg_discount_amount DESC;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, AVG(cd.cd_dep_count) AS avg_dependents, AVG(cd.cd_dep_employed_count) AS avg_employed_dependents, AVG(cd.cd_dep_college_count) AS avg_college_dependents, COUNT(DISTINCT sr.sr_customer_sk) AS num_returning_customers, SUM(sr.sr_return_quantity) AS total_returned_quantity, SUM(sr.sr_return_amt) AS total_returned_amount, SUM(sr.sr_return_amt_inc_tax) AS total_returned_amount_inc_tax, AVG(sr.sr_return_amt) AS avg_return_amount, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, MAX(sr.sr_return_amt_inc_tax) AS max_return_amount_inc_tax, MIN(sr.sr_return_amt_inc_tax) AS min_return_amount_inc_tax, td.t_shift, COUNT(DISTINCT wp.wp_web_page_sk) AS num_web_pages, SUM(wp.wp_char_count) AS total_char_count FROM customer_demographics cd JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk JOIN time_dim td ON sr.sr_return_time_sk = td.t_time_sk LEFT JOIN web_page wp ON cd.cd_demo_sk = wp.wp_customer_sk WHERE cd.cd_gender = 'M' AND sr.sr_return_amt_inc_tax BETWEEN 8.31 AND 5055.81 AND wp.wp_url LIKE 'http://www.foo.com%' AND wp.wp_char_count IN (5676, 3034) GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, td.t_shift ORDER BY total_returned_amount_inc_tax DESC, avg_dependents DESC LIMIT 100;
SELECT i.i_category, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(wr.wr_return_quantity) AS total_quantity_returned, SUM(wr.wr_return_amt) AS total_return_amount, AVG(inv.inv_quantity_on_hand) AS average_inventory_on_hand FROM item i LEFT JOIN store_sales ss ON ss.ss_item_sk = i.i_item_sk LEFT JOIN web_returns wr ON wr.wr_item_sk = i.i_item_sk LEFT JOIN inventory inv ON inv.inv_item_sk = i.i_item_sk WHERE i.i_category IN ('Electronics', 'Clothing', 'Furniture') AND ss.ss_sold_date_sk BETWEEN 2451453 AND 2451553 AND wr.wr_returned_date_sk BETWEEN 2451453 AND 2451553 AND inv.inv_date_sk BETWEEN 2451453 AND 2451553 GROUP BY i.i_category ORDER BY total_quantity_sold DESC;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(wr.wr_return_quantity) AS total_quantity_returned, AVG(wr.wr_return_amt) AS average_return_amount, COUNT(DISTINCT wr.wr_order_number) AS number_of_return_transactions FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN web_returns wr ON ss.ss_item_sk = wr.wr_item_sk AND ss.ss_ticket_number = wr.wr_order_number WHERE cc.cc_mkt_class IN ('Silly particles could pro', 'Dealers make most historical, direct students', 'Wrong troops shall work sometimes in a opti', 'A bit narrow forms matter animals. Consist', 'More than other authori') AND cc.cc_sq_ft IN (795, 4134, 3514) AND wr.wr_refunded_addr_sk IN ('15506', '16033', '22303') AND ss.ss_item_sk IN (5893, 944) AND ss.ss_ticket_number IN (3473, 3634, 3530) GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_quantity_sold DESC, total_quantity_returned DESC;
SELECT c.c_salutation, SUM(ss.ss_quantity) AS store_sales_quantity, AVG(ss.ss_sales_price) AS store_sales_avg_price, SUM(cs.cs_quantity) AS catalog_sales_quantity, AVG(cs.cs_sales_price) AS catalog_sales_avg_price, SUM(ws.ws_quantity) AS web_sales_quantity, AVG(ws.ws_sales_price) AS web_sales_avg_price, AVG(hd.hd_dep_count) AS avg_household_dep_count, AVG(ib.ib_upper_bound) AS avg_income_upper_bound FROM customer c LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk LEFT JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk LEFT JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk LEFT JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE c.c_salutation IN ('Mr.', 'Miss', 'Sir') AND hd.hd_buy_potential IN ('5001-10000', 'Unknown', '501-1000', '0-500', '>10000') AND hd.hd_income_band_sk IN (1, 6, 12, 18) AND (ss.ss_sold_time_sk IN (50436, 48475, 51865) OR ss.ss_sold_time_sk IS NULL) AND (ss.ss_ext_wholesale_cost IN (3684.31, 3037.11, 5884.90, 4962.49, 1522.56, 3630.06) OR ss.ss_ext_wholesale_cost IS NULL) GROUP BY c.c_salutation ORDER BY c.c_salutation;
SELECT ca_state, ca_city, ca_country, EXTRACT(YEAR FROM TO_TIMESTAMP(t_time)) AS sale_year, COUNT(DISTINCT w_warehouse_sk) AS number_of_warehouses, SUM(w_warehouse_sq_ft) AS total_warehouse_area, AVG(w_warehouse_sq_ft) AS avg_warehouse_area, COUNT(DISTINCT ca_address_sk) AS number_of_customers, AVG(ca_gmt_offset) AS avg_gmt_offset FROM customer_address JOIN warehouse ON customer_address.ca_state = warehouse.w_state JOIN time_dim ON (warehouse.w_gmt_offset = -5 OR warehouse.w_street_name IN ('Ash Laurel', '6th', 'Wilson Elm', 'View First')) WHERE ca_country = 'United States' AND t_hour BETWEEN 8 AND 17 AND EXTRACT(ISODOW FROM TO_TIMESTAMP(t_time)) < 6 GROUP BY ca_state, ca_city, ca_country, sale_year ORDER BY ca_state, ca_city, sale_year;
SELECT ca.ca_state, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_return_quantity) AS total_return_quantity, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, COUNT(DISTINCT CASE WHEN c.c_preferred_cust_flag = 'Y' THEN sr.sr_ticket_number ELSE NULL END) AS preferred_customer_returns FROM store_returns sr JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE sr.sr_return_tax BETWEEN 5 AND 130 AND c.c_last_review_date_sk IN (2452499, 2452496, 2452479, 2452342) AND sr.sr_item_sk IN (13538, 16733, 1766, 2599, 3017, 9220) GROUP BY ca.ca_state ORDER BY total_return_amount DESC;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, COUNT(*) AS number_of_promotions, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(p.p_cost) AS average_promotion_cost, SUM(CASE WHEN p.p_discount_active = 'Y' THEN 1 ELSE 0 END) AS active_discounts FROM call_center cc JOIN promotion p ON cc.cc_call_center_sk = p.p_item_sk JOIN inventory inv ON p.p_item_sk = inv.inv_item_sk WHERE cc.cc_rec_end_date = '2000-12-31' AND inv.inv_date_sk = 2450815 AND inv.inv_quantity_on_hand IN (104, 11, 180) AND cc.cc_employees IN (1, 2, 3) GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY cc.cc_name, cc.cc_city, cc.cc_state;
SELECT c.cc_name, c.cc_class, c.cc_employees, c.cc_sq_ft, AVG(s.s_number_employees) AS avg_store_employees, AVG(s.s_floor_space) AS avg_store_floor_space, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(sr.sr_return_quantity) AS total_return_quantity, COUNT(DISTINCT hd.hd_demo_sk) AS distinct_household_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, SUM(ib.ib_upper_bound) AS total_income_upper_bound, COUNT(DISTINCT s.s_store_sk) AS distinct_store_count FROM call_center c LEFT JOIN store s ON c.cc_mkt_id = s.s_market_id LEFT JOIN store_returns sr ON sr.sr_store_sk = s.s_store_sk LEFT JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk LEFT JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE c.cc_sq_ft::integer > 3000 AND sr.sr_return_amt_inc_tax::numeric > 1.5 AND sr.sr_return_ship_cost::numeric BETWEEN 3.5 AND 1601.73 GROUP BY c.cc_name, c.cc_class, c.cc_employees, c.cc_sq_ft ORDER BY total_return_amount DESC, total_return_quantity DESC LIMIT 100;
SELECT ib.ib_lower_bound, ib.ib_upper_bound, COUNT(hd.hd_demo_sk) AS household_count, AVG(hd.hd_dep_count) AS average_dependency_count, AVG(hd.hd_vehicle_count) AS average_vehicle_count, SUM(CASE WHEN p.p_channel_email = 'N' THEN p.p_cost ELSE 0 END) AS total_cost_non_email_promotions, SUM(CASE WHEN p.p_channel_tv = 'Y' THEN 1 ELSE 0 END) AS number_of_tv_promotions, SUM(CASE WHEN p.p_discount_active = 'Y' THEN p.p_response_target ELSE 0 END) AS total_target_with_active_discount, COUNT(DISTINCT CASE WHEN r.r_reason_desc = 'reason 27' THEN hd.hd_demo_sk ELSE NULL END) AS count_households_reason_27 FROM household_demographics hd LEFT JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk LEFT JOIN promotion p ON hd.hd_demo_sk = p.p_item_sk LEFT JOIN reason r ON p.p_promo_sk = r.r_reason_sk WHERE hd.hd_income_band_sk IN (15, 9, 18, 20) AND p.p_purpose <> 'Unknown' AND ib.ib_lower_bound IN (110001, 100001, 130001) AND ib.ib_upper_bound <> 70000 GROUP BY ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ib.ib_lower_bound, ib.ib_upper_bound;
SELECT ca.ca_city, ca.ca_state, hd.hd_income_band_sk, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_net_paid) AS average_net_paid, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_including_tax, AVG(ws.ws_net_profit) AS average_net_profit FROM web_sales ws JOIN customer_address ca ON ws.ws_bill_addr_sk = ca.ca_address_sk JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk WHERE ca.ca_country = 'United States' AND (ca.ca_city IN ('Argyle', 'Collinsville', 'Ferguson') OR hd.hd_demo_sk IN (1967, 3880)) AND ws.ws_sold_time_sk IN (27944, 62910, 57271, 74886, 48677, 80582) AND ws.ws_net_paid_inc_tax >= 7202.65 GROUP BY ca.ca_city, ca.ca_state, hd.hd_income_band_sk ORDER BY total_net_paid_including_tax DESC, average_net_profit DESC;
