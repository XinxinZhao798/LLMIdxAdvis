SELECT p.p_promo_name, p.p_start_date_sk, p.p_end_date_sk, p.p_purpose, COUNT(DISTINCT cc.cc_call_center_sk) AS number_of_call_centers_involved, SUM(inv.inv_quantity_on_hand) AS total_inventory, SUM(wr.wr_return_quantity) AS total_returns, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_net_loss) AS total_net_loss FROM promotion p LEFT JOIN inventory inv ON p.p_item_sk = inv.inv_item_sk LEFT JOIN web_returns wr ON p.p_item_sk = wr.wr_item_sk LEFT JOIN call_center cc ON wr.wr_returned_date_sk BETWEEN cc.cc_open_date_sk AND cc.cc_closed_date_sk WHERE p.p_purpose <> 'Unknown' AND p.p_end_date_sk <= 2450916 GROUP BY p.p_promo_name, p.p_start_date_sk, p.p_end_date_sk, p.p_purpose ORDER BY total_returns DESC, avg_return_amount_inc_tax DESC LIMIT 100;
SELECT d_year, i_category, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(ss_net_profit) AS total_profit FROM store_sales JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk JOIN item ON store_sales.ss_item_sk = item.i_item_sk JOIN promotion ON store_sales.ss_promo_sk = promotion.p_promo_sk WHERE promotion.p_channel_event = 'N' AND item.i_manager_id = 40 AND item.i_container = 'Unknown' AND promotion.p_item_sk IN ('11194', '2314', '17593') AND EXISTS ( SELECT 1 FROM household_demographics WHERE household_demographics.hd_demo_sk = store_sales.ss_hdemo_sk AND household_demographics.hd_buy_potential IN ('>10000', 'Unknown') AND household_demographics.hd_vehicle_count IN ('3', '1', '0', '4', '2') ) GROUP BY d_year, i_category ORDER BY total_profit DESC, total_quantity_sold DESC;
SELECT w.w_state AS warehouse_state, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_profit) AS total_net_profit, COUNT(DISTINCT cr.cr_order_number) AS total_returns, AVG(cr.cr_return_amount) AS average_return_amount FROM web_sales ws LEFT JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk LEFT JOIN catalog_returns cr ON ws.ws_item_sk = cr.cr_item_sk AND ws.ws_order_number = cr.cr_order_number WHERE ws.ws_sold_date_sk = 2450976 GROUP BY w.w_state ORDER BY total_net_profit DESC;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, cd.cd_education_status, sum(cs.cs_quantity) as total_quantity_sold, avg(cs.cs_sales_price) as average_sales_price, count(distinct cs.cs_order_number) as number_of_orders, sum(cs.cs_net_profit) as total_net_profit FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE cd.cd_education_status IN ('College', 'Advanced Degree', '4 yr Degree') AND i.i_manager_id IN (69, 90) AND (cs.cs_sold_date_sk BETWEEN 2004001 AND 2004003 OR cs.cs_sold_date_sk BETWEEN 2004025 AND 2004028) AND (w.w_state = 'TN' OR w.w_country = 'United States') AND p.p_channel_email = 'Y' AND cs.cs_quantity >= 5 AND cs.cs_net_profit > 0 GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, cd.cd_education_status HAVING count(distinct cs.cs_order_number) > 1 ORDER BY total_net_profit DESC, number_of_orders DESC, cd.cd_education_status, c.c_last_name, c.c_first_name;
SELECT i_category, i_class, i_brand, SUM(i_current_price) AS total_sales_value, AVG(i_current_price) AS avg_sales_price, COUNT(DISTINCT i_item_sk) AS unique_items_sold, COUNT(DISTINCT c_customer_sk) AS unique_customers, c_birth_country, AVG(EXTRACT(YEAR FROM AGE(MAKE_DATE(c_birth_year, c_birth_month, c_birth_day)))) AS avg_customer_age FROM item JOIN customer ON i_manager_id = c_current_addr_sk JOIN time_dim ON t_time_sk = c_first_sales_date_sk WHERE i_rec_start_date <= NOW() AND (i_rec_end_date IS NULL OR i_rec_end_date > NOW()) AND c_preferred_cust_flag = 'Y' AND t_minute IN ('6', '3', '48', '49') GROUP BY ROLLUP(i_category, i_class, i_brand, c_birth_country) ORDER BY total_sales_value DESC, unique_items_sold DESC, i_category, i_class, i_brand, c_birth_country;
SELECT ws.ws_web_site_sk, ws.ws_web_page_sk, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, w.w_warehouse_name, w.w_county, cd.cd_gender, cd.cd_education_status, cd.cd_credit_rating, COUNT(DISTINCT cd.cd_demo_sk) AS unique_customers FROM web_sales ws JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk WHERE ws.ws_web_page_sk IN ('8', '48', '14', '26', '5') AND w.w_street_name IN ('Ash Laurel', '6th', 'Wilson Elm', 'View First') AND w.w_county = 'Williamson County' AND cd.cd_credit_rating IN ('High Risk', 'Low Risk', 'Good', 'Unknown') GROUP BY ws.ws_web_site_sk, ws.ws_web_page_sk, w.w_warehouse_name, w.w_county, cd.cd_gender, cd.cd_education_status, cd.cd_credit_rating ORDER BY total_net_profit DESC, total_net_paid DESC;
SELECT i_category, i_class, w_city, p_promo_name, SUM(ws_quantity) AS total_quantity_sold, AVG(ws_sales_price) AS average_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_paid_inc_tax) AS total_net_paid_inc_tax, COUNT(DISTINCT ws_order_number) AS total_orders, COUNT(DISTINCT ws_bill_cdemo_sk) AS total_unique_customers FROM web_sales JOIN item ON ws_item_sk = i_item_sk JOIN warehouse ON ws_warehouse_sk = w_warehouse_sk JOIN promotion ON ws_promo_sk = p_promo_sk JOIN customer_demographics ON ws_bill_cdemo_sk = cd_demo_sk WHERE w_city = 'Fairview' AND p_cost = 1000.00 AND p_channel_demo = 'N' GROUP BY i_category, i_class, w_city, p_promo_name ORDER BY total_net_paid DESC, total_quantity_sold DESC;
SELECT cs_state, SUM(cs_total_sales) AS total_sales, SUM(cr_total_returns) AS total_returns, (SUM(cs_net_profit) - SUM(cr_net_loss)) AS net_profit FROM (SELECT ca_state AS cs_state, SUM(ss_ext_sales_price) AS cs_total_sales, SUM(ss_net_profit) AS cs_net_profit FROM store_sales JOIN customer ON ss_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk GROUP BY ca_state) sales LEFT JOIN (SELECT ca_state AS cr_state, SUM(cr_return_amount) AS cr_total_returns, SUM(cr_net_loss) AS cr_net_loss FROM catalog_returns JOIN customer ON cr_returning_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk GROUP BY ca_state) returns ON sales.cs_state = returns.cr_state GROUP BY cs_state ORDER BY net_profit DESC;
SELECT p.p_promo_name AS promotion_name, i.ib_lower_bound AS income_band_lower_bound, i.ib_upper_bound AS income_band_upper_bound, COUNT(DISTINCT c.cd_demo_sk) AS number_of_customers, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ws.ws_net_paid_inc_tax) AS web_total_net_paid_inc_tax, COUNT(DISTINCT cp.cp_catalog_page_sk) AS number_of_catalog_pages_used, COUNT(DISTINCT inv.inv_item_sk) AS number_of_items_sold FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN customer_demographics c ON ss.ss_cdemo_sk = c.cd_demo_sk JOIN income_band i ON c.cd_purchase_estimate BETWEEN i.ib_lower_bound AND i.ib_upper_bound JOIN web_sales ws ON ss.ss_item_sk = ws.ws_item_sk AND ss.ss_customer_sk = ws.ws_bill_customer_sk JOIN catalog_page cp ON ws.ws_web_page_sk = cp.cp_catalog_page_sk JOIN inventory inv ON ws.ws_item_sk = inv.inv_item_sk WHERE p.p_discount_active = 'Y' AND ss.ss_sold_date_sk BETWEEN 2451271 AND 2451575 AND cp.cp_start_date_sk BETWEEN 2451088 AND 2451420 AND inv.inv_quantity_on_hand > 0 GROUP BY promotion_name, income_band_lower_bound, income_band_upper_bound ORDER BY total_net_paid DESC, number_of_customers DESC;
