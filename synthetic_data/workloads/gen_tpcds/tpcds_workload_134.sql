SELECT dd.d_year, dd.d_quarter_name, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, COUNT(DISTINCT ca.ca_city) AS number_of_cities, COUNT(DISTINCT ws.web_site_sk) AS number_of_websites, SUM(cr.cr_return_quantity) AS total_return_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_net_loss) AS total_net_loss FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk JOIN web_site ws ON ws.web_open_date_sk = dd.d_date_sk LEFT JOIN catalog_returns cr ON cr.cr_returned_date_sk = dd.d_date_sk WHERE dd.d_year IN (2001, 2002) AND ca.ca_street_number = '789' AND ws.web_city IN ('Fairview', 'Midway') AND dd.d_quarter_seq IN (20, 49, 51) AND cr.cr_reason_sk IS NOT NULL AND EXISTS (SELECT 1 FROM reason WHERE cr_reason_sk = r_reason_sk AND r_reason_desc IN ('Gift exchange', 'Found a better price in a store', 'Not the product that was ordred')) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT wp.wp_type AS web_page_type, i.i_brand AS item_brand, ca.ca_state AS customer_state, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_items_sold, SUM(ws.ws_sales_price) AS total_sales, AVG(i.i_wholesale_cost) AS average_wholesale_cost FROM web_sales ws JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN customer_address ca ON ws.ws_ship_addr_sk = ca.ca_address_sk WHERE wp.wp_autogen_flag = 'Y' AND wp.wp_type IN ('order', 'dynamic') AND i.i_brand IN ('brandunivamalg #10', 'scholarbrand #7', 'maxibrand #2') GROUP BY web_page_type, item_brand, customer_state ORDER BY total_sales DESC, total_orders DESC LIMIT 10;
SELECT dd.d_year, dd.d_quarter_name, sm.sm_carrier, sm.sm_code, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_net_paid) AS total_revenue, AVG(cs.cs_net_profit) AS average_profit, SUM(cr.cr_return_quantity) AS total_quantity_returned, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_net_loss) AS average_net_loss, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT cr.cr_returning_customer_sk) AS total_returning_customers FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN income_band ib ON cs.cs_bill_cdemo_sk = ib.ib_income_band_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number AND cs.cs_item_sk = cr.cr_item_sk WHERE cs.cs_net_profit BETWEEN -140.39 AND 2770.24 AND cs.cs_ship_date_sk IN (2451009, 2450882, 2450900) AND sm.sm_carrier IN ('ORIENTAL', 'ZOUROS', 'ALLIANCE') AND sm.sm_code IN ('SURFACE', 'AIR', 'BIKE') AND ib.ib_upper_bound IN (140000, 130000, 30000) AND ib.ib_income_band_sk IN (4, 11, 1) AND ib.ib_lower_bound IN (160001, 100001, 170001) AND dd.d_date_id IN ('AAAAAAAAHBLNECAA', 'AAAAAAAAEDBOECAA', 'AAAAAAAADAKNECAA') AND dd.d_quarter_seq IN (21, 43, 22) AND dd.d_month_seq IN (135, 159, 125) AND dd.d_moy IN (4, 6, 7) AND cr.cr_order_number IN (3796, 710, 4775) AND cr.cr_return_tax IN (28.41, 24.46, 171.99) AND cr.cr_returning_customer_sk IN (14182, 22448, 94068) GROUP BY dd.d_year, dd.d_quarter_name, sm.sm_carrier, sm.sm_code, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_revenue DESC, average_profit DESC;
SELECT c.c_customer_id, AVG(ss.ss_net_profit) AS avg_net_profit, SUM(sr.sr_return_amt_inc_tax) AS total_returns, COUNT(DISTINCT ws.web_site_sk) AS number_of_websites, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid_inc_tax) AS total_sales_inc_tax FROM customer c LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk LEFT JOIN web_site ws ON ws.web_zip = c.c_current_addr_sk::character varying WHERE (ss.ss_hdemo_sk IN ('4776', '3144', '2508', '6460') OR c.c_current_hdemo_sk IN ('5414', '1065', '4963', '3942', '5655', '758')) AND (ws.web_zip IN ('35709', '31904') OR ws.web_rec_end_date IN ('1999-08-16', '2000-08-15', '2001-08-15')) GROUP BY c.c_customer_id ORDER BY avg_net_profit DESC, total_returns DESC, number_of_websites DESC, total_quantity_sold DESC, total_sales_inc_tax DESC;
SELECT sm.sm_type AS shipping_mode_type, sm.sm_carrier AS carrier, cp.cp_department AS catalog_department, COUNT(DISTINCT wr.wr_order_number) AS number_of_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_return_tax) AS total_tax, SUM(wr.wr_return_ship_cost) AS total_shipping_cost, SUM(wr.wr_net_loss) AS total_net_loss FROM web_returns wr JOIN ship_mode sm ON wr.wr_returned_date_sk = sm.sm_ship_mode_sk JOIN catalog_page cp ON wr.wr_web_page_sk = cp.cp_catalog_page_sk WHERE wr.wr_returned_date_sk = 2451368 AND cp.cp_catalog_page_sk IN ('859', '3510', '105', '4419') GROUP BY shipping_mode_type, carrier, catalog_department ORDER BY total_net_loss DESC;
SELECT i.i_category AS item_category, AVG(i.i_current_price) AS avg_current_price, COUNT(i.i_item_sk) AS total_item_count, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, AVG(cd.cd_purchase_estimate) FILTER (WHERE cd.cd_credit_rating = 'Good') AS avg_good_credit_purchase_estimate, AVG(cd.cd_purchase_estimate) FILTER (WHERE cd.cd_credit_rating = 'High Risk') AS avg_high_risk_credit_purchase_estimate, AVG(cd.cd_purchase_estimate) FILTER (WHERE cd.cd_credit_rating = 'Low Risk') AS avg_low_risk_credit_purchase_estimate FROM item i JOIN promotion p ON i.i_item_sk = p.p_item_sk JOIN customer c ON p.p_start_date_sk <= c.c_first_sales_date_sk AND p.p_end_date_sk >= c.c_first_sales_date_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk WHERE i.i_category IN ('Home', 'Electronics', 'Sports') AND c.c_first_sales_date_sk = '2452263' AND p.p_discount_active = '1' GROUP BY i.i_category ORDER BY avg_current_price DESC;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address, SUM(cr.cr_return_amount) AS total_catalog_returns, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_return_orders, AVG(cr.cr_return_quantity) AS avg_catalog_return_quantity, SUM(wr.wr_return_amt) AS total_web_returns, COUNT(DISTINCT wr.wr_order_number) AS total_web_return_orders, AVG(wr.wr_return_quantity) AS avg_web_return_quantity, SUM(ws.ws_sales_price) AS total_web_sales, AVG(ws.ws_quantity) AS avg_web_sales_quantity, COUNT(DISTINCT ws.ws_order_number) AS total_web_sales_orders, SUM(ws.ws_net_profit) AS total_web_net_profit FROM customer c LEFT JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_returning_customer_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk LEFT JOIN web_sales ws ON c.c_customer_sk = ws.ws_ship_customer_sk GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address ORDER BY total_web_net_profit DESC, total_catalog_returns DESC, total_web_returns DESC LIMIT 100;
SELECT cd.cd_education_status, cd.cd_credit_rating, COUNT(c.c_customer_sk) AS total_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(cd.cd_dep_count) AS total_dependents, SUM(cd.cd_dep_employed_count) AS employed_dependents, SUM(cd.cd_dep_college_count) AS college_dependents FROM customer_demographics cd JOIN customer c ON cd.cd_demo_sk = c.c_current_cdemo_sk LEFT JOIN promotion p ON c.c_current_hdemo_sk = p.p_promo_sk WHERE cd.cd_credit_rating IN ('High Risk', 'Low Risk', 'Good', 'Unknown') AND c.c_last_review_date_sk IN (2452297, 2452588) GROUP BY cd.cd_education_status, cd.cd_credit_rating ORDER BY cd.cd_education_status, cd.cd_credit_rating;
SELECT c.cp_department AS department, i.i_category AS category, COUNT(DISTINCT c.cp_catalog_page_sk) AS num_catalog_pages, COUNT(DISTINCT i.i_item_sk) AS num_items, AVG(i.i_current_price) AS avg_current_price, SUM(i.i_wholesale_cost * i.i_units::int) AS total_wholesale_cost, w.web_name AS website_name, COUNT(DISTINCT w.web_site_sk) AS num_websites, AVG(w.web_tax_percentage) AS avg_tax_percentage FROM catalog_page c JOIN item i ON c.cp_catalog_page_sk = i.i_item_sk JOIN web_site w ON c.cp_department = w.web_class WHERE i.i_category IN ('Shoes', 'Home') AND i.i_rec_start_date <= CURRENT_DATE AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date > CURRENT_DATE) AND w.web_rec_start_date <= CURRENT_DATE AND (w.web_rec_end_date IS NULL OR w.web_rec_end_date > CURRENT_DATE) GROUP BY c.cp_department, i.i_category, w.web_name ORDER BY department, category, website_name;
SELECT w_state, cp_department, COUNT(DISTINCT cr_order_number) AS num_returns, SUM(cr_return_quantity) AS total_returned_qty, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_amount) AS total_return_amount, SUM(cr_fee) AS total_fees, SUM(cr_return_ship_cost) AS total_shipping_cost, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns JOIN catalog_page ON catalog_returns.cr_catalog_page_sk = catalog_page.cp_catalog_page_sk JOIN warehouse ON catalog_returns.cr_warehouse_sk = warehouse.w_warehouse_sk GROUP BY w_state, cp_department ORDER BY total_return_amount DESC, total_net_loss DESC LIMIT 10;
SELECT dd.d_year, dd.d_month_seq, dd.d_quarter_seq, cc.cc_class, SUM(sr.sr_return_amt) AS total_store_returns, AVG(sr.sr_return_quantity) AS avg_store_return_quantity, COUNT(DISTINCT sr.sr_ticket_number) AS count_store_return_tickets, SUM(wr.wr_return_amt) AS total_web_returns, AVG(wr.wr_return_quantity) AS avg_web_return_quantity, COUNT(DISTINCT wr.wr_order_number) AS count_web_return_orders FROM date_dim dd JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk JOIN web_returns wr ON dd.d_date_sk = wr.wr_returned_date_sk JOIN call_center cc ON cc.cc_open_date_sk = dd.d_date_sk WHERE dd.d_year = 2002 AND cc.cc_rec_start_date = '2002-01-01' AND (cc.cc_street_name = 'Center Hill' OR cc.cc_street_name = 'Ash Hill') AND (wr.wr_returned_time_sk IS NOT NULL AND sr.sr_return_time_sk IS NOT NULL) AND (wr.wr_returned_time_sk IN (SELECT t_time_sk FROM time_dim WHERE t_minute IN ('51', '4', '29', '2', '14', '12'))) AND EXISTS (SELECT 1 FROM warehouse w WHERE w.w_warehouse_sk = sr.sr_item_sk AND w.w_county = 'Williamson County' AND w.w_state = 'TN') GROUP BY dd.d_year, dd.d_month_seq, dd.d_quarter_seq, cc.cc_class ORDER BY dd.d_year, dd.d_month_seq, dd.d_quarter_seq, cc.cc_class;
SELECT dd.d_month_seq, dd.d_quarter_seq, dd.d_year, cp.cp_type, COUNT(DISTINCT inv.inv_item_sk) AS low_stock_items, AVG(inv.inv_quantity_on_hand) AS avg_quantity_on_hand, MIN(inv.inv_quantity_on_hand) AS min_quantity_on_hand, MAX(inv.inv_quantity_on_hand) AS max_quantity_on_hand, COUNT(DISTINCT inv.inv_warehouse_sk) AS affected_warehouses FROM inventory inv JOIN date_dim dd ON inv.inv_date_sk = dd.d_date_sk JOIN catalog_page cp ON inv.inv_item_sk = cp.cp_catalog_page_sk WHERE inv.inv_quantity_on_hand < 750 AND dd.d_year = 2022 GROUP BY dd.d_month_seq, dd.d_quarter_seq, dd.d_year, cp.cp_type ORDER BY dd.d_year, dd.d_quarter_seq, dd.d_month_seq, cp.cp_type;
SELECT cc.cc_division_name, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_paid_inc_tax) AS total_sales_revenue, AVG(ws.ws_net_paid_inc_tax) AS average_order_value, SUM(sr.sr_return_amt_inc_tax) AS total_returns_revenue, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns_count, (SUM(ws.ws_net_paid_inc_tax) - SUM(sr.sr_return_amt_inc_tax)) AS net_revenue_after_returns FROM call_center cc LEFT JOIN web_sales ws ON cc.cc_call_center_sk = ws.ws_web_site_sk LEFT JOIN store_returns sr ON ws.ws_item_sk = sr.sr_item_sk WHERE cc.cc_division_name IN ('ought', 'ese', 'pri', 'anti') AND ws.ws_sold_date_sk IS NOT NULL AND sr.sr_returned_date_sk IS NOT NULL GROUP BY cc.cc_division_name ORDER BY net_revenue_after_returns DESC;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_state, ca.ca_country, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_paid_inc_ship_tax) AS total_revenue, SUM(cs.cs_net_profit) AS total_profit FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON cs.cs_bill_addr_sk = ca.ca_address_sk JOIN store s ON cs.cs_warehouse_sk = s.s_store_sk WHERE dd.d_year = 2002 AND ca.ca_country = 'United States' AND s.s_division_id = 1 AND ( dd.d_week_seq IN (54, 685, 542) OR dd.d_quarter_seq IN (43, 26, 39) ) AND ( cs.cs_item_sk IN (58, 10, 49) OR cs.cs_warehouse_sk IN (3, 2, 4) ) AND cs.cs_net_paid_inc_ship_tax IN (2242.98, 10093.84, 2662.12) GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state, ca.ca_country ORDER BY total_revenue DESC, total_profit DESC LIMIT 100;
SELECT i.i_category, COUNT(DISTINCT ss.ss_item_sk) AS item_count, SUM(ss.ss_net_paid) AS total_revenue, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT s.s_store_sk) AS store_count, COUNT(DISTINCT ws.web_site_sk) AS website_count FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN web_site ws ON s.s_market_id = ws.web_mkt_id LEFT JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE s.s_market_id = 8 AND (ws.web_rec_end_date IS NULL OR ws.web_rec_end_date > CURRENT_DATE) AND ss.ss_sold_date_sk BETWEEN 2450654 AND 2450705 AND s.s_state IN ('Leon', 'Holiday Hills', 'Waterloo', 'Pinecrest') GROUP BY i.i_category ORDER BY total_revenue DESC;
SELECT cp.cp_department, i.i_category, COUNT(DISTINCT cp.cp_catalog_page_sk) AS total_catalog_pages, COUNT(DISTINCT i.i_item_sk) AS total_items, AVG(i.i_current_price) AS avg_item_price, SUM(i.i_wholesale_cost) AS total_wholesale_cost, w.web_name, COUNT(DISTINCT w.web_site_sk) AS total_websites, AVG(w.web_tax_percentage) AS avg_tax_percentage FROM catalog_page cp JOIN item i ON cp.cp_catalog_page_sk = i.i_item_sk JOIN web_site w ON i.i_item_sk = w.web_site_sk WHERE cp.cp_start_date_sk IN ('2451055', '2450905', '2451210', '2451025', '2451605', '2450815') AND w.web_street_type IN ('Way', 'Cir.', 'Ln', 'Ct.', 'Wy') AND i.i_units IN ('N/A', 'Ton') AND cp.cp_catalog_page_sk IN ('3794', '992') GROUP BY cp.cp_department, i.i_category, w.web_name ORDER BY cp.cp_department, i.i_category, w.web_name;
SELECT d_year, i_category, COUNT(DISTINCT c_customer_sk) AS total_customers, SUM(cr_return_quantity) AS total_returned_quantity, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_amount) AS total_return_amount, SUM(cr_fee) AS total_fees, AVG(i_current_price) AS avg_item_price, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns JOIN date_dim ON cr_returned_date_sk = d_date_sk JOIN customer ON cr_returning_customer_sk = c_customer_sk JOIN item ON cr_item_sk = i_item_sk WHERE cr_return_quantity = 2 GROUP BY d_year, i_category ORDER BY total_return_amount DESC, total_net_loss DESC LIMIT 100;
SELECT s.s_store_name, s.s_state, sm.sm_type AS ship_mode_type, dd.d_fy_quarter_seq AS fiscal_year_quarter, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_net_profit) AS average_net_profit_per_order, SUM(sr.sr_net_loss) AS total_net_loss_from_returns, AVG(sr.sr_fee) AS average_return_fee FROM store s INNER JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk INNER JOIN web_sales ws ON sr.sr_store_sk = ws.ws_ship_customer_sk INNER JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk INNER JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk WHERE s.s_state IN ('CA', 'TX', 'NY') AND ws.ws_promo_sk IN (283, 240) AND ws.ws_ext_sales_price IN (1516.11, 2342.50, 214.40) AND sr.sr_return_ship_cost IN (3.11, 720.07, 1424.48) AND dd.d_fy_quarter_seq IN (39, 22, 50) GROUP BY s.s_store_name, s.s_state, sm.sm_type, dd.d_fy_quarter_seq ORDER BY total_net_profit DESC;
SELECT p.p_promo_name, sm.sm_type AS shipping_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_net_paid) AS average_sales_per_order, SUM(cs.cs_net_profit) AS total_profit, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_quantity) AS total_web_quantity, SUM(ws.ws_net_paid) AS total_web_sales, AVG(ws.ws_net_paid) AS average_web_sales_per_order, SUM(ws.ws_net_profit) AS total_web_profit FROM promotion p LEFT JOIN catalog_sales cs ON p.p_promo_sk = cs.cs_promo_sk LEFT JOIN web_sales ws ON p.p_promo_sk = ws.ws_promo_sk LEFT JOIN ship_mode sm ON (cs.cs_ship_mode_sk = sm.sm_ship_mode_sk OR ws.ws_ship_mode_sk = sm.sm_ship_mode_sk) WHERE p.p_start_date_sk IN ('2450688', '2450248', '2450699', '2450857', '2450196', '2450745') AND (sm.sm_type IN ('EXPRESS', 'OVERNIGHT', 'TWO DAY', 'NEXT DAY') OR sm.sm_type IS NULL) AND (cs.cs_ship_customer_sk IN ('65147', '83434', '5487', '82518') OR ws.ws_ship_customer_sk IN ('65147', '83434', '5487', '82518')) AND p.p_channel_tv = 'N' GROUP BY p.p_promo_name, sm.sm_type ORDER BY total_sales DESC, total_web_sales DESC;
SELECT wp_type AS web_page_type, ca_country AS customer_country, COUNT(DISTINCT wp_web_page_sk) AS num_web_pages, AVG(wp_char_count) AS avg_char_count, SUM(wp_link_count) AS total_link_count, SUM(wp_image_count) AS total_image_count FROM web_page JOIN customer_address ON wp_customer_sk = ca_address_sk JOIN reason ON wp_web_page_sk = r_reason_sk WHERE ca_county IN ('Worcester County', 'Tooele County', 'Page County', 'Wabaunsee County') AND r_reason_desc IN ('reason 27', 'unauthorized purchase', 'Did not get it on time', 'Gift exchange') AND r_reason_sk IN (26, 15, 5) GROUP BY web_page_type, customer_country ORDER BY avg_char_count DESC, total_link_count DESC;
