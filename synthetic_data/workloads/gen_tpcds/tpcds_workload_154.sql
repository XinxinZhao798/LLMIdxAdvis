SELECT dd.d_year, dd.d_quarter_name, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk WHERE dd.d_year = 2022 GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT ws.ws_web_site_sk, ws_item_sk, web_country, SUM(ws_sales_price) AS total_sales_price, AVG(ws_sales_price) AS avg_sales_price, COUNT(ws_order_number) AS total_orders, SUM(ws_quantity) AS total_quantity_sold, SUM(ws_net_profit) AS total_net_profit, SUM(wr_return_quantity) AS total_return_quantity, SUM(wr_return_amt) AS total_return_amount, AVG(wr_fee) AS avg_return_fee, COUNT(DISTINCT wr_order_number) AS total_returned_orders FROM web_sales ws JOIN web_site wsite ON ws.ws_web_site_sk = wsite.web_site_sk LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk WHERE wsite.web_country = 'United States' AND ws.ws_net_paid BETWEEN 141.68 AND 2100.98 AND ws.ws_warehouse_sk = 3 GROUP BY ws.ws_web_site_sk, ws_item_sk, web_country ORDER BY total_net_profit DESC, total_sales_price DESC;
SELECT i.i_category AS item_category, c.c_birth_month AS customer_birth_month, w.web_zip AS web_site_zip, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_paid) AS total_revenue, AVG(ws.ws_ext_discount_amt) AS average_discount, AVG(ws.ws_net_profit) AS average_profit FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN web_site w ON ws.ws_web_site_sk = w.web_site_sk WHERE ws.ws_sold_date_sk BETWEEN 2450815 AND 2450915 AND i.i_item_sk IN (10310, 10207, 12818, 10796) AND w.web_zip IN ('35709', '31904') AND c.c_birth_month IN (3, 5) GROUP BY item_category, customer_birth_month, web_site_zip ORDER BY item_category, customer_birth_month, web_site_zip;
SELECT ca.ca_state, ca.ca_city, sum(cs.cs_quantity) AS total_quantity_sold, avg(cs.cs_sales_price) AS average_sales_price, count(distinct cs.cs_order_number) AS total_orders, cd.cd_education_status, sum(cs.cs_net_profit) AS total_net_profit, count(distinct cs.cs_item_sk) AS unique_items_sold, ib.ib_lower_bound, ib.ib_upper_bound FROM catalog_sales cs JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON cs.cs_ship_cdemo_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound WHERE ca.ca_county = 'Lonoke County' AND (cd.cd_gender = 'M' OR cd.cd_gender = 'F') GROUP BY ca.ca_state, ca.ca_city, cd.cd_education_status, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ca.ca_state, ca.ca_city, cd.cd_education_status, total_net_profit DESC;
SELECT s_store_id, s_state, s_city, COUNT(DISTINCT ss_ticket_number) AS num_transactions, SUM(ss_net_paid) AS total_sales, AVG(ss_sales_price) AS avg_sales_price, SUM(wr_return_amt_inc_tax) AS total_returns, COUNT(DISTINCT wr_order_number) AS num_returns, ARRAY_AGG(DISTINCT r_reason_desc) AS reasons_for_returns FROM store_sales AS ss JOIN store AS s ON ss.ss_store_sk = s.s_store_sk LEFT JOIN web_returns AS wr ON ss.ss_ticket_number = wr.wr_order_number LEFT JOIN reason AS r ON wr.wr_reason_sk = r.r_reason_sk JOIN date_dim AS dd ON ss.ss_sold_date_sk = dd.d_date_sk WHERE dd.d_quarter_seq = ( SELECT MAX(d_quarter_seq) FROM date_dim WHERE d_current_quarter = 'Y' ) AND s.s_state IN ('CA', 'TX', 'NY') GROUP BY s_store_id, s_state, s_city ORDER BY total_sales DESC, s_state, s_city;
SELECT item.i_category, item.i_class, reason.r_reason_desc, COUNT(DISTINCT catalog_returns.cr_order_number) AS total_catalog_returns, SUM(catalog_returns.cr_return_amount) AS total_catalog_return_amount, AVG(catalog_returns.cr_return_amount) AS avg_catalog_return_amount, SUM(catalog_returns.cr_return_tax) AS total_catalog_return_tax, COUNT(DISTINCT store_returns.sr_ticket_number) AS total_store_returns, SUM(store_returns.sr_return_amt) AS total_store_return_amount, AVG(store_returns.sr_return_amt) AS avg_store_return_amount, SUM(store_returns.sr_return_tax) AS total_store_return_tax FROM catalog_returns JOIN item ON catalog_returns.cr_item_sk = item.i_item_sk JOIN reason ON catalog_returns.cr_reason_sk = reason.r_reason_sk JOIN store_returns ON catalog_returns.cr_item_sk = store_returns.sr_item_sk WHERE item.i_category IN ('Children', 'Men', 'Shoes', 'Women', 'Home', 'Sports') AND item.i_class IN ('rings', 'camping', 'wallpaper') AND (catalog_returns.cr_returned_date_sk BETWEEN 88 AND 4202 OR store_returns.sr_returned_date_sk BETWEEN 88 AND 4202) GROUP BY item.i_category, item.i_class, reason.r_reason_desc ORDER BY item.i_category, item.i_class, reason.r_reason_desc;
SELECT wsite.web_name, SUM(ws.ws_net_paid_inc_tax) AS total_sales_amount, AVG(ws.ws_net_paid_inc_tax) AS average_sales_amount, SUM(ws.ws_ext_tax) AS total_tax_collected, COUNT(ws.ws_order_number) AS transaction_count FROM web_sales ws JOIN web_site wsite ON ws.ws_web_site_sk = wsite.web_site_sk WHERE wsite.web_manager = 'Peter Cassidy' AND ws.ws_warehouse_sk IN (1, 2) AND ws.ws_item_sk IN (10321, 7484, 9104, 10036, 6604, 10466) GROUP BY wsite.web_name ORDER BY total_sales_amount DESC;
SELECT d_year AS year, d_quarter_name AS quarter, sm_type AS shipping_type, p_promo_name AS promotion_name, COUNT(*) AS total_shipments, AVG(cd_purchase_estimate) AS average_purchase_estimate, SUM(p_cost) AS total_promotion_cost, COUNT(DISTINCT r_reason_sk) AS unique_reasons_count FROM date_dim JOIN promotion ON (d_date_sk = p_start_date_sk OR d_date_sk = p_end_date_sk) JOIN ship_mode ON sm_ship_mode_sk = 9 JOIN customer_demographics ON cd_credit_rating = 'Good' LEFT JOIN reason ON r_reason_desc IN ('Does not work with a product that I have', 'reason 32') WHERE d_year = 2023 AND sm_contract = 'O9V6oF8RJnLMmZYd1' AND p_discount_active = 'Y' GROUP BY year, quarter, shipping_type, promotion_name ORDER BY year, quarter, total_promotion_cost DESC;
SELECT dd.d_year as sale_year, dd.d_moy as sale_month, p.p_channel_dmail as promo_dmail, p.p_channel_email as promo_email, p.p_channel_catalog as promo_catalog, p.p_channel_tv as promo_tv, p.p_channel_radio as promo_radio, p.p_channel_press as promo_press, p.p_channel_event as promo_event, p.p_channel_demo as promo_demo, SUM(ws.ws_net_paid) as total_revenue, AVG(ws.ws_ext_discount_amt) as avg_discount_amount, COUNT(DISTINCT ws.ws_order_number) as total_orders FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk GROUP BY dd.d_year, dd.d_moy, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo ORDER BY dd.d_year, dd.d_moy, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo;
SELECT dt.d_year, dt.d_quarter_name, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ws.ws_net_paid_inc_tax) AS total_web_net_paid_inc_tax, cc.cc_city, AVG(hd.hd_dep_count) AS average_household_dependency_count, SUM(inv.inv_quantity_on_hand) AS total_inventory_on_hand FROM date_dim dt JOIN store_sales ss ON dt.d_date_sk = ss.ss_sold_date_sk JOIN web_sales ws ON dt.d_date_sk = ws.ws_sold_date_sk JOIN customer c ON (ss.ss_customer_sk = c.c_customer_sk OR ws.ws_bill_customer_sk = c.c_customer_sk) JOIN call_center cc ON (cc.cc_open_date_sk = dt.d_date_sk OR cc.cc_closed_date_sk = dt.d_date_sk) JOIN household_demographics hd ON (c.c_current_hdemo_sk = hd.hd_demo_sk OR ws.ws_bill_hdemo_sk = hd.hd_demo_sk) JOIN inventory inv ON dt.d_date_sk = inv.inv_date_sk WHERE dt.d_moy = 5 AND (dt.d_qoy = 1 OR dt.d_qoy = 2 OR dt.d_qoy = 3) AND (c.c_first_shipto_date_sk IN (2449442, 2451172, 2452404)) AND cc.cc_city = 'Midway' AND (ws.ws_item_sk IN (4, 103, 60)) AND (ws.ws_sales_price IN (38.82, 43.63, 82.62, 63.23)) GROUP BY dt.d_year, dt.d_quarter_name, cc.cc_city ORDER BY total_quantity_sold DESC, average_sales_price DESC, total_inventory_on_hand DESC, dt.d_year, dt.d_quarter_name;
SELECT ca_state, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, COUNT(*) AS return_count, SUM(ss_net_profit) AS total_store_sales_profit, AVG(ss_net_profit) AS avg_store_sales_profit, COUNT(DISTINCT ss_customer_sk) AS store_customer_count, SUM(ws_net_profit) AS total_web_sales_profit, AVG(ws_net_profit) AS avg_web_sales_profit, COUNT(DISTINCT ws_bill_customer_sk) AS web_customer_count FROM catalog_returns JOIN customer_address ON cr_returning_addr_sk = ca_address_sk JOIN store_sales ON catalog_returns.cr_item_sk = store_sales.ss_item_sk JOIN web_sales ON catalog_returns.cr_item_sk = web_sales.ws_item_sk JOIN promotion ON store_sales.ss_promo_sk = promotion.p_promo_sk AND web_sales.ws_promo_sk = promotion.p_promo_sk JOIN household_demographics ON (catalog_returns.cr_returning_hdemo_sk = household_demographics.hd_demo_sk OR store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk OR web_sales.ws_ship_hdemo_sk = household_demographics.hd_demo_sk) WHERE promotion.p_channel_demo = 'N' AND household_demographics.hd_income_band_sk IN (8, 10) AND household_demographics.hd_buy_potential IN ('>10000', 'Unknown', '0-500', '5001-10000', '1001-5000', '501-1000') AND catalog_returns.cr_reason_sk IN (9, 32, 23, 19) AND promotion.p_end_date_sk IN (2450545, 2450776) GROUP BY ca_state ORDER BY total_return_amount DESC;
SELECT dd.d_year, dd.d_qoy, cc.cc_name, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(cs_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk WHERE cc.cc_name = 'North Midwest' AND dd.d_year = 2003 GROUP BY dd.d_year, dd.d_qoy, cc.cc_name ORDER BY dd.d_year, dd.d_qoy, cc.cc_name;
SELECT i.i_category AS category, ca.ca_state AS customer_state, EXTRACT(MONTH FROM (DATE '1970-01-01' + c.c_first_sales_date_sk * INTERVAL '1 day')) AS sale_month, COUNT(DISTINCT s.s_store_sk) AS num_stores, SUM(i.i_current_price) AS total_sales_amount, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, COUNT(i.i_item_sk) AS items_sold, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_amt) AS avg_return_amount, COUNT(sr.sr_item_sk) AS items_returned FROM store s JOIN customer c ON s.s_store_sk = c.c_current_addr_sk JOIN item i ON s.s_store_sk = i.i_manufact_id JOIN store_returns sr ON i.i_item_sk = sr.sr_item_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ca.ca_state IN ('TN', 'DE', 'VA', 'CO') AND i.i_category_id IS NOT NULL AND c.c_first_sales_date_sk IS NOT NULL AND (c.c_birth_month = 1 OR c.c_birth_month IS NULL) AND sr.sr_returned_date_sk IS NOT NULL GROUP BY category, customer_state, sale_month ORDER BY total_sales_amount DESC, avg_wholesale_cost DESC, total_return_amount DESC LIMIT 100;
SELECT ca.ca_state, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_net_paid) AS total_sales_amount, AVG(ss.ss_net_paid) AS average_sales_amount, SUM(ss.ss_quantity) AS total_quantity_sold FROM store_sales AS ss JOIN customer_address AS ca ON ss.ss_addr_sk = ca.ca_address_sk JOIN inventory AS inv ON ss.ss_item_sk = inv.inv_item_sk AND ss.ss_sold_date_sk = inv.inv_date_sk WHERE ca.ca_location_type = 'single family' AND inv.inv_warehouse_sk IN (1, 2) GROUP BY ca.ca_state ORDER BY total_sales_amount DESC;
SELECT sm.sm_type AS ship_mode_type, s.s_state AS store_state, COUNT(DISTINCT cr.cr_order_number) AS num_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT ss.ss_ticket_number) AS num_sales, SUM(ss.ss_net_paid) AS total_sales_net_paid, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sales_price FROM catalog_returns cr JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN store_sales ss ON ss.ss_store_sk = cr.cr_returning_customer_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk WHERE cp.cp_type = 'monthly' GROUP BY sm.sm_type, s.s_state ORDER BY total_return_amount DESC, total_sales_net_paid DESC;
SELECT cc.cc_state, AVG(cc.cc_employees) AS avg_employees, SUM(cc.cc_sq_ft) AS total_sq_ft, COUNT(DISTINCT hd.hd_demo_sk) AS households_with_buy_potential, SUM(CASE WHEN p.p_discount_active = 'Y' THEN p.p_cost ELSE 0 END) AS total_active_promo_cost FROM call_center cc LEFT JOIN household_demographics hd ON hd.hd_income_band_sk IN (5, 1, 17, 14) AND hd.hd_buy_potential IS NOT NULL LEFT JOIN promotion p ON p.p_discount_active = 'Y' AND p.p_channel_press = 'N' WHERE cc.cc_state = 'TN' GROUP BY cc.cc_state;
SELECT w_state, p_purpose, COUNT(DISTINCT wp_web_page_sk) AS total_web_pages, SUM(wp_image_count) AS total_images, AVG(wp_char_count) AS avg_char_count, SUM(CASE WHEN wp_web_page_id IN ('AAAAAAAAOAAAAAAA', 'AAAAAAAAJBAAAAAA', 'AAAAAAAAEBAAAAAA', 'AAAAAAAALCAAAAAA', 'AAAAAAAACAAAAAAA', 'AAAAAAAAGBAAAAAA') THEN 1 ELSE 0 END) AS targeted_web_pages_count, SUM(CASE WHEN t_shift = 'third' THEN 1 ELSE 0 END) AS third_shift_count, AVG(w_warehouse_sq_ft) AS avg_warehouse_size FROM warehouse JOIN promotion ON w_warehouse_sk = p_item_sk JOIN web_page ON wp_customer_sk = w_warehouse_sk JOIN time_dim ON t_time_sk = wp_creation_date_sk WHERE w_state = 'TN' AND (wp_image_count = 4 OR wp_image_count = 1) AND w_warehouse_sk = 2 GROUP BY w_state, p_purpose ORDER BY total_web_pages DESC;
SELECT wp.wp_type, sm.sm_type, COUNT(DISTINCT wr.wr_refunded_customer_sk) AS unique_customers, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amt_inc_tax, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_net_loss) AS total_net_loss FROM web_returns wr JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk JOIN ship_mode sm ON wr.wr_returning_addr_sk = sm.sm_ship_mode_sk WHERE wp.wp_type IN ('feedback', 'order', 'general') AND sm.sm_type = 'TWO DAY' AND wr.wr_returning_addr_sk IN ('28100', '12237', '16942', '45981', '17051', '17924') AND wr.wr_refunded_customer_sk IN ('91486', '46332', '17456', '11868', '724', '87845') GROUP BY wp.wp_type, sm.sm_type;
SELECT sm.sm_type AS shipping_type, COUNT(DISTINCT cr.cr_order_number) AS total_return_transactions, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, COUNT(DISTINCT wr.wr_order_number) AS total_web_return_transactions, SUM(wr.wr_return_amt_inc_tax) AS total_web_return_amount, AVG(wr.wr_return_amt) AS average_web_return_amount FROM ship_mode sm LEFT JOIN catalog_returns cr ON sm.sm_ship_mode_sk = cr.cr_ship_mode_sk LEFT JOIN web_returns wr ON cr.cr_catalog_page_sk = wr.wr_web_page_sk LEFT JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk WHERE wr.wr_refunded_customer_sk IN ('49270', '61504', '79520') OR ws.web_city IN ('Fairview', 'Midway') GROUP BY sm.sm_type ORDER BY total_return_amount DESC, total_web_return_amount DESC;
SELECT hd.hd_buy_potential, COUNT(hd.hd_demo_sk) AS households_count, AVG(hd.hd_dep_count) AS avg_dependents_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, SUM(CASE WHEN ib.ib_lower_bound >= 60001 AND ib.ib_upper_bound <= 180001 THEN 1 ELSE 0 END) AS mid_income_band_households, SUM(CASE WHEN ib.ib_lower_bound < 60001 THEN 1 ELSE 0 END) AS low_income_band_households, SUM(CASE WHEN ib.ib_lower_bound > 180001 THEN 1 ELSE 0 END) AS high_income_band_households FROM household_demographics hd JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk GROUP BY hd.hd_buy_potential ORDER BY hd.hd_buy_potential;
SELECT dd.d_year, dd.d_quarter_name, COUNT(DISTINCT c.c_customer_sk) AS total_customers, COUNT(DISTINCT sr.sr_store_sk) AS total_stores_with_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_fee) AS total_fees_collected, SUM(sr.sr_net_loss) AS total_net_loss FROM date_dim dd JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk WHERE dd.d_year IN (1909, 1903, 1901, 1907, 1911, 1900) AND dd.d_quarter_seq = 53 AND NOT EXISTS (SELECT 1 FROM promotion WHERE p_channel_tv = 'N' AND p_promo_sk = sr.sr_item_sk) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT p.p_promo_id, p.p_promo_name, COUNT(DISTINCT cs.cs_item_sk) AS number_of_items_sold, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_selling_price, SUM(cs.cs_ext_sales_price) AS total_sales_amount, SUM(cs.cs_ext_discount_amt) AS total_discount_amount, AVG((cs.cs_ext_discount_amt / cs.cs_ext_list_price) * 100) AS average_discount_percentage, SUM(cs.cs_net_profit) AS total_net_profit, AVG(inv.inv_quantity_on_hand) AS average_inventory_quantity_on_hand FROM catalog_sales cs JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk LEFT JOIN inventory inv ON cs.cs_item_sk = inv.inv_item_sk AND cs.cs_sold_date_sk = inv.inv_date_sk WHERE cs.cs_ext_list_price IN (8856.28, 4863.95, 651.00, 4727.68) GROUP BY p.p_promo_id, p.p_promo_name ORDER BY total_sales_amount DESC;
SELECT w.w_warehouse_name, i.ib_lower_bound, i.ib_upper_bound, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(wr.wr_return_quantity) AS total_return_quantity, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_fee) AS total_return_fees, COUNT(DISTINCT wr.wr_order_number) AS total_return_transactions FROM warehouse w JOIN store_sales ss ON ss.ss_addr_sk = w.w_warehouse_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN income_band i ON hd.hd_income_band_sk = i.ib_income_band_sk LEFT JOIN web_returns wr ON wr.wr_item_sk = ss.ss_item_sk AND wr.wr_refunded_customer_sk = ss.ss_customer_sk WHERE w.w_county = 'Williamson County' AND ss.ss_sold_time_sk = 35623 AND i.ib_income_band_sk IN (SELECT hd_income_band_sk FROM household_demographics WHERE hd_demo_sk IN (6765, 6298, 2035)) GROUP BY w.w_warehouse_name, i.ib_lower_bound, i.ib_upper_bound ORDER BY w.w_warehouse_name, i.ib_lower_bound;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_state, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, SUM(cs.cs_net_paid) AS total_net_paid, AVG(cs.cs_net_profit) AS avg_net_profit FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN store s ON ca.ca_state = s.s_state WHERE dd.d_current_quarter = 'N' AND dd.d_following_holiday = 'N' AND cd.cd_credit_rating = 'Good' AND s.s_market_id IS NOT NULL GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state ORDER BY dd.d_year, dd.d_quarter_name, ca.ca_state;
SELECT s.s_store_name, i.i_category, r.r_reason_desc, COUNT(DISTINCT wr_order_number) AS total_returns, SUM(wr_return_quantity) AS total_returned_quantity, AVG(wr_return_amt) AS avg_return_amount, AVG(wr_return_ship_cost) AS avg_shipping_cost, SUM(wr_net_loss) AS total_net_loss FROM web_returns wr JOIN store s ON s.s_store_sk = wr.wr_refunded_addr_sk JOIN item i ON i.i_item_sk = wr.wr_item_sk JOIN reason r ON r.r_reason_sk = wr.wr_reason_sk WHERE s.s_market_id = 7 AND s.s_rec_start_date IN ('2001-03-13', '1997-03-13') AND i.i_manager_id = 52 AND wr.wr_reason_sk = 13 GROUP BY ROLLUP(s.s_store_name, i.i_category, r.r_reason_desc) ORDER BY s.s_store_name, i.i_category, r.r_reason_desc;
SELECT t.t_shift, SUM(i.inv_quantity_on_hand) AS total_quantity_on_hand, AVG(s.s_number_employees) AS avg_number_of_employees, COUNT(DISTINCT s.s_store_sk) AS number_of_stores, SUM(s.s_floor_space) AS total_floor_space FROM inventory i JOIN time_dim t ON i.inv_date_sk = t.t_time_sk JOIN store s ON i.inv_warehouse_sk = s.s_store_sk WHERE s.s_store_id = 'AAAAAAAAIAAAAAAA' AND t.t_am_pm = 'PM' AND s.s_rec_start_date <= CURRENT_DATE AND (s.s_rec_end_date IS NULL OR s.s_rec_end_date > CURRENT_DATE) GROUP BY t.t_shift ORDER BY t.t_shift;
SELECT hd.hd_demo_sk, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, COUNT(DISTINCT wr.wr_order_number) AS total_web_returns, SUM(sr.sr_return_amt) AS total_store_return_amount, AVG(sr.sr_return_amt) AS avg_store_return_amount, SUM(wr.wr_return_amt) AS total_web_return_amount, AVG(wr.wr_return_amt) AS avg_web_return_amount, SUM(CASE WHEN p.p_channel_radio = 'N' AND p.p_channel_demo = 'N' THEN p.p_cost ELSE 0 END) AS non_radio_demo_promo_cost, AVG(CASE WHEN p.p_channel_radio = 'N' AND p.p_channel_demo = 'N' THEN p.p_response_target ELSE NULL END) AS avg_non_radio_demo_response_target FROM household_demographics hd LEFT JOIN store_returns sr ON hd.hd_demo_sk = sr.sr_hdemo_sk LEFT JOIN web_returns wr ON (hd.hd_demo_sk = wr.wr_refunded_hdemo_sk OR hd.hd_demo_sk = wr.wr_returning_hdemo_sk) LEFT JOIN promotion p ON p.p_promo_sk = sr.sr_reason_sk WHERE hd.hd_demo_sk IN (560, 4858) AND (sr.sr_store_sk IN (8, 10) OR sr.sr_store_sk IS NULL) GROUP BY hd.hd_demo_sk ORDER BY hd.hd_demo_sk;
SELECT cd.cd_education_status, cd.cd_gender, cd.cd_marital_status, COUNT(DISTINCT c.c_customer_sk) AS total_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, AVG(wp.wp_char_count) AS avg_webpage_char_count, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages_accessed, SUM(CASE WHEN cd.cd_credit_rating = 'High' THEN 1 ELSE 0 END) AS high_credit_rating_count, SUM(CASE WHEN cd.cd_credit_rating = 'Medium' THEN 1 ELSE 0 END) AS medium_credit_rating_count, SUM(CASE WHEN cd.cd_credit_rating = 'Low' THEN 1 ELSE 0 END) AS low_credit_rating_count FROM customer_demographics cd JOIN customer c ON cd.cd_demo_sk = c.c_current_cdemo_sk LEFT JOIN web_page wp ON c.c_customer_sk = wp.wp_customer_sk WHERE c.c_birth_country = 'BOTSWANA' AND c.c_email_address LIKE '%@Bk.com' GROUP BY cd.cd_education_status, cd.cd_gender, cd.cd_marital_status ORDER BY cd.cd_education_status, cd.cd_gender, cd.cd_marital_status;
SELECT w.w_city, w.w_state, w.w_country, COUNT(*) AS number_of_households, AVG(hd.hd_dep_count) AS average_dependency_count, AVG(hd.hd_vehicle_count) AS average_vehicle_count, AVG(ib.ib_lower_bound) AS average_income_lower_bound, AVG(ib.ib_upper_bound) AS average_income_upper_bound, SUM(CASE WHEN hd.hd_buy_potential = 'Unknown' THEN 1 ELSE 0 END) AS unknown_buy_potential_count, SUM(CASE WHEN hd.hd_buy_potential = 'High' THEN 1 ELSE 0 END) AS high_buy_potential_count, SUM(CASE WHEN hd.hd_buy_potential = 'Low' THEN 1 ELSE 0 END) AS low_buy_potential_count FROM warehouse w JOIN household_demographics hd ON w.w_warehouse_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk GROUP BY w.w_city, w.w_state, w.w_country ORDER BY w.w_country, w.w_state, w.w_city;
