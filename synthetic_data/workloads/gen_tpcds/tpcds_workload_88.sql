SELECT dd.d_year AS year, h.hd_income_band_sk AS income_band, r.r_reason_desc AS return_reason, SUM(ss.ss_net_paid) AS total_sales, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, AVG(ss.ss_quantity) AS average_quantity_sold, SUM(cr.cr_return_amount) AS total_returns, COUNT(DISTINCT cr.cr_order_number) AS total_return_transactions, AVG(cr.cr_return_quantity) AS average_quantity_returned FROM date_dim dd LEFT JOIN store_sales ss ON dd.d_date_sk = ss.ss_sold_date_sk LEFT JOIN catalog_returns cr ON dd.d_date_sk = cr.cr_returned_date_sk LEFT JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk LEFT JOIN household_demographics h ON ss.ss_hdemo_sk = h.hd_demo_sk WHERE dd.d_year IS NOT NULL AND (r.r_reason_id IN ('AAAAAAAANAAAAAAA', 'AAAAAAAALBAAAAAA', 'AAAAAAAALAAAAAAA', 'AAAAAAAADAAAAAAA', 'AAAAAAAAJBAAAAAA') OR r.r_reason_id IS NULL) GROUP BY year, income_band, return_reason ORDER BY year, income_band, total_sales DESC;
SELECT w_state, t_shift, sm_type as shipping_type, avg(hd_income_band_sk) as avg_income_band, sum(case when hd_buy_potential = 'High' then 1 else 0 end) as high_buy_potential_count, avg(hd_dep_count) as avg_dependent_count, avg(hd_vehicle_count) as avg_vehicle_count, count(distinct sm_ship_mode_sk) as shipping_mode_count FROM household_demographics hd JOIN warehouse w ON hd.hd_demo_sk = w.w_warehouse_sk JOIN time_dim td ON td.t_time_sk = w.w_warehouse_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = w.w_warehouse_sk WHERE hd.hd_dep_count IN (2, 3, 6, 9) AND hd.hd_vehicle_count IN (0, 1, 2, 3, 4) AND td.t_shift IS NOT NULL AND sm.sm_type IS NOT NULL GROUP BY w_state, t_shift, sm_type ORDER BY avg_income_band DESC, high_buy_potential_count DESC, avg_vehicle_count DESC;
SELECT r.r_reason_desc, sm.sm_type AS shipping_type, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_qty, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_inc_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_net_loss) AS total_net_loss, COUNT(DISTINCT s.s_store_sk) AS num_stores_with_returns, AVG(s.s_number_employees) AS avg_store_employees, AVG(s.s_floor_space) AS avg_store_floor_space, SUM(sr.sr_return_amt) AS total_store_return_amt, SUM(sr.sr_return_amt_inc_tax) AS total_store_return_inc_tax FROM catalog_returns cr JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN store_returns sr ON cr.cr_item_sk = sr.sr_item_sk AND cr.cr_order_number = sr.sr_ticket_number LEFT JOIN store s ON sr.sr_store_sk = s.s_store_sk WHERE r.r_reason_desc IN ('Gift exchange', 'duplicate purchase', 'Did not like the make', 'Found a better extended warranty in a store') AND sm.sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') AND (s.s_street_number IN ('337', '255', '175') OR s.s_state = 'TN') GROUP BY r.r_reason_desc, shipping_type ORDER BY total_returns DESC;
SELECT cc.cc_name, cc.cc_city, st.s_store_name, st.s_city, SUM(ss.ss_net_profit) AS total_net_profit, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_quantity) AS total_quantity_sold, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions FROM call_center AS cc JOIN store_sales AS ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN store AS st ON ss.ss_store_sk = st.s_store_sk WHERE cc.cc_rec_start_date >= '2020-01-01' AND cc.cc_rec_end_date <= '2020-12-31' AND ss.ss_wholesale_cost BETWEEN 40 AND 90 AND (st.s_city = 'Fairview' OR st.s_city = 'Midway') AND cc.cc_employees >= 3 GROUP BY cc.cc_name, cc.cc_city, st.s_store_name, st.s_city HAVING SUM(ss.ss_net_profit) > 0 ORDER BY total_net_profit DESC, average_sales_price DESC;
SELECT cc.cc_division_name, ib.ib_upper_bound, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_net_paid, AVG(ss.ss_net_profit) AS average_net_profit, COUNT(DISTINCT ss.ss_store_sk) AS number_of_stores, COUNT(DISTINCT cs.cs_call_center_sk) AS number_of_call_centers, COUNT(DISTINCT hd.hd_demo_sk) AS number_of_household_demographics, SUM(CASE WHEN cr.cr_return_amount > 0 THEN 1 ELSE 0 END) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_fee) AS average_return_fee FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN call_center cc ON s.s_store_sk = cc.cc_call_center_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk LEFT JOIN catalog_sales cs ON ss.ss_ticket_number = cs.cs_order_number LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number WHERE ss.ss_sold_date_sk IN (2451072, 2451839, 2451935, 2451452, 2451580, 2451465) AND cc.cc_division_name IN ('anti', 'ought', 'pri', 'ese') AND ib.ib_upper_bound IN (150000, 60000, 190000, 70000, 170000, 30000) GROUP BY cc.cc_division_name, ib.ib_upper_bound ORDER BY total_net_paid DESC, average_net_profit DESC;
SELECT p.p_promo_name, d_return.d_year AS return_year, d_return.d_quarter_name, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, SUM(cr.cr_return_amount) AS total_returned_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN date_dim d_return ON cr.cr_returned_date_sk = d_return.d_date_sk JOIN promotion p ON cr.cr_item_sk = p.p_item_sk JOIN date_dim d_start ON p.p_start_date_sk = d_start.d_date_sk JOIN date_dim d_end ON p.p_end_date_sk = d_end.d_date_sk WHERE cr.cr_call_center_sk IN ('2', '4') AND cr.cr_reason_sk IN ('11', '25') AND d_return.d_current_week = 'N' AND p.p_channel_tv = 'N' AND p.p_channel_radio = 'N' AND d_return.d_date BETWEEN d_start.d_date AND d_end.d_date GROUP BY p.p_promo_name, return_year, d_return.d_quarter_name ORDER BY total_returned_amount DESC, total_returns DESC, return_year, d_return.d_quarter_name;
SELECT cp.cp_department AS department, i.i_category AS category, i.i_class AS class, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, AVG(hd.hd_dep_count) AS average_dependents, AVG(hd.hd_vehicle_count) AS average_vehicles FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN catalog_page cp ON i.i_item_sk = cp.cp_catalog_page_sk JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE hd.hd_vehicle_count IN (0, 3) AND hd.hd_buy_potential IN ('>10000', '5001-10000', '501-1000', '0-500') AND cp.cp_start_date_sk <= ws.ws_sold_date_sk AND (cp.cp_end_date_sk IS NULL OR cp.cp_end_date_sk >= ws.ws_sold_date_sk) GROUP BY cp.cp_department, i.i_category, i.i_class ORDER BY total_net_profit DESC, total_orders DESC;
SELECT cc.cc_name, cc.cc_class, cc.cc_employees, cc.cc_sq_ft, AVG(cc.cc_tax_percentage) AS avg_tax_percentage, COUNT(DISTINCT ca.ca_address_sk) AS unique_customer_addresses, SUM(ib.ib_upper_bound - ib.ib_lower_bound) AS total_income_band_range, d.d_year, COUNT(DISTINCT d.d_date_sk) AS working_days FROM call_center cc JOIN date_dim d ON (cc.cc_open_date_sk = d.d_date_sk OR cc.cc_closed_date_sk = d.d_date_sk) JOIN customer_address ca ON (cc.cc_state = ca.ca_state) JOIN time_dim t ON (t.t_hour BETWEEN 8 AND 17) JOIN income_band ib ON (ib.ib_lower_bound >= 40001 AND ib.ib_upper_bound <= 70000) WHERE cc.cc_zip = '31904' AND d.d_dow IN (0, 3, 4) AND t.t_minute IN ('8', '14', '35', '46', '52', '55') AND cc.cc_mkt_class IN ( 'Silly particles could pro', 'Dealers make most historical, direct students', 'Wrong troops shall work sometimes in a opti', 'A bit narrow forms matter animals. Consist', 'More than other authori' ) GROUP BY cc.cc_name, cc.cc_class, cc.cc_employees, cc.cc_sq_ft, d.d_year;
SELECT p.p_channel_dmail AS promo_channel_direct_mail, p.p_channel_email AS promo_channel_email, p.p_channel_catalog AS promo_channel_catalog, p.p_channel_tv AS promo_channel_tv, p.p_channel_radio AS promo_channel_radio, p.p_channel_press AS promo_channel_press, p.p_channel_event AS promo_channel_event, p.p_channel_demo AS promo_channel_demo, COUNT(p.p_promo_sk) AS num_promotions, SUM(p.p_cost) AS total_promo_cost, AVG(p.p_cost) AS avg_promo_cost, SUM(i.inv_quantity_on_hand) AS total_inventory_qty FROM promotion p LEFT JOIN inventory i ON p.p_item_sk = i.inv_item_sk WHERE p.p_discount_active = '1' GROUP BY promo_channel_direct_mail, promo_channel_email, promo_channel_catalog, promo_channel_tv, promo_channel_radio, promo_channel_press, promo_channel_event, promo_channel_demo ORDER BY num_promotions DESC, total_promo_cost DESC;
SELECT cd.cd_education_status, ib.ib_lower_bound, ib.ib_upper_bound, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_ext_discount_amt) AS total_discount, COUNT(cs.cs_order_number) AS total_orders FROM customer_demographics cd JOIN catalog_sales cs ON cd.cd_demo_sk = cs.cs_bill_cdemo_sk JOIN income_band ib ON (cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound) GROUP BY cd.cd_education_status, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY cd.cd_education_status, ib.ib_lower_bound;
SELECT p.p_promo_name, sm.sm_type AS shipping_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_net_paid) AS average_sales_per_order, SUM(cs.cs_net_profit) AS total_profit, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_quantity) AS total_web_quantity, SUM(ws.ws_net_paid) AS total_web_sales, AVG(ws.ws_net_paid) AS average_web_sales_per_order, SUM(ws.ws_net_profit) AS total_web_profit FROM promotion p LEFT JOIN catalog_sales cs ON p.p_promo_sk = cs.cs_promo_sk LEFT JOIN web_sales ws ON p.p_promo_sk = ws.ws_promo_sk LEFT JOIN ship_mode sm ON (cs.cs_ship_mode_sk = sm.sm_ship_mode_sk OR ws.ws_ship_mode_sk = sm.sm_ship_mode_sk) WHERE p.p_start_date_sk IN ('2450688', '2450248', '2450699', '2450857', '2450196', '2450745') AND (sm.sm_type IN ('EXPRESS', 'OVERNIGHT', 'TWO DAY', 'NEXT DAY') OR sm.sm_type IS NULL) AND (cs.cs_ship_customer_sk IN ('65147', '83434', '5487', '82518') OR ws.ws_ship_customer_sk IN ('65147', '83434', '5487', '82518')) AND p.p_channel_tv = 'N' GROUP BY p.p_promo_name, sm.sm_type ORDER BY total_sales DESC, total_web_sales DESC;
SELECT c.c_customer_id, sm.sm_type as shipping_type, count(cs_order_number) as total_orders, sum(cs_quantity) as total_quantity, avg(cs_net_paid) as average_net_paid, sum(cs_net_profit) as total_net_profit, date_part('year', d.d_date) as sale_year, d.d_quarter_name as sale_quarter, ib.ib_lower_bound as income_band_lower_bound, ib.ib_upper_bound as income_band_upper_bound FROM catalog_sales cs JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN income_band ib ON c.c_current_hdemo_sk = ib.ib_income_band_sk WHERE d.d_year = 2023 AND sm.sm_code = 'SEA' AND ib.ib_lower_bound >= 30001 AND ib.ib_upper_bound <= 80001 GROUP BY c.c_customer_id, shipping_type, sale_year, sale_quarter, income_band_lower_bound, income_band_upper_bound ORDER BY total_net_profit DESC, total_orders DESC;
SELECT ca_state, cd_gender, cd_marital_status, sm_type, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(sr_return_quantity) AS total_quantity_returned, AVG(sr_return_amt) AS average_return_amount, SUM(sr_net_loss) AS total_net_loss FROM store_sales JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN customer_demographics ON ss_cdemo_sk = cd_demo_sk JOIN ship_mode ON sm_ship_mode_sk = ss_promo_sk LEFT JOIN store_returns ON sr_ticket_number = ss_ticket_number AND sr_item_sk = ss_item_sk WHERE ca_state IS NOT NULL AND cd_gender IN ('M', 'F') AND cd_marital_status IN ('M', 'U', 'S', 'D') GROUP BY ca_state, cd_gender, cd_marital_status, sm_type ORDER BY total_quantity_sold DESC, average_sales_price DESC;
SELECT dd.d_year, dd.d_quarter_name, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk WHERE dd.d_year = 2022 GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT w_country, cr_returned_date_sk AS return_date_sk, i_category, COUNT(DISTINCT cr_order_number) AS total_returns, SUM(cr_return_quantity) AS total_returned_quantity, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN promotion p ON i.i_item_sk = p.p_item_sk AND p.p_discount_active = 'N' WHERE cr.cr_returning_hdemo_sk IN (7008, 2246, 3148, 584, 6843) GROUP BY w_country, return_date_sk, i_category ORDER BY total_net_loss DESC, total_returns DESC;
SELECT d_year, cd_gender, cd_marital_status, cd_education_status, sm_type, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_items_sold, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(cs_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN customer_demographics ON cs_bill_cdemo_sk = cd_demo_sk JOIN date_dim ON cs_sold_date_sk = d_date_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk WHERE d_year = 2003 AND cd_dep_count BETWEEN 1 AND 2 AND cd_purchase_estimate IN (3000, 6000, 8000, 7000) AND sm_ship_mode_id IN ('AAAAAAAABBAAAAAA', 'AAAAAAAAOAAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAAJAAAAAAA') AND sm_contract IN ('GNJr3g5i7oorKqtX', 'O9V6oF8RJnLMmZYd1', 'UaAJjKDnL4gTOqbpj') AND cs_net_paid_inc_tax IN ('3193.96', '1181.18', '1413.67') GROUP BY ROLLUP(d_year, cd_gender, cd_marital_status, cd_education_status, sm_type) ORDER BY d_year, cd_gender, cd_marital_status, cd_education_status, sm_type;
SELECT c.cp_department AS department, i.i_category AS category, COUNT(DISTINCT c.cp_catalog_page_sk) AS num_catalog_pages, COUNT(DISTINCT i.i_item_sk) AS num_items, AVG(i.i_current_price) AS avg_current_price, SUM(i.i_wholesale_cost * i.i_units::int) AS total_wholesale_cost, w.web_name AS website_name, COUNT(DISTINCT w.web_site_sk) AS num_websites, AVG(w.web_tax_percentage) AS avg_tax_percentage FROM catalog_page c JOIN item i ON c.cp_catalog_page_sk = i.i_item_sk JOIN web_site w ON c.cp_department = w.web_class WHERE i.i_category IN ('Shoes', 'Home') AND i.i_rec_start_date <= CURRENT_DATE AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date > CURRENT_DATE) AND w.web_rec_start_date <= CURRENT_DATE AND (w.web_rec_end_date IS NULL OR w.web_rec_end_date > CURRENT_DATE) GROUP BY c.cp_department, i.i_category, w.web_name ORDER BY department, category, website_name;
SELECT r.r_reason_desc, COUNT(DISTINCT sr.sr_ticket_number) AS num_store_returns, SUM(sr.sr_refunded_cash) AS total_store_refunded, AVG(sr.sr_return_amt_inc_tax) AS avg_store_return, COUNT(DISTINCT cr.cr_order_number) AS num_catalog_returns, SUM(cr.cr_refunded_cash) AS total_catalog_refunded, AVG(cr.cr_return_amt_inc_tax) AS avg_catalog_return FROM store_returns sr FULL OUTER JOIN catalog_returns cr ON sr.sr_reason_sk = cr.cr_reason_sk JOIN reason r ON r.r_reason_sk = sr.sr_reason_sk OR r.r_reason_sk = cr.cr_reason_sk LEFT JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk WHERE (sr.sr_customer_sk IN (67809, 3762, 6067) OR cr.cr_returning_hdemo_sk IN (6684, 3972, 3528, 1943, 4100, 4193)) AND (r.r_reason_id IN ('AAAAAAAANBAAAAAA', 'AAAAAAAADCAAAAAA', 'AAAAAAAAACAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAAFBAAAAAA', 'AAAAAAAAOBAAAAAA')) AND w.w_street_number = '651' AND w.w_county = 'Williamson County' GROUP BY r.r_reason_desc ORDER BY total_store_refunded DESC, total_catalog_refunded DESC;
SELECT p.p_promo_id AS promotion_id, p.p_promo_name AS promotion_name, p.p_channel_dmail AS channel_direct_mail, p.p_channel_email AS channel_email, p.p_channel_catalog AS channel_catalog, p.p_channel_tv AS channel_tv, p.p_channel_radio AS channel_radio, p.p_channel_press AS channel_press, p.p_channel_event AS channel_event, p.p_channel_demo AS channel_demo, s.s_state AS store_state, SUM(sr.sr_return_amt_inc_tax) AS total_returns_incl_tax, SUM(sr.sr_return_quantity) AS total_returned_quantity, COUNT(sr.sr_ticket_number) AS total_return_transactions, AVG(sr.sr_return_amt) AS avg_return_amount, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_incl_tax FROM promotion p JOIN store_returns sr ON p.p_promo_sk = sr.sr_reason_sk JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN date_dim d ON sr.sr_returned_date_sk = d.d_date_sk WHERE d.d_fy_year = 2003 AND p.p_discount_active = 'Y' GROUP BY p.p_promo_id, p.p_promo_name, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo, s.s_state ORDER BY total_returns_incl_tax DESC, promotion_id;
