SELECT i.i_category, i.i_color, COUNT(DISTINCT cr.cr_item_sk) AS num_returns, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_return_quantity) AS total_returned_quantity, cc.cc_name AS call_center, w.w_warehouse_name AS warehouse, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages, COUNT(DISTINCT wp.wp_web_page_sk) AS num_web_pages FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN web_page wp ON cp.cp_start_date_sk = wp.wp_creation_date_sk WHERE i.i_color IN ('linen', 'midnight', 'powder', 'tan') AND cp.cp_catalog_number IN (46, 18, 2) AND w.w_gmt_offset = -5.00 GROUP BY i.i_category, i.i_color, cc.cc_name, w.w_warehouse_name ORDER BY total_return_amount DESC;
SELECT ib.ib_income_band_sk, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages, AVG(wp.wp_char_count) AS avg_char_count, SUM(wp.wp_link_count) AS total_link_count, AVG(wp.wp_image_count) AS avg_image_count, SUM(wr.wr_return_quantity) AS total_return_quantity, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_fee) AS avg_return_fee, SUM(wr.wr_net_loss) AS total_net_loss FROM income_band ib LEFT JOIN web_page wp ON wp.wp_customer_sk = ib.ib_income_band_sk LEFT JOIN web_returns wr ON wr.wr_web_page_sk = wp.wp_web_page_sk WHERE wp.wp_rec_start_date BETWEEN '1997-09-03' AND '2001-09-03' AND wp.wp_char_count > 4000 AND wr.wr_return_ship_cost BETWEEN 45.88 AND 361.10 GROUP BY ib.ib_income_band_sk ORDER BY ib.ib_income_band_sk;
SELECT t_hour, COUNT(DISTINCT ws_order_number) AS number_of_transactions, SUM(ws_net_paid) AS total_sales_amount, AVG(ws_ext_discount_amt) AS average_discount_amount FROM web_sales ws JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk LEFT JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk WHERE td.t_am_pm = 'AM' AND (p.p_purpose IS NULL OR p.p_purpose <> 'Unknown') GROUP BY t_hour ORDER BY t_hour;
SELECT i.i_category, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(DISTINCT ss.ss_item_sk) AS item_count, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_sales_price) AS average_sale_price FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk AND p.p_channel_catalog = 'N' AND p.p_channel_email = 'N' WHERE ss.ss_customer_sk IS NOT NULL AND p.p_promo_sk IS NULL GROUP BY i.i_category, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY total_sales DESC, i.i_category, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status;
SELECT i.i_category AS item_category, i.i_brand AS item_brand, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid_inc_ship_tax) AS total_sales, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT i.i_item_sk) AS item_count FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN web_site w ON ws.ws_web_site_sk = w.web_site_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk WHERE w.web_mkt_class = 'Right efforts must no' AND sm.sm_code = 'SEA' AND w.web_company_id = 1 GROUP BY i.i_category, i.i_brand ORDER BY total_sales DESC, item_category, item_brand;
SELECT i.inv_date_sk, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_net_loss) AS total_net_loss, COUNT(DISTINCT p.p_promo_sk) AS total_promotions, SUM(p.p_cost) AS total_promotion_cost, AVG(i.inv_quantity_on_hand) AS average_inventory_quantity FROM inventory i LEFT JOIN catalog_returns cr ON i.inv_item_sk = cr.cr_item_sk LEFT JOIN promotion p ON i.inv_item_sk = p.p_item_sk WHERE i.inv_date_sk BETWEEN 2450705 AND 2450709 AND i.inv_item_sk IN (7891, 13309, 15649, 8698, 9958) AND ( p.p_channel_catalog = 'N' OR p.p_channel_catalog IS NULL ) AND ( cr.cr_returning_cdemo_sk IN (909578, 1587504, 1439824, 941784, 229946) OR cr.cr_returning_cdemo_sk IS NULL ) GROUP BY i.inv_date_sk ORDER BY i.inv_date_sk;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_ext_discount_amt) AS avg_discount_amount, COUNT(DISTINCT ss.ss_ticket_number) AS total_tickets, COUNT(DISTINCT p.p_promo_sk) AS total_promotions FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE p.p_channel_dmail = 'Y' AND ss.ss_sold_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_sales DESC, avg_discount_amount DESC;
SELECT d_year, p_channel_details, COUNT(DISTINCT ws_order_number) AS web_order_count, SUM(ws_net_paid) AS total_web_sales, SUM(ws_net_profit) AS total_web_profit, AVG(ws_quantity) AS average_quantity_sold, SUM(ss_net_paid) AS total_store_sales, SUM(ss_net_profit) AS total_store_profit, AVG(ss_quantity) AS average_store_quantity_sold FROM web_sales JOIN store_sales ON ws_item_sk = ss_item_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN promotion ON ws_promo_sk = p_promo_sk WHERE d_year IN (1902, 1903, 1904) AND p_channel_details IS NOT NULL AND (ws_net_paid > 0 OR ss_net_paid > 0) GROUP BY d_year, p_channel_details ORDER BY d_year, p_channel_details;
SELECT s_state, cd_gender, cd_marital_status, cd_education_status, hd_buy_potential, AVG(cd_purchase_estimate) AS avg_purchase_estimate, SUM(s_number_employees) AS total_employees, COUNT(DISTINCT s_store_sk) AS num_stores, MIN(s_floor_space) AS min_floor_space, MAX(s_floor_space) AS max_floor_space, AVG(s_floor_space) AS avg_floor_space, COUNT(DISTINCT hd_demo_sk) AS num_households, SUM(hd_vehicle_count) AS total_vehicles, AVG(hd_vehicle_count) AS avg_vehicles_per_household FROM store JOIN household_demographics ON (s_store_sk = hd_demo_sk) JOIN customer_demographics ON (hd_demo_sk = cd_demo_sk) WHERE s_country = 'United States' AND s_state IN ('CA', 'TX', 'FL') AND cd_dep_employed_count = 0 AND hd_buy_potential LIKE 'Unknown%' AND cd_education_status IN ('College', '4 yr Degree', 'Graduate Degree') AND s_market_id IS NOT NULL GROUP BY s_state, cd_gender, cd_marital_status, cd_education_status, hd_buy_potential ORDER BY s_state, avg_purchase_estimate DESC, total_employees DESC LIMIT 50;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(wr.wr_return_quantity) AS total_quantity_returned, SUM(wr.wr_net_loss) AS total_net_loss, COUNT(DISTINCT sm.sm_ship_mode_sk) AS shipping_modes_used FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number LEFT JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk WHERE cc.cc_open_date_sk IS NOT NULL AND (wr.wr_item_sk = '10174' OR wr.wr_item_sk = '3888') AND wr.wr_web_page_sk = '37' GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_net_loss DESC, total_quantity_sold DESC, unique_customers DESC;
SELECT i.i_category_id, i.i_category, COUNT(DISTINCT sr.sr_item_sk) AS total_returned_items, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount FROM store_returns sr JOIN item i ON sr.sr_item_sk = i.i_item_sk JOIN web_page wp ON wp.wp_access_date_sk = sr.sr_returned_date_sk JOIN catalog_page cp ON sr.sr_returned_date_sk BETWEEN cp.cp_start_date_sk AND cp.cp_end_date_sk WHERE wp.wp_access_date_sk IN ('2452566', '2452648', '2452619', '2452639') AND i.i_category_id IN ('9', '10', '4') GROUP BY i.i_category_id, i.i_category ORDER BY total_return_amount DESC LIMIT 5;
SELECT i.i_class, t.t_am_pm, COUNT(DISTINCT ss.ss_ticket_number) AS total_store_sales_transactions, SUM(ss.ss_net_paid) AS total_store_sales_revenue, AVG(ss.ss_net_paid) AS avg_store_sales_revenue, COUNT(DISTINCT ws.ws_order_number) AS total_web_sales_transactions, SUM(ws.ws_net_paid_inc_tax) AS total_web_sales_revenue, AVG(ws.ws_net_paid_inc_tax) AS avg_web_sales_revenue, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_returns_transactions, SUM(cr.cr_return_amount) AS total_catalog_returns_cost, AVG(cr.cr_return_amount) AS avg_catalog_returns_cost FROM item i LEFT JOIN store_sales ss ON i.i_item_sk = ss.ss_item_sk LEFT JOIN web_sales ws ON i.i_item_sk = ws.ws_item_sk LEFT JOIN catalog_returns cr ON i.i_item_sk = cr.cr_item_sk LEFT JOIN time_dim t ON (ss.ss_sold_time_sk = t.t_time_sk OR ws.ws_sold_time_sk = t.t_time_sk OR cr.cr_returned_time_sk = t.t_time_sk) WHERE i.i_class IN ('karoke', 'paint', 'personal') AND t.t_am_pm = 'AM' GROUP BY i.i_class, t.t_am_pm ORDER BY i.i_class, t.t_am_pm;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, SUM(cs.cs_net_paid) AS total_sales, SUM(cr.cr_return_amount) AS total_returns, (SUM(cs.cs_net_paid) - SUM(cr.cr_return_amount)) AS net_profit, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS number_of_orders, COUNT(DISTINCT cr.cr_order_number) AS number_of_returns FROM customer c LEFT JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name HAVING COUNT(DISTINCT cs.cs_order_number) > 0 AND COUNT(DISTINCT cr.cr_order_number) > 0 ORDER BY net_profit DESC, total_sales DESC LIMIT 100;
SELECT s.s_store_name, s.s_city, s.s_state, SUM(s.s_number_employees) AS total_employees, AVG(s.s_floor_space) AS average_floor_space, COUNT(DISTINCT cp.cp_catalog_page_sk) AS number_of_catalog_pages, SUM(CASE WHEN r.r_reason_id = 'AAAAAAAAMBAAAAAA' THEN 1 ELSE 0 END) AS count_mb_reason, SUM(CASE WHEN r.r_reason_id = 'AAAAAAAACAAAAAAA' THEN 1 ELSE 0 END) AS count_ca_reason, AVG(s.s_tax_precentage) AS average_tax_percentage FROM store s LEFT JOIN catalog_page cp ON (s.s_store_sk = cp.cp_catalog_number) LEFT JOIN reason r ON (r.r_reason_desc = cp.cp_description) WHERE s.s_street_type IN ('Boulevard', 'Court', 'Dr.', 'Circle') AND s.s_number_employees > 200 AND cp.cp_end_date_sk = '2451634' AND cp.cp_catalog_page_id IN ('AAAAAAAAFHPAAAAA', 'AAAAAAAAGPGAAAAA') GROUP BY s.s_store_name, s.s_city, s.s_state ORDER BY s.s_store_name;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_net_profit, AVG(hd.hd_dep_count) AS average_dependency_count, AVG(hd.hd_vehicle_count) AS average_vehicle_count, SUM(ws.ws_net_paid_inc_ship) AS total_web_net_paid_inc_ship, AVG(ws.ws_net_paid_inc_ship) AS average_web_net_paid_inc_ship, SUM(ws.ws_quantity) AS total_web_quantity_sold, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, s.s_country, s.s_tax_precentage, MAX(t.t_time) AS max_time_of_purchase, MIN(t.t_time) AS min_time_of_purchase FROM income_band ib LEFT JOIN household_demographics hd ON ib.ib_income_band_sk = hd.hd_income_band_sk LEFT JOIN catalog_sales cs ON hd.hd_demo_sk = cs.cs_bill_hdemo_sk LEFT JOIN web_sales ws ON hd.hd_demo_sk = ws.ws_bill_hdemo_sk LEFT JOIN store s ON s.s_store_sk = cs.cs_warehouse_sk LEFT JOIN time_dim t ON t.t_time_sk = cs.cs_sold_time_sk WHERE s.s_country = 'United States' AND t.t_am_pm = 'AM' AND s.s_tax_precentage IN (0.08, 0.01) AND ws.ws_net_paid_inc_ship IN (1475.10, 4030.95, 1226.89, 21728.07) AND t.t_second = 36 GROUP BY ib.ib_income_band_sk, s.s_country, s.s_tax_precentage ORDER BY total_net_profit DESC, total_web_net_paid_inc_ship DESC;
SELECT ca_state, ca_city, COUNT(DISTINCT c_customer_sk) AS number_of_customers, SUM(ss_net_paid) AS total_sales_amount, AVG(ss_quantity) AS average_quantity_sold, SUM(ss_net_profit) AS total_profit, MAX(ib_upper_bound) AS max_income_band_upper_bound, AVG(wr_return_amt) AS average_return_amount FROM customer_address JOIN customer ON c_current_addr_sk = ca_address_sk JOIN store_sales ON ss_customer_sk = c_customer_sk JOIN income_band ON ib_income_band_sk = (SELECT hd_income_band_sk FROM household_demographics WHERE hd_demo_sk = c_current_hdemo_sk) LEFT OUTER JOIN web_returns ON wr_order_number = ss_ticket_number AND wr_item_sk = ss_item_sk WHERE ca_street_type IN ('Dr.', 'Blvd', 'Ln', 'Cir.', 'Boulevard', 'Wy') AND ss_net_paid > 1000 AND ss_quantity < 50 GROUP BY ca_state, ca_city ORDER BY total_sales_amount DESC, average_quantity_sold DESC LIMIT 10;
SELECT dd.d_year, cd.cd_education_status, count(distinct c.c_customer_sk) as num_customers, sum(wr.wr_return_amt) as total_return_amount, avg(wr.wr_fee) as average_fee, count(distinct wr.wr_order_number) as total_returned_orders, sum(ib.ib_upper_bound) as total_income_upper_bound FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate = ib.ib_income_band_sk JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk JOIN date_dim dd ON wr.wr_returned_date_sk = dd.d_date_sk JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk WHERE dd.d_year = 2023 AND ws.web_company_id IN ('2', '4', '6', '5', '1') AND ib.ib_upper_bound IN (80000, 110000, 130000, 160000) GROUP BY dd.d_year, cd.cd_education_status ORDER BY total_return_amount DESC, average_fee DESC;
SELECT ws.web_name, ws.web_market_manager, ws.web_class, ws.web_city, COUNT(DISTINCT wp.wp_web_page_sk) AS total_pages, SUM(wp.wp_image_count) AS total_images, SUM(wp.wp_link_count) AS total_links, AVG(wp.wp_char_count) AS avg_char_count, SUM(sr.sr_return_quantity) AS total_returned_quantity, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, COUNT(DISTINCT sr.sr_customer_sk) AS distinct_returning_customers, dd.d_year, dd.d_quarter_name, SUM(CASE WHEN dd.d_holiday = 'Y' THEN 1 ELSE 0 END) AS holiday_count, SUM(CASE WHEN dd.d_weekend = 'Y' THEN 1 ELSE 0 END) AS weekend_count FROM web_site ws JOIN web_page wp ON ws.web_site_sk = wp.wp_web_page_sk JOIN date_dim dd ON wp.wp_access_date_sk = dd.d_date_sk LEFT JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk WHERE dd.d_year IN (2020, 2021) AND ws.web_market_manager IN ('Gilbert Chapman', 'Jeffrey Campbell', 'Keith Frazier') AND ws.web_close_date_sk IS NULL GROUP BY ws.web_name, ws.web_market_manager, ws.web_class, ws.web_city, dd.d_year, dd.d_quarter_name ORDER BY ws.web_market_manager, ws.web_name, dd.d_year, dd.d_quarter_name;
SELECT cd.cd_gender, cd.cd_marital_status, s.s_state, COUNT(wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount, AVG(wr.wr_return_amt_inc_tax) AS average_return_amount, AVG(wr.wr_fee) AS average_fee FROM web_returns wr JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk JOIN store s ON wr.wr_returning_addr_sk = s.s_store_sk WHERE wr.wr_returning_addr_sk IN (38908, 38512, 43731, 22184, 44035) AND wr.wr_refunded_hdemo_sk IN (3650, 1143, 1326, 7105) AND s.s_state = 'CA' GROUP BY cd.cd_gender, cd.cd_marital_status, s.s_state ORDER BY total_return_amount DESC, total_returns DESC;
