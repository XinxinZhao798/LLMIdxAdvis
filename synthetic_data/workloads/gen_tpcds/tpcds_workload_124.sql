SELECT cc.cc_city, cc.cc_name, SUM(ss.ss_quantity) AS total_sales_quantity, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_profit) AS total_sales_net_profit, SUM(sr.sr_return_quantity) AS total_returns_quantity, AVG(sr.sr_return_amt_inc_tax) AS average_return_amount_inc_tax, SUM(sr.sr_net_loss) AS total_returns_net_loss, SUM(inv.inv_quantity_on_hand) AS total_inventory_quantity, AVG(i.i_wholesale_cost) AS average_wholesale_cost, COUNT(DISTINCT hd.hd_demo_sk) AS unique_households FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN store_returns sr ON ss.ss_item_sk = sr.sr_item_sk AND ss.ss_ticket_number = sr.sr_ticket_number JOIN inventory inv ON ss.ss_item_sk = inv.inv_item_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk WHERE cc.cc_gmt_offset = '-5.00' AND cc.cc_open_date_sk IN (2450806, 2450952, 2451063) AND cc.cc_city = 'Midway' AND ss.ss_sold_date_sk BETWEEN '2450815' AND '2450815' + 30 AND sr.sr_store_sk IN (2, 4, 1) AND sr.sr_return_amt_inc_tax IN (258.90, 545.50, 3957.70) AND hd.hd_buy_potential IN ('1001-5000', 'Unknown', '501-1000') AND hd.hd_vehicle_count IN (1, 3, 0) AND i.i_rec_start_date IN ('2001-10-27', '1999-10-28', '1997-10-27') AND inv.inv_warehouse_sk IN (2, 1) AND inv.inv_quantity_on_hand IN (393, 230, 717) GROUP BY cc.cc_city, cc.cc_name ORDER BY total_sales_net_profit DESC, total_returns_net_loss ASC LIMIT 10;
SELECT c.cp_catalog_page_id, i.i_category, AVG(i.i_current_price) AS avg_current_price, SUM(sr.sr_return_amt) AS total_return_amount, COUNT(DISTINCT sr.sr_customer_sk) AS unique_customers_returning, SUM(wr.wr_return_amt_inc_tax) AS total_web_return_amount_inc_tax, AVG(wr.wr_return_ship_cost) AS avg_web_return_shipping_cost FROM catalog_page AS c JOIN item AS i ON c.cp_catalog_page_sk = i.i_item_sk LEFT JOIN store_returns AS sr ON i.i_item_sk = sr.sr_item_sk LEFT JOIN web_returns AS wr ON i.i_item_sk = wr.wr_item_sk WHERE c.cp_catalog_page_id IN ('AAAAAAAANDFAAAAA', 'AAAAAAAAJNJAAAAA', 'AAAAAAAALHEAAAAA') AND i.i_container = 'Unknown' AND sr.sr_customer_sk IN ('61916', '43478', '92201', '83008') AND sr.sr_item_sk IN ('1729', '3840', '8482') AND wr.wr_return_amt_inc_tax IN ('1793.82', '1539.82', '362.24', '311.63', '176.62', '164.88') AND wr.wr_return_ship_cost IN ('78.85', '1576.94', '590.04') GROUP BY c.cp_catalog_page_id, i.i_category ORDER BY total_return_amount DESC, total_web_return_amount_inc_tax DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT hd.hd_demo_sk) AS household_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, SUM(CASE WHEN cp.cp_department = 'DEPARTMENT' THEN 1 ELSE 0 END) AS department_page_count, sm.sm_carrier, COUNT(DISTINCT sm.sm_ship_mode_sk) AS ship_mode_count FROM household_demographics hd JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk LEFT JOIN catalog_page cp ON cp.cp_catalog_number = hd.hd_income_band_sk AND cp.cp_catalog_page_number IN (100, 52, 68) LEFT JOIN ship_mode sm ON sm.sm_ship_mode_sk = hd.hd_vehicle_count AND sm.sm_carrier IN ('ORIENTAL', 'GREAT EASTERN', 'USPS') WHERE hd.hd_income_band_sk IN (7, 19, 4) AND hd.hd_dep_count IN (0, 4, 1) AND hd.hd_demo_sk IN (390, 179, 2543) AND ib.ib_upper_bound IN (130000, 160000, 20000) AND ib.ib_lower_bound IN (130001, 10001, 140001) AND sm.sm_contract IN ('qENFQ', 'I3uCelXtjP', 'GNJr3g5i7oorKqtX') GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_carrier ORDER BY ib.ib_upper_bound DESC, household_count DESC;
SELECT COUNT(DISTINCT c.c_customer_sk) AS total_customers, AVG(w.w_warehouse_sq_ft) AS average_warehouse_size, SUM(p.p_cost) AS total_promotion_cost, s.s_state, s.s_city, COUNT(DISTINCT s.s_store_sk) AS total_stores, AVG(s.s_number_employees) AS average_store_employees FROM customer c JOIN store s ON c.c_current_addr_sk = s.s_store_sk JOIN warehouse w ON s.s_zip = w.w_zip JOIN promotion p ON p.p_channel_event = 'N' AND p.p_purpose != 'Unknown' GROUP BY s.s_state, s.s_city ORDER BY total_customers DESC, average_warehouse_size DESC, total_promotion_cost DESC;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(sr_return_amt) AS avg_return_amount, COUNT(DISTINCT sr.sr_ticket_number) AS num_of_returns, COUNT(DISTINCT sm.sm_ship_mode_id) AS num_of_shipping_modes_used FROM customer c JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN inventory inv ON sr.sr_item_sk = inv.inv_item_sk JOIN ship_mode sm ON sm.sm_type = 'NEXT DAY' OR sm.sm_type = 'TWO DAY' WHERE c.c_email_address IN ('Bruce.Ratliff@FDMnSp6ETps.org', 'Louis.Luna@LrZBOvDJ842PiFOfe.edu', 'Anthony.Wilson@BebfByYiKCcg.com') AND c.c_current_hdemo_sk IN ('3673', '5606') GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address ORDER BY c.c_last_name, c.c_first_name;
SELECT dd.d_month_seq, dd.d_quarter_seq, dd.d_year, cp.cp_type, COUNT(DISTINCT inv.inv_item_sk) AS low_stock_items, AVG(inv.inv_quantity_on_hand) AS avg_quantity_on_hand, MIN(inv.inv_quantity_on_hand) AS min_quantity_on_hand, MAX(inv.inv_quantity_on_hand) AS max_quantity_on_hand, COUNT(DISTINCT inv.inv_warehouse_sk) AS affected_warehouses FROM inventory inv JOIN date_dim dd ON inv.inv_date_sk = dd.d_date_sk JOIN catalog_page cp ON inv.inv_item_sk = cp.cp_catalog_page_sk WHERE inv.inv_quantity_on_hand < 750 AND dd.d_year = 2022 GROUP BY dd.d_month_seq, dd.d_quarter_seq, dd.d_year, cp.cp_type ORDER BY dd.d_year, dd.d_quarter_seq, dd.d_month_seq, cp.cp_type;
SELECT ws.web_site_id, ws.web_class, ws.web_name, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(wr.wr_refunded_cash) AS total_refunded_cash, SUM(sr.sr_return_quantity) AS store_total_returned_quantity, AVG(sr.sr_return_amt_inc_tax) AS store_avg_return_amount_inc_tax, SUM(sr.sr_refunded_cash) AS store_total_refunded_cash FROM web_site ws JOIN web_page wp ON ws.web_site_sk = wp.wp_web_page_sk JOIN web_returns wr ON wp.wp_web_page_sk = wr.wr_web_page_sk LEFT JOIN store_returns sr ON wr.wr_item_sk = sr.sr_item_sk AND wr.wr_refunded_customer_sk = sr.sr_customer_sk WHERE ws.web_class = 'Unknown' AND ws.web_rec_end_date IN ('2001-08-15', '2000-08-15', '1999-08-16') AND wp.wp_rec_start_date IN ('2000-09-03', '2001-09-03', '1997-09-03') AND wp.wp_link_count IN (7, 11, 19) AND wr.wr_return_amt_inc_tax IN (43.31, 378.40, 532.83) AND wr.wr_refunded_cash IN (2425.04, 1694.98, 8.69) AND sr.sr_customer_sk IN (38344, 71012, 20816) AND sr.sr_cdemo_sk IN (1443482, 746161, 1430182) GROUP BY ws.web_site_id, ws.web_class, ws.web_name ORDER BY total_returns DESC, total_refunded_cash DESC;
SELECT p.p_promo_id, p.p_promo_name, COUNT(ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws INNER JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk INNER JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk INNER JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk INNER JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE p.p_channel_press = 'N' AND hd.hd_vehicle_count IN (1, 2) AND ib.ib_income_band_sk IN (20, 8) AND p.p_purpose <> 'Unknown' GROUP BY p.p_promo_id, p.p_promo_name ORDER BY total_net_profit DESC, total_quantity_sold DESC;
SELECT ca.ca_state, COUNT(DISTINCT cr.cr_order_number) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_net_loss) AS total_net_loss, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_net_profit FROM customer_address ca LEFT JOIN catalog_returns cr ON ca.ca_address_sk = cr.cr_returning_addr_sk LEFT JOIN store_sales ss ON ca.ca_address_sk = ss.ss_addr_sk LEFT JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk LEFT JOIN inventory inv ON ss.ss_item_sk = inv.inv_item_sk AND cr.cr_item_sk = inv.inv_item_sk WHERE ss.ss_net_paid IN (2118.53, 811.65, 477.37) OR ss.ss_ext_sales_price IN (43.89, 681.72, 440.10, 1852.62, 93.60, 2554.68) GROUP BY ca.ca_state ORDER BY total_net_profit DESC, total_net_loss DESC
SELECT w_state, web_name, ca_city, COUNT(DISTINCT cr_order_number) AS total_returns, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_quantity) AS total_returned_quantity, SUM(cr_return_amount) AS total_returned_amount, SUM(cr_fee) AS total_fees, SUM(cr_net_loss) AS total_net_loss, COUNT(DISTINCT ss_ticket_number) AS total_sales_transactions, AVG(ss_sales_price) AS avg_sales_price, SUM(ss_quantity) AS total_sold_quantity, SUM(ss_net_profit) AS total_net_profit FROM warehouse JOIN catalog_returns ON w_warehouse_sk = cr_warehouse_sk JOIN reason ON cr_reason_sk = r_reason_sk JOIN customer_address ON cr_returning_addr_sk = ca_address_sk JOIN store_sales ON cr_item_sk = ss_item_sk AND cr_order_number = ss_ticket_number JOIN store ON ss_store_sk = s_store_sk JOIN web_site ON s_store_sk = web_site_sk WHERE w_country = 'United States' AND ca_street_number IN ('125', '871', '690') AND ca_city = 'Glenville' AND web_rec_end_date IN ('1999-08-16', '2000-08-15', '2001-08-15') AND web_site_sk IN ('25', '29', '21', '17') GROUP BY w_state, web_name, ca_city ORDER BY total_returns DESC, total_net_profit DESC;
SELECT ca.ca_state AS state, CASE WHEN cc.cc_call_center_sk IS NOT NULL THEN 'Call Center' WHEN ws.web_site_sk IS NOT NULL THEN 'Web Site' WHEN st.s_store_sk IS NOT NULL THEN 'Store' ELSE 'Unknown' END AS return_channel, COUNT(*) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, AVG(cr.cr_return_tax) AS avg_return_tax, AVG(cr.cr_return_ship_cost) AS avg_return_ship_cost FROM catalog_returns cr LEFT JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk LEFT JOIN web_site ws ON cr.cr_call_center_sk = ws.web_site_sk LEFT JOIN store st ON cr.cr_call_center_sk = st.s_store_sk LEFT JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk GROUP BY ca.ca_state, CASE WHEN cc.cc_call_center_sk IS NOT NULL THEN 'Call Center' WHEN ws.web_site_sk IS NOT NULL THEN 'Web Site' WHEN st.s_store_sk IS NOT NULL THEN 'Store' ELSE 'Unknown' END ORDER BY state, return_channel;
SELECT ws.ws_web_site_sk, web.web_name, COUNT(ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit, SUM(cr.cr_net_loss) AS total_net_loss, (SUM(ws.ws_net_profit) - SUM(cr.cr_net_loss)) AS net_gain_loss, COUNT(DISTINCT ws.ws_bill_customer_sk) AS unique_customers, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_returning_customers, COUNT(DISTINCT cr.cr_item_sk) AS unique_returned_items, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk LEFT JOIN catalog_returns cr ON ws.ws_order_number = cr.cr_order_number AND ws.ws_item_sk = cr.cr_item_sk WHERE web.web_county = 'Williamson County' AND (web.web_rec_end_date = '2000-08-15' OR web.web_rec_end_date = '1999-08-16') AND (ws.ws_ext_sales_price = 1271.34 OR ws.ws_ext_sales_price = 2832.48 OR ws.ws_ext_sales_price = 205.59 OR ws.ws_ext_sales_price = 4175.82 OR ws.ws_ext_sales_price = 885.30) GROUP BY ws.ws_web_site_sk, web.web_name ORDER BY net_gain_loss DESC;
SELECT st.s_store_name, st.s_store_id, SUM(ws.ws_net_paid) AS total_net_sales, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(wr.wr_order_number) AS total_returns, AVG(wr.wr_return_amt) AS avg_return_amount, ARRAY_AGG(DISTINCT re.r_reason_desc) AS reasons_for_returns FROM store st LEFT JOIN web_sales ws ON st.s_store_sk = ws.ws_warehouse_sk LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number LEFT JOIN reason re ON wr.wr_reason_sk = re.r_reason_sk WHERE st.s_division_id = 1 AND st.s_tax_precentage BETWEEN 0.01 AND 0.06 GROUP BY st.s_store_name, st.s_store_id ORDER BY total_net_sales DESC, avg_sales_price DESC, total_returns DESC, avg_return_amount DESC;
SELECT w_state, ca_country, COUNT(DISTINCT w_warehouse_sk) AS num_warehouses, COUNT(DISTINCT ca_address_sk) AS num_addresses, SUM(cd_purchase_estimate) AS total_purchase_estimate, AVG(w_warehouse_sq_ft) AS avg_warehouse_size, COUNT(DISTINCT cd_demo_sk) AS num_customer_demographics, MAX(cp_catalog_number) AS max_catalog_number FROM warehouse JOIN customer_address ON w_zip = ca_zip JOIN customer_demographics ON ca_county = w_county JOIN catalog_page ON cp_department = w_warehouse_name WHERE w_warehouse_sq_ft > 5000 AND ca_country = 'United States' AND cp_type = 'Electronics' AND cd_credit_rating = 'Good' GROUP BY w_state, ca_country ORDER BY num_warehouses DESC, total_purchase_estimate DESC;
SELECT cc.cc_division_name, i.i_manufact_id, i.i_category, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, COUNT(DISTINCT cr.cr_order_number) AS total_returned_orders, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(cr.cr_return_quantity) AS total_returned_quantity FROM call_center cc JOIN catalog_returns cr ON cc.cc_call_center_sk = cr.cr_call_center_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN customer c ON cr.cr_returning_customer_sk = c.c_customer_sk WHERE cc.cc_tax_percentage IN ('0.01', '0.12') AND i.i_manufact_id IN ('347', '497') AND c.c_birth_year IN ('1974', '1946', '1962', '1987', '1964') AND c.c_birth_country IN ('CAPE VERDE', 'POLAND', 'PITCAIRN', 'PAPUA NEW GUINEA', 'BELIZE', 'NIUE') GROUP BY cc.cc_division_name, i.i_manufact_id, i.i_category ORDER BY total_return_amount DESC;
SELECT i_category, i_brand, i_class, i_size, ca_state, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_profit) AS total_profit FROM catalog_sales JOIN item ON cs_item_sk = i_item_sk JOIN customer_address ON cs_ship_addr_sk = ca_address_sk WHERE cs_sold_date_sk IS NOT NULL AND i_rec_start_date <= '1999-10-28' AND i_formulation IN ('47violet063986294269', '99894237tan735493935', '3tan0939360655141073', 'snow8893404317305605') AND cs_ext_discount_amt IN ('4923.36', '6952.68', '1512.42', '81.69') AND ca_state IN ('NY', 'CA', 'TX') GROUP BY i_category, i_brand, i_class, i_size, ca_state ORDER BY total_profit DESC, total_quantity_sold DESC LIMIT 100;
SELECT i.i_category, cd.cd_gender, sm.sm_type, SUM(i.i_current_price) AS total_sales, AVG(i.i_wholesale_cost) AS average_wholesale, COUNT(DISTINCT inv.inv_warehouse_sk) AS unique_warehouses, COUNT(DISTINCT p.p_promo_sk) AS promotion_count FROM item AS i JOIN inventory AS inv ON i.i_item_sk = inv.inv_item_sk JOIN promotion AS p ON i.i_item_sk = p.p_item_sk AND p.p_channel_email = 'N' JOIN ship_mode AS sm ON sm.sm_ship_mode_sk = inv.inv_warehouse_sk JOIN customer_demographics AS cd ON cd.cd_demo_sk = i.i_manager_id WHERE i.i_rec_start_date <= '2023-01-01' AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date >= '2023-01-01') AND p.p_end_date_sk IN ('2450342', '2450365', '2450396', '2450787', '2450351') GROUP BY i.i_category, cd.cd_gender, sm.sm_type ORDER BY total_sales DESC, i.i_category, cd.cd_gender, sm.sm_type;
SELECT c.cc_call_center_id AS call_center, c.cc_name AS call_center_name, c.cc_manager AS call_center_manager, i.i_manufact_id AS manufacturer_id, COUNT(ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM call_center c JOIN web_sales ws ON c.cc_call_center_sk = ws.ws_warehouse_sk JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk WHERE i.i_manufact_id IN (275, 862, 397) AND c.cc_open_date_sk <= dd.d_date_sk AND (c.cc_rec_end_date IS NULL OR c.cc_rec_end_date >= dd.d_date) GROUP BY c.cc_call_center_id, c.cc_name, c.cc_manager, i.i_manufact_id ORDER BY total_net_profit DESC;
SELECT s.s_store_name, s.s_city, s.s_state, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN warehouse w ON s.s_zip = w.w_zip JOIN ship_mode sm ON w.w_country = sm.sm_carrier WHERE ss.ss_sold_date_sk BETWEEN 2451189 AND 2451200 AND ss.ss_quantity > 50 GROUP BY s.s_store_name, s.s_city, s.s_state ORDER BY total_net_profit DESC, total_quantity_sold DESC LIMIT 10;
SELECT cc.cc_city, cc.cc_name, i.i_category, sum(sr.sr_return_amt_inc_tax) AS total_return_amount_including_tax, avg(sr.sr_return_quantity) AS average_return_quantity, count(sr.sr_ticket_number) AS total_returns, sum(CASE WHEN hd.hd_dep_count BETWEEN 1 AND 3 THEN sr.sr_return_amt_inc_tax ELSE 0 END) AS return_amount_families_1_to_3_kids, sum(CASE WHEN hd.hd_dep_count >= 4 THEN sr.sr_return_amt_inc_tax ELSE 0 END) AS return_amount_families_4_or_more_kids, sum(CASE WHEN sr.sr_return_amt > 0 AND sr.sr_fee > 0 THEN 1 ELSE 0 END) AS returns_with_fees FROM store_returns sr JOIN item i ON sr.sr_item_sk = i.i_item_sk JOIN call_center cc ON cc.cc_city = 'Midway' LEFT JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk WHERE sr.sr_returned_date_sk IS NOT NULL AND sr.sr_store_credit > 0 GROUP BY cc.cc_city, cc.cc_name, i.i_category ORDER BY total_return_amount_including_tax DESC, cc.cc_city, cc.cc_name, i.i_category;
