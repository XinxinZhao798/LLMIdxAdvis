SELECT i.i_category, i.i_class, i.i_brand, cd.cd_gender, cd.cd_education_status, SUM(ws.ws_sales_price) AS total_sales, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(*) AS number_of_sales, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cr.cr_order_number) AS number_of_returns FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk LEFT JOIN catalog_returns cr ON ws.ws_order_number = cr.cr_order_number AND ws.ws_item_sk = cr.cr_item_sk LEFT JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk GROUP BY i.i_category, i.i_class, i.i_brand, cd.cd_gender, cd.cd_education_status ORDER BY i.i_category, i.i_class, i.i_brand, cd.cd_gender, cd.cd_education_status;
SELECT r.r_reason_desc AS reason_for_return, w.w_state AS warehouse_state, COUNT(wr.wr_order_number) AS number_of_returns, AVG(wr.wr_return_amt_inc_tax) AS average_return_amount_inc_tax, SUM(wr.wr_return_tax) AS total_return_tax, AVG(wr.wr_net_loss) AS average_net_loss FROM web_returns wr JOIN reason r ON wr.wr_reason_sk = r.r_reason_sk JOIN warehouse w ON wr.wr_returning_addr_sk = w.w_warehouse_sk WHERE r.r_reason_desc IN ('reason 33', 'it is a girl', 'Lost my job', 'Found a better extended warranty in a store') AND w.w_warehouse_name IN ('Important issues liv', 'Bad cards must make.', 'Conventional childr', 'Doors canno') AND wr.wr_return_amt_inc_tax > 0 GROUP BY reason_for_return, warehouse_state ORDER BY number_of_returns DESC, average_return_amount_inc_tax DESC;
SELECT i.i_category, sm.sm_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_profit) AS total_net_profit, AVG(cs.cs_net_profit) AS average_net_profit, SUM(inv.inv_quantity_on_hand) AS total_inventory_on_hand FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk WHERE sm.sm_type = 'EXPRESS' AND inv.inv_date_sk = 2450815 AND (inv.inv_quantity_on_hand IN (339, 505, 759, 226, 679) OR cs.cs_bill_hdemo_sk IN (523, 2390, 5794)) GROUP BY i.i_category, sm.sm_type ORDER BY total_net_profit DESC;
SELECT web_site.web_site_id, web_site.web_class, web_site.web_name, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_quantity) AS total_web_quantity_sold, AVG(ws.ws_net_paid) AS avg_web_net_paid, SUM(cr.cr_return_quantity) AS total_catalog_returned_quantity, AVG(cr.cr_return_amount) AS avg_catalog_return_amount, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, SUM(sr.sr_return_amt) AS total_store_return_amount, s.s_store_name, s.s_state, COUNT(DISTINCT cs.cs_order_number) AS total_catalog_orders, SUM(cs.cs_quantity) AS total_catalog_quantity_sold, AVG(cs.cs_net_paid_inc_tax) AS avg_catalog_net_paid_inc_tax, time_dim.t_shift, time_dim.t_sub_shift FROM web_sales ws LEFT JOIN web_site ON ws.ws_web_site_sk = web_site.web_site_sk LEFT JOIN catalog_sales cs ON ws.ws_order_number = cs.cs_order_number LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number LEFT JOIN store_returns sr ON cr.cr_order_number = sr.sr_ticket_number LEFT JOIN store s ON sr.sr_store_sk = s.s_store_sk LEFT JOIN time_dim ON ws.ws_sold_time_sk = time_dim.t_time_sk WHERE s.s_gmt_offset = '-5.00' AND COALESCE(CAST(s.s_closed_date_sk AS TEXT), '') NOT IN ('2451044', '2451189') AND cr.cr_return_quantity IN (95, 94, 84, 23) AND cr.cr_ship_mode_sk IN (14, 5, 19, 8, 2) AND (time_dim.t_sub_shift = 'night' OR time_dim.t_shift = 'third') AND cs.cs_bill_customer_sk IN (49534, 61995) AND cs.cs_net_paid = 3022.20 GROUP BY web_site.web_site_id, web_site.web_class, web_site.web_name, s.s_store_name, s.s_state, time_dim.t_shift, time_dim.t_sub_shift ORDER BY web_site.web_name, s.s_store_name LIMIT 100;
SELECT hd.hd_dep_count, COUNT(*) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_return_quantity) AS total_return_quantity, AVG(cr.cr_return_quantity) AS average_return_quantity, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk GROUP BY ROLLUP(hd.hd_dep_count) HAVING hd.hd_dep_count IN (2, 7, 9, 4, 8, 3) ORDER BY hd.hd_dep_count;
SELECT ws_order_number, COUNT(DISTINCT ws_item_sk) AS item_count, SUM(ws_quantity) AS total_quantity, AVG(ws_sales_price) AS avg_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ws_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(ws_net_profit) AS total_net_profit, MIN(ws_ext_ship_cost) AS min_shipping_cost, MAX(ws_ext_ship_cost) AS max_shipping_cost FROM web_sales JOIN catalog_sales ON ws_item_sk = cs_item_sk AND ws_order_number = cs_order_number JOIN store_sales ON ws_item_sk = ss_item_sk AND ws_order_number = ss_ticket_number JOIN web_page ON ws_web_page_sk = wp_web_page_sk JOIN inventory ON ws_item_sk = inv_item_sk WHERE ws_sales_price BETWEEN 100 AND 200 AND cs_sales_price BETWEEN 100 AND 200 AND ss_sales_price BETWEEN 100 AND 200 AND ws_ext_ship_cost BETWEEN 10 AND 1360 AND wp_type = 'Product Review' GROUP BY ws_order_number HAVING COUNT(DISTINCT ws_item_sk) > 1 ORDER BY total_net_profit DESC;
SELECT dd.d_year, i.i_category, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_profit) AS total_net_profit, COUNT(DISTINCT wr_order_number) AS total_returns, SUM(wr_return_quantity) AS total_quantity_returned, AVG(wr_return_amt) AS average_return_amount, SUM(wr_net_loss) AS total_net_loss FROM date_dim dd JOIN catalog_sales cs ON dd.d_date_sk = cs.cs_sold_date_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk LEFT JOIN web_returns wr ON i.i_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number WHERE dd.d_year = 2001 AND i.i_size = 'medium' AND ( wr.wr_refunded_hdemo_sk = '4852' OR wr.wr_fee IN ('29.43', '58.44') OR dd.d_same_day_lq IN ('2415041', '2417033', '2416545', '2418165', '2417025', '2416046') ) GROUP BY dd.d_year, i.i_category ORDER BY total_net_profit DESC, total_net_loss ASC;
SELECT ca_state, COUNT(DISTINCT c_customer_sk) AS total_customers, SUM(wr_return_amt_inc_tax) AS total_refunds, AVG(wr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT wr_order_number) AS total_return_orders, s_store_name, s_city, s_state FROM customer_address JOIN customer ON customer.c_current_addr_sk = customer_address.ca_address_sk JOIN web_returns ON customer_address.ca_address_sk = web_returns.wr_refunded_addr_sk JOIN store ON customer_address.ca_state = store.s_state WHERE customer.c_preferred_cust_flag = 'Y' AND web_returns.wr_returned_date_sk BETWEEN '20210101' AND '20211231' GROUP BY ca_state, s_store_name, s_city, s_state ORDER BY total_refunds DESC, avg_return_quantity DESC LIMIT 100;
SELECT sm.sm_type, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_quantity) AS total_web_quantity_sold, AVG(ws.ws_sales_price) AS avg_web_sales_price, SUM(cr.cr_return_quantity) AS total_return_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cr.cr_order_number) AS total_returns FROM web_sales ws JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk LEFT JOIN catalog_returns cr ON ws.ws_order_number = cr.cr_order_number AND ws.ws_item_sk = cr.cr_item_sk WHERE sm.sm_type IN ('EXPRESS', 'OVERNIGHT', 'NEXT DAY') GROUP BY sm.sm_type, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY sm.sm_type, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status;
SELECT s_store_name, s_state, COUNT(sr_ticket_number) AS total_returns, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_quantity) AS average_return_quantity, SUM(ws_net_paid_inc_tax) AS total_sales_inc_tax, AVG(ws_list_price) AS average_list_price, AVG(ws_net_profit) AS average_net_profit FROM store s JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk JOIN web_sales ws ON sr.sr_item_sk = ws.ws_item_sk JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE c.c_email_address IN ( 'Adam.Chambers@1fmL5RoSch74.edu', 'William.Kaye@Mx1n74bCJjkc08.edu', 'Imogene.Lewis@813MelxMLZ9gy.com', 'Dorothy.Garza@6Tn1dJ431OQYNTb.org', 'Ora.Spain@CT.edu', 'Denise.Gomez@3GlO.edu' ) AND ws.ws_net_paid_inc_tax IN (15407.14, 2937.00, 988.50, 3439.64, 992.77) AND ws.ws_list_price IN (177.80, 201.11) AND hd.hd_income_band_sk IN (16, 7) AND sr.sr_return_tax IN (215.85, 29.41, 35.05, 67.89) GROUP BY s_store_name, s_state ORDER BY total_return_amount DESC;
