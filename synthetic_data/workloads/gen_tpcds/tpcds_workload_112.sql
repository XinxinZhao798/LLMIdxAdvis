SELECT w_warehouse_name, cd_credit_rating, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_quantity) AS total_return_quantity, COUNT(DISTINCT cr_order_number) AS total_orders_returned, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns INNER JOIN warehouse ON catalog_returns.cr_warehouse_sk = warehouse.w_warehouse_sk INNER JOIN customer_demographics ON catalog_returns.cr_refunded_cdemo_sk = customer_demographics.cd_demo_sk INNER JOIN household_demographics ON catalog_returns.cr_refunded_hdemo_sk = household_demographics.hd_demo_sk WHERE cr_returned_date_sk IN (2451154, 2451037, 2450875, 2450957, 2450981) AND household_demographics.hd_income_band_sk IN ('12', '7', '9', '5', '16', '3') AND household_demographics.hd_vehicle_count = 3 AND customer_demographics.cd_dep_employed_count = 0 AND catalog_returns.cr_store_credit IN (950.05, 59.82, 39.71) GROUP BY w_warehouse_name, cd_credit_rating ORDER BY total_net_loss DESC, avg_return_amount DESC;
SELECT c.c_first_name, c.c_last_name, sum(ss.ss_quantity) as total_items_sold, avg(ss.ss_sales_price) as average_sales_price, sum(ss.ss_net_paid) as total_revenue, sum(ss.ss_net_profit) as total_profit, p.p_promo_name, count(DISTINCT ss.ss_ticket_number) as number_of_sales_transactions FROM store_sales ss JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN inventory i ON ss.ss_item_sk = i.inv_item_sk AND i.inv_date_sk = ss.ss_sold_date_sk WHERE c.c_last_name IN ('Waggoner', 'Hoyt', 'Moffitt', 'Buchanan', 'Orourke') AND i.inv_warehouse_sk IN ('1', '2') AND p.p_channel_catalog = 'N' AND ss.ss_promo_sk IN ('11', '103', '131', '133', '275') GROUP BY c.c_first_name, c.c_last_name, p.p_promo_name ORDER BY total_revenue DESC, c.c_last_name, c.c_first_name;
SELECT p.p_promo_name, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, AVG(sr.sr_return_amt) AS avg_return_amount, r.r_reason_desc AS most_common_return_reason, COUNT(*) AS reason_count FROM store_returns sr JOIN promotion p ON sr.sr_item_sk = p.p_item_sk JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk LEFT JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE sr.sr_store_sk IN (1, 4, 8) AND p.p_item_sk IN (13903, 4790, 11371, 10280, 11452) AND hd.hd_vehicle_count IN (3, 1) GROUP BY p.p_promo_name, r.r_reason_desc ORDER BY total_returns DESC, avg_return_amount DESC, reason_count DESC LIMIT 100;
SELECT ca.ca_state AS state, CASE WHEN cc.cc_call_center_sk IS NOT NULL THEN 'Call Center' WHEN ws.web_site_sk IS NOT NULL THEN 'Web Site' WHEN st.s_store_sk IS NOT NULL THEN 'Store' ELSE 'Unknown' END AS return_channel, COUNT(*) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, AVG(cr.cr_return_tax) AS avg_return_tax, AVG(cr.cr_return_ship_cost) AS avg_return_ship_cost FROM catalog_returns cr LEFT JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk LEFT JOIN web_site ws ON cr.cr_call_center_sk = ws.web_site_sk LEFT JOIN store st ON cr.cr_call_center_sk = st.s_store_sk LEFT JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk GROUP BY ca.ca_state, CASE WHEN cc.cc_call_center_sk IS NOT NULL THEN 'Call Center' WHEN ws.web_site_sk IS NOT NULL THEN 'Web Site' WHEN st.s_store_sk IS NOT NULL THEN 'Store' ELSE 'Unknown' END ORDER BY state, return_channel;
SELECT i.i_category, i.i_size, hd.hd_buy_potential, COUNT(p.p_promo_sk) AS total_promotions, SUM(p.p_cost) AS total_promo_cost, AVG(p.p_cost) AS average_promo_cost, CASE WHEN p.p_channel_catalog = 'N' THEN 'Not Catalog' ELSE 'Catalog' END AS promo_channel_catalog, SUM(CASE WHEN p.p_discount_active = 'Y' THEN 1 ELSE 0 END) AS active_discounts FROM promotion p JOIN item i ON p.p_item_sk = i.i_item_sk JOIN household_demographics hd ON i.i_size = hd.hd_buy_potential JOIN customer_demographics cd ON hd.hd_income_band_sk = cd.cd_purchase_estimate WHERE i.i_size IN ('economy', 'medium', 'large') AND hd.hd_buy_potential IN ('>10000', 'Unknown', '0-500', '5001-10000', '1001-5000', '501-1000') AND p.p_channel_catalog = 'N' AND i.i_category_id = '8' AND p.p_purpose NOT IN ('Unknown') GROUP BY i.i_category, i.i_size, hd.hd_buy_potential, promo_channel_catalog ORDER BY total_promotions DESC, total_promo_cost DESC;
SELECT cd.cd_education_status, cd.cd_credit_rating, COUNT(c.c_customer_sk) AS total_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(cd.cd_dep_count) AS total_dependents, SUM(cd.cd_dep_employed_count) AS employed_dependents, SUM(cd.cd_dep_college_count) AS college_dependents FROM customer_demographics cd JOIN customer c ON cd.cd_demo_sk = c.c_current_cdemo_sk LEFT JOIN promotion p ON c.c_current_hdemo_sk = p.p_promo_sk WHERE cd.cd_credit_rating IN ('High Risk', 'Low Risk', 'Good', 'Unknown') AND c.c_last_review_date_sk IN (2452297, 2452588) GROUP BY cd.cd_education_status, cd.cd_credit_rating ORDER BY cd.cd_education_status, cd.cd_credit_rating;
SELECT cc.cc_name AS call_center_name, w.w_warehouse_name AS warehouse_name, s.s_state AS state, SUM(cs.cs_quantity) AS total_items_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_item_sk) AS number_of_unique_items_sold FROM catalog_sales cs INNER JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk INNER JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk INNER JOIN store s ON cc.cc_division = s.s_division_id WHERE cc.cc_market_manager IN ('Matthew Clifton', 'Gary Colburn') AND s.s_country = 'United States' GROUP BY call_center_name, warehouse_name, state ORDER BY total_items_sold DESC, average_sales_price DESC;
SELECT cd.cd_gender, cd.cd_marital_status, s.s_state, COUNT(wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount, AVG(wr.wr_return_amt_inc_tax) AS average_return_amount, AVG(wr.wr_fee) AS average_fee FROM web_returns wr JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk JOIN store s ON wr.wr_returning_addr_sk = s.s_store_sk WHERE wr.wr_returning_addr_sk IN (38908, 38512, 43731, 22184, 44035) AND wr.wr_refunded_hdemo_sk IN (3650, 1143, 1326, 7105) AND s.s_state = 'CA' GROUP BY cd.cd_gender, cd.cd_marital_status, s.s_state ORDER BY total_return_amount DESC, total_returns DESC;
SELECT ca.ca_state, cd.cd_education_status, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(ss.ss_quantity) AS total_sales_quantity, AVG(ss.ss_net_profit) AS avg_net_profit, SUM(sr.sr_return_quantity) AS total_return_quantity, AVG(sr.sr_net_loss) AS avg_net_loss, AVG(inv.inv_quantity_on_hand) AS avg_inventory_on_hand FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk LEFT JOIN inventory inv ON inv.inv_warehouse_sk = ca.ca_address_sk WHERE ca.ca_country = 'SERBIA' AND cd.cd_purchase_estimate BETWEEN 3500 AND 10000 AND inv.inv_warehouse_sk IN (1, 2) GROUP BY ca.ca_state, cd.cd_education_status ORDER BY ca.ca_state, cd.cd_education_status;
SELECT cu.c_salutation, wh.w_state, COUNT(DISTINCT cs.cs_order_number) AS total_sales_transactions, SUM(cs.cs_net_paid_inc_tax) AS total_sales_amount, AVG(cs.cs_ext_discount_amt) AS average_discount, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount FROM customer cu LEFT JOIN catalog_sales cs ON cu.c_customer_sk = cs.cs_ship_customer_sk LEFT JOIN store_returns sr ON cu.c_customer_sk = sr.sr_customer_sk LEFT JOIN warehouse wh ON (cs.cs_warehouse_sk = wh.w_warehouse_sk OR sr.sr_store_sk = wh.w_warehouse_sk) LEFT JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE (cs.cs_sold_date_sk IN ('2450819', '2450822', '2450817') OR sr.sr_returned_date_sk IN ('2450819', '2450822', '2450817')) AND (cu.c_salutation IN ('Dr.', 'Mr.', 'Sir', 'Ms.', 'Mrs.', 'Miss')) AND (wh.w_city = 'Fairview') AND (wh.w_suite_number IN ('Suite 80', 'Suite 0', 'Suite P', 'Suite 470')) AND (cu.c_last_review_date_sk IN ('2452425', '2452326', '2452389')) AND (sr.sr_reversed_charge IN ('44.04', '12.34') OR sr.sr_reversed_charge IS NULL) GROUP BY cu.c_salutation, wh.w_state ORDER BY total_sales_amount DESC, total_return_amount ASC;
SELECT d_year, d_quarter_name, sm_type AS shipping_type, COUNT(DISTINCT ss_ticket_number) AS num_sales_transactions, SUM(ss_quantity) AS total_sold_quantity, AVG(ss_sales_price) AS average_sales_price, SUM(ss_net_profit) AS total_sales_net_profit, COUNT(DISTINCT sr_ticket_number) AS num_returns_transactions, SUM(sr_return_quantity) AS total_returned_quantity, AVG(sr_return_amt) AS average_return_amount, SUM(sr_net_loss) AS total_returns_net_loss, AVG(hd_dep_count) AS average_dependency_count, AVG(hd_vehicle_count) AS average_vehicle_count, AVG(ib_lower_bound) AS average_income_lower_bound, AVG(ib_upper_bound) AS average_income_upper_bound FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN store_returns ON sr_item_sk = ss_item_sk AND sr_returned_date_sk = ss_sold_date_sk JOIN ship_mode ON sm_ship_mode_sk = ss_sold_date_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN income_band ON hd_income_band_sk = ib_income_band_sk WHERE d_moy IN (2, 4, 6, 8, 12) AND sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') AND sm_carrier IN ('PRIVATECARRIER', 'DIAMOND') GROUP BY d_year, d_quarter_name, shipping_type ORDER BY d_year, d_quarter_name, shipping_type;
SELECT w.web_name, w.web_manager, SUM(i.i_current_price) AS total_current_price, AVG(i.i_wholesale_cost) AS average_wholesale_cost, COUNT(i.i_item_sk) AS item_count, SM.sm_type, MAX(i.i_current_price) AS max_price, MIN(i.i_current_price) AS min_price FROM web_site AS w JOIN item AS i ON w.web_site_sk = i.i_manufact_id JOIN ship_mode AS SM ON SM.sm_ship_mode_sk = i.i_item_sk WHERE i.i_rec_start_date <= CURRENT_DATE AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date > CURRENT_DATE) AND SM.sm_type IN ('EXPRESS', 'OVERNIGHT', 'REGULAR') AND i.i_current_price IN (5.40, 8.89) GROUP BY w.web_name, w.web_manager, SM.sm_type ORDER BY total_current_price DESC, item_count DESC;
SELECT ib_lower_bound, ib_upper_bound, ca_state, ca_city, AVG(ss_quantity) AS avg_quantity_sold, SUM(ss_net_paid) AS total_net_paid, SUM(ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss_net_profit) AS total_net_profit, COUNT(DISTINCT ss_customer_sk) AS unique_customers_count FROM store_sales JOIN customer_address ON store_sales.ss_addr_sk = customer_address.ca_address_sk JOIN household_demographics ON store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk JOIN income_band ON household_demographics.hd_income_band_sk = income_band.ib_income_band_sk WHERE ca_zip IN ('65804', '18828', '28767', '57995') AND ss_sold_time_sk IN ('64456', '55232', '34662', '70640') AND ss_quantity IN (14, 26, 7, 79, 8, 63) GROUP BY ib_lower_bound, ib_upper_bound, ca_state, ca_city ORDER BY ca_state, ca_city, ib_lower_bound, ib_upper_bound;
SELECT ws.web_class, ws.web_market_manager, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS number_of_orders, SUM(wr.wr_return_quantity) AS total_quantity_returned, SUM(wr.wr_net_loss) AS total_net_loss FROM catalog_sales cs JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number JOIN web_site ws ON cs.cs_warehouse_sk = ws.web_site_sk WHERE cs.cs_sold_date_sk IS NOT NULL AND wr.wr_returned_date_sk IS NOT NULL AND ws.web_close_date_sk IN ('2447080', '2447148', '2448752', '2448854', '2448956', '2448820') AND ws.web_mkt_desc IN ('Concerned, royal weeks should announce.', 'Companies grow cells. Apart true eyes u', 'Formerly long minds deal aside parties. Lef', 'Political affairs ought to') GROUP BY ws.web_class, ws.web_market_manager ORDER BY total_quantity_sold DESC, total_net_loss ASC;
SELECT w.web_name, cp.cp_department, sm.sm_type, COUNT(distinct i.i_item_sk) as total_items, SUM(i.i_current_price) as total_sales, AVG(i.i_wholesale_cost) as avg_wholesale_cost, COUNT(distinct w.web_site_sk) as total_websites FROM web_site w JOIN catalog_page cp ON w.web_site_sk = cp.cp_catalog_number JOIN item i ON cp.cp_department = i.i_category JOIN ship_mode sm ON sm.sm_carrier = i.i_manufact WHERE i.i_category = 'Music' AND w.web_city IN ('Fairview', 'Midway') AND sm.sm_ship_mode_id IN ('AAAAAAAAIAAAAAAA', 'AAAAAAAALAAAAAAA') AND i.i_item_id IN ('AAAAAAAAJCCAAAAA', 'AAAAAAAANGMAAAAA', 'AAAAAAAAICDAAAAA', 'AAAAAAAAHLABAAAA', 'AAAAAAAAIIEAAAAA', 'AAAAAAAALAOAAAAA') AND w.web_name IN ('site_3', 'site_4', 'site_1', 'site_0', 'site_2') GROUP BY w.web_name, cp.cp_department, sm.sm_type ORDER BY total_sales DESC;
SELECT cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, COUNT(DISTINCT wr_returning_customer_sk) AS num_returning_customers, SUM(wr_return_quantity) AS total_returned_quantity, AVG(wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(wr_net_loss) AS total_net_loss, r_reason_desc, w_warehouse_name, w_city, w_state FROM web_returns JOIN customer_demographics ON web_returns.wr_returning_cdemo_sk = customer_demographics.cd_demo_sk JOIN reason ON web_returns.wr_reason_sk = reason.r_reason_sk JOIN warehouse ON web_returns.wr_returning_addr_sk = warehouse.w_warehouse_sk GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, r_reason_desc, w_warehouse_name, w_city, w_state ORDER BY total_net_loss DESC, avg_return_amount_inc_tax DESC LIMIT 100;
SELECT r_reason_desc, w_state, COUNT(DISTINCT cr_order_number) AS total_catalog_returns, SUM(cr_return_quantity) AS total_returned_quantity, SUM(cr_return_amount) AS total_refund_amount, AVG(cr_return_amount) AS avg_refund_amount_per_return, SUM(cr_fee) AS total_fees, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns JOIN reason ON catalog_returns.cr_reason_sk = reason.r_reason_sk JOIN warehouse ON catalog_returns.cr_warehouse_sk = warehouse.w_warehouse_sk GROUP BY r_reason_desc, w_state ORDER BY total_refund_amount DESC, total_returned_quantity DESC;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, SUM(cs.cs_quantity) AS total_catalog_quantity, AVG(cs.cs_sales_price) AS avg_catalog_sales_price, COUNT(DISTINCT cs.cs_order_number) AS num_catalog_orders, SUM(ws.ws_quantity) AS total_web_quantity, AVG(ws.ws_sales_price) AS avg_web_sales_price, COUNT(DISTINCT ws.ws_order_number) AS num_web_orders, SUM(cs.cs_net_profit) AS total_catalog_net_profit, SUM(ws.ws_net_profit) AS total_web_net_profit FROM customer_demographics cd LEFT JOIN catalog_sales cs ON cd.cd_demo_sk = cs.cs_bill_cdemo_sk LEFT JOIN web_sales ws ON cd.cd_demo_sk = ws.ws_bill_cdemo_sk WHERE (cs.cs_bill_cdemo_sk IN (182647, 387585) OR ws.ws_ship_mode_sk IN (12, 2, 5)) GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY total_catalog_net_profit DESC, total_web_net_profit DESC;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_country, ca.ca_state, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(DISTINCT web.web_site_sk) AS distinct_websites, COUNT(DISTINCT wp.wp_web_page_sk) AS distinct_web_pages FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk JOIN web_page wp ON wp.wp_customer_sk = ss.ss_customer_sk JOIN web_site web ON web.web_company_id = wp.wp_web_page_sk WHERE dd.d_year = 1998 AND ca.ca_country = 'United States' AND ca.ca_state IN ('NY', 'CA', 'TX') AND web.web_company_id IN ('6', '3', '5') AND wp.wp_autogen_flag = 'N' GROUP BY ROLLUP (dd.d_year, dd.d_quarter_name, ca.ca_country, ca.ca_state) ORDER BY dd.d_year, dd.d_quarter_name, ca.ca_country, ca.ca_state;
SELECT wsit.web_name AS website_name, wsit.web_class AS website_class, wsit.web_manager AS website_manager, cc.cc_name AS call_center_name, cc.cc_manager AS call_center_manager, SUM(cs.cs_net_paid) AS total_catalog_sales, AVG(cs.cs_net_paid) AS avg_catalog_sales, COUNT(DISTINCT cs.cs_order_number) AS total_catalog_orders, SUM(ws.ws_net_paid) AS total_web_sales, AVG(ws.ws_net_paid) AS avg_web_sales, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders FROM web_sales ws JOIN web_site wsit ON ws.ws_web_site_sk = wsit.web_site_sk LEFT JOIN catalog_sales cs ON ws.ws_order_number = cs.cs_order_number LEFT JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk WHERE wsit.web_country = 'United States' AND (cc.cc_division_name IN ('anti', 'ought', 'pri', 'ese') OR cc.cc_division_name IS NULL) GROUP BY wsit.web_name, wsit.web_class, wsit.web_manager, cc.cc_name, cc.cc_manager ORDER BY total_catalog_sales DESC, total_web_sales DESC;
SELECT cp.cp_department, COUNT(DISTINCT cp.cp_catalog_page_sk) AS number_of_catalog_pages, AVG(cd.cd_purchase_estimate) AS average_purchase_estimate, SUM(inv.inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT cd.cd_demo_sk) FILTER (WHERE cd.cd_credit_rating = 'High Risk') AS high_risk_customer_count, COUNT(DISTINCT cd.cd_demo_sk) FILTER (WHERE cd.cd_credit_rating = 'Unknown') AS unknown_credit_rating_count, SUM(cd.cd_dep_college_count) AS total_college_dependents FROM catalog_page cp JOIN customer_demographics cd ON cp.cp_catalog_page_sk = cd.cd_demo_sk JOIN inventory inv ON cp.cp_catalog_page_sk = inv.inv_warehouse_sk WHERE cp.cp_department = 'DEPARTMENT' GROUP BY cp.cp_department ORDER BY number_of_catalog_pages DESC;
SELECT d.d_year, d.d_quarter_name, d.d_moy, d.d_holiday, w.w_city, w.w_gmt_offset, SUM(wp.wp_link_count) AS total_links, AVG(wp.wp_char_count) AS average_char_count, COUNT(DISTINCT wp.wp_customer_sk) AS distinct_customers, COUNT(*) AS page_count FROM web_page wp JOIN date_dim d ON wp.wp_access_date_sk = d.d_date_sk JOIN warehouse w ON w.w_gmt_offset = '-5.00' WHERE d.d_moy IN ('5', '11') AND (d.d_holiday = 'Y' OR d.d_holiday = 'N') AND w.w_city = 'Fairview' AND NOT EXISTS ( SELECT 1 FROM time_dim t WHERE t.t_time_sk = wp.wp_access_date_sk AND t.t_sub_shift = 'night' ) GROUP BY d.d_year, d.d_quarter_name, d.d_moy, d.d_holiday, w.w_city, w.w_gmt_offset ORDER BY d.d_year, d.d_quarter_name, d.d_moy, total_links DESC;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_net_paid) AS total_sales_amount, AVG(cs.cs_sales_price) AS average_sales_amount_per_order, MAX(cs.cs_sales_price) AS max_sale_amount, AVG(cs.cs_ext_discount_amt) AS average_discount_amount, SUM(cs.cs_ext_tax) AS total_tax_collected, COUNT(DISTINCT cs.cs_bill_customer_sk) AS unique_customers FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk WHERE d.d_date BETWEEN '2023-01-01'::DATE AND '2023-12-31'::DATE AND cs.cs_list_price > 100 GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_sales_amount DESC, average_sales_amount_per_order DESC;
SELECT dd.d_year, dd.d_quarter_name, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(cc.cc_employees) AS average_employees, SUM(CASE WHEN ws.web_country = 'United States' THEN 1 ELSE 0 END) AS total_us_websites FROM date_dim dd JOIN inventory inv ON dd.d_date_sk = inv.inv_date_sk JOIN customer c ON dd.d_date_sk = c.c_first_sales_date_sk JOIN call_center cc ON dd.d_date_sk = cc.cc_open_date_sk JOIN web_site ws ON dd.d_date_sk = ws.web_open_date_sk WHERE dd.d_year = 2022 AND inv.inv_warehouse_sk = 1 AND ws.web_county = 'Williamson County' AND ws.web_street_name IN ('Hickory 3rd', 'Broadway South', 'Cedar North', 'Railroad', 'Lake') AND dd.d_last_dom IN ('2419096', '2418790', '2417026', '2416844', '2419340', '2415871') AND dd.d_week_seq IN ('499', '115') AND c.c_salutation IN ('Mr.', 'Ms.', 'Mrs.') AND c.c_birth_day = 5 GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT cp.cp_department, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_quantity) AS total_return_quantity, COUNT(DISTINCT cr.cr_returned_date_sk) AS num_return_dates, SUM(ss.ss_net_paid) AS total_store_sales, SUM(ss.ss_quantity) AS total_store_quantity_sold, AVG(ws.ws_net_profit) AS avg_web_net_profit, SUM(ws.ws_quantity) AS total_web_quantity_sold FROM catalog_page cp JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk JOIN store_sales ss ON ss.ss_customer_sk = cr.cr_refunded_customer_sk JOIN web_sales ws ON ws.ws_bill_customer_sk = cr.cr_refunded_customer_sk WHERE cp.cp_end_date_sk BETWEEN 2450964 AND 2451694 AND cr.cr_return_amt_inc_tax BETWEEN 500 AND 1500 AND ss.ss_net_paid BETWEEN 500 AND 2100 AND ws.ws_ext_ship_cost BETWEEN 50 AND 1000 GROUP BY cp.cp_department ORDER BY total_return_quantity DESC, avg_return_amount DESC;
SELECT i.i_category, AVG(ss.ss_quantity) AS avg_quantity_sold, AVG(ss.ss_sales_price) AS avg_sales_price, AVG(ss.ss_ext_discount_amt) AS avg_discount_amount, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_tickets, COUNT(DISTINCT hd.hd_demo_sk) AS total_high_income_household FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE ib.ib_lower_bound > ( SELECT AVG(ib_inner.ib_lower_bound) FROM income_band ib_inner ) AND ss.ss_net_paid > 2000 AND hd.hd_vehicle_count BETWEEN 2 AND 4 GROUP BY ROLLUP(i.i_category) ORDER BY i.i_category, avg_sales_price DESC;
SELECT ws.web_name, ws.web_market_manager, ws.web_class, ws.web_city, COUNT(DISTINCT wp.wp_web_page_sk) AS total_pages, SUM(wp.wp_image_count) AS total_images, SUM(wp.wp_link_count) AS total_links, AVG(wp.wp_char_count) AS avg_char_count, SUM(sr.sr_return_quantity) AS total_returned_quantity, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, COUNT(DISTINCT sr.sr_customer_sk) AS distinct_returning_customers, dd.d_year, dd.d_quarter_name, SUM(CASE WHEN dd.d_holiday = 'Y' THEN 1 ELSE 0 END) AS holiday_count, SUM(CASE WHEN dd.d_weekend = 'Y' THEN 1 ELSE 0 END) AS weekend_count FROM web_site ws JOIN web_page wp ON ws.web_site_sk = wp.wp_web_page_sk JOIN date_dim dd ON wp.wp_access_date_sk = dd.d_date_sk LEFT JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk WHERE dd.d_year IN (2020, 2021) AND ws.web_market_manager IN ('Gilbert Chapman', 'Jeffrey Campbell', 'Keith Frazier') AND ws.web_close_date_sk IS NULL GROUP BY ws.web_name, ws.web_market_manager, ws.web_class, ws.web_city, dd.d_year, dd.d_quarter_name ORDER BY ws.web_market_manager, ws.web_name, dd.d_year, dd.d_quarter_name;
