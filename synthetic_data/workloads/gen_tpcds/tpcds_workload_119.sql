SELECT web.web_name AS website_name, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, t.t_shift AS sales_shift, s.s_store_name AS store_name, s.s_number_employees AS number_of_employees, s.s_city AS store_city, SUM(s.s_tax_precentage) AS total_tax_percentage_collected FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk JOIN time_dim t ON ws.ws_sold_time_sk = t.t_time_sk JOIN store s ON web.web_mkt_id = s.s_market_id WHERE web.web_mkt_id IN ('1', '4', '3') AND t.t_shift = 'third' AND s.s_gmt_offset = '-5.00' AND s.s_number_employees IN ('297', '278', '229', '245') GROUP BY web.web_name, t.t_shift, s.s_store_name, s.s_number_employees, s.s_city ORDER BY total_net_profit DESC;
SELECT cd.cd_education_status, COUNT(*) AS total_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(cs.cs_quantity) AS total_items_sold, SUM(cs.cs_net_paid) AS total_revenue, SUM(sr.sr_return_quantity) AS total_items_returned, SUM(sr.sr_net_loss) AS total_loss FROM customer_demographics cd LEFT JOIN catalog_sales cs ON cd.cd_demo_sk = cs.cs_bill_cdemo_sk LEFT JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk WHERE cd.cd_credit_rating IN ('High Risk', 'Low Risk', 'Good') AND cs.cs_order_number IN (136032, 15467, 59785, 76201, 136250, 105478) AND sr.sr_item_sk IN (13089, 10527, 1538, 10362, 3961) AND sr.sr_hdemo_sk IN (1928, 4567, 1918, 2937) GROUP BY cd.cd_education_status ORDER BY total_revenue DESC;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, COUNT(DISTINCT ss.ss_customer_sk) AS store_customer_count, SUM(ss.ss_quantity) AS store_quantity_sum, AVG(ss.ss_sales_price) AS store_average_sales_price, SUM(cs.cs_quantity) AS catalog_quantity_sum, AVG(cs.cs_sales_price) AS catalog_average_sales_price, SUM(ws.ws_quantity) AS web_quantity_sum, AVG(ws.ws_sales_price) AS web_average_sales_price, SUM(sr.sr_return_quantity) AS store_return_quantity_sum, SUM(wr.wr_return_quantity) AS web_return_quantity_sum, ib.ib_lower_bound, ib.ib_upper_bound FROM customer_demographics cd JOIN store_sales ss ON cd.cd_demo_sk = ss.ss_cdemo_sk JOIN catalog_sales cs ON cd.cd_demo_sk = cs.cs_bill_cdemo_sk JOIN web_sales ws ON cd.cd_demo_sk = ws.ws_bill_cdemo_sk JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk JOIN web_returns wr ON cd.cd_demo_sk = wr.wr_refunded_cdemo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating;
SELECT ca.ca_state AS state, CASE WHEN cc.cc_call_center_sk IS NOT NULL THEN 'Call Center' WHEN ws.web_site_sk IS NOT NULL THEN 'Web Site' WHEN st.s_store_sk IS NOT NULL THEN 'Store' ELSE 'Unknown' END AS return_channel, COUNT(*) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, AVG(cr.cr_return_tax) AS avg_return_tax, AVG(cr.cr_return_ship_cost) AS avg_return_ship_cost FROM catalog_returns cr LEFT JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk LEFT JOIN web_site ws ON cr.cr_call_center_sk = ws.web_site_sk LEFT JOIN store st ON cr.cr_call_center_sk = st.s_store_sk LEFT JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk GROUP BY ca.ca_state, CASE WHEN cc.cc_call_center_sk IS NOT NULL THEN 'Call Center' WHEN ws.web_site_sk IS NOT NULL THEN 'Web Site' WHEN st.s_store_sk IS NOT NULL THEN 'Store' ELSE 'Unknown' END ORDER BY state, return_channel;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, cd.cd_education_status, sum(cs.cs_quantity) as total_quantity_sold, avg(cs.cs_sales_price) as average_sales_price, count(distinct cs.cs_order_number) as number_of_orders, sum(cs.cs_net_profit) as total_net_profit FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE cd.cd_education_status IN ('College', 'Advanced Degree', '4 yr Degree') AND i.i_manager_id IN (69, 90) AND (cs.cs_sold_date_sk BETWEEN 2004001 AND 2004003 OR cs.cs_sold_date_sk BETWEEN 2004025 AND 2004028) AND (w.w_state = 'TN' OR w.w_country = 'United States') AND p.p_channel_email = 'Y' AND cs.cs_quantity >= 5 AND cs.cs_net_profit > 0 GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, cd.cd_education_status HAVING count(distinct cs.cs_order_number) > 1 ORDER BY total_net_profit DESC, number_of_orders DESC, cd.cd_education_status, c.c_last_name, c.c_first_name;
SELECT c.c_customer_id, c.c_email_address, hd.hd_buy_potential, SUM(wr.wr_return_quantity) AS total_return_quantity, AVG(wr.wr_return_amt) AS avg_return_amount, COUNT(DISTINCT wr.wr_order_number) AS num_orders, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_return_ship_cost) AS total_shipping_cost, SUM(wr.wr_refunded_cash) AS total_refunded_cash, SUM(wr.wr_reversed_charge) AS total_reversed_charges, SUM(wr.wr_account_credit) AS total_account_credits, SUM(wr.wr_net_loss) AS total_net_loss FROM customer c JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk GROUP BY c.c_customer_id, c.c_email_address, hd.hd_buy_potential ORDER BY total_return_amount_inc_tax DESC LIMIT 100;
SELECT cs.cs_bill_customer_sk AS customer_sk, SUM(cs.cs_net_paid) AS total_sales, SUM(cr.cr_refunded_cash) AS total_catalog_refunds, SUM(wr.wr_refunded_cash) AS total_web_refunds, SUM(cr.cr_net_loss) AS total_catalog_net_loss, SUM(wr.wr_net_loss) AS total_web_net_loss, (SUM(cs.cs_net_paid) - SUM(cr.cr_refunded_cash) - SUM(wr.wr_refunded_cash)) AS net_amount_paid_after_refunds FROM catalog_sales cs LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number AND cs.cs_item_sk = cr.cr_item_sk LEFT JOIN web_returns wr ON cs.cs_order_number = wr.wr_order_number AND cs.cs_item_sk = wr.wr_item_sk GROUP BY cs.cs_bill_customer_sk HAVING cs.cs_bill_customer_sk IS NOT NULL ORDER BY net_amount_paid_after_refunds DESC;
SELECT dd.d_year, dd.d_quarter_name, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, COUNT(DISTINCT cc.cc_call_center_sk) AS participating_call_centers, SUM(ss.ss_net_paid_inc_tax) AS total_revenue_including_tax, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN call_center cc ON cc.cc_mkt_id::integer = ss.ss_store_sk JOIN catalog_page cp ON ss.ss_sold_date_sk BETWEEN cp.cp_start_date_sk AND cp.cp_end_date_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk WHERE dd.d_year = 2001 AND cc.cc_class = 'small' AND cd.cd_credit_rating = 'Good' AND (cp.cp_type = 'monthly' OR cp.cp_type = 'bi-annual') AND (cc.cc_street_type = 'Way' OR cc.cc_street_type = 'RD' OR cc.cc_street_type = 'Boulevard') AND c.c_last_review_date_sk IN ('2452332', '2452464', '2452647', '2452396', '2452311') AND cd.cd_demo_sk IN ('20368', '16978', '19750', '17504') GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT hd.hd_demo_sk) AS household_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, SUM(CASE WHEN cp.cp_department = 'DEPARTMENT' THEN 1 ELSE 0 END) AS department_page_count, sm.sm_carrier, COUNT(DISTINCT sm.sm_ship_mode_sk) AS ship_mode_count FROM household_demographics hd JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk LEFT JOIN catalog_page cp ON cp.cp_catalog_number = hd.hd_income_band_sk AND cp.cp_catalog_page_number IN (100, 52, 68) LEFT JOIN ship_mode sm ON sm.sm_ship_mode_sk = hd.hd_vehicle_count AND sm.sm_carrier IN ('ORIENTAL', 'GREAT EASTERN', 'USPS') WHERE hd.hd_income_band_sk IN (7, 19, 4) AND hd.hd_dep_count IN (0, 4, 1) AND hd.hd_demo_sk IN (390, 179, 2543) AND ib.ib_upper_bound IN (130000, 160000, 20000) AND ib.ib_lower_bound IN (130001, 10001, 140001) AND sm.sm_contract IN ('qENFQ', 'I3uCelXtjP', 'GNJr3g5i7oorKqtX') GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_carrier ORDER BY ib.ib_upper_bound DESC, household_count DESC;
SELECT ib.ib_lower_bound, ib.ib_upper_bound, hd.hd_dep_count, COUNT(DISTINCT cs.cs_order_number) AS total_sales_orders, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_quantity) AS total_quantity_sold, COUNT(DISTINCT wr.wr_order_number) AS total_return_orders, AVG(wr.wr_return_amt) AS avg_return_amount, SUM(wr.wr_return_quantity) AS total_quantity_returned FROM catalog_sales cs JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number GROUP BY ib.ib_lower_bound, ib.ib_upper_bound, hd.hd_dep_count ORDER BY ib.ib_lower_bound, ib.ib_upper_bound, hd.hd_dep_count;
SELECT s_store_name AS store_name, s_state AS store_state, CONCAT(s_city, ', ', s_state) AS store_location, d_year AS sales_year, d_quarter_name AS sales_quarter, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_sales, AVG(ss_net_paid) AS average_sales_per_transaction, SUM(ss_net_paid_inc_tax) AS total_sales_including_tax, SUM(ss_ext_tax) AS total_tax_collected, COUNT(DISTINCT ss_customer_sk) AS unique_customers, COUNT(DISTINCT ss_ticket_number) AS total_transactions, SUM(wr_return_amt) AS total_returns, SUM(wr_fee) AS total_return_fees, AVG(wr_return_ship_cost) AS average_return_shipping_cost, COUNT(DISTINCT wr_refunded_customer_sk) AS unique_customers_returned, COUNT(DISTINCT wr_order_number) AS total_return_transactions, SUM(wr_net_loss) AS total_net_loss_from_returns, r_reason_desc AS most_common_return_reason FROM store_sales JOIN store ON ss_store_sk = s_store_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk LEFT JOIN web_returns ON ss_item_sk = wr_item_sk AND ss_ticket_number = wr_order_number LEFT JOIN reason ON wr_reason_sk = r_reason_sk WHERE s_state IN ('NY', 'CA') AND d_year = 2023 GROUP BY s_store_name, s_state, s_city, d_year, d_quarter_name, r_reason_desc ORDER BY total_sales DESC, total_quantity_sold DESC LIMIT 10;
SELECT p.p_promo_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_net_paid) AS avg_net_paid, SUM(cs.cs_net_paid_inc_tax) AS sum_net_paid_inc_tax, SUM(ws.ws_net_profit) AS sum_web_net_profit, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_fee) AS avg_return_fee FROM catalog_sales cs JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN web_sales ws ON cs.cs_order_number = ws.ws_order_number AND cs.cs_item_sk = ws.ws_item_sk LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk WHERE cd.cd_credit_rating IN ('Good', 'Unknown') AND p.p_discount_active = 'N' AND cs.cs_net_paid_inc_tax NOT IN ('5209.58', '3100.79') AND NOT EXISTS ( SELECT 1 FROM reason r WHERE r.r_reason_sk = wr.wr_reason_sk AND r.r_reason_desc LIKE 'Wrong size' ) GROUP BY p.p_promo_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY sum_net_paid_inc_tax DESC, total_orders DESC;
SELECT i.i_class, t.t_am_pm, COUNT(DISTINCT ss.ss_ticket_number) AS total_store_sales_transactions, SUM(ss.ss_net_paid) AS total_store_sales_revenue, AVG(ss.ss_net_paid) AS avg_store_sales_revenue, COUNT(DISTINCT ws.ws_order_number) AS total_web_sales_transactions, SUM(ws.ws_net_paid_inc_tax) AS total_web_sales_revenue, AVG(ws.ws_net_paid_inc_tax) AS avg_web_sales_revenue, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_returns_transactions, SUM(cr.cr_return_amount) AS total_catalog_returns_cost, AVG(cr.cr_return_amount) AS avg_catalog_returns_cost FROM item i LEFT JOIN store_sales ss ON i.i_item_sk = ss.ss_item_sk LEFT JOIN web_sales ws ON i.i_item_sk = ws.ws_item_sk LEFT JOIN catalog_returns cr ON i.i_item_sk = cr.cr_item_sk LEFT JOIN time_dim t ON (ss.ss_sold_time_sk = t.t_time_sk OR ws.ws_sold_time_sk = t.t_time_sk OR cr.cr_returned_time_sk = t.t_time_sk) WHERE i.i_class IN ('karoke', 'paint', 'personal') AND t.t_am_pm = 'AM' GROUP BY i.i_class, t.t_am_pm ORDER BY i.i_class, t.t_am_pm;
SELECT ws_web.web_site_sk, ws_web.web_name, ws_web.web_state, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_net_paid_inc_tax) AS average_net_paid_inc_tax, COUNT(DISTINCT ws_c.c_customer_sk) AS unique_customers, COUNT(DISTINCT ws_p.p_promo_sk) AS promotion_count, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_ext_sales_price) AS total_sales, SUM(ws.ws_ext_wholesale_cost) AS total_wholesale_cost, SUM(ws.ws_ext_discount_amt) AS total_discount_amount FROM web_sales ws INNER JOIN web_site ws_web ON ws.ws_web_site_sk = ws_web.web_site_sk LEFT JOIN customer ws_c ON ws.ws_bill_customer_sk = ws_c.c_customer_sk LEFT JOIN promotion ws_p ON ws.ws_promo_sk = ws_p.p_promo_sk WHERE ws_web.web_state = 'TN' AND ws_p.p_cost > 1000.00 GROUP BY ws_web.web_site_sk, ws_web.web_name, ws_web.web_state ORDER BY total_net_profit DESC;
SELECT ca_state, sm_type, EXTRACT(YEAR FROM d_date) AS year, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk JOIN customer_address ON cs_ship_addr_sk = ca_address_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk WHERE ca_country = 'United States' AND sm_type IN ('TWO DAY', 'EXPRESS', 'OVERNIGHT') AND d_year = EXTRACT(YEAR FROM CURRENT_DATE) GROUP BY ca_state, sm_type, year ORDER BY total_net_profit DESC, ca_state, sm_type;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_items, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_returning_customers, SUM(case when hd.hd_dep_count IS NOT NULL THEN 1 ELSE 0 END) AS returns_with_dep_count, SUM(case when hd.hd_vehicle_count IS NOT NULL THEN 1 ELSE 0 END) AS returns_with_vehicle_count, COUNT(DISTINCT p.p_promo_sk) AS total_promotions_involved, SUM(p.p_cost) AS total_promotion_cost FROM call_center cc LEFT JOIN catalog_returns cr ON cc.cc_call_center_sk = cr.cr_call_center_sk LEFT JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk LEFT JOIN promotion p ON p.p_item_sk = cr.cr_item_sk WHERE cc.cc_company_name IN ('able', 'ought', 'cally', 'pri') AND cc.cc_hours IN ('8AM-4PM', '8AM-8AM') AND p.p_channel_tv = 'N' AND p.p_purpose = 'Unknown' AND cr.cr_refunded_cash IN ('5415.08', '1.89', '288.51', '2.49', '307.01') GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_return_amount DESC;
SELECT d_year AS "Year", p_promo_name AS "Promotion Name", COUNT(cr_order_number) AS "Total Returns", SUM(cr_return_quantity) AS "Total Returned Quantity", SUM(cr_return_amount) AS "Total Returned Amount", AVG(cr_return_amount) AS "Average Return Amount", SUM(cr_net_loss) AS "Total Net Loss" FROM catalog_returns cr JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk JOIN promotion p ON d.d_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk WHERE p.p_end_date_sk IN ('2450731', '2450673', '2450658', '2450718') GROUP BY "Year", "Promotion Name" ORDER BY "Year", "Total Returned Amount" DESC;
SELECT d_year, sm_type, r_reason_desc, COUNT(*) AS total_returns, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS average_return_amount, SUM(cr_return_quantity) AS total_return_quantity, AVG(cr_return_quantity) AS average_return_quantity FROM catalog_returns JOIN date_dim ON cr_returned_date_sk = d_date_sk JOIN reason ON cr_reason_sk = r_reason_sk JOIN ship_mode ON cr_ship_mode_sk = sm_ship_mode_sk WHERE d_year IN (2020, 2021) AND cr_refunded_hdemo_sk IN ('6319', '1691', '6783', '2583', '2054', '1550') AND cr_refunded_customer_sk IN ('44015', '70912', '7271') GROUP BY d_year, sm_type, r_reason_desc ORDER BY d_year, total_return_amount DESC, total_returns DESC;
SELECT s.s_state AS store_state, COUNT(DISTINCT s.s_store_sk) AS store_count, SUM(s.s_number_employees) AS total_employees, AVG(s.s_floor_space) AS avg_floor_space, ROUND(AVG(s.s_tax_precentage), 2) AS avg_store_tax_percentage, w.web_market_manager, COUNT(DISTINCT w.web_site_sk) AS website_count, ROUND(AVG(w.web_tax_percentage), 2) AS avg_website_tax_percentage, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound FROM store s JOIN web_site w ON s.s_market_id = w.web_mkt_id JOIN income_band ib ON ib.ib_lower_bound <= s.s_number_employees AND ib.ib_upper_bound >= s.s_number_employees WHERE s.s_state IN ('CA', 'TX', 'NY') AND w.web_market_manager IN ('Jarvis Allen', 'James Harris', 'Albert Leung', 'Philip Sampson') AND ib.ib_income_band_sk IN ('20', '5', '3', '2') GROUP BY s.s_state, w.web_market_manager, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY s.s_state, w.web_market_manager, ib.ib_income_band_sk;
SELECT ca_state, ca_city, COUNT(DISTINCT c_customer_sk) AS number_of_customers, SUM(ss_net_paid) AS total_sales_amount, AVG(ss_quantity) AS average_quantity_sold, SUM(ss_net_profit) AS total_profit, MAX(ib_upper_bound) AS max_income_band_upper_bound, AVG(wr_return_amt) AS average_return_amount FROM customer_address JOIN customer ON c_current_addr_sk = ca_address_sk JOIN store_sales ON ss_customer_sk = c_customer_sk JOIN income_band ON ib_income_band_sk = (SELECT hd_income_band_sk FROM household_demographics WHERE hd_demo_sk = c_current_hdemo_sk) LEFT OUTER JOIN web_returns ON wr_order_number = ss_ticket_number AND wr_item_sk = ss_item_sk WHERE ca_street_type IN ('Dr.', 'Blvd', 'Ln', 'Cir.', 'Boulevard', 'Wy') AND ss_net_paid > 1000 AND ss_quantity < 50 GROUP BY ca_state, ca_city ORDER BY total_sales_amount DESC, average_quantity_sold DESC LIMIT 10;
SELECT ca.ca_state AS customer_state, i.i_category AS item_category, SUM(cs.cs_sales_price) AS total_sales, AVG(cs.cs_quantity) AS average_quantity_sold, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk WHERE i.i_container <> 'Unknown' AND cs.cs_sold_date_sk IS NOT NULL AND ca.ca_country = 'United States' GROUP BY customer_state, item_category HAVING SUM(cs.cs_sales_price) > 10000 ORDER BY total_sales DESC, customer_state, item_category;
SELECT s.s_store_name, ca.ca_city, cd.cd_marital_status, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(cr.cr_return_quantity) AS total_quantity_returned, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_fee) AS total_return_fees, SUM(cr.cr_store_credit) AS total_store_credit_issued FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk LEFT JOIN catalog_returns cr ON ss.ss_item_sk = cr.cr_item_sk AND ss.ss_ticket_number = cr.cr_order_number WHERE s.s_company_id = '1' AND s.s_number_employees IN ('271', '297', '218') AND cr.cr_fee IN ('1.88', '20.33', '98.78') AND cr.cr_store_credit IN ('209.99', '238.11', '154.49') AND cr.cr_returning_addr_sk IN ('12346', '30572', '1273') AND ca.ca_street_number IN ('667', '111', '746') AND ca.ca_street_type IN ('Street', 'Dr.', 'Way') AND ca.ca_street_name IN ('Maple 5th', 'Walnut Lee', 'Ash Oak') AND ca.ca_city IN ('Fairview', 'Calhoun', 'Sullivan') AND cd.cd_purchase_estimate IN ('8500', '5000', '6500') AND cd.cd_marital_status IN ('U', 'M', 'D') AND ss.ss_hdemo_sk IN ('2140', '4187', '6514') AND ss.ss_ticket_number IN ('3439', '3527', '3698') GROUP BY s.s_store_name, ca.ca_city, cd.cd_marital_status ORDER BY total_quantity_sold DESC, average_sales_price DESC, unique_customers DESC, total_quantity_returned DESC, average_return_amount DESC, total_return_fees DESC, total_store_credit_issued DESC;
