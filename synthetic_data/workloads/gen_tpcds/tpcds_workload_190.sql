SELECT c.cd_gender, c.cd_marital_status, c.cd_education_status, c.cd_credit_rating, AVG(c.cd_purchase_estimate) AS avg_purchase_estimate, SUM(c.cd_dep_count) AS total_dep_count, SUM(c.cd_dep_employed_count) AS total_dep_employed_count, SUM(c.cd_dep_college_count) AS total_dep_college_count, w.w_state, w.w_country, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_size, web.web_class, web.web_market_manager, COUNT(DISTINCT web.web_site_sk) AS num_websites, AVG(web.web_tax_percentage) AS avg_web_tax_percentage FROM customer_demographics c JOIN warehouse w ON c.cd_demo_sk = w.w_warehouse_sk JOIN web_site web ON w.w_state = web.web_state GROUP BY c.cd_gender, c.cd_marital_status, c.cd_education_status, c.cd_credit_rating, w.w_state, w.w_country, web.web_class, web.web_market_manager ORDER BY w.w_country, w.w_state, c.cd_education_status, c.cd_credit_rating;
SELECT s_state, EXTRACT(YEAR FROM s_rec_start_date) AS year_opened, COUNT(*) AS store_count, SUM(ss_net_profit) AS total_net_profit, AVG(hd_dep_count) AS avg_dependency_count, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_amt) AS avg_return_amount, SUM(sr_net_loss) AS total_net_loss FROM store JOIN store_sales ON s_store_sk = ss_store_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN store_returns ON s_store_sk = sr_store_sk WHERE s_state IN ('CA', 'TX', 'FL') AND s_closed_date_sk IS NULL AND ss_sold_date_sk BETWEEN 2451189 AND 2451489 AND sr_return_tax > 0 AND hd_buy_potential IN ('>10000', '5001-10000', '1001-5000') GROUP BY s_state, year_opened ORDER BY total_net_profit DESC, total_return_amount DESC;
SELECT cp.cp_department, ws_site.web_name, COUNT(DISTINCT cs.cs_order_number) AS total_catalog_orders, SUM(cs.cs_net_paid) AS total_catalog_sales, AVG(cs.cs_net_paid) AS avg_catalog_sales, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_net_paid) AS total_web_sales, AVG(ws.ws_net_paid) AS avg_web_sales, SUM(hd.hd_dep_count) AS total_dep_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, COUNT(DISTINCT c.c_customer_sk) AS unique_customers FROM catalog_page cp JOIN catalog_sales cs ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN web_sales ws ON ws.ws_bill_customer_sk = cs.cs_bill_customer_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk LEFT JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN web_site ws_site ON ws.ws_web_site_sk = ws_site.web_site_sk WHERE cp.cp_end_date_sk = 2450905 AND cs.cs_net_paid BETWEEN 212.28 AND 1048.16 GROUP BY cp.cp_department, ws_site.web_name ORDER BY total_catalog_sales DESC, total_web_sales DESC LIMIT 100;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk WHERE cc.cc_market_manager IN ('Julius Durham', 'Matthew Clifton', 'Gary Colburn', 'Julius Tran') GROUP BY ROLLUP(cc.cc_name, cc.cc_city, cc.cc_state, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status) ORDER BY cc.cc_name, cc.cc_city, cc.cc_state, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_state, ca.ca_city, COUNT(DISTINCT sr.sr_customer_sk) AS number_of_returning_customers, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(sr.sr_fee) AS total_fees_collected, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr INNER JOIN date_dim dd ON sr.sr_returned_date_sk = dd.d_date_sk INNER JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk INNER JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk WHERE dd.d_year = 2022 AND hd.hd_buy_potential = '>10000' AND dd.d_quarter_seq = 52 GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state, ca.ca_city ORDER BY total_net_loss DESC, avg_return_amount_inc_tax DESC LIMIT 10;
SELECT s.s_store_name, s.s_floor_space, s.s_number_employees, s.s_city, s.s_state, dd.d_year, dd.d_quarter_name, SUM(i.inv_quantity_on_hand) AS total_inventory, AVG(i.inv_quantity_on_hand) AS average_inventory, COUNT(DISTINCT i.inv_item_sk) AS unique_items_count, COUNT(DISTINCT i.inv_warehouse_sk) AS unique_warehouses_count FROM inventory i JOIN store s ON i.inv_warehouse_sk = s.s_store_sk JOIN date_dim dd ON i.inv_date_sk = dd.d_date_sk WHERE dd.d_current_month = 'N' AND s.s_store_name LIKE ANY (ARRAY['%eing%', '%ought%', '%bar%', '%ation%', '%anti%', '%able%']) GROUP BY s.s_store_name, s.s_floor_space, s.s_number_employees, s.s_city, s.s_state, dd.d_year, dd.d_quarter_name ORDER BY s.s_state, s.s_city, dd.d_year, dd.d_quarter_name;
SELECT p.p_promo_id, p.p_promo_name, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(DISTINCT ws.ws_item_sk) AS number_of_items_sold, SUM(cr.cr_return_amount) AS total_returns, COUNT(DISTINCT cr.cr_item_sk) AS number_of_items_returned FROM web_sales ws JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk LEFT JOIN catalog_returns cr ON ws.ws_item_sk = cr.cr_item_sk AND ws.ws_order_number = cr.cr_order_number JOIN item i ON ws.ws_item_sk = i.i_item_sk WHERE i.i_class_id = 4 AND c.c_birth_country IN ('GABON', 'ALBANIA', 'RUSSIAN FEDERATION', 'CHINA', 'BELGIUM', 'PORTUGAL') GROUP BY p.p_promo_id, p.p_promo_name ORDER BY total_net_profit DESC;
SELECT web.web_name, web.web_class, web.web_manager, web.web_mkt_class, time_dim.t_hour, time_dim.t_shift, COUNT(cs.cs_order_number) as total_orders, SUM(cs.cs_quantity) as total_quantity, AVG(cs.cs_sales_price) as average_sales_price, SUM(cs.cs_ext_sales_price) as total_extended_sales_price, SUM(cs.cs_ext_discount_amt) as total_discount_amount, SUM(cs.cs_net_paid) as total_net_paid, SUM(cs.cs_net_profit) as total_net_profit FROM catalog_sales cs JOIN time_dim ON cs.cs_sold_time_sk = time_dim.t_time_sk JOIN web_site web ON cs.cs_call_center_sk = web.web_site_sk WHERE cs.cs_item_sk IN (46, 5) AND cs.cs_ext_sales_price IN (240.00, 708.63) AND web.web_site_id IN ('AAAAAAAAHAAAAAAA', 'AAAAAAAAOAAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAAEAAAAAAA', 'AAAAAAAADBAAAAAA') AND web.web_class <> 'Unknown' GROUP BY web.web_name, web.web_class, web.web_manager, web.web_mkt_class, time_dim.t_hour, time_dim.t_shift ORDER BY web.web_name, time_dim.t_hour, time_dim.t_shift;
