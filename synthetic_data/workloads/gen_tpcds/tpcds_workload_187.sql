SELECT CAST(SUBSTRING(CAST(cr.cr_returned_date_sk AS VARCHAR), 1, 4) AS INTEGER) AS return_year, CAST(SUBSTRING(CAST(cr.cr_returned_date_sk AS VARCHAR), 5, 2) AS INTEGER) AS return_month, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_customers, COUNT(*) AS total_returns, SUM(p.p_cost) AS promotion_cost, s.s_store_name, s.s_city FROM catalog_returns cr JOIN promotion p ON cr.cr_item_sk = p.p_item_sk JOIN store s ON s.s_store_sk = cr.cr_returning_addr_sk WHERE CAST(SUBSTRING(CAST(cr.cr_returned_date_sk AS VARCHAR), 1, 4) AS INTEGER) = 2023 AND s.s_number_employees BETWEEN 200 AND 300 AND s.s_store_id IN ('AAAAAAAABAAAAAAA', 'AAAAAAAAHAAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAAKAAAAAAA', 'AAAAAAAAEAAAAAAA') AND cr.cr_refunded_addr_sk = 30891 AND p.p_channel_press = 'N' GROUP BY return_year, return_month, s.s_store_name, s.s_city ORDER BY total_return_amount DESC, s.s_store_name, s.s_city;
SELECT s.s_state, cd.cd_gender, COUNT(DISTINCT s.s_store_sk) AS total_stores, AVG(s.s_floor_space) AS avg_floor_space, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_ext_discount_amt) AS avg_discount_amount FROM store_sales ss JOIN customer_demographics cd ON cd.cd_demo_sk = ss.ss_cdemo_sk JOIN store s ON s.s_store_sk = ss.ss_store_sk WHERE ss.ss_ext_sales_price > 0 AND cd.cd_gender IN ('M', 'F') AND s.s_state IS NOT NULL GROUP BY s.s_state, cd.cd_gender ORDER BY s.s_state, cd.cd_gender, total_sales DESC;
SELECT dd.d_year, dd.d_quarter_name, cc.cc_name, cc.cc_city, SUM(cr.cr_net_loss) AS total_catalog_net_loss, AVG(cr.cr_return_amount) AS avg_catalog_return_amount, COUNT(DISTINCT cr.cr_order_number) AS count_catalog_orders, SUM(wr.wr_net_loss) AS total_web_net_loss, AVG(wr.wr_return_amt) AS avg_web_return_amount, COUNT(DISTINCT wr.wr_order_number) AS count_web_orders, SUM(inv.inv_quantity_on_hand) AS total_inventory FROM date_dim dd JOIN catalog_returns cr ON dd.d_date_sk = cr.cr_returned_date_sk JOIN web_returns wr ON dd.d_date_sk = wr.wr_returned_date_sk JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk AND wr.wr_returned_date_sk = cc.cc_open_date_sk JOIN inventory inv ON inv.inv_date_sk = dd.d_date_sk WHERE dd.d_year = 1999 AND cc.cc_zip = '31904' AND inv.inv_warehouse_sk IN ('1', '2') GROUP BY dd.d_year, dd.d_quarter_name, cc.cc_name, cc.cc_city ORDER BY dd.d_year, dd.d_quarter_name, cc.cc_name, cc.cc_city;
SELECT st.s_store_name AS store_name, SUM(sales.ss_net_paid) AS total_sales, AVG(sales.ss_quantity) AS average_quantity_sold, COUNT(DISTINCT customer.c_customer_sk) AS unique_customers, cd.cd_education_status AS education_status, cd.cd_gender AS gender, COUNT(promo.p_promo_sk) AS promotion_count, AVG(promo.p_cost) AS average_promotion_cost FROM store_sales sales JOIN store st ON sales.ss_store_sk = st.s_store_sk JOIN customer ON sales.ss_customer_sk = customer.c_customer_sk JOIN customer_demographics cd ON customer.c_current_cdemo_sk = cd.cd_demo_sk JOIN promotion promo ON sales.ss_promo_sk = promo.p_promo_sk WHERE st.s_hours IN ('8AM-12AM', '8AM-4PM') AND cd.cd_education_status IN ('Unknown', 'Advanced Degree', '2 yr Degree', 'College') AND cd.cd_gender IN ('M', 'F') AND sales.ss_sold_date_sk BETWEEN promo.p_start_date_sk AND promo.p_end_date_sk GROUP BY st.s_store_name, cd.cd_education_status, cd.cd_gender ORDER BY total_sales DESC, average_quantity_sold DESC;
SELECT ca.ca_state AS state, i.d_year AS fiscal_year, COUNT(DISTINCT ss.ss_store_sk) AS num_stores, COUNT(DISTINCT ss.ss_item_sk) AS num_products_sold, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_sales, COUNT(DISTINCT sr.sr_store_sk) AS num_stores_with_returns, COUNT(DISTINCT sr.sr_item_sk) AS num_returned_products, SUM(sr.sr_return_quantity) AS total_quantity_returned, SUM(sr.sr_return_amt) AS total_returns, COUNT(DISTINCT cr.cr_call_center_sk) AS num_call_centers_with_returns, COUNT(DISTINCT cr.cr_item_sk) AS num_catalog_returned_products, SUM(cr.cr_return_quantity) AS total_catalog_quantity_returned, SUM(cr.cr_return_amount) AS total_catalog_returns FROM store_sales ss JOIN date_dim i ON ss.ss_sold_date_sk = i.d_date_sk JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number LEFT JOIN catalog_returns cr ON cr.cr_order_number = ss.ss_ticket_number WHERE i.d_fy_year = 2001 GROUP BY ca.ca_state, i.d_year ORDER BY ca.ca_state, i.d_year;
SELECT c.c_first_name, c.c_last_name, ca.ca_state, ca.ca_county, SUM(cs.cs_sales_price) AS total_sales, AVG(cs.cs_sales_price) AS avg_sales_price, COUNT(cs.cs_order_number) AS number_of_orders, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cr.cr_order_number) AS number_of_returns FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number AND cs.cs_item_sk = cr.cr_item_sk JOIN store s ON ca.ca_county = s.s_county AND ca.ca_state = s.s_state JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk WHERE c.c_birth_year IN ('1972', '1975', '1960') AND ca.ca_state = 'TN' AND s.s_county = 'Williamson County' AND cp.cp_description LIKE '%nuclear%' OR cp.cp_description LIKE '%optimistic%' AND cp.cp_end_date_sk IN ('2451239', '2450934', '2450904', '2451389') GROUP BY c.c_first_name, c.c_last_name, ca.ca_state, ca.ca_county ORDER BY total_sales DESC, total_returns DESC LIMIT 100;
SELECT t_shift AS shift_period, promotion_summary.channel, COUNT(*) AS promotion_count, SUM(promotion_summary.total_cost) AS total_promotion_cost, AVG(promotion_summary.p_response_target) AS average_response_target, SUM(web_returns_summary.return_quantity) AS total_return_quantity, SUM(web_returns_summary.return_amount) AS total_return_amount, SUM(web_returns_summary.return_amount_inc_tax) AS total_return_amount_inc_tax, AVG(web_returns_summary.fee) AS average_fee, SUM(web_returns_summary.net_loss) AS total_net_loss FROM (SELECT p_promo_sk, p_start_date_sk, p_end_date_sk, p_item_sk, CASE WHEN p_channel_dmail = 'Y' THEN 'Direct Mail' WHEN p_channel_email = 'Y' THEN 'Email' WHEN p_channel_catalog = 'Y' THEN 'Catalog' WHEN p_channel_tv = 'Y' THEN 'TV' WHEN p_channel_radio = 'Y' THEN 'Radio' WHEN p_channel_press = 'Y' THEN 'Press' WHEN p_channel_event = 'Y' THEN 'Event' WHEN p_channel_demo = 'Y' THEN 'Demo' ELSE 'Other' END AS channel, p_cost AS total_cost, p_response_target FROM promotion WHERE p_discount_active = 'Y' ) AS promotion_summary JOIN time_dim ON (promotion_summary.p_start_date_sk = time_dim.t_time_sk OR promotion_summary.p_end_date_sk = time_dim.t_time_sk) LEFT JOIN (SELECT wr_returned_date_sk, wr_returned_time_sk, wr_item_sk, SUM(wr_return_quantity) AS return_quantity, SUM(wr_return_amt) AS return_amount, SUM(wr_return_amt_inc_tax) AS return_amount_inc_tax, AVG(wr_fee) AS fee, SUM(wr_net_loss) AS net_loss FROM web_returns GROUP BY wr_returned_date_sk, wr_returned_time_sk, wr_item_sk ) AS web_returns_summary ON promotion_summary.p_item_sk = web_returns_summary.wr_item_sk GROUP BY shift_period, promotion_summary.channel ORDER BY total_promotion_cost DESC, shift_period;
SELECT cp.cp_department, sm.sm_type, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(sr_return_amt) AS total_return_amount, AVG(sr_refunded_cash) AS average_refunded_cash, SUM(cs_net_profit) - SUM(sr_net_loss) AS net_profit_after_returns FROM catalog_sales cs JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN store_returns sr ON cs.cs_item_sk = sr.sr_item_sk AND cs.cs_order_number = sr.sr_ticket_number GROUP BY cp.cp_department, sm.sm_type ORDER BY net_profit_after_returns DESC;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN household_demographics hd ON cs.cs_ship_hdemo_sk = hd.hd_demo_sk WHERE cc.cc_sq_ft IN ('4134', '795', '1138', '649') AND hd.hd_income_band_sk IN ('9', '18', '5', '14', '12') AND hd.hd_vehicle_count IN ('3', '1', '0', '4', '2') GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_net_profit DESC, total_orders DESC, cc.cc_name;
SELECT w_state, w_city, ib.ib_income_band_sk AS income_band_sk, p_promo_name, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_sq_ft, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, COUNT(DISTINCT wr.wr_returned_date_sk) AS num_return_days, AVG(wr_return_amt_inc_tax) AS avg_return_amount_inc_tax FROM warehouse w JOIN web_returns wr ON w.w_warehouse_sk = wr.wr_returning_addr_sk JOIN income_band ib ON ib.ib_income_band_sk = wr.wr_returning_hdemo_sk JOIN promotion p ON p.p_item_sk = wr.wr_item_sk WHERE w_state = 'TN' AND w_city = 'Fairview' AND wr_reason_sk IN (7, 17, 21, 6) AND ib_upper_bound IN (50000, 190000, 80000) AND wr_returning_hdemo_sk IN (4812, 3393, 981, 1249) GROUP BY w_state, w_city, ib.ib_income_band_sk, p_promo_name ORDER BY total_return_amount_inc_tax DESC LIMIT 100;
SELECT i.i_brand_id AS brand_id, i.i_brand AS brand_name, i.i_category_id AS category_id, i.i_category AS category_name, s.s_store_name AS store_name, s.s_city AS store_city, s.s_state AS store_state, to_char(t_hour, 'FM00') || ':' || to_char(t_minute, 'FM00') AS sale_time, COUNT(cs.cs_item_sk) AS total_sales_count, SUM(cs.cs_ext_sales_price) AS total_sales_amount, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_ext_discount_amt) AS total_discount_amount FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN time_dim td ON cs.cs_sold_time_sk = td.t_time_sk JOIN store s ON cs.cs_warehouse_sk = s.s_store_sk WHERE cs.cs_net_paid_inc_ship > 2000 AND cs.cs_ext_discount_amt > 0 GROUP BY i.i_brand_id, i.i_brand, i.i_category_id, i.i_category, s.s_store_name, s.s_city, s.s_state, t_hour, t_minute ORDER BY total_sales_amount DESC, brand_id, category_id, store_name, sale_time;
SELECT c.c_first_name, c.c_last_name, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_returns, SUM(cr.cr_return_amount) AS sum_catalog_returns, AVG(cr.cr_return_amount) AS avg_catalog_returns, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, SUM(sr.sr_return_amt) AS sum_store_returns, AVG(sr.sr_return_amt) AS avg_store_returns, COUNT(DISTINCT wr.wr_order_number) AS total_web_returns, SUM(wr.wr_return_amt) AS sum_web_returns, AVG(wr.wr_return_amt) AS avg_web_returns, SUM(cr.cr_return_amount + sr.sr_return_amt + wr.wr_return_amt) AS total_returned_amount, SUM(cr.cr_net_loss + sr.sr_net_loss + wr.wr_net_loss) AS total_net_loss FROM customer c LEFT JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_refunded_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_refunded_customer_sk WHERE (cr.cr_refunded_addr_sk = 22501 OR sr.sr_customer_sk = 76655 OR wr.wr_returning_addr_sk IN (28032, 35974, 28752, 35185)) AND wr.wr_net_loss IN ('349.19', '1875.35', '119.73', '151.90', '2317.12', '1172.86') AND cr.cr_store_credit IN ('43.17', '27.97', '302.61', '30.81', '19.81', '561.19') AND EXISTS (SELECT 1 FROM web_page wp WHERE wp.wp_type = 'order' AND wp.wp_web_page_sk = wr.wr_web_page_sk) GROUP BY c.c_first_name, c.c_last_name ORDER BY total_returned_amount DESC, total_net_loss DESC;
SELECT cp.cp_department, cp.cp_catalog_number, cp.cp_description, cp.cp_type, t.t_shift, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_return_ship_cost) AS total_return_ship_cost, SUM(cr.cr_net_loss) AS net_loss FROM catalog_page cp JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk JOIN time_dim t ON cr.cr_returned_time_sk = t.t_time_sk WHERE cp.cp_end_date_sk IN ('2451087', '2451178') AND t.t_shift = 'third' AND cp.cp_catalog_page_sk IN ('562', '3351', '1660') GROUP BY cp.cp_department, cp.cp_catalog_number, cp.cp_description, cp.cp_type, t.t_shift ORDER BY cp.cp_department, cp.cp_catalog_number, cp.cp_description;
SELECT d_year, d_quarter_name, sm_type, ca_state, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, SUM(cs_net_paid) AS total_net_paid, AVG(cs_net_paid_inc_tax) AS avg_net_paid_inc_tax, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN date_dim ON (cs_sold_date_sk = d_date_sk) JOIN ship_mode ON (cs_ship_mode_sk = sm_ship_mode_sk) JOIN customer_address ON (cs_ship_addr_sk = ca_address_sk) JOIN promotion ON (cs_promo_sk = p_promo_sk) JOIN catalog_page ON (cs_catalog_page_sk = cp_catalog_page_sk) WHERE ca_state IN ('CA', 'TN') AND sm_type IN ('NEXT DAY', 'TWO DAY', 'LIBRARY') AND d_year = 2023 AND p_channel_event = 'N' AND cp_department = 'DEPARTMENT' GROUP BY d_year, d_quarter_name, sm_type, ca_state ORDER BY d_year, d_quarter_name, sm_type, ca_state;
SELECT w_state, ca_state, s_state, web_state, COUNT(DISTINCT c.c_customer_sk) AS num_customers, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses, COUNT(DISTINCT s.s_store_sk) AS num_stores, COUNT(DISTINCT web.web_site_sk) AS num_websites, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_net_paid, AVG(ss_net_profit) AS avg_net_profit, SUM(ss_net_paid_inc_tax) AS total_net_paid_inc_tax FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN web_site web ON s.s_market_id = web.web_mkt_id JOIN warehouse w ON w.w_state = s.s_state JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE s.s_manager IN ('David Thomas', 'Scott Smith', 'William Ward', 'Brett Yates', 'Robert Thompson', 'Edwin Adams') AND web.web_city IN ('Fairview', 'Midway') AND s.s_market_id IN ('8', '6', '4', '2') GROUP BY ROLLUP(w_state, ca_state, s_state, web_state) ORDER BY w_state, ca_state, s_state, web_state;
SELECT dd.d_year, dd.d_quarter_name, i.i_category, COUNT(sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_items, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN date_dim dd ON sr.sr_returned_date_sk = dd.d_date_sk JOIN item i ON sr.sr_item_sk = i.i_item_sk JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN time_dim td ON sr.sr_return_time_sk = td.t_time_sk WHERE (i.i_brand_id IN ('8007010', '6006007', '9004004', '9010002') OR i.i_container = 'Unknown') AND dd.d_quarter_name IN ('1907Q4', '1912Q3', '1913Q3') AND td.t_time_sk = '4464' AND td.t_shift = 'third' GROUP BY dd.d_year, dd.d_quarter_name, i.i_category ORDER BY dd.d_year, dd.d_quarter_name, total_returned_items DESC;
SELECT td.t_shift, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, ib.ib_upper_bound, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws.ws_order_number) AS count_orders, SUM(wr.wr_return_quantity) AS total_quantity_returned, AVG(wr.wr_return_amt) AS average_return_amount, COUNT(DISTINCT wr.wr_order_number) AS count_returns FROM web_sales ws INNER JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk INNER JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk INNER JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk WHERE td.t_shift = 'third' AND td.t_sub_shift = 'night' AND (ib.ib_upper_bound = 10000 OR ib.ib_upper_bound = 20000 OR ib.ib_upper_bound = 130000) GROUP BY td.t_shift, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, ib.ib_upper_bound ORDER BY total_quantity_sold DESC, average_sales_price DESC;
SELECT w_state, i_category, SUM(i_current_price * inv_quantity_on_hand) AS total_value, AVG(i_current_price) AS average_price, COUNT(DISTINCT i_item_sk) AS unique_items_count, COUNT(DISTINCT w_warehouse_sk) AS warehouses_count FROM inventory INNER JOIN item ON inventory.inv_item_sk = item.i_item_sk INNER JOIN warehouse ON inventory.inv_warehouse_sk = warehouse.w_warehouse_sk GROUP BY w_state, i_category ORDER BY total_value DESC, average_price DESC;
SELECT st.s_store_name, st.s_store_id, SUM(ws.ws_net_paid) AS total_net_sales, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(wr.wr_order_number) AS total_returns, AVG(wr.wr_return_amt) AS avg_return_amount, ARRAY_AGG(DISTINCT re.r_reason_desc) AS reasons_for_returns FROM store st LEFT JOIN web_sales ws ON st.s_store_sk = ws.ws_warehouse_sk LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number LEFT JOIN reason re ON wr.wr_reason_sk = re.r_reason_sk WHERE st.s_division_id = 1 AND st.s_tax_precentage BETWEEN 0.01 AND 0.06 GROUP BY st.s_store_name, st.s_store_id ORDER BY total_net_sales DESC, avg_sales_price DESC, total_returns DESC, avg_return_amount DESC;
SELECT cd.cd_education_status, cd.cd_credit_rating, COUNT(c.c_customer_sk) AS total_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(cd.cd_dep_count) AS total_dependents, SUM(cd.cd_dep_employed_count) AS employed_dependents, SUM(cd.cd_dep_college_count) AS college_dependents FROM customer_demographics cd JOIN customer c ON cd.cd_demo_sk = c.c_current_cdemo_sk LEFT JOIN promotion p ON c.c_current_hdemo_sk = p.p_promo_sk WHERE cd.cd_credit_rating IN ('High Risk', 'Low Risk', 'Good', 'Unknown') AND c.c_last_review_date_sk IN (2452297, 2452588) GROUP BY cd.cd_education_status, cd.cd_credit_rating ORDER BY cd.cd_education_status, cd.cd_credit_rating;
SELECT sm.sm_type AS shipping_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_items_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_revenue, SUM(cs.cs_net_profit) AS total_profit, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_items_returned, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_net_loss) AS total_loss FROM catalog_sales cs JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN web_returns wr ON cs.cs_order_number = wr.wr_order_number AND cs.cs_item_sk = wr.wr_item_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk WHERE sm.sm_type IN ('REGULAR', 'OVERNIGHT') AND cd.cd_gender IN ('M', 'F') AND cs.cs_quantity IN (91, 62, 46, 68, 45) AND (wr.wr_returned_time_sk = 74117 OR wr.wr_returned_time_sk IS NULL) GROUP BY sm.sm_type ORDER BY total_revenue DESC, total_loss ASC;
SELECT ca_state, ca_city, COUNT(DISTINCT c_customer_sk) AS number_of_customers, SUM(ss_net_paid) AS total_sales_amount, AVG(ss_quantity) AS average_quantity_sold, SUM(ss_net_profit) AS total_profit, MAX(ib_upper_bound) AS max_income_band_upper_bound, AVG(wr_return_amt) AS average_return_amount FROM customer_address JOIN customer ON c_current_addr_sk = ca_address_sk JOIN store_sales ON ss_customer_sk = c_customer_sk JOIN income_band ON ib_income_band_sk = (SELECT hd_income_band_sk FROM household_demographics WHERE hd_demo_sk = c_current_hdemo_sk) LEFT OUTER JOIN web_returns ON wr_order_number = ss_ticket_number AND wr_item_sk = ss_item_sk WHERE ca_street_type IN ('Dr.', 'Blvd', 'Ln', 'Cir.', 'Boulevard', 'Wy') AND ss_net_paid > 1000 AND ss_quantity < 50 GROUP BY ca_state, ca_city ORDER BY total_sales_amount DESC, average_quantity_sold DESC LIMIT 10;
SELECT cp.cp_department, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_quantity) AS total_return_quantity, AVG(cr.cr_fee) AS avg_fee, i.i_category, i.i_class, COUNT(DISTINCT c.c_customer_sk) AS total_customers, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, SUM(wr.wr_account_credit) AS total_account_credit FROM catalog_page cp JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN customer c ON cr.cr_returning_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN web_returns wr ON i.i_item_sk = wr.wr_item_sk AND cr.cr_order_number = wr.wr_order_number WHERE i.i_formulation IN ('83313678042thistle61', '41681222olive4963389', '57585sienna024168653') AND i.i_product_name IN ('oughtbarn stpri', 'oughteingeingable', 'barcallycally', 'antieseantiable', 'antiprioughtable', 'priationpri') AND wr.wr_account_credit IN ('8.73', '59.44', '133.59') AND hd.hd_vehicle_count IN ('4', '2', '0', '1') AND c.c_email_address = 'Andrew.Lowery@T7T4.com' GROUP BY cp.cp_department, i.i_category, i.i_class ORDER BY total_return_amount DESC, avg_vehicle_count DESC, total_account_credit DESC;
SELECT w_state, sm_type, EXTRACT(YEAR FROM wp_rec_start_date) AS year, EXTRACT(QUARTER FROM wp_rec_start_date) AS quarter, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk JOIN web_page ON cs_catalog_page_sk = wp_web_page_sk JOIN time_dim ON cs_sold_time_sk = t_time_sk JOIN inventory ON cs_warehouse_sk = inv_warehouse_sk AND cs_item_sk = inv_item_sk WHERE t_time_sk IN (1701, 993, 898, 4227, 3566, 3142) AND sm_carrier IN ('GERMA', 'DHL', 'ORIENTAL', 'PRIVATECARRIER') AND inv_date_sk = 2450815 GROUP BY w_state, sm_type, year, quarter ORDER BY total_net_profit DESC, total_net_paid DESC, total_orders DESC;
SELECT w_state, COUNT(DISTINCT w_warehouse_sk) AS total_warehouses, SUM(w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(w_warehouse_sq_ft) AS avg_warehouse_sq_ft, SUM(sr_return_amt) AS total_return_amt, AVG(sr_return_amt) AS avg_return_amt, COUNT(DISTINCT sr_ticket_number) AS total_return_transactions, SUM(wp_char_count) AS total_webpage_char_count, AVG(wp_link_count) AS avg_webpage_link_count, COUNT(DISTINCT web_site_sk) AS total_websites, SUM(web_tax_percentage) AS total_web_tax_percentage, AVG(web_tax_percentage) AS avg_web_tax_percentage FROM warehouse w LEFT JOIN store_returns sr ON w.w_warehouse_sk = sr.sr_store_sk LEFT JOIN web_page wp ON w.w_warehouse_sk = wp.wp_customer_sk LEFT JOIN web_site ws ON wp.wp_web_page_sk = ws.web_site_sk GROUP BY w_state ORDER BY total_return_amt DESC;
SELECT dd.d_year, dd.d_month_seq, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, w.w_country AS warehouse_country, c.c_birth_country AS customer_birth_country FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk JOIN customer c ON ws.ws_ship_customer_sk = c.c_customer_sk WHERE dd.d_year = 2023 AND w.w_country IN ('United States', 'Canada') AND c.c_birth_country IN ('MALTA', 'GRENADA') GROUP BY dd.d_year, dd.d_month_seq, w.w_country, c.c_birth_country ORDER BY total_net_profit DESC, dd.d_month_seq, warehouse_country, customer_birth_country;
SELECT r.r_reason_desc, COUNT(*) AS total_returns, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_amt) AS average_return_amount, SUM(sr_return_quantity) AS total_returned_quantity, SUM(sr_fee) AS total_return_fees, SUM(sr_net_loss) AS total_net_loss FROM store_returns sr JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE sr.sr_return_amt > 0 AND r.r_reason_desc IN ('reason 26', 'reason 34', 'Did not fit', 'Not the product that was ordred') GROUP BY r.r_reason_desc ORDER BY total_return_amount DESC;
SELECT dd.d_year AS year, h.hd_income_band_sk AS income_band, r.r_reason_desc AS return_reason, SUM(ss.ss_net_paid) AS total_sales, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, AVG(ss.ss_quantity) AS average_quantity_sold, SUM(cr.cr_return_amount) AS total_returns, COUNT(DISTINCT cr.cr_order_number) AS total_return_transactions, AVG(cr.cr_return_quantity) AS average_quantity_returned FROM date_dim dd LEFT JOIN store_sales ss ON dd.d_date_sk = ss.ss_sold_date_sk LEFT JOIN catalog_returns cr ON dd.d_date_sk = cr.cr_returned_date_sk LEFT JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk LEFT JOIN household_demographics h ON ss.ss_hdemo_sk = h.hd_demo_sk WHERE dd.d_year IS NOT NULL AND (r.r_reason_id IN ('AAAAAAAANAAAAAAA', 'AAAAAAAALBAAAAAA', 'AAAAAAAALAAAAAAA', 'AAAAAAAADAAAAAAA', 'AAAAAAAAJBAAAAAA') OR r.r_reason_id IS NULL) GROUP BY year, income_band, return_reason ORDER BY year, income_band, total_sales DESC;
