SELECT ssm.sm_code AS shipping_mode, AVG(ws.ws_ext_ship_cost) AS avg_shipping_cost, SUM(ws.ws_net_paid_inc_tax) AS total_net_sales, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, COUNT(DISTINCT ss.ss_ticket_number) AS total_store_sales_transactions, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns_transactions, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_returns_transactions, (SUM(ws.ws_net_paid_inc_tax) - SUM(sr.sr_return_amt_inc_tax) - SUM(cr.cr_return_amt_inc_tax)) AS net_revenue FROM ship_mode AS ssm LEFT JOIN web_sales AS ws ON ssm.sm_ship_mode_sk = ws.ws_ship_mode_sk LEFT JOIN store_sales AS ss ON ws.ws_item_sk = ss.ss_item_sk LEFT JOIN store_returns AS sr ON ss.ss_item_sk = sr.sr_item_sk AND ss.ss_customer_sk = sr.sr_customer_sk LEFT JOIN catalog_returns AS cr ON cr.cr_item_sk = ws.ws_item_sk AND cr.cr_returning_customer_sk = ws.ws_bill_customer_sk GROUP BY ssm.sm_code ORDER BY net_revenue DESC;
SELECT ca.ca_state, cd.cd_education_status, COUNT(DISTINCT c.c_customer_sk) AS total_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(cd.cd_dep_count) AS total_dependents, SUM(cd.cd_dep_employed_count) AS total_employed_dependents, SUM(cd.cd_dep_college_count) AS total_college_dependents, AVG(hd.hd_income_band_sk) AS avg_income_band, AVG(hd.hd_vehicle_count) AS avg_vehicle_count FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE ca.ca_state IS NOT NULL AND cd.cd_education_status IS NOT NULL GROUP BY ca.ca_state, cd.cd_education_status ORDER BY ca.ca_state, cd.cd_education_status;
SELECT ca.ca_state AS state, CASE WHEN cc.cc_call_center_sk IS NOT NULL THEN 'Call Center' WHEN ws.web_site_sk IS NOT NULL THEN 'Web Site' WHEN st.s_store_sk IS NOT NULL THEN 'Store' ELSE 'Unknown' END AS return_channel, COUNT(*) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, AVG(cr.cr_return_tax) AS avg_return_tax, AVG(cr.cr_return_ship_cost) AS avg_return_ship_cost FROM catalog_returns cr LEFT JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk LEFT JOIN web_site ws ON cr.cr_call_center_sk = ws.web_site_sk LEFT JOIN store st ON cr.cr_call_center_sk = st.s_store_sk LEFT JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk GROUP BY ca.ca_state, CASE WHEN cc.cc_call_center_sk IS NOT NULL THEN 'Call Center' WHEN ws.web_site_sk IS NOT NULL THEN 'Web Site' WHEN st.s_store_sk IS NOT NULL THEN 'Store' ELSE 'Unknown' END ORDER BY state, return_channel;
SELECT ca_state, sm_type, COUNT(*) AS total_returns, SUM(cr_return_quantity) AS total_returned_quantity, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_amt_inc_tax) AS total_return_amount_inc_tax, AVG(cr_fee) AS avg_fee, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns JOIN customer_address ON catalog_returns.cr_returning_addr_sk = customer_address.ca_address_sk JOIN ship_mode ON catalog_returns.cr_ship_mode_sk = ship_mode.sm_ship_mode_sk JOIN time_dim ON catalog_returns.cr_returned_time_sk = time_dim.t_time_sk JOIN household_demographics ON catalog_returns.cr_returning_hdemo_sk = household_demographics.hd_demo_sk WHERE cr_return_amt_inc_tax > 1000.00 AND time_dim.t_minute IN (40, 31, 37) AND time_dim.t_shift = 'third' AND household_demographics.hd_buy_potential IN ('5001-10000', '1001-5000', '>10000') AND household_demographics.hd_demo_sk = 2502 GROUP BY ca_state, sm_type ORDER BY total_return_amount_inc_tax DESC, avg_return_amount DESC;
SELECT p.p_promo_name, COUNT(ss.ss_ticket_number) AS total_sales_transactions, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_ext_discount_amt) AS total_discount_amount, SUM(ss.ss_coupon_amt) AS total_coupon_discount, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_including_tax, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE p.p_discount_active = 'Y' AND ss.ss_sold_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk GROUP BY p.p_promo_name ORDER BY total_net_profit DESC, total_sales_transactions DESC;
SELECT ca_state, ca_country, AVG(ca_gmt_offset) AS avg_gmt_offset, COUNT(DISTINCT ca_address_sk) AS num_addresses, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT CASE WHEN t_hour BETWEEN 9 AND 17 THEN ca_address_sk END) AS num_addresses_business_hours FROM customer_address ca JOIN time_dim t ON t.t_time_sk = ca.ca_address_sk JOIN income_band ib ON ib.ib_income_band_sk = ca.ca_address_sk GROUP BY ca_state, ca_country, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ca_state, ca_country, ib.ib_lower_bound;
SELECT cc.cc_division_name, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_paid_inc_tax) AS total_sales_revenue, AVG(ws.ws_net_paid_inc_tax) AS average_order_value, SUM(sr.sr_return_amt_inc_tax) AS total_returns_revenue, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns_count, (SUM(ws.ws_net_paid_inc_tax) - SUM(sr.sr_return_amt_inc_tax)) AS net_revenue_after_returns FROM call_center cc LEFT JOIN web_sales ws ON cc.cc_call_center_sk = ws.ws_web_site_sk LEFT JOIN store_returns sr ON ws.ws_item_sk = sr.sr_item_sk WHERE cc.cc_division_name IN ('ought', 'ese', 'pri', 'anti') AND ws.ws_sold_date_sk IS NOT NULL AND sr.sr_returned_date_sk IS NOT NULL GROUP BY cc.cc_division_name ORDER BY net_revenue_after_returns DESC;
SELECT dd.d_year, dd.d_month_seq, dd.d_quarter_seq, cc.cc_class, SUM(sr.sr_return_amt) AS total_store_returns, AVG(sr.sr_return_quantity) AS avg_store_return_quantity, COUNT(DISTINCT sr.sr_ticket_number) AS count_store_return_tickets, SUM(wr.wr_return_amt) AS total_web_returns, AVG(wr.wr_return_quantity) AS avg_web_return_quantity, COUNT(DISTINCT wr.wr_order_number) AS count_web_return_orders FROM date_dim dd JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk JOIN web_returns wr ON dd.d_date_sk = wr.wr_returned_date_sk JOIN call_center cc ON cc.cc_open_date_sk = dd.d_date_sk WHERE dd.d_year = 2002 AND cc.cc_rec_start_date = '2002-01-01' AND (cc.cc_street_name = 'Center Hill' OR cc.cc_street_name = 'Ash Hill') AND (wr.wr_returned_time_sk IS NOT NULL AND sr.sr_return_time_sk IS NOT NULL) AND (wr.wr_returned_time_sk IN (SELECT t_time_sk FROM time_dim WHERE t_minute IN ('51', '4', '29', '2', '14', '12'))) AND EXISTS (SELECT 1 FROM warehouse w WHERE w.w_warehouse_sk = sr.sr_item_sk AND w.w_county = 'Williamson County' AND w.w_state = 'TN') GROUP BY dd.d_year, dd.d_month_seq, dd.d_quarter_seq, cc.cc_class ORDER BY dd.d_year, dd.d_month_seq, dd.d_quarter_seq, cc.cc_class;
SELECT d_year, w_state AS warehouse_state, sm_type AS shipping_type, p_promo_name, COUNT(DISTINCT cc_call_center_sk) AS number_of_call_centers, SUM(inv_quantity_on_hand) AS total_inventory, AVG(w_warehouse_sq_ft) AS average_warehouse_size, MAX(p_cost) AS max_promotion_cost, MIN(p_cost) AS min_promotion_cost, AVG(p_cost) AS average_promotion_cost, SUM(CASE WHEN p_channel_demo = 'N' THEN p_cost ELSE 0 END) AS sum_cost_non_demo_promotions FROM date_dim JOIN inventory ON inv_date_sk = d_date_sk JOIN warehouse ON w_warehouse_sk = inv_warehouse_sk JOIN ship_mode ON w_zip = sm_ship_mode_id JOIN call_center ON cc_zip = w_zip LEFT JOIN promotion ON p_promo_sk = inv_item_sk WHERE d_year = 1998 AND w_warehouse_sq_ft IN (977787, 294242, 621234, 138504) AND w_zip = '35709' AND d_quarter_seq IN (24, 3) AND d_fy_week_seq IN (444, 401, 706, 517, 70) AND inv_item_sk IN (6008, 6322, 13964, 9541) AND p_channel_demo = 'N' GROUP BY d_year, warehouse_state, shipping_type, p_promo_name ORDER BY d_year, warehouse_state, shipping_type, p_promo_name;
SELECT ws.ws_web_site_sk, ws_site.web_site_id, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS avg_sales_price, SUM(ws.ws_net_profit) AS total_net_profit, cc.cc_call_center_id, cc.cc_name, AVG(cc.cc_employees) AS avg_cc_employees, cd.cd_marital_status, COUNT(DISTINCT cd.cd_demo_sk) AS total_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, hd.hd_buy_potential, AVG(hd.hd_income_band_sk) AS avg_income_band FROM web_sales ws JOIN web_site ws_site ON ws.ws_web_site_sk = ws_site.web_site_sk JOIN call_center cc ON ws_site.web_mkt_id = cc.cc_mkt_id JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk WHERE ws.ws_sales_price > 0 AND ws.ws_sold_date_sk BETWEEN 2451569 AND 2452306 AND ws.ws_web_site_sk IN (4, 18, 20, 29, 27) AND cc.cc_call_center_sk IN (1, 4, 2) AND cd.cd_purchase_estimate > 5000 AND cd.cd_marital_status IN ('D', 'U', 'S', 'M', 'W') AND hd.hd_buy_potential IS NOT NULL GROUP BY ws.ws_web_site_sk, ws_site.web_site_id, cc.cc_call_center_id, cc.cc_name, cd.cd_marital_status, hd.hd_buy_potential ORDER BY total_net_profit DESC, avg_sales_price DESC LIMIT 100;
SELECT s.s_store_name, s.s_store_id, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_net_sales, SUM(ss.ss_net_paid_inc_tax) AS total_net_sales_including_tax, SUM(cr.cr_return_quantity) AS total_returned_quantity, SUM(cr.cr_return_amount) AS total_return_amount, r.r_reason_desc AS return_reason, AVG(ss.ss_net_profit) AS average_net_profit_per_sale, COUNT(DISTINCT cr.cr_order_number) AS total_return_transactions, SUM(cr.cr_net_loss) AS total_net_loss_from_returns FROM store s LEFT JOIN store_sales ss ON s.s_store_sk = ss.ss_store_sk LEFT JOIN catalog_returns cr ON ss.ss_item_sk = cr.cr_item_sk AND ss.ss_ticket_number = cr.cr_order_number LEFT JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk WHERE s.s_gmt_offset = '-5.00' AND s.s_division_id = 1 AND ( r.r_reason_desc = 'its is a boy' OR r.r_reason_desc = 'reason 25' OR r.r_reason_desc = 'Found a better extended warranty in a store' OR r.r_reason_desc = 'reason 27' ) GROUP BY s.s_store_name, s.s_store_id, r.r_reason_desc ORDER BY s.s_store_name, s.s_store_id, r.r_reason_desc;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_class, ca.ca_street_type, COUNT(distinct ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_net_paid, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(distinct ss.ss_customer_sk) AS unique_customers_served FROM store_sales ss JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk JOIN call_center cc ON cc.cc_class IN ('small', 'medium', 'large') LEFT JOIN reason r ON r.r_reason_desc = 'reason 31' WHERE ca.ca_street_type IN ('Pkwy', 'Court') AND r.r_reason_sk IS NULL GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_class, ca.ca_street_type ORDER BY total_net_profit DESC, total_sales_transactions DESC;
SELECT ca_state, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_ticket_number) AS total_sales_transactions, SUM(ss_net_profit) AS total_net_profit FROM store_sales JOIN customer_address ON store_sales.ss_addr_sk = customer_address.ca_address_sk WHERE customer_address.ca_country = 'United States' AND store_sales.ss_sold_date_sk BETWEEN 20220101 AND 20221231 GROUP BY ca_state ORDER BY total_net_profit DESC;
SELECT dd.d_year AS return_year, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, r.r_reason_desc AS most_common_reason, MAX(reason_count) AS reason_count FROM catalog_returns cr JOIN date_dim dd ON cr.cr_returned_date_sk = dd.d_date_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk LEFT JOIN (SELECT cr_reason_sk, COUNT(*) AS reason_count FROM catalog_returns GROUP BY cr_reason_sk) AS rc ON rc.cr_reason_sk = cr.cr_reason_sk WHERE dd.d_weekend = 'N' AND dd.d_holiday = 'N' GROUP BY return_year, r.r_reason_desc ORDER BY return_year DESC, reason_count DESC;
