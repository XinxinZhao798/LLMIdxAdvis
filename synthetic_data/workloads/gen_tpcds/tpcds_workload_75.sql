SELECT wp_type AS web_page_type, ca_country AS customer_country, COUNT(DISTINCT wp_web_page_sk) AS num_web_pages, AVG(wp_char_count) AS avg_char_count, SUM(wp_link_count) AS total_link_count, SUM(wp_image_count) AS total_image_count FROM web_page JOIN customer_address ON wp_customer_sk = ca_address_sk JOIN reason ON wp_web_page_sk = r_reason_sk WHERE ca_county IN ('Worcester County', 'Tooele County', 'Page County', 'Wabaunsee County') AND r_reason_desc IN ('reason 27', 'unauthorized purchase', 'Did not get it on time', 'Gift exchange') AND r_reason_sk IN (26, 15, 5) GROUP BY web_page_type, customer_country ORDER BY avg_char_count DESC, total_link_count DESC;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address, SUM(cr.cr_return_amount) AS total_catalog_returns, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_return_orders, AVG(cr.cr_return_quantity) AS avg_catalog_return_quantity, SUM(wr.wr_return_amt) AS total_web_returns, COUNT(DISTINCT wr.wr_order_number) AS total_web_return_orders, AVG(wr.wr_return_quantity) AS avg_web_return_quantity, SUM(ws.ws_sales_price) AS total_web_sales, AVG(ws.ws_quantity) AS avg_web_sales_quantity, COUNT(DISTINCT ws.ws_order_number) AS total_web_sales_orders, SUM(ws.ws_net_profit) AS total_web_net_profit FROM customer c LEFT JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_returning_customer_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk LEFT JOIN web_sales ws ON c.c_customer_sk = ws.ws_ship_customer_sk GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address ORDER BY total_web_net_profit DESC, total_catalog_returns DESC, total_web_returns DESC LIMIT 100;
SELECT ca_state, ca_country, AVG(wp_char_count) AS average_character_count, SUM(wp_link_count) AS total_link_count, COUNT(wp_web_page_sk) AS total_pages, AVG(ib_lower_bound) AS average_income_lower_bound, AVG(ib_upper_bound) AS average_income_upper_bound, COUNT(DISTINCT ib_income_band_sk) AS distinct_income_band_count FROM web_page JOIN customer_address ON wp_customer_sk = ca_address_sk JOIN income_band ON ca_address_id::integer = ib_income_band_sk WHERE wp_type = 'product' AND ca_country = 'United States' AND ib_lower_bound >= 70001 AND (ib_income_band_sk IN (3, 8, 1, 10, 13, 9) OR wp_autogen_flag = 'Y') GROUP BY ca_state, ca_country ORDER BY ca_state, ca_country;
SELECT cd.cd_credit_rating, wp.wp_type, AVG(ws.ws_sales_price) AS avg_sales_amount, SUM(ws.ws_ext_ship_cost) AS total_shipping_cost, AVG(ws.ws_quantity) AS avg_items_per_order, SUM(wr.wr_return_amt) AS total_return_amount, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_inc_tax FROM web_sales ws JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number WHERE cd.cd_credit_rating IN ('Unknown', 'Good', 'High Risk') AND wp.wp_url = 'http://www.foo.com' AND ws.ws_ship_customer_sk IN ('68344', '31854', '75904', '57654') AND ws.ws_ext_ship_cost = 1302.64 AND wp.wp_creation_date_sk IN ('2450810', '2450815', '2450813') AND wr.wr_refunded_customer_sk IN ('21890', '47305', '48588', '57226', '74434') AND wr.wr_order_number IN ('3277', '3156') GROUP BY cd.cd_credit_rating, wp.wp_type ORDER BY total_shipping_cost DESC, avg_sales_amount DESC;
SELECT ca.ca_state, EXTRACT(YEAR FROM TO_DATE(c.c_first_shipto_date_sk::text, 'YYYYMMDD')) AS first_shipto_year, p.p_channel_details, COUNT(DISTINCT c.c_customer_sk) AS num_customers, AVG(ws.ws_net_profit) AS avg_web_net_profit, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, COUNT(DISTINCT ws.ws_order_number) AS num_web_orders, COUNT(DISTINCT sr.sr_ticket_number) AS num_returns FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk AND sr.sr_addr_sk = 23889 JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk WHERE c.c_birth_month IN (10, 6, 9, 7, 5) AND p.p_channel_catalog = 'N' AND ws.ws_list_price = 218.80 AND p.p_promo_id IN ('AAAAAAAAPLAAAAAA', 'AAAAAAAAOMAAAAAA', 'AAAAAAAACAAAAAAA') GROUP BY ca.ca_state, first_shipto_year, p.p_channel_details ORDER BY ca.ca_state, first_shipto_year, p.p_channel_details;
SELECT p.p_promo_name, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo, SUM(p.p_cost) AS total_promotion_cost, COUNT(p.p_promo_sk) AS number_of_promotions, AVG(cd.cd_dep_count) AS average_number_of_dependents FROM promotion p JOIN web_page wp ON p.p_item_sk = wp.wp_web_page_sk JOIN customer_demographics cd ON wp.wp_customer_sk = cd.cd_demo_sk WHERE wp.wp_creation_date_sk IN ('2450808', '2450809') AND p.p_response_target = 1 AND cd.cd_marital_status IN ('W', 'D', 'U', 'S') GROUP BY p.p_promo_name, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo ORDER BY total_promotion_cost DESC, number_of_promotions DESC;
SELECT d.d_year, d.d_quarter_name, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(wp.wp_link_count) AS avg_link_count, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS preferred_customers_count, SUM(CASE WHEN d.d_holiday = 'Y' THEN 1 ELSE 0 END) AS holiday_count FROM date_dim d JOIN customer c ON c.c_first_sales_date_sk = d.d_date_sk JOIN inventory inv ON inv.inv_date_sk = d.d_date_sk JOIN web_page wp ON wp.wp_access_date_sk = d.d_date_sk WHERE d.d_year = 2021 GROUP BY d.d_year, d.d_quarter_name ORDER BY d.d_year, d.d_quarter_name;
SELECT ca.ca_state, ca.ca_city, sum(cs.cs_quantity) AS total_quantity_sold, avg(cs.cs_sales_price) AS average_sales_price, count(distinct cs.cs_order_number) AS total_orders, cd.cd_education_status, sum(cs.cs_net_profit) AS total_net_profit, count(distinct cs.cs_item_sk) AS unique_items_sold, ib.ib_lower_bound, ib.ib_upper_bound FROM catalog_sales cs JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON cs.cs_ship_cdemo_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound WHERE ca.ca_county = 'Lonoke County' AND (cd.cd_gender = 'M' OR cd.cd_gender = 'F') GROUP BY ca.ca_state, ca.ca_city, cd.cd_education_status, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ca.ca_state, ca.ca_city, cd.cd_education_status, total_net_profit DESC;
SELECT s.s_store_name, w.w_warehouse_name, COUNT(ss.ss_ticket_number) AS total_sales_transactions, AVG(ss.ss_net_paid) AS avg_transaction_amount, SUM(ss.ss_net_paid_inc_tax) AS total_revenue_inc_tax, SUM(wr.wr_return_amt_inc_tax) AS total_returns_inc_tax, (SUM(ss.ss_net_paid_inc_tax) - SUM(wr.wr_return_amt_inc_tax)) AS net_revenue_inc_tax, AVG(wr.wr_fee) AS avg_return_fee, SUM(wr.wr_net_loss) AS total_net_loss_from_returns FROM store s JOIN store_sales ss ON s.s_store_sk = ss.ss_store_sk LEFT JOIN web_returns wr ON ss.ss_ticket_number = wr.wr_order_number JOIN warehouse w ON s.s_state = w.w_state GROUP BY s.s_store_name, w.w_warehouse_name ORDER BY net_revenue_inc_tax DESC, s.s_store_name;
SELECT dd.d_year, dd.d_quarter_name, i.i_category, i.i_brand, COUNT(DISTINCT ws.web_site_sk) AS number_of_websites, COUNT(DISTINCT wp.wp_web_page_sk) AS number_of_web_pages, COUNT(DISTINCT wr.wr_order_number) AS number_of_returns, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_return_quantity) AS avg_return_quantity, AVG(wr.wr_fee) AS avg_return_fee, hd.hd_dep_count, ib.ib_lower_bound AS income_band_lower_bound, ib.ib_upper_bound AS income_band_upper_bound, SUM(hd.hd_vehicle_count) AS total_vehicles FROM web_returns wr JOIN date_dim dd ON wr.wr_returned_date_sk = dd.d_date_sk JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk JOIN item i ON wr.wr_item_sk = i.i_item_sk JOIN web_site ws ON wp.wp_web_page_sk = ws.web_site_sk JOIN household_demographics hd ON wr.wr_returning_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE dd.d_year = 2001 AND i.i_category_id IN (1, 2, 3) AND wr.wr_return_tax > 100 AND hd.hd_income_band_sk = 10 AND wr.wr_refunded_cash BETWEEN 300 AND 4000 GROUP BY dd.d_year, dd.d_quarter_name, i.i_category, i.i_brand, hd.hd_dep_count, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_return_amount DESC, avg_return_quantity DESC, avg_return_fee DESC, number_of_websites, number_of_web_pages;
