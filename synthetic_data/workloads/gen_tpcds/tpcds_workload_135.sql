SELECT r.r_reason_desc AS return_reason, c.c_preferred_cust_flag AS preferred_customer, t.t_am_pm AS purchase_time_period, COUNT(wr.wr_order_number) AS total_returns, SUM(wr.wr_refunded_cash) AS total_refunded_amount, AVG(wr.wr_refunded_cash) AS avg_refunded_amount FROM web_returns wr JOIN reason r ON wr.wr_reason_sk = r.r_reason_sk JOIN customer c ON wr.wr_returning_customer_sk = c.c_customer_sk JOIN catalog_sales cs ON wr.wr_order_number = cs.cs_order_number JOIN time_dim t ON cs.cs_sold_time_sk = t.t_time_sk GROUP BY r.r_reason_desc, c.c_preferred_cust_flag, t.t_am_pm ORDER BY total_refunded_amount DESC, total_returns DESC;
SELECT d_year, d_qoy, cc_name, COUNT(DISTINCT cr_order_number) AS num_returns, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, COUNT(DISTINCT sr_ticket_number) AS num_store_returns, SUM(sr_return_amt) AS total_store_return_amount, AVG(sr_return_amt) AS avg_store_return_amount, SUM(hd_dep_count) AS total_dependants, AVG(hd_vehicle_count) AS avg_vehicles FROM date_dim JOIN catalog_returns ON cr_returned_date_sk = d_date_sk JOIN call_center ON cr_call_center_sk = cc_call_center_sk JOIN store_returns ON sr_returned_date_sk = d_date_sk JOIN household_demographics ON cr_returning_hdemo_sk = hd_demo_sk AND sr_hdemo_sk = hd_demo_sk WHERE d_qoy = 2 AND d_following_holiday = 'Y' AND hd_income_band_sk = 15 AND (cr_item_sk IN (10036, 2977) OR sr_item_sk IN (10036, 2977)) AND (cr_refunded_customer_sk IN (78674, 95319, 63625, 45060, 53817, 43545) OR sr_customer_sk IN (78674, 95319, 63625, 45060, 53817, 43545)) AND cc_street_name IN ('Center Hill', 'Pine Ridge', 'Ash Hill') GROUP BY d_year, d_qoy, cc_name ORDER BY d_year, d_qoy, cc_name;
SELECT d_year, d_quarter_name, cd_gender, cd_education_status, SUM(ws_net_profit) AS total_net_profit, AVG(ws_quantity) AS avg_quantity_sold, COUNT(DISTINCT ws_order_number) AS total_orders, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT sr_ticket_number) AS total_return_transactions FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN customer_demographics ON ws_bill_cdemo_sk = cd_demo_sk LEFT JOIN store_returns ON sr_customer_sk = ws_bill_customer_sk AND sr_returned_date_sk = ws_sold_date_sk WHERE d_year = 1999 AND cd_dep_employed_count = 0 AND ws_ext_tax IN ('56.09', '24.79', '237.72', '4.60', '438.93', '37.94') AND ws_web_site_sk IN ('15', '25', '16', '12', '19') AND sr_customer_sk IN ('34000', '49632', '58331', '36235') GROUP BY d_year, d_quarter_name, cd_gender, cd_education_status ORDER BY total_net_profit DESC, total_orders DESC;
SELECT c.c_birth_country, sm.sm_type AS shipping_type, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_ext_tax) AS total_tax_collected, SUM(ws.ws_coupon_amt) AS total_coupon_amount, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk GROUP BY c.c_birth_country, sm.sm_type ORDER BY c.c_birth_country, sm.sm_type;
SELECT cp.cp_department, SUM(ws.ws_net_profit) AS total_web_sales_profit, AVG(ws.ws_quantity) AS avg_web_sales_quantity, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(cr.cr_net_loss) AS total_catalog_returns_loss, AVG(cr.cr_return_quantity) AS avg_catalog_return_quantity, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_returns, SUM(sr.sr_net_loss) AS total_store_returns_loss, AVG(sr.sr_return_quantity) AS avg_store_return_quantity, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, SUM(CASE WHEN p.p_channel_dmail = 'Y' THEN p.p_cost ELSE 0 END) AS total_promo_cost_via_dmail, COUNT(CASE WHEN p.p_channel_demo = 'N' AND p.p_channel_catalog = 'N' THEN p.p_promo_sk END) AS count_non_demo_catalog_promos FROM catalog_page cp LEFT JOIN web_sales ws ON cp.cp_catalog_page_sk = ws.ws_web_page_sk LEFT JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk LEFT JOIN store_returns sr ON sr.sr_item_sk = ws.ws_item_sk LEFT JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk WHERE cp.cp_start_date_sk IS NOT NULL AND cp.cp_end_date_sk IS NOT NULL AND ws.ws_sold_date_sk BETWEEN cp.cp_start_date_sk AND cp.cp_end_date_sk GROUP BY cp.cp_department ORDER BY total_web_sales_profit DESC, total_catalog_returns_loss ASC, total_store_returns_loss ASC;
SELECT i_category, i_brand, sum(i_current_price) as total_sales, avg(i_current_price) as avg_price, count(i_item_sk) as item_count, sum(inv_quantity_on_hand) as total_inventory, sum(wr_return_amt_inc_tax) as total_returns, avg(wr_fee) as avg_return_fee, count(distinct wp_web_page_sk) as page_count, sum(case when wp_autogen_flag = 'Y' then 1 else 0 end) as autogen_page_count FROM item LEFT JOIN inventory ON i_item_sk = inv_item_sk LEFT JOIN web_returns ON i_item_sk = wr_item_sk LEFT JOIN web_page ON wr_web_page_sk = wp_web_page_sk LEFT JOIN promotion ON i_item_sk = p_item_sk WHERE i_rec_end_date IS NULL AND (i_category = 'Electronics' OR i_category = 'Home Goods') AND wp_url = 'http://www.foo.com' AND p_discount_active = 'Y' GROUP BY i_category, i_brand ORDER BY total_sales DESC, total_inventory DESC;
SELECT s.s_store_name, COUNT(sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_fee) AS total_fees_collected, SUM(sr.sr_net_loss) AS total_net_loss, cd.cd_credit_rating, COUNT(DISTINCT cd.cd_demo_sk) AS unique_customers_returning, w.w_warehouse_name, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft_used, p.p_promo_name, SUM(p.p_cost) AS total_promotion_cost, AVG(wp.wp_link_count) AS average_webpage_link_count FROM store_returns sr INNER JOIN store s ON sr.sr_store_sk = s.s_store_sk INNER JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk INNER JOIN warehouse w ON s.s_zip = w.w_zip INNER JOIN promotion p ON sr.sr_reason_sk = p.p_promo_sk INNER JOIN web_page wp ON wp.wp_customer_sk = sr.sr_customer_sk WHERE s.s_rec_start_date BETWEEN '1997-03-13' AND '2001-03-13' AND s.s_store_name IN ('ese', 'ought', 'cally') AND wp.wp_creation_date_sk::text IN ('2450814', '2450813', '2450815') AND wp.wp_rec_start_date BETWEEN '1997-09-03' AND '2001-09-03' AND sr.sr_reversed_charge = 13.92 AND cd.cd_credit_rating IN ('Low Risk', 'High Risk', 'Unknown', 'Good') GROUP BY s.s_store_name, cd.cd_credit_rating, w.w_warehouse_name, p.p_promo_name ORDER BY total_returns DESC, total_net_loss DESC;
SELECT cp_department, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_profit) AS total_net_profit, COUNT(DISTINCT ss_ticket_number) AS total_store_sales_tickets, SUM(ss_quantity) AS total_store_quantity_sold, AVG(ss_sales_price) AS average_store_sales_price, SUM(ss_net_paid_inc_tax) AS total_store_net_paid_inc_tax FROM catalog_sales JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk JOIN store_sales ON catalog_sales.cs_item_sk = store_sales.ss_item_sk JOIN store ON store_sales.ss_store_sk = s_store_sk JOIN customer ON store_sales.ss_customer_sk = c_customer_sk WHERE c_birth_country IN ('MOLDOVA, REPUBLIC OF', 'TOGO', 'IRAQ', 'BURUNDI') AND cp_department IS NOT NULL AND cp_start_date_sk IS NOT NULL AND cp_end_date_sk IS NOT NULL AND (cp_end_date_sk - cp_start_date_sk) > 0 AND s_market_id IS NOT NULL GROUP BY cp_department ORDER BY total_net_profit DESC, total_orders DESC LIMIT 10;
SELECT s.s_store_name, s.s_state, cp.cp_department, COUNT(*) AS total_returns, AVG(wr.wr_return_amt) AS avg_refund_amount, AVG(wr.wr_return_tax) AS avg_tax, AVG(wr.wr_return_ship_cost) AS avg_shipping_cost, SUM(wr.wr_net_loss) AS total_net_loss, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, COUNT(DISTINCT wr.wr_refunded_customer_sk) AS unique_customers FROM web_returns wr JOIN store s ON wr.wr_returning_addr_sk = s.s_store_sk JOIN customer_demographics cd ON wr.wr_refunded_cdemo_sk = cd.cd_demo_sk JOIN catalog_page cp ON wr.wr_web_page_sk = cp.cp_catalog_page_sk WHERE s.s_division_id = 1 AND s.s_tax_precentage IN (0.08, 0.01, 0.06, 0.03) AND cp.cp_description LIKE 'Traditional, clear years used to cover regardless%' AND cp.cp_start_date_sk >= 2450997 AND cd.cd_credit_rating = 'Good' GROUP BY s.s_store_name, s.s_state, cp.cp_department ORDER BY total_net_loss DESC, avg_refund_amount DESC;
SELECT i.i_category, i.i_brand, sm.sm_type, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt) AS avg_return_amount, SUM(wr.wr_return_amt) AS total_return_amount, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_net_loss) AS total_net_loss FROM web_returns wr JOIN item i ON wr.wr_item_sk = i.i_item_sk JOIN ship_mode sm ON wr.wr_returned_date_sk = sm.sm_ship_mode_sk WHERE i.i_item_id IN ('AAAAAAAAEKBBAAAA', 'AAAAAAAACAAAAAAA', 'AAAAAAAAGCCAAAAA', 'AAAAAAAAKMEAAAAA') AND wr.wr_return_tax IN (29.73, 18.36, 50.38, 6.84) AND wr.wr_fee IN (85.54, 18.90, 40.73, 20.86, 73.81) AND sm.sm_ship_mode_sk IN (13, 7, 6, 16, 10) AND sm.sm_type IN ('TWO DAY', 'OVERNIGHT') GROUP BY i.i_category, i.i_brand, sm.sm_type ORDER BY total_net_loss DESC, total_returned_quantity DESC;
SELECT cc.cc_name AS call_center_name, i.i_category AS item_category, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN call_center cc ON ws.ws_bill_customer_sk = cc.cc_call_center_sk JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk JOIN time_dim t ON ws.ws_sold_time_sk = t.t_time_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk WHERE cc.cc_manager IN ('Bob Belcher', 'Felipe Perkins', 'Larry Mccray', 'Mark Hightower') AND i.i_container = 'Unknown' AND ws.ws_ship_hdemo_sk IN (6862, 4638, 2050, 5884, 1108) AND d.d_year = 2023 AND t.t_am_pm = 'PM' GROUP BY call_center_name, item_category ORDER BY total_net_profit DESC;
SELECT dd.d_year, dd.d_quarter_name, sm.sm_type, ca.ca_state, COUNT(DISTINCT cp.cp_catalog_page_sk) AS total_catalog_pages, SUM(CASE WHEN ca.ca_location_type = 'single family' THEN 1 ELSE 0 END) AS single_family_count, SUM(CASE WHEN ca.ca_location_type = 'apartment' THEN 1 ELSE 0 END) AS apartment_count, SUM(CASE WHEN ca.ca_location_type = 'condo' THEN 1 ELSE 0 END) AS condo_count, AVG(ca.ca_gmt_offset) AS avg_gmt_offset FROM catalog_page cp JOIN date_dim dd ON cp.cp_start_date_sk = dd.d_date_sk OR cp.cp_end_date_sk = dd.d_date_sk JOIN customer_address ca ON cp.cp_catalog_page_sk = ca.ca_address_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = dd.d_date_sk WHERE dd.d_year = 2023 GROUP BY dd.d_year, dd.d_quarter_name, sm.sm_type, ca.ca_state ORDER BY dd.d_year, dd.d_quarter_name, sm.sm_type, ca.ca_state;
SELECT cc.cc_name, cc.cc_class, COUNT(DISTINCT c.c_customer_sk) AS total_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(cd.cd_dep_count) AS total_dependents, COUNT(DISTINCT inv.inv_warehouse_sk) AS unique_warehouses, SUM(inv.inv_quantity_on_hand) AS total_inventory FROM call_center cc JOIN customer c ON (cc.cc_call_center_sk = c.c_current_addr_sk) JOIN customer_demographics cd ON (c.c_current_cdemo_sk = cd.cd_demo_sk) JOIN inventory inv ON (cc.cc_sq_ft = inv.inv_quantity_on_hand) WHERE cc.cc_sq_ft IN (649, 2268, 795, 3514, 1138) AND c.c_birth_month IN (3, 5) AND c.c_birth_day = 18 GROUP BY cc.cc_name, cc.cc_class ORDER BY total_customers DESC, avg_purchase_estimate DESC;
SELECT s.s_division_id AS store_division_id, s.s_division_name AS store_division_name, hd.hd_income_band_sk AS household_income_band, COUNT(DISTINCT ws.ws_order_number) AS total_web_sales, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, AVG(sr.sr_return_amt) AS average_return_amount FROM store s LEFT JOIN web_sales ws ON s.s_store_sk = ws.ws_ship_customer_sk LEFT JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk LEFT JOIN household_demographics hd ON (ws.ws_ship_hdemo_sk = hd.hd_demo_sk OR sr.sr_hdemo_sk = hd.hd_demo_sk) WHERE ws.ws_order_number IS NOT NULL OR sr.sr_ticket_number IS NOT NULL GROUP BY s.s_division_id, s.s_division_name, hd.hd_income_band_sk ORDER BY s.s_division_id, hd.hd_income_band_sk;
SELECT sm.sm_type AS shipping_type, web.web_site_sk, web.web_name AS website_name, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_paid) AS total_revenue, AVG(ws.ws_quantity) AS average_quantity, AVG(ws.ws_ext_discount_amt) AS average_discount, SUM(ws.ws_coupon_amt) AS total_coupon_amount, SUM(ws.ws_net_profit) AS total_profit FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk WHERE web.web_name IN ('site_3', 'site_4', 'site_1', 'site_0', 'site_2') AND sm.sm_contract IN ('GNJr3g5i7oorKqtX', 'uukTktPYycct8', 'ldhM8IvpzHgdbBgDfI', '2mM8l') AND ws.ws_sold_date_sk BETWEEN 20230101 AND 20231231 GROUP BY sm.sm_type, web.web_site_sk, web.web_name ORDER BY total_revenue DESC;
SELECT ca_state, w_state, AVG(c_hd.hd_dep_count) AS avg_household_dep_count, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_profit) AS total_net_profit, SUM(ss_net_profit) AS total_store_net_profit FROM customer_address ca JOIN catalog_sales cs ON ca.ca_address_sk = cs.cs_bill_addr_sk JOIN household_demographics c_hd ON cs.cs_bill_hdemo_sk = c_hd.hd_demo_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN store_sales ss ON cs.cs_item_sk = ss.ss_item_sk AND cs.cs_order_number = ss.ss_ticket_number WHERE ca.ca_country = 'United States' AND w.w_country = 'United States' AND ss.ss_quantity > 5 AND cs.cs_quantity > 5 AND ca.ca_state IN ('CA', 'TX', 'NY') GROUP BY ca_state, w_state ORDER BY total_net_profit DESC, total_store_net_profit DESC, ca_state, w_state;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_paid_inc_ship) AS total_revenue_inc_ship, AVG(cs.cs_net_paid_inc_tax) AS avg_revenue_inc_tax, wp.wp_type, COUNT(wp.wp_web_page_sk) AS page_count, SUM(wp.wp_image_count) AS total_image_count, r.r_reason_desc, COUNT(r.r_reason_sk) AS reason_count FROM catalog_sales cs JOIN income_band ib ON cs.cs_bill_hdemo_sk = ib.ib_income_band_sk JOIN web_page wp ON cs.cs_catalog_page_sk = wp.wp_web_page_sk LEFT JOIN reason r ON cs.cs_ship_mode_sk = r.r_reason_sk WHERE cs.cs_ship_cdemo_sk IN ('895212', '186278', '897167') AND cs.cs_net_paid_inc_ship IN (3933.80, 801.00, 5246.97) AND cs.cs_net_paid_inc_tax IN (103.42, 7068.42, 500.16) AND cs.cs_sold_date_sk IN (2450829, 2450822, 2450816) AND r.r_reason_desc IN ('Wrong size', 'No service location in my area', 'Lost my job') AND r.r_reason_id IN ('AAAAAAAANAAAAAAA', 'AAAAAAAAOAAAAAAA', 'AAAAAAAACCAAAAAA') AND r.r_reason_sk IN (11, 14, 19) AND wp.wp_autogen_flag IN ('N', 'Y') AND wp.wp_type IN ('ad', 'order', 'dynamic') AND wp.wp_image_count IN (1, 3, 6) AND wp.wp_web_page_sk IN (44, 58, 40) AND ib.ib_upper_bound IN (70000, 200000, 140000) AND ib.ib_income_band_sk IN (10, 15, 2) AND ib.ib_lower_bound IN (130001, 190001, 20001) GROUP BY ib.ib_income_band_sk, wp.wp_type, r.r_reason_desc ORDER BY total_revenue_inc_ship DESC, avg_revenue_inc_tax DESC, total_orders DESC, page_count DESC, total_image_count DESC, reason_count DESC;
SELECT s_state, s_city, ib_lower_bound, ib_upper_bound, AVG(s_number_employees) AS avg_employees, AVG(s_floor_space) AS avg_floor_space, SUM(w_warehouse_sq_ft) AS total_warehouse_sq_ft, COUNT(DISTINCT cp_catalog_page_sk) AS num_catalog_pages, AVG(hd_vehicle_count) AS avg_vehicle_count FROM store JOIN household_demographics ON (s_store_sk = hd_demo_sk) JOIN income_band ON (hd_income_band_sk = ib_income_band_sk) JOIN warehouse ON (s_zip = w_zip) JOIN catalog_page ON (s_market_id = cp_catalog_number) WHERE s_state = 'TN' AND (s_closed_date_sk IN (2450910, 2451189, 2451044) OR s_closed_date_sk IS NULL) AND hd_dep_count IN (2, 3, 4, 5, 8, 9) AND cp_end_date_sk IN (2451087, 2451114, 2450996, 2451664) AND w_warehouse_sq_ft IN (977787, 294242, 621234, 138504) AND w_warehouse_id IN ('AAAAAAAABAAAAAAA', 'AAAAAAAAEAAAAAAA', 'AAAAAAAADAAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAACAAAAAAA') GROUP BY s_state, s_city, ib_lower_bound, ib_upper_bound ORDER BY s_city, ib_lower_bound;
SELECT w_state, cp_department, COUNT(DISTINCT cr_order_number) AS num_returns, SUM(cr_return_quantity) AS total_returned_qty, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_amount) AS total_return_amount, SUM(cr_fee) AS total_fees, SUM(cr_return_ship_cost) AS total_shipping_cost, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns JOIN catalog_page ON catalog_returns.cr_catalog_page_sk = catalog_page.cp_catalog_page_sk JOIN warehouse ON catalog_returns.cr_warehouse_sk = warehouse.w_warehouse_sk GROUP BY w_state, cp_department ORDER BY total_return_amount DESC, total_net_loss DESC LIMIT 10;
SELECT cd.cd_purchase_estimate AS purchase_estimate, ib.ib_lower_bound AS income_band_lower_bound, ib.ib_upper_bound AS income_band_upper_bound, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt) AS total_returned_amount, AVG(wr.wr_return_amt) AS average_return_amount, AVG(wr.wr_fee) AS average_fee, AVG(wr.wr_net_loss) AS average_net_loss FROM web_returns wr INNER JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk INNER JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound WHERE wr.wr_return_quantity > 0 AND cd.cd_purchase_estimate IN (8500, 7000, 1000, 9000, 4500, 5500) AND ib.ib_lower_bound IN (70001, 90001, 180001) GROUP BY cd.cd_purchase_estimate, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_returned_amount DESC;
SELECT ws_site.web_site_id, i.i_category, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, SUM(ws.ws_net_paid) AS total_revenue, SUM(ws.ws_net_profit) AS total_profit, AVG(ws.ws_net_paid_inc_tax) AS average_revenue_inc_tax, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_amt_inc_tax) AS average_return_amount_inc_tax, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT hd.hd_demo_sk) AS count_households, AVG(hd.hd_vehicle_count) AS average_vehicles_per_household FROM web_sales ws INNER JOIN web_site ws_site ON ws.ws_web_site_sk = ws_site.web_site_sk INNER JOIN item i ON ws.ws_item_sk = i.i_item_sk LEFT JOIN store_returns sr ON ws.ws_item_sk = sr.sr_item_sk AND ws.ws_order_number = sr.sr_ticket_number INNER JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk INNER JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE ws.ws_sales_price BETWEEN 50 AND 200 AND ib.ib_income_band_sk IN (1, 7, 5, 16, 19) GROUP BY ws_site.web_site_id, i.i_category, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_revenue DESC;
SELECT cc.cc_name, cc.cc_city, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(ss.ss_net_profit) AS total_net_profit FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN reason r ON r.r_reason_sk = ss.ss_promo_sk WHERE cc.cc_gmt_offset = '-5.00' AND cc.cc_rec_start_date BETWEEN '2001-01-01' AND '2002-01-01' AND ss.ss_quantity IN (65, 96, 9, 80, 52, 68) AND r.r_reason_id = 'AAAAAAAAGBAAAAAA' GROUP BY cc.cc_name, cc.cc_city ORDER BY total_net_profit DESC, total_quantity_sold DESC;
SELECT i.i_category, i.i_brand, t.t_shift, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantities_sold, AVG(ss.ss_sales_price) AS average_selling_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) - SUM(ss.ss_net_paid) AS total_tax_collected, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE ss.ss_sold_date_sk IN (2451375, 2451147, 2451762, 2451572, 2452439, 2452222) AND ss.ss_sales_price BETWEEN 4.90 AND 95.65 GROUP BY i.i_category, i.i_brand, t.t_shift ORDER BY total_net_profit DESC, i.i_category, i.i_brand, t.t_shift;
SELECT w_state, COUNT(DISTINCT ss_store_sk) AS number_of_stores, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_net_paid, AVG(ss_wholesale_cost) AS average_wholesale_cost, AVG(ss_ext_discount_amt) AS average_discount_amount, COUNT(CASE WHEN ss_coupon_amt > 50 THEN ss_ticket_number END) AS count_high_coupon_sales FROM store_sales JOIN warehouse ON ss_addr_sk = w_warehouse_sk WHERE w_state = 'TN' AND w_suite_number = 'Suite 470' AND ss_coupon_amt > 50 GROUP BY w_state ORDER BY total_net_paid DESC;
