SELECT ca.ca_state AS customer_state, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sale_price, SUM(cr.cr_return_quantity) AS total_quantity_returned, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, COUNT(DISTINCT p.p_promo_sk) AS total_promotions_used, COUNT(DISTINCT w.w_warehouse_sk) AS total_warehouses_used FROM customer_address ca JOIN customer c ON ca.ca_address_sk = c.c_current_addr_sk JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk WHERE ca.ca_state IS NOT NULL AND p.p_channel_radio = 'N' AND (p.p_promo_name LIKE '%bar%' OR p.p_promo_name LIKE '%anti%') AND w.w_warehouse_id IN ('AAAAAAAABAAAAAAA', 'AAAAAAAADAAAAAAA', 'AAAAAAAAEAAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAACAAAAAAA') AND cs.cs_catalog_page_sk IN ( SELECT cp_catalog_page_sk FROM catalog_page WHERE cp_catalog_page_number IN (29, 24, 40) ) GROUP BY ca.ca_state ORDER BY total_return_amount DESC, average_sale_price DESC LIMIT 100;
SELECT w_state, p_promo_id, p_discount_active, COUNT(DISTINCT cr_order_number) AS total_returns, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_quantity) AS total_returned_quantity, COUNT(DISTINCT sr_ticket_number) AS total_store_returns, SUM(sr_return_amt) AS total_store_return_amount, AVG(sr_return_amt) AS avg_store_return_amount, SUM(sr_return_quantity) AS total_store_returned_quantity FROM catalog_returns JOIN warehouse ON cr_warehouse_sk = w_warehouse_sk JOIN promotion ON cr_catalog_page_sk = p_promo_sk JOIN store_returns ON cr_item_sk = sr_item_sk AND cr_order_number = sr_ticket_number WHERE w_state = 'TN' AND p_promo_id = 'AAAAAAAAMKAAAAAA' AND p_discount_active = 'N' GROUP BY w_state, p_promo_id, p_discount_active ORDER BY total_return_amount DESC;
SELECT w_state, w_city, p_promo_name, COUNT(DISTINCT wr_order_number) AS total_returns, SUM(wr_return_quantity) AS total_returned_quantity, AVG(wr_return_amt) AS avg_return_amount, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(wr_fee) AS total_fees, SUM(wr_net_loss) AS total_net_loss FROM warehouse JOIN web_returns ON w_warehouse_sk = wr_returning_addr_sk JOIN promotion ON p_promo_sk = wr_web_page_sk WHERE w_street_name = 'Ash Laurel' AND p_channel_catalog = 'N' AND p_channel_press = 'N' AND wr_account_credit IN ('618.25', '63.54', '2191.76', '19.59', '469.21', '464.73') GROUP BY w_state, w_city, p_promo_name ORDER BY total_net_loss DESC, w_state, w_city;
SELECT c.c_customer_sk, ca.ca_state, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(hd.hd_dep_count) AS avg_dependency_count, COUNT(DISTINCT w.w_warehouse_sk) AS number_of_warehouses, MAX(t.t_time) AS latest_time FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN inventory inv ON inv.inv_warehouse_sk = ca.ca_address_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN time_dim t ON inv.inv_date_sk = t.t_time_sk WHERE ca.ca_state IN ('TX', 'NV') AND hd.hd_vehicle_count = 2 AND t.t_sub_shift = 'night' AND c.c_birth_month IN (2, 9, 12, 4, 5) AND c.c_birth_year IN (1928, 1924) GROUP BY c.c_customer_sk, ca.ca_state ORDER BY total_inventory DESC, avg_dependency_count, number_of_warehouses, latest_time;
SELECT p.p_promo_id, p.p_promo_name, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_tickets, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_ext_discount_amt) AS avg_ticket_discount, SUM(ss.ss_net_paid) AS total_net_sales, SUM(ss.ss_net_profit) AS total_net_profit, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, CASE WHEN hd.hd_buy_potential = '0-500' THEN 'Low' WHEN hd.hd_buy_potential = '501-1000' THEN 'Below Average' WHEN hd.hd_buy_potential = '1001-5000' THEN 'Average' WHEN hd.hd_buy_potential = '5001-10000' THEN 'Above Average' WHEN hd.hd_buy_potential = '>10000' THEN 'High' ELSE 'Unknown' END AS avg_buy_potential, COUNT(DISTINCT hd.hd_income_band_sk) AS distinct_income_bands FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk LEFT JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk GROUP BY p.p_promo_id, p.p_promo_name, hd.hd_buy_potential ORDER BY total_net_sales DESC, total_net_profit DESC;
SELECT cc.cc_name, sm.sm_type, CAST(catalog_sales.cs_sold_date_sk AS INTEGER) AS sales_year, SUM(cs_quantity) AS total_quantity_sold, SUM(cs_net_paid) AS total_revenue, AVG(cs_net_profit) AS average_profit, COUNT(DISTINCT cs_order_number) AS total_orders, COUNT(DISTINCT promotion.p_promo_sk) AS total_promotions, SUM(cr_return_amount) AS total_return_amount, SUM(cr_return_quantity) AS total_return_quantity, COUNT(DISTINCT cr_order_number) AS total_return_orders FROM catalog_sales JOIN call_center cc ON catalog_sales.cs_call_center_sk = cc.cc_call_center_sk JOIN ship_mode sm ON catalog_sales.cs_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN promotion ON catalog_sales.cs_promo_sk = promotion.p_promo_sk LEFT JOIN catalog_returns ON catalog_sales.cs_item_sk = catalog_returns.cr_item_sk AND catalog_sales.cs_order_number = catalog_returns.cr_order_number WHERE cc.cc_manager IN ('Julius Durham', 'Matthew Clifton', 'Gary Colburn', 'Julius Tran') AND sm.sm_code IN ('BIKE', 'SEA', 'SURFACE') AND promotion.p_channel_press = 'N' AND catalog_returns.cr_warehouse_sk IN (1, 2) AND catalog_returns.cr_catalog_page_sk IN (366, 295) GROUP BY cc.cc_name, sm.sm_type, sales_year ORDER BY total_revenue DESC, total_orders DESC;
SELECT cs_state, SUM(cs_total_sales) AS total_sales, SUM(cr_total_returns) AS total_returns, (SUM(cs_net_profit) - SUM(cr_net_loss)) AS net_profit FROM (SELECT ca_state AS cs_state, SUM(ss_ext_sales_price) AS cs_total_sales, SUM(ss_net_profit) AS cs_net_profit FROM store_sales JOIN customer ON ss_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk GROUP BY ca_state) sales LEFT JOIN (SELECT ca_state AS cr_state, SUM(cr_return_amount) AS cr_total_returns, SUM(cr_net_loss) AS cr_net_loss FROM catalog_returns JOIN customer ON cr_returning_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk GROUP BY ca_state) returns ON sales.cs_state = returns.cr_state GROUP BY cs_state ORDER BY net_profit DESC;
SELECT ca_state, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, COUNT(*) AS return_count, SUM(ss_net_profit) AS total_store_sales_profit, AVG(ss_net_profit) AS avg_store_sales_profit, COUNT(DISTINCT ss_customer_sk) AS store_customer_count, SUM(ws_net_profit) AS total_web_sales_profit, AVG(ws_net_profit) AS avg_web_sales_profit, COUNT(DISTINCT ws_bill_customer_sk) AS web_customer_count FROM catalog_returns JOIN customer_address ON cr_returning_addr_sk = ca_address_sk JOIN store_sales ON catalog_returns.cr_item_sk = store_sales.ss_item_sk JOIN web_sales ON catalog_returns.cr_item_sk = web_sales.ws_item_sk JOIN promotion ON store_sales.ss_promo_sk = promotion.p_promo_sk AND web_sales.ws_promo_sk = promotion.p_promo_sk JOIN household_demographics ON (catalog_returns.cr_returning_hdemo_sk = household_demographics.hd_demo_sk OR store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk OR web_sales.ws_ship_hdemo_sk = household_demographics.hd_demo_sk) WHERE promotion.p_channel_demo = 'N' AND household_demographics.hd_income_band_sk IN (8, 10) AND household_demographics.hd_buy_potential IN ('>10000', 'Unknown', '0-500', '5001-10000', '1001-5000', '501-1000') AND catalog_returns.cr_reason_sk IN (9, 32, 23, 19) AND promotion.p_end_date_sk IN (2450545, 2450776) GROUP BY ca_state ORDER BY total_return_amount DESC;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_state, COUNT(wr.wr_return_amt) AS total_returns, SUM(wr.wr_return_amt) AS total_refund_amount, SUM(wr.wr_return_tax) AS total_refund_tax, AVG(wr.wr_return_amt) AS average_refund_amount FROM web_returns wr JOIN date_dim dd ON wr.wr_returned_date_sk = dd.d_date_sk JOIN customer_address ca ON wr.wr_returning_addr_sk = ca.ca_address_sk WHERE wr.wr_return_amt > 100.00 AND ca.ca_state = 'CA' GROUP BY dd.d_year, dd.d_quarter_name, dd.d_quarter_seq, ca.ca_state ORDER BY dd.d_year, dd.d_quarter_seq;
SELECT cp.cp_department, s.s_state, AVG(sr.sr_net_loss) AS avg_net_loss, AVG(s.s_floor_space) AS avg_store_floor_space, AVG(sr.sr_return_quantity) AS avg_items_returned FROM store_returns sr INNER JOIN store s ON sr.sr_store_sk = s.s_store_sk INNER JOIN catalog_page cp ON s.s_market_id = cp.cp_catalog_number INNER JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk WHERE s.s_rec_end_date IS NULL AND ca.ca_location_type = 'condo' AND s.s_company_id = 1 GROUP BY cp.cp_department, s.s_state ORDER BY avg_net_loss DESC, avg_store_floor_space DESC, avg_items_returned DESC LIMIT 10;
SELECT s.s_store_name, s.s_city, s.s_state, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(sr.sr_net_loss) AS total_net_loss, cd.cd_gender, cd.cd_education_status, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_page_visits, ib.ib_lower_bound, ib.ib_upper_bound FROM store_returns sr JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN web_page wp ON wp.wp_customer_sk = sr.sr_customer_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound WHERE s.s_street_type IN ('Dr.', 'Lane', 'Wy') AND s.s_market_desc IN ('Mysterious employe', 'Architects coul', 'Little expectations include yet forward meetings.') AND s.s_city IN ('Fairview', 'Midway') AND s.s_street_number IN ('337', '767', '175') AND sr.sr_reversed_charge IN ('17.91', '2.40', '5.43') AND sr.sr_return_time_sk IN ('55806', '33650', '38681') AND sr.sr_net_loss IN ('386.38', '1608.66', '1058.95') AND sr.sr_reason_sk IN ('1', '3', '23') AND cd.cd_gender IN ('F', 'M') AND cd.cd_purchase_estimate IN ('9000', '5500', '4000') AND wp.wp_web_page_id IN ('AAAAAAAAKDAAAAAA', 'AAAAAAAAACAAAAAA', 'AAAAAAAAMBAAAAAA') AND wp.wp_url = 'http://www.foo.com' AND wp.wp_autogen_flag IN ('N', 'Y') AND ib.ib_income_band_sk IN ('18', '7', '2') GROUP BY s.s_store_name, s.s_city, s.s_state, cd.cd_gender, cd.cd_education_status, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_net_loss DESC, total_returns DESC, s.s_store_name, cd.cd_gender;
SELECT cp_type, sm_type, w_city, w_state, SUM(cs_sales_price) AS total_sales, COUNT(DISTINCT cs_order_number) AS number_of_sales_orders, SUM(cr_return_amount) AS total_returns, COUNT(DISTINCT cr_order_number) AS number_of_return_orders, (SUM(cs_sales_price) - SUM(cr_return_amount)) AS net_sales, AVG(cs_sales_price) AS average_sales_price, CASE WHEN SUM(cs_sales_price) > 0 THEN SUM(cr_return_amount) / SUM(cs_sales_price) ELSE 0 END AS return_rate FROM catalog_sales JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk LEFT JOIN catalog_returns ON cs_order_number = cr_order_number GROUP BY cp_type, sm_type, w_city, w_state ORDER BY cp_type, sm_type, w_city, w_state;
SELECT cc.cc_name, cc.cc_manager, c.cd_education_status, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, COUNT(DISTINCT c.cd_demo_sk) AS number_of_unique_customers FROM store_sales ss JOIN call_center cc ON ss.ss_store_sk = cc.cc_call_center_sk JOIN customer_demographics c ON ss.ss_cdemo_sk = c.cd_demo_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk JOIN catalog_page cp ON ss.ss_promo_sk = cp.cp_catalog_page_sk WHERE cc.cc_manager IN ('Larry Mccray', 'Felipe Perkins') AND cp.cp_type IN ('bi-annual', 'monthly', 'quarterly') AND t.t_hour BETWEEN 0 AND 1 AND c.cd_dep_college_count = 0 AND ss.ss_sold_date_sk IS NOT NULL GROUP BY cc.cc_name, cc.cc_manager, c.cd_education_status ORDER BY total_quantity_sold DESC, average_sales_price DESC;
SELECT c.c_first_name, c.c_last_name, c.c_birth_country, c.c_email_address, COUNT(sr.sr_return_quantity) AS total_returns, SUM(sr.sr_return_amt) AS total_return_amt, AVG(sr.sr_return_amt) AS avg_return_amt, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_return_ship_cost) AS total_ship_cost, SUM(sr.sr_net_loss) AS total_net_loss, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_carrier FROM customer c JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN income_band ib ON c.c_current_cdemo_sk = ib.ib_income_band_sk JOIN ship_mode sm ON sm.sm_ship_mode_id = 'AAAAAAAABBAAAAAA' WHERE c.c_preferred_cust_flag = 'Y' GROUP BY c.c_first_name, c.c_last_name, c.c_birth_country, c.c_email_address, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_carrier ORDER BY total_return_amt DESC;
SELECT state, item_category, SUM(total_sales_amount) AS total_sales_amount, SUM(total_return_amount) AS total_return_amount, AVG(avg_net_loss_per_return) AS avg_net_loss_per_return FROM ( SELECT web_site.web_state AS state, i.i_category AS item_category, SUM(ws.ws_sales_price) AS total_sales_amount, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_net_loss) AS avg_net_loss_per_return FROM web_sales ws INNER JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk INNER JOIN web_site ON ws.ws_web_site_sk = web_site.web_site_sk INNER JOIN item i ON ws.ws_item_sk = i.i_item_sk WHERE web_site.web_state IN ('TN') GROUP BY web_site.web_state, i.i_category UNION ALL SELECT 'Catalog' AS state, i.i_category AS item_category, 0 AS total_sales_amount, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_net_loss) AS avg_net_loss_per_return FROM catalog_returns cr INNER JOIN item i ON cr.cr_item_sk = i.i_item_sk GROUP BY i.i_category ) AS combined_results GROUP BY state, item_category ORDER BY state, item_category;
SELECT c.c_first_name, c.c_last_name, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_returns, SUM(cr.cr_return_amount) AS sum_catalog_returns, AVG(cr.cr_return_amount) AS avg_catalog_returns, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, SUM(sr.sr_return_amt) AS sum_store_returns, AVG(sr.sr_return_amt) AS avg_store_returns, COUNT(DISTINCT wr.wr_order_number) AS total_web_returns, SUM(wr.wr_return_amt) AS sum_web_returns, AVG(wr.wr_return_amt) AS avg_web_returns, SUM(cr.cr_return_amount + sr.sr_return_amt + wr.wr_return_amt) AS total_returned_amount, SUM(cr.cr_net_loss + sr.sr_net_loss + wr.wr_net_loss) AS total_net_loss FROM customer c LEFT JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_refunded_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_refunded_customer_sk WHERE (cr.cr_refunded_addr_sk = 22501 OR sr.sr_customer_sk = 76655 OR wr.wr_returning_addr_sk IN (28032, 35974, 28752, 35185)) AND wr.wr_net_loss IN ('349.19', '1875.35', '119.73', '151.90', '2317.12', '1172.86') AND cr.cr_store_credit IN ('43.17', '27.97', '302.61', '30.81', '19.81', '561.19') AND EXISTS (SELECT 1 FROM web_page wp WHERE wp.wp_type = 'order' AND wp.wp_web_page_sk = wr.wr_web_page_sk) GROUP BY c.c_first_name, c.c_last_name ORDER BY total_returned_amount DESC, total_net_loss DESC;
