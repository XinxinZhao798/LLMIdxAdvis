SELECT CAST(SUBSTRING(CAST(cr.cr_returned_date_sk AS VARCHAR), 1, 4) AS INTEGER) AS return_year, CAST(SUBSTRING(CAST(cr.cr_returned_date_sk AS VARCHAR), 5, 2) AS INTEGER) AS return_month, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_customers, COUNT(*) AS total_returns, SUM(p.p_cost) AS promotion_cost, s.s_store_name, s.s_city FROM catalog_returns cr JOIN promotion p ON cr.cr_item_sk = p.p_item_sk JOIN store s ON s.s_store_sk = cr.cr_returning_addr_sk WHERE CAST(SUBSTRING(CAST(cr.cr_returned_date_sk AS VARCHAR), 1, 4) AS INTEGER) = 2023 AND s.s_number_employees BETWEEN 200 AND 300 AND s.s_store_id IN ('AAAAAAAABAAAAAAA', 'AAAAAAAAHAAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAAKAAAAAAA', 'AAAAAAAAEAAAAAAA') AND cr.cr_refunded_addr_sk = 30891 AND p.p_channel_press = 'N' GROUP BY return_year, return_month, s.s_store_name, s.s_city ORDER BY total_return_amount DESC, s.s_store_name, s.s_city;
SELECT w_state, w_city, p_promo_name, COUNT(DISTINCT wr_order_number) AS total_returns, SUM(wr_return_quantity) AS total_returned_quantity, AVG(wr_return_amt) AS avg_return_amount, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(wr_fee) AS total_fees, SUM(wr_net_loss) AS total_net_loss FROM warehouse JOIN web_returns ON w_warehouse_sk = wr_returning_addr_sk JOIN promotion ON p_promo_sk = wr_web_page_sk WHERE w_street_name = 'Ash Laurel' AND p_channel_catalog = 'N' AND p_channel_press = 'N' AND wr_account_credit IN ('618.25', '63.54', '2191.76', '19.59', '469.21', '464.73') GROUP BY w_state, w_city, p_promo_name ORDER BY total_net_loss DESC, w_state, w_city;
SELECT ca.ca_state, ca.ca_city, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(ws.ws_quantity) AS total_items_sold, AVG(ws.ws_net_paid) AS average_net_paid_per_sale, SUM(ws.ws_net_profit) AS total_net_profit, COUNT(DISTINCT ws.ws_promo_sk) AS distinct_promotions_used FROM customer_address ca JOIN customer c ON c.c_current_addr_sk = ca.ca_address_sk JOIN web_sales ws ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk WHERE ca.ca_country = 'United States' AND p.p_channel_details IN ('Signs hear moreover nations. There perfect', 'Regional schemes would devise even loc') AND p.p_response_target = 1 AND ws.ws_sales_price > 0 GROUP BY ca.ca_state, ca.ca_city ORDER BY total_net_profit DESC, ca.ca_state, ca.ca_city;
SELECT dd.d_year, dd.d_quarter_name, COUNT(DISTINCT cr.cr_order_number) AS catalog_return_orders, SUM(cr.cr_return_quantity) AS total_catalog_returned_qty, AVG(cr.cr_return_amount) AS avg_catalog_return_amount, SUM(cr.cr_net_loss) AS total_catalog_net_loss, COUNT(DISTINCT wr.wr_order_number) AS web_return_orders, SUM(wr.wr_return_quantity) AS total_web_returned_qty, AVG(wr.wr_return_amt) AS avg_web_return_amount, SUM(wr.wr_net_loss) AS total_web_net_loss, COUNT(DISTINCT h.hd_demo_sk) AS unique_households_affected, SUM(CASE WHEN i.i_rec_end_date = '2001-10-26' THEN cr.cr_return_quantity ELSE 0 END) AS qty_items_end_date_oct26 FROM date_dim dd LEFT JOIN catalog_returns cr ON dd.d_date_sk = cr.cr_returned_date_sk LEFT JOIN web_returns wr ON dd.d_date_sk = wr.wr_returned_date_sk LEFT JOIN item i ON cr.cr_item_sk = i.i_item_sk OR wr.wr_item_sk = i.i_item_sk LEFT JOIN household_demographics h ON cr.cr_returning_hdemo_sk = h.hd_demo_sk OR wr.wr_returning_hdemo_sk = h.hd_demo_sk WHERE dd.d_date IS NOT NULL AND (cr.cr_return_amount > 0 OR wr.wr_return_amt > 0) AND (cr.cr_reason_sk = 28 OR wr.wr_reason_sk = 28) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT c_birth_country, cd_gender, cd_marital_status, cd_education_status, AVG(cd_purchase_estimate) AS avg_purchase_estimate, COUNT(DISTINCT c_customer_sk) AS total_customers, SUM(inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT wr_order_number) AS total_returns, AVG(wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(wr_fee) AS total_return_fees FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN inventory inv ON inv.inv_date_sk = '2450815' JOIN web_returns wr ON wr.wr_refunded_customer_sk = c.c_customer_sk JOIN web_page wp ON wp.wp_web_page_sk = wr.wr_web_page_sk AND wp.wp_max_ad_count IN ('0', '1') JOIN time_dim t ON t.t_time_sk = wr.wr_returned_time_sk AND t.t_time_id IN ('AAAAAAAALDIAAAAA', 'AAAAAAAAPEJAAAAA', 'AAAAAAAAKMNAAAAA', 'AAAAAAAAIHFAAAAA', 'AAAAAAAAOEBBAAAA', 'AAAAAAAALNDAAAAA') JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk WHERE cd.cd_marital_status IN ('D', 'M', 'U', 'S', 'W') AND cd.cd_gender = 'M' GROUP BY c_birth_country, cd_gender, cd_marital_status, cd_education_status ORDER BY avg_purchase_estimate DESC, total_customers DESC LIMIT 100;
SELECT s.s_division_id, s.s_division_name, sm.sm_type, AVG(i.i_current_price) AS avg_item_price, COUNT(DISTINCT i.i_item_sk) AS total_items_sold, SUM(i.i_current_price) AS total_sales FROM item i JOIN store s ON i.i_manufact_id = s.s_store_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = s.s_store_sk WHERE i.i_item_id IN ('AAAAAAAABPCBAAAA', 'AAAAAAAAKEPAAAAA', 'AAAAAAAAHIBAAAAA') AND sm.sm_type IN ('EXPRESS', 'TWO DAY', 'NEXT DAY') AND sm.sm_ship_mode_id IN ('AAAAAAAALAAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAACBAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAABAAAAAAA') AND i.i_rec_start_date BETWEEN '1997-01-01' AND '2001-12-31' AND s.s_rec_start_date BETWEEN '1997-01-01' AND '2001-12-31' GROUP BY s.s_division_id, s.s_division_name, sm.sm_type ORDER BY s.s_division_id, sm.sm_type;
SELECT cc_state, SUM(sr_return_amt) AS total_return_amt, AVG(sr_return_amt) AS avg_return_amt, COUNT(*) AS num_returns, SUM(ss_net_profit) AS total_net_profit, AVG(ss_net_profit) AS avg_net_profit, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(wr_return_ship_cost) AS total_return_ship_cost, AVG(wr_return_ship_cost) AS avg_return_ship_cost, COUNT(DISTINCT wr_refunded_customer_sk) AS unique_returned_customers FROM call_center JOIN store_returns ON sr_store_sk = cc_call_center_sk JOIN store_sales ON ss_store_sk = cc_call_center_sk AND store_returns.sr_ticket_number = store_sales.ss_ticket_number JOIN web_returns ON wr_returning_addr_sk = sr_addr_sk WHERE cc_rec_start_date <= CURRENT_DATE AND (cc_rec_end_date IS NULL OR cc_rec_end_date > CURRENT_DATE) AND sr_hdemo_sk IN ('1110', '6655', '2958', '2489', '5750', '5814') AND sr_return_quantity = 36 AND wr_return_ship_cost IN ('460.94', '104.34', '381.68', '830.90') AND wr_returned_time_sk IN ('77442', '66455', '78336', '60895', '70221') AND ss_coupon_amt IN ('1615.93', '743.42') AND ss_net_profit IN ('-1410.96', '-564.39', '-55.72') GROUP BY cc_state ORDER BY total_return_amt DESC;
