SELECT d_year, d_moy, c.c_last_name, cd.cd_education_status, cd.cd_marital_status, COUNT(*) AS customer_count, SUM(cd.cd_purchase_estimate) AS total_purchase_estimate, AVG(cd.cd_dep_count) AS average_dependents, AVG(cd.cd_dep_employed_count) AS average_employed_dependents, AVG(cd.cd_dep_college_count) AS average_college_dependents FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN date_dim d ON c.c_first_sales_date_sk = d.d_date_sk WHERE c.c_first_sales_date_sk IN (2449879, 2452004, 2451328, 2452389, 2450342, 2449052) AND c.c_last_name IN ('Searcy', 'Joyner', 'Livingston', 'Wise', 'Webb', 'Branch') AND cd.cd_marital_status IN ('S', 'U', 'W', 'M') AND cd.cd_education_status = 'Advanced Degree' AND d.d_last_dom IN ('2417090', '2415990') GROUP BY d_year, d_moy, c.c_last_name, cd.cd_education_status, cd.cd_marital_status ORDER BY d_year DESC, d_moy DESC, c.c_last_name;
SELECT ws.web_site_id, ws.web_class, ws.web_name, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(wr.wr_refunded_cash) AS total_refunded_cash, SUM(sr.sr_return_quantity) AS store_total_returned_quantity, AVG(sr.sr_return_amt_inc_tax) AS store_avg_return_amount_inc_tax, SUM(sr.sr_refunded_cash) AS store_total_refunded_cash FROM web_site ws JOIN web_page wp ON ws.web_site_sk = wp.wp_web_page_sk JOIN web_returns wr ON wp.wp_web_page_sk = wr.wr_web_page_sk LEFT JOIN store_returns sr ON wr.wr_item_sk = sr.sr_item_sk AND wr.wr_refunded_customer_sk = sr.sr_customer_sk WHERE ws.web_class = 'Unknown' AND ws.web_rec_end_date IN ('2001-08-15', '2000-08-15', '1999-08-16') AND wp.wp_rec_start_date IN ('2000-09-03', '2001-09-03', '1997-09-03') AND wp.wp_link_count IN (7, 11, 19) AND wr.wr_return_amt_inc_tax IN (43.31, 378.40, 532.83) AND wr.wr_refunded_cash IN (2425.04, 1694.98, 8.69) AND sr.sr_customer_sk IN (38344, 71012, 20816) AND sr.sr_cdemo_sk IN (1443482, 746161, 1430182) GROUP BY ws.web_site_id, ws.web_class, ws.web_name ORDER BY total_returns DESC, total_refunded_cash DESC;
SELECT d.d_year, d.d_quarter_name, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(wp.wp_link_count) AS avg_link_count, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS preferred_customers_count, SUM(CASE WHEN d.d_holiday = 'Y' THEN 1 ELSE 0 END) AS holiday_count FROM date_dim d JOIN customer c ON c.c_first_sales_date_sk = d.d_date_sk JOIN inventory inv ON inv.inv_date_sk = d.d_date_sk JOIN web_page wp ON wp.wp_access_date_sk = d.d_date_sk WHERE d.d_year = 2021 GROUP BY d.d_year, d.d_quarter_name ORDER BY d.d_year, d.d_quarter_name;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_class, ca.ca_street_type, COUNT(distinct ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_net_paid, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(distinct ss.ss_customer_sk) AS unique_customers_served FROM store_sales ss JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk JOIN call_center cc ON cc.cc_class IN ('small', 'medium', 'large') LEFT JOIN reason r ON r.r_reason_desc = 'reason 31' WHERE ca.ca_street_type IN ('Pkwy', 'Court') AND r.r_reason_sk IS NULL GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_class, ca.ca_street_type ORDER BY total_net_profit DESC, total_sales_transactions DESC;
SELECT sm.sm_type AS shipping_type, i.i_category AS item_category, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_refunded_amount, AVG(cr.cr_return_amount) AS average_refund_amount FROM catalog_returns cr JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk WHERE cr.cr_returned_date_sk IS NOT NULL AND sm.sm_type IN ('NEXT DAY', 'TWO DAY', 'EXPRESS') AND i.i_category IN ('Electronics', 'Clothing', 'Furniture') GROUP BY sm.sm_type, i.i_category ORDER BY total_refunded_amount DESC, total_returns DESC, average_refund_amount DESC;
SELECT cp_department, i_category, AVG(i_current_price) AS average_price, SUM(i_wholesale_cost) AS total_wholesale_cost, COUNT(DISTINCT i_item_sk) AS item_count, COUNT(DISTINCT cp_catalog_page_sk) AS page_count, AVG(ib_upper_bound - ib_lower_bound) AS average_income_band_range FROM catalog_page JOIN item ON cp_catalog_page_id = i_item_id JOIN income_band ON i_size::integer = ib_income_band_sk WHERE cp_start_date_sk IS NOT NULL AND cp_end_date_sk IS NOT NULL AND i_rec_start_date <= CURRENT_DATE AND (i_rec_end_date IS NULL OR i_rec_end_date >= CURRENT_DATE) AND ib_lower_bound >= 20000 AND cp_department IN ('Electronics', 'Clothing', 'Home Goods') GROUP BY cp_department, i_category ORDER BY average_price DESC, total_wholesale_cost DESC;
SELECT d.d_year AS year, d.d_moy AS month, SUM(s.sr_return_amt_inc_tax) AS total_returns_amount, AVG(s.sr_return_amt_inc_tax) AS avg_returns_amount, COUNT(s.sr_ticket_number) AS return_count, SUM(i.inv_quantity_on_hand) AS total_inventory_quantity, AVG(i.inv_quantity_on_hand) AS avg_inventory_quantity FROM date_dim d LEFT JOIN store_returns s ON d.d_date_sk = s.sr_returned_date_sk LEFT JOIN inventory i ON d.d_date_sk = i.inv_date_sk WHERE d.d_year = 2023 GROUP BY d.d_year, d.d_moy ORDER BY d.d_year, d.d_moy;
SELECT cd.cd_education_status, hd.hd_income_band_sk, COUNT(*) AS total_sales, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_net_profit) AS average_net_profit FROM web_sales ws JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk WHERE cd.cd_marital_status = 'M' AND hd.hd_dep_count >= 2 AND wp.wp_type LIKE 'review%' AND ws.ws_net_profit > 0 GROUP BY cd.cd_education_status, hd.hd_income_band_sk ORDER BY total_net_profit DESC, average_net_profit DESC;
SELECT wsit.web_name AS website_name, wsit.web_class AS website_class, wsit.web_manager AS website_manager, cc.cc_name AS call_center_name, cc.cc_manager AS call_center_manager, SUM(cs.cs_net_paid) AS total_catalog_sales, AVG(cs.cs_net_paid) AS avg_catalog_sales, COUNT(DISTINCT cs.cs_order_number) AS total_catalog_orders, SUM(ws.ws_net_paid) AS total_web_sales, AVG(ws.ws_net_paid) AS avg_web_sales, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders FROM web_sales ws JOIN web_site wsit ON ws.ws_web_site_sk = wsit.web_site_sk LEFT JOIN catalog_sales cs ON ws.ws_order_number = cs.cs_order_number LEFT JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk WHERE wsit.web_country = 'United States' AND (cc.cc_division_name IN ('anti', 'ought', 'pri', 'ese') OR cc.cc_division_name IS NULL) GROUP BY wsit.web_name, wsit.web_class, wsit.web_manager, cc.cc_name, cc.cc_manager ORDER BY total_catalog_sales DESC, total_web_sales DESC;
SELECT s.s_store_name, count(distinct ss.ss_ticket_number) as total_sales_transactions, sum(ss.ss_quantity) as total_items_sold, sum(ss.ss_net_paid_inc_tax) as total_sales_revenue, sum(cr.cr_return_quantity) as total_items_returned, sum(cr.cr_return_amt_inc_tax) as total_returned_revenue, sum(inv.inv_quantity_on_hand) as total_inventory_quantity FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk LEFT JOIN catalog_returns cr ON ss.ss_item_sk = cr.cr_item_sk AND ss.ss_ticket_number = cr.cr_order_number LEFT JOIN inventory inv ON ss.ss_item_sk = inv.inv_item_sk WHERE s.s_country = 'United States' AND (inv.inv_item_sk = 12400 OR inv.inv_item_sk = 10369 OR inv.inv_item_sk = 8875) AND (ss.ss_ext_list_price = 5535.38 OR ss.ss_ext_list_price = 6147.90 OR ss.ss_ext_list_price = 8470.00 OR ss.ss_ext_list_price = 4720.95 OR ss.ss_ext_list_price = 5696.87 OR ss.ss_ext_list_price = 37.40) AND (cr.cr_return_tax = 123.73 OR cr.cr_return_tax = 44.47 OR cr.cr_return_tax = 115.68 OR cr.cr_return_tax = 4.37) GROUP BY s.s_store_name;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, hd.hd_buy_potential, hd.hd_dep_count, AVG(wr.wr_return_amt) AS avg_return_amount, AVG(wr.wr_return_tax) AS avg_return_tax, AVG(wr.wr_net_loss) AS avg_net_loss, COUNT(*) AS return_count FROM web_returns wr JOIN household_demographics hd ON wr.wr_returning_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN warehouse w ON wr.wr_returning_addr_sk = w.w_warehouse_sk WHERE w.w_city = 'Fairview' AND w.w_country = 'United States' AND hd.hd_buy_potential IN ('501-1000', '5001-10000', '0-500', '1001-5000', '>10000') GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, hd.hd_buy_potential, hd.hd_dep_count ORDER BY ib.ib_income_band_sk, hd.hd_buy_potential, hd.hd_dep_count;
SELECT cc.cc_name AS call_center_name, cc.cc_city AS city, cc.cc_state AS state, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_return_quantity) AS total_returned_items, COUNT(DISTINCT cr.cr_returned_date_sk) AS days_with_returns, SUM(cr.cr_return_amt_inc_tax - cr.cr_return_amount) AS total_tax_collected, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_customers_refunded, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_customers_returning, SUM(CASE WHEN cd.cd_marital_status = 'U' THEN 1 ELSE 0 END) AS unmarried_customers, SUM(CASE WHEN cd.cd_marital_status = 'D' THEN 1 ELSE 0 END) AS divorced_customers, SUM(CASE WHEN cd.cd_marital_status = 'W' THEN 1 ELSE 0 END) AS widowed_customers FROM call_center cc JOIN catalog_returns cr ON cc.cc_call_center_sk = cr.cr_call_center_sk JOIN customer_demographics cd ON cd.cd_demo_sk = cr.cr_refunded_cdemo_sk OR cd.cd_demo_sk = cr.cr_returning_cdemo_sk WHERE cc_rec_end_date IS NULL GROUP BY call_center_name, city, state ORDER BY total_return_amount DESC LIMIT 100;
SELECT p.p_promo_name, p.p_channel_details, cp.cp_department, w.w_state, AVG(ws_net_profit) AS avg_web_sales_profit, AVG(wr_net_loss) AS avg_web_returns_loss, SUM(ws_quantity) AS total_quantity_sold, COUNT(DISTINCT ws_web_page_sk) AS count_unique_pages_sold, COUNT(DISTINCT wr_web_page_sk) AS count_unique_pages_returned FROM promotion p JOIN web_sales ws ON p.p_promo_sk = ws.ws_promo_sk JOIN catalog_page cp ON ws.ws_web_page_sk = cp.cp_catalog_page_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk LEFT JOIN web_returns wr ON ws.ws_item_sk = wr.wr_item_sk AND ws.ws_order_number = wr.wr_order_number WHERE cp.cp_start_date_sk BETWEEN '2450906' AND '2451420' AND cp.cp_end_date_sk BETWEEN '2451419' AND '2451664' AND (wr.wr_returned_date_sk IS NULL OR wr.wr_returned_date_sk BETWEEN ws_sold_date_sk AND ws_sold_date_sk + 30) GROUP BY p.p_promo_name, p.p_channel_details, cp.cp_department, w.w_state ORDER BY avg_web_sales_profit DESC, avg_web_returns_loss DESC;
SELECT i.i_category, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(wr.wr_return_quantity) AS total_quantity_returned, SUM(wr.wr_return_amt) AS total_return_amount, AVG(inv.inv_quantity_on_hand) AS average_inventory_on_hand FROM item i LEFT JOIN store_sales ss ON ss.ss_item_sk = i.i_item_sk LEFT JOIN web_returns wr ON wr.wr_item_sk = i.i_item_sk LEFT JOIN inventory inv ON inv.inv_item_sk = i.i_item_sk WHERE i.i_category IN ('Electronics', 'Clothing', 'Furniture') AND ss.ss_sold_date_sk BETWEEN 2451453 AND 2451553 AND wr.wr_returned_date_sk BETWEEN 2451453 AND 2451553 AND inv.inv_date_sk BETWEEN 2451453 AND 2451553 GROUP BY i.i_category ORDER BY total_quantity_sold DESC;
SELECT s.s_division_id, s.s_division_name, sm.sm_type, AVG(i.i_current_price) AS avg_item_price, COUNT(DISTINCT i.i_item_sk) AS total_items_sold, SUM(i.i_current_price) AS total_sales FROM item i JOIN store s ON i.i_manufact_id = s.s_store_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = s.s_store_sk WHERE i.i_item_id IN ('AAAAAAAABPCBAAAA', 'AAAAAAAAKEPAAAAA', 'AAAAAAAAHIBAAAAA') AND sm.sm_type IN ('EXPRESS', 'TWO DAY', 'NEXT DAY') AND sm.sm_ship_mode_id IN ('AAAAAAAALAAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAACBAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAABAAAAAAA') AND i.i_rec_start_date BETWEEN '1997-01-01' AND '2001-12-31' AND s.s_rec_start_date BETWEEN '1997-01-01' AND '2001-12-31' GROUP BY s.s_division_id, s.s_division_name, sm.sm_type ORDER BY s.s_division_id, sm.sm_type;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, td.t_am_pm, AVG(ws.ws_sales_price) AS avg_sales_price, SUM(ws.ws_quantity) AS total_sales_quantity, SUM(wr.wr_return_quantity) AS total_return_quantity, SUM(wr.wr_net_loss) AS total_net_loss FROM web_sales ws JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND td.t_time_sk = wr.wr_returned_time_sk WHERE td.t_am_pm = 'AM' GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, td.t_am_pm ORDER BY ib.ib_income_band_sk, td.t_am_pm;
