SELECT cp.cp_department, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages, COUNT(DISTINCT sm.sm_ship_mode_sk) AS num_ship_modes, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, SUM(CASE WHEN p.p_channel_event = 'N' THEN p.p_cost ELSE 0 END) AS total_promo_cost_no_event, COUNT(DISTINCT r.r_reason_sk) AS num_reasons, MAX(t.t_time) AS max_time FROM catalog_page cp JOIN promotion p ON cp.cp_catalog_page_sk = p.p_item_sk LEFT JOIN ship_mode sm ON sm.sm_code = cp.cp_type LEFT JOIN reason r ON r.r_reason_desc = cp.cp_description LEFT JOIN household_demographics hd ON hd.hd_income_band_sk = cp.cp_catalog_number LEFT JOIN time_dim t ON t.t_time_sk = cp.cp_start_date_sk WHERE cp.cp_end_date_sk IN (2451817, 2450905, 2450904) AND cp.cp_department = 'DEPARTMENT' AND p.p_promo_sk IN (205, 11, 114) AND p.p_cost >= 1000.00 AND p.p_purpose = 'Unknown' AND p.p_channel_event = 'N' AND r.r_reason_desc IN ('Wrong size', 'duplicate purchase', 'reason 31') AND r.r_reason_sk IN (19, 14, 6) AND r.r_reason_id IN ('AAAAAAAAHBAAAAAA', 'AAAAAAAAPBAAAAAA', 'AAAAAAAAMAAAAAAA') AND hd.hd_vehicle_count IN (1, 4, 3) AND hd.hd_dep_count IN (0, 3, 7) AND t.t_time IN (325, 4624, 1921) AND t.t_time_id IN ('AAAAAAAANDCBAAAA', 'AAAAAAAAILGAAAAA', 'AAAAAAAAACNAAAAA') AND sm.sm_code IN ('SEA', 'AIR', 'BIKE') AND sm.sm_contract IN ('P7FBIt8yd', 'O9V6oF8RJnLMmZYd1', 'Ek') AND sm.sm_ship_mode_id IN ('AAAAAAAADBAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAAEAAAAAAA') GROUP BY cp.cp_department ORDER BY num_catalog_pages DESC, total_promo_cost_no_event DESC;
SELECT dd.d_year, dd.d_qoy, cc.cc_name, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(cs_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk WHERE cc.cc_name = 'North Midwest' AND dd.d_year = 2003 GROUP BY dd.d_year, dd.d_qoy, cc.cc_name ORDER BY dd.d_year, dd.d_qoy, cc.cc_name;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_state, COUNT(cp.cp_catalog_page_sk) AS num_catalog_pages, AVG(dd.d_dom) AS avg_day_of_month, SUM(CASE WHEN dd.d_holiday = 'Y' THEN 1 ELSE 0 END) AS num_holidays, SUM(CASE WHEN dd.d_weekend = 'Y' THEN 1 ELSE 0 END) AS num_weekend_days FROM date_dim dd JOIN catalog_page cp ON dd.d_date_sk BETWEEN cp.cp_start_date_sk AND cp.cp_end_date_sk JOIN customer_address ca ON ca.ca_zip = SUBSTRING(cp.cp_description FROM 1 FOR 10) WHERE dd.d_year IN (1910, 1912, 1908, 1905) AND dd.d_dow IN ('6', '0', '4', '1') AND ca.ca_country = 'United States' AND dd.d_dom BETWEEN 1 AND 15 GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state ORDER BY dd.d_year, dd.d_quarter_name, ca.ca_state;
SELECT cc.cc_state, cc.cc_city, cc.cc_name, AVG(ss.ss_net_profit) AS avg_net_profit, SUM(ss.ss_quantity) AS total_quantity_sold, COUNT(DISTINCT ss.ss_store_sk) AS number_of_stores, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(cc.cc_employees) AS total_employees_in_call_centers, AVG(cc.cc_tax_percentage) AS avg_tax_percentage_by_state FROM store_sales ss JOIN call_center cc ON ss.ss_store_sk = cc.cc_call_center_sk JOIN time_dim td ON ss.ss_sold_time_sk = td.t_time_sk WHERE ss.ss_sold_date_sk IN (SELECT inv_date_sk FROM inventory WHERE inv_quantity_on_hand IN (816, 142, 984)) AND cc.cc_tax_percentage IN (0.01, 0.12, 0.05, 0.11) AND ss.ss_net_profit IN (5.76, 45.76, 66.12, -885.72, -4074.40) AND ss.ss_hdemo_sk IN (7132, 594, 6065, 5700) GROUP BY cc.cc_state, cc.cc_city, cc.cc_name ORDER BY avg_net_profit DESC;
SELECT c.c_customer_id, p.p_promo_name, SUM(cs.cs_net_profit) AS total_catalog_net_profit, AVG(cs.cs_sales_price) AS avg_catalog_sales_price, COUNT(DISTINCT cs.cs_order_number) AS num_of_catalog_orders, SUM(ws.ws_net_profit) AS total_web_net_profit, AVG(ws.ws_sales_price) AS avg_web_sales_price, COUNT(DISTINCT ws.ws_order_number) AS num_of_web_orders FROM customer c INNER JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk INNER JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk INNER JOIN promotion p ON (cs.cs_promo_sk = p.p_promo_sk AND ws.ws_promo_sk = p.p_promo_sk) WHERE c.c_preferred_cust_flag = 'Y' AND (cs.cs_sold_date_sk = 2450827 OR cs.cs_sold_date_sk = 2450822) AND (p.p_channel_demo = 'N') AND (ws.ws_web_page_sk IN (SELECT wp_web_page_sk FROM web_page WHERE wp_customer_sk IN (1898, 16769))) GROUP BY c.c_customer_id, p.p_promo_name ORDER BY total_catalog_net_profit DESC, total_web_net_profit DESC;
SELECT cd.cd_gender, cd.cd_marital_status, s.s_state, COUNT(wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount, AVG(wr.wr_return_amt_inc_tax) AS average_return_amount, AVG(wr.wr_fee) AS average_fee FROM web_returns wr JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk JOIN store s ON wr.wr_returning_addr_sk = s.s_store_sk WHERE wr.wr_returning_addr_sk IN (38908, 38512, 43731, 22184, 44035) AND wr.wr_refunded_hdemo_sk IN (3650, 1143, 1326, 7105) AND s.s_state = 'CA' GROUP BY cd.cd_gender, cd.cd_marital_status, s.s_state ORDER BY total_return_amount DESC, total_returns DESC;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN household_demographics hd ON cs.cs_ship_hdemo_sk = hd.hd_demo_sk WHERE cc.cc_sq_ft IN ('4134', '795', '1138', '649') AND hd.hd_income_band_sk IN ('9', '18', '5', '14', '12') AND hd.hd_vehicle_count IN ('3', '1', '0', '4', '2') GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_net_profit DESC, total_orders DESC, cc.cc_name;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, AVG(cc.cc_employees) AS average_employee_count, SUM(cc.cc_sq_ft) AS total_call_center_sq_ft, COUNT(DISTINCT w.w_warehouse_sk) AS number_of_warehouses, AVG(w.w_warehouse_sq_ft) AS average_warehouse_sq_ft, SUM(wp.wp_link_count) AS total_web_page_link_count, COUNT(DISTINCT cp.cp_catalog_page_sk) AS number_of_catalog_pages FROM call_center cc LEFT JOIN warehouse w ON cc.cc_city = w.w_city AND cc.cc_state = w.w_state LEFT JOIN web_page wp ON wp.wp_url LIKE '%' || cc.cc_state || '%' LEFT JOIN catalog_page cp ON cc.cc_division = cp.cp_catalog_number WHERE cc.cc_class IN ('small', 'medium', 'large') AND wp.wp_autogen_flag = 'N' AND cp.cp_start_date_sk IN ('2451636', '2451271') AND w.w_suite_number = 'Suite 0' AND w.w_warehouse_sq_ft IN ('621234', '294242', '977787', '138504') GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_call_center_sq_ft DESC, average_employee_count DESC LIMIT 100;
SELECT ca_state, ca_city, SUM(cs_net_paid_inc_tax) AS total_sales, AVG(cs_net_paid_inc_tax) AS avg_sales, COUNT(DISTINCT cs_order_number) AS num_sales_orders, SUM(cr_return_amt_inc_tax) AS total_returns, AVG(cr_return_amt_inc_tax) AS avg_returns, COUNT(DISTINCT cr_order_number) AS num_return_orders, SUM(cr_net_loss) AS total_net_loss FROM customer_address JOIN catalog_sales ON cs_bill_addr_sk = ca_address_sk LEFT JOIN catalog_returns ON cr_order_number = cs_order_number JOIN web_sales ON ws_order_number = cs_order_number JOIN time_dim ON ws_sold_time_sk = t_time_sk JOIN web_page ON ws_web_page_sk = wp_web_page_sk WHERE t_sub_shift = 'night' AND ws_ship_date_sk = 2450935 AND ws_web_page_sk IN (41, 3, 18, 4, 45) AND wp_creation_date_sk IN (2450810, 2450808, 2450812, 2450809) GROUP BY ca_state, ca_city ORDER BY ca_state, ca_city;
SELECT c.c_customer_id AS customer_id, CONCAT(c.c_last_name, ', ', c.c_first_name) AS customer_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, hd.hd_income_band_sk, hd.hd_buy_potential, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(cr.cr_net_loss) AS total_net_loss FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_returning_customer_sk WHERE c.c_first_sales_date_sk IN (2452027, 2451966, 2450163) AND cr.cr_returned_time_sk IN (66035, 17738, 73881) AND cr.cr_return_quantity = 49 GROUP BY customer_id, customer_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, hd.hd_income_band_sk, hd.hd_buy_potential ORDER BY total_returns DESC, total_returned_quantity DESC LIMIT 100;
SELECT i.i_category, i.i_brand, w.w_state, COUNT(DISTINCT cr.cr_order_number) as total_returns, SUM(cr.cr_return_amount) as total_return_amount, AVG(cr.cr_return_amount) as avg_return_amount, SUM(cr.cr_return_quantity) as total_return_quantity, AVG(cr.cr_return_quantity) as avg_return_quantity, COUNT(DISTINCT wr.wr_order_number) as total_web_returns, SUM(wr.wr_return_amt) as total_web_return_amount, AVG(wr.wr_return_amt) as avg_web_return_amount, SUM(wr.wr_return_quantity) as total_web_return_quantity, AVG(wr.wr_return_quantity) as avg_web_return_quantity, SUM(cr.cr_refunded_cash + wr.wr_refunded_cash) as total_refunded_cash, SUM(cr.cr_return_ship_cost + wr.wr_return_ship_cost) as total_shipping_cost FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk LEFT JOIN web_returns wr ON cr.cr_item_sk = wr.wr_item_sk AND cr.cr_order_number = wr.wr_order_number GROUP BY i.i_category, i.i_brand, w.w_state ORDER BY total_returns DESC, total_return_amount DESC, total_web_returns DESC, total_web_return_amount DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(cr.cr_order_number) AS total_returns, AVG(cr.cr_return_amount) AS avg_refund_amount, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN customer_demographics cd ON cr.cr_refunded_cdemo_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk AND w.w_street_name IN ('Wilson Elm', 'Ash Laurel', '6th') JOIN time_dim t ON cr.cr_returned_time_sk = t.t_time_sk WHERE t.t_hour BETWEEN 9 AND 17 AND w.w_suite_number IN ('Suite 80', 'Suite 470', 'Suite 0') AND ib.ib_upper_bound IN (130000, 120000, 40000, 200000) GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_net_loss DESC;
SELECT ib.ib_lower_bound, ib.ib_upper_bound, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT hd.hd_demo_sk) AS unique_households, COUNT(DISTINCT cc.cc_call_center_sk) AS total_call_centers, SUM(wh.w_warehouse_sq_ft) AS total_warehouse_sq_ft FROM store_sales ss JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN call_center cc ON cc.cc_mkt_id = ss.ss_sold_date_sk JOIN warehouse wh ON wh.w_warehouse_sk = ss.ss_addr_sk WHERE hd.hd_buy_potential = '>10000' AND ib.ib_upper_bound < 150000 AND ss.ss_ext_list_price > 2100 AND cc.cc_gmt_offset = -5.00 AND cc.cc_mkt_desc LIKE 'Rich groups catch longer other fears; future,%' GROUP BY ib.ib_lower_bound, ib.ib_upper_bound;
SELECT cd.cd_education_status, d.d_year, SUM(ss_ext_sales_price) AS total_sales, AVG(ss_ext_sales_price) AS avg_sales_amount, COUNT(cr.cr_order_number) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount FROM customer_demographics cd JOIN store_sales ss ON cd.cd_demo_sk = ss.ss_cdemo_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk LEFT JOIN catalog_returns cr ON ss.ss_ticket_number = cr.cr_order_number WHERE d.d_year IN (1998, 1999, 2000) GROUP BY cd.cd_education_status, d.d_year ORDER BY cd.cd_education_status, d.d_year;
SELECT d_year, i_category, s_store_name, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS avg_sales_price, SUM(ss_net_profit) AS total_net_profit, COUNT(DISTINCT ss_customer_sk) AS unique_customers, AVG(hd_dep_count) AS avg_household_dep_count, AVG(hd_vehicle_count) AS avg_household_vehicle_count FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN item ON ss_item_sk = i_item_sk JOIN store ON ss_store_sk = s_store_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk WHERE d_year = 2001 AND i_category_id IN ('3', '7', '4', '6') AND hd_income_band_sk IN ('7', '3', '9', '15', '20', '18') GROUP BY d_year, i_category, s_store_name ORDER BY total_net_profit DESC, avg_sales_price DESC LIMIT 100;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, ib.ib_income_band_sk, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid) AS total_net_paid, AVG(ws.ws_net_profit) AS average_net_profit, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ws.ws_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(ws.ws_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax FROM call_center cc JOIN web_sales ws ON cc.cc_call_center_sk = ws.ws_web_site_sk JOIN income_band ib ON ws.ws_bill_cdemo_sk = ib.ib_income_band_sk WHERE cc.cc_rec_end_date > CURRENT_DATE AND ib.ib_lower_bound > 50000 AND ib.ib_upper_bound < 180000 AND ws.ws_list_price BETWEEN 100 AND 200 GROUP BY cc.cc_name, cc.cc_city, cc.cc_state, ib.ib_income_band_sk ORDER BY total_net_paid DESC, cc.cc_state, cc.cc_city;
SELECT w.w_warehouse_name, cp.cp_department, cd.cd_education_status, hd.hd_buy_potential, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(*) AS number_of_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_quantity) AS average_return_quantity, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_return_ship_cost) AS total_ship_cost, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN customer_demographics cd ON cr.cr_refunded_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON cr.cr_refunded_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE cr.cr_returned_date_sk BETWEEN 2450810 AND 2450820 AND cp.cp_catalog_number BETWEEN 100 AND 200 AND cr.cr_order_number IN (5410, 3479, 2, 4547, 2428, 2527) AND w.w_suite_number IN ('Suite 80', 'Suite 0', 'Suite P', 'Suite 470') AND cr.cr_refunded_hdemo_sk IN (5152, 662, 6967) AND cd.cd_credit_rating = 'Excellent' GROUP BY w.w_warehouse_name, cp.cp_department, cd.cd_education_status, hd.hd_buy_potential, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_return_amount DESC, w.w_warehouse_name, cp.cp_department;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(wr.wr_return_amt) AS total_return_amt, COUNT(DISTINCT wr.wr_order_number) AS total_returns, (SUM(ws.ws_net_paid_inc_tax) - SUM(wr.wr_return_amt_inc_tax)) AS net_sales_after_returns FROM web_sales ws LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk WHERE ws.ws_sold_date_sk BETWEEN '2451330' AND '2451329' AND cd.cd_dep_employed_count = '0' GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY total_net_paid DESC, total_returns DESC;
SELECT dd.d_year, ca.ca_state, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS order_count, SUM(cs.cs_net_paid_inc_tax) AS total_revenue_inc_tax, SUM(cs.cs_net_profit) AS total_profit FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON cs.cs_bill_addr_sk = ca.ca_address_sk JOIN store s ON ca.ca_state = s.s_state JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk WHERE dd.d_fy_year = 1912 GROUP BY dd.d_year, ca.ca_state ORDER BY total_revenue_inc_tax DESC, ca.ca_state;
SELECT cc.cc_name, i.i_category, COUNT(i.i_item_sk) AS total_items_sold, SUM(i.i_current_price) AS total_sales, AVG(i.i_wholesale_cost) AS avg_wholesale_cost FROM call_center cc JOIN item i ON cc.cc_call_center_sk = i.i_manufact_id JOIN ship_mode sm ON sm.sm_ship_mode_sk = i.i_item_sk WHERE cc.cc_rec_end_date < '2000-12-31' AND i.i_category_id IN ('4', '5', '1', '3') AND sm.sm_code = 'AIR' GROUP BY cc.cc_name, i.i_category ORDER BY cc.cc_name, i.i_category;
SELECT sm.sm_type AS shipping_mode, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, AVG(sr.sr_return_quantity) AS average_returned_quantity, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(CASE WHEN p.p_discount_active = 'Y' THEN 1 ELSE 0 END) AS promotions_with_discount, AVG(p.p_cost) AS average_promotion_cost, COUNT(DISTINCT p.p_promo_sk) AS number_of_promotions_used FROM store_returns sr JOIN promotion p ON sr.sr_item_sk = p.p_item_sk JOIN ship_mode sm ON sm.sm_type IN ('TWO DAY', 'OVERNIGHT', 'EXPRESS') JOIN time_dim t ON sr.sr_return_time_sk = t.t_time_sk WHERE sr.sr_addr_sk::text IN ('38052', '30541', '12047', '37071', '23460', '3442') AND t.t_second::text IN ('51', '12', '16', '37', '57') GROUP BY sm.sm_type ORDER BY total_return_amount DESC;
SELECT w.w_state AS warehouse_state, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_profit) AS total_net_profit, COUNT(DISTINCT cr.cr_order_number) AS total_returns, AVG(cr.cr_return_amount) AS average_return_amount FROM web_sales ws LEFT JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk LEFT JOIN catalog_returns cr ON ws.ws_item_sk = cr.cr_item_sk AND ws.ws_order_number = cr.cr_order_number WHERE ws.ws_sold_date_sk = 2450976 GROUP BY w.w_state ORDER BY total_net_profit DESC;
SELECT ca_state, sm_type, EXTRACT(YEAR FROM d_date) AS year, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk JOIN customer_address ON cs_ship_addr_sk = ca_address_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk WHERE ca_country = 'United States' AND sm_type IN ('TWO DAY', 'EXPRESS', 'OVERNIGHT') AND d_year = EXTRACT(YEAR FROM CURRENT_DATE) GROUP BY ca_state, sm_type, year ORDER BY total_net_profit DESC, ca_state, sm_type;
SELECT cd.cd_gender, cd.cd_marital_status, td.t_shift, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_units_sold, SUM(ss.ss_net_paid) AS total_revenue, AVG(ss.ss_net_paid) AS average_revenue_per_transaction, SUM(CASE WHEN p.p_channel_dmail = 'Y' THEN 1 ELSE 0 END) AS total_dmail_promotions, SUM(CASE WHEN p.p_channel_email = 'Y' THEN 1 ELSE 0 END) AS total_email_promotions, SUM(CASE WHEN p.p_channel_tv = 'Y' THEN 1 ELSE 0 END) AS total_tv_promotions FROM store_sales ss JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN time_dim td ON ss.ss_sold_time_sk = td.t_time_sk LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE ss.ss_hdemo_sk IN ('4855', '5486') GROUP BY cd.cd_gender, cd.cd_marital_status, td.t_shift ORDER BY total_revenue DESC, total_units_sold DESC;
SELECT d_year, d_quarter_name, cc_class, COUNT(DISTINCT ss_ticket_number) AS total_tickets, SUM(ss_quantity) AS total_quantity, SUM(ss_net_paid) AS total_net_paid, SUM(ss_net_paid_inc_tax) AS total_net_paid_inc_tax, AVG(ss_sales_price) AS average_sales_price, SUM(ss_net_profit) AS total_net_profit FROM store_sales JOIN date_dim ON (store_sales.ss_sold_date_sk = date_dim.d_date_sk) JOIN call_center ON (store_sales.ss_store_sk = call_center.cc_call_center_sk) WHERE store_sales.ss_customer_sk IN ('21757', '11218') GROUP BY d_year, d_quarter_name, cc_class ORDER BY d_year, d_quarter_name, cc_class;
SELECT cc.cc_name AS call_center_name, i.i_category AS item_category, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN call_center cc ON ws.ws_bill_customer_sk = cc.cc_call_center_sk JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk JOIN time_dim t ON ws.ws_sold_time_sk = t.t_time_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk WHERE cc.cc_manager IN ('Bob Belcher', 'Felipe Perkins', 'Larry Mccray', 'Mark Hightower') AND i.i_container = 'Unknown' AND ws.ws_ship_hdemo_sk IN (6862, 4638, 2050, 5884, 1108) AND d.d_year = 2023 AND t.t_am_pm = 'PM' GROUP BY call_center_name, item_category ORDER BY total_net_profit DESC;
SELECT cr_returned_date_sk AS return_date, SUM(cr_return_quantity) AS total_catalog_return_quantity, SUM(cr_return_amount) AS total_catalog_return_amount, AVG(cr_return_amount) AS avg_catalog_return_amount, COUNT(DISTINCT cr_refunded_customer_sk) AS unique_catalog_customers, SUM(sr_return_quantity) AS total_store_return_quantity, SUM(sr_return_amt) AS total_store_return_amount, AVG(sr_return_amt) AS avg_store_return_amount, COUNT(DISTINCT sr_customer_sk) AS unique_store_customers, SUM(wr_return_quantity) AS total_web_return_quantity, SUM(wr_return_amt) AS total_web_return_amount, AVG(wr_return_amt) AS avg_web_return_amount, COUNT(DISTINCT wr_returning_customer_sk) AS unique_web_customers FROM catalog_returns JOIN store_returns ON cr_item_sk = sr_item_sk AND cr_order_number = sr_ticket_number JOIN web_returns ON cr_item_sk = wr_item_sk AND cr_order_number = wr_order_number WHERE cr_returned_date_sk IS NOT NULL AND sr_returned_date_sk IS NOT NULL AND wr_returned_date_sk IS NOT NULL GROUP BY cr_returned_date_sk ORDER BY cr_returned_date_sk;
SELECT ca.ca_state AS customer_state, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sale_price, SUM(cr.cr_return_quantity) AS total_quantity_returned, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, COUNT(DISTINCT p.p_promo_sk) AS total_promotions_used, COUNT(DISTINCT w.w_warehouse_sk) AS total_warehouses_used FROM customer_address ca JOIN customer c ON ca.ca_address_sk = c.c_current_addr_sk JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk WHERE ca.ca_state IS NOT NULL AND p.p_channel_radio = 'N' AND (p.p_promo_name LIKE '%bar%' OR p.p_promo_name LIKE '%anti%') AND w.w_warehouse_id IN ('AAAAAAAABAAAAAAA', 'AAAAAAAADAAAAAAA', 'AAAAAAAAEAAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAACAAAAAAA') AND cs.cs_catalog_page_sk IN ( SELECT cp_catalog_page_sk FROM catalog_page WHERE cp_catalog_page_number IN (29, 24, 40) ) GROUP BY ca.ca_state ORDER BY total_return_amount DESC, average_sale_price DESC LIMIT 100;
SELECT d_year, w_state, p_promo_name, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_profit) AS total_profit FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk JOIN promotion ON cs_promo_sk = p_promo_sk WHERE d_year = 2001 AND w_state IN ('WA', 'CA', 'TX') AND p_promo_id IN ('AAAAAAAAKDAAAAAA', 'AAAAAAAAKJAAAAAA', 'AAAAAAAACKAAAAAA') GROUP BY d_year, w_state, p_promo_name ORDER BY total_profit DESC, average_sales_price DESC LIMIT 10;
SELECT s.s_store_name, s.s_city, s.s_state, COUNT(DISTINCT c.c_customer_sk) AS number_of_customers, SUM(cd.cd_purchase_estimate) AS total_purchase_estimate, AVG(cd.cd_dep_count) AS avg_dependents, AVG(cd.cd_dep_employed_count) AS avg_employed_dependents, AVG(cd.cd_dep_college_count) AS avg_college_dependents, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, ib.ib_lower_bound AS income_band_lower_bound, ib.ib_upper_bound AS income_band_upper_bound FROM store s JOIN customer c ON s.s_store_sk = c.c_current_addr_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE s.s_rec_start_date = '2001-03-13' AND s.s_number_employees IN (229, 271) AND EXISTS ( SELECT 1 FROM web_page wp WHERE wp.wp_customer_sk = c.c_customer_sk AND wp.wp_access_date_sk IN (2452583, 2452648) ) GROUP BY s.s_store_name, s.s_city, s.s_state, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY s.s_store_name, s.s_city, s.s_state;
