SELECT i.i_category, cd.cd_education_status, cd.cd_marital_status, COUNT(DISTINCT i.i_item_sk) AS item_count, AVG(i.i_current_price) AS avg_current_price, AVG(i.i_wholesale_cost) AS avg_wholesale_cost FROM item i JOIN customer_demographics cd ON cd.cd_demo_sk = i.i_manager_id JOIN household_demographics hd ON hd.hd_demo_sk = i.i_manager_id WHERE i.i_rec_start_date <= CURRENT_DATE AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date > CURRENT_DATE) AND cd.cd_gender IN ('M', 'F') AND cd.cd_marital_status IN ('D', 'U', 'S', 'M', 'W') GROUP BY i.i_category, cd.cd_education_status, cd.cd_marital_status ORDER BY i.i_category, cd.cd_education_status, cd.cd_marital_status;
SELECT d_year, ca_state, COUNT(DISTINCT c_customer_sk) AS num_customers, SUM(ss_quantity) AS total_quantity, AVG(ss_sales_price) AS avg_sales_price, SUM(ss_net_paid) AS total_net_paid, SUM(ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss_net_profit) AS total_net_profit FROM store_sales JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk JOIN customer ON store_sales.ss_customer_sk = customer.c_customer_sk JOIN customer_address ON customer.c_current_addr_sk = customer_address.ca_address_sk WHERE d_weekend = 'N' AND ss_list_price IN (79.50, 143.98, 117.62) AND ca_state IS NOT NULL GROUP BY d_year, ca_state ORDER BY d_year, ca_state;
SELECT ca.ca_state, ib.ib_income_band_sk, i.i_category, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS avg_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN customer_address ca ON ws.ws_ship_addr_sk = ca.ca_address_sk JOIN income_band ib ON ws.ws_ship_hdemo_sk = ib.ib_income_band_sk WHERE i.i_class IN ('infants', 'diamonds', 'camcorders', 'karoke', 'pendants', 'wireless') AND ca.ca_street_name IN ('Oak Franklin', 'Park Fourteenth', '2nd 5th', 'Second Main') AND ws.ws_ship_hdemo_sk IN ('5884', '5775', '5849', '958', '2572') AND ws.ws_ext_list_price IN ('5273.64', '22629.95', '2666.62') AND ib.ib_income_band_sk IN ('1', '6', '14', '13', '2') GROUP BY ca.ca_state, ib.ib_income_band_sk, i.i_category ORDER BY total_net_profit DESC, ca.ca_state, ib.ib_income_band_sk, i.i_category;
SELECT sm.sm_type, sm.sm_carrier, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs.cs_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(cs.cs_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(cs.cs_net_profit) AS total_net_profit, AVG(wp.wp_image_count) AS avg_image_count_on_webpage FROM catalog_sales cs JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN web_page wp ON cs.cs_catalog_page_sk = wp.wp_web_page_sk WHERE wp.wp_image_count = 2 GROUP BY sm.sm_type, sm.sm_carrier ORDER BY total_net_paid DESC;
SELECT ca_state, ca_city, SUM(cs_net_paid_inc_tax) AS total_sales, AVG(cs_net_paid_inc_tax) AS avg_sales, COUNT(DISTINCT cs_order_number) AS num_sales_orders, SUM(cr_return_amt_inc_tax) AS total_returns, AVG(cr_return_amt_inc_tax) AS avg_returns, COUNT(DISTINCT cr_order_number) AS num_return_orders, SUM(cr_net_loss) AS total_net_loss FROM customer_address JOIN catalog_sales ON cs_bill_addr_sk = ca_address_sk LEFT JOIN catalog_returns ON cr_order_number = cs_order_number JOIN web_sales ON ws_order_number = cs_order_number JOIN time_dim ON ws_sold_time_sk = t_time_sk JOIN web_page ON ws_web_page_sk = wp_web_page_sk WHERE t_sub_shift = 'night' AND ws_ship_date_sk = 2450935 AND ws_web_page_sk IN (41, 3, 18, 4, 45) AND wp_creation_date_sk IN (2450810, 2450808, 2450812, 2450809) GROUP BY ca_state, ca_city ORDER BY ca_state, ca_city;
SELECT cp.cp_department, SUM(ws.ws_net_profit) AS total_web_sales_profit, AVG(ws.ws_quantity) AS avg_web_sales_quantity, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(cr.cr_net_loss) AS total_catalog_returns_loss, AVG(cr.cr_return_quantity) AS avg_catalog_return_quantity, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_returns, SUM(sr.sr_net_loss) AS total_store_returns_loss, AVG(sr.sr_return_quantity) AS avg_store_return_quantity, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, SUM(CASE WHEN p.p_channel_dmail = 'Y' THEN p.p_cost ELSE 0 END) AS total_promo_cost_via_dmail, COUNT(CASE WHEN p.p_channel_demo = 'N' AND p.p_channel_catalog = 'N' THEN p.p_promo_sk END) AS count_non_demo_catalog_promos FROM catalog_page cp LEFT JOIN web_sales ws ON cp.cp_catalog_page_sk = ws.ws_web_page_sk LEFT JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk LEFT JOIN store_returns sr ON sr.sr_item_sk = ws.ws_item_sk LEFT JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk WHERE cp.cp_start_date_sk IS NOT NULL AND cp.cp_end_date_sk IS NOT NULL AND ws.ws_sold_date_sk BETWEEN cp.cp_start_date_sk AND cp.cp_end_date_sk GROUP BY cp.cp_department ORDER BY total_web_sales_profit DESC, total_catalog_returns_loss ASC, total_store_returns_loss ASC;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, SUM(cr.cr_return_amount) AS total_refunds, AVG(cr.cr_return_amount) AS avg_refund_amount, COUNT(*) AS total_return_instances, ws.web_name, ws.web_manager FROM catalog_returns cr JOIN customer c ON cr.cr_returning_customer_sk = c.c_customer_sk JOIN web_site ws ON cr.cr_call_center_sk = ws.web_site_sk WHERE cr.cr_returned_date_sk IN ('2451001', '2450970') AND c.c_birth_year = '1936' AND cr.cr_returning_cdemo_sk IN ('1683351', '1010437', '1147434', '1904377', '447632') AND c.c_customer_id IN ('AAAAAAAAKFNAAAAA', 'AAAAAAAAAFABAAAA') GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, ws.web_name, ws.web_manager ORDER BY total_refunds DESC;
SELECT w.w_state, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(w.w_gmt_offset) AS average_gmt_offset, COUNT(r.r_reason_sk) AS gift_exchange_occurrences FROM warehouse w LEFT JOIN reason r ON r.r_reason_desc = 'Gift exchange' JOIN time_dim t ON t.t_minute BETWEEN 25 AND 35 GROUP BY w.w_state ORDER BY total_warehouse_sq_ft DESC, average_gmt_offset DESC;
SELECT d_year, SUM(cs_net_paid) AS total_sales, AVG(cs_quantity) AS average_quantity, COUNT(DISTINCT cs_order_number) AS total_orders, hd_dep_count, hd_vehicle_count, p_channel_dmail, p_channel_demo FROM catalog_sales JOIN date_dim ON (catalog_sales.cs_sold_date_sk = date_dim.d_date_sk) JOIN household_demographics ON (catalog_sales.cs_bill_hdemo_sk = household_demographics.hd_demo_sk) JOIN promotion ON (catalog_sales.cs_promo_sk = promotion.p_promo_sk) WHERE d_year = 1999 AND hd_dep_count >= 2 AND hd_vehicle_count >= 1 AND (p_channel_dmail = 'Y' OR p_channel_demo = 'N') GROUP BY d_year, hd_dep_count, hd_vehicle_count, p_channel_dmail, p_channel_demo ORDER BY total_sales DESC;
SELECT ca.ca_city, ca.ca_state, COUNT(DISTINCT cc.cc_call_center_id) AS num_call_centers, SUM(cc.cc_employees) AS total_employees, AVG(hd.hd_dep_count) AS avg_household_dep_count, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_return_quantity) AS total_returned_items, COUNT(DISTINCT sr.sr_ticket_number) AS num_return_transactions, AVG(sr.sr_fee) AS avg_return_fee FROM call_center cc JOIN customer_address ca ON cc.cc_city = ca.ca_city AND cc.cc_state = ca.ca_state JOIN household_demographics hd ON hd.hd_income_band_sk BETWEEN 9 AND 15 JOIN store_returns sr ON sr.sr_addr_sk = ca.ca_address_sk JOIN ship_mode sm ON sm.sm_contract IN ('A5BYO1qH8HGTTN', 'Xjy3ZPuiDjzHlRx14Z3', '2mM8l', '6Hzzp4JkzjqD8MGXLCDa') WHERE ca.ca_city IN ('Lewisburg', 'Wright', 'Valley View', 'Argyle', 'Plainview', 'Andover') AND sm.sm_type = 'REGULAR' AND ca.ca_gmt_offset IN (-6.00, -9.00, -5.00, -10.00) AND (hd.hd_dep_count IN (0, 3, 7, 8, 9) OR hd.hd_dep_count IS NULL) GROUP BY ca.ca_city, ca.ca_state ORDER BY total_return_amount DESC, total_employees DESC, num_return_transactions DESC;
SELECT dd.d_year AS fiscal_year, dd.d_quarter_name AS quarter, COUNT(DISTINCT ws.web_site_sk) AS number_of_websites, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(hd.hd_dep_count) AS avg_dependency_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, SUM(CASE WHEN hd.hd_buy_potential = '>10000' THEN 1 ELSE 0 END) AS high_buy_potential_count, AVG(ws.web_tax_percentage) AS avg_web_tax_percentage FROM date_dim dd JOIN web_site ws ON dd.d_date_sk = ws.web_open_date_sk OR dd.d_date_sk = ws.web_close_date_sk JOIN warehouse w ON ws.web_zip = w.w_zip JOIN household_demographics hd ON hd.hd_income_band_sk IS NOT NULL WHERE dd.d_fy_year IN (1913, 1900, 1909, 1901, 1902) AND dd.d_weekend = 'N' AND hd.hd_dep_count IN (3, 9, 4, 5, 2, 0) AND hd.hd_buy_potential IN ('5001-10000', '1001-5000', '>10000', 'Unknown', '0-500', '501-1000') AND w.w_warehouse_sq_ft IN (977787, 294242, 621234, 138504) AND ws.web_street_type IN ('ST', 'Drive', 'Wy') GROUP BY fiscal_year, quarter ORDER BY fiscal_year, quarter;
SELECT d_year, i_category, i_class, SUM(ws_sales_price) AS total_sales, AVG(ws_sales_price) AS avg_sales_price, COUNT(DISTINCT ws_order_number) AS num_orders, SUM(sr_return_amt) AS total_returns, AVG(sr_return_amt) AS avg_return_amt, COUNT(DISTINCT sr_ticket_number) AS num_returns, SUM(ws_net_profit) - SUM(sr_net_loss) AS net_profit FROM web_sales JOIN item ON ws_item_sk = i_item_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk LEFT JOIN store_returns ON sr_item_sk = ws_item_sk AND sr_returned_date_sk = ws_sold_date_sk WHERE d_year = 2002 AND (i_category = 'Electronics' OR i_category = 'Books') AND ws_sales_price > 0 GROUP BY d_year, i_category, i_class ORDER BY d_year, i_category, i_class;
SELECT w_state, COUNT(DISTINCT c.c_customer_sk) AS num_customers, COUNT(DISTINCT s.s_store_sk) AS num_stores, SUM(i.inv_quantity_on_hand) AS total_inventory, AVG(s.s_number_employees) AS avg_store_employees, AVG(wp.wp_link_count) AS avg_webpage_link_count FROM warehouse w JOIN inventory i ON w.w_warehouse_sk = i.inv_warehouse_sk JOIN web_page wp ON wp.wp_rec_end_date > CURRENT_DATE JOIN store s ON s.s_state = w.w_state JOIN customer c ON c.c_current_addr_sk = s.s_store_sk WHERE i.inv_quantity_on_hand BETWEEN 200 AND 1000 AND wp.wp_max_ad_count BETWEEN 1 AND 3 GROUP BY w_state ORDER BY total_inventory DESC;
SELECT c.c_birth_year, c.c_birth_country, c.c_preferred_cust_flag, s.s_store_id, s.s_store_name, s.s_city, s.s_state, s.s_market_desc, COUNT(ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws INNER JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk INNER JOIN store s ON ws.ws_ship_addr_sk = s.s_store_sk GROUP BY c.c_birth_year, c.c_birth_country, c.c_preferred_cust_flag, s.s_store_id, s.s_store_name, s.s_city, s.s_state, s.s_market_desc ORDER BY total_net_paid DESC, s.s_state, c.c_birth_year;
SELECT cp.cp_department, COUNT(*) AS total_catalog_pages, AVG(cp.cp_catalog_number) AS average_catalog_number, SUM(inv.inv_quantity_on_hand) AS total_inventory_quantity, AVG(wr.wr_return_amt_inc_tax) AS average_return_amount_inc_tax, COUNT(DISTINCT wr.wr_order_number) AS total_returned_orders, COUNT(DISTINCT cd.cd_demo_sk) AS unique_customers, SUM(CASE WHEN hd.hd_income_band_sk IS NOT NULL THEN 1 ELSE 0 END) AS households_with_income_band, sm.sm_type AS shipping_type, COUNT(DISTINCT sm.sm_ship_mode_sk) AS count_shipping_modes, ROUND(SUM(wr.wr_fee)::numeric, 2) AS total_fees_collected, ROUND(SUM(wr.wr_reversed_charge)::numeric, 2) AS total_reversed_charges FROM catalog_page cp LEFT JOIN inventory inv ON cp.cp_catalog_page_sk = inv.inv_item_sk LEFT JOIN web_returns wr ON inv.inv_item_sk = wr.wr_item_sk LEFT JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk LEFT JOIN household_demographics hd ON wr.wr_returning_hdemo_sk = hd.hd_demo_sk LEFT JOIN ship_mode sm ON sm.sm_ship_mode_sk IN (9, 10) WHERE cp.cp_start_date_sk IS NOT NULL AND cp.cp_end_date_sk IS NOT NULL AND (wr.wr_reversed_charge IN ('35.79', '219.13', '107.56', '7.03') OR wr.wr_fee IN ('60.42', '16.01', '7.56', '22.38')) AND (inv.inv_quantity_on_hand IN (932, 682, 540) OR inv.inv_item_sk IN (12650, 13507, 12682, 13526)) GROUP BY cp.cp_department, sm.sm_type ORDER BY total_catalog_pages DESC, average_return_amount_inc_tax DESC;
SELECT s.s_store_name, s.s_city, s.s_state, td.t_shift, COUNT(*) AS total_returns, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(CASE WHEN sr.sr_return_amt_inc_tax > 100 THEN 1 ELSE 0 END) AS returns_over_100, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN time_dim td ON sr.sr_return_time_sk = td.t_time_sk JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN web_page wp ON sr.sr_store_sk = wp.wp_customer_sk JOIN web_returns wr ON sr.sr_item_sk = wr.wr_item_sk AND sr.sr_ticket_number = wr.wr_order_number WHERE td.t_shift = 'third' AND s.s_gmt_offset = '-5.00' AND ca.ca_address_id IN ('AAAAAAAAGGKAAAAA', 'AAAAAAAANCEAAAAA', 'AAAAAAAAOKGAAAAA') AND (wr.wr_return_amt_inc_tax = '6344.70' OR wr.wr_return_amt_inc_tax = '72.90' OR wr.wr_return_amt_inc_tax = '705.96') GROUP BY s.s_store_name, s.s_city, s.s_state, td.t_shift ORDER BY total_returns DESC, avg_return_amount_inc_tax DESC LIMIT 100;
SELECT r_reason_desc, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, COUNT(*) AS return_count, SUM(cs_net_profit) AS total_sales_net_profit, AVG(cs_net_profit) AS avg_sales_net_profit, COUNT(DISTINCT cs_order_number) AS sales_order_count, SUM(ws_net_profit) AS total_web_net_profit, AVG(ws_net_profit) AS avg_web_net_profit, COUNT(DISTINCT ws_order_number) AS web_order_count FROM catalog_returns JOIN reason ON catalog_returns.cr_reason_sk = reason.r_reason_sk LEFT JOIN catalog_sales ON catalog_returns.cr_item_sk = catalog_sales.cs_item_sk AND catalog_returns.cr_order_number = catalog_sales.cs_order_number LEFT JOIN web_sales ON catalog_returns.cr_item_sk = web_sales.ws_item_sk AND catalog_returns.cr_order_number = web_sales.ws_order_number WHERE catalog_returns.cr_returned_date_sk BETWEEN 2451276 AND 2451276 + 30 AND catalog_returns.cr_return_tax BETWEEN 0 AND 200 AND (catalog_sales.cs_ship_cdemo_sk = 568017 OR web_sales.ws_sold_date_sk = 2451276) AND (catalog_sales.cs_promo_sk IN (253, 289, 228) OR web_sales.ws_promo_sk IN (253, 289, 228)) AND reason.r_reason_id IN ('AAAAAAAAIBAAAAAA', 'AAAAAAAABCAAAAAA', 'AAAAAAAAOBAAAAAA', 'AAAAAAAAMAAAAAAA') GROUP BY r_reason_desc ORDER BY total_return_amount DESC, total_sales_net_profit DESC, total_web_net_profit DESC;
SELECT cp.cp_department, COUNT(ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_sales_price) AS total_sales_amount, AVG(ss.ss_ext_discount_amt) AS average_discount_amount, SUM(ss.ss_quantity) AS total_items_sold, SUM(ss.ss_coupon_amt) AS total_coupon_amount_used FROM catalog_page cp JOIN store_sales ss ON cp.cp_catalog_page_sk = ss.ss_sold_date_sk WHERE cp.cp_catalog_number BETWEEN 25 AND 41 AND ss.ss_sold_date_sk BETWEEN 20020101 AND 20021231 AND ss.ss_ext_list_price IN (2602.80, 627.44, 6715.50, 6951.00, 6762.70, 4044.30) AND ss.ss_coupon_amt IN (393.68, 57.05) GROUP BY cp.cp_department ORDER BY total_sales_amount DESC;
SELECT d_year, w_state, p_promo_name, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_profit) AS total_profit FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk JOIN promotion ON cs_promo_sk = p_promo_sk WHERE d_year = 2001 AND w_state IN ('WA', 'CA', 'TX') AND p_promo_id IN ('AAAAAAAAKDAAAAAA', 'AAAAAAAAKJAAAAAA', 'AAAAAAAACKAAAAAA') GROUP BY d_year, w_state, p_promo_name ORDER BY total_profit DESC, average_sales_price DESC LIMIT 10;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_credit_rating, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, COUNT(sr.sr_ticket_number) AS total_returns FROM customer_demographics cd JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk WHERE hd.hd_buy_potential IN ('5001-10000', '>10000') AND sr.sr_reversed_charge > 50 GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_credit_rating HAVING AVG(cd.cd_purchase_estimate) > 500 ORDER BY avg_purchase_estimate DESC, total_return_amount_inc_tax DESC;
SELECT ca.ca_city, ca.ca_state, COUNT(DISTINCT ca.ca_address_sk) AS num_addresses, AVG(hd.hd_dep_count) AS avg_dependency_count, SUM(hd.hd_vehicle_count) AS total_vehicles, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT sm.sm_ship_mode_sk) AS num_ship_modes, COUNT(DISTINCT r.r_reason_sk) AS num_reasons, SUM(CASE WHEN cp.cp_department = 'Electronics' THEN 1 ELSE 0 END) AS num_electronics_pages, SUM(CASE WHEN sm.sm_type = 'OVERNIGHT' THEN 1 ELSE 0 END) AS overnight_shipments, AVG(CASE WHEN t.t_am_pm = 'PM' THEN t.t_hour END) AS avg_hour_pm FROM customer_address ca JOIN household_demographics hd ON ca.ca_address_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN ship_mode sm ON sm.sm_carrier = 'UPS' JOIN reason r ON r.r_reason_desc LIKE 'reason %' LEFT JOIN catalog_page cp ON cp.cp_department = ca.ca_city LEFT JOIN time_dim t ON t.t_shift = 'Evening' WHERE r.r_reason_sk IN ('9', '6', '11', '2') AND ib.ib_income_band_sk IN ('20', '6') AND hd.hd_buy_potential = 'Unknown' AND sm.sm_type IN ('LIBRARY', 'OVERNIGHT', 'NEXT DAY') GROUP BY ca.ca_city, ca.ca_state, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ca.ca_city, ca.ca_state;
SELECT i.i_category, COUNT(DISTINCT ss.ss_item_sk) AS item_count, SUM(ss.ss_net_paid) AS total_revenue, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT s.s_store_sk) AS store_count, COUNT(DISTINCT ws.web_site_sk) AS website_count FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN web_site ws ON s.s_market_id = ws.web_mkt_id LEFT JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE s.s_market_id = 8 AND (ws.web_rec_end_date IS NULL OR ws.web_rec_end_date > CURRENT_DATE) AND ss.ss_sold_date_sk BETWEEN 2450654 AND 2450705 AND s.s_state IN ('Leon', 'Holiday Hills', 'Waterloo', 'Pinecrest') GROUP BY i.i_category ORDER BY total_revenue DESC;
SELECT i.i_category, i.i_class, call_center.cc_name, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT cr.cr_order_number) AS total_returned_orders, MAX(i.i_current_price) AS max_item_price FROM catalog_returns cr JOIN call_center ON cr.cr_call_center_sk = call_center.cc_call_center_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk WHERE i.i_manufact = 'barcallycally' GROUP BY i.i_category, i.i_class, call_center.cc_name ORDER BY total_return_amount DESC, i.i_category, i.i_class, call_center.cc_name;
SELECT dd.d_year, dd.d_moy, SUM(inv.inv_quantity_on_hand) AS total_quantity, AVG(inv.inv_quantity_on_hand) AS avg_quantity, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, COUNT(DISTINCT w.w_warehouse_sk) AS warehouses_involved, SUM(CASE WHEN p.p_channel_email = 'Y' THEN p.p_cost ELSE 0 END) AS total_promo_cost_email, SUM(CASE WHEN p.p_channel_tv = 'Y' THEN p.p_cost ELSE 0 END) AS total_promo_cost_tv, COUNT(DISTINCT CASE WHEN p.p_discount_active = 'Y' THEN p.p_promo_sk ELSE NULL END) AS active_discount_promos FROM inventory inv JOIN date_dim dd ON inv.inv_date_sk = dd.d_date_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN customer c ON dd.d_date_sk = c.c_first_sales_date_sk OR dd.d_date_sk = c.c_first_shipto_date_sk LEFT JOIN promotion p ON dd.d_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk WHERE dd.d_year = 1998 AND p.p_channel_event = 'N' AND dd.d_first_dom IN ('2416847', '2417850', '2417728', '2418946') AND inv.inv_warehouse_sk IN ('1', '2') AND c.c_birth_month IN ('3', '5', '6', '10', '4') GROUP BY dd.d_year, dd.d_moy ORDER BY dd.d_year, dd.d_moy;
