SELECT ca.ca_city, ca.ca_state, COUNT(DISTINCT cc.cc_call_center_id) AS num_call_centers, SUM(cc.cc_employees) AS total_employees, AVG(hd.hd_dep_count) AS avg_household_dep_count, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_return_quantity) AS total_returned_items, COUNT(DISTINCT sr.sr_ticket_number) AS num_return_transactions, AVG(sr.sr_fee) AS avg_return_fee FROM call_center cc JOIN customer_address ca ON cc.cc_city = ca.ca_city AND cc.cc_state = ca.ca_state JOIN household_demographics hd ON hd.hd_income_band_sk BETWEEN 9 AND 15 JOIN store_returns sr ON sr.sr_addr_sk = ca.ca_address_sk JOIN ship_mode sm ON sm.sm_contract IN ('A5BYO1qH8HGTTN', 'Xjy3ZPuiDjzHlRx14Z3', '2mM8l', '6Hzzp4JkzjqD8MGXLCDa') WHERE ca.ca_city IN ('Lewisburg', 'Wright', 'Valley View', 'Argyle', 'Plainview', 'Andover') AND sm.sm_type = 'REGULAR' AND ca.ca_gmt_offset IN (-6.00, -9.00, -5.00, -10.00) AND (hd.hd_dep_count IN (0, 3, 7, 8, 9) OR hd.hd_dep_count IS NULL) GROUP BY ca.ca_city, ca.ca_state ORDER BY total_return_amount DESC, total_employees DESC, num_return_transactions DESC;
SELECT c.c_first_name, c.c_last_name, sum(ss.ss_quantity) as total_items_sold, avg(ss.ss_sales_price) as average_sales_price, sum(ss.ss_net_paid) as total_revenue, sum(ss.ss_net_profit) as total_profit, p.p_promo_name, count(DISTINCT ss.ss_ticket_number) as number_of_sales_transactions FROM store_sales ss JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN inventory i ON ss.ss_item_sk = i.inv_item_sk AND i.inv_date_sk = ss.ss_sold_date_sk WHERE c.c_last_name IN ('Waggoner', 'Hoyt', 'Moffitt', 'Buchanan', 'Orourke') AND i.inv_warehouse_sk IN ('1', '2') AND p.p_channel_catalog = 'N' AND ss.ss_promo_sk IN ('11', '103', '131', '133', '275') GROUP BY c.c_first_name, c.c_last_name, p.p_promo_name ORDER BY total_revenue DESC, c.c_last_name, c.c_first_name;
SELECT cp.cp_department, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_inc_tax, AVG(cr.cr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(cr.cr_return_quantity) AS total_return_quantity, AVG(cr.cr_return_quantity) AS avg_return_quantity, hd.hd_dep_count, hd.hd_vehicle_count FROM catalog_page cp JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk WHERE cp.cp_catalog_page_sk IN (22, 117, 432, 303) AND cr.cr_return_quantity > 5 AND hd.hd_dep_count IN (3, 8) GROUP BY cp.cp_department, hd.hd_dep_count, hd.hd_vehicle_count ORDER BY total_return_amount_inc_tax DESC, total_returns DESC;
SELECT p.p_promo_name, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo, SUM(p.p_cost) AS total_promotion_cost, COUNT(p.p_promo_sk) AS number_of_promotions, AVG(cd.cd_dep_count) AS average_number_of_dependents FROM promotion p JOIN web_page wp ON p.p_item_sk = wp.wp_web_page_sk JOIN customer_demographics cd ON wp.wp_customer_sk = cd.cd_demo_sk WHERE wp.wp_creation_date_sk IN ('2450808', '2450809') AND p.p_response_target = 1 AND cd.cd_marital_status IN ('W', 'D', 'U', 'S') GROUP BY p.p_promo_name, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo ORDER BY total_promotion_cost DESC, number_of_promotions DESC;
SELECT p.p_promo_name, avg(cs.cs_sales_price) AS avg_sales_price, sum(cs.cs_ext_discount_amt) AS total_discount_amount, sum(cs.cs_net_profit) AS total_net_profit, cd.cd_gender, cd.cd_education_status, count(cs.cs_order_number) AS total_orders FROM catalog_sales cs JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk WHERE p.p_channel_email = 'N' AND d.d_year = 2022 GROUP BY p.p_promo_name, cd.cd_gender, cd.cd_education_status ORDER BY total_net_profit DESC;
SELECT st.s_store_name, st.s_store_id, SUM(ws.ws_net_paid) AS total_net_sales, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(wr.wr_order_number) AS total_returns, AVG(wr.wr_return_amt) AS avg_return_amount, ARRAY_AGG(DISTINCT re.r_reason_desc) AS reasons_for_returns FROM store st LEFT JOIN web_sales ws ON st.s_store_sk = ws.ws_warehouse_sk LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number LEFT JOIN reason re ON wr.wr_reason_sk = re.r_reason_sk WHERE st.s_division_id = 1 AND st.s_tax_precentage BETWEEN 0.01 AND 0.06 GROUP BY st.s_store_name, st.s_store_id ORDER BY total_net_sales DESC, avg_sales_price DESC, total_returns DESC, avg_return_amount DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT cr.cr_returning_customer_sk) AS total_returning_customers_catalog, COUNT(DISTINCT wr.wr_returning_customer_sk) AS total_returning_customers_web, SUM(cr.cr_return_quantity) AS total_return_quantity_catalog, SUM(wr.wr_return_quantity) AS total_return_quantity_web, AVG(cr.cr_return_amount) AS avg_return_amount_catalog, AVG(wr.wr_return_amt) AS avg_return_amount_web, SUM(cr.cr_net_loss) AS total_net_loss_catalog, SUM(wr.wr_net_loss) AS total_net_loss_web FROM income_band ib LEFT JOIN household_demographics hd ON ib.ib_income_band_sk = hd.hd_income_band_sk LEFT JOIN catalog_returns cr ON hd.hd_demo_sk = cr.cr_returning_hdemo_sk LEFT JOIN web_returns wr ON hd.hd_demo_sk = wr.wr_returning_hdemo_sk LEFT JOIN promotion p ON p.p_start_date_sk = '2450215' AND p.p_channel_dmail = 'N' AND (cr.cr_item_sk = p.p_item_sk OR wr.wr_item_sk = p.p_item_sk) WHERE (cr.cr_returned_date_sk IS NOT NULL OR wr.wr_returned_date_sk IS NOT NULL) GROUP BY ib.ib_income_band_sk ORDER BY ib.ib_lower_bound;
SELECT ib.ib_income_band_sk, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages, AVG(wp.wp_char_count) AS avg_char_count, SUM(wp.wp_link_count) AS total_link_count, AVG(wp.wp_image_count) AS avg_image_count, SUM(wr.wr_return_quantity) AS total_return_quantity, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_fee) AS avg_return_fee, SUM(wr.wr_net_loss) AS total_net_loss FROM income_band ib LEFT JOIN web_page wp ON wp.wp_customer_sk = ib.ib_income_band_sk LEFT JOIN web_returns wr ON wr.wr_web_page_sk = wp.wp_web_page_sk WHERE wp.wp_rec_start_date BETWEEN '1997-09-03' AND '2001-09-03' AND wp.wp_char_count > 4000 AND wr.wr_return_ship_cost BETWEEN 45.88 AND 361.10 GROUP BY ib.ib_income_band_sk ORDER BY ib.ib_income_band_sk;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, cc.cc_tax_percentage, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amt_inc_tax, SUM(wr.wr_return_amt) AS total_return_amt, SUM(wr.wr_return_tax) AS total_return_tax, COUNT(DISTINCT wr.wr_returning_customer_sk) AS distinct_returning_customers FROM web_returns wr JOIN customer c ON wr.wr_returning_customer_sk = c.c_customer_sk JOIN call_center cc ON cc.cc_city = c.c_login JOIN catalog_page cp ON wr.wr_web_page_sk = cp.cp_catalog_page_sk WHERE cp.cp_start_date_sk BETWEEN 2451088 AND 2451510 AND wr.wr_return_amt > 0 AND cc.cc_tax_percentage IS NOT NULL GROUP BY cc.cc_name, cc.cc_city, cc.cc_state, cc.cc_tax_percentage ORDER BY total_return_amt DESC, avg_return_amt_inc_tax DESC;
SELECT c.c_first_name, c.c_last_name, c.c_birth_country, c.c_email_address, COUNT(sr.sr_return_quantity) AS total_returns, SUM(sr.sr_return_amt) AS total_return_amt, AVG(sr.sr_return_amt) AS avg_return_amt, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_return_ship_cost) AS total_ship_cost, SUM(sr.sr_net_loss) AS total_net_loss, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_carrier FROM customer c JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN income_band ib ON c.c_current_cdemo_sk = ib.ib_income_band_sk JOIN ship_mode sm ON sm.sm_ship_mode_id = 'AAAAAAAABBAAAAAA' WHERE c.c_preferred_cust_flag = 'Y' GROUP BY c.c_first_name, c.c_last_name, c.c_birth_country, c.c_email_address, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_carrier ORDER BY total_return_amt DESC;
SELECT hd.hd_income_band_sk, count(distinct c.c_customer_sk) AS num_customers, sum(cs.cs_quantity) AS total_sales_quantity, sum(cs.cs_net_paid) AS total_sales_amount, sum(sr.sr_return_quantity) AS total_returned_quantity, sum(sr.sr_return_amt) AS total_returned_amount, sum(cs.cs_net_profit) - sum(coalesce(sr.sr_net_loss, 0)) AS net_profit FROM customer c JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk LEFT JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk WHERE hd.hd_income_band_sk IN ('17', '12', '15', '6', '4', '19') AND (cs.cs_sold_date_sk IS NOT NULL OR sr.sr_returned_date_sk IS NOT NULL) GROUP BY hd.hd_income_band_sk ORDER BY net_profit DESC;
SELECT ca.ca_state, i.i_category, SUM(cs.cs_sales_price) AS total_sales, AVG(cs.cs_net_profit) AS avg_net_profit, COUNT(DISTINCT cs.cs_order_number) AS order_count FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk WHERE ca.ca_location_type = 'single family' AND i.i_brand_id IN ('9013007', '10012013', '9001003', '7015010', '7010010', '10007007') AND cs.cs_net_paid_inc_ship_tax BETWEEN 100 AND 5000 AND ca.ca_county IN ('Wahkiakum County', 'Murray County') GROUP BY ca.ca_state, i.i_category ORDER BY total_sales DESC, avg_net_profit DESC;
SELECT dd.d_year, ca.ca_country, ca.ca_state, sm.sm_type, COUNT(DISTINCT hd.hd_demo_sk) AS number_of_households, AVG(hd.hd_vehicle_count) AS avg_vehicles_per_household, SUM(inv.inv_quantity_on_hand) AS total_inventory_on_hand FROM inventory inv JOIN date_dim dd ON inv.inv_date_sk = dd.d_date_sk JOIN customer_address ca ON inv.inv_warehouse_sk = ca.ca_address_sk JOIN household_demographics hd ON ca.ca_address_sk = hd.hd_demo_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = inv.inv_warehouse_sk WHERE dd.d_current_month = 'N' AND hd.hd_vehicle_count IN (0, 3) GROUP BY dd.d_year, ca.ca_country, ca.ca_state, sm.sm_type ORDER BY total_inventory_on_hand DESC, avg_vehicles_per_household DESC;
SELECT w.w_warehouse_name, i.ib_lower_bound, i.ib_upper_bound, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(wr.wr_return_quantity) AS total_return_quantity, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_fee) AS total_return_fees, COUNT(DISTINCT wr.wr_order_number) AS total_return_transactions FROM warehouse w JOIN store_sales ss ON ss.ss_addr_sk = w.w_warehouse_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN income_band i ON hd.hd_income_band_sk = i.ib_income_band_sk LEFT JOIN web_returns wr ON wr.wr_item_sk = ss.ss_item_sk AND wr.wr_refunded_customer_sk = ss.ss_customer_sk WHERE w.w_county = 'Williamson County' AND ss.ss_sold_time_sk = 35623 AND i.ib_income_band_sk IN (SELECT hd_income_band_sk FROM household_demographics WHERE hd_demo_sk IN (6765, 6298, 2035)) GROUP BY w.w_warehouse_name, i.ib_lower_bound, i.ib_upper_bound ORDER BY w.w_warehouse_name, i.ib_lower_bound;
SELECT hd.hd_buy_potential, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_quantity) AS total_quantity_sold, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_incl_tax, COUNT(DISTINCT sr.sr_customer_sk) AS unique_customers_returned FROM store_sales ss LEFT JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk LEFT JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk LEFT JOIN store_returns sr ON ss.ss_customer_sk = sr.sr_customer_sk AND ss.ss_item_sk = sr.sr_item_sk GROUP BY hd.hd_buy_potential ORDER BY total_return_amount_incl_tax DESC;
SELECT cs.cs_call_center_sk, cc.cc_name AS call_center_name, cp.cp_catalog_page_id, cp.cp_department, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_paid) AS total_revenue, SUM(cs.cs_net_profit) AS total_profit, AVG(cs.cs_net_profit) AS avg_profit_per_sale, cd.cd_marital_status, COUNT(DISTINCT cs.cs_bill_customer_sk) AS unique_customers, SUM(inv.inv_quantity_on_hand) AS total_inventory_on_hand FROM catalog_sales cs LEFT JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk LEFT JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk LEFT JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk LEFT JOIN inventory inv ON cs.cs_item_sk = inv.inv_item_sk AND cs_sold_date_sk = inv.inv_date_sk WHERE cc.cc_country = 'United States' AND cs.cs_net_profit > 0 AND inv.inv_date_sk = 2450815 GROUP BY cs.cs_call_center_sk, call_center_name, cp.cp_catalog_page_id, cp.cp_department, cd.cd_marital_status ORDER BY total_revenue DESC, total_profit DESC LIMIT 100;
SELECT cd.cd_gender, cd.cd_marital_status, td.t_shift, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_units_sold, SUM(ss.ss_net_paid) AS total_revenue, AVG(ss.ss_net_paid) AS average_revenue_per_transaction, SUM(CASE WHEN p.p_channel_dmail = 'Y' THEN 1 ELSE 0 END) AS total_dmail_promotions, SUM(CASE WHEN p.p_channel_email = 'Y' THEN 1 ELSE 0 END) AS total_email_promotions, SUM(CASE WHEN p.p_channel_tv = 'Y' THEN 1 ELSE 0 END) AS total_tv_promotions FROM store_sales ss JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN time_dim td ON ss.ss_sold_time_sk = td.t_time_sk LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE ss.ss_hdemo_sk IN ('4855', '5486') GROUP BY cd.cd_gender, cd.cd_marital_status, td.t_shift ORDER BY total_revenue DESC, total_units_sold DESC;
SELECT ib.ib_lower_bound, ib.ib_upper_bound, COUNT(hd.hd_demo_sk) AS household_count, AVG(hd.hd_dep_count) AS average_dependency_count, AVG(hd.hd_vehicle_count) AS average_vehicle_count, SUM(CASE WHEN p.p_channel_email = 'N' THEN p.p_cost ELSE 0 END) AS total_cost_non_email_promotions, SUM(CASE WHEN p.p_channel_tv = 'Y' THEN 1 ELSE 0 END) AS number_of_tv_promotions, SUM(CASE WHEN p.p_discount_active = 'Y' THEN p.p_response_target ELSE 0 END) AS total_target_with_active_discount, COUNT(DISTINCT CASE WHEN r.r_reason_desc = 'reason 27' THEN hd.hd_demo_sk ELSE NULL END) AS count_households_reason_27 FROM household_demographics hd LEFT JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk LEFT JOIN promotion p ON hd.hd_demo_sk = p.p_item_sk LEFT JOIN reason r ON p.p_promo_sk = r.r_reason_sk WHERE hd.hd_income_band_sk IN (15, 9, 18, 20) AND p.p_purpose <> 'Unknown' AND ib.ib_lower_bound IN (110001, 100001, 130001) AND ib.ib_upper_bound <> 70000 GROUP BY ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ib.ib_lower_bound, ib.ib_upper_bound;
SELECT c.c_birth_country, COUNT(DISTINCT c.c_customer_sk) AS num_customers, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_net_paid_inc_tax) AS avg_net_paid_inc_tax, SUM(CASE WHEN ss.ss_net_paid_inc_tax > 1000 THEN ss.ss_quantity ELSE 0 END) AS quantity_sold_above_1000, COUNT(DISTINCT p.p_promo_sk) AS num_promotions, SUM(p.p_cost) AS total_promotion_cost, w.w_state, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft FROM customer c JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN warehouse w ON w.w_zip = c.c_current_addr_sk::character varying WHERE c.c_birth_country IN ('THAILAND', 'ITALY') AND ss.ss_net_paid_inc_tax::text IN ('307.45', '859.21', '1169.72', '3293.51', '222.26') GROUP BY c.c_birth_country, w.w_state ORDER BY total_quantity_sold DESC;
SELECT sm.sm_type AS shipping_type, web.web_site_sk AS website_id, web.web_name AS website_name, i.i_category AS product_category, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_incl_tax, SUM(ws.ws_net_paid_inc_ship) AS total_net_paid_incl_shipping, SUM(ws.ws_net_paid_inc_ship_tax) AS total_net_paid_incl_shipping_tax, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk WHERE sm.sm_type IN ('REGULAR', 'EXPRESS', 'OVERNIGHT') AND web.web_country = 'United States' AND ws.ws_warehouse_sk IN (2, 4) AND i.i_category IN ('Electronics', 'Women', 'Children', 'Home', 'Sports', 'Books') AND dd.d_year = 1999 GROUP BY shipping_type, website_id, website_name, product_category ORDER BY total_net_profit DESC, total_net_paid DESC, website_name, product_category;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, COUNT(*) AS total_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, AVG(ss.ss_sales_price) AS avg_sales_price, s.s_state, s.s_city, t.t_shift FROM customer_demographics cd JOIN store_sales ss ON cd.cd_demo_sk = ss.ss_cdemo_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE cd.cd_dep_count IN (1, 2) AND s.s_market_id IS NOT NULL GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, s.s_state, s.s_city, t.t_shift ORDER BY total_net_paid DESC, s.s_state, s.s_city LIMIT 100;
SELECT web_site.web_site_id, web_site.web_class, web_site.web_name, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_quantity) AS total_web_quantity_sold, AVG(ws.ws_net_paid) AS avg_web_net_paid, SUM(cr.cr_return_quantity) AS total_catalog_returned_quantity, AVG(cr.cr_return_amount) AS avg_catalog_return_amount, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, SUM(sr.sr_return_amt) AS total_store_return_amount, s.s_store_name, s.s_state, COUNT(DISTINCT cs.cs_order_number) AS total_catalog_orders, SUM(cs.cs_quantity) AS total_catalog_quantity_sold, AVG(cs.cs_net_paid_inc_tax) AS avg_catalog_net_paid_inc_tax, time_dim.t_shift, time_dim.t_sub_shift FROM web_sales ws LEFT JOIN web_site ON ws.ws_web_site_sk = web_site.web_site_sk LEFT JOIN catalog_sales cs ON ws.ws_order_number = cs.cs_order_number LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number LEFT JOIN store_returns sr ON cr.cr_order_number = sr.sr_ticket_number LEFT JOIN store s ON sr.sr_store_sk = s.s_store_sk LEFT JOIN time_dim ON ws.ws_sold_time_sk = time_dim.t_time_sk WHERE s.s_gmt_offset = '-5.00' AND COALESCE(CAST(s.s_closed_date_sk AS TEXT), '') NOT IN ('2451044', '2451189') AND cr.cr_return_quantity IN (95, 94, 84, 23) AND cr.cr_ship_mode_sk IN (14, 5, 19, 8, 2) AND (time_dim.t_sub_shift = 'night' OR time_dim.t_shift = 'third') AND cs.cs_bill_customer_sk IN (49534, 61995) AND cs.cs_net_paid = 3022.20 GROUP BY web_site.web_site_id, web_site.web_class, web_site.web_name, s.s_store_name, s.s_state, time_dim.t_shift, time_dim.t_sub_shift ORDER BY web_site.web_name, s.s_store_name LIMIT 100;
SELECT s.s_store_name, w.w_warehouse_name, COUNT(ss.ss_ticket_number) AS total_sales_transactions, AVG(ss.ss_net_paid) AS avg_transaction_amount, SUM(ss.ss_net_paid_inc_tax) AS total_revenue_inc_tax, SUM(wr.wr_return_amt_inc_tax) AS total_returns_inc_tax, (SUM(ss.ss_net_paid_inc_tax) - SUM(wr.wr_return_amt_inc_tax)) AS net_revenue_inc_tax, AVG(wr.wr_fee) AS avg_return_fee, SUM(wr.wr_net_loss) AS total_net_loss_from_returns FROM store s JOIN store_sales ss ON s.s_store_sk = ss.ss_store_sk LEFT JOIN web_returns wr ON ss.ss_ticket_number = wr.wr_order_number JOIN warehouse w ON s.s_state = w.w_state GROUP BY s.s_store_name, w.w_warehouse_name ORDER BY net_revenue_inc_tax DESC, s.s_store_name;
SELECT d_year, d_quarter_name, COUNT(DISTINCT ss_store_sk) AS num_stores, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_net_sales, AVG(ss_net_profit) AS average_net_profit_per_sale, SUM(wr_return_quantity) AS total_quantity_returned, SUM(wr_net_loss) AS total_net_loss_from_returns, SUM(CASE WHEN hd_vehicle_count = 1 THEN ss_quantity ELSE 0 END) AS quantity_sold_to_1_vehicle_households, AVG(ib_upper_bound) AS average_income_upper_bound, COUNT(DISTINCT r_reason_sk) AS num_unique_return_reasons FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN web_returns ON ss_item_sk = wr_item_sk AND ss_ticket_number = wr_order_number JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN income_band ON hd_income_band_sk = ib_income_band_sk JOIN reason ON wr_reason_sk = r_reason_sk WHERE d_moy IN ('5', '1', '8') AND d_quarter_seq IN ('2', '1', '23') AND ss_sold_time_sk IN ('39484', '37900', '53685') AND ss_cdemo_sk IN ('933209', '1833335', '684959') AND ss_promo_sk IN ('42', '2', '164') AND ss_ext_list_price IN ('528.86', '6921.13', '4979.70') GROUP BY d_year, d_quarter_name ORDER BY d_year, d_quarter_name;
SELECT i.i_category AS item_category, cc.cc_state AS call_center_state, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_sales_price) AS average_sales_price, AVG(ss.ss_ext_discount_amt) AS average_discount_amount FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN call_center cc ON cc.cc_call_center_sk = ss.ss_store_sk WHERE i.i_current_price BETWEEN 4.63 AND 18.31 AND ss.ss_sold_date_sk IS NOT NULL GROUP BY i.i_category, cc.cc_state ORDER BY total_sales DESC, item_category, call_center_state;
