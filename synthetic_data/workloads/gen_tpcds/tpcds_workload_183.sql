SELECT ca_state, r_reason_desc, COUNT(*) AS total_returns, SUM(sr_return_quantity) AS total_returned_quantity, AVG(sr_return_amt_inc_tax) AS average_return_amount_inc_tax, SUM(ss_net_paid_inc_tax) AS total_sales_amount_inc_tax, AVG(ss_quantity) AS average_quantity_sold, SUM(ss_net_profit) AS total_net_profit FROM store_returns JOIN store_sales ON store_returns.sr_item_sk = store_sales.ss_item_sk AND store_returns.sr_ticket_number = store_sales.ss_ticket_number JOIN reason ON store_returns.sr_reason_sk = reason.r_reason_sk JOIN customer_address ON store_returns.sr_addr_sk = customer_address.ca_address_sk GROUP BY ca_state, r_reason_desc ORDER BY ca_state, r_reason_desc;
SELECT sm.sm_code AS shipping_mode, s.s_store_name AS store_name, cc.cc_name AS call_center_name, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_customers, COUNT(DISTINCT ws.ws_order_number) AS total_web_sales_orders, SUM(ws.ws_net_profit) AS total_web_sales_profit FROM catalog_returns cr JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN store s ON cc.cc_division = s.s_division_id JOIN web_sales ws ON cr.cr_item_sk = ws.ws_item_sk AND cr.cr_order_number = ws.ws_order_number WHERE cr.cr_returned_date_sk BETWEEN 2450952 AND 2451063 AND sm.sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') AND s.s_hours IN ('8AM-12AM', '8AM-4PM') GROUP BY shipping_mode, store_name, call_center_name ORDER BY total_returns DESC, total_return_amount DESC;
SELECT cd.cd_education_status, sm.sm_type, p.p_promo_name, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(DISTINCT CASE WHEN cd.cd_credit_rating = 'High Risk' THEN ss.ss_ticket_number END) AS high_risk_sales_transactions, COUNT(DISTINCT CASE WHEN cd.cd_credit_rating = 'Low Risk' THEN ss.ss_ticket_number END) AS low_risk_sales_transactions, COUNT(DISTINCT CASE WHEN cd.cd_credit_rating = 'Unknown' THEN ss.ss_ticket_number END) AS unknown_risk_sales_transactions FROM store_sales ss JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = ss.ss_addr_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE cd.cd_purchase_estimate IN ('2000', '1000', '4500') AND cd.cd_dep_employed_count = '0' AND sm.sm_ship_mode_sk IN ('13', '8', '20') AND sm.sm_type IN ('OVERNIGHT', 'NEXT DAY', 'EXPRESS') AND p.p_promo_name SIMILAR TO '%(eing|ation|able)%' AND p.p_promo_id IN ('AAAAAAAAJEAAAAAA', 'AAAAAAAALABAAAAA', 'AAAAAAAALNAAAAAA') AND p.p_channel_email = 'N' AND p.p_channel_event = 'N' AND ss.ss_ext_wholesale_cost IN ('3979.00', '2858.52', '5927.86') AND ss.ss_addr_sk IN ('19112', '41507', '33733') AND ss.ss_wholesale_cost IN ('17.80', '5.24', '22.67') AND ss.ss_sold_time_sk IN ('35178', '54001', '41756') GROUP BY cd.cd_education_status, sm.sm_type, p.p_promo_name ORDER BY total_net_profit DESC, total_sales_transactions DESC, average_sales_price DESC;
SELECT ca_state, cd_gender, cd_marital_status, sm_type, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(sr_return_quantity) AS total_quantity_returned, AVG(sr_return_amt) AS average_return_amount, SUM(sr_net_loss) AS total_net_loss FROM store_sales JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN customer_demographics ON ss_cdemo_sk = cd_demo_sk JOIN ship_mode ON sm_ship_mode_sk = ss_promo_sk LEFT JOIN store_returns ON sr_ticket_number = ss_ticket_number AND sr_item_sk = ss_item_sk WHERE ca_state IS NOT NULL AND cd_gender IN ('M', 'F') AND cd_marital_status IN ('M', 'U', 'S', 'D') GROUP BY ca_state, cd_gender, cd_marital_status, sm_type ORDER BY total_quantity_sold DESC, average_sales_price DESC;
SELECT i.i_category, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(DISTINCT ss.ss_item_sk) AS item_count, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_sales_price) AS average_sale_price FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk AND p.p_channel_catalog = 'N' AND p.p_channel_email = 'N' WHERE ss.ss_customer_sk IS NOT NULL AND p.p_promo_sk IS NULL GROUP BY i.i_category, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY total_sales DESC, i.i_category, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status;
SELECT w_state, s_county, p_promo_name, COUNT(*) AS num_sales, SUM(cs_net_paid) AS total_net_sales, AVG(cs_net_profit) AS avg_net_profit, SUM(ws_net_paid) AS total_web_net_sales, AVG(ws_net_profit) AS avg_web_net_profit FROM warehouse JOIN catalog_sales ON cs_warehouse_sk = w_warehouse_sk JOIN web_sales ON ws_warehouse_sk = w_warehouse_sk JOIN promotion ON cs_promo_sk = p_promo_sk AND ws_promo_sk = p_promo_sk JOIN store ON w_state = s_state WHERE w_state = 'TN' AND s_county = 'Williamson County' AND (p_promo_id = 'AAAAAAAAIAAAAAAA' OR p_promo_id = 'AAAAAAAACAAAAAAA') GROUP BY w_state, s_county, p_promo_name ORDER BY total_net_sales DESC, total_web_net_sales DESC;
SELECT ca.ca_state, COUNT(DISTINCT ca.ca_address_sk) AS num_customers, AVG(inv.inv_quantity_on_hand) AS avg_inventory_quantity, t.t_shift, COUNT(DISTINCT inv.inv_warehouse_sk) AS num_warehouses FROM customer_address ca JOIN inventory inv ON ca.ca_address_sk = inv.inv_warehouse_sk JOIN time_dim t ON inv.inv_date_sk = t.t_time_sk WHERE t.t_shift IN ('Morning', 'Afternoon', 'Evening') GROUP BY ca.ca_state, t.t_shift ORDER BY ca.ca_state, t.t_shift;
SELECT p.p_promo_name, p.p_start_date_sk, p.p_end_date_sk, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_tickets, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sale_price, SUM(ss.ss_net_paid) AS total_net_sales, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages_accessed, AVG(wp.wp_char_count) AS average_webpage_char_count FROM promotion p JOIN store_sales ss ON p.p_promo_sk = ss.ss_promo_sk LEFT JOIN web_page wp ON ss.ss_customer_sk = wp.wp_customer_sk WHERE p.p_channel_email = 'N' AND ss.ss_hdemo_sk IN (4351, 333, 293, 976, 2889) AND wp.wp_link_count IN ('20', '3', '19', '9', '6', '17') GROUP BY p.p_promo_name, p.p_start_date_sk, p.p_end_date_sk ORDER BY total_net_sales DESC, total_net_profit DESC;
SELECT ca.ca_state AS State, AVG(hd.hd_income_band_sk) AS Avg_Income_Band, AVG(hd.hd_dep_count) AS Avg_Dependent_Count, AVG(hd.hd_vehicle_count) AS Avg_Vehicle_Count, COUNT(*) FILTER (WHERE hd.hd_buy_potential = 'High') AS High_Buying_Potential_Count, COUNT(*) FILTER (WHERE hd.hd_buy_potential = 'Medium') AS Medium_Buying_Potential_Count, COUNT(*) FILTER (WHERE hd.hd_buy_potential = 'Low') AS Low_Buying_Potential_Count, COUNT(DISTINCT ca.ca_address_sk) AS Address_Count, AVG(ws.web_tax_percentage) AS Avg_Web_Tax_Percentage FROM customer_address ca JOIN household_demographics hd ON ca.ca_address_sk = hd.hd_demo_sk JOIN web_site ws ON ca.ca_state = ws.web_state WHERE ca.ca_country = 'United States' AND ws.web_country = 'United States' AND ca.ca_state IS NOT NULL AND ws.web_tax_percentage IS NOT NULL GROUP BY ca.ca_state ORDER BY Avg_Income_Band DESC, High_Buying_Potential_Count DESC, Medium_Buying_Potential_Count DESC, Low_Buying_Potential_Count DESC;
SELECT ws.web_site_id, ws.web_name, td.t_shift, td.t_hour, COUNT(wr.wr_order_number) AS return_count, SUM(wr.wr_return_quantity) AS total_return_quantity, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amt_inc_tax, SUM(wr.wr_return_amt_inc_tax) AS sum_return_amt_inc_tax, SUM(wr.wr_fee) AS total_fee, SUM(wr.wr_return_ship_cost) AS total_return_ship_cost, SUM(wr.wr_net_loss) AS total_net_loss FROM web_returns wr JOIN time_dim td ON wr.wr_returned_time_sk = td.t_time_sk JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk WHERE wr.wr_return_amt_inc_tax >= 100.00 AND td.t_shift = 'Evening' GROUP BY ws.web_site_id, ws.web_name, td.t_shift, td.t_hour ORDER BY ws.web_site_id, td.t_hour;
SELECT re.r_reason_desc AS return_reason, sm.sm_type AS ship_mode_type, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS sum_return_amount, SUM(cr.cr_return_tax) AS sum_return_tax, SUM(cr.cr_return_amt_inc_tax) AS sum_return_amt_inc_tax, SUM(cr.cr_fee) AS sum_fees, SUM(cr.cr_return_ship_cost) AS sum_return_ship_cost, SUM(cr.cr_refunded_cash) AS sum_refunded_cash, SUM(cr.cr_reversed_charge) AS sum_reversed_charge, SUM(cr.cr_store_credit) AS sum_store_credit, SUM(cr.cr_net_loss) AS sum_net_loss, wh.w_warehouse_name AS warehouse_name, st.s_store_name AS store_name FROM catalog_returns cr JOIN reason re ON cr.cr_reason_sk = re.r_reason_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse wh ON cr.cr_warehouse_sk = wh.w_warehouse_sk JOIN store st ON cr.cr_returning_customer_sk = st.s_store_sk GROUP BY return_reason, ship_mode_type, warehouse_name, store_name ORDER BY sum_net_loss DESC, total_returned_quantity DESC;
