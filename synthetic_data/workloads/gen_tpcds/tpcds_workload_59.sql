SELECT ca.ca_state AS State, AVG(hd.hd_income_band_sk) AS Avg_Income_Band, AVG(hd.hd_dep_count) AS Avg_Dependent_Count, AVG(hd.hd_vehicle_count) AS Avg_Vehicle_Count, COUNT(*) FILTER (WHERE hd.hd_buy_potential = 'High') AS High_Buying_Potential_Count, COUNT(*) FILTER (WHERE hd.hd_buy_potential = 'Medium') AS Medium_Buying_Potential_Count, COUNT(*) FILTER (WHERE hd.hd_buy_potential = 'Low') AS Low_Buying_Potential_Count, COUNT(DISTINCT ca.ca_address_sk) AS Address_Count, AVG(ws.web_tax_percentage) AS Avg_Web_Tax_Percentage FROM customer_address ca JOIN household_demographics hd ON ca.ca_address_sk = hd.hd_demo_sk JOIN web_site ws ON ca.ca_state = ws.web_state WHERE ca.ca_country = 'United States' AND ws.web_country = 'United States' AND ca.ca_state IS NOT NULL AND ws.web_tax_percentage IS NOT NULL GROUP BY ca.ca_state ORDER BY Avg_Income_Band DESC, High_Buying_Potential_Count DESC, Medium_Buying_Potential_Count DESC, Low_Buying_Potential_Count DESC;
SELECT dd.d_year, dd.d_quarter_name, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit, cc.cc_name AS call_center_name, cc.cc_division_name AS call_center_division, cc.cc_city AS call_center_city FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk WHERE dd.d_qoy IN (1, 2, 3, 4) AND dd.d_dom IN (20, 24) AND cc.cc_sq_ft IN ('4134', '1138', '2268') AND cc.cc_division IN ('1', '4') GROUP BY dd.d_year, dd.d_quarter_name, cc.cc_name, cc.cc_division_name, cc.cc_city ORDER BY dd.d_year, dd.d_quarter_name, total_net_profit DESC;
SELECT cp.cp_type, w.w_state, COUNT(cs.cs_order_number) AS total_sales_orders, SUM(cs.cs_quantity) AS total_sales_quantity, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_sales_net_paid, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_net_loss) AS total_returns_net_loss, COUNT(DISTINCT wr.wr_order_number) AS total_web_returns_orders, AVG(wr.wr_return_amt) AS average_web_return_amount, SUM(wr.wr_net_loss) AS total_web_returns_net_loss FROM catalog_sales cs JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk LEFT JOIN store_returns sr ON cs.cs_item_sk = sr.sr_item_sk AND cs.cs_order_number = sr.sr_ticket_number LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number WHERE cp.cp_type IN ('quarterly', 'bi-annual', 'monthly') AND cp.cp_end_date_sk IN (2450904, 2451574, 2451419, 2451634, 2451144) AND w.w_country = 'United States' GROUP BY cp.cp_type, w.w_state ORDER BY total_sales_net_paid DESC;
SELECT web.web_name AS website_name, cp.cp_department AS catalog_department, hd.hd_vehicle_count AS vehicle_count, r.r_reason_desc AS return_reason, COUNT(cr.cr_item_sk) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amt_inc_tax) AS avg_return_amount_incl_tax, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_incl_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_net_loss) AS total_net_loss FROM web_site web JOIN catalog_returns cr ON web.web_site_sk = cr.cr_returning_addr_sk JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk WHERE web.web_company_id IN ('4', '1', '3') AND cp.cp_end_date_sk IN ('2451144', '2451389') AND hd.hd_vehicle_count IN ('3', '1', '4', '0') GROUP BY web_name, cp_department, vehicle_count, return_reason ORDER BY total_returns DESC, total_return_amount DESC;
SELECT cd.cd_gender, cd.cd_marital_status, SUM(ss.ss_ext_sales_price) AS total_sales, AVG(ss.ss_coupon_amt) AS average_coupon_amt, COUNT(ss.ss_item_sk) AS total_items_sold, AVG(inv.inv_quantity_on_hand) AS average_inventory_on_hand FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN inventory inv ON ss.ss_item_sk = inv.inv_item_sk WHERE cd.cd_gender IN ('M', 'F') AND ss.ss_ext_sales_price IN (672.96, 2541.35, 528.00, 4835.54, 2912.12, 416.88) AND ss.ss_promo_sk IN (144, 107, 228, 186, 28, 37) AND inv.inv_warehouse_sk IN (1, 2) AND inv.inv_quantity_on_hand = 24 GROUP BY cd.cd_gender, cd.cd_marital_status ORDER BY cd.cd_gender, cd.cd_marital_status;
SELECT w_state, i_manufact_id, i_manufact, SUM(sr_return_amt + wr_return_amt) AS total_return_amount, AVG(sr_return_amt + wr_return_amt) AS avg_return_amount, COUNT(DISTINCT sr_ticket_number) AS count_store_returns, COUNT(DISTINCT wr_order_number) AS count_web_returns, SUM(CASE WHEN p_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS promo_related_returns FROM warehouse w LEFT JOIN store_returns sr ON w.w_warehouse_sk = sr.sr_addr_sk LEFT JOIN web_returns wr ON w.w_warehouse_sk = wr.wr_refunded_addr_sk LEFT JOIN item i ON i.i_item_sk = sr.sr_item_sk OR i.i_item_sk = wr.wr_item_sk LEFT JOIN promotion p ON p.p_item_sk = i.i_item_sk AND (sr.sr_returned_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk OR wr.wr_returned_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk) WHERE w_state = 'TN' AND i_manufact_id IN (70, 177, 479) GROUP BY w_state, i_manufact_id, i_manufact HAVING SUM(sr_return_amt + wr_return_amt) > 0 ORDER BY total_return_amount DESC;
SELECT s_store_id, s_state, s_city, COUNT(DISTINCT ss_ticket_number) AS num_transactions, SUM(ss_net_paid) AS total_sales, AVG(ss_sales_price) AS avg_sales_price, SUM(wr_return_amt_inc_tax) AS total_returns, COUNT(DISTINCT wr_order_number) AS num_returns, ARRAY_AGG(DISTINCT r_reason_desc) AS reasons_for_returns FROM store_sales AS ss JOIN store AS s ON ss.ss_store_sk = s.s_store_sk LEFT JOIN web_returns AS wr ON ss.ss_ticket_number = wr.wr_order_number LEFT JOIN reason AS r ON wr.wr_reason_sk = r.r_reason_sk JOIN date_dim AS dd ON ss.ss_sold_date_sk = dd.d_date_sk WHERE dd.d_quarter_seq = ( SELECT MAX(d_quarter_seq) FROM date_dim WHERE d_current_quarter = 'Y' ) AND s.s_state IN ('CA', 'TX', 'NY') GROUP BY s_store_id, s_state, s_city ORDER BY total_sales DESC, s_state, s_city;
SELECT COUNT(DISTINCT c.c_customer_sk) AS total_customers, AVG(w.w_warehouse_sq_ft) AS average_warehouse_size, SUM(p.p_cost) AS total_promotion_cost, s.s_state, s.s_city, COUNT(DISTINCT s.s_store_sk) AS total_stores, AVG(s.s_number_employees) AS average_store_employees FROM customer c JOIN store s ON c.c_current_addr_sk = s.s_store_sk JOIN warehouse w ON s.s_zip = w.w_zip JOIN promotion p ON p.p_channel_event = 'N' AND p.p_purpose != 'Unknown' GROUP BY s.s_state, s.s_city ORDER BY total_customers DESC, average_warehouse_size DESC, total_promotion_cost DESC;
SELECT c.cc_name, c.cc_state, AVG(s.s_number_employees) as avg_store_employees, SUM(sr.sr_return_amt) as total_return_amount, SUM(sr.sr_return_quantity) as total_returned_quantity, COUNT(DISTINCT hd.hd_demo_sk) as unique_household_count, AVG(cd.cd_purchase_estimate) as avg_purchase_estimate FROM call_center c JOIN store s ON c.cc_state = s.s_state AND c.cc_mkt_id = s.s_market_id JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk WHERE c.cc_class = 'small' AND cd.cd_purchase_estimate > 5000 AND hd.hd_income_band_sk IS NOT NULL AND sr.sr_return_ship_cost > 100 AND sr.sr_returned_date_sk IS NOT NULL GROUP BY c.cc_name, c.cc_state ORDER BY total_return_amount DESC, avg_store_employees DESC, unique_household_count DESC;
SELECT hd.hd_buy_potential, ib.ib_income_band_sk, sm.sm_carrier, r.r_reason_desc, COUNT(*) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_return_quantity) AS total_return_quantity, AVG(cr.cr_return_quantity) AS average_return_quantity FROM catalog_returns cr JOIN customer_demographics cd ON cr.cr_refunded_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON cr.cr_refunded_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk WHERE hd.hd_buy_potential = '5001-10000' AND ib.ib_lower_bound IN (90001, 30001, 60001) AND sm.sm_carrier IN ('GERMA', 'FEDEX', 'BARIAN') AND r.r_reason_desc IN ('Does not work with a product that I have', 'Did not get it on time', 'Did not like the color') GROUP BY hd.hd_buy_potential, ib.ib_income_band_sk, sm.sm_carrier, r.r_reason_desc ORDER BY total_return_amount DESC, total_returns DESC LIMIT 100;
SELECT ca_state, cc_division_name, AVG(cc_employees) AS avg_cc_employees, COUNT(DISTINCT cc_call_center_sk) AS num_call_centers, SUM(hd_dep_count) AS total_dependents, AVG(hd_vehicle_count) AS avg_num_vehicles, COUNT(DISTINCT c_customer_sk) AS num_customers, COUNT(CASE WHEN hd_buy_potential = '0-500' THEN 1 END) AS count_low_buy_potential, COUNT(CASE WHEN hd_buy_potential = '>10000' THEN 1 END) AS count_high_buy_potential FROM call_center JOIN customer ON c_current_cdemo_sk = cc_call_center_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk WHERE (cc_rec_end_date = '2000-12-31' OR cc_rec_end_date = '2001-12-31') AND hd_dep_count IN (4, 7, 0, 3) AND ca_street_name = 'Fourth Lakeview' GROUP BY ca_state, cc_division_name ORDER BY ca_state, cc_division_name;
SELECT d_year, d_quarter_name, cp_department, c_birth_country, COUNT(DISTINCT ws_order_number) AS total_orders, SUM(ws_quantity) AS total_quantity, AVG(ws_sales_price) AS average_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_profit) AS total_net_profit FROM web_sales JOIN date_dim ON web_sales.ws_sold_date_sk = date_dim.d_date_sk JOIN customer ON web_sales.ws_bill_customer_sk = customer.c_customer_sk JOIN catalog_page ON web_sales.ws_web_page_sk = catalog_page.cp_catalog_page_sk WHERE d_year = 2001 AND d_quarter_name IN ('1901Q1', '1911Q1', '1910Q2') AND ws_ext_discount_amt IN (262.20, 1117.90, 736.02) AND c_birth_country IS NOT NULL GROUP BY d_year, d_quarter_name, cp_department, c_birth_country ORDER BY d_year, d_quarter_name, cp_department, c_birth_country;
SELECT dd.d_year, cd.cd_education_status, count(distinct c.c_customer_sk) as num_customers, sum(wr.wr_return_amt) as total_return_amount, avg(wr.wr_fee) as average_fee, count(distinct wr.wr_order_number) as total_returned_orders, sum(ib.ib_upper_bound) as total_income_upper_bound FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate = ib.ib_income_band_sk JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk JOIN date_dim dd ON wr.wr_returned_date_sk = dd.d_date_sk JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk WHERE dd.d_year = 2023 AND ws.web_company_id IN ('2', '4', '6', '5', '1') AND ib.ib_upper_bound IN (80000, 110000, 130000, 160000) GROUP BY dd.d_year, cd.cd_education_status ORDER BY total_return_amount DESC, average_fee DESC;
SELECT c.c_last_name, c.c_first_name, ca.ca_city, ca.ca_state, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_items_sold, SUM(ss.ss_net_paid_inc_tax) AS total_sales_revenue, AVG(ss.ss_net_profit) AS avg_sales_profit, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions, SUM(sr.sr_return_quantity) AS total_items_returned, SUM(sr.sr_return_amt_inc_tax) AS total_returns_revenue, AVG(sr.sr_net_loss) AS avg_returns_loss, ib.ib_lower_bound, ib.ib_upper_bound, hd.hd_buy_potential FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE ca.ca_street_name IN ('9th Ninth', 'Jackson Sunset', 'Willow Davis') AND c.c_last_name IN ('Heller', 'Burrows') AND c.c_first_name IN ('Dolores', 'Sheree', 'James', 'Lee', 'Cassandra', 'Kayleen') AND hd.hd_buy_potential IN ('>10000', '501-1000', 'Unknown', '5001-10000', '0-500') AND sr.sr_return_amt = 1099.14 GROUP BY c.c_last_name, c.c_first_name, ca.ca_city, ca.ca_state, ib.ib_lower_bound, ib.ib_upper_bound, hd.hd_buy_potential ORDER BY c.c_last_name, c.c_first_name, ca.ca_city, ca.ca_state;
