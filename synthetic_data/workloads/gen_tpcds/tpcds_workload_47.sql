SELECT dd.d_year, i.i_category, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_profit) AS total_net_profit, COUNT(DISTINCT wr_order_number) AS total_returns, SUM(wr_return_quantity) AS total_quantity_returned, AVG(wr_return_amt) AS average_return_amount, SUM(wr_net_loss) AS total_net_loss FROM date_dim dd JOIN catalog_sales cs ON dd.d_date_sk = cs.cs_sold_date_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk LEFT JOIN web_returns wr ON i.i_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number WHERE dd.d_year = 2001 AND i.i_size = 'medium' AND ( wr.wr_refunded_hdemo_sk = '4852' OR wr.wr_fee IN ('29.43', '58.44') OR dd.d_same_day_lq IN ('2415041', '2417033', '2416545', '2418165', '2417025', '2416046') ) GROUP BY dd.d_year, i.i_category ORDER BY total_net_profit DESC, total_net_loss ASC;
SELECT dd.d_year, dd.d_quarter_name, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(cc.cc_employees) AS average_employees, SUM(CASE WHEN ws.web_country = 'United States' THEN 1 ELSE 0 END) AS total_us_websites FROM date_dim dd JOIN inventory inv ON dd.d_date_sk = inv.inv_date_sk JOIN customer c ON dd.d_date_sk = c.c_first_sales_date_sk JOIN call_center cc ON dd.d_date_sk = cc.cc_open_date_sk JOIN web_site ws ON dd.d_date_sk = ws.web_open_date_sk WHERE dd.d_year = 2022 AND inv.inv_warehouse_sk = 1 AND ws.web_county = 'Williamson County' AND ws.web_street_name IN ('Hickory 3rd', 'Broadway South', 'Cedar North', 'Railroad', 'Lake') AND dd.d_last_dom IN ('2419096', '2418790', '2417026', '2416844', '2419340', '2415871') AND dd.d_week_seq IN ('499', '115') AND c.c_salutation IN ('Mr.', 'Ms.', 'Mrs.') AND c.c_birth_day = 5 GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT p.p_promo_name, sm.sm_type AS shipping_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_net_paid) AS average_sales_per_order, SUM(cs.cs_net_profit) AS total_profit, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_quantity) AS total_web_quantity, SUM(ws.ws_net_paid) AS total_web_sales, AVG(ws.ws_net_paid) AS average_web_sales_per_order, SUM(ws.ws_net_profit) AS total_web_profit FROM promotion p LEFT JOIN catalog_sales cs ON p.p_promo_sk = cs.cs_promo_sk LEFT JOIN web_sales ws ON p.p_promo_sk = ws.ws_promo_sk LEFT JOIN ship_mode sm ON (cs.cs_ship_mode_sk = sm.sm_ship_mode_sk OR ws.ws_ship_mode_sk = sm.sm_ship_mode_sk) WHERE p.p_start_date_sk IN ('2450688', '2450248', '2450699', '2450857', '2450196', '2450745') AND (sm.sm_type IN ('EXPRESS', 'OVERNIGHT', 'TWO DAY', 'NEXT DAY') OR sm.sm_type IS NULL) AND (cs.cs_ship_customer_sk IN ('65147', '83434', '5487', '82518') OR ws.ws_ship_customer_sk IN ('65147', '83434', '5487', '82518')) AND p.p_channel_tv = 'N' GROUP BY p.p_promo_name, sm.sm_type ORDER BY total_sales DESC, total_web_sales DESC;
SELECT s.s_store_name, s.s_state, cc.cc_name AS call_center_name, cc.cc_class, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_quantity) AS average_return_quantity, COUNT(DISTINCT sr.sr_customer_sk) AS unique_customers_returning, COUNT(*) AS total_returns FROM store_returns sr JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN call_center cc ON s.s_market_id = cc.cc_mkt_id WHERE sr.sr_return_amt > 0 AND s.s_rec_end_date IN ('1999-03-13', '2000-03-12') AND s.s_floor_space IN (9294113, 5285950, 6995995, 5219562) AND sr.sr_store_sk IN (4, 2, 1, 10, 7) AND cc.cc_country = 'United States' GROUP BY s.s_store_name, s.s_state, cc.cc_name, cc.cc_class ORDER BY total_return_amount DESC, s.s_store_name, cc.cc_name;
SELECT p.p_promo_name, p.p_start_date_sk, p.p_end_date_sk, p.p_purpose, COUNT(DISTINCT cc.cc_call_center_sk) AS number_of_call_centers_involved, SUM(inv.inv_quantity_on_hand) AS total_inventory, SUM(wr.wr_return_quantity) AS total_returns, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_net_loss) AS total_net_loss FROM promotion p LEFT JOIN inventory inv ON p.p_item_sk = inv.inv_item_sk LEFT JOIN web_returns wr ON p.p_item_sk = wr.wr_item_sk LEFT JOIN call_center cc ON wr.wr_returned_date_sk BETWEEN cc.cc_open_date_sk AND cc.cc_closed_date_sk WHERE p.p_purpose <> 'Unknown' AND p.p_end_date_sk <= 2450916 GROUP BY p.p_promo_name, p.p_start_date_sk, p.p_end_date_sk, p.p_purpose ORDER BY total_returns DESC, avg_return_amount_inc_tax DESC LIMIT 100;
SELECT wd.web_class, COUNT(DISTINCT cr.cr_item_sk) AS unique_refunded_items, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_refunded_customers, SUM(cr.cr_return_amt_inc_tax + cr.cr_fee + cr.cr_return_ship_cost) AS total_refund_cost, AVG(cr.cr_return_amt_inc_tax) AS avg_refund_amount_inc_tax, cd.cd_education_status, COUNT(*) AS number_of_returns FROM catalog_returns cr JOIN customer_demographics cd ON cr.cr_refunded_cdemo_sk = cd.cd_demo_sk JOIN web_site wd ON wd.web_country = 'United States' AND wd.web_class IS NOT NULL WHERE EXISTS (SELECT 1 FROM inventory WHERE inv_item_sk = cr.cr_item_sk AND inv_quantity_on_hand > 500) GROUP BY wd.web_class, cd.cd_education_status ORDER BY total_refund_cost DESC, avg_refund_amount_inc_tax DESC, number_of_returns DESC;
SELECT ca_state, w_state, AVG(c_hd.hd_dep_count) AS avg_household_dep_count, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_profit) AS total_net_profit, SUM(ss_net_profit) AS total_store_net_profit FROM customer_address ca JOIN catalog_sales cs ON ca.ca_address_sk = cs.cs_bill_addr_sk JOIN household_demographics c_hd ON cs.cs_bill_hdemo_sk = c_hd.hd_demo_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN store_sales ss ON cs.cs_item_sk = ss.ss_item_sk AND cs.cs_order_number = ss.ss_ticket_number WHERE ca.ca_country = 'United States' AND w.w_country = 'United States' AND ss.ss_quantity > 5 AND cs.cs_quantity > 5 AND ca.ca_state IN ('CA', 'TX', 'NY') GROUP BY ca_state, w_state ORDER BY total_net_profit DESC, total_store_net_profit DESC, ca_state, w_state;
SELECT ws.web_site_id, ws.web_name, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(sr.sr_return_quantity) AS total_return_quantity, SUM(sr.sr_net_loss) AS total_net_loss, COUNT(DISTINCT inv.inv_item_sk) AS number_of_distinct_items_in_inventory, AVG(inv.inv_quantity_on_hand) AS avg_quantity_on_hand_per_warehouse, COUNT(DISTINCT inv.inv_warehouse_sk) AS number_of_warehouses FROM web_site ws LEFT JOIN store_returns sr ON ws.web_site_sk = sr.sr_store_sk LEFT JOIN inventory inv ON sr.sr_item_sk = inv.inv_item_sk WHERE ws.web_street_number IN ('805', '887', '247', '671', '835') AND inv.inv_date_sk = 2450815 AND sr.sr_hdemo_sk IN ('2871', '5640') AND inv.inv_warehouse_sk IN ('1', '2') GROUP BY ws.web_site_id, ws.web_name ORDER BY avg_return_amount_inc_tax DESC, total_return_quantity DESC, total_net_loss DESC;
SELECT d_year, ca_state, COUNT(DISTINCT c_customer_sk) AS num_customers, SUM(ss_quantity) AS total_quantity, AVG(ss_sales_price) AS avg_sales_price, SUM(ss_net_paid) AS total_net_paid, SUM(ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss_net_profit) AS total_net_profit FROM store_sales JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk JOIN customer ON store_sales.ss_customer_sk = customer.c_customer_sk JOIN customer_address ON customer.c_current_addr_sk = customer_address.ca_address_sk WHERE d_weekend = 'N' AND ss_list_price IN (79.50, 143.98, 117.62) AND ca_state IS NOT NULL GROUP BY d_year, ca_state ORDER BY d_year, ca_state;
SELECT w_state, w_city, ib.ib_income_band_sk AS income_band_sk, p_promo_name, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_sq_ft, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, COUNT(DISTINCT wr.wr_returned_date_sk) AS num_return_days, AVG(wr_return_amt_inc_tax) AS avg_return_amount_inc_tax FROM warehouse w JOIN web_returns wr ON w.w_warehouse_sk = wr.wr_returning_addr_sk JOIN income_band ib ON ib.ib_income_band_sk = wr.wr_returning_hdemo_sk JOIN promotion p ON p.p_item_sk = wr.wr_item_sk WHERE w_state = 'TN' AND w_city = 'Fairview' AND wr_reason_sk IN (7, 17, 21, 6) AND ib_upper_bound IN (50000, 190000, 80000) AND wr_returning_hdemo_sk IN (4812, 3393, 981, 1249) GROUP BY w_state, w_city, ib.ib_income_band_sk, p_promo_name ORDER BY total_return_amount_inc_tax DESC LIMIT 100;
SELECT c.c_salutation, sm.sm_type AS shipping_type, AVG(cs.cs_net_paid) AS average_net_paid, SUM(cs.cs_quantity) AS total_quantity_sold, COUNT(DISTINCT cs.cs_order_number) AS total_orders, ca.ca_state AS customer_state, ca.ca_country AS customer_country, COUNT(DISTINCT ca.ca_city) AS number_of_cities_sold_to FROM catalog_sales cs JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk WHERE cs.cs_ext_sales_price > 2500 AND sm.sm_ship_mode_id = 'AAAAAAAAGAAAAAAA' AND c.c_salutation = 'Mr.' GROUP BY c.c_salutation, sm.sm_type, ca.ca_state, ca.ca_country ORDER BY average_net_paid DESC, total_quantity_sold DESC;
SELECT dd.d_year, dd.d_quarter_name, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cr.cr_item_sk) AS distinct_items_returned, COUNT(DISTINCT cr.cr_returning_customer_sk) AS distinct_customers_returned, SUM(i.i_current_price * cr.cr_return_quantity) AS total_sales_lost, COUNT(DISTINCT wp.wp_web_page_sk) AS distinct_web_pages_accessed, SUM(wp.wp_char_count) AS total_web_chars FROM catalog_returns cr JOIN date_dim dd ON cr.cr_returned_date_sk = dd.d_date_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk LEFT JOIN web_page wp ON dd.d_date_sk = wp.wp_access_date_sk WHERE dd.d_current_day = 'N' AND dd.d_day_name IN ('Wednesday', 'Monday', 'Saturday', 'Thursday', 'Tuesday') AND cr.cr_returning_addr_sk IN ('13215', '22286', '5756', '38251', '6237') GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, COUNT(DISTINCT wr_returning_customer_sk) AS num_returning_customers, SUM(wr_return_quantity) AS total_returned_quantity, AVG(wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(wr_net_loss) AS total_net_loss, r_reason_desc, w_warehouse_name, w_city, w_state FROM web_returns JOIN customer_demographics ON web_returns.wr_returning_cdemo_sk = customer_demographics.cd_demo_sk JOIN reason ON web_returns.wr_reason_sk = reason.r_reason_sk JOIN warehouse ON web_returns.wr_returning_addr_sk = warehouse.w_warehouse_sk GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, r_reason_desc, w_warehouse_name, w_city, w_state ORDER BY total_net_loss DESC, avg_return_amount_inc_tax DESC LIMIT 100;
SELECT ca.ca_state, ib.ib_income_band_sk, i.i_category, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS avg_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN customer_address ca ON ws.ws_ship_addr_sk = ca.ca_address_sk JOIN income_band ib ON ws.ws_ship_hdemo_sk = ib.ib_income_band_sk WHERE i.i_class IN ('infants', 'diamonds', 'camcorders', 'karoke', 'pendants', 'wireless') AND ca.ca_street_name IN ('Oak Franklin', 'Park Fourteenth', '2nd 5th', 'Second Main') AND ws.ws_ship_hdemo_sk IN ('5884', '5775', '5849', '958', '2572') AND ws.ws_ext_list_price IN ('5273.64', '22629.95', '2666.62') AND ib.ib_income_band_sk IN ('1', '6', '14', '13', '2') GROUP BY ca.ca_state, ib.ib_income_band_sk, i.i_category ORDER BY total_net_profit DESC, ca.ca_state, ib.ib_income_band_sk, i.i_category;
SELECT ws.ws_web_site_sk, web.web_name, web.web_class, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, SUM(ws.ws_quantity) as total_quantity_sold, AVG(ws.ws_sales_price) as average_sales_price, COUNT(DISTINCT ws.ws_order_number) as total_orders, SUM(ws.ws_net_paid) as total_net_paid, SUM(ws.ws_net_paid_inc_tax) as total_net_paid_inc_tax, SUM(ws.ws_net_profit) as total_net_profit FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk AND p.p_response_target = '1' WHERE p.p_start_date_sk IN (2451635, 2451362, 2451818, 2451605, 2451420, 2451665) GROUP BY ws.ws_web_site_sk, web.web_name, web.web_class, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY total_net_profit DESC, web.web_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status;
SELECT dd.d_year, dd.d_moy, SUM(inv.inv_quantity_on_hand) AS total_quantity, AVG(inv.inv_quantity_on_hand) AS avg_quantity, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, COUNT(DISTINCT w.w_warehouse_sk) AS warehouses_involved, SUM(CASE WHEN p.p_channel_email = 'Y' THEN p.p_cost ELSE 0 END) AS total_promo_cost_email, SUM(CASE WHEN p.p_channel_tv = 'Y' THEN p.p_cost ELSE 0 END) AS total_promo_cost_tv, COUNT(DISTINCT CASE WHEN p.p_discount_active = 'Y' THEN p.p_promo_sk ELSE NULL END) AS active_discount_promos FROM inventory inv JOIN date_dim dd ON inv.inv_date_sk = dd.d_date_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN customer c ON dd.d_date_sk = c.c_first_sales_date_sk OR dd.d_date_sk = c.c_first_shipto_date_sk LEFT JOIN promotion p ON dd.d_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk WHERE dd.d_year = 1998 AND p.p_channel_event = 'N' AND dd.d_first_dom IN ('2416847', '2417850', '2417728', '2418946') AND inv.inv_warehouse_sk IN ('1', '2') AND c.c_birth_month IN ('3', '5', '6', '10', '4') GROUP BY dd.d_year, dd.d_moy ORDER BY dd.d_year, dd.d_moy;
SELECT d_year, cp_department, COUNT(DISTINCT c_customer_sk) AS number_of_customers, SUM(cr_return_quantity) AS total_return_quantity, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_fee) AS total_fee, SUM(cr_return_amt_inc_tax) AS total_return_amount_inc_tax, p_promo_name, COUNT(DISTINCT p_promo_sk) AS number_of_promotions_used FROM date_dim, customer, catalog_page, catalog_returns LEFT JOIN promotion ON cr_item_sk = p_item_sk WHERE cr_returned_date_sk = d_date_sk AND cr_refunded_customer_sk = c_customer_sk AND cr_catalog_page_sk = cp_catalog_page_sk AND d_year = 2022 AND p_channel_details = 'Good, foreign problems will n' AND cp_department IN ('Books', 'Electronics') AND c_preferred_cust_flag = 'Y' GROUP BY d_year, cp_department, p_promo_name ORDER BY d_year, avg_return_amount DESC, total_return_quantity DESC;
SELECT ca_state, ca_city, SUM(cs_net_paid_inc_tax) AS total_sales, AVG(cs_net_paid_inc_tax) AS avg_sales, COUNT(DISTINCT cs_order_number) AS num_sales_orders, SUM(cr_return_amt_inc_tax) AS total_returns, AVG(cr_return_amt_inc_tax) AS avg_returns, COUNT(DISTINCT cr_order_number) AS num_return_orders, SUM(cr_net_loss) AS total_net_loss FROM customer_address JOIN catalog_sales ON cs_bill_addr_sk = ca_address_sk LEFT JOIN catalog_returns ON cr_order_number = cs_order_number JOIN web_sales ON ws_order_number = cs_order_number JOIN time_dim ON ws_sold_time_sk = t_time_sk JOIN web_page ON ws_web_page_sk = wp_web_page_sk WHERE t_sub_shift = 'night' AND ws_ship_date_sk = 2450935 AND ws_web_page_sk IN (41, 3, 18, 4, 45) AND wp_creation_date_sk IN (2450810, 2450808, 2450812, 2450809) GROUP BY ca_state, ca_city ORDER BY ca_state, ca_city;
SELECT ca.ca_state AS customer_state, ib.ib_income_band_sk AS income_band, COUNT(DISTINCT c.c_customer_sk) AS num_customers, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_profit) AS total_profit FROM catalog_sales cs JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN income_band ib ON c.c_current_hdemo_sk = ib.ib_income_band_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE ib.ib_income_band_sk IN (19, 16) AND ca.ca_state IS NOT NULL AND p.p_discount_active = '1' AND cs.cs_sales_price IS NOT NULL GROUP BY ca.ca_state, ib.ib_income_band_sk ORDER BY total_profit DESC, avg_sales_price DESC, num_customers DESC;
SELECT i.i_category, cd.cd_gender, sm.sm_type, SUM(i.i_current_price) AS total_sales, AVG(i.i_wholesale_cost) AS average_wholesale, COUNT(DISTINCT inv.inv_warehouse_sk) AS unique_warehouses, COUNT(DISTINCT p.p_promo_sk) AS promotion_count FROM item AS i JOIN inventory AS inv ON i.i_item_sk = inv.inv_item_sk JOIN promotion AS p ON i.i_item_sk = p.p_item_sk AND p.p_channel_email = 'N' JOIN ship_mode AS sm ON sm.sm_ship_mode_sk = inv.inv_warehouse_sk JOIN customer_demographics AS cd ON cd.cd_demo_sk = i.i_manager_id WHERE i.i_rec_start_date <= '2023-01-01' AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date >= '2023-01-01') AND p.p_end_date_sk IN ('2450342', '2450365', '2450396', '2450787', '2450351') GROUP BY i.i_category, cd.cd_gender, sm.sm_type ORDER BY total_sales DESC, i.i_category, cd.cd_gender, sm.sm_type;
SELECT i.i_category AS item_category, COUNT(DISTINCT ss.ss_item_sk) AS total_items_sold, SUM(ss.ss_quantity) AS total_sales_quantity, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_sales_amount, COUNT(DISTINCT sr.sr_item_sk) AS total_items_returned, SUM(sr.sr_return_quantity) AS total_return_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax FROM item i LEFT JOIN store_sales ss ON i.i_item_sk = ss.ss_item_sk LEFT JOIN store_returns sr ON i.i_item_sk = sr.sr_item_sk GROUP BY i.i_category ORDER BY total_sales_amount DESC;
SELECT ca_state, i_category, COUNT(DISTINCT sr_customer_sk) AS unique_customers, SUM(sr_return_quantity) AS total_returned_quantity, AVG(sr_return_amt) AS average_return_amount, SUM(sr_return_amt) AS total_return_amount, SUM(sr_fee) AS total_fees_collected, SUM(sr_net_loss) AS total_net_loss FROM store_returns JOIN item ON sr_item_sk = i_item_sk JOIN customer_address ON sr_addr_sk = ca_address_sk WHERE sr_returned_date_sk IS NOT NULL AND sr_store_sk IN (4, 8, 10, 7, 2) AND ca_street_type = 'Cir.' GROUP BY ca_state, i_category ORDER BY ca_state, i_category;
SELECT ca.ca_city, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_profit) AS total_net_profit, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(CASE WHEN p.p_channel_tv = 'N' THEN cs.cs_net_paid_inc_tax ELSE 0 END) AS net_paid_no_tv_promo, AVG(cs.cs_ext_ship_cost) AS average_shipping_cost FROM catalog_sales cs JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk LEFT JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE ca.ca_city IN ('Murphy', 'Hubbard', 'Mount Olive') AND c.c_email_address IN ( 'Joe.Singer@R26XcAkIUF5.org', 'Johanna.Ross@EiP23U7Cb5aeav.org', 'Laurie.Johnson@0P2bV5aT.org', 'Jeanne.Clark@v1rrdNtTL7dd0hh.org' ) GROUP BY ca.ca_city ORDER BY total_net_paid DESC;
SELECT cu.c_salutation, wh.w_state, COUNT(DISTINCT cs.cs_order_number) AS total_sales_transactions, SUM(cs.cs_net_paid_inc_tax) AS total_sales_amount, AVG(cs.cs_ext_discount_amt) AS average_discount, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount FROM customer cu LEFT JOIN catalog_sales cs ON cu.c_customer_sk = cs.cs_ship_customer_sk LEFT JOIN store_returns sr ON cu.c_customer_sk = sr.sr_customer_sk LEFT JOIN warehouse wh ON (cs.cs_warehouse_sk = wh.w_warehouse_sk OR sr.sr_store_sk = wh.w_warehouse_sk) LEFT JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE (cs.cs_sold_date_sk IN ('2450819', '2450822', '2450817') OR sr.sr_returned_date_sk IN ('2450819', '2450822', '2450817')) AND (cu.c_salutation IN ('Dr.', 'Mr.', 'Sir', 'Ms.', 'Mrs.', 'Miss')) AND (wh.w_city = 'Fairview') AND (wh.w_suite_number IN ('Suite 80', 'Suite 0', 'Suite P', 'Suite 470')) AND (cu.c_last_review_date_sk IN ('2452425', '2452326', '2452389')) AND (sr.sr_reversed_charge IN ('44.04', '12.34') OR sr.sr_reversed_charge IS NULL) GROUP BY cu.c_salutation, wh.w_state ORDER BY total_sales_amount DESC, total_return_amount ASC;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_state, COUNT(wr.wr_return_amt) AS total_returns, SUM(wr.wr_return_amt) AS total_refund_amount, SUM(wr.wr_return_tax) AS total_refund_tax, AVG(wr.wr_return_amt) AS average_refund_amount FROM web_returns wr JOIN date_dim dd ON wr.wr_returned_date_sk = dd.d_date_sk JOIN customer_address ca ON wr.wr_returning_addr_sk = ca.ca_address_sk WHERE wr.wr_return_amt > 100.00 AND ca.ca_state = 'CA' GROUP BY dd.d_year, dd.d_quarter_name, dd.d_quarter_seq, ca.ca_state ORDER BY dd.d_year, dd.d_quarter_seq;
