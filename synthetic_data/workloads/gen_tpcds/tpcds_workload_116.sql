SELECT ca.ca_state, ca.ca_city, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit, p.p_promo_name, SUM(CASE WHEN p.p_channel_press = 'N' THEN cs.cs_net_paid ELSE 0 END) AS net_paid_no_press_promo, SUM(cs.cs_coupon_amt) AS total_coupon_amount FROM customer_address ca JOIN catalog_sales cs ON ca.ca_address_sk = cs.cs_ship_addr_sk LEFT JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE ca.ca_address_sk IN (957, 1773) AND cs.cs_coupon_amt IN (278.88, 333.46, 10.60) AND p.p_channel_press = 'N' AND p.p_start_date_sk IN (2450607, 2450356, 2450342, 2450745) GROUP BY ca.ca_state, ca.ca_city, p.p_promo_name ORDER BY total_net_profit DESC, total_quantity_sold DESC;
SELECT dd.d_year, cc.cc_country, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sales_price, COUNT(DISTINCT wp.wp_web_page_sk) AS webpage_count, SUM(ss.ss_net_paid) - SUM(ss.ss_net_paid_inc_tax) AS total_tax_collected FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN call_center cc ON cc.cc_call_center_sk = ss.ss_store_sk LEFT JOIN web_page wp ON dd.d_date_sk = wp.wp_access_date_sk WHERE dd.d_current_week = 'N' AND cc.cc_country = 'United States' AND cc.cc_call_center_sk IN ('3', '1', '5') AND wp.wp_image_count IN ('1', '2', '4', '5', '6', '7') GROUP BY dd.d_year, cc.cc_country ORDER BY dd.d_year, total_quantity_sold DESC;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, AVG(ss.ss_sales_price) AS average_sale_price, SUM(ss.ss_net_paid) AS total_sales, COUNT(ss.ss_ticket_number) AS number_of_sales FROM store_sales ss INNER JOIN call_center cc ON ss.ss_store_sk = cc.cc_call_center_sk GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_sales DESC, average_sale_price DESC LIMIT 10;
SELECT cc.cc_name, cc.cc_manager, c.cd_education_status, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, COUNT(DISTINCT c.cd_demo_sk) AS number_of_unique_customers FROM store_sales ss JOIN call_center cc ON ss.ss_store_sk = cc.cc_call_center_sk JOIN customer_demographics c ON ss.ss_cdemo_sk = c.cd_demo_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk JOIN catalog_page cp ON ss.ss_promo_sk = cp.cp_catalog_page_sk WHERE cc.cc_manager IN ('Larry Mccray', 'Felipe Perkins') AND cp.cp_type IN ('bi-annual', 'monthly', 'quarterly') AND t.t_hour BETWEEN 0 AND 1 AND c.cd_dep_college_count = 0 AND ss.ss_sold_date_sk IS NOT NULL GROUP BY cc.cc_name, cc.cc_manager, c.cd_education_status ORDER BY total_quantity_sold DESC, average_sales_price DESC;
SELECT d_year, d_quarter_name, cp_department, c_birth_country, COUNT(DISTINCT ws_order_number) AS total_orders, SUM(ws_quantity) AS total_quantity, AVG(ws_sales_price) AS average_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_profit) AS total_net_profit FROM web_sales JOIN date_dim ON web_sales.ws_sold_date_sk = date_dim.d_date_sk JOIN customer ON web_sales.ws_bill_customer_sk = customer.c_customer_sk JOIN catalog_page ON web_sales.ws_web_page_sk = catalog_page.cp_catalog_page_sk WHERE d_year = 2001 AND d_quarter_name IN ('1901Q1', '1911Q1', '1910Q2') AND ws_ext_discount_amt IN (262.20, 1117.90, 736.02) AND c_birth_country IS NOT NULL GROUP BY d_year, d_quarter_name, cp_department, c_birth_country ORDER BY d_year, d_quarter_name, cp_department, c_birth_country;
SELECT w_state, i_manufact_id, i_manufact, SUM(sr_return_amt + wr_return_amt) AS total_return_amount, AVG(sr_return_amt + wr_return_amt) AS avg_return_amount, COUNT(DISTINCT sr_ticket_number) AS count_store_returns, COUNT(DISTINCT wr_order_number) AS count_web_returns, SUM(CASE WHEN p_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS promo_related_returns FROM warehouse w LEFT JOIN store_returns sr ON w.w_warehouse_sk = sr.sr_addr_sk LEFT JOIN web_returns wr ON w.w_warehouse_sk = wr.wr_refunded_addr_sk LEFT JOIN item i ON i.i_item_sk = sr.sr_item_sk OR i.i_item_sk = wr.wr_item_sk LEFT JOIN promotion p ON p.p_item_sk = i.i_item_sk AND (sr.sr_returned_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk OR wr.wr_returned_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk) WHERE w_state = 'TN' AND i_manufact_id IN (70, 177, 479) GROUP BY w_state, i_manufact_id, i_manufact HAVING SUM(sr_return_amt + wr_return_amt) > 0 ORDER BY total_return_amount DESC;
SELECT w_state, ib_income_band_sk, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_net_paid) AS average_net_paid, SUM(cs_net_profit) AS total_profit, COUNT(DISTINCT ws_order_number) AS total_web_orders, SUM(ws_quantity) AS total_web_quantity, AVG(ws_net_paid_inc_ship) AS average_web_net_paid_inc_ship, SUM(ws_net_profit) AS total_web_profit, COUNT(DISTINCT wr_order_number) AS total_returns, SUM(wr_return_quantity) AS total_returned_quantity, AVG(wr_return_amt_inc_tax) AS average_return_amount_inc_tax, SUM(wr_net_loss) AS total_net_loss FROM warehouse w JOIN catalog_sales cs ON w.w_warehouse_sk = cs.cs_warehouse_sk JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN web_sales ws ON w.w_warehouse_sk = ws.ws_warehouse_sk JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number WHERE w.w_county = 'Williamson County' AND w.w_warehouse_sk IN (2, 3) AND cs.cs_ship_addr_sk IN (27775, 21962, 3537, 27769) AND wr.wr_refunded_customer_sk IN (51283, 671, 63734, 16023, 8581, 84835) AND ib.ib_lower_bound IN (80001, 30001, 0, 140001, 110001) GROUP BY w_state, ib_income_band_sk ORDER BY w_state, ib_income_band_sk;
SELECT w_state, w_city, ib.ib_income_band_sk AS income_band_sk, p_promo_name, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_sq_ft, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, COUNT(DISTINCT wr.wr_returned_date_sk) AS num_return_days, AVG(wr_return_amt_inc_tax) AS avg_return_amount_inc_tax FROM warehouse w JOIN web_returns wr ON w.w_warehouse_sk = wr.wr_returning_addr_sk JOIN income_band ib ON ib.ib_income_band_sk = wr.wr_returning_hdemo_sk JOIN promotion p ON p.p_item_sk = wr.wr_item_sk WHERE w_state = 'TN' AND w_city = 'Fairview' AND wr_reason_sk IN (7, 17, 21, 6) AND ib_upper_bound IN (50000, 190000, 80000) AND wr_returning_hdemo_sk IN (4812, 3393, 981, 1249) GROUP BY w_state, w_city, ib.ib_income_band_sk, p_promo_name ORDER BY total_return_amount_inc_tax DESC LIMIT 100;
SELECT ca.ca_state, ca.ca_city, COUNT(DISTINCT c.c_customer_sk) AS num_customers, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_inc_tax, AVG(wr.wr_return_quantity) AS average_return_quantity, SUM(wr.wr_fee) AS total_fees, AVG(cd.cd_purchase_estimate) AS average_purchase_estimate FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN web_returns wr ON c.c_customer_sk = wr.wr_refunded_customer_sk WHERE ca.ca_state IN ('CA', 'WA', 'GA') AND cd.cd_education_status IN ('College', '4 yr Degree', 'Advanced Degree') AND wr.wr_net_loss > 500 GROUP BY ca.ca_state, ca.ca_city ORDER BY total_return_amount_inc_tax DESC, ca.ca_state, ca.ca_city;
SELECT ca.ca_state AS state, i.d_year AS fiscal_year, COUNT(DISTINCT ss.ss_store_sk) AS num_stores, COUNT(DISTINCT ss.ss_item_sk) AS num_products_sold, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_sales, COUNT(DISTINCT sr.sr_store_sk) AS num_stores_with_returns, COUNT(DISTINCT sr.sr_item_sk) AS num_returned_products, SUM(sr.sr_return_quantity) AS total_quantity_returned, SUM(sr.sr_return_amt) AS total_returns, COUNT(DISTINCT cr.cr_call_center_sk) AS num_call_centers_with_returns, COUNT(DISTINCT cr.cr_item_sk) AS num_catalog_returned_products, SUM(cr.cr_return_quantity) AS total_catalog_quantity_returned, SUM(cr.cr_return_amount) AS total_catalog_returns FROM store_sales ss JOIN date_dim i ON ss.ss_sold_date_sk = i.d_date_sk JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number LEFT JOIN catalog_returns cr ON cr.cr_order_number = ss.ss_ticket_number WHERE i.d_fy_year = 2001 GROUP BY ca.ca_state, i.d_year ORDER BY ca.ca_state, i.d_year;
SELECT p.p_promo_id, p.p_promo_name, COUNT(ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws INNER JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk INNER JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk INNER JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk INNER JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE p.p_channel_press = 'N' AND hd.hd_vehicle_count IN (1, 2) AND ib.ib_income_band_sk IN (20, 8) AND p.p_purpose <> 'Unknown' GROUP BY p.p_promo_id, p.p_promo_name ORDER BY total_net_profit DESC, total_quantity_sold DESC;
SELECT ws.web_name, ws.web_class, ws.web_manager, ws.web_market_manager, COUNT(DISTINCT wp.wp_web_page_sk) AS total_pages, AVG(wp.wp_char_count) AS avg_char_count, SUM(wp.wp_link_count) AS total_link_count, SUM(wp.wp_image_count) AS total_image_count, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_fee) AS avg_return_fee, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS preferred_customer_count FROM web_site ws LEFT JOIN web_page wp ON ws.web_site_sk = wp.wp_customer_sk LEFT JOIN web_returns wr ON wp.wp_web_page_sk = wr.wr_web_page_sk LEFT JOIN customer c ON wr.wr_returning_customer_sk = c.c_customer_sk GROUP BY ws.web_name, ws.web_class, ws.web_manager, ws.web_market_manager ORDER BY total_return_amount DESC, total_pages DESC LIMIT 100;
SELECT cc.cc_name, cc.cc_city, st.s_store_name, st.s_city, SUM(ss.ss_net_profit) AS total_net_profit, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_quantity) AS total_quantity_sold, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions FROM call_center AS cc JOIN store_sales AS ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN store AS st ON ss.ss_store_sk = st.s_store_sk WHERE cc.cc_rec_start_date >= '2020-01-01' AND cc.cc_rec_end_date <= '2020-12-31' AND ss.ss_wholesale_cost BETWEEN 40 AND 90 AND (st.s_city = 'Fairview' OR st.s_city = 'Midway') AND cc.cc_employees >= 3 GROUP BY cc.cc_name, cc.cc_city, st.s_store_name, st.s_city HAVING SUM(ss.ss_net_profit) > 0 ORDER BY total_net_profit DESC, average_sales_price DESC;
SELECT d_year, sm_type, COUNT(DISTINCT inv_warehouse_sk) AS number_of_warehouses, SUM(inv_quantity_on_hand) AS total_quantity_on_hand, AVG(inv_quantity_on_hand) AS average_quantity_per_warehouse, MAX(inv_quantity_on_hand) AS max_quantity_in_warehouse, MIN(inv_quantity_on_hand) AS min_quantity_in_warehouse FROM inventory JOIN date_dim ON inv_date_sk = d_date_sk JOIN ship_mode ON sm_ship_mode_id = 'AAAAAAAAEAAAAAAA' WHERE d_year = 2023 AND d_day_name = 'Saturday' AND inv_warehouse_sk IN (1, 2) AND d_current_week = 'N' GROUP BY d_year, sm_type ORDER BY total_quantity_on_hand DESC, average_quantity_per_warehouse DESC LIMIT 100;
SELECT cc_state, r_reason_desc, SUM(inv_quantity_on_hand) AS total_inventory, AVG(c_birth_year) AS average_customer_birth_year, COUNT(DISTINCT c_customer_sk) AS unique_customers, COUNT(DISTINCT web_site_sk) AS web_sites_operating FROM inventory JOIN reason ON (r_reason_sk = inv_quantity_on_hand) JOIN call_center ON (cc_division = inv_warehouse_sk) JOIN customer ON (c_current_addr_sk = cc_open_date_sk) JOIN web_site ON (web_state = cc_state) WHERE inv_date_sk = 2450815 AND c_customer_id IN ('AAAAAAAACHMAAAAA', 'AAAAAAAANPEAAAAA') AND (cc_rec_end_date IS NULL OR cc_rec_end_date > CURRENT_DATE) AND (web_rec_end_date IS NULL OR web_rec_end_date > CURRENT_DATE) GROUP BY cc_state, r_reason_desc ORDER BY total_inventory DESC, average_customer_birth_year;
SELECT p.p_channel_dmail AS promo_channel_direct_mail, p.p_channel_email AS promo_channel_email, p.p_channel_catalog AS promo_channel_catalog, p.p_channel_tv AS promo_channel_tv, p.p_channel_radio AS promo_channel_radio, p.p_channel_press AS promo_channel_press, p.p_channel_event AS promo_channel_event, p.p_channel_demo AS promo_channel_demo, COUNT(p.p_promo_sk) AS num_promotions, SUM(p.p_cost) AS total_promo_cost, AVG(p.p_cost) AS avg_promo_cost, SUM(i.inv_quantity_on_hand) AS total_inventory_qty FROM promotion p LEFT JOIN inventory i ON p.p_item_sk = i.inv_item_sk WHERE p.p_discount_active = '1' GROUP BY promo_channel_direct_mail, promo_channel_email, promo_channel_catalog, promo_channel_tv, promo_channel_radio, promo_channel_press, promo_channel_event, promo_channel_demo ORDER BY num_promotions DESC, total_promo_cost DESC;
