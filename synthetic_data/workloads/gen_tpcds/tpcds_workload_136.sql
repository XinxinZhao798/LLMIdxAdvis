SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, hd.hd_buy_potential, hd.hd_dep_count, AVG(wr.wr_return_amt) AS avg_return_amount, AVG(wr.wr_return_tax) AS avg_return_tax, AVG(wr.wr_net_loss) AS avg_net_loss, COUNT(*) AS return_count FROM web_returns wr JOIN household_demographics hd ON wr.wr_returning_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN warehouse w ON wr.wr_returning_addr_sk = w.w_warehouse_sk WHERE w.w_city = 'Fairview' AND w.w_country = 'United States' AND hd.hd_buy_potential IN ('501-1000', '5001-10000', '0-500', '1001-5000', '>10000') GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, hd.hd_buy_potential, hd.hd_dep_count ORDER BY ib.ib_income_band_sk, hd.hd_buy_potential, hd.hd_dep_count;
SELECT ib_lower_bound, ib_upper_bound, COUNT(DISTINCT ws_bill_customer_sk) AS num_customers, SUM(ws_net_paid) AS total_sales, AVG(ws_quantity) AS avg_quantity_sold, SUM(cr_return_amount) AS total_returns, COUNT(DISTINCT cr_order_number) AS num_returned_orders FROM web_sales JOIN household_demographics ON ws_bill_hdemo_sk = hd_demo_sk JOIN income_band ON hd_income_band_sk = ib_income_band_sk LEFT JOIN catalog_returns ON ws_item_sk = cr_item_sk AND ws_order_number = cr_order_number GROUP BY ib_lower_bound, ib_upper_bound ORDER BY ib_lower_bound;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, COUNT(c.c_customer_sk) AS num_customers, SUM(CASE WHEN p.p_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS num_promotions_used, AVG(hd.hd_vehicle_count) AS avg_vehicles_per_household, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses_involved FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk LEFT JOIN promotion p ON p.p_start_date_sk <= c.c_first_sales_date_sk AND p.p_end_date_sk >= c.c_first_sales_date_sk JOIN warehouse w ON w.w_state = cd.cd_credit_rating WHERE cd.cd_purchase_estimate > 500 AND hd.hd_buy_potential IN ('5001-10000', '>10000') AND p.p_discount_active = 'Y' GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating ORDER BY avg_purchase_estimate DESC, num_customers DESC LIMIT 100;
SELECT p.p_promo_name, COUNT(ss.ss_ticket_number) AS total_sales_transactions, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_ext_discount_amt) AS total_discount_amount, SUM(ss.ss_coupon_amt) AS total_coupon_discount, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_including_tax, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE p.p_discount_active = 'Y' AND ss.ss_sold_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk GROUP BY p.p_promo_name ORDER BY total_net_profit DESC, total_sales_transactions DESC;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(i.i_current_price) AS average_item_price, COUNT(DISTINCT c.cd_demo_sk) AS unique_customer_count, SUM(CASE WHEN t.t_shift = 'Morning' THEN 1 ELSE 0 END) AS morning_shifts, SUM(CASE WHEN t.t_shift = 'Evening' THEN 1 ELSE 0 END) AS evening_shifts FROM call_center cc JOIN inventory inv ON cc.cc_call_center_sk = inv.inv_warehouse_sk JOIN item i ON inv.inv_item_sk = i.i_item_sk JOIN customer_demographics c ON i.i_manager_id = c.cd_demo_sk JOIN time_dim t ON inv.inv_date_sk = t.t_time_sk WHERE cc.cc_tax_percentage IN (0.01, 0.05, 0.11, 0.12) AND i.i_category_id IN (7, 6, 2, 9, 5, 10) AND t.t_time_id IN ('AAAAAAAALICBAAAA', 'AAAAAAAALJJAAAAA', 'AAAAAAAAEMJAAAAA', 'AAAAAAAAAEBAAAAA') GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_inventory DESC, average_item_price DESC, unique_customer_count DESC LIMIT 100;
SELECT cp.cp_department, cp.cp_type, COUNT(DISTINCT ws.ws_web_page_sk) AS total_web_pages, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ws.ws_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(ws.ws_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(ws.ws_net_profit) AS total_net_profit FROM catalog_page cp JOIN web_sales ws ON cp.cp_catalog_page_sk = ws.ws_web_page_sk WHERE cp.cp_end_date_sk = 2451114 AND ws.ws_ext_discount_amt = 2691.00 GROUP BY cp.cp_department, cp.cp_type ORDER BY total_net_paid DESC;
SELECT s.s_division_name, AVG(s.s_number_employees) as avg_employees, SUM(s.s_floor_space) as total_floor_space, COUNT(DISTINCT c.c_customer_sk) as total_customers, AVG(i.ib_upper_bound) as avg_income_upper_bound, MIN(i.ib_lower_bound) as min_income_lower_bound, COUNT(DISTINCT wp.wp_web_page_sk) as total_web_pages, SUM(wp.wp_image_count) as total_images FROM store s JOIN customer c ON s.s_store_sk = c.c_current_addr_sk LEFT JOIN income_band i ON i.ib_income_band_sk = c.c_current_hdemo_sk LEFT JOIN web_page wp ON wp.wp_customer_sk = c.c_customer_sk WHERE s.s_division_name <> 'Unknown' AND c.c_current_addr_sk IN (13536, 17282) AND c.c_first_shipto_date_sk = 2451994 AND i.ib_upper_bound IN (90000, 30000, 20000, 200000, 70000, 60000) AND i.ib_lower_bound > 110001 GROUP BY s.s_division_name ORDER BY total_customers DESC;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, COUNT(DISTINCT ss.ss_customer_sk) AS store_customer_count, SUM(ss.ss_quantity) AS store_quantity_sum, AVG(ss.ss_sales_price) AS store_average_sales_price, SUM(cs.cs_quantity) AS catalog_quantity_sum, AVG(cs.cs_sales_price) AS catalog_average_sales_price, SUM(ws.ws_quantity) AS web_quantity_sum, AVG(ws.ws_sales_price) AS web_average_sales_price, SUM(sr.sr_return_quantity) AS store_return_quantity_sum, SUM(wr.wr_return_quantity) AS web_return_quantity_sum, ib.ib_lower_bound, ib.ib_upper_bound FROM customer_demographics cd JOIN store_sales ss ON cd.cd_demo_sk = ss.ss_cdemo_sk JOIN catalog_sales cs ON cd.cd_demo_sk = cs.cs_bill_cdemo_sk JOIN web_sales ws ON cd.cd_demo_sk = ws.ws_bill_cdemo_sk JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk JOIN web_returns wr ON cd.cd_demo_sk = wr.wr_refunded_cdemo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating;
SELECT i.i_category, cc.cc_city, cc.cc_state, sum(cr.cr_return_amount) as total_return_amount, avg(cr.cr_return_amount) as avg_return_amount, count(cr.cr_order_number) as total_returns, count(DISTINCT cr.cr_returning_customer_sk) as unique_customers_returning, sum(cr.cr_return_quantity) as total_returned_items, sum(cr.cr_net_loss) as total_net_loss FROM catalog_returns cr JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN customer c ON cr.cr_returning_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE hd.hd_buy_potential IN ('0-500', 'Unknown') AND cc.cc_mkt_id IN (6, 2, 5) AND cr.cr_returning_cdemo_sk IN (877247, 315703, 978233, 1405433, 1704734, 711632) AND i.i_brand_id IN (9010001, 7011009, 9008009, 7006004, 6013007, 6016005) AND i.i_category IN ('Sports', 'Books', 'Shoes') GROUP BY i.i_category, cc.cc_city, cc.cc_state ORDER BY total_return_amount DESC, avg_return_amount DESC;
SELECT cd.cd_education_status, cd.cd_gender, cd.cd_marital_status, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(sr.sr_return_amt_inc_tax) AS total_returns_inc_tax, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, COUNT(sr.sr_item_sk) AS total_returned_items, SUM(sr.sr_net_loss) AS total_net_loss FROM customer_demographics cd JOIN customer c ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN web_page wp ON c.c_customer_sk = wp.wp_customer_sk WHERE c.c_first_shipto_date_sk IN ('2452105', '2451393') AND c.c_first_sales_date_sk IN ('2450519', '2451079') AND cd.cd_gender IN ('M', 'F') AND wp.wp_type IN ('feedback', 'general', 'protected') GROUP BY cd.cd_education_status, cd.cd_gender, cd.cd_marital_status ORDER BY total_returns_inc_tax DESC, avg_purchase_estimate DESC;
SELECT w.w_state AS warehouse_state, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_profit) AS total_net_profit, COUNT(DISTINCT cr.cr_order_number) AS total_returns, AVG(cr.cr_return_amount) AS average_return_amount FROM web_sales ws LEFT JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk LEFT JOIN catalog_returns cr ON ws.ws_item_sk = cr.cr_item_sk AND ws.ws_order_number = cr.cr_order_number WHERE ws.ws_sold_date_sk = 2450976 GROUP BY w.w_state ORDER BY total_net_profit DESC;
SELECT i.i_category, i.i_class, i.i_brand, cd.cd_gender, cd.cd_education_status, SUM(ws.ws_sales_price) AS total_sales, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(*) AS number_of_sales, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cr.cr_order_number) AS number_of_returns FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk LEFT JOIN catalog_returns cr ON ws.ws_order_number = cr.cr_order_number AND ws.ws_item_sk = cr.cr_item_sk LEFT JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk GROUP BY i.i_category, i.i_class, i.i_brand, cd.cd_gender, cd.cd_education_status ORDER BY i.i_category, i.i_class, i.i_brand, cd.cd_gender, cd.cd_education_status;
SELECT sm.sm_type, sm.sm_carrier, COUNT(DISTINCT wr.wr_item_sk) AS total_items_returned, SUM(wr.wr_return_quantity) AS total_quantity_returned, AVG(wr.wr_return_amt) AS average_return_amount, AVG(wr.wr_fee) AS average_fee, SUM(wr.wr_net_loss) AS total_net_loss, ws.web_name, ws.web_manager, ws.web_mkt_class, COUNT(DISTINCT ws.web_site_sk) AS total_sites FROM web_returns wr JOIN ship_mode sm ON wr.wr_returned_date_sk = sm.sm_ship_mode_sk JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk WHERE ws.web_mkt_id IN (3, 4, 6, 2) AND ws.web_street_name = 'Hickory 3rd' AND wr.wr_returned_date_sk BETWEEN 100 AND 200 GROUP BY sm.sm_type, sm.sm_carrier, ws.web_name, ws.web_manager, ws.web_mkt_class ORDER BY total_net_loss DESC, total_quantity_returned DESC LIMIT 10;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, SUM(cr.cr_return_quantity) AS total_catalog_return_quantity, AVG(cr.cr_return_amount) AS avg_catalog_return_amount, COUNT(DISTINCT cr.cr_order_number) AS num_catalog_orders_returned, SUM(sr.sr_return_quantity) AS total_store_return_quantity, AVG(sr.sr_return_amt) AS avg_store_return_amount, COUNT(DISTINCT sr.sr_ticket_number) AS num_store_tickets_returned, (SUM(cr.cr_return_quantity) + SUM(sr.sr_return_quantity)) AS total_combined_return_quantity, (SUM(cr.cr_return_amount) + SUM(sr.sr_return_amt)) AS total_combined_return_amount FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk LEFT JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_refunded_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk WHERE cd.cd_dep_college_count = 0 AND (cd.cd_dep_count = 1 OR cd.cd_dep_count = 2) AND (c.c_birth_month IN (1, 5, 8)) AND (cr.cr_refunded_cdemo_sk IN (720990, 944590, 673975, 63720) OR cr.cr_refunded_cdemo_sk IS NULL) AND (sr.sr_ticket_number::text IN ('40123', '36273') OR sr.sr_ticket_number IS NULL) GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY total_combined_return_amount DESC, c.c_customer_id;
