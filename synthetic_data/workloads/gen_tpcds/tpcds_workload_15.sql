SELECT s_state, s_city, p_channel_demo, p_promo_name, COUNT(DISTINCT sr_ticket_number) AS total_returns, SUM(sr_return_quantity) AS total_returned_quantity, AVG(sr_return_amt) AS average_return_amount, SUM(sr_net_loss) AS total_net_loss, COUNT(DISTINCT ss_ticket_number) AS total_sales, SUM(ss_quantity) AS total_sold_quantity, AVG(ss_sales_price) AS average_sales_price, SUM(ss_net_profit) AS total_net_profit FROM store_returns sr JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN store_sales ss ON sr.sr_item_sk = ss.ss_item_sk AND sr.sr_ticket_number = ss.ss_ticket_number JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk GROUP BY s_state, s_city, p_channel_demo, p_promo_name ORDER BY s_state, s_city, p_channel_demo, p_promo_name;
SELECT ws_order_number, COUNT(DISTINCT ws_item_sk) AS item_count, SUM(ws_quantity) AS total_quantity, AVG(ws_sales_price) AS avg_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ws_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(ws_net_profit) AS total_net_profit, MIN(ws_ext_ship_cost) AS min_shipping_cost, MAX(ws_ext_ship_cost) AS max_shipping_cost FROM web_sales JOIN catalog_sales ON ws_item_sk = cs_item_sk AND ws_order_number = cs_order_number JOIN store_sales ON ws_item_sk = ss_item_sk AND ws_order_number = ss_ticket_number JOIN web_page ON ws_web_page_sk = wp_web_page_sk JOIN inventory ON ws_item_sk = inv_item_sk WHERE ws_sales_price BETWEEN 100 AND 200 AND cs_sales_price BETWEEN 100 AND 200 AND ss_sales_price BETWEEN 100 AND 200 AND ws_ext_ship_cost BETWEEN 10 AND 1360 AND wp_type = 'Product Review' GROUP BY ws_order_number HAVING COUNT(DISTINCT ws_item_sk) > 1 ORDER BY total_net_profit DESC;
SELECT ca.ca_state, COUNT(DISTINCT c.c_customer_sk) AS num_customers, COUNT(wr.wr_order_number) AS num_returns, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_return_amt) AS avg_return_amount FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_refunded_customer_sk WHERE c.c_customer_sk IN (2939, 1085, 4773) GROUP BY ca.ca_state ORDER BY total_return_amount DESC, num_returns DESC;
SELECT channel, d_year, d_qoy, SUM(quantity) AS total_quantity_sold, SUM(ext_sales_price) AS total_sales_amount, AVG(sales_price) AS average_sales_price, SUM(net_profit) AS total_net_profit FROM ( SELECT 'web' AS channel, dd.d_year, dd.d_qoy, ws.ws_quantity AS quantity, ws.ws_ext_sales_price AS ext_sales_price, ws.ws_sales_price AS sales_price, ws.ws_net_profit AS net_profit FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk WHERE dd.d_current_year = 'Y' AND dd.d_qoy = 1 UNION ALL SELECT 'catalog' AS channel, dd.d_year, dd.d_qoy, cs.cs_quantity AS quantity, cs.cs_ext_sales_price AS ext_sales_price, cs.cs_sales_price AS sales_price, cs.cs_net_profit AS net_profit FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk WHERE dd.d_current_year = 'Y' AND dd.d_qoy = 1 ) sales_data GROUP BY channel, d_year, d_qoy ORDER BY channel, d_year, d_qoy;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk WHERE cc.cc_market_manager IN ('Julius Durham', 'Matthew Clifton', 'Gary Colburn', 'Julius Tran') GROUP BY ROLLUP(cc.cc_name, cc.cc_city, cc.cc_state, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status) ORDER BY cc.cc_name, cc.cc_city, cc.cc_state, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status;
SELECT i.i_category, ib.ib_income_band_sk, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_paid_inc_ship_tax) AS total_sales, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cr.cr_return_amount) AS total_returns, COUNT(DISTINCT cr.cr_order_number) AS total_return_orders FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN income_band ib ON c.c_current_cdemo_sk = ib.ib_income_band_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number WHERE cs.cs_sold_date_sk IS NOT NULL AND ( ib.ib_lower_bound IN (110001, 190001, 30001) OR ib.ib_income_band_sk IN (1, 9, 3) ) GROUP BY i.i_category, ib.ib_income_band_sk ORDER BY total_sales DESC, total_returns DESC;
SELECT d.d_year, d.d_quarter_name, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(wp.wp_link_count) AS avg_link_count, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS preferred_customers_count, SUM(CASE WHEN d.d_holiday = 'Y' THEN 1 ELSE 0 END) AS holiday_count FROM date_dim d JOIN customer c ON c.c_first_sales_date_sk = d.d_date_sk JOIN inventory inv ON inv.inv_date_sk = d.d_date_sk JOIN web_page wp ON wp.wp_access_date_sk = d.d_date_sk WHERE d.d_year = 2021 GROUP BY d.d_year, d.d_quarter_name ORDER BY d.d_year, d.d_quarter_name;
SELECT ca.ca_state, EXTRACT(YEAR FROM TO_DATE(c.c_first_shipto_date_sk::text, 'YYYYMMDD')) AS first_shipto_year, p.p_channel_details, COUNT(DISTINCT c.c_customer_sk) AS num_customers, AVG(ws.ws_net_profit) AS avg_web_net_profit, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, COUNT(DISTINCT ws.ws_order_number) AS num_web_orders, COUNT(DISTINCT sr.sr_ticket_number) AS num_returns FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk AND sr.sr_addr_sk = 23889 JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk WHERE c.c_birth_month IN (10, 6, 9, 7, 5) AND p.p_channel_catalog = 'N' AND ws.ws_list_price = 218.80 AND p.p_promo_id IN ('AAAAAAAAPLAAAAAA', 'AAAAAAAAOMAAAAAA', 'AAAAAAAACAAAAAAA') GROUP BY ca.ca_state, first_shipto_year, p.p_channel_details ORDER BY ca.ca_state, first_shipto_year, p.p_channel_details;
SELECT ca_state, ca_city, SUM(ws_quantity) AS total_quantity_sold, AVG(ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws_order_number) AS number_of_orders, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_profit) AS total_net_profit FROM web_sales JOIN customer_address ON web_sales.ws_ship_addr_sk = customer_address.ca_address_sk JOIN inventory ON web_sales.ws_item_sk = inventory.inv_item_sk WHERE web_sales.ws_web_site_sk IN ('16', '29', '24', '23', '3') AND inventory.inv_warehouse_sk IN ('1', '2') AND inventory.inv_item_sk IN ('9766', '15184', '10474', '14785', '12391') GROUP BY ca_state, ca_city ORDER BY total_net_profit DESC, total_quantity_sold DESC LIMIT 100;
SELECT ib.ib_income_band_sk, cc.cc_division_name, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amt_inc_tax, SUM(wr.wr_net_loss) AS total_net_loss, COUNT(wr.wr_returned_date_sk) AS total_returns, AVG(hd.hd_dep_count) AS avg_dependents, AVG(hd.hd_vehicle_count) AS avg_vehicles FROM web_returns wr JOIN household_demographics hd ON wr.wr_returning_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN call_center cc ON cc.cc_country = 'United States' AND cc.cc_call_center_sk = wr.wr_refunded_addr_sk WHERE hd.hd_income_band_sk IN (20, 8, 18, 11, 19, 2) GROUP BY ib.ib_income_band_sk, cc.cc_division_name ORDER BY total_net_loss DESC, avg_return_amt_inc_tax DESC;
SELECT cp.cp_department, i.i_category, i.i_brand, sm.sm_type, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN catalog_page cp ON i.i_item_sk = cp.cp_catalog_page_sk JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = ss.ss_item_sk WHERE cp.cp_type IN ('quarterly', 'bi-annual', 'monthly') AND cp.cp_description LIKE '%services%' AND i.i_product_name IN ('antin stpriought', 'eingcallyoughtable', 'antieseationese') AND ss.ss_coupon_amt IN (0.70, 58.75, 218.97) AND sm.sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') GROUP BY cp.cp_department, i.i_category, i.i_brand, sm.sm_type ORDER BY total_net_profit DESC, total_quantity_sold DESC;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, sum(cs.cs_quantity) AS total_quantity_sold, avg(cs.cs_sales_price) AS average_sales_price, sum(cs.cs_net_paid) AS total_net_paid, sum(cs.cs_net_profit) AS total_net_profit, sum(inv.inv_quantity_on_hand) AS total_inventory_quantity, avg(ws.web_tax_percentage) AS average_web_tax_percentage, count(DISTINCT wp.wp_web_page_sk) AS total_web_page_visits, count(DISTINCT wr.wr_order_number) AS total_web_returns, sum(wr.wr_return_amt) AS total_return_amount FROM customer c JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk JOIN inventory inv ON cs.cs_item_sk = inv.inv_item_sk JOIN web_site ws ON ws.web_company_id = c.c_current_addr_sk LEFT JOIN web_page wp ON ws.web_site_sk = wp.wp_customer_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number WHERE inv.inv_item_sk IN ('11134', '7144', '14296') AND inv.inv_warehouse_sk IN ('2', '1') AND cs.cs_catalog_page_sk IN ('2864', '4326', '4631') AND wp.wp_max_ad_count IN ('1', '0', '4') AND ws.web_tax_percentage IN ('0.07', '0.08', '0.01') AND ws.web_mkt_class IN ('Hands look again nice years. Alre', 'Only, temporary services', 'Severe, useful funds lift; just') AND ws.web_suite_number IN ('Suite 30', 'Suite J', 'Suite 460') AND ws.web_manager IN ('Robert Arnold', 'Harold Wilson', 'Jason Silva') AND c.c_customer_sk IN ('3151', '72', '3821') AND c.c_birth_day IN ('20', '2', '10') GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name ORDER BY total_net_profit DESC, total_quantity_sold DESC LIMIT 100;
SELECT w.w_warehouse_name, w.w_warehouse_sq_ft, w.w_city, w.w_state, ib.ib_lower_bound, ib.ib_upper_bound, AVG(cs.cs_sales_price) AS avg_sales_price, AVG(cs.cs_ext_discount_amt) AS avg_discount_amount, SUM(cs.cs_quantity) AS total_quantity_sold, COUNT(DISTINCT cs.cs_order_number) AS total_orders, COUNT(DISTINCT p.p_promo_sk) AS total_promotions_applied FROM catalog_sales cs JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk JOIN income_band ib ON cs.cs_bill_customer_sk = ib.ib_income_band_sk WHERE d.d_year = 2021 AND w.w_county = 'Williamson County' AND p.p_discount_active = 'Y' AND p.p_response_target > 50 AND cs.cs_sales_price IS NOT NULL AND cs.cs_ext_discount_amt IS NOT NULL GROUP BY w.w_warehouse_name, w.w_warehouse_sq_ft, w.w_city, w.w_state, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY avg_sales_price DESC, avg_discount_amount DESC;
SELECT wp_type AS web_page_type, ca_country AS customer_country, COUNT(DISTINCT wp_web_page_sk) AS num_web_pages, AVG(wp_char_count) AS avg_char_count, SUM(wp_link_count) AS total_link_count, SUM(wp_image_count) AS total_image_count FROM web_page JOIN customer_address ON wp_customer_sk = ca_address_sk JOIN reason ON wp_web_page_sk = r_reason_sk WHERE ca_county IN ('Worcester County', 'Tooele County', 'Page County', 'Wabaunsee County') AND r_reason_desc IN ('reason 27', 'unauthorized purchase', 'Did not get it on time', 'Gift exchange') AND r_reason_sk IN (26, 15, 5) GROUP BY web_page_type, customer_country ORDER BY avg_char_count DESC, total_link_count DESC;
SELECT w_state, w_city, i_category, i_class, i_brand, AVG(i_current_price) AS avg_price, SUM(inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT i_item_sk) AS unique_items_count, MAX(i_current_price) AS max_price, MIN(i_current_price) AS min_price, COUNT(DISTINCT hd_demo_sk) AS unique_households, AVG(hd_dep_count) AS avg_dependency_count FROM warehouse w JOIN inventory inv ON w.w_warehouse_sk = inv.inv_warehouse_sk JOIN item i ON inv.inv_item_sk = i.i_item_sk LEFT JOIN household_demographics hd ON hd.hd_income_band_sk = i.i_brand_id WHERE w.w_zip = '35709' AND w.w_state = 'TN' AND w.w_street_type IN ('Dr.', 'Drive', 'Parkway') AND w.w_city = 'Fairview' AND inv.inv_date_sk = 2450815 AND inv.inv_quantity_on_hand IN (396, 595, 454) AND inv.inv_warehouse_sk IN (2, 1) AND i.i_container = 'Unknown' AND i.i_item_sk IN (4699, 4967, 949) AND hd.hd_dep_count IN (4, 1, 6) AND hd.hd_income_band_sk IN (9, 18, 10) GROUP BY w_state, w_city, i_category, i_class, i_brand ORDER BY total_inventory DESC, avg_price DESC;
SELECT w.w_state AS warehouse_state, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_profit) AS total_net_profit, COUNT(DISTINCT cr.cr_order_number) AS total_returns, AVG(cr.cr_return_amount) AS average_return_amount FROM web_sales ws LEFT JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk LEFT JOIN catalog_returns cr ON ws.ws_item_sk = cr.cr_item_sk AND ws.ws_order_number = cr.cr_order_number WHERE ws.ws_sold_date_sk = 2450976 GROUP BY w.w_state ORDER BY total_net_profit DESC;
SELECT cc.cc_name AS call_center_name, i.i_category AS item_category, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN call_center cc ON ws.ws_bill_customer_sk = cc.cc_call_center_sk JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk JOIN time_dim t ON ws.ws_sold_time_sk = t.t_time_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk WHERE cc.cc_manager IN ('Bob Belcher', 'Felipe Perkins', 'Larry Mccray', 'Mark Hightower') AND i.i_container = 'Unknown' AND ws.ws_ship_hdemo_sk IN (6862, 4638, 2050, 5884, 1108) AND d.d_year = 2023 AND t.t_am_pm = 'PM' GROUP BY call_center_name, item_category ORDER BY total_net_profit DESC;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_credit_rating, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, COUNT(sr.sr_ticket_number) AS total_returns FROM customer_demographics cd JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk WHERE hd.hd_buy_potential IN ('5001-10000', '>10000') AND sr.sr_reversed_charge > 50 GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_credit_rating HAVING AVG(cd.cd_purchase_estimate) > 500 ORDER BY avg_purchase_estimate DESC, total_return_amount_inc_tax DESC;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, dd.d_year, SUM(ws.ws_ext_sales_price) AS total_sales, AVG(ws.ws_ext_sales_price) AS avg_sales, COUNT(*) AS number_of_sales, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_return_amount) AS avg_returns, COUNT(DISTINCT cr.cr_order_number) AS number_of_returns FROM web_sales ws JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk LEFT JOIN catalog_returns cr ON cr.cr_returned_date_sk = dd.d_date_sk AND cr.cr_refunded_customer_sk = c.c_customer_sk WHERE dd.d_year = 2001 GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, dd.d_year ORDER BY total_sales DESC, total_returns DESC LIMIT 100;
SELECT d_year, d_moy, sm_type, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_paid) AS total_revenue, SUM(cs_net_profit) AS total_profit, AVG(cs_quantity) AS average_quantity, AVG(cs_net_paid_inc_tax) AS average_revenue_inc_tax, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_quantity) AS average_return_quantity, COUNT(DISTINCT wp_web_page_sk) AS total_web_page_visits, COUNT(DISTINCT s_store_sk) AS total_stores, COUNT(DISTINCT cc_call_center_sk) AS total_call_centers FROM date_dim LEFT JOIN catalog_sales ON cs_sold_date_sk = d_date_sk LEFT JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk LEFT JOIN catalog_returns ON cr_returned_date_sk = d_date_sk LEFT JOIN web_page ON wp_access_date_sk = d_date_sk LEFT JOIN store ON s_store_sk = cs_ship_customer_sk LEFT JOIN call_center ON cc_call_center_sk = cs_call_center_sk LEFT JOIN customer_demographics ON cs_ship_cdemo_sk = cd_demo_sk WHERE d_year = 2001 AND d_moy BETWEEN 1 AND 6 AND cs_net_paid IS NOT NULL AND sm_type IS NOT NULL AND (cc_sq_ft = '3514' OR cc_sq_ft = '4134' OR cc_sq_ft = '1138') AND (cc_rec_end_date = '2000-12-31' OR cc_rec_end_date = '2001-12-31' OR cc_rec_end_date = '2000-01-01') AND (cc_company = '6' OR cc_company = '3' OR cc_company = '1') AND (cr_return_ship_cost = '2.66' OR cr_return_ship_cost = '13.49' OR cr_return_ship_cost = '26.44') AND (cr_catalog_page_sk = '380' OR cr_catalog_page_sk = '219' OR cr_catalog_page_sk = '388') AND (cr_returned_time_sk = '45077' OR cr_returned_time_sk = '77627' OR cr_returned_time_sk = '32496') AND (sm_contract = '2mM8l' OR sm_contract = 'uukTktPYycct8' OR sm_contract = 'fop0bcSd91J26IVpR') AND (sm_ship_mode_sk = '10' OR sm_ship_mode_sk = '6' OR sm_ship_mode_sk = '4') AND (sm_code = 'SEA' OR sm_code = 'BIKE' OR sm_code = 'SURFACE') AND (sm_carrier = 'FEDEX' OR sm_carrier = 'ZHOU' OR sm_carrier = 'PRIVATECARRIER') AND (cs_ext_tax = '89.97' OR cs_ext_tax = '687.10' OR cs_ext_tax = '221.70') AND (cs_ship_hdemo_sk = '2057' OR cs_ship_hdemo_sk = '6324' OR cs_ship_hdemo_sk = '6945') AND (cs_net_paid_inc_ship_tax = '1307.73' OR cs_net_paid_inc_ship_tax = '1740.39' OR cs_net_paid_inc_ship_tax = '1487.69') AND (d_weekend = 'N' OR d_weekend = 'Y') AND (s_gmt_offset = '-5.00') AND (s_store_sk = '1' OR s_store_sk = '12' OR s_store_sk = '9') AND (s_store_name = 'anti' OR s_store_name = 'ese' OR s_store_name = 'eing') AND (wp_access_date_sk = '2452555' OR wp_access_date_sk = '2452645' OR wp_access_date_sk = '2452576') AND (wp_customer_sk = '20213' OR wp_customer_sk = '98376' OR wp_customer_sk = '60150') AND (wp_web_page_id = 'AAAAAAAAEDAAAAAA' OR wp_web_page_id = 'AAAAAAAAHDAAAAAA' OR wp_web_page_id = 'AAAAAAAAOAAAAAAA') AND (wp_web_page_sk = '3' OR wp_web_page_sk = '17' OR wp_web_page_sk = '36') AND (cd_demo_sk = '18975' OR cd_demo_sk = '21210' OR cd_demo_sk = '20876') AND (cd_dep_count = '2' OR cd_dep_count = '1') GROUP BY d_year, d_moy, sm_type ORDER BY d_year, d_moy, sm_type;
SELECT dd.d_year, dd.d_quarter_name, i.i_category, i.i_brand, COUNT(DISTINCT ws.web_site_sk) AS number_of_websites, COUNT(DISTINCT wp.wp_web_page_sk) AS number_of_web_pages, COUNT(DISTINCT wr.wr_order_number) AS number_of_returns, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_return_quantity) AS avg_return_quantity, AVG(wr.wr_fee) AS avg_return_fee, hd.hd_dep_count, ib.ib_lower_bound AS income_band_lower_bound, ib.ib_upper_bound AS income_band_upper_bound, SUM(hd.hd_vehicle_count) AS total_vehicles FROM web_returns wr JOIN date_dim dd ON wr.wr_returned_date_sk = dd.d_date_sk JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk JOIN item i ON wr.wr_item_sk = i.i_item_sk JOIN web_site ws ON wp.wp_web_page_sk = ws.web_site_sk JOIN household_demographics hd ON wr.wr_returning_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE dd.d_year = 2001 AND i.i_category_id IN (1, 2, 3) AND wr.wr_return_tax > 100 AND hd.hd_income_band_sk = 10 AND wr.wr_refunded_cash BETWEEN 300 AND 4000 GROUP BY dd.d_year, dd.d_quarter_name, i.i_category, i.i_brand, hd.hd_dep_count, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_return_amount DESC, avg_return_quantity DESC, avg_return_fee DESC, number_of_websites, number_of_web_pages;
SELECT sm.sm_type AS shipping_type, sm.sm_code AS shipping_code, sm.sm_carrier AS carrier, COUNT(DISTINCT inv.inv_item_sk) AS unique_items_shipped, SUM(inv.inv_quantity_on_hand) AS total_quantity_on_hand, AVG(wr.wr_return_amt_inc_tax) AS average_return_amount_incl_tax, SUM(wr.wr_fee) AS total_return_fees, SUM(wr.wr_net_loss) AS total_net_loss, COUNT(DISTINCT wr.wr_order_number) AS total_return_orders, td.t_shift AS time_shift, COUNT(DISTINCT td.t_time_sk) AS total_shift_times FROM ship_mode sm JOIN inventory inv ON sm.sm_ship_mode_sk = inv.inv_warehouse_sk LEFT JOIN web_returns wr ON inv.inv_item_sk = wr.wr_item_sk LEFT JOIN time_dim td ON wr.wr_returned_time_sk = td.t_time_sk WHERE td.t_shift = 'third' AND inv.inv_warehouse_sk IN (1, 2) AND inv.inv_item_sk IN (15820, 14284, 6472) AND td.t_time_sk IN ('4753', '787', '4258') GROUP BY sm.sm_type, sm.sm_code, sm.sm_carrier, td.t_shift ORDER BY total_net_loss DESC;
SELECT d_year AS year, d_quarter_name AS quarter, sm_type AS shipping_type, p_promo_name AS promotion_name, COUNT(*) AS total_shipments, AVG(cd_purchase_estimate) AS average_purchase_estimate, SUM(p_cost) AS total_promotion_cost, COUNT(DISTINCT r_reason_sk) AS unique_reasons_count FROM date_dim JOIN promotion ON (d_date_sk = p_start_date_sk OR d_date_sk = p_end_date_sk) JOIN ship_mode ON sm_ship_mode_sk = 9 JOIN customer_demographics ON cd_credit_rating = 'Good' LEFT JOIN reason ON r_reason_desc IN ('Does not work with a product that I have', 'reason 32') WHERE d_year = 2023 AND sm_contract = 'O9V6oF8RJnLMmZYd1' AND p_discount_active = 'Y' GROUP BY year, quarter, shipping_type, promotion_name ORDER BY year, quarter, total_promotion_cost DESC;
SELECT w_state, COUNT(DISTINCT c_customer_sk) AS number_of_customers, AVG(inv_quantity_on_hand) AS average_inventory, SUM(case when c_preferred_cust_flag = 'Y' then 1 else 0 end) AS preferred_customer_count, MAX(wp_link_count) AS max_webpage_link_count, MIN(web_tax_percentage) AS min_tax_percentage FROM customer JOIN warehouse ON c_current_addr_sk = w_warehouse_sk JOIN inventory ON inv_warehouse_sk = w_warehouse_sk JOIN web_page ON wp_customer_sk = c_customer_sk JOIN web_site ON wp_web_page_sk = web_site_sk AND web_class <> 'Unknown' WHERE web_close_date_sk IN ('2446944', '2446978', '2447046') GROUP BY w_state ORDER BY number_of_customers DESC, average_inventory DESC;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_net_profit) AS avg_profit, COUNT(DISTINCT ss.ss_ticket_number) AS num_of_sales, SUM(sr.sr_net_loss) AS total_returns_loss, COUNT(DISTINCT sr.sr_ticket_number) AS num_of_returns, SUM(CASE WHEN sr.sr_refunded_cash > 0 THEN 1 ELSE 0 END) AS num_of_cash_refunds FROM customer c LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name HAVING SUM(ss.ss_net_paid) > 0 OR SUM(sr.sr_net_loss) > 0 ORDER BY total_sales DESC, total_returns_loss DESC;
SELECT s.s_state AS store_state, COUNT(DISTINCT s.s_store_sk) AS store_count, SUM(s.s_number_employees) AS total_employees, AVG(s.s_floor_space) AS avg_floor_space, ROUND(AVG(s.s_tax_precentage), 2) AS avg_store_tax_percentage, w.web_market_manager, COUNT(DISTINCT w.web_site_sk) AS website_count, ROUND(AVG(w.web_tax_percentage), 2) AS avg_website_tax_percentage, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound FROM store s JOIN web_site w ON s.s_market_id = w.web_mkt_id JOIN income_band ib ON ib.ib_lower_bound <= s.s_number_employees AND ib.ib_upper_bound >= s.s_number_employees WHERE s.s_state IN ('CA', 'TX', 'NY') AND w.web_market_manager IN ('Jarvis Allen', 'James Harris', 'Albert Leung', 'Philip Sampson') AND ib.ib_income_band_sk IN ('20', '5', '3', '2') GROUP BY s.s_state, w.web_market_manager, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY s.s_state, w.web_market_manager, ib.ib_income_band_sk;
SELECT i.i_category, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_items_sold, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(wr.wr_return_quantity) AS total_items_returned, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk LEFT JOIN web_returns wr ON cs.cs_order_number = wr.wr_order_number AND cs.cs_item_sk = wr.wr_item_sk WHERE cd.cd_purchase_estimate >= 10000 AND cd.cd_dep_employed_count = 0 GROUP BY i.i_category ORDER BY i.i_category;
SELECT cd.cd_education_status, cd.cd_credit_rating, AVG(sr.sr_return_amt) AS avg_store_return_amt, SUM(cr.cr_return_amount) AS sum_catalog_return_amt, COUNT(DISTINCT sr.sr_customer_sk) AS unique_store_customers, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_catalog_customers FROM customer_demographics cd LEFT JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk LEFT JOIN catalog_returns cr ON cd.cd_demo_sk = cr.cr_returning_cdemo_sk LEFT JOIN household_demographics hd ON cd.cd_demo_sk = hd.hd_demo_sk WHERE cd.cd_purchase_estimate IN (3500, 1500, 10000) AND cd.cd_dep_college_count = 0 AND hd.hd_income_band_sk IN (19, 8, 15, 3, 1) GROUP BY cd.cd_education_status, cd.cd_credit_rating ORDER BY avg_store_return_amt DESC, sum_catalog_return_amt DESC;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, COUNT(cp.cp_catalog_page_sk) AS number_of_catalog_pages, SUM(case when p.p_channel_press = 'N' then 1 else 0 end) AS promotions_without_press, AVG(p.p_cost) AS average_promotion_cost, MAX(cc.cc_employees) AS max_employees_per_call_center, MIN(cc.cc_sq_ft) AS min_sq_ft_per_call_center FROM call_center cc LEFT JOIN catalog_page cp ON cc.cc_call_center_sk = cp.cp_catalog_page_sk LEFT JOIN promotion p ON cc.cc_call_center_sk = p.p_promo_sk WHERE cc.cc_sq_ft IN ('3514', '649', '1138', '795', '2268') GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY number_of_catalog_pages DESC, average_promotion_cost ASC;
