SELECT ca.ca_country, ca.ca_state, COUNT(DISTINCT sr.sr_ticket_number) AS num_returns, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(sr.sr_return_quantity) AS total_returned_quantity, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN store s ON sr.sr_store_sk = s.s_store_sk WHERE ca.ca_country = 'United States' AND s.s_rec_start_date BETWEEN '1997-03-13' AND '2001-03-13' AND s.s_number_employees BETWEEN 236 AND 288 AND sr.sr_returned_date_sk IN ('2452372', '2451953', '2452254') GROUP BY ca.ca_country, ca.ca_state ORDER BY total_return_amount DESC;
SELECT sm.sm_carrier, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_profit, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_quantity_returned, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_net_loss) AS total_loss, COUNT(DISTINCT ss.ss_ticket_number) AS total_store_sales, SUM(ss.ss_quantity) AS total_store_quantity_sold, AVG(ss.ss_sales_price) AS average_store_sales_price, SUM(ss.ss_net_profit) AS total_store_profit FROM ship_mode sm LEFT JOIN catalog_sales cs ON sm.sm_ship_mode_sk = cs.cs_ship_mode_sk LEFT JOIN store_returns sr ON sr.sr_store_sk = cs.cs_bill_customer_sk LEFT JOIN store_sales ss ON ss.ss_store_sk = sr.sr_store_sk WHERE sm.sm_carrier IN ('UPS', 'BARIAN') AND sm.sm_ship_mode_id IN ('AAAAAAAAOAAAAAAA', 'AAAAAAAADAAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAACAAAAAAA') AND cs.cs_bill_hdemo_sk = 3987 AND sr.sr_return_time_sk IN (60750, 41614, 39692, 44726) AND EXISTS (SELECT 1 FROM web_site WHERE web_zip IN ('35709', '31904') AND web_site_sk = cs.cs_warehouse_sk) GROUP BY sm.sm_carrier ORDER BY total_profit DESC, total_loss ASC;
SELECT ws.web_site_id, ws.web_class, ws.web_name, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(wr.wr_refunded_cash) AS total_refunded_cash, SUM(sr.sr_return_quantity) AS store_total_returned_quantity, AVG(sr.sr_return_amt_inc_tax) AS store_avg_return_amount_inc_tax, SUM(sr.sr_refunded_cash) AS store_total_refunded_cash FROM web_site ws JOIN web_page wp ON ws.web_site_sk = wp.wp_web_page_sk JOIN web_returns wr ON wp.wp_web_page_sk = wr.wr_web_page_sk LEFT JOIN store_returns sr ON wr.wr_item_sk = sr.sr_item_sk AND wr.wr_refunded_customer_sk = sr.sr_customer_sk WHERE ws.web_class = 'Unknown' AND ws.web_rec_end_date IN ('2001-08-15', '2000-08-15', '1999-08-16') AND wp.wp_rec_start_date IN ('2000-09-03', '2001-09-03', '1997-09-03') AND wp.wp_link_count IN (7, 11, 19) AND wr.wr_return_amt_inc_tax IN (43.31, 378.40, 532.83) AND wr.wr_refunded_cash IN (2425.04, 1694.98, 8.69) AND sr.sr_customer_sk IN (38344, 71012, 20816) AND sr.sr_cdemo_sk IN (1443482, 746161, 1430182) GROUP BY ws.web_site_id, ws.web_class, ws.web_name ORDER BY total_returns DESC, total_refunded_cash DESC;
SELECT w_city, cp_department, AVG(cs_quantity) AS average_quantity, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS average_sales_price, SUM(cs_sales_price) AS total_sales, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN catalog_page ON catalog_sales.cs_catalog_page_sk = catalog_page.cp_catalog_page_sk JOIN warehouse ON catalog_sales.cs_warehouse_sk = warehouse.w_warehouse_sk WHERE w_city = 'Fairview' AND cp_department = 'DEPARTMENT' AND cp_description IN ( 'New resources might go from a proposals. Urgently', 'Only nuclear policies understand so basic courts.', 'Years withdraw most various, corresponding areas.', 'Facilities know changes. Now difficult changes go' ) GROUP BY w_city, cp_department ORDER BY total_net_profit DESC;
SELECT d.d_year, SUM(ss_net_profit) AS total_profit, COUNT(DISTINCT ss_item_sk) AS items_sold, COUNT(DISTINCT ss_ticket_number) AS total_sales_transactions, AVG(ss_net_paid_inc_tax) AS avg_sales_with_tax, w.w_state, w.w_city, COUNT(DISTINCT sr_ticket_number) AS total_return_transactions, SUM(sr_return_amt_inc_tax) AS total_returns_with_tax, AVG(sr_fee) AS avg_return_fee FROM store_sales ss LEFT JOIN store_returns sr ON ss.ss_item_sk = sr.sr_item_sk AND ss.ss_ticket_number = sr.sr_ticket_number JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN warehouse w ON ss.ss_store_sk = w.w_warehouse_sk WHERE d.d_year = 2002 AND ss.ss_store_sk IN (10, 7, 4, 1) AND sr.sr_returned_date_sk IN ('2451033', '2451972') AND w.w_city = 'Midway' GROUP BY d.d_year, w.w_state, w.w_city ORDER BY total_profit DESC;
SELECT ca.ca_state AS State, AVG(hd.hd_income_band_sk) AS Avg_Income_Band, AVG(hd.hd_dep_count) AS Avg_Dependent_Count, AVG(hd.hd_vehicle_count) AS Avg_Vehicle_Count, COUNT(*) FILTER (WHERE hd.hd_buy_potential = 'High') AS High_Buying_Potential_Count, COUNT(*) FILTER (WHERE hd.hd_buy_potential = 'Medium') AS Medium_Buying_Potential_Count, COUNT(*) FILTER (WHERE hd.hd_buy_potential = 'Low') AS Low_Buying_Potential_Count, COUNT(DISTINCT ca.ca_address_sk) AS Address_Count, AVG(ws.web_tax_percentage) AS Avg_Web_Tax_Percentage FROM customer_address ca JOIN household_demographics hd ON ca.ca_address_sk = hd.hd_demo_sk JOIN web_site ws ON ca.ca_state = ws.web_state WHERE ca.ca_country = 'United States' AND ws.web_country = 'United States' AND ca.ca_state IS NOT NULL AND ws.web_tax_percentage IS NOT NULL GROUP BY ca.ca_state ORDER BY Avg_Income_Band DESC, High_Buying_Potential_Count DESC, Medium_Buying_Potential_Count DESC, Low_Buying_Potential_Count DESC;
SELECT cc.cc_state, SUM(ss.ss_net_paid) AS total_net_sales, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT cc.cc_call_center_sk) AS number_of_call_centers, SUM(cc.cc_employees) AS total_employees FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk WHERE cc.cc_rec_start_date <= CURRENT_DATE AND (cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date > CURRENT_DATE) AND ss.ss_sold_date_sk BETWEEN cc.cc_open_date_sk AND COALESCE(cc.cc_closed_date_sk, ss.ss_sold_date_sk) GROUP BY cc.cc_state ORDER BY total_net_sales DESC, average_sales_price DESC;
SELECT i.i_category AS item_category, sm.sm_type AS shipping_type, COUNT(DISTINCT cr.cr_order_number) AS catalog_returns_count, SUM(cr.cr_return_quantity) AS total_catalog_return_quantity, AVG(cr.cr_return_amt_inc_tax) AS average_catalog_return_amount, COUNT(DISTINCT sr.sr_ticket_number) AS store_returns_count, SUM(sr.sr_return_quantity) AS total_store_return_quantity, AVG(sr.sr_return_amt_inc_tax) AS average_store_return_amount FROM catalog_returns cr INNER JOIN item i ON cr.cr_item_sk = i.i_item_sk INNER JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk INNER JOIN time_dim t ON cr.cr_returned_date_sk = t.t_time_sk INNER JOIN income_band ib ON cr.cr_refunded_customer_sk = ib.ib_income_band_sk LEFT JOIN store_returns sr ON i.i_item_sk = sr.sr_item_sk AND cr.cr_returned_date_sk = sr.sr_returned_date_sk WHERE t.t_time_sk = 1000 AND ib.ib_lower_bound = 40001 GROUP BY i.i_category, sm.sm_type ORDER BY i.i_category, sm.sm_type;
SELECT cc.cc_name AS "Call Center Name", cc.cc_city AS "City", cc.cc_state AS "State", COUNT(cr.cr_order_number) AS "Total Returns Processed", AVG(cr.cr_return_amount) AS "Average Return Amount", SUM(cr.cr_net_loss) AS "Total Net Loss", w.w_warehouse_name AS "Warehouse Name", w.w_warehouse_sq_ft AS "Warehouse Square Feet", wn.AvgNetLossPerWarehouseSqFt AS "Avg. Net Loss per Warehouse Sq Ft" FROM catalog_returns cr JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN (SELECT cr_warehouse_sk, AVG(cr_net_loss) AS AvgNetLossPerWarehouseSqFt FROM catalog_returns GROUP BY cr_warehouse_sk) wn ON wn.cr_warehouse_sk = w.w_warehouse_sk WHERE cc.cc_state = 'TN' AND w.w_country = 'United States' GROUP BY cc.cc_call_center_sk, cc.cc_name, cc.cc_city, cc.cc_state, w.w_warehouse_name, w.w_warehouse_sq_ft, wn.AvgNetLossPerWarehouseSqFt ORDER BY "Total Net Loss" DESC, "Average Return Amount" DESC;
SELECT cp.cp_department, i.i_category, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_quantity) AS total_return_quantity, r.r_reason_desc, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_customers_refunded, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_customers_returning, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk WHERE cp.cp_end_date_sk IN ('2451087', '2451239', '2450904', '2450844') GROUP BY cp.cp_department, i.i_category, r.r_reason_desc ORDER BY total_return_amount DESC, total_returns DESC LIMIT 100;
SELECT s.s_store_sk, s.s_store_name, s.s_city, s.s_state, dd.d_quarter_name, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_units_sold, SUM(ss.ss_net_paid) AS total_revenue, SUM(ss.ss_net_profit) AS total_profit, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions, SUM(sr.sr_return_quantity) AS total_units_returned, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_net_loss) AS total_return_loss, AVG(cd.cd_dep_count) AS avg_customer_dependants, AVG(hd.hd_income_band_sk) AS avg_customer_income_band, r.r_reason_desc AS most_common_return_reason FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk LEFT JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk LEFT JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk LEFT JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE dd.d_quarter_name IS NOT NULL GROUP BY s.s_store_sk, s.s_store_name, s.s_city, s.s_state, dd.d_quarter_name, r.r_reason_desc ORDER BY s.s_store_sk, dd.d_quarter_name;
SELECT s.s_store_name, s.s_manager, SUM(cs.cs_net_profit) AS total_profit, AVG(cs.cs_quantity) AS average_quantity_sold, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(wr.wr_net_loss) AS total_net_loss, AVG(wr.wr_fee) AS average_return_fee, COUNT(DISTINCT wr.wr_order_number) AS total_returns, r.r_reason_desc, d.d_year, d.d_quarter_name FROM store s JOIN catalog_sales cs ON s.s_store_sk = cs.cs_ship_addr_sk JOIN web_returns wr ON cs.cs_order_number = wr.wr_order_number JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN reason r ON wr.wr_reason_sk = r.r_reason_sk WHERE s.s_manager IN ('Raymond Jacobs', 'William Ward') AND r.r_reason_desc IN ('duplicate purchase', 'Did not fit') AND d.d_year = 2001 AND d.d_quarter_name IN ('Q1', 'Q2', 'Q3', 'Q4') GROUP BY s.s_store_name, s.s_manager, r.r_reason_desc, d.d_year, d.d_quarter_name ORDER BY total_profit DESC, total_net_loss DESC;
SELECT s.s_store_name, s.s_city, s.s_state, td.t_shift, COUNT(*) AS total_returns, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(CASE WHEN sr.sr_return_amt_inc_tax > 100 THEN 1 ELSE 0 END) AS returns_over_100, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN time_dim td ON sr.sr_return_time_sk = td.t_time_sk JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN web_page wp ON sr.sr_store_sk = wp.wp_customer_sk JOIN web_returns wr ON sr.sr_item_sk = wr.wr_item_sk AND sr.sr_ticket_number = wr.wr_order_number WHERE td.t_shift = 'third' AND s.s_gmt_offset = '-5.00' AND ca.ca_address_id IN ('AAAAAAAAGGKAAAAA', 'AAAAAAAANCEAAAAA', 'AAAAAAAAOKGAAAAA') AND (wr.wr_return_amt_inc_tax = '6344.70' OR wr.wr_return_amt_inc_tax = '72.90' OR wr.wr_return_amt_inc_tax = '705.96') GROUP BY s.s_store_name, s.s_city, s.s_state, td.t_shift ORDER BY total_returns DESC, avg_return_amount_inc_tax DESC LIMIT 100;
SELECT dd.d_year, dd.d_quarter_name, SUM(ws.ws_net_paid) AS total_net_paid, AVG(ws.ws_quantity) AS average_quantity, COUNT(*) AS sales_transactions, SUM(inv.inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT ws.ws_item_sk) AS distinct_items_sold, COUNT(DISTINCT s.s_store_sk) AS number_of_stores, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_quantity) AS average_return_quantity, COUNT(DISTINCT cr.cr_item_sk) AS distinct_items_returned FROM date_dim AS dd JOIN web_sales AS ws ON dd.d_date_sk = ws.ws_sold_date_sk JOIN inventory AS inv ON ws.ws_item_sk = inv.inv_item_sk AND ws.ws_sold_date_sk = inv.inv_date_sk JOIN store AS s ON ws.ws_bill_customer_sk = s.s_store_sk LEFT JOIN catalog_returns AS cr ON ws.ws_item_sk = cr.cr_item_sk AND ws.ws_order_number = cr.cr_order_number WHERE dd.d_current_year = 'N' AND ws.ws_promo_sk IS NOT NULL AND s.s_market_id IN (8, 2, 4, 7) AND inv.inv_warehouse_sk IN (1, 2) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT ca_state, ca_city, COUNT(DISTINCT c_customer_sk) AS number_of_customers, SUM(ss_net_paid) AS total_sales_amount, AVG(ss_quantity) AS average_quantity_sold, SUM(ss_net_profit) AS total_profit, MAX(ib_upper_bound) AS max_income_band_upper_bound, AVG(wr_return_amt) AS average_return_amount FROM customer_address JOIN customer ON c_current_addr_sk = ca_address_sk JOIN store_sales ON ss_customer_sk = c_customer_sk JOIN income_band ON ib_income_band_sk = (SELECT hd_income_band_sk FROM household_demographics WHERE hd_demo_sk = c_current_hdemo_sk) LEFT OUTER JOIN web_returns ON wr_order_number = ss_ticket_number AND wr_item_sk = ss_item_sk WHERE ca_street_type IN ('Dr.', 'Blvd', 'Ln', 'Cir.', 'Boulevard', 'Wy') AND ss_net_paid > 1000 AND ss_quantity < 50 GROUP BY ca_state, ca_city ORDER BY total_sales_amount DESC, average_quantity_sold DESC LIMIT 10;
SELECT d_year, d_quarter_name, ca_state, COUNT(DISTINCT ws_order_number) AS total_orders, SUM(ws_quantity) AS total_quantity, AVG(ws_sales_price) AS average_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_profit) AS total_net_profit, SUM(ws_ext_tax) AS total_tax_collected FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN customer_address ON ws_bill_addr_sk = ca_address_sk JOIN customer_demographics ON ws_bill_cdemo_sk = cd_demo_sk JOIN catalog_page ON ws_web_page_sk = cp_catalog_page_sk JOIN store ON ws_warehouse_sk = s_store_sk WHERE d_current_quarter = 'N' AND cd_dep_employed_count = 0 AND cp_department = 'DEPARTMENT' AND ws_order_number IN ('25231', '23240', '18952', '15512', '28993', '33703') GROUP BY d_year, d_quarter_name, ca_state ORDER BY d_year, d_quarter_name, ca_state;
SELECT ib.ib_income_band_sk, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_profit, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages, cp.cp_department FROM store_sales ss JOIN income_band ib ON ss.ss_hdemo_sk = ib.ib_income_band_sk JOIN catalog_page cp ON cp.cp_start_date_sk <= ss.ss_sold_date_sk AND cp.cp_end_date_sk >= ss.ss_sold_date_sk GROUP BY ib.ib_income_band_sk, cp.cp_department ORDER BY ib.ib_income_band_sk, cp.cp_department;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_credit_rating, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, COUNT(sr.sr_ticket_number) AS total_returns FROM customer_demographics cd JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk WHERE hd.hd_buy_potential IN ('5001-10000', '>10000') AND sr.sr_reversed_charge > 50 GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_credit_rating HAVING AVG(cd.cd_purchase_estimate) > 500 ORDER BY avg_purchase_estimate DESC, total_return_amount_inc_tax DESC;
SELECT inv.inv_item_sk, SUM(inv.inv_quantity_on_hand) AS total_quantity_on_hand, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, COUNT(wr.wr_item_sk) AS count_returns, wp.wp_type FROM inventory inv LEFT JOIN web_returns wr ON inv.inv_item_sk = wr.wr_item_sk LEFT JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk WHERE inv.inv_date_sk = 2450815 AND wp.wp_type IN ('protected', 'feedback', 'ad', 'dynamic', 'welcome', 'general') AND wp.wp_max_ad_count IN (0, 1, 2) GROUP BY inv.inv_item_sk, wp.wp_type ORDER BY inv.inv_item_sk, wp.wp_type;
SELECT cd.cd_gender, cd.cd_marital_status, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(ws.ws_net_paid) AS total_web_sales, COUNT(DISTINCT ws.ws_order_number) AS total_orders FROM web_sales ws JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN web_site wsit ON ws.ws_web_site_sk = wsit.web_site_sk WHERE wsit.web_city IN ('Midway', 'Fairview') AND wsit.web_manager IN ('Lewis Wolf', 'William Carter') GROUP BY cd.cd_gender, cd.cd_marital_status ORDER BY total_web_sales DESC, avg_purchase_estimate DESC;
SELECT i.i_item_id, i.i_category, w.w_state, w.w_city, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amt_inc_tax) AS avg_return_amount_incl_tax, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_incl_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_return_ship_cost) AS total_shipping_cost, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk GROUP BY ROLLUP (i.i_item_id, i.i_category, w.w_state, w.w_city) ORDER BY w.w_state, w.w_city, i.i_category, i.i_item_id;
SELECT ib.ib_lower_bound, ib.ib_upper_bound, COUNT(hd.hd_demo_sk) AS household_count, AVG(hd.hd_dep_count) AS average_dependency_count, AVG(hd.hd_vehicle_count) AS average_vehicle_count, SUM(CASE WHEN p.p_channel_email = 'N' THEN p.p_cost ELSE 0 END) AS total_cost_non_email_promotions, SUM(CASE WHEN p.p_channel_tv = 'Y' THEN 1 ELSE 0 END) AS number_of_tv_promotions, SUM(CASE WHEN p.p_discount_active = 'Y' THEN p.p_response_target ELSE 0 END) AS total_target_with_active_discount, COUNT(DISTINCT CASE WHEN r.r_reason_desc = 'reason 27' THEN hd.hd_demo_sk ELSE NULL END) AS count_households_reason_27 FROM household_demographics hd LEFT JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk LEFT JOIN promotion p ON hd.hd_demo_sk = p.p_item_sk LEFT JOIN reason r ON p.p_promo_sk = r.r_reason_sk WHERE hd.hd_income_band_sk IN (15, 9, 18, 20) AND p.p_purpose <> 'Unknown' AND ib.ib_lower_bound IN (110001, 100001, 130001) AND ib.ib_upper_bound <> 70000 GROUP BY ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ib.ib_lower_bound, ib.ib_upper_bound;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_class, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, COUNT(DISTINCT cp.cp_catalog_page_sk) AS catalog_pages_used, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_including_tax, SUM(ss.ss_net_profit) AS total_net_profit, AVG(t.t_hour) AS average_hour_of_sale FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN catalog_page cp ON c.c_current_cdemo_sk = cp.cp_catalog_page_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE (cc.cc_rec_start_date IS NULL OR cc.cc_rec_start_date <= CURRENT_DATE) AND (cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date >= CURRENT_DATE) AND t.t_second IN ('16', '11') AND ss.ss_hdemo_sk IN ('1989', '6188') AND c.c_current_hdemo_sk IN ('3971', '3131', '4808', '7162', '6897', '2935') AND cc.cc_call_center_sk = 5 GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_class ORDER BY total_net_profit DESC, average_sales_price DESC;
SELECT ca_state, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_ticket_number) AS total_sales_transactions, SUM(ss_net_profit) AS total_net_profit FROM store_sales JOIN customer_address ON store_sales.ss_addr_sk = customer_address.ca_address_sk WHERE customer_address.ca_country = 'United States' AND store_sales.ss_sold_date_sk BETWEEN 20220101 AND 20221231 GROUP BY ca_state ORDER BY total_net_profit DESC;
SELECT ca.ca_state, ca.ca_city, COUNT(DISTINCT c.c_customer_sk) AS num_customers, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_ext_discount_amt) AS total_discount_amount, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_net_loss) AS avg_net_loss, SUM(CASE WHEN r.r_reason_sk IS NOT NULL THEN 1 ELSE 0 END) AS num_returns_with_reason FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN web_returns wr ON wr.wr_refunded_customer_sk = c.c_customer_sk LEFT JOIN reason r ON wr.wr_reason_sk = r.r_reason_sk GROUP BY ca.ca_state, ca.ca_city HAVING COUNT(DISTINCT c.c_customer_sk) > 5 AND SUM(ss.ss_quantity) > 50 ORDER BY total_discount_amount DESC, avg_sales_price DESC LIMIT 100;
SELECT cd.cd_education_status, cd.cd_gender, cd.cd_marital_status, cd.cd_credit_rating, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_incl_tax, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amount_incl_tax, COUNT(wr.wr_returned_date_sk) AS total_returns, p.p_channel_email, p.p_channel_dmail, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo FROM web_returns wr JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk JOIN promotion p ON wr.wr_item_sk = p.p_item_sk WHERE wr.wr_fee IN (16.46, 25.83, 12.23, 28.11, 82.98) AND wr.wr_reversed_charge = 33.99 AND cd.cd_dep_employed_count = 0 GROUP BY cd.cd_education_status, cd.cd_gender, cd.cd_marital_status, cd.cd_credit_rating, p.p_channel_email, p.p_channel_dmail, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo ORDER BY total_return_amount_incl_tax DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT ss.ss_customer_sk) AS num_customers, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_net_profit, SUM(sr.sr_return_quantity) AS total_return_quantity, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_fee) AS avg_return_fee, COUNT(DISTINCT wp.wp_web_page_sk) AS num_visited_pages, SUM(wp.wp_link_count) AS total_link_count FROM income_band ib LEFT JOIN store_sales ss ON ib.ib_income_band_sk = ss.ss_cdemo_sk LEFT JOIN store_returns sr ON ss.ss_customer_sk = sr.sr_customer_sk AND sr.sr_reason_sk IN (21, 2, 14, 30) LEFT JOIN web_page wp ON ss.ss_customer_sk = wp.wp_customer_sk AND wp.wp_type IN ('protected', 'ad') WHERE ss.ss_sold_date_sk IN (2451298, 2450872, 2451390, 2451634) AND ib.ib_upper_bound IN (30000, 130000, 90000) AND ib.ib_income_band_sk IN (17, 6) GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ib.ib_income_band_sk;
SELECT dd.d_year, dd.d_quarter_name, i.i_category, sum(ss.ss_quantity) as total_quantity_sold, avg(ss.ss_sales_price) as avg_sales_price, sum(ss.ss_net_paid) as total_net_sales, sum(ss.ss_net_profit) as total_net_profit, count(distinct ss.ss_ticket_number) as total_sales_transactions, sum(wr.wr_return_quantity) as total_quantity_returned, sum(wr.wr_net_loss) as total_net_loss, count(distinct wr.wr_order_number) as total_return_transactions FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk LEFT JOIN web_returns wr ON ss.ss_item_sk = wr.wr_item_sk AND ss.ss_sold_date_sk = wr.wr_returned_date_sk GROUP BY dd.d_year, dd.d_quarter_name, i.i_category ORDER BY dd.d_year, dd.d_quarter_name, i.i_category;
SELECT s.s_division_name, AVG(s.s_floor_space) AS avg_floor_space, AVG(s.s_number_employees) AS avg_number_employees, AVG(ib.ib_upper_bound) AS avg_income_upper_bound, COUNT(wp.wp_web_page_sk) AS web_page_count, SUM(wp.wp_image_count) AS total_image_count, SUM(wp.wp_link_count) AS total_link_count FROM store AS s INNER JOIN income_band AS ib ON s.s_store_sk = ib.ib_income_band_sk LEFT JOIN web_page AS wp ON wp.wp_customer_sk = s.s_store_sk WHERE s.s_rec_start_date >= '2020-01-01' AND (s.s_rec_end_date IS NULL OR s.s_rec_end_date <= '2023-01-01') AND ib.ib_upper_bound BETWEEN 60000 AND 190000 AND wp.wp_type = 'monthly' GROUP BY s.s_division_name ORDER BY avg_floor_space DESC, avg_number_employees DESC;
