SELECT dd.d_year, dd.d_quarter_name, SUM(cs.cs_net_paid_inc_ship) AS total_revenue, AVG(cs.cs_quantity) AS average_quantity_sold, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(CASE WHEN cd.cd_gender = 'F' THEN cs.cs_net_paid_inc_ship ELSE 0 END) AS female_total_revenue, SUM(CASE WHEN cd.cd_gender = 'M' THEN cs.cs_net_paid_inc_ship ELSE 0 END) AS male_total_revenue, COUNT(DISTINCT CASE WHEN ib.ib_upper_bound <= 50000 THEN cs.cs_bill_customer_sk END) AS customers_low_income, COUNT(DISTINCT CASE WHEN ib.ib_upper_bound > 50000 AND ib.ib_upper_bound <= 150000 THEN cs.cs_bill_customer_sk END) AS customers_mid_income, COUNT(DISTINCT CASE WHEN ib.ib_upper_bound > 150000 THEN cs.cs_bill_customer_sk END) AS customers_high_income, COUNT(DISTINCT sm.sm_ship_mode_sk) AS shipping_modes_used, COUNT(DISTINCT w.w_warehouse_sk) AS warehouses_used, COUNT(DISTINCT p.p_promo_sk) AS promotions_run FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk LEFT JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound WHERE dd.d_year IN (2020, 2021) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT cd.cd_education_status, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_type, AVG(cd.cd_purchase_estimate) AS average_purchase_estimate, COUNT(cd.cd_demo_sk) AS customer_count, AVG(w.web_tax_percentage) AS average_tax_percentage FROM customer_demographics cd JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound JOIN ship_mode sm ON sm.sm_contract = 'qENFQ' AND sm.sm_type IN ('EXPRESS', 'LIBRARY', 'OVERNIGHT', 'TWO DAY') JOIN web_site w ON w.web_class IN ('B2C', 'B2B', 'Small Business', 'Enterprise') AND w.web_tax_percentage IS NOT NULL WHERE cd.cd_education_status IN ('College', 'Secondary', '2 yr Degree', 'Primary') AND cd.cd_purchase_estimate IN (1000, 2500, 7000, 3000) AND sm.sm_type IN ('EXPRESS', 'LIBRARY', 'OVERNIGHT', 'TWO DAY') GROUP BY cd.cd_education_status, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_type ORDER BY cd.cd_education_status, ib.ib_lower_bound, sm.sm_type;
SELECT i.i_category, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_items_sold, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(wr.wr_return_quantity) AS total_items_returned, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk LEFT JOIN web_returns wr ON cs.cs_order_number = wr.wr_order_number AND cs.cs_item_sk = wr.wr_item_sk WHERE cd.cd_purchase_estimate >= 10000 AND cd.cd_dep_employed_count = 0 GROUP BY i.i_category ORDER BY i.i_category;
SELECT td.t_shift, sum(ws.ws_quantity) AS total_quantity_sold, avg(ws.ws_sales_price) AS average_sales_price, count(distinct ws.ws_order_number) AS total_orders, count(distinct hd.hd_demo_sk) AS unique_customers, sum(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk WHERE ws.ws_sold_date_sk IS NOT NULL AND ws.ws_warehouse_sk IN (1, 2) AND hd.hd_demo_sk IN (821, 42, 4135, 4677, 808) GROUP BY ROLLUP(td.t_shift) ORDER BY total_net_profit DESC, td.t_shift;
SELECT s.s_store_name, s.s_division_name, c.cc_name, c.cc_manager, hd.hd_buy_potential, COUNT(sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, AVG(sr.sr_return_quantity) AS avg_return_quantity, SUM(wr.wr_return_amt_inc_tax) AS total_web_return_amount_inc_tax, AVG(wr.wr_return_quantity) AS avg_web_return_quantity, COUNT(DISTINCT cu.c_customer_sk) AS unique_customers_returning, SUM(hd.hd_dep_count) AS total_dependents, AVG(hd.hd_vehicle_count) AS avg_vehicles_per_household FROM store s JOIN store_returns sr ON sr.sr_store_sk = s.s_store_sk JOIN call_center c ON c.cc_mkt_id = s.s_market_id JOIN customer cu ON cu.c_customer_sk = sr.sr_customer_sk JOIN household_demographics hd ON cu.c_current_hdemo_sk = hd.hd_demo_sk JOIN web_returns wr ON wr.wr_returning_customer_sk = cu.c_customer_sk WHERE c.cc_manager IN ('Bob Belcher', 'Felipe Perkins', 'Larry Mccray', 'Mark Hightower') AND hd.hd_buy_potential IN ('501-1000', '>10000', 'Unknown') AND s.s_division_name = 'Unknown' AND wr.wr_returning_hdemo_sk IN (2871, 6633, 6615, 4553) GROUP BY s.s_store_name, s.s_division_name, c.cc_name, c.cc_manager, hd.hd_buy_potential ORDER BY total_return_amount_inc_tax DESC, total_web_return_amount_inc_tax DESC LIMIT 100;
SELECT dd.d_year, dd.d_moy, SUM(inv.inv_quantity_on_hand) AS total_quantity, AVG(inv.inv_quantity_on_hand) AS avg_quantity, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, COUNT(DISTINCT w.w_warehouse_sk) AS warehouses_involved, SUM(CASE WHEN p.p_channel_email = 'Y' THEN p.p_cost ELSE 0 END) AS total_promo_cost_email, SUM(CASE WHEN p.p_channel_tv = 'Y' THEN p.p_cost ELSE 0 END) AS total_promo_cost_tv, COUNT(DISTINCT CASE WHEN p.p_discount_active = 'Y' THEN p.p_promo_sk ELSE NULL END) AS active_discount_promos FROM inventory inv JOIN date_dim dd ON inv.inv_date_sk = dd.d_date_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN customer c ON dd.d_date_sk = c.c_first_sales_date_sk OR dd.d_date_sk = c.c_first_shipto_date_sk LEFT JOIN promotion p ON dd.d_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk WHERE dd.d_year = 1998 AND p.p_channel_event = 'N' AND dd.d_first_dom IN ('2416847', '2417850', '2417728', '2418946') AND inv.inv_warehouse_sk IN ('1', '2') AND c.c_birth_month IN ('3', '5', '6', '10', '4') GROUP BY dd.d_year, dd.d_moy ORDER BY dd.d_year, dd.d_moy;
SELECT cc.cc_division_name, cc.cc_class, wp.wp_type, COUNT(*) AS number_of_calls, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_fee) AS total_fee_collected, SUM(cr.cr_return_ship_cost) AS total_shipping_cost, SUM(cr.cr_net_loss) AS total_net_loss FROM call_center AS cc JOIN catalog_returns AS cr ON cc.cc_call_center_sk = cr.cr_call_center_sk JOIN web_page AS wp ON cr.cr_catalog_page_sk = wp.wp_web_page_sk WHERE cc.cc_division_name LIKE '%anti%' AND (cc.cc_class = 'small' OR cc.cc_class = 'large') AND (wp.wp_char_count = 3128 OR wp.wp_char_count = 701 OR wp.wp_char_count = 2129) GROUP BY cc.cc_division_name, cc.cc_class, wp.wp_type ORDER BY cc.cc_division_name, cc.cc_class, wp.wp_type;
SELECT d_year, w_state AS warehouse_state, sm_type AS shipping_type, p_promo_name, COUNT(DISTINCT cc_call_center_sk) AS number_of_call_centers, SUM(inv_quantity_on_hand) AS total_inventory, AVG(w_warehouse_sq_ft) AS average_warehouse_size, MAX(p_cost) AS max_promotion_cost, MIN(p_cost) AS min_promotion_cost, AVG(p_cost) AS average_promotion_cost, SUM(CASE WHEN p_channel_demo = 'N' THEN p_cost ELSE 0 END) AS sum_cost_non_demo_promotions FROM date_dim JOIN inventory ON inv_date_sk = d_date_sk JOIN warehouse ON w_warehouse_sk = inv_warehouse_sk JOIN ship_mode ON w_zip = sm_ship_mode_id JOIN call_center ON cc_zip = w_zip LEFT JOIN promotion ON p_promo_sk = inv_item_sk WHERE d_year = 1998 AND w_warehouse_sq_ft IN (977787, 294242, 621234, 138504) AND w_zip = '35709' AND d_quarter_seq IN (24, 3) AND d_fy_week_seq IN (444, 401, 706, 517, 70) AND inv_item_sk IN (6008, 6322, 13964, 9541) AND p_channel_demo = 'N' GROUP BY d_year, warehouse_state, shipping_type, p_promo_name ORDER BY d_year, warehouse_state, shipping_type, p_promo_name;
SELECT d_year, SUM(cs_net_paid) AS total_sales, AVG(cs_net_profit) AS average_profit, COUNT(DISTINCT cs_bill_customer_sk) AS unique_customers, SUM(cr_return_amount) AS total_returns, AVG(cr_return_quantity) AS average_return_quantity, COUNT(DISTINCT cr_returning_customer_sk) AS unique_returning_customers FROM date_dim JOIN catalog_sales ON cs_sold_date_sk = d_date_sk JOIN catalog_returns ON cr_returned_date_sk = d_date_sk AND cs_order_number = cr_order_number WHERE d_year IN (2000, 2001, 2002) AND cs_ship_date_sk IS NOT NULL AND cr_returned_date_sk IS NOT NULL AND (cr_refunded_cdemo_sk IN ('719026', '1111847', '660009', '451051') OR cs_bill_cdemo_sk IN ('719026', '1111847', '660009', '451051')) AND cs_item_sk IN (SELECT inv_item_sk FROM inventory WHERE inv_quantity_on_hand > 100) GROUP BY d_year ORDER BY d_year;
SELECT cc.cc_name AS call_center_name, w.w_warehouse_name AS warehouse_name, s.s_state AS state, SUM(cs.cs_quantity) AS total_items_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_item_sk) AS number_of_unique_items_sold FROM catalog_sales cs INNER JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk INNER JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk INNER JOIN store s ON cc.cc_division = s.s_division_id WHERE cc.cc_market_manager IN ('Matthew Clifton', 'Gary Colburn') AND s.s_country = 'United States' GROUP BY call_center_name, warehouse_name, state ORDER BY total_items_sold DESC, average_sales_price DESC;
SELECT cd.cd_gender, cd.cd_marital_status, s.s_state, COUNT(wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount, AVG(wr.wr_return_amt_inc_tax) AS average_return_amount, AVG(wr.wr_fee) AS average_fee FROM web_returns wr JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk JOIN store s ON wr.wr_returning_addr_sk = s.s_store_sk WHERE wr.wr_returning_addr_sk IN (38908, 38512, 43731, 22184, 44035) AND wr.wr_refunded_hdemo_sk IN (3650, 1143, 1326, 7105) AND s.s_state = 'CA' GROUP BY cd.cd_gender, cd.cd_marital_status, s.s_state ORDER BY total_return_amount DESC, total_returns DESC;
SELECT cc.cc_name, sm.sm_type, CAST(catalog_sales.cs_sold_date_sk AS INTEGER) AS sales_year, SUM(cs_quantity) AS total_quantity_sold, SUM(cs_net_paid) AS total_revenue, AVG(cs_net_profit) AS average_profit, COUNT(DISTINCT cs_order_number) AS total_orders, COUNT(DISTINCT promotion.p_promo_sk) AS total_promotions, SUM(cr_return_amount) AS total_return_amount, SUM(cr_return_quantity) AS total_return_quantity, COUNT(DISTINCT cr_order_number) AS total_return_orders FROM catalog_sales JOIN call_center cc ON catalog_sales.cs_call_center_sk = cc.cc_call_center_sk JOIN ship_mode sm ON catalog_sales.cs_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN promotion ON catalog_sales.cs_promo_sk = promotion.p_promo_sk LEFT JOIN catalog_returns ON catalog_sales.cs_item_sk = catalog_returns.cr_item_sk AND catalog_sales.cs_order_number = catalog_returns.cr_order_number WHERE cc.cc_manager IN ('Julius Durham', 'Matthew Clifton', 'Gary Colburn', 'Julius Tran') AND sm.sm_code IN ('BIKE', 'SEA', 'SURFACE') AND promotion.p_channel_press = 'N' AND catalog_returns.cr_warehouse_sk IN (1, 2) AND catalog_returns.cr_catalog_page_sk IN (366, 295) GROUP BY cc.cc_name, sm.sm_type, sales_year ORDER BY total_revenue DESC, total_orders DESC;
SELECT sm.sm_type AS shipping_type, web.web_site_sk, web.web_name AS website_name, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_paid) AS total_revenue, AVG(ws.ws_quantity) AS average_quantity, AVG(ws.ws_ext_discount_amt) AS average_discount, SUM(ws.ws_coupon_amt) AS total_coupon_amount, SUM(ws.ws_net_profit) AS total_profit FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk WHERE web.web_name IN ('site_3', 'site_4', 'site_1', 'site_0', 'site_2') AND sm.sm_contract IN ('GNJr3g5i7oorKqtX', 'uukTktPYycct8', 'ldhM8IvpzHgdbBgDfI', '2mM8l') AND ws.ws_sold_date_sk BETWEEN 20230101 AND 20231231 GROUP BY sm.sm_type, web.web_site_sk, web.web_name ORDER BY total_revenue DESC;
SELECT c.c_customer_id, p.p_promo_name, SUM(cs.cs_net_profit) AS total_catalog_net_profit, AVG(cs.cs_sales_price) AS avg_catalog_sales_price, COUNT(DISTINCT cs.cs_order_number) AS num_of_catalog_orders, SUM(ws.ws_net_profit) AS total_web_net_profit, AVG(ws.ws_sales_price) AS avg_web_sales_price, COUNT(DISTINCT ws.ws_order_number) AS num_of_web_orders FROM customer c INNER JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk INNER JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk INNER JOIN promotion p ON (cs.cs_promo_sk = p.p_promo_sk AND ws.ws_promo_sk = p.p_promo_sk) WHERE c.c_preferred_cust_flag = 'Y' AND (cs.cs_sold_date_sk = 2450827 OR cs.cs_sold_date_sk = 2450822) AND (p.p_channel_demo = 'N') AND (ws.ws_web_page_sk IN (SELECT wp_web_page_sk FROM web_page WHERE wp_customer_sk IN (1898, 16769))) GROUP BY c.c_customer_id, p.p_promo_name ORDER BY total_catalog_net_profit DESC, total_web_net_profit DESC;
SELECT cr_returned_date_sk AS return_date, SUM(cr_return_quantity) AS total_catalog_return_quantity, SUM(cr_return_amount) AS total_catalog_return_amount, AVG(cr_return_amount) AS avg_catalog_return_amount, COUNT(DISTINCT cr_refunded_customer_sk) AS unique_catalog_customers, SUM(sr_return_quantity) AS total_store_return_quantity, SUM(sr_return_amt) AS total_store_return_amount, AVG(sr_return_amt) AS avg_store_return_amount, COUNT(DISTINCT sr_customer_sk) AS unique_store_customers, SUM(wr_return_quantity) AS total_web_return_quantity, SUM(wr_return_amt) AS total_web_return_amount, AVG(wr_return_amt) AS avg_web_return_amount, COUNT(DISTINCT wr_returning_customer_sk) AS unique_web_customers FROM catalog_returns JOIN store_returns ON cr_item_sk = sr_item_sk AND cr_order_number = sr_ticket_number JOIN web_returns ON cr_item_sk = wr_item_sk AND cr_order_number = wr_order_number WHERE cr_returned_date_sk IS NOT NULL AND sr_returned_date_sk IS NOT NULL AND wr_returned_date_sk IS NOT NULL GROUP BY cr_returned_date_sk ORDER BY cr_returned_date_sk;
SELECT ws.web_site_id, ws.web_name, ws.web_manager, ws.web_gmt_offset, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_paid) AS total_revenue, AVG(cs_net_profit) AS average_profit, SUM(cr_return_amount) AS total_returns, AVG(cr_return_quantity) AS average_return_quantity, COUNT(DISTINCT cr_returned_date_sk) AS return_days_count, SUM(cd_purchase_estimate) AS total_purchase_estimate, AVG(cd_dep_count) AS average_dependents, COUNT(DISTINCT wp_web_page_sk) AS total_web_pages_accessed, SUM(wp_image_count) AS total_images_counted FROM web_site ws LEFT JOIN catalog_sales cs ON ws.web_site_sk = cs.cs_warehouse_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number AND cs.cs_item_sk = cr.cr_item_sk LEFT JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk LEFT JOIN web_page wp ON ws.web_site_sk = wp.wp_customer_sk WHERE ws.web_site_id IN ('AAAAAAAAKAAAAAAA', 'AAAAAAAAKBAAAAAA', 'AAAAAAAANAAAAAAA') AND ws.web_manager IN ('John Thomas', 'Charles Castillo', 'Jimmy Pope') AND ws.web_gmt_offset = '-5.00' AND cr.cr_ship_mode_sk IN ('2', '3', '12') AND cr.cr_refunded_hdemo_sk IN ('5787', '111', '6091') AND cr.cr_returning_customer_sk IN ('39980', '67407', '42477') AND cr.cr_returning_addr_sk IN ('22557', '8862', '28393') AND cd.cd_credit_rating IN ('Good', 'Unknown', 'Low Risk') AND cd.cd_purchase_estimate IN ('3500', '2500', '5500') AND cd.cd_dep_employed_count = '0' AND cd.cd_marital_status IN ('U', 'S', 'W') AND wp.wp_access_date_sk IN ('2452555', '2452619', '2452568') AND wp.wp_url = 'http://www.foo.com' AND wp.wp_image_count IN ('2', '3', '5') GROUP BY ws.web_site_id, ws.web_name, ws.web_manager, ws.web_gmt_offset ORDER BY total_revenue DESC, average_profit DESC;
SELECT p.p_promo_name, sm.sm_type AS shipping_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_net_paid) AS average_sales_per_order, SUM(cs.cs_net_profit) AS total_profit, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_quantity) AS total_web_quantity, SUM(ws.ws_net_paid) AS total_web_sales, AVG(ws.ws_net_paid) AS average_web_sales_per_order, SUM(ws.ws_net_profit) AS total_web_profit FROM promotion p LEFT JOIN catalog_sales cs ON p.p_promo_sk = cs.cs_promo_sk LEFT JOIN web_sales ws ON p.p_promo_sk = ws.ws_promo_sk LEFT JOIN ship_mode sm ON (cs.cs_ship_mode_sk = sm.sm_ship_mode_sk OR ws.ws_ship_mode_sk = sm.sm_ship_mode_sk) WHERE p.p_start_date_sk IN ('2450688', '2450248', '2450699', '2450857', '2450196', '2450745') AND (sm.sm_type IN ('EXPRESS', 'OVERNIGHT', 'TWO DAY', 'NEXT DAY') OR sm.sm_type IS NULL) AND (cs.cs_ship_customer_sk IN ('65147', '83434', '5487', '82518') OR ws.ws_ship_customer_sk IN ('65147', '83434', '5487', '82518')) AND p.p_channel_tv = 'N' GROUP BY p.p_promo_name, sm.sm_type ORDER BY total_sales DESC, total_web_sales DESC;
SELECT ca_state, cc_division_name, AVG(cc_employees) AS avg_cc_employees, COUNT(DISTINCT cc_call_center_sk) AS num_call_centers, SUM(hd_dep_count) AS total_dependents, AVG(hd_vehicle_count) AS avg_num_vehicles, COUNT(DISTINCT c_customer_sk) AS num_customers, COUNT(CASE WHEN hd_buy_potential = '0-500' THEN 1 END) AS count_low_buy_potential, COUNT(CASE WHEN hd_buy_potential = '>10000' THEN 1 END) AS count_high_buy_potential FROM call_center JOIN customer ON c_current_cdemo_sk = cc_call_center_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk WHERE (cc_rec_end_date = '2000-12-31' OR cc_rec_end_date = '2001-12-31') AND hd_dep_count IN (4, 7, 0, 3) AND ca_street_name = 'Fourth Lakeview' GROUP BY ca_state, cc_division_name ORDER BY ca_state, cc_division_name;
SELECT i.i_category, i.i_class, i.i_brand, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(wr.wr_return_quantity) AS total_quantity_returned, AVG(wr.wr_return_amt) AS avg_return_amount, (SUM(ws.ws_net_paid) - SUM(wr.wr_refunded_cash)) AS net_profit FROM item i JOIN web_sales ws ON i.i_item_sk = ws.ws_item_sk LEFT JOIN web_returns wr ON i.i_item_sk = wr.wr_item_sk AND ws.ws_order_number = wr.wr_order_number JOIN income_band ib ON ib.ib_income_band_sk = ws.ws_bill_cdemo_sk WHERE i.i_manufact IN ('oughtanti', 'callyableable', 'ableationable') AND ib.ib_upper_bound IN (110000, 190000, 120000, 20000, 10000) AND ws.ws_quantity > 0 GROUP BY ROLLUP(i.i_category, i.i_class, i.i_brand) ORDER BY i.i_category, i.i_class, i.i_brand;
SELECT i.i_category AS item_category, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, COUNT(DISTINCT ws.ws_order_number) AS number_of_orders, COUNT(DISTINCT h.hd_demo_sk) AS number_of_customers_by_demographics, sm.sm_type AS shipping_type, AVG(inv.inv_quantity_on_hand) AS average_inventory_on_hand FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk JOIN household_demographics h ON ws.ws_bill_hdemo_sk = h.hd_demo_sk WHERE i.i_category_id BETWEEN 1 AND 5 AND ws.ws_ship_mode_sk IN (6, 4, 18, 1, 5, 8) AND inv.inv_warehouse_sk IN (1, 2) AND h.hd_income_band_sk IN (20, 11, 4) GROUP BY i.i_category, sm.sm_type ORDER BY total_net_profit DESC, item_category;
SELECT i.i_category AS item_category, c.c_birth_month AS customer_birth_month, w.web_zip AS web_site_zip, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_paid) AS total_revenue, AVG(ws.ws_ext_discount_amt) AS average_discount, AVG(ws.ws_net_profit) AS average_profit FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN web_site w ON ws.ws_web_site_sk = w.web_site_sk WHERE ws.ws_sold_date_sk BETWEEN 2450815 AND 2450915 AND i.i_item_sk IN (10310, 10207, 12818, 10796) AND w.web_zip IN ('35709', '31904') AND c.c_birth_month IN (3, 5) GROUP BY item_category, customer_birth_month, web_site_zip ORDER BY item_category, customer_birth_month, web_site_zip;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, AVG(sr.sr_return_amt) AS avg_return_amount, AVG(sr.sr_return_quantity) AS avg_return_quantity, COUNT(sr.sr_ticket_number) AS total_returns FROM income_band ib JOIN store_returns sr ON sr.sr_cdemo_sk = ib.ib_income_band_sk JOIN inventory i ON sr.sr_item_sk = i.inv_item_sk GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ib.ib_income_band_sk;
SELECT sm.sm_type AS shipping_mode_type, sm.sm_carrier AS carrier, cp.cp_department AS catalog_department, COUNT(DISTINCT wr.wr_order_number) AS number_of_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_return_tax) AS total_tax, SUM(wr.wr_return_ship_cost) AS total_shipping_cost, SUM(wr.wr_net_loss) AS total_net_loss FROM web_returns wr JOIN ship_mode sm ON wr.wr_returned_date_sk = sm.sm_ship_mode_sk JOIN catalog_page cp ON wr.wr_web_page_sk = cp.cp_catalog_page_sk WHERE wr.wr_returned_date_sk = 2451368 AND cp.cp_catalog_page_sk IN ('859', '3510', '105', '4419') GROUP BY shipping_mode_type, carrier, catalog_department ORDER BY total_net_loss DESC;
SELECT c_birth_country, cd_gender, cd_marital_status, cd_education_status, AVG(cd_purchase_estimate) AS avg_purchase_estimate, COUNT(DISTINCT c_customer_sk) AS total_customers, SUM(inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT wr_order_number) AS total_returns, AVG(wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(wr_fee) AS total_return_fees FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN inventory inv ON inv.inv_date_sk = '2450815' JOIN web_returns wr ON wr.wr_refunded_customer_sk = c.c_customer_sk JOIN web_page wp ON wp.wp_web_page_sk = wr.wr_web_page_sk AND wp.wp_max_ad_count IN ('0', '1') JOIN time_dim t ON t.t_time_sk = wr.wr_returned_time_sk AND t.t_time_id IN ('AAAAAAAALDIAAAAA', 'AAAAAAAAPEJAAAAA', 'AAAAAAAAKMNAAAAA', 'AAAAAAAAIHFAAAAA', 'AAAAAAAAOEBBAAAA', 'AAAAAAAALNDAAAAA') JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk WHERE cd.cd_marital_status IN ('D', 'M', 'U', 'S', 'W') AND cd.cd_gender = 'M' GROUP BY c_birth_country, cd_gender, cd_marital_status, cd_education_status ORDER BY avg_purchase_estimate DESC, total_customers DESC LIMIT 100;
SELECT sm_type, sm_carrier, t_shift, cd_gender, cd_marital_status, cd_education_status, AVG(cd_purchase_estimate) AS avg_purchase_estimate, COUNT(DISTINCT wr_refunded_customer_sk) AS count_distinct_refunded_customers, SUM(wr_return_quantity) AS total_return_quantity, SUM(wr_return_amt) AS total_return_amount, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(wr_net_loss) AS total_net_loss FROM web_returns JOIN ship_mode ON sm_ship_mode_sk = wr_item_sk JOIN time_dim ON t_time_sk = wr_returned_time_sk JOIN customer_demographics ON cd_demo_sk = wr_returning_cdemo_sk GROUP BY ROLLUP(sm_type, sm_carrier, t_shift, cd_gender, cd_marital_status, cd_education_status) ORDER BY sm_type, sm_carrier, t_shift, cd_gender, cd_marital_status, cd_education_status;
SELECT dd.d_month_seq, dd.d_quarter_seq, dd.d_year, cp.cp_type, COUNT(DISTINCT inv.inv_item_sk) AS low_stock_items, AVG(inv.inv_quantity_on_hand) AS avg_quantity_on_hand, MIN(inv.inv_quantity_on_hand) AS min_quantity_on_hand, MAX(inv.inv_quantity_on_hand) AS max_quantity_on_hand, COUNT(DISTINCT inv.inv_warehouse_sk) AS affected_warehouses FROM inventory inv JOIN date_dim dd ON inv.inv_date_sk = dd.d_date_sk JOIN catalog_page cp ON inv.inv_item_sk = cp.cp_catalog_page_sk WHERE inv.inv_quantity_on_hand < 750 AND dd.d_year = 2022 GROUP BY dd.d_month_seq, dd.d_quarter_seq, dd.d_year, cp.cp_type ORDER BY dd.d_year, dd.d_quarter_seq, dd.d_month_seq, cp.cp_type;
SELECT cp.cp_department, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, COUNT(cr.cr_return_amount) AS num_returns, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_sales_price) AS total_sales, COUNT(cs.cs_sales_price) AS num_sales, ca.ca_state, COUNT(DISTINCT ca.ca_city) AS num_cities FROM catalog_page cp JOIN catalog_sales cs ON cp.cp_catalog_page_sk = cs.cs_catalog_page_sk JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk WHERE cp.cp_catalog_number IN (29, 40) AND cr.cr_refunded_cdemo_sk = 1173022 GROUP BY cp.cp_department, ca.ca_state ORDER BY total_return_amount DESC, total_sales DESC;
SELECT s.s_state, cd.cd_gender, COUNT(DISTINCT s.s_store_sk) AS total_stores, AVG(s.s_floor_space) AS avg_floor_space, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_ext_discount_amt) AS avg_discount_amount FROM store_sales ss JOIN customer_demographics cd ON cd.cd_demo_sk = ss.ss_cdemo_sk JOIN store s ON s.s_store_sk = ss.ss_store_sk WHERE ss.ss_ext_sales_price > 0 AND cd.cd_gender IN ('M', 'F') AND s.s_state IS NOT NULL GROUP BY s.s_state, cd.cd_gender ORDER BY s.s_state, cd.cd_gender, total_sales DESC;
