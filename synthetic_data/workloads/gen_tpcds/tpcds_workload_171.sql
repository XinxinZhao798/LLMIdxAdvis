SELECT i.i_category AS item_category, COUNT(DISTINCT ss.ss_item_sk) AS total_items_sold, SUM(ss.ss_quantity) AS total_sales_quantity, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_sales_amount, COUNT(DISTINCT sr.sr_item_sk) AS total_items_returned, SUM(sr.sr_return_quantity) AS total_return_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax FROM item i LEFT JOIN store_sales ss ON i.i_item_sk = ss.ss_item_sk LEFT JOIN store_returns sr ON i.i_item_sk = sr.sr_item_sk GROUP BY i.i_category ORDER BY total_sales_amount DESC;
SELECT ca.ca_state AS customer_state, cp.cp_department AS department, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(cr.cr_item_sk) AS total_return_count, SUM(cr.cr_net_loss) AS total_net_loss, SUM(p.p_cost) AS total_promotion_cost FROM catalog_returns cr JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN promotion p ON cp.cp_catalog_page_sk = p.p_item_sk WHERE cp.cp_department IN ('Electronics', 'Home & Garden', 'Books') AND p.p_cost > 1000 AND cp.cp_end_date_sk IN (2450934, 2451664) AND ca.ca_state = 'CA' AND ca.ca_gmt_offset = -8.00 GROUP BY customer_state, department ORDER BY total_net_loss DESC, total_return_count DESC;
SELECT i_category, i_class, i_brand, SUM(i_current_price) AS total_sales_value, AVG(i_current_price) AS avg_sales_price, COUNT(DISTINCT i_item_sk) AS unique_items_sold, COUNT(DISTINCT c_customer_sk) AS unique_customers, c_birth_country, AVG(EXTRACT(YEAR FROM AGE(MAKE_DATE(c_birth_year, c_birth_month, c_birth_day)))) AS avg_customer_age FROM item JOIN customer ON i_manager_id = c_current_addr_sk JOIN time_dim ON t_time_sk = c_first_sales_date_sk WHERE i_rec_start_date <= NOW() AND (i_rec_end_date IS NULL OR i_rec_end_date > NOW()) AND c_preferred_cust_flag = 'Y' AND t_minute IN ('6', '3', '48', '49') GROUP BY ROLLUP(i_category, i_class, i_brand, c_birth_country) ORDER BY total_sales_value DESC, unique_items_sold DESC, i_category, i_class, i_brand, c_birth_country;
SELECT d_year, i_category, i_class, SUM(ws_sales_price) AS total_sales, AVG(ws_sales_price) AS avg_sales_price, COUNT(DISTINCT ws_order_number) AS num_orders, SUM(sr_return_amt) AS total_returns, AVG(sr_return_amt) AS avg_return_amt, COUNT(DISTINCT sr_ticket_number) AS num_returns, SUM(ws_net_profit) - SUM(sr_net_loss) AS net_profit FROM web_sales JOIN item ON ws_item_sk = i_item_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk LEFT JOIN store_returns ON sr_item_sk = ws_item_sk AND sr_returned_date_sk = ws_sold_date_sk WHERE d_year = 2002 AND (i_category = 'Electronics' OR i_category = 'Books') AND ws_sales_price > 0 GROUP BY d_year, i_category, i_class ORDER BY d_year, i_category, i_class;
SELECT cc_state, COUNT(DISTINCT cc_call_center_sk) AS num_call_centers, AVG(cc_employees) AS avg_employees, SUM(cc_sq_ft) AS total_square_footage, ca.ca_state AS customer_state, COUNT(DISTINCT ca.ca_address_sk) AS num_customer_addresses, AVG(ca.ca_gmt_offset) AS avg_customer_gmt_offset, sm.sm_type AS ship_mode_type, COUNT(DISTINCT sm.sm_ship_mode_sk) AS num_ship_modes, MAX(sm.sm_contract) AS longest_ship_contract FROM call_center cc JOIN customer_address ca ON cc_state = ca.ca_state JOIN ship_mode sm ON TRUE WHERE cc_street_type = 'Way' AND ca.ca_gmt_offset IN ('-9.00', '-6.00', '-10.00', '-5.00', '-7.00') AND sm.sm_ship_mode_id = 'AAAAAAAAJAAAAAAA' GROUP BY cc_state, ca.ca_state, sm.sm_type ORDER BY cc_state, ca.ca_state, sm.sm_type;
SELECT cc_state, i_category, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS avg_sales_price, COUNT(DISTINCT cs_order_number) AS unique_orders, SUM(ss_net_profit) AS total_store_profit, AVG(ss_wholesale_cost) AS avg_store_wholesale_cost, COUNT(DISTINCT ss_ticket_number) AS unique_store_tickets, SUM(inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT p_promo_sk) AS distinct_promotions FROM call_center JOIN catalog_sales ON cc_call_center_sk = cs_call_center_sk JOIN item ON cs_item_sk = i_item_sk JOIN store_sales ON ss_item_sk = i_item_sk JOIN inventory ON inv_item_sk = i_item_sk JOIN promotion ON (cs_promo_sk = p_promo_sk OR ss_promo_sk = p_promo_sk) JOIN store ON ss_store_sk = s_store_sk WHERE cc_mkt_id IN ('6', '2', '5') AND cc_state = 'TN' AND inv_item_sk IN ('15746', '11656', '6211', '11858') AND i_item_sk IN ('2579', '2638', '2347', '3924', '3976', '4905') AND s_store_sk IN ('8', '11', '6') GROUP BY cc_state, i_category;
SELECT cp.cp_department, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_incl_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_net_loss) AS total_net_loss, SUM(p.p_cost) AS total_promotion_cost, COUNT(DISTINCT p.p_promo_sk) AS total_promotions_applied FROM catalog_page cp JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk LEFT JOIN promotion p ON cp.cp_catalog_page_sk = p.p_item_sk WHERE cp.cp_catalog_page_number IN (63, 55, 67, 26) GROUP BY cp.cp_department ORDER BY total_net_loss DESC;
SELECT s.s_store_name, s.s_city, s.s_state, s.s_county, cc.cc_name AS call_center_name, cc.cc_city AS call_center_city, cc.cc_state AS call_center_state, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_net_loss) AS total_net_loss, COUNT(DISTINCT cr.cr_order_number) AS total_return_orders, COUNT(DISTINCT inv.inv_item_sk) AS total_distinct_items_in_inventory, SUM(inv.inv_quantity_on_hand) AS total_inventory_quantity, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_size, COUNT(DISTINCT p.p_promo_sk) AS total_promotions, SUM(CASE WHEN p.p_channel_event = 'N' AND p.p_channel_demo = 'N' THEN p.p_cost ELSE 0 END) AS total_promo_cost_without_event_demo FROM store s JOIN call_center cc ON s.s_market_id = cc.cc_mkt_id JOIN catalog_returns cr ON cc.cc_call_center_sk = cr.cr_call_center_sk JOIN inventory inv ON inv.inv_warehouse_sk = cr.cr_warehouse_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN promotion p ON p.p_item_sk = inv.inv_item_sk WHERE s.s_county = 'Williamson County' AND cc.cc_state = 'TN' AND cc.cc_division IN (3, 4, 5) AND cr.cr_net_loss IN (102.74, 18.18, 876.19) AND cr.cr_warehouse_sk IN (4, 5, 2) AND w.w_country = 'United States' AND w.w_warehouse_sq_ft IN (294242, 138504, 977787) AND inv.inv_item_sk IN (15163, 10582, 8594) AND inv.inv_quantity_on_hand IN (867, 861, 859) AND cc.cc_street_type IN ('Way', 'RD', 'Boulevard') AND cc.cc_mkt_id IN (2, 6, 5) AND p.p_end_date_sk IN (2450565, 2450562, 2450605) AND p.p_channel_event = 'N' AND p.p_channel_demo = 'N' GROUP BY s.s_store_name, s.s_city, s.s_state, s.s_county, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_returned_quantity DESC, total_net_loss DESC, total_inventory_quantity DESC, avg_warehouse_size DESC;
SELECT cp_department, i_category, AVG(i_current_price) AS average_price, SUM(i_wholesale_cost) AS total_wholesale_cost, COUNT(DISTINCT i_item_sk) AS item_count, COUNT(DISTINCT cp_catalog_page_sk) AS page_count, AVG(ib_upper_bound - ib_lower_bound) AS average_income_band_range FROM catalog_page JOIN item ON cp_catalog_page_id = i_item_id JOIN income_band ON i_size::integer = ib_income_band_sk WHERE cp_start_date_sk IS NOT NULL AND cp_end_date_sk IS NOT NULL AND i_rec_start_date <= CURRENT_DATE AND (i_rec_end_date IS NULL OR i_rec_end_date >= CURRENT_DATE) AND ib_lower_bound >= 20000 AND cp_department IN ('Electronics', 'Clothing', 'Home Goods') GROUP BY cp_department, i_category ORDER BY average_price DESC, total_wholesale_cost DESC;
SELECT dd.d_year, dd.d_quarter_name, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, COUNT(DISTINCT ca.ca_city) AS number_of_cities, COUNT(DISTINCT ws.web_site_sk) AS number_of_websites, SUM(cr.cr_return_quantity) AS total_return_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_net_loss) AS total_net_loss FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk JOIN web_site ws ON ws.web_open_date_sk = dd.d_date_sk LEFT JOIN catalog_returns cr ON cr.cr_returned_date_sk = dd.d_date_sk WHERE dd.d_year IN (2001, 2002) AND ca.ca_street_number = '789' AND ws.web_city IN ('Fairview', 'Midway') AND dd.d_quarter_seq IN (20, 49, 51) AND cr.cr_reason_sk IS NOT NULL AND EXISTS (SELECT 1 FROM reason WHERE cr_reason_sk = r_reason_sk AND r_reason_desc IN ('Gift exchange', 'Found a better price in a store', 'Not the product that was ordred')) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT cp.cp_department AS department, i.i_category AS category, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, AVG(cd.cd_purchase_estimate) AS average_purchase_estimate, COUNT(DISTINCT cd.cd_demo_sk) AS unique_customers FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk WHERE cd.cd_education_status IN ('4 yr Degree', 'Advanced Degree', 'College', 'Primary', 'Secondary', '2 yr Degree') AND cp.cp_type = 'Catalog' AND i.i_brand_id IS NOT NULL GROUP BY cp.cp_department, i.i_category ORDER BY total_net_paid DESC, average_sales_price DESC LIMIT 10;
SELECT ca_state, p_promo_name, COUNT(*) AS num_sales, SUM(ws_quantity) AS total_quantity_sold, AVG(ws_sales_price) AS average_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_profit) AS total_net_profit FROM web_sales JOIN customer_address ON ws_ship_addr_sk = ca_address_sk JOIN promotion ON ws_promo_sk = p_promo_sk JOIN store ON ws_bill_addr_sk = store.s_store_sk WHERE ca_zip IN ('70913', '28482', '63511', '34098') AND ws_web_site_sk IN (6, 4, 29, 10, 1) AND ws_ship_customer_sk IN (7473, 54186, 56351, 1807) AND s_suite_number IN ('Suite D', 'Suite 260', 'Suite 190', 'Suite C', 'Suite 100') GROUP BY ca_state, p_promo_name ORDER BY total_net_profit DESC, ca_state, p_promo_name;
SELECT cp.cp_department, cp.cp_catalog_number, cp.cp_description, cp.cp_type, t.t_shift, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_return_ship_cost) AS total_return_ship_cost, SUM(cr.cr_net_loss) AS net_loss FROM catalog_page cp JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk JOIN time_dim t ON cr.cr_returned_time_sk = t.t_time_sk WHERE cp.cp_end_date_sk IN ('2451087', '2451178') AND t.t_shift = 'third' AND cp.cp_catalog_page_sk IN ('562', '3351', '1660') GROUP BY cp.cp_department, cp.cp_catalog_number, cp.cp_description, cp.cp_type, t.t_shift ORDER BY cp.cp_department, cp.cp_catalog_number, cp.cp_description;
SELECT sm.sm_type AS ship_mode_type, p.p_promo_name AS promotion_name, r.r_reason_desc AS return_reason, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_net_loss) AS total_net_loss, COUNT(DISTINCT cs.cs_order_number) AS total_sales_orders, SUM(cs.cs_sales_price) AS total_sales_amount, AVG(cs.cs_sales_price) AS avg_sales_price, (SUM(cr.cr_return_amount) / NULLIF(SUM(cs.cs_sales_price), 0)) * 100 AS return_rate_percentage FROM catalog_returns cr JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN catalog_sales cs ON cr.cr_order_number = cs.cs_order_number JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk GROUP BY sm.sm_type, p.p_promo_name, r.r_reason_desc ORDER BY total_returns DESC, total_net_loss DESC LIMIT 10;
SELECT cp.cp_type, w.w_state, COUNT(cs.cs_order_number) AS total_sales_orders, SUM(cs.cs_quantity) AS total_sales_quantity, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_sales_net_paid, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_net_loss) AS total_returns_net_loss, COUNT(DISTINCT wr.wr_order_number) AS total_web_returns_orders, AVG(wr.wr_return_amt) AS average_web_return_amount, SUM(wr.wr_net_loss) AS total_web_returns_net_loss FROM catalog_sales cs JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk LEFT JOIN store_returns sr ON cs.cs_item_sk = sr.sr_item_sk AND cs.cs_order_number = sr.sr_ticket_number LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number WHERE cp.cp_type IN ('quarterly', 'bi-annual', 'monthly') AND cp.cp_end_date_sk IN (2450904, 2451574, 2451419, 2451634, 2451144) AND w.w_country = 'United States' GROUP BY cp.cp_type, w.w_state ORDER BY total_sales_net_paid DESC;
SELECT c.cp_department, i.i_category, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_fee) AS total_fees_collected, SUM(cr.cr_net_loss) AS total_net_loss, w.w_state, hd.hd_buy_potential FROM catalog_returns cr JOIN catalog_page c ON cr.cr_catalog_page_sk = c.cp_catalog_page_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk WHERE cr.cr_returning_addr_sk IN ('31623', '47914', '49311', '38890', '49597') AND w.w_state = 'TN' AND hd.hd_buy_potential IN ('501-1000', '5001-10000') GROUP BY c.cp_department, i.i_category, w.w_state, hd.hd_buy_potential ORDER BY total_return_amount DESC, c.cp_department, i.i_category;
SELECT s_state, s_city, COUNT(DISTINCT s_store_sk) AS num_stores, SUM(inv_quantity_on_hand) AS total_inventory, AVG(cd_purchase_estimate) AS avg_purchase_estimate, COUNT(DISTINCT wp_web_page_sk) AS num_web_pages, SUM(wp_link_count) AS total_link_count, COUNT(CASE WHEN cd_credit_rating = 'High Risk' THEN 1 END) AS high_risk_customers, COUNT(CASE WHEN cd_credit_rating = 'Low Risk' THEN 1 END) AS low_risk_customers, AVG(cd_dep_count) AS avg_dep_count, SUM(cd_dep_employed_count) AS total_dep_employed_count, AVG(s_number_employees) AS avg_store_employees, AVG(s_floor_space) AS avg_store_floor_space FROM store LEFT JOIN inventory ON s_store_sk = inv_warehouse_sk LEFT JOIN customer_demographics ON s_market_id = cd_demo_sk LEFT JOIN web_page ON s_store_sk = wp_customer_sk WHERE s_rec_end_date IS NULL AND wp_char_count IN (1147, 1711, 6577) AND inv_quantity_on_hand IN (505, 375, 593, 141, 402, 949) AND s_suite_number IN ('Suite D', 'Suite 80', 'Suite 190', 'Suite 100') AND s_division_name = 'Unknown' AND cd_dep_employed_count = 0 AND cd_credit_rating IN ('High Risk', 'Low Risk', 'Good', 'Unknown') GROUP BY s_state, s_city ORDER BY s_state, s_city;
SELECT cp.cp_department, sm.sm_type, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_net_profit, AVG(cs.cs_net_profit) AS average_net_profit, SUM(wr.wr_return_quantity) AS total_return_quantity, SUM(wr.wr_net_loss) AS total_net_loss FROM catalog_sales cs JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number WHERE cp.cp_type IN ('quarterly', 'bi-annual', 'monthly') AND cs.cs_ext_tax IN (10.31, 370.42, 9.07) GROUP BY cp.cp_department, sm.sm_type ORDER BY total_net_profit DESC, total_net_loss ASC;
