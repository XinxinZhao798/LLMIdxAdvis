SELECT dd.d_year, dd.d_month_seq, dd.d_quarter_seq, cc.cc_class, SUM(sr.sr_return_amt) AS total_store_returns, AVG(sr.sr_return_quantity) AS avg_store_return_quantity, COUNT(DISTINCT sr.sr_ticket_number) AS count_store_return_tickets, SUM(wr.wr_return_amt) AS total_web_returns, AVG(wr.wr_return_quantity) AS avg_web_return_quantity, COUNT(DISTINCT wr.wr_order_number) AS count_web_return_orders FROM date_dim dd JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk JOIN web_returns wr ON dd.d_date_sk = wr.wr_returned_date_sk JOIN call_center cc ON cc.cc_open_date_sk = dd.d_date_sk WHERE dd.d_year = 2002 AND cc.cc_rec_start_date = '2002-01-01' AND (cc.cc_street_name = 'Center Hill' OR cc.cc_street_name = 'Ash Hill') AND (wr.wr_returned_time_sk IS NOT NULL AND sr.sr_return_time_sk IS NOT NULL) AND (wr.wr_returned_time_sk IN (SELECT t_time_sk FROM time_dim WHERE t_minute IN ('51', '4', '29', '2', '14', '12'))) AND EXISTS (SELECT 1 FROM warehouse w WHERE w.w_warehouse_sk = sr.sr_item_sk AND w.w_county = 'Williamson County' AND w.w_state = 'TN') GROUP BY dd.d_year, dd.d_month_seq, dd.d_quarter_seq, cc.cc_class ORDER BY dd.d_year, dd.d_month_seq, dd.d_quarter_seq, cc.cc_class;
SELECT i.i_category, i.i_brand, w.w_state, w.w_country, AVG(i.i_current_price) AS avg_price, SUM(i.i_wholesale_cost) AS total_wholesale_cost, COUNT(DISTINCT i.i_item_sk) AS item_count, SUM(inv.inv_quantity_on_hand) AS total_quantity_on_hand FROM item i JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk WHERE w.w_zip = '35709' AND w.w_gmt_offset = -5.00 AND inv.inv_quantity_on_hand > 258 GROUP BY i.i_category, i.i_brand, w.w_state, w.w_country ORDER BY i.i_category, i.i_brand;
SELECT i.i_category AS category, p.p_channel_dmail AS promo_direct_mail, p.p_channel_email AS promo_email, p.p_channel_catalog AS promo_catalog, COUNT(DISTINCT i.i_item_sk) AS total_items, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk GROUP BY i.i_category, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog ORDER BY total_net_profit DESC, total_quantity_sold DESC;
SELECT s.s_division_name, AVG(s.s_number_employees) as avg_employees, SUM(s.s_floor_space) as total_floor_space, COUNT(DISTINCT c.c_customer_sk) as total_customers, AVG(i.ib_upper_bound) as avg_income_upper_bound, MIN(i.ib_lower_bound) as min_income_lower_bound, COUNT(DISTINCT wp.wp_web_page_sk) as total_web_pages, SUM(wp.wp_image_count) as total_images FROM store s JOIN customer c ON s.s_store_sk = c.c_current_addr_sk LEFT JOIN income_band i ON i.ib_income_band_sk = c.c_current_hdemo_sk LEFT JOIN web_page wp ON wp.wp_customer_sk = c.c_customer_sk WHERE s.s_division_name <> 'Unknown' AND c.c_current_addr_sk IN (13536, 17282) AND c.c_first_shipto_date_sk = 2451994 AND i.ib_upper_bound IN (90000, 30000, 20000, 200000, 70000, 60000) AND i.ib_lower_bound > 110001 GROUP BY s.s_division_name ORDER BY total_customers DESC;
SELECT ca_state, ca_city, SUM(cs_net_paid_inc_tax) AS total_sales, AVG(cs_net_paid_inc_tax) AS avg_sales, COUNT(DISTINCT cs_order_number) AS num_sales_orders, SUM(cr_return_amt_inc_tax) AS total_returns, AVG(cr_return_amt_inc_tax) AS avg_returns, COUNT(DISTINCT cr_order_number) AS num_return_orders, SUM(cr_net_loss) AS total_net_loss FROM customer_address JOIN catalog_sales ON cs_bill_addr_sk = ca_address_sk LEFT JOIN catalog_returns ON cr_order_number = cs_order_number JOIN web_sales ON ws_order_number = cs_order_number JOIN time_dim ON ws_sold_time_sk = t_time_sk JOIN web_page ON ws_web_page_sk = wp_web_page_sk WHERE t_sub_shift = 'night' AND ws_ship_date_sk = 2450935 AND ws_web_page_sk IN (41, 3, 18, 4, 45) AND wp_creation_date_sk IN (2450810, 2450808, 2450812, 2450809) GROUP BY ca_state, ca_city ORDER BY ca_state, ca_city;
SELECT s.s_store_name, s.s_store_id, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_net_sales, SUM(ss.ss_net_paid_inc_tax) AS total_net_sales_including_tax, SUM(cr.cr_return_quantity) AS total_returned_quantity, SUM(cr.cr_return_amount) AS total_return_amount, r.r_reason_desc AS return_reason, AVG(ss.ss_net_profit) AS average_net_profit_per_sale, COUNT(DISTINCT cr.cr_order_number) AS total_return_transactions, SUM(cr.cr_net_loss) AS total_net_loss_from_returns FROM store s LEFT JOIN store_sales ss ON s.s_store_sk = ss.ss_store_sk LEFT JOIN catalog_returns cr ON ss.ss_item_sk = cr.cr_item_sk AND ss.ss_ticket_number = cr.cr_order_number LEFT JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk WHERE s.s_gmt_offset = '-5.00' AND s.s_division_id = 1 AND ( r.r_reason_desc = 'its is a boy' OR r.r_reason_desc = 'reason 25' OR r.r_reason_desc = 'Found a better extended warranty in a store' OR r.r_reason_desc = 'reason 27' ) GROUP BY s.s_store_name, s.s_store_id, r.r_reason_desc ORDER BY s.s_store_name, s.s_store_id, r.r_reason_desc;
SELECT c.c_first_name, c.c_last_name, c.c_birth_country, c.c_email_address, COUNT(sr.sr_return_quantity) AS total_returns, SUM(sr.sr_return_amt) AS total_return_amt, AVG(sr.sr_return_amt) AS avg_return_amt, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_return_ship_cost) AS total_ship_cost, SUM(sr.sr_net_loss) AS total_net_loss, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_carrier FROM customer c JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN income_band ib ON c.c_current_cdemo_sk = ib.ib_income_band_sk JOIN ship_mode sm ON sm.sm_ship_mode_id = 'AAAAAAAABBAAAAAA' WHERE c.c_preferred_cust_flag = 'Y' GROUP BY c.c_first_name, c.c_last_name, c.c_birth_country, c.c_email_address, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_carrier ORDER BY total_return_amt DESC;
SELECT c.c_first_name, c.c_last_name, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_returns, SUM(cr.cr_return_amount) AS sum_catalog_returns, AVG(cr.cr_return_amount) AS avg_catalog_returns, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, SUM(sr.sr_return_amt) AS sum_store_returns, AVG(sr.sr_return_amt) AS avg_store_returns, COUNT(DISTINCT wr.wr_order_number) AS total_web_returns, SUM(wr.wr_return_amt) AS sum_web_returns, AVG(wr.wr_return_amt) AS avg_web_returns, SUM(cr.cr_return_amount + sr.sr_return_amt + wr.wr_return_amt) AS total_returned_amount, SUM(cr.cr_net_loss + sr.sr_net_loss + wr.wr_net_loss) AS total_net_loss FROM customer c LEFT JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_refunded_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_refunded_customer_sk WHERE (cr.cr_refunded_addr_sk = 22501 OR sr.sr_customer_sk = 76655 OR wr.wr_returning_addr_sk IN (28032, 35974, 28752, 35185)) AND wr.wr_net_loss IN ('349.19', '1875.35', '119.73', '151.90', '2317.12', '1172.86') AND cr.cr_store_credit IN ('43.17', '27.97', '302.61', '30.81', '19.81', '561.19') AND EXISTS (SELECT 1 FROM web_page wp WHERE wp.wp_type = 'order' AND wp.wp_web_page_sk = wr.wr_web_page_sk) GROUP BY c.c_first_name, c.c_last_name ORDER BY total_returned_amount DESC, total_net_loss DESC;
SELECT w.w_warehouse_name, w.w_warehouse_sq_ft, AVG(i.inv_quantity_on_hand) AS avg_quantity_on_hand, COUNT(DISTINCT p.p_promo_sk) AS num_promotions, SUM(CASE WHEN p.p_discount_active = 'Y' THEN 1 ELSE 0 END) AS active_discounts FROM warehouse w JOIN inventory i ON w.w_warehouse_sk = i.inv_warehouse_sk LEFT JOIN promotion p ON i.inv_item_sk = p.p_item_sk WHERE w.w_city = 'Fairview' GROUP BY w.w_warehouse_sk, w.w_warehouse_name, w.w_warehouse_sq_ft ORDER BY w.w_warehouse_name;
SELECT d_year, w_state AS warehouse_state, sm_type AS shipping_type, p_promo_name, COUNT(DISTINCT cc_call_center_sk) AS number_of_call_centers, SUM(inv_quantity_on_hand) AS total_inventory, AVG(w_warehouse_sq_ft) AS average_warehouse_size, MAX(p_cost) AS max_promotion_cost, MIN(p_cost) AS min_promotion_cost, AVG(p_cost) AS average_promotion_cost, SUM(CASE WHEN p_channel_demo = 'N' THEN p_cost ELSE 0 END) AS sum_cost_non_demo_promotions FROM date_dim JOIN inventory ON inv_date_sk = d_date_sk JOIN warehouse ON w_warehouse_sk = inv_warehouse_sk JOIN ship_mode ON w_zip = sm_ship_mode_id JOIN call_center ON cc_zip = w_zip LEFT JOIN promotion ON p_promo_sk = inv_item_sk WHERE d_year = 1998 AND w_warehouse_sq_ft IN (977787, 294242, 621234, 138504) AND w_zip = '35709' AND d_quarter_seq IN (24, 3) AND d_fy_week_seq IN (444, 401, 706, 517, 70) AND inv_item_sk IN (6008, 6322, 13964, 9541) AND p_channel_demo = 'N' GROUP BY d_year, warehouse_state, shipping_type, p_promo_name ORDER BY d_year, warehouse_state, shipping_type, p_promo_name;
SELECT dd.d_year, dd.d_quarter_name, SUM(cs.cs_net_paid_inc_ship) AS total_revenue, AVG(cs.cs_quantity) AS average_quantity_sold, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(CASE WHEN cd.cd_gender = 'F' THEN cs.cs_net_paid_inc_ship ELSE 0 END) AS female_total_revenue, SUM(CASE WHEN cd.cd_gender = 'M' THEN cs.cs_net_paid_inc_ship ELSE 0 END) AS male_total_revenue, COUNT(DISTINCT CASE WHEN ib.ib_upper_bound <= 50000 THEN cs.cs_bill_customer_sk END) AS customers_low_income, COUNT(DISTINCT CASE WHEN ib.ib_upper_bound > 50000 AND ib.ib_upper_bound <= 150000 THEN cs.cs_bill_customer_sk END) AS customers_mid_income, COUNT(DISTINCT CASE WHEN ib.ib_upper_bound > 150000 THEN cs.cs_bill_customer_sk END) AS customers_high_income, COUNT(DISTINCT sm.sm_ship_mode_sk) AS shipping_modes_used, COUNT(DISTINCT w.w_warehouse_sk) AS warehouses_used, COUNT(DISTINCT p.p_promo_sk) AS promotions_run FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk LEFT JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound WHERE dd.d_year IN (2020, 2021) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_net_profit, AVG(hd.hd_dep_count) AS average_dependency_count, AVG(hd.hd_vehicle_count) AS average_vehicle_count, SUM(ws.ws_net_paid_inc_ship) AS total_web_net_paid_inc_ship, AVG(ws.ws_net_paid_inc_ship) AS average_web_net_paid_inc_ship, SUM(ws.ws_quantity) AS total_web_quantity_sold, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, s.s_country, s.s_tax_precentage, MAX(t.t_time) AS max_time_of_purchase, MIN(t.t_time) AS min_time_of_purchase FROM income_band ib LEFT JOIN household_demographics hd ON ib.ib_income_band_sk = hd.hd_income_band_sk LEFT JOIN catalog_sales cs ON hd.hd_demo_sk = cs.cs_bill_hdemo_sk LEFT JOIN web_sales ws ON hd.hd_demo_sk = ws.ws_bill_hdemo_sk LEFT JOIN store s ON s.s_store_sk = cs.cs_warehouse_sk LEFT JOIN time_dim t ON t.t_time_sk = cs.cs_sold_time_sk WHERE s.s_country = 'United States' AND t.t_am_pm = 'AM' AND s.s_tax_precentage IN (0.08, 0.01) AND ws.ws_net_paid_inc_ship IN (1475.10, 4030.95, 1226.89, 21728.07) AND t.t_second = 36 GROUP BY ib.ib_income_band_sk, s.s_country, s.s_tax_precentage ORDER BY total_net_profit DESC, total_web_net_paid_inc_ship DESC;
SELECT ca.ca_state, ca.ca_city, COUNT(DISTINCT c.c_customer_sk) AS num_customers, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_inc_tax, AVG(wr.wr_return_quantity) AS average_return_quantity, SUM(wr.wr_fee) AS total_fees, AVG(cd.cd_purchase_estimate) AS average_purchase_estimate FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN web_returns wr ON c.c_customer_sk = wr.wr_refunded_customer_sk WHERE ca.ca_state IN ('CA', 'WA', 'GA') AND cd.cd_education_status IN ('College', '4 yr Degree', 'Advanced Degree') AND wr.wr_net_loss > 500 GROUP BY ca.ca_state, ca.ca_city ORDER BY total_return_amount_inc_tax DESC, ca.ca_state, ca.ca_city;
SELECT ca_state, count(*) AS address_count, avg(ca_gmt_offset) AS average_gmt_offset, sm_type, sm_carrier, count(DISTINCT sm_ship_mode_sk) AS unique_ship_mode_count, ib_lower_bound, ib_upper_bound, sum(CASE WHEN ib_upper_bound <= 20000 THEN 1 ELSE 0 END) AS low_income_band_count, sum(CASE WHEN ib_upper_bound > 20000 AND ib_upper_bound <= 40000 THEN 1 ELSE 0 END) AS mid_income_band_count, sum(CASE WHEN ib_upper_bound > 170000 THEN 1 ELSE 0 END) AS high_income_band_count, avg(ib_lower_bound + ib_upper_bound) / 2 AS average_income_band FROM customer_address JOIN ship_mode ON ca_zip = left(sm_ship_mode_id, 5) JOIN income_band ON ib_income_band_sk::text = right(sm_ship_mode_id, length(sm_ship_mode_id) - 5) GROUP BY ca_state, sm_type, sm_carrier, ib_lower_bound, ib_upper_bound ORDER BY ca_state, sm_type, sm_carrier, ib_lower_bound;
SELECT i.i_item_id, i.i_category, i.i_class, i.i_brand, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(cr.cr_returned_date_sk) AS return_count, SUM(cr.cr_fee) AS total_fee, SUM(cr.cr_return_ship_cost) AS total_shipping_cost, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN web_site ws ON cr.cr_returned_date_sk = ws.web_open_date_sk WHERE ws.web_gmt_offset = '-5.00' AND ws.web_mkt_id IN (3, 5, 6, 1, 4, 2) AND i.i_size IN ('small', 'extra large') AND i.i_class IN ('hockey', 'infants', 'portable', 'memory') AND cr.cr_reason_sk = 3 GROUP BY i.i_item_id, i.i_category, i.i_class, i.i_brand ORDER BY total_return_amount DESC, return_count DESC LIMIT 100;
SELECT sm.sm_type AS shipping_method, dd.d_year AS year, dd.d_quarter_name AS quarter, SUM(cs.cs_net_paid_inc_ship_tax) AS total_sales, COUNT(DISTINCT cs.cs_order_number) AS total_sales_orders, SUM(cr.cr_net_loss) AS total_returns, COUNT(DISTINCT cr.cr_order_number) AS total_return_orders FROM ship_mode sm LEFT JOIN catalog_sales cs ON sm.sm_ship_mode_sk = cs.cs_ship_mode_sk LEFT JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number WHERE sm.sm_code IN ('AIR', 'SEA', 'SURFACE', 'BIKE') AND dd.d_quarter_seq IN (47, 48) GROUP BY shipping_method, year, quarter ORDER BY year, quarter, shipping_method;
