SELECT ws.web_class, ws.web_name, SUM(cs.cs_net_profit) AS total_catalog_profit, AVG(cs.cs_net_profit) AS avg_catalog_profit, COUNT(cs.cs_order_number) AS total_catalog_orders, SUM(ss.ss_net_profit) AS total_store_profit, AVG(ss.ss_net_profit) AS avg_store_profit, COUNT(ss.ss_ticket_number) AS total_store_sales, SUM(wr.wr_net_loss) AS total_web_return_loss, COUNT(wr.wr_order_number) AS total_web_returns, AVG(hd.hd_dep_count) AS avg_household_dep_count, AVG(hd.hd_vehicle_count) AS avg_household_vehicles FROM web_site ws LEFT JOIN catalog_sales cs ON cs.cs_ship_date_sk = ws.web_site_sk LEFT JOIN store_sales ss ON ss.ss_sold_date_sk = ws.web_open_date_sk LEFT JOIN web_returns wr ON wr.wr_returned_date_sk = ws.web_close_date_sk LEFT JOIN household_demographics hd ON hd.hd_demo_sk = cs.cs_bill_hdemo_sk OR hd.hd_demo_sk = ss.ss_hdemo_sk WHERE ws.web_rec_start_date BETWEEN '1997-08-16' AND '2001-08-16' AND (wr.wr_item_sk IN ('1870', '5485') OR wr.wr_refunded_customer_sk IN ('84641', '95983', '47362', '18574', '28388', '7194')) GROUP BY ws.web_class, ws.web_name ORDER BY ws.web_class, total_catalog_profit DESC;
SELECT sm.sm_type, w.w_state, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_net_loss) AS total_net_loss, SUM(cs.cs_sales_price) AS total_sales, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_net_profit, SUM(i.inv_quantity_on_hand) AS total_inventory_on_hand FROM catalog_returns cr JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN catalog_sales cs ON cr.cr_item_sk = cs.cs_item_sk AND cr.cr_order_number = cs.cs_order_number JOIN inventory i ON cr.cr_item_sk = i.inv_item_sk AND w.w_warehouse_sk = i.inv_warehouse_sk WHERE cr.cr_returning_customer_sk IN ('98306', '44541', '85') GROUP BY sm.sm_type, w.w_state ORDER BY total_net_loss DESC;
SELECT ca_state, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT sr_customer_sk) AS unique_customers_returning, SUM(CASE WHEN p_channel_press = 'N' AND p_channel_catalog = 'N' THEN sr_return_amt ELSE 0 END) AS total_return_amount_no_press_no_catalog, wm.warehouse_count, sm.sm_count, ib.ib_count FROM store_returns sr JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN (SELECT w_state, COUNT(*) AS warehouse_count FROM warehouse GROUP BY w_state) wm ON ca.ca_state = wm.w_state JOIN (SELECT sm_carrier, COUNT(*) AS sm_count FROM ship_mode WHERE sm_carrier IN ('ALLIANCE', 'ZOUROS', 'UPS') GROUP BY sm_carrier) sm ON 1=1 JOIN (SELECT ib_lower_bound, COUNT(*) AS ib_count FROM income_band GROUP BY ib_lower_bound) ib ON 1=1 LEFT JOIN promotion p ON sr.sr_reason_sk = p.p_promo_sk WHERE sr.sr_reason_sk IN (19, 26, 34, 7, 29) AND ca.ca_street_name IN ('Johnson Spruce', '12th View', 'Dogwood 12th', '15th Third', 'Ninth Fourth', '1st 7th') AND sr_return_amt > 0 GROUP BY ca_state, wm.warehouse_count, sm.sm_count, ib.ib_count ORDER BY total_return_amount DESC LIMIT 100;
SELECT ca.ca_state AS customer_state, EXTRACT(YEAR FROM d.d_date) AS year_of_return, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_customers, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_refund_amount, AVG(cr.cr_return_amount) AS average_refund_amount, SUM(cr.cr_return_quantity) AS total_returned_quantity, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk WHERE ca.ca_state IS NOT NULL AND cr.cr_returned_date_sk IS NOT NULL GROUP BY customer_state, year_of_return ORDER BY customer_state, year_of_return;
SELECT ca_state, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_ticket_number) AS total_sales_transactions, SUM(ss_net_profit) AS total_net_profit FROM store_sales JOIN customer_address ON store_sales.ss_addr_sk = customer_address.ca_address_sk WHERE customer_address.ca_country = 'United States' AND store_sales.ss_sold_date_sk BETWEEN 20220101 AND 20221231 GROUP BY ca_state ORDER BY total_net_profit DESC;
SELECT st.s_store_name, st.s_store_id, SUM(ws.ws_net_paid) AS total_net_sales, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(wr.wr_order_number) AS total_returns, AVG(wr.wr_return_amt) AS avg_return_amount, ARRAY_AGG(DISTINCT re.r_reason_desc) AS reasons_for_returns FROM store st LEFT JOIN web_sales ws ON st.s_store_sk = ws.ws_warehouse_sk LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number LEFT JOIN reason re ON wr.wr_reason_sk = re.r_reason_sk WHERE st.s_division_id = 1 AND st.s_tax_precentage BETWEEN 0.01 AND 0.06 GROUP BY st.s_store_name, st.s_store_id ORDER BY total_net_sales DESC, avg_sales_price DESC, total_returns DESC, avg_return_amount DESC;
SELECT cr_returned_date_sk AS return_date, SUM(cr_return_quantity) AS total_catalog_return_quantity, SUM(cr_return_amount) AS total_catalog_return_amount, AVG(cr_return_amount) AS avg_catalog_return_amount, COUNT(DISTINCT cr_refunded_customer_sk) AS unique_catalog_customers, SUM(sr_return_quantity) AS total_store_return_quantity, SUM(sr_return_amt) AS total_store_return_amount, AVG(sr_return_amt) AS avg_store_return_amount, COUNT(DISTINCT sr_customer_sk) AS unique_store_customers, SUM(wr_return_quantity) AS total_web_return_quantity, SUM(wr_return_amt) AS total_web_return_amount, AVG(wr_return_amt) AS avg_web_return_amount, COUNT(DISTINCT wr_returning_customer_sk) AS unique_web_customers FROM catalog_returns JOIN store_returns ON cr_item_sk = sr_item_sk AND cr_order_number = sr_ticket_number JOIN web_returns ON cr_item_sk = wr_item_sk AND cr_order_number = wr_order_number WHERE cr_returned_date_sk IS NOT NULL AND sr_returned_date_sk IS NOT NULL AND wr_returned_date_sk IS NOT NULL GROUP BY cr_returned_date_sk ORDER BY cr_returned_date_sk;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_net_paid_inc_tax) AS avg_sales_inc_tax, COUNT(*) AS number_of_sales, SUM(ws.ws_quantity) AS total_web_quantity_sold, AVG(ws.ws_net_profit) AS avg_web_net_profit FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN web_sales ws ON cs.cs_item_sk = ws.ws_item_sk AND cs.cs_order_number = ws.ws_order_number JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk AND ws.ws_promo_sk = p.p_promo_sk WHERE cs.cs_ship_customer_sk IN (17646, 63607, 15126, 61460) AND p.p_discount_active = '1' AND cc.cc_rec_start_date <= CURRENT_DATE AND (cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date > CURRENT_DATE) GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_sales DESC LIMIT 10;
SELECT s_state, s_city, s_county, COUNT(DISTINCT s_store_sk) AS num_stores, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, SUM(ss_net_paid) AS total_net_paid, SUM(ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss_net_profit) AS total_net_profit, COUNT(DISTINCT ss_customer_sk) AS unique_customers, AVG(inv_quantity_on_hand) AS average_inventory_on_hand FROM store JOIN store_sales ON s_store_sk = ss_store_sk JOIN inventory ON ss_item_sk = inv_item_sk AND ss_store_sk = inv_warehouse_sk JOIN time_dim ON ss_sold_time_sk = t_time_sk WHERE inv_quantity_on_hand IN (553, 372, 818, 629, 791, 623) AND inv_warehouse_sk IN (1, 2) AND t_hour BETWEEN 9 AND 17 GROUP BY s_state, s_city, s_county ORDER BY s_state, s_city, s_county;
SELECT i.i_category, i.i_brand, COUNT(DISTINCT i.i_item_sk) AS num_items, SUM(i.i_current_price) AS total_current_price, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, COUNT(DISTINCT c.c_customer_sk) AS num_customers, AVG(c.c_birth_year) AS avg_customer_birth_year, r.r_reason_desc, COUNT(*) AS num_return_reasons FROM item i JOIN customer c ON i.i_manager_id = c.c_current_cdemo_sk LEFT JOIN reason r ON r.r_reason_desc IN ('Package was damaged', 'Did not like the make', 'Parts missing') WHERE i.i_rec_start_date >= '2020-01-01' AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date > CURRENT_DATE) GROUP BY i.i_category, i.i_brand, r.r_reason_desc ORDER BY i.i_category, i.i_brand, r.r_reason_desc;
SELECT ca_state, cd_gender, cd_education_status, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN customer_address ON cs_bill_addr_sk = ca_address_sk JOIN customer_demographics ON cs_bill_cdemo_sk = cd_demo_sk JOIN time_dim ON cs_sold_time_sk = t_time_sk JOIN web_page ON cs_sold_date_sk = wp_access_date_sk WHERE ca_country = 'United States' AND t_shift = 'Day' AND wp_type IN ('order', 'general') AND cd_gender IN ('M', 'F') AND cd_dep_count IN (1, 2) GROUP BY ca_state, cd_gender, cd_education_status ORDER BY total_net_profit DESC, total_net_paid DESC, avg_sales_price DESC;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, COUNT(DISTINCT c.c_customer_sk) AS num_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid_inc_tax) AS total_sales_with_tax, SUM(wr.wr_return_quantity) AS total_quantity_returned, SUM(wr.wr_return_amt_inc_tax) AS total_returns_with_tax, SUM(ss.ss_net_profit) - SUM(wr.wr_net_loss) AS net_profit FROM customer_demographics cd JOIN customer c ON cd.cd_demo_sk = c.c_current_cdemo_sk LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk WHERE (ss.ss_sold_date_sk BETWEEN 20030101 AND 20031231 OR wr.wr_returned_date_sk BETWEEN 20030101 AND 20031231) GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating ORDER BY net_profit DESC;
SELECT dd.d_quarter_name, cd.cd_education_status, cd.cd_purchase_estimate, AVG(ss.ss_sales_price) AS avg_sales_price, AVG(sr.sr_return_amt) AS avg_return_amount, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number WHERE dd.d_qoy IN ('1', '2', '3', '4') AND cd.cd_purchase_estimate IN ('1500', '500', '4000') GROUP BY dd.d_quarter_name, cd.cd_education_status, cd.cd_purchase_estimate ORDER BY dd.d_quarter_name, cd.cd_education_status, cd.cd_purchase_estimate;
SELECT d_year, i_category, s_state, SUM(i_current_price) AS total_price, AVG(i_current_price) AS avg_price, COUNT(DISTINCT i_item_sk) AS unique_items_sold, COUNT(DISTINCT s_store_sk) AS number_of_stores, SUM(p_cost) AS total_promotion_cost, AVG(p_cost) AS avg_promotion_cost, COUNT(DISTINCT p_promo_sk) AS number_of_promotions, MAX(wp_max_ad_count) AS max_ad_count_webpage FROM date_dim, item, store, promotion, web_page, ship_mode WHERE i_rec_start_date <= d_date AND (i_rec_end_date IS NULL OR i_rec_end_date > d_date) AND s_rec_start_date <= d_date AND (s_rec_end_date IS NULL OR s_rec_end_date > d_date) AND wp_rec_start_date <= d_date AND (wp_rec_end_date IS NULL OR wp_rec_end_date > d_date) AND p_start_date_sk = d_date_sk AND (p_end_date_sk IS NULL OR p_end_date_sk >= d_date_sk) AND sm_type IN ('REGULAR', 'LIBRARY') AND i_class IN ('sports-apparel', 'decor', 'dvd/vcr players', 'shirts', 'bedding', 'fishing') AND p_channel_event = 'N' AND p_purpose <> 'Unknown' GROUP BY d_year, i_category, s_state ORDER BY d_year, i_category, s_state;
SELECT s.s_store_name, i.i_brand, i.i_category, AVG(ws_sales_price) AS avg_sales_price, SUM(ws_net_paid_inc_ship_tax) AS total_sales_with_tax, AVG(ws_ext_discount_amt) AS avg_discount_amount, COUNT(DISTINCT ws_item_sk) AS total_items_sold, COUNT(DISTINCT ws_order_number) AS total_orders FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN store s ON s.s_store_sk = ws.ws_warehouse_sk WHERE ws.ws_net_profit >= 100 AND i.i_rec_start_date <= CURRENT_DATE AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date > CURRENT_DATE) AND s.s_rec_start_date <= CURRENT_DATE AND (s.s_rec_end_date IS NULL OR s.s_rec_end_date > CURRENT_DATE) GROUP BY s.s_store_name, i.i_brand, i.i_category ORDER BY total_sales_with_tax DESC, avg_sales_price DESC, total_items_sold DESC LIMIT 100;
