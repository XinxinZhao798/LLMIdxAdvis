SELECT ws.web_class, AVG(ws.web_tax_percentage) AS average_tax_percentage, CA.ca_state, SUM(CA.ca_gmt_offset) AS total_gmt_offset, COUNT(DISTINCT SM.sm_ship_mode_sk) AS shipping_mode_count FROM web_site AS ws JOIN customer_address AS CA ON ws.web_state = CA.ca_state JOIN ship_mode AS SM ON ws.web_zip = SM.sm_code WHERE CA.ca_state IN ('NH', 'MI', 'MD', 'UT') GROUP BY ws.web_class, CA.ca_state ORDER BY ws.web_class, CA.ca_state;
SELECT ca.ca_state, EXTRACT(YEAR FROM TO_DATE(c.c_first_shipto_date_sk::text, 'YYYYMMDD')) AS first_shipto_year, p.p_channel_details, COUNT(DISTINCT c.c_customer_sk) AS num_customers, AVG(ws.ws_net_profit) AS avg_web_net_profit, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, COUNT(DISTINCT ws.ws_order_number) AS num_web_orders, COUNT(DISTINCT sr.sr_ticket_number) AS num_returns FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk AND sr.sr_addr_sk = 23889 JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk WHERE c.c_birth_month IN (10, 6, 9, 7, 5) AND p.p_channel_catalog = 'N' AND ws.ws_list_price = 218.80 AND p.p_promo_id IN ('AAAAAAAAPLAAAAAA', 'AAAAAAAAOMAAAAAA', 'AAAAAAAACAAAAAAA') GROUP BY ca.ca_state, first_shipto_year, p.p_channel_details ORDER BY ca.ca_state, first_shipto_year, p.p_channel_details;
SELECT cr.cr_returned_date_sk AS return_date, wp.wp_type AS web_page_type, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_including_tax, SUM(ws.ws_quantity) AS total_sold_quantity, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM catalog_returns cr JOIN web_sales ws ON cr.cr_item_sk = ws.ws_item_sk AND cr.cr_order_number = ws.ws_order_number JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk GROUP BY cr.cr_returned_date_sk, wp.wp_type ORDER BY cr.cr_returned_date_sk, wp.wp_type;
SELECT ca.ca_state, cd.cd_education_status, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(ss.ss_quantity) AS total_sales_quantity, AVG(ss.ss_net_profit) AS avg_net_profit, SUM(sr.sr_return_quantity) AS total_return_quantity, AVG(sr.sr_net_loss) AS avg_net_loss, AVG(inv.inv_quantity_on_hand) AS avg_inventory_on_hand FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk LEFT JOIN inventory inv ON inv.inv_warehouse_sk = ca.ca_address_sk WHERE ca.ca_country = 'SERBIA' AND cd.cd_purchase_estimate BETWEEN 3500 AND 10000 AND inv.inv_warehouse_sk IN (1, 2) GROUP BY ca.ca_state, cd.cd_education_status ORDER BY ca.ca_state, cd.cd_education_status;
SELECT ws.web_site_id, ws.web_name, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(sr.sr_return_quantity) AS total_return_quantity, SUM(sr.sr_net_loss) AS total_net_loss, COUNT(DISTINCT inv.inv_item_sk) AS number_of_distinct_items_in_inventory, AVG(inv.inv_quantity_on_hand) AS avg_quantity_on_hand_per_warehouse, COUNT(DISTINCT inv.inv_warehouse_sk) AS number_of_warehouses FROM web_site ws LEFT JOIN store_returns sr ON ws.web_site_sk = sr.sr_store_sk LEFT JOIN inventory inv ON sr.sr_item_sk = inv.inv_item_sk WHERE ws.web_street_number IN ('805', '887', '247', '671', '835') AND inv.inv_date_sk = 2450815 AND sr.sr_hdemo_sk IN ('2871', '5640') AND inv.inv_warehouse_sk IN ('1', '2') GROUP BY ws.web_site_id, ws.web_name ORDER BY avg_return_amount_inc_tax DESC, total_return_quantity DESC, total_net_loss DESC;
SELECT d_year, d_qoy, cc_name, COUNT(DISTINCT cr_order_number) AS num_returns, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, COUNT(DISTINCT sr_ticket_number) AS num_store_returns, SUM(sr_return_amt) AS total_store_return_amount, AVG(sr_return_amt) AS avg_store_return_amount, SUM(hd_dep_count) AS total_dependants, AVG(hd_vehicle_count) AS avg_vehicles FROM date_dim JOIN catalog_returns ON cr_returned_date_sk = d_date_sk JOIN call_center ON cr_call_center_sk = cc_call_center_sk JOIN store_returns ON sr_returned_date_sk = d_date_sk JOIN household_demographics ON cr_returning_hdemo_sk = hd_demo_sk AND sr_hdemo_sk = hd_demo_sk WHERE d_qoy = 2 AND d_following_holiday = 'Y' AND hd_income_band_sk = 15 AND (cr_item_sk IN (10036, 2977) OR sr_item_sk IN (10036, 2977)) AND (cr_refunded_customer_sk IN (78674, 95319, 63625, 45060, 53817, 43545) OR sr_customer_sk IN (78674, 95319, 63625, 45060, 53817, 43545)) AND cc_street_name IN ('Center Hill', 'Pine Ridge', 'Ash Hill') GROUP BY d_year, d_qoy, cc_name ORDER BY d_year, d_qoy, cc_name;
SELECT p.p_promo_name AS promotion_name, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_return_amt_inc_tax) - SUM(wr.wr_fee) AS net_loss_after_fees, COUNT(DISTINCT wp.wp_web_page_id) AS distinct_pages_involved, sm.sm_type AS ship_method_type, MAX(wr.wr_return_amt_inc_tax) AS max_return_amount_incl_tax, MIN(wr.wr_return_amt_inc_tax) AS min_return_amount_incl_tax, COUNT(DISTINCT CASE WHEN cd.cd_gender = 'M' THEN wr.wr_returning_customer_sk END) AS male_customers, COUNT(DISTINCT CASE WHEN cd.cd_gender = 'F' THEN wr.wr_returning_customer_sk END) AS female_customers FROM web_returns wr INNER JOIN promotion p ON wr.wr_reason_sk = p.p_promo_sk INNER JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk INNER JOIN ship_mode sm ON CAST(SUBSTRING(wp.wp_url FROM 'http://www.%#"sm"#"%' FOR '#') AS INTEGER) = sm.sm_ship_mode_sk LEFT JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk WHERE wr.wr_returned_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk AND wp.wp_url = 'http://www.foo.com' AND wp.wp_link_count IN (15, 11) AND wr.wr_return_tax = 52.13 GROUP BY p.p_promo_name, sm.sm_type ORDER BY total_returns DESC, net_loss_after_fees DESC;
SELECT w_state, w_city, p_promo_name, COUNT(DISTINCT wr_order_number) AS total_returns, SUM(wr_return_quantity) AS total_returned_quantity, AVG(wr_return_amt) AS avg_return_amount, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(wr_fee) AS total_fees, SUM(wr_net_loss) AS total_net_loss FROM warehouse JOIN web_returns ON w_warehouse_sk = wr_returning_addr_sk JOIN promotion ON p_promo_sk = wr_web_page_sk WHERE w_street_name = 'Ash Laurel' AND p_channel_catalog = 'N' AND p_channel_press = 'N' AND wr_account_credit IN ('618.25', '63.54', '2191.76', '19.59', '469.21', '464.73') GROUP BY w_state, w_city, p_promo_name ORDER BY total_net_loss DESC, w_state, w_city;
SELECT i_category, i_class, COUNT(DISTINCT cr_order_number) AS total_returns, SUM(cr_return_quantity) AS total_returned_quantity, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_net_loss) AS total_net_loss, COUNT(DISTINCT ws_order_number) AS total_sales_orders, SUM(ws_quantity) AS total_sold_quantity, AVG(ws_sales_price) AS avg_sales_price, SUM(ws_net_profit) AS total_net_profit FROM catalog_returns JOIN item ON catalog_returns.cr_item_sk = item.i_item_sk JOIN web_sales ON item.i_item_sk = web_sales.ws_item_sk JOIN customer ON web_sales.ws_bill_customer_sk = customer.c_customer_sk JOIN income_band ON customer.c_current_hdemo_sk = income_band.ib_income_band_sk WHERE cr_returned_date_sk BETWEEN 20000101 AND 20001231 AND ws_sold_date_sk BETWEEN 20000101 AND 20001231 AND ib_income_band_sk IN (5, 8) AND cr_net_loss > 100 GROUP BY i_category, i_class ORDER BY total_net_loss DESC, total_net_profit DESC;
SELECT d_year, d_month_seq, COUNT(wp_web_page_sk) AS total_web_pages, AVG(wp_char_count) AS avg_char_count, SUM(wp_link_count) AS total_links, AVG(wp_image_count) AS avg_image_count, MAX(wp_max_ad_count) AS max_ad_count FROM web_page JOIN date_dim ON wp_access_date_sk = d_date_sk GROUP BY d_year, d_month_seq ORDER BY d_year, d_month_seq;
SELECT s.s_store_name, s.s_company_name, s.s_city, s.s_state, COUNT(DISTINCT w.w_warehouse_sk) AS total_warehouses, COUNT(DISTINCT c.cp_catalog_page_sk) AS total_catalog_pages, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages, AVG(s.s_floor_space) AS average_floor_space, SUM(s.s_number_employees) AS total_employees, AVG(s.s_tax_precentage) AS average_tax_percentage, COUNT(DISTINCT ca.ca_address_sk) FILTER (WHERE ca.ca_country = 'United States') AS total_us_customer_addresses, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft FROM store s LEFT JOIN warehouse w ON s.s_zip = w.w_zip LEFT JOIN catalog_page c ON s.s_market_id = c.cp_catalog_number LEFT JOIN web_page wp ON wp.wp_type = 'bi-annual' LEFT JOIN customer_address ca ON s.s_state = ca.ca_state WHERE s.s_rec_end_date IS NULL AND c.cp_type IN ('quarterly', 'bi-annual') AND c.cp_start_date_sk NOT IN ('2451453', '2451270') AND wp.wp_web_page_sk IN ('52', '2', '42', '39', '10') AND wp.wp_autogen_flag = 'N' GROUP BY s.s_store_sk, s.s_store_name, s.s_company_name, s.s_city, s.s_state ORDER BY s.s_store_name, s.s_state;
SELECT sm.sm_type, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_quantity) AS total_web_quantity_sold, AVG(ws.ws_sales_price) AS avg_web_sales_price, SUM(cr.cr_return_quantity) AS total_return_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cr.cr_order_number) AS total_returns FROM web_sales ws JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk LEFT JOIN catalog_returns cr ON ws.ws_order_number = cr.cr_order_number AND ws.ws_item_sk = cr.cr_item_sk WHERE sm.sm_type IN ('EXPRESS', 'OVERNIGHT', 'NEXT DAY') GROUP BY sm.sm_type, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY sm.sm_type, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, ib.ib_income_band_sk, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid) AS total_net_paid, AVG(ws.ws_net_profit) AS average_net_profit, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ws.ws_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(ws.ws_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax FROM call_center cc JOIN web_sales ws ON cc.cc_call_center_sk = ws.ws_web_site_sk JOIN income_band ib ON ws.ws_bill_cdemo_sk = ib.ib_income_band_sk WHERE cc.cc_rec_end_date > CURRENT_DATE AND ib.ib_lower_bound > 50000 AND ib.ib_upper_bound < 180000 AND ws.ws_list_price BETWEEN 100 AND 200 GROUP BY cc.cc_name, cc.cc_city, cc.cc_state, ib.ib_income_band_sk ORDER BY total_net_paid DESC, cc.cc_state, cc.cc_city;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, AVG(ss.ss_sales_price) AS average_sale_price, SUM(ss.ss_net_paid) AS total_sales, COUNT(ss.ss_ticket_number) AS number_of_sales FROM store_sales ss INNER JOIN call_center cc ON ss.ss_store_sk = cc.cc_call_center_sk GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_sales DESC, average_sale_price DESC LIMIT 10;
SELECT cp.cp_department, COUNT(*) AS total_catalog_pages, AVG(cp.cp_catalog_number) AS average_catalog_number, SUM(inv.inv_quantity_on_hand) AS total_inventory_quantity, AVG(wr.wr_return_amt_inc_tax) AS average_return_amount_inc_tax, COUNT(DISTINCT wr.wr_order_number) AS total_returned_orders, COUNT(DISTINCT cd.cd_demo_sk) AS unique_customers, SUM(CASE WHEN hd.hd_income_band_sk IS NOT NULL THEN 1 ELSE 0 END) AS households_with_income_band, sm.sm_type AS shipping_type, COUNT(DISTINCT sm.sm_ship_mode_sk) AS count_shipping_modes, ROUND(SUM(wr.wr_fee)::numeric, 2) AS total_fees_collected, ROUND(SUM(wr.wr_reversed_charge)::numeric, 2) AS total_reversed_charges FROM catalog_page cp LEFT JOIN inventory inv ON cp.cp_catalog_page_sk = inv.inv_item_sk LEFT JOIN web_returns wr ON inv.inv_item_sk = wr.wr_item_sk LEFT JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk LEFT JOIN household_demographics hd ON wr.wr_returning_hdemo_sk = hd.hd_demo_sk LEFT JOIN ship_mode sm ON sm.sm_ship_mode_sk IN (9, 10) WHERE cp.cp_start_date_sk IS NOT NULL AND cp.cp_end_date_sk IS NOT NULL AND (wr.wr_reversed_charge IN ('35.79', '219.13', '107.56', '7.03') OR wr.wr_fee IN ('60.42', '16.01', '7.56', '22.38')) AND (inv.inv_quantity_on_hand IN (932, 682, 540) OR inv.inv_item_sk IN (12650, 13507, 12682, 13526)) GROUP BY cp.cp_department, sm.sm_type ORDER BY total_catalog_pages DESC, average_return_amount_inc_tax DESC;
SELECT ca.ca_state AS customer_state, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sale_price, SUM(cr.cr_return_quantity) AS total_quantity_returned, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, COUNT(DISTINCT p.p_promo_sk) AS total_promotions_used, COUNT(DISTINCT w.w_warehouse_sk) AS total_warehouses_used FROM customer_address ca JOIN customer c ON ca.ca_address_sk = c.c_current_addr_sk JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk WHERE ca.ca_state IS NOT NULL AND p.p_channel_radio = 'N' AND (p.p_promo_name LIKE '%bar%' OR p.p_promo_name LIKE '%anti%') AND w.w_warehouse_id IN ('AAAAAAAABAAAAAAA', 'AAAAAAAADAAAAAAA', 'AAAAAAAAEAAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAACAAAAAAA') AND cs.cs_catalog_page_sk IN ( SELECT cp_catalog_page_sk FROM catalog_page WHERE cp_catalog_page_number IN (29, 24, 40) ) GROUP BY ca.ca_state ORDER BY total_return_amount DESC, average_sale_price DESC LIMIT 100;
SELECT i.i_category, i.i_class, i.i_brand, sum(ss.ss_quantity) AS total_quantity_sold, avg(ss.ss_sales_price) AS average_sales_price, sum(ss.ss_net_profit) AS total_net_profit, count(DISTINCT ss.ss_ticket_number) AS number_of_transactions, sum(ss.ss_coupon_amt) AS total_coupon_amount, ib.ib_lower_bound, ib.ib_upper_bound, date_dim.d_year, date_dim.d_quarter_name, COUNT(DISTINCT case when ss.ss_coupon_amt > 0 THEN ss.ss_ticket_number END) AS transactions_with_coupons FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN date_dim ON ss.ss_sold_date_sk = date_dim.d_date_sk WHERE date_dim.d_year IN (2019, 2020) AND ib.ib_lower_bound >= 0 AND ib.ib_upper_bound <= 130000 GROUP BY i.i_category, i.i_class, i.i_brand, ib.ib_lower_bound, ib.ib_upper_bound, date_dim.d_year, date_dim.d_quarter_name ORDER BY total_net_profit DESC, total_quantity_sold DESC LIMIT 100;
SELECT cp_department, COUNT(DISTINCT cr_order_number) AS total_returns, SUM(cr_return_quantity) AS total_returned_quantity, AVG(cr_return_amount) AS average_return_amount, SUM(sr_return_amt) AS total_store_return_amount, SUM(ws_net_paid) AS total_web_sales_net_paid, SUM(ws_net_profit) AS total_web_sales_net_profit FROM catalog_page LEFT JOIN catalog_returns ON cp_catalog_page_sk = cr_catalog_page_sk LEFT JOIN store_returns ON cp_catalog_page_sk = sr_item_sk LEFT JOIN web_sales ON cp_catalog_page_sk = ws_item_sk WHERE cr_ship_mode_sk = '20' AND sr_item_sk = '2215' AND sr_fee IN ('40.75', '93.21', '51.60', '38.20', '4.86') GROUP BY cp_department ORDER BY total_returns DESC, total_returned_quantity DESC, average_return_amount DESC, total_store_return_amount DESC, total_web_sales_net_paid DESC, total_web_sales_net_profit DESC;
SELECT s.s_state, cd.cd_gender, COUNT(DISTINCT s.s_store_sk) AS total_stores, AVG(s.s_floor_space) AS avg_floor_space, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_ext_discount_amt) AS avg_discount_amount FROM store_sales ss JOIN customer_demographics cd ON cd.cd_demo_sk = ss.ss_cdemo_sk JOIN store s ON s.s_store_sk = ss.ss_store_sk WHERE ss.ss_ext_sales_price > 0 AND cd.cd_gender IN ('M', 'F') AND s.s_state IS NOT NULL GROUP BY s.s_state, cd.cd_gender ORDER BY s.s_state, cd.cd_gender, total_sales DESC;
SELECT dd.d_year, dd.d_quarter_name, wa.w_country, ca.ca_state, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, AVG(cd.cd_purchase_estimate) AS avg_customer_purchase_estimate, SUM(CASE WHEN pr.p_channel_email = '1' THEN ws.ws_quantity ELSE 0 END) as total_quantity_sold_via_email, SUM(CASE WHEN pr.p_channel_tv = '1' THEN ws.ws_quantity ELSE 0 END) as total_quantity_sold_via_tv FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON ws.ws_bill_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN warehouse wa ON ws.ws_warehouse_sk = wa.w_warehouse_sk JOIN promotion pr ON ws.ws_promo_sk = pr.p_promo_sk WHERE dd.d_quarter_seq IN (25, 41) AND wa.w_country = 'United States' AND wa.w_street_name IN ('Ash Laurel', '6th', 'Wilson Elm', 'View First') AND cd.cd_purchase_estimate BETWEEN 1000 AND 5500 GROUP BY ROLLUP(dd.d_year, dd.d_quarter_name, wa.w_country, ca.ca_state) ORDER BY dd.d_year, dd.d_quarter_name, wa.w_country, ca.ca_state;
SELECT r.r_reason_id, r.r_reason_desc, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_quantity) AS avg_returned_quantity, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_tax) AS total_return_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_net_loss) AS total_net_loss, sm.sm_type AS shipping_type, sm.sm_carrier AS carrier, w.w_warehouse_name AS warehouse_name, s.s_store_name AS store_name FROM catalog_returns cr JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN time_dim t ON cr.cr_returned_time_sk = t.t_time_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN store s ON cr.cr_returning_addr_sk = s.s_store_sk WHERE t.t_sub_shift = 'night' AND t.t_shift = 'third' AND w.w_warehouse_sq_ft > 900000 AND r.r_reason_id IN ('AAAAAAAAIAAAAAAA', 'AAAAAAAAIBAAAAAA', 'AAAAAAAAGAAAAAAA', 'AAAAAAAAACAAAAAA', 'AAAAAAAAPBAAAAAA', 'AAAAAAAAOBAAAAAA') GROUP BY r.r_reason_id, r.r_reason_desc, sm.sm_type, sm.sm_carrier, w.w_warehouse_name, s.s_store_name ORDER BY total_return_amount DESC, total_returns DESC;
SELECT cp_department, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_profit) AS total_net_profit, COUNT(DISTINCT ss_ticket_number) AS total_store_sales_tickets, SUM(ss_quantity) AS total_store_quantity_sold, AVG(ss_sales_price) AS average_store_sales_price, SUM(ss_net_paid_inc_tax) AS total_store_net_paid_inc_tax FROM catalog_sales JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk JOIN store_sales ON catalog_sales.cs_item_sk = store_sales.ss_item_sk JOIN store ON store_sales.ss_store_sk = s_store_sk JOIN customer ON store_sales.ss_customer_sk = c_customer_sk WHERE c_birth_country IN ('MOLDOVA, REPUBLIC OF', 'TOGO', 'IRAQ', 'BURUNDI') AND cp_department IS NOT NULL AND cp_start_date_sk IS NOT NULL AND cp_end_date_sk IS NOT NULL AND (cp_end_date_sk - cp_start_date_sk) > 0 AND s_market_id IS NOT NULL GROUP BY cp_department ORDER BY total_net_profit DESC, total_orders DESC LIMIT 10;
SELECT s.s_store_name, s.s_city, s.s_state, td.t_shift, COUNT(*) AS total_returns, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(CASE WHEN sr.sr_return_amt_inc_tax > 100 THEN 1 ELSE 0 END) AS returns_over_100, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN time_dim td ON sr.sr_return_time_sk = td.t_time_sk JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN web_page wp ON sr.sr_store_sk = wp.wp_customer_sk JOIN web_returns wr ON sr.sr_item_sk = wr.wr_item_sk AND sr.sr_ticket_number = wr.wr_order_number WHERE td.t_shift = 'third' AND s.s_gmt_offset = '-5.00' AND ca.ca_address_id IN ('AAAAAAAAGGKAAAAA', 'AAAAAAAANCEAAAAA', 'AAAAAAAAOKGAAAAA') AND (wr.wr_return_amt_inc_tax = '6344.70' OR wr.wr_return_amt_inc_tax = '72.90' OR wr.wr_return_amt_inc_tax = '705.96') GROUP BY s.s_store_name, s.s_city, s.s_state, td.t_shift ORDER BY total_returns DESC, avg_return_amount_inc_tax DESC LIMIT 100;
SELECT i_category, r_reason_desc, EXTRACT(YEAR FROM d_date) AS return_year, EXTRACT(MONTH FROM d_date) AS return_month, COUNT(DISTINCT cr_order_number) AS total_returns, SUM(cr_return_quantity) AS total_returned_quantity, AVG(cr_return_amount) AS average_return_amount, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN date_dim dd ON cr.cr_returned_date_sk = dd.d_date_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk WHERE dd.d_current_week = 'N' AND r.r_reason_desc IN ('reason 26', 'Did not get it on time', 'Did not like the make', 'reason 23', 'reason 24') GROUP BY i_category, r_reason_desc, return_year, return_month ORDER BY i_category, return_year, return_month, r_reason_desc;
SELECT d_year, i_category, i_class, SUM(ws_sales_price) AS total_sales, AVG(ws_sales_price) AS avg_sales_price, COUNT(DISTINCT ws_order_number) AS num_orders, SUM(sr_return_amt) AS total_returns, AVG(sr_return_amt) AS avg_return_amt, COUNT(DISTINCT sr_ticket_number) AS num_returns, SUM(ws_net_profit) - SUM(sr_net_loss) AS net_profit FROM web_sales JOIN item ON ws_item_sk = i_item_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk LEFT JOIN store_returns ON sr_item_sk = ws_item_sk AND sr_returned_date_sk = ws_sold_date_sk WHERE d_year = 2002 AND (i_category = 'Electronics' OR i_category = 'Books') AND ws_sales_price > 0 GROUP BY d_year, i_category, i_class ORDER BY d_year, i_category, i_class;
SELECT w_warehouse_name, cd_credit_rating, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_quantity) AS total_return_quantity, COUNT(DISTINCT cr_order_number) AS total_orders_returned, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns INNER JOIN warehouse ON catalog_returns.cr_warehouse_sk = warehouse.w_warehouse_sk INNER JOIN customer_demographics ON catalog_returns.cr_refunded_cdemo_sk = customer_demographics.cd_demo_sk INNER JOIN household_demographics ON catalog_returns.cr_refunded_hdemo_sk = household_demographics.hd_demo_sk WHERE cr_returned_date_sk IN (2451154, 2451037, 2450875, 2450957, 2450981) AND household_demographics.hd_income_band_sk IN ('12', '7', '9', '5', '16', '3') AND household_demographics.hd_vehicle_count = 3 AND customer_demographics.cd_dep_employed_count = 0 AND catalog_returns.cr_store_credit IN (950.05, 59.82, 39.71) GROUP BY w_warehouse_name, cd_credit_rating ORDER BY total_net_loss DESC, avg_return_amount DESC;
