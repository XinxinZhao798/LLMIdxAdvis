SELECT ca.ca_state, cd.cd_gender, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount, AVG(s.s_tax_precentage) AS avg_tax_percentage, COUNT(wr.wr_returned_date_sk) AS total_returns FROM web_returns wr JOIN customer c ON wr.wr_returning_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN store s ON ca.ca_state = s.s_state JOIN date_dim dd ON wr.wr_returned_date_sk = dd.d_date_sk WHERE dd.d_quarter_seq = ( SELECT MAX(d_quarter_seq) - 1 FROM date_dim WHERE d_current_year = 'N' ) AND cd.cd_gender IN ('M', 'F') AND ca.ca_state IS NOT NULL GROUP BY ca.ca_state, cd.cd_gender ORDER BY ca.ca_state, cd.cd_gender;
SELECT w_state, p_promo_id, p_discount_active, COUNT(DISTINCT cr_order_number) AS total_returns, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_quantity) AS total_returned_quantity, COUNT(DISTINCT sr_ticket_number) AS total_store_returns, SUM(sr_return_amt) AS total_store_return_amount, AVG(sr_return_amt) AS avg_store_return_amount, SUM(sr_return_quantity) AS total_store_returned_quantity FROM catalog_returns JOIN warehouse ON cr_warehouse_sk = w_warehouse_sk JOIN promotion ON cr_catalog_page_sk = p_promo_sk JOIN store_returns ON cr_item_sk = sr_item_sk AND cr_order_number = sr_ticket_number WHERE w_state = 'TN' AND p_promo_id = 'AAAAAAAAMKAAAAAA' AND p_discount_active = 'N' GROUP BY w_state, p_promo_id, p_discount_active ORDER BY total_return_amount DESC;
SELECT dd.d_year AS year, dd.d_month_seq AS month, p.p_channel_dmail AS channel_direct_mail, p.p_channel_email AS channel_email, p.p_channel_catalog AS channel_catalog, p.p_channel_tv AS channel_tv, p.p_channel_radio AS channel_radio, p.p_channel_press AS channel_press, p.p_channel_event AS channel_event, p.p_channel_demo AS channel_demo, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_ext_sales_price) AS total_sales_revenue, SUM(ss.ss_ext_discount_amt) AS total_discount_amount, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_profit) AS total_net_profit FROM promotion p JOIN store_sales ss ON p.p_promo_sk = ss.ss_promo_sk JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk WHERE p.p_cost > 1000.00 AND ss.ss_sales_price > 50.00 GROUP BY dd.d_year, dd.d_month_seq, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo ORDER BY dd.d_year DESC, dd.d_month_seq, total_sales_revenue DESC;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_ext_discount_amt) AS average_discount, COUNT(cs.cs_order_number) AS number_of_orders, SUM(inv.inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT p.p_promo_id) AS number_of_promotions_used FROM call_center cc LEFT JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk LEFT JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk LEFT JOIN inventory inv ON cs.cs_item_sk = inv.inv_item_sk AND cc.cc_division = inv.inv_warehouse_sk WHERE cs.cs_sold_date_sk IN ('2450823', '2450816', '2450827', '2450829', '2450820') AND cs.cs_promo_sk IN ('130', '96', '160', '128') GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_sales DESC;
SELECT ca.ca_state, EXTRACT(YEAR FROM TO_DATE(c.c_first_shipto_date_sk::text, 'YYYYMMDD')) AS first_shipto_year, p.p_channel_details, COUNT(DISTINCT c.c_customer_sk) AS num_customers, AVG(ws.ws_net_profit) AS avg_web_net_profit, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, COUNT(DISTINCT ws.ws_order_number) AS num_web_orders, COUNT(DISTINCT sr.sr_ticket_number) AS num_returns FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk AND sr.sr_addr_sk = 23889 JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk WHERE c.c_birth_month IN (10, 6, 9, 7, 5) AND p.p_channel_catalog = 'N' AND ws.ws_list_price = 218.80 AND p.p_promo_id IN ('AAAAAAAAPLAAAAAA', 'AAAAAAAAOMAAAAAA', 'AAAAAAAACAAAAAAA') GROUP BY ca.ca_state, first_shipto_year, p.p_channel_details ORDER BY ca.ca_state, first_shipto_year, p.p_channel_details;
SELECT cp.cp_department, cp.cp_catalog_number, sm.sm_carrier, COUNT(*) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt_inc_tax) AS average_return_amount_inc_tax, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN catalog_page cp ON sr.sr_item_sk = cp.cp_catalog_page_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = sr.sr_item_sk WHERE cp.cp_catalog_page_number IN (20, 88, 103, 108, 56, 9) AND cp.cp_catalog_page_id IN ('AAAAAAAAMECBAAAA', 'AAAAAAAAPENAAAAA', 'AAAAAAAAHKMAAAAA', 'AAAAAAAADBGAAAAA', 'AAAAAAAADEPAAAAA', 'AAAAAAAALIDAAAAA') AND sm.sm_ship_mode_id IN ('AAAAAAAAABAAAAAA', 'AAAAAAAACBAAAAAA', 'AAAAAAAAJAAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAAEBAAAAAA') AND sm.sm_carrier IN ('TBS', 'DIAMOND', 'AIRBORNE', 'GREAT EASTERN', 'LATVIAN') GROUP BY cp.cp_department, cp.cp_catalog_number, sm.sm_carrier;
SELECT r.r_reason_desc, COUNT(*) AS total_returns, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_amt) AS average_return_amount, SUM(sr_return_quantity) AS total_returned_quantity, SUM(sr_fee) AS total_return_fees, SUM(sr_net_loss) AS total_net_loss FROM store_returns sr JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE sr.sr_return_amt > 0 AND r.r_reason_desc IN ('reason 26', 'reason 34', 'Did not fit', 'Not the product that was ordred') GROUP BY r.r_reason_desc ORDER BY total_return_amount DESC;
SELECT ca.ca_state AS state, i.d_year AS fiscal_year, COUNT(DISTINCT ss.ss_store_sk) AS num_stores, COUNT(DISTINCT ss.ss_item_sk) AS num_products_sold, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_sales, COUNT(DISTINCT sr.sr_store_sk) AS num_stores_with_returns, COUNT(DISTINCT sr.sr_item_sk) AS num_returned_products, SUM(sr.sr_return_quantity) AS total_quantity_returned, SUM(sr.sr_return_amt) AS total_returns, COUNT(DISTINCT cr.cr_call_center_sk) AS num_call_centers_with_returns, COUNT(DISTINCT cr.cr_item_sk) AS num_catalog_returned_products, SUM(cr.cr_return_quantity) AS total_catalog_quantity_returned, SUM(cr.cr_return_amount) AS total_catalog_returns FROM store_sales ss JOIN date_dim i ON ss.ss_sold_date_sk = i.d_date_sk JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number LEFT JOIN catalog_returns cr ON cr.cr_order_number = ss.ss_ticket_number WHERE i.d_fy_year = 2001 GROUP BY ca.ca_state, i.d_year ORDER BY ca.ca_state, i.d_year;
