SELECT c.c_first_name, c.c_last_name, cs_total_sales, ws_total_sales, (cs_total_net_sales + ws_total_net_sales) AS total_combined_net_sales FROM customer c JOIN (SELECT cs_bill_customer_sk, SUM(cs_net_paid) AS cs_total_sales FROM catalog_sales GROUP BY cs_bill_customer_sk) cs_sales ON c.c_customer_sk = cs_sales.cs_bill_customer_sk JOIN (SELECT ws_bill_customer_sk, SUM(ws_net_paid) AS ws_total_sales FROM web_sales GROUP BY ws_bill_customer_sk) ws_sales ON c.c_customer_sk = ws_sales.ws_bill_customer_sk JOIN (SELECT cs_bill_customer_sk, SUM(cs_net_paid_inc_ship_tax) AS cs_total_net_sales FROM catalog_sales GROUP BY cs_bill_customer_sk) total_cs_sales ON c.c_customer_sk = total_cs_sales.cs_bill_customer_sk JOIN (SELECT ws_bill_customer_sk, SUM(ws_net_paid_inc_ship_tax) AS ws_total_net_sales FROM web_sales GROUP BY ws_bill_customer_sk) total_ws_sales ON c.c_customer_sk = total_ws_sales.ws_bill_customer_sk WHERE c.c_birth_country IN ('BRAZIL', 'ROMANIA', 'ICELAND') AND EXISTS (SELECT 1 FROM call_center WHERE cc_call_center_sk = cs_sales.cs_bill_customer_sk AND cc_company_name LIKE 'pri%') AND EXISTS (SELECT 1 FROM web_site WHERE web_site_sk = ws_sales.ws_bill_customer_sk AND web_street_type IN ('Road', 'Way', 'Dr.', 'Cir.', 'Parkway') AND web_street_number IN ('292', '409', '887', '805')) ORDER BY total_combined_net_sales DESC LIMIT 100;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, hd.hd_buy_potential, hd.hd_dep_count, hd.hd_vehicle_count, r.r_reason_desc, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_return_amount) AS total_return_amount FROM catalog_returns cr JOIN customer_demographics cd ON cr.cr_returning_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN store s ON cr.cr_warehouse_sk = s.s_store_sk WHERE hd.hd_buy_potential IN ('5001-10000', '1001-5000', '>10000', '0-500', '501-1000') AND s.s_number_employees IN ('297', '294', '236', '245', '278') GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, hd.hd_buy_potential, hd.hd_dep_count, hd.hd_vehicle_count, r.r_reason_desc ORDER BY total_return_amount DESC, total_returned_quantity DESC, cd.cd_credit_rating, hd.hd_buy_potential;
SELECT d_year, i_brand, i_class, i_category, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, SUM(cs_net_paid) AS total_revenue, AVG(cs_net_paid_inc_tax) AS avg_revenue_inc_tax, AVG(cs_net_paid_inc_ship_tax) AS avg_revenue_inc_ship_tax, SUM(cs_net_profit) AS total_profit, COUNT(DISTINCT cs_item_sk) AS distinct_items_sold, MAX(cs_sales_price) AS max_sales_price, MIN(cs_sales_price) AS min_sales_price FROM catalog_sales JOIN date_dim ON (cs_sold_date_sk = d_date_sk) JOIN item ON (cs_item_sk = i_item_sk) JOIN time_dim ON (cs_sold_time_sk = t_time_sk) WHERE d_year = 2000 AND t_hour BETWEEN 0 AND 1 AND t_sub_shift = 'night' AND i_rec_end_date >= '1999-10-27' AND i_rec_end_date <= '2001-10-26' AND cs_sold_date_sk IN ('2450821', '2450823') GROUP BY d_year, i_brand, i_class, i_category ORDER BY total_revenue DESC;
SELECT w.web_name, cp.cp_department, sm.sm_type, COUNT(distinct i.i_item_sk) as total_items, SUM(i.i_current_price) as total_sales, AVG(i.i_wholesale_cost) as avg_wholesale_cost, COUNT(distinct w.web_site_sk) as total_websites FROM web_site w JOIN catalog_page cp ON w.web_site_sk = cp.cp_catalog_number JOIN item i ON cp.cp_department = i.i_category JOIN ship_mode sm ON sm.sm_carrier = i.i_manufact WHERE i.i_category = 'Music' AND w.web_city IN ('Fairview', 'Midway') AND sm.sm_ship_mode_id IN ('AAAAAAAAIAAAAAAA', 'AAAAAAAALAAAAAAA') AND i.i_item_id IN ('AAAAAAAAJCCAAAAA', 'AAAAAAAANGMAAAAA', 'AAAAAAAAICDAAAAA', 'AAAAAAAAHLABAAAA', 'AAAAAAAAIIEAAAAA', 'AAAAAAAALAOAAAAA') AND w.web_name IN ('site_3', 'site_4', 'site_1', 'site_0', 'site_2') GROUP BY w.web_name, cp.cp_department, sm.sm_type ORDER BY total_sales DESC;
SELECT ws.web_name, ws.web_class, ws.web_manager, ws.web_market_manager, COUNT(DISTINCT wp.wp_web_page_sk) AS total_pages, AVG(wp.wp_char_count) AS avg_char_count, SUM(wp.wp_link_count) AS total_link_count, SUM(wp.wp_image_count) AS total_image_count, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_fee) AS avg_return_fee, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS preferred_customer_count FROM web_site ws LEFT JOIN web_page wp ON ws.web_site_sk = wp.wp_customer_sk LEFT JOIN web_returns wr ON wp.wp_web_page_sk = wr.wr_web_page_sk LEFT JOIN customer c ON wr.wr_returning_customer_sk = c.c_customer_sk GROUP BY ws.web_name, ws.web_class, ws.web_manager, ws.web_market_manager ORDER BY total_return_amount DESC, total_pages DESC LIMIT 100;
SELECT dd.d_year, dd.d_quarter_name, i.i_category, sum(ss.ss_quantity) as total_quantity_sold, avg(ss.ss_sales_price) as avg_sales_price, sum(ss.ss_net_paid) as total_net_sales, sum(ss.ss_net_profit) as total_net_profit, count(distinct ss.ss_ticket_number) as total_sales_transactions, sum(wr.wr_return_quantity) as total_quantity_returned, sum(wr.wr_net_loss) as total_net_loss, count(distinct wr.wr_order_number) as total_return_transactions FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk LEFT JOIN web_returns wr ON ss.ss_item_sk = wr.wr_item_sk AND ss.ss_sold_date_sk = wr.wr_returned_date_sk GROUP BY dd.d_year, dd.d_quarter_name, i.i_category ORDER BY dd.d_year, dd.d_quarter_name, i.i_category;
SELECT w_state, i_manufact_id, i_manufact, SUM(sr_return_amt + wr_return_amt) AS total_return_amount, AVG(sr_return_amt + wr_return_amt) AS avg_return_amount, COUNT(DISTINCT sr_ticket_number) AS count_store_returns, COUNT(DISTINCT wr_order_number) AS count_web_returns, SUM(CASE WHEN p_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS promo_related_returns FROM warehouse w LEFT JOIN store_returns sr ON w.w_warehouse_sk = sr.sr_addr_sk LEFT JOIN web_returns wr ON w.w_warehouse_sk = wr.wr_refunded_addr_sk LEFT JOIN item i ON i.i_item_sk = sr.sr_item_sk OR i.i_item_sk = wr.wr_item_sk LEFT JOIN promotion p ON p.p_item_sk = i.i_item_sk AND (sr.sr_returned_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk OR wr.wr_returned_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk) WHERE w_state = 'TN' AND i_manufact_id IN (70, 177, 479) GROUP BY w_state, i_manufact_id, i_manufact HAVING SUM(sr_return_amt + wr_return_amt) > 0 ORDER BY total_return_amount DESC;
SELECT cp.cp_department, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_incl_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_net_loss) AS total_net_loss, SUM(p.p_cost) AS total_promotion_cost, COUNT(DISTINCT p.p_promo_sk) AS total_promotions_applied FROM catalog_page cp JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk LEFT JOIN promotion p ON cp.cp_catalog_page_sk = p.p_item_sk WHERE cp.cp_catalog_page_number IN (63, 55, 67, 26) GROUP BY cp.cp_department ORDER BY total_net_loss DESC;
SELECT p.p_promo_name, p.p_purpose, COUNT(DISTINCT ss.ss_ticket_number) AS num_sales, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sale_price, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(DISTINCT sr.sr_ticket_number) AS num_returns, SUM(sr.sr_return_quantity) AS total_quantity_returned, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(sr.sr_net_loss) AS total_net_loss, (SUM(ss.ss_net_profit) - SUM(sr.sr_net_loss)) AS net_effect_of_promotions FROM promotion p LEFT JOIN store_sales ss ON p.p_promo_sk = ss.ss_promo_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number WHERE p.p_cost::decimal > 500.00 AND p.p_purpose <> 'Unknown' AND ss.ss_sold_date_sk IS NOT NULL AND sr.sr_returned_date_sk IS NOT NULL GROUP BY p.p_promo_name, p.p_purpose ORDER BY net_effect_of_promotions DESC;
SELECT p.p_promo_id, p.p_promo_name, COUNT(DISTINCT cs.cs_item_sk) AS number_of_items_sold, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_selling_price, SUM(cs.cs_ext_sales_price) AS total_sales_amount, SUM(cs.cs_ext_discount_amt) AS total_discount_amount, AVG((cs.cs_ext_discount_amt / cs.cs_ext_list_price) * 100) AS average_discount_percentage, SUM(cs.cs_net_profit) AS total_net_profit, AVG(inv.inv_quantity_on_hand) AS average_inventory_quantity_on_hand FROM catalog_sales cs JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk LEFT JOIN inventory inv ON cs.cs_item_sk = inv.inv_item_sk AND cs.cs_sold_date_sk = inv.inv_date_sk WHERE cs.cs_ext_list_price IN (8856.28, 4863.95, 651.00, 4727.68) GROUP BY p.p_promo_id, p.p_promo_name ORDER BY total_sales_amount DESC;
SELECT ca.ca_state AS customer_state, r.r_reason_desc AS return_reason, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_amt) AS total_return_amt, SUM(sr.sr_return_tax) AS total_return_tax, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk GROUP BY ca.ca_state, r.r_reason_desc ORDER BY ca.ca_state, r.r_reason_desc;
SELECT hd.hd_income_band_sk, cd.cd_education_status, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_ext_discount_amt) AS total_discount_amt, COUNT(ss.ss_ticket_number) AS sales_count FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk WHERE d.d_year = 2022 AND d.d_weekend = 'Y' AND d.d_holiday = 'N' GROUP BY hd.hd_income_band_sk, cd.cd_education_status ORDER BY hd.hd_income_band_sk, cd.cd_education_status;
SELECT cc.cc_city, i.i_category, COUNT(DISTINCT cc.cc_call_center_sk) AS total_call_centers, SUM(cc.cc_employees) AS total_employees, AVG(cc.cc_sq_ft) AS avg_square_footage, COUNT(DISTINCT i.i_item_sk) AS total_items, AVG(i.i_current_price) AS avg_item_price, MIN(ib.ib_lower_bound) AS min_income_band_lower_bound, MAX(ib.ib_upper_bound) AS max_income_band_upper_bound, AVG(cc.cc_tax_percentage) AS avg_tax_percentage FROM call_center cc JOIN item i ON cc.cc_division = i.i_manufact_id JOIN income_band ib ON ib.ib_income_band_sk = cc.cc_mkt_id WHERE cc.cc_street_type IN ('Boulevard', 'RD', 'Way') AND i.i_units IN ('Dram', 'Ounce', 'Gram') AND ib.ib_income_band_sk IN (3, 5, 7, 8) AND cc.cc_tax_percentage BETWEEN 0.01 AND 0.12 GROUP BY cc.cc_city, i.i_category ORDER BY total_call_centers DESC, avg_item_price ASC LIMIT 10;
SELECT p.p_promo_name AS promotion_name, ib.ib_lower_bound AS income_band_lower_bound, ib.ib_upper_bound AS income_band_upper_bound, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_ext_sales_price) AS total_sales, SUM(ss.ss_ext_discount_amt) AS total_discount_amount, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_customer_sk) AS distinct_customers, SUM(CASE WHEN ss.ss_sales_price < ss.ss_list_price THEN 1 ELSE 0 END) AS count_discounted_sales FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN income_band ib ON ss.ss_cdemo_sk = ib.ib_income_band_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE p.p_discount_active = 'N' AND d.d_year IN (1901, 1903, 1906, 1908) AND ss.ss_ext_sales_price IN (2209.06, 2248.08) AND ib.ib_lower_bound IN (0, 90001, 170001, 120001, 50001) AND ib.ib_upper_bound = 160000 GROUP BY p.p_promo_name, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_sales DESC, promotion_name, income_band_lower_bound, income_band_upper_bound;
SELECT s.s_store_name, i.i_brand, i.i_category, dd.d_year, SUM(s.s_number_employees) AS total_number_employees, AVG(i.i_current_price) AS average_price, COUNT(DISTINCT h.hd_demo_sk) AS unique_household_count, SUM(CASE WHEN dd.d_holiday = 'Y' THEN 1 ELSE 0 END) AS holiday_count, SUM(CASE WHEN dd.d_weekend = 'Y' THEN 1 ELSE 0 END) AS weekend_count FROM store s JOIN item i ON s.s_store_sk = i.i_manufact_id JOIN date_dim dd ON s.s_closed_date_sk = dd.d_date_sk JOIN household_demographics h ON h.hd_income_band_sk = s.s_market_id JOIN time_dim t ON t.t_time_sk = dd.d_date_sk WHERE s.s_store_sk IN (11, 9, 5, 3) AND i.i_item_id IN ('AAAAAAAAGPIAAAAA', 'AAAAAAAAOFKAAAAA', 'AAAAAAAAKJEAAAAA', 'AAAAAAAAMLJAAAAA', 'AAAAAAAANPCBAAAA', 'AAAAAAAAEBGAAAAA') AND i.i_brand_id IN (6004005, 7004007) AND dd.d_current_year = 'N' AND dd.d_last_dom IN (2418367, 2415812, 2418122) AND t.t_hour IN (1, 0) GROUP BY s.s_store_name, i.i_brand, i.i_category, dd.d_year;
SELECT ca.ca_state AS customer_state, COUNT(DISTINCT ss.ss_ticket_number) AS total_transactions, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_ext_discount_amt) AS avg_discount_amount, SUM(CASE WHEN p.p_channel_email = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_email_promo, SUM(CASE WHEN p.p_channel_dmail = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_dmail_promo, SUM(CASE WHEN p.p_channel_catalog = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_catalog_promo, SUM(CASE WHEN p.p_channel_tv = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_tv_promo, SUM(CASE WHEN p.p_channel_radio = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_radio_promo, SUM(CASE WHEN p.p_channel_press = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_press_promo, SUM(CASE WHEN p.p_channel_event = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_event_promo, SUM(CASE WHEN p.p_channel_demo = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_demo_promo FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ca.ca_state IS NOT NULL AND ss.ss_net_paid > 0 AND (p.p_channel_email = 'Y' OR p.p_channel_dmail = 'Y' OR p.p_channel_catalog = 'Y' OR p.p_channel_tv = 'Y' OR p.p_channel_radio = 'Y' OR p.p_channel_press = 'Y' OR p.p_channel_event = 'Y' OR p.p_channel_demo = 'Y') GROUP BY ca.ca_state ORDER BY total_sales DESC;
