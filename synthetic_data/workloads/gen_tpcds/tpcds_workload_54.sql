SELECT cp.cp_department, SUM(ws.ws_net_profit) AS total_web_sales_profit, AVG(ws.ws_quantity) AS avg_web_sales_quantity, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(cr.cr_net_loss) AS total_catalog_returns_loss, AVG(cr.cr_return_quantity) AS avg_catalog_return_quantity, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_returns, SUM(sr.sr_net_loss) AS total_store_returns_loss, AVG(sr.sr_return_quantity) AS avg_store_return_quantity, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, SUM(CASE WHEN p.p_channel_dmail = 'Y' THEN p.p_cost ELSE 0 END) AS total_promo_cost_via_dmail, COUNT(CASE WHEN p.p_channel_demo = 'N' AND p.p_channel_catalog = 'N' THEN p.p_promo_sk END) AS count_non_demo_catalog_promos FROM catalog_page cp LEFT JOIN web_sales ws ON cp.cp_catalog_page_sk = ws.ws_web_page_sk LEFT JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk LEFT JOIN store_returns sr ON sr.sr_item_sk = ws.ws_item_sk LEFT JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk WHERE cp.cp_start_date_sk IS NOT NULL AND cp.cp_end_date_sk IS NOT NULL AND ws.ws_sold_date_sk BETWEEN cp.cp_start_date_sk AND cp.cp_end_date_sk GROUP BY cp.cp_department ORDER BY total_web_sales_profit DESC, total_catalog_returns_loss ASC, total_store_returns_loss ASC;
SELECT w.w_warehouse_name, cp.cp_department, cd.cd_education_status, hd.hd_buy_potential, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(*) AS number_of_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_quantity) AS average_return_quantity, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_return_ship_cost) AS total_ship_cost, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN customer_demographics cd ON cr.cr_refunded_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON cr.cr_refunded_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE cr.cr_returned_date_sk BETWEEN 2450810 AND 2450820 AND cp.cp_catalog_number BETWEEN 100 AND 200 AND cr.cr_order_number IN (5410, 3479, 2, 4547, 2428, 2527) AND w.w_suite_number IN ('Suite 80', 'Suite 0', 'Suite P', 'Suite 470') AND cr.cr_refunded_hdemo_sk IN (5152, 662, 6967) AND cd.cd_credit_rating = 'Excellent' GROUP BY w.w_warehouse_name, cp.cp_department, cd.cd_education_status, hd.hd_buy_potential, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_return_amount DESC, w.w_warehouse_name, cp.cp_department;
SELECT dd.d_year, dd.d_quarter_name, COUNT(DISTINCT c.c_customer_sk) AS total_customers, COUNT(DISTINCT sr.sr_store_sk) AS total_stores_with_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_fee) AS total_fees_collected, SUM(sr.sr_net_loss) AS total_net_loss FROM date_dim dd JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk WHERE dd.d_year IN (1909, 1903, 1901, 1907, 1911, 1900) AND dd.d_quarter_seq = 53 AND NOT EXISTS (SELECT 1 FROM promotion WHERE p_channel_tv = 'N' AND p_promo_sk = sr.sr_item_sk) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT SUM(ss.ss_net_profit) AS total_net_profit, AVG(ss.ss_quantity) AS average_quantity_sold, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, COUNT(DISTINCT sr.sr_reason_sk) AS number_of_return_reasons, SUM(sr.sr_return_amt_inc_tax) AS total_returns_with_tax, AVG(p.p_cost) AS average_promotion_cost, COUNT(DISTINCT w.w_warehouse_sk) AS number_of_warehouses_used, AVG(w.w_gmt_offset) AS average_warehouse_gmt_offset, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS preferred_customer_count FROM store_sales ss LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk AND p.p_discount_active = 'N' LEFT JOIN warehouse w ON w.w_suite_number IN ('Suite 80', 'Suite 0', 'Suite P', 'Suite 470') LEFT JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk WHERE (ss.ss_sold_date_sk BETWEEN 20180101 AND 20181231 OR ss.ss_sold_date_sk IS NULL) AND (sr.sr_returned_date_sk BETWEEN 20180101 AND 20181231 OR sr.sr_returned_date_sk IS NULL) AND (c.c_customer_sk IN ('824', '4397', '807', '476') OR c.c_customer_sk IS NULL) AND (sr.sr_reason_sk IN (SELECT r_reason_sk FROM reason WHERE r_reason_desc IN ('duplicate purchase', 'reason 34', 'Found a better price in a store', 'Gift exchange', 'Parts missing', 'Lost my job')) OR sr.sr_reason_sk IS NULL) GROUP BY w.w_city, c.c_birth_year;
SELECT cc.cc_state, AVG(cd.hd_dep_count) AS avg_dependent_count, AVG(cd.hd_vehicle_count) AS avg_vehicle_count, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_sales_price) AS total_sales, AVG(cs.cs_sales_price) AS average_sales_price, AVG(cs.cs_ext_discount_amt) AS average_discount_amount, COUNT(DISTINCT cs.cs_order_number) AS total_transactions FROM catalog_sales cs JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk LEFT JOIN household_demographics cd ON cs.cs_ship_hdemo_sk = cd.hd_demo_sk WHERE cs.cs_sold_date_sk IS NOT NULL AND cc.cc_state IS NOT NULL GROUP BY cc.cc_state ORDER BY total_sales DESC LIMIT 5;
SELECT hd.hd_demo_sk, COUNT(DISTINCT ws.ws_order_number) AS total_orders, AVG(ws.ws_quantity) AS average_quantity, SUM(ws.ws_net_paid) AS total_net_paid, AVG(ws.ws_net_profit) AS average_net_profit, COUNT(DISTINCT CASE WHEN p.p_channel_press = 'N' THEN ws.ws_order_number END) AS non_press_promo_orders FROM household_demographics hd JOIN web_sales ws ON hd.hd_demo_sk = ws.ws_bill_hdemo_sk JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk JOIN time_dim t ON ws.ws_sold_time_sk = t.t_time_sk WHERE hd.hd_income_band_sk IS NOT NULL AND p.p_promo_name IS NOT NULL AND t.t_am_pm IS NOT NULL AND ws.ws_net_paid > 0 AND ws.ws_sales_price BETWEEN 1000 AND 4000 GROUP BY hd.hd_demo_sk HAVING COUNT(DISTINCT ws.ws_order_number) > 5 ORDER BY total_net_paid DESC, total_orders DESC LIMIT 10;
SELECT ss_item_sk, ss_store_sk, AVG(ss_sales_price) AS avg_sales_price, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_net_paid, SUM(ss_net_profit) AS total_net_profit, AVG(ss_ext_discount_amt) AS avg_discount_amount, COUNT(DISTINCT ss_customer_sk) AS unique_customer_count FROM store_sales GROUP BY ss_item_sk, ss_store_sk ORDER BY total_net_profit DESC;
SELECT c.cp_department, i.i_category, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_fee) AS total_fees_collected, SUM(cr.cr_net_loss) AS total_net_loss, w.w_state, hd.hd_buy_potential FROM catalog_returns cr JOIN catalog_page c ON cr.cr_catalog_page_sk = c.cp_catalog_page_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk WHERE cr.cr_returning_addr_sk IN ('31623', '47914', '49311', '38890', '49597') AND w.w_state = 'TN' AND hd.hd_buy_potential IN ('501-1000', '5001-10000') GROUP BY c.cp_department, i.i_category, w.w_state, hd.hd_buy_potential ORDER BY total_return_amount DESC, c.cp_department, i.i_category;
SELECT ib_lower_bound, ib_upper_bound, COUNT(DISTINCT ws_bill_customer_sk) AS num_customers, SUM(ws_net_paid) AS total_sales, AVG(ws_quantity) AS avg_quantity_sold, SUM(cr_return_amount) AS total_returns, COUNT(DISTINCT cr_order_number) AS num_returned_orders FROM web_sales JOIN household_demographics ON ws_bill_hdemo_sk = hd_demo_sk JOIN income_band ON hd_income_band_sk = ib_income_band_sk LEFT JOIN catalog_returns ON ws_item_sk = cr_item_sk AND ws_order_number = cr_order_number GROUP BY ib_lower_bound, ib_upper_bound ORDER BY ib_lower_bound;
SELECT sm.sm_type, sm.sm_code, COUNT(wr.wr_order_number) AS total_returns, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_return_quantity) AS total_returned_quantity, SUM(wr.wr_return_ship_cost) AS total_return_shipping_cost, AVG(hd.hd_dep_count) AS average_dependent_count, AVG(hd.hd_vehicle_count) AS average_vehicle_count, td.t_shift, SUM(CASE WHEN td.t_am_pm = 'AM' THEN 1 ELSE 0 END) AS returns_in_am, SUM(CASE WHEN td.t_am_pm = 'PM' THEN 1 ELSE 0 END) AS returns_in_pm FROM web_returns wr JOIN ship_mode sm ON wr.wr_order_number = sm.sm_ship_mode_sk JOIN household_demographics hd ON wr.wr_returning_hdemo_sk = hd.hd_demo_sk JOIN time_dim td ON wr.wr_returned_time_sk = td.t_time_sk WHERE sm.sm_type IN ('NEXT DAY', 'TWO DAY', 'LIBRARY', 'EXPRESS', 'REGULAR', 'OVERNIGHT') AND sm.sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') AND td.t_second IN ('18', '2', '56', '30') AND wr.wr_return_ship_cost IN ('3700.56', '275.65', '284.48') GROUP BY sm.sm_type, sm.sm_code, td.t_shift ORDER BY total_returns DESC, total_return_shipping_cost DESC;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(DISTINCT cs.cs_order_number) AS total_catalog_orders, SUM(cs.cs_quantity) AS total_catalog_quantity, AVG(cs.cs_sales_price) AS avg_catalog_sales_price, SUM(ss.ss_net_profit) AS total_store_net_profit, AVG(ss.ss_sales_price) AS avg_store_sales_price, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_page_visits, SUM(wp.wp_link_count) AS total_web_page_links, ws.web_name, ws.web_company_name, ib.ib_lower_bound, ib.ib_upper_bound, s.s_store_name, s.s_number_employees, s.s_floor_space FROM customer_demographics cd LEFT JOIN catalog_sales cs ON cd.cd_demo_sk = cs.cs_bill_cdemo_sk LEFT JOIN store_sales ss ON cd.cd_demo_sk = ss.ss_cdemo_sk LEFT JOIN web_page wp ON cd.cd_demo_sk = wp.wp_customer_sk LEFT JOIN web_site ws ON wp.wp_web_page_id = ws.web_site_id LEFT JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound LEFT JOIN store s ON ss.ss_store_sk = s.s_store_sk LEFT JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk WHERE ib.ib_income_band_sk IN (6, 11, 7) AND (s.s_rec_end_date IN ('1999-03-13', '2000-03-12', '2001-03-12') OR s.s_rec_end_date IS NULL) AND (s.s_store_name LIKE '%cally%' OR s.s_store_name LIKE '%ation%' OR s.s_store_name LIKE '%eing%') AND wp.wp_web_page_id IN ('AAAAAAAAJBAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAAMCAAAAAA') AND wp.wp_web_page_sk IN (30, 40, 9) AND wp.wp_rec_end_date IN ('2000-09-02', '1999-09-03', '2001-09-02') AND cd.cd_dep_college_count = 0 AND cd.cd_marital_status IN ('U', 'W', 'S') AND cd.cd_dep_employed_count = 0 AND ss.ss_sales_price IN (6.97, 54.53, 6.01) AND ss.ss_net_profit IN (-2115.52, -1765.80, -614.39) AND cs.cs_ext_tax IN (18.59, 2.99, 205.24) AND cs.cs_sold_date_sk IN (2450841, 2450829, 2450825) AND ws.web_name IN ('site_2', 'site_4', 'site_0') AND ws.web_street_number IN ('887', '973', '892') AND cp.cp_type IN ('quarterly', 'monthly', 'bi-annual') AND cp.cp_catalog_number IN (31, 32, 13) AND cp.cp_end_date_sk IN (2451574, 2451539, 2451299) GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, ws.web_name, ws.web_company_name, ib.ib_lower_bound, ib.ib_upper_bound, s.s_store_name, s.s_number_employees, s.s_floor_space ORDER BY total_catalog_orders DESC, total_store_net_profit DESC, total_web_page_visits DESC;
SELECT i.i_category AS category, ca.ca_state AS customer_state, EXTRACT(MONTH FROM (DATE '1970-01-01' + c.c_first_sales_date_sk * INTERVAL '1 day')) AS sale_month, COUNT(DISTINCT s.s_store_sk) AS num_stores, SUM(i.i_current_price) AS total_sales_amount, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, COUNT(i.i_item_sk) AS items_sold, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_amt) AS avg_return_amount, COUNT(sr.sr_item_sk) AS items_returned FROM store s JOIN customer c ON s.s_store_sk = c.c_current_addr_sk JOIN item i ON s.s_store_sk = i.i_manufact_id JOIN store_returns sr ON i.i_item_sk = sr.sr_item_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ca.ca_state IN ('TN', 'DE', 'VA', 'CO') AND i.i_category_id IS NOT NULL AND c.c_first_sales_date_sk IS NOT NULL AND (c.c_birth_month = 1 OR c.c_birth_month IS NULL) AND sr.sr_returned_date_sk IS NOT NULL GROUP BY category, customer_state, sale_month ORDER BY total_sales_amount DESC, avg_wholesale_cost DESC, total_return_amount DESC LIMIT 100;
SELECT ws.ws_web_site_sk, web.web_name, web.web_class, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, SUM(ws.ws_quantity) as total_quantity_sold, AVG(ws.ws_sales_price) as average_sales_price, COUNT(DISTINCT ws.ws_order_number) as total_orders, SUM(ws.ws_net_paid) as total_net_paid, SUM(ws.ws_net_paid_inc_tax) as total_net_paid_inc_tax, SUM(ws.ws_net_profit) as total_net_profit FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk AND p.p_response_target = '1' WHERE p.p_start_date_sk IN (2451635, 2451362, 2451818, 2451605, 2451420, 2451665) GROUP BY ws.ws_web_site_sk, web.web_name, web.web_class, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY total_net_profit DESC, web.web_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status;
