SELECT ca.ca_state AS customer_state, ib.ib_income_band_sk AS income_band, date_dim.d_year AS sale_year, SUM(ss.ss_sales_price) AS total_sales, AVG(ss.ss_sales_price) AS avg_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS sales_transactions, SUM(wr.wr_return_amt) AS total_returns, AVG(wr.wr_return_amt) AS avg_return_amt, COUNT(DISTINCT wr.wr_order_number) AS return_transactions, (SUM(ss.ss_sales_price) - SUM(wr.wr_return_amt)) AS net_sales FROM store_sales ss LEFT JOIN web_returns wr ON ss.ss_item_sk = wr.wr_item_sk AND ss.ss_customer_sk = wr.wr_refunded_customer_sk INNER JOIN date_dim ON ss.ss_sold_date_sk = date_dim.d_date_sk INNER JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk INNER JOIN income_band ib ON ss.ss_cdemo_sk = ib.ib_income_band_sk WHERE ca.ca_state IS NOT NULL AND date_dim.d_year >= 2000 GROUP BY ca.ca_state, ib.ib_income_band_sk, date_dim.d_year ORDER BY ca.ca_state, ib.ib_income_band_sk, date_dim.d_year;
SELECT cc.cc_call_center_id AS call_center, cc.cc_name AS call_center_name, cc.cc_manager AS manager, SUM(i.i_current_price) AS total_sales, AVG(i.i_wholesale_cost) AS average_wholesale_cost, COUNT(DISTINCT cd.cd_demo_sk) AS unique_customer_demographics, AVG(cd.cd_purchase_estimate) AS average_purchase_estimate, COUNT(DISTINCT t.t_time_sk) AS count_time_sk_events, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(*) FILTER (WHERE t.t_am_pm = 'AM') AS am_shifts, COUNT(*) FILTER (WHERE t.t_sub_shift = 'night') AS night_sub_shifts FROM call_center cc JOIN catalog_page cp ON cc.cc_call_center_id = cp.cp_catalog_page_id JOIN item i ON cp.cp_catalog_page_sk = i.i_item_sk JOIN customer_demographics cd ON i.i_manager_id = cd.cd_demo_sk JOIN time_dim t ON t.t_time_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound JOIN date_dim dd_cc ON cc.cc_open_date_sk = dd_cc.d_date_sk JOIN date_dim dd_cp ON cp.cp_start_date_sk = dd_cp.d_date_sk WHERE dd_cc.d_date <= CURRENT_DATE AND (cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date > CURRENT_DATE) AND dd_cp.d_date <= CURRENT_DATE AND (cp.cp_end_date_sk IS NULL OR dd_cp.d_date > CURRENT_DATE) GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_manager, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_sales DESC;
SELECT s_state, s_city, s_county, COUNT(DISTINCT s_store_sk) AS num_stores, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, SUM(ss_net_paid) AS total_net_paid, SUM(ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss_net_profit) AS total_net_profit, COUNT(DISTINCT ss_customer_sk) AS unique_customers, AVG(inv_quantity_on_hand) AS average_inventory_on_hand FROM store JOIN store_sales ON s_store_sk = ss_store_sk JOIN inventory ON ss_item_sk = inv_item_sk AND ss_store_sk = inv_warehouse_sk JOIN time_dim ON ss_sold_time_sk = t_time_sk WHERE inv_quantity_on_hand IN (553, 372, 818, 629, 791, 623) AND inv_warehouse_sk IN (1, 2) AND t_hour BETWEEN 9 AND 17 GROUP BY s_state, s_city, s_county ORDER BY s_state, s_city, s_county;
SELECT cc_state, SUM(sr_return_amt) AS total_return_amt, AVG(sr_return_amt) AS avg_return_amt, COUNT(*) AS num_returns, SUM(ss_net_profit) AS total_net_profit, AVG(ss_net_profit) AS avg_net_profit, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(wr_return_ship_cost) AS total_return_ship_cost, AVG(wr_return_ship_cost) AS avg_return_ship_cost, COUNT(DISTINCT wr_refunded_customer_sk) AS unique_returned_customers FROM call_center JOIN store_returns ON sr_store_sk = cc_call_center_sk JOIN store_sales ON ss_store_sk = cc_call_center_sk AND store_returns.sr_ticket_number = store_sales.ss_ticket_number JOIN web_returns ON wr_returning_addr_sk = sr_addr_sk WHERE cc_rec_start_date <= CURRENT_DATE AND (cc_rec_end_date IS NULL OR cc_rec_end_date > CURRENT_DATE) AND sr_hdemo_sk IN ('1110', '6655', '2958', '2489', '5750', '5814') AND sr_return_quantity = 36 AND wr_return_ship_cost IN ('460.94', '104.34', '381.68', '830.90') AND wr_returned_time_sk IN ('77442', '66455', '78336', '60895', '70221') AND ss_coupon_amt IN ('1615.93', '743.42') AND ss_net_profit IN ('-1410.96', '-564.39', '-55.72') GROUP BY cc_state ORDER BY total_return_amt DESC;
SELECT cc.cc_name, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, AVG(cs.cs_net_profit) AS average_net_profit FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN store s ON cc.cc_division = s.s_division_id JOIN web_page wp ON c.c_customer_sk = wp.wp_customer_sk WHERE s.s_rec_end_date IN ('2001-03-12', '2000-03-12', '1999-03-13') AND s.s_floor_space IN (8954883, 9078805, 9341467, 5285950) AND c.c_birth_country = 'LESOTHO' AND c.c_customer_id IN ('AAAAAAAAKJFAAAAA', 'AAAAAAAALPMAAAAA', 'AAAAAAAAHPBBAAAA', 'AAAAAAAAHHFAAAAA', 'AAAAAAAAMCKAAAAA', 'AAAAAAAAKKABAAAA') AND wp.wp_url = 'http://www.foo.com' GROUP BY cc.cc_name;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, AVG(ss.ss_sales_price) AS average_sale_price, SUM(ss.ss_net_paid) AS total_sales, COUNT(ss.ss_ticket_number) AS number_of_sales FROM store_sales ss INNER JOIN call_center cc ON ss.ss_store_sk = cc.cc_call_center_sk GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_sales DESC, average_sale_price DESC LIMIT 10;
SELECT d_year, i_category, s_store_name, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS avg_sales_price, SUM(ss_net_profit) AS total_net_profit, COUNT(DISTINCT ss_customer_sk) AS unique_customers, AVG(hd_dep_count) AS avg_household_dep_count, AVG(hd_vehicle_count) AS avg_household_vehicle_count FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN item ON ss_item_sk = i_item_sk JOIN store ON ss_store_sk = s_store_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk WHERE d_year = 2001 AND i_category_id IN ('3', '7', '4', '6') AND hd_income_band_sk IN ('7', '3', '9', '15', '20', '18') GROUP BY d_year, i_category, s_store_name ORDER BY total_net_profit DESC, avg_sales_price DESC LIMIT 100;
SELECT c.c_first_name, c.c_last_name, ca.ca_state, w.w_warehouse_name, SUM(i.inv_quantity_on_hand) AS total_inventory, AVG(cc.cc_tax_percentage) AS average_tax_percentage, COUNT(DISTINCT cc.cc_call_center_sk) AS number_of_call_centers FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN inventory i ON ca.ca_address_sk = i.inv_warehouse_sk JOIN warehouse w ON i.inv_warehouse_sk = w.w_warehouse_sk JOIN call_center cc ON w.w_state = cc.cc_state WHERE ca.ca_state IN ('MA', 'FL') AND w.w_warehouse_id IN ('AAAAAAAADAAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAABAAAAAAA') AND cc.cc_tax_percentage IN (0.01, 0.05, 0.11, 0.12) GROUP BY c.c_first_name, c.c_last_name, ca.ca_state, w.w_warehouse_name ORDER BY total_inventory DESC, average_tax_percentage, number_of_call_centers DESC;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales, SUM(CASE WHEN p.p_discount_active = '1' THEN ss.ss_net_paid_inc_tax ELSE 0 END) AS total_revenue_with_discount, SUM(CASE WHEN p.p_discount_active = '0' THEN ss.ss_net_paid_inc_tax ELSE 0 END) AS total_revenue_without_discount FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE cc.cc_sq_ft IN ('1138', '4134', '649', '3514', '2268') AND ss.ss_net_paid_inc_tax IN ('3576.44', '1406.62', '935.06', '961.29', '3070.18', '6397.11') AND ss.ss_list_price = '158.68' GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_quantity_sold DESC, average_sales_price DESC;
SELECT sm.sm_type, w.w_county, w.w_warehouse_sq_ft, ca.ca_street_type, cd.cd_credit_rating, cd.cd_purchase_estimate, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(cd.cd_dep_employed_count) AS avg_employed_dependents, COUNT(DISTINCT ca.ca_address_sk) AS num_customer_addresses FROM ship_mode sm JOIN warehouse w ON sm.sm_ship_mode_sk = w.w_warehouse_sk JOIN inventory inv ON w.w_warehouse_sk = inv.inv_warehouse_sk JOIN customer_address ca ON w.w_state = ca.ca_state JOIN customer_demographics cd ON ca.ca_address_sk = cd.cd_demo_sk JOIN catalog_page cp ON cp.cp_department = w.w_county WHERE sm.sm_type IN ('OVERNIGHT', 'LIBRARY', 'NEXT DAY') AND sm.sm_contract IN ('OrDuVy2H', 'I3uCelXtjP', 'Ek') AND w.w_zip = '35709' AND w.w_county = 'Williamson County' AND w.w_warehouse_sq_ft IN ('138504', '294242', '977787') AND ca.ca_street_type IN ('Road', 'Way', 'Ct.') AND ca.ca_address_id IN ('AAAAAAAAOPNAAAAA', 'AAAAAAAAJEDAAAAA', 'AAAAAAAAGEGAAAAA') AND cd.cd_credit_rating IN ('Good', 'High Risk', 'Unknown') AND cd.cd_dep_employed_count = '0' AND cd.cd_purchase_estimate IN ('9000', '5500', '3500') AND cd.cd_demo_sk IN ('20710', '17420', '21031') AND cp.cp_catalog_page_sk IN ('767', '3436', '3795') AND cp.cp_catalog_number IN ('15', '25', '21') AND cp.cp_catalog_page_number IN ('101', '57', '25') AND inv.inv_item_sk IN ('6955', '13411', '10159') AND inv.inv_warehouse_sk IN ('2', '1') GROUP BY sm.sm_type, w.w_county, w.w_warehouse_sq_ft, ca.ca_street_type, cd.cd_credit_rating, cd.cd_purchase_estimate ORDER BY total_inventory DESC, num_catalog_pages DESC, avg_employed_dependents DESC, num_customer_addresses DESC;
SELECT s_store_id, s_state, s_city, COUNT(DISTINCT ss_ticket_number) AS num_transactions, SUM(ss_net_paid) AS total_sales, AVG(ss_sales_price) AS avg_sales_price, SUM(wr_return_amt_inc_tax) AS total_returns, COUNT(DISTINCT wr_order_number) AS num_returns, ARRAY_AGG(DISTINCT r_reason_desc) AS reasons_for_returns FROM store_sales AS ss JOIN store AS s ON ss.ss_store_sk = s.s_store_sk LEFT JOIN web_returns AS wr ON ss.ss_ticket_number = wr.wr_order_number LEFT JOIN reason AS r ON wr.wr_reason_sk = r.r_reason_sk JOIN date_dim AS dd ON ss.ss_sold_date_sk = dd.d_date_sk WHERE dd.d_quarter_seq = ( SELECT MAX(d_quarter_seq) FROM date_dim WHERE d_current_quarter = 'Y' ) AND s.s_state IN ('CA', 'TX', 'NY') GROUP BY s_store_id, s_state, s_city ORDER BY total_sales DESC, s_state, s_city;
SELECT dd.d_year, dd.d_quarter_name, SUM(ws.ws_net_paid_inc_tax) AS total_sales, AVG(ws.ws_quantity) AS average_quantity_sold, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(inv.inv_quantity_on_hand) AS total_inventory, ca.ca_state, ca.ca_county, i.i_category, i.i_class, hd.hd_buy_potential, hd.hd_vehicle_count FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk JOIN customer_address ca ON ws.ws_ship_addr_sk = ca.ca_address_sk JOIN household_demographics hd ON ws.ws_ship_hdemo_sk = hd.hd_demo_sk WHERE ws.ws_ext_wholesale_cost IN (570.14, 3704.88, 1543.36) AND ws.ws_warehouse_sk IN (4, 5, 3) AND i.i_current_price IN (1.13, 8.95, 2.88) AND i.i_manager_id IN (27, 17, 99) AND i.i_formulation IN ('867742235steel028826', '47967133139rose58993', '54283dodger150399841') AND i.i_brand_id IN (7006008, 10012017, 7009003) AND inv.inv_date_sk = 2450815 AND inv.inv_quantity_on_hand IN (774, 762, 329) AND hd.hd_buy_potential IN ('Unknown', '>10000', '501-1000') AND hd.hd_vehicle_count IN (0, 1, 3) AND dd.d_fy_quarter_seq IN (36, 23, 32) AND dd.d_month_seq IN (46, 21, 40) AND ca.ca_county IN ('Bon Homme County', 'Vinton County', 'Geary County') AND ca.ca_gmt_offset IN (-10.00, -7.00, -9.00) GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state, ca.ca_county, i.i_category, i.i_class, hd.hd_buy_potential, hd.hd_vehicle_count ORDER BY total_sales DESC, total_inventory DESC, dd.d_year, dd.d_quarter_name;
SELECT s.s_state, COUNT(sr.sr_ticket_number) AS total_returns_count, SUM(sr.sr_return_amt) AS total_returns_amount, AVG(sr.sr_return_amt) AS average_return_amount, AVG(w.w_warehouse_sq_ft) AS average_warehouse_sq_footage FROM store s JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk LEFT JOIN warehouse w ON s.s_state = w.w_state WHERE s.s_closed_date_sk IS NULL GROUP BY s.s_state ORDER BY s.s_state;
SELECT cc_state, r_reason_desc, SUM(inv_quantity_on_hand) AS total_inventory, AVG(c_birth_year) AS average_customer_birth_year, COUNT(DISTINCT c_customer_sk) AS unique_customers, COUNT(DISTINCT web_site_sk) AS web_sites_operating FROM inventory JOIN reason ON (r_reason_sk = inv_quantity_on_hand) JOIN call_center ON (cc_division = inv_warehouse_sk) JOIN customer ON (c_current_addr_sk = cc_open_date_sk) JOIN web_site ON (web_state = cc_state) WHERE inv_date_sk = 2450815 AND c_customer_id IN ('AAAAAAAACHMAAAAA', 'AAAAAAAANPEAAAAA') AND (cc_rec_end_date IS NULL OR cc_rec_end_date > CURRENT_DATE) AND (web_rec_end_date IS NULL OR web_rec_end_date > CURRENT_DATE) GROUP BY cc_state, r_reason_desc ORDER BY total_inventory DESC, average_customer_birth_year;
SELECT s.s_store_name, c.c_first_name, c.c_last_name, COUNT(ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_items_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk WHERE s.s_floor_space IN (9026222, 7557959, 9341467, 6995995, 5219562) AND c.c_current_hdemo_sk IN (6755, 780, 352, 3208, 1770) AND c.c_email_address IN ('Joseph.Hilton@io2VIr.org', 'Scott.Goodman@EN4g6ehG4eh1.com', 'Charles.Fink@5cPLD.com', 'Rosa.Nixon@ghkTsItbO5o8hKtVkdI.com') GROUP BY s.s_store_name, c.c_first_name, c.c_last_name ORDER BY total_net_profit DESC, total_net_paid DESC;
SELECT cc_state, ca_location_type, COUNT(DISTINCT ws_order_number) AS total_orders, SUM(ws_quantity) AS total_quantity_sold, AVG(ws_sales_price) AS avg_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_profit) AS total_net_profit FROM web_sales ws JOIN store s ON ws.ws_bill_addr_sk = s.s_store_sk JOIN call_center cc ON cc.cc_call_center_sk = ws.ws_ship_mode_sk JOIN customer_address ca ON ws.ws_bill_addr_sk = ca.ca_address_sk JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk WHERE ws.ws_item_sk IN (70, 58, 77) AND hd.hd_dep_count BETWEEN 1 AND 9 AND ca.ca_location_type IN ('single family', 'apartment', 'condo') AND ca.ca_city IN ('Ferguson', 'Holiday Hills') GROUP BY cc_state, ca_location_type ORDER BY total_net_profit DESC, total_net_paid DESC;
SELECT d_year, SUM(ws_net_profit) AS total_net_profit, AVG(ws_quantity) AS average_quantity_sold, COUNT(DISTINCT ws.ws_web_page_sk) AS count_distinct_pages, SUM(wr_return_amt) AS total_return_amount, AVG(wr_return_quantity) AS average_return_quantity, COUNT(DISTINCT wr.wr_item_sk) AS count_distinct_returned_items FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk LEFT JOIN web_returns wr ON ws.ws_item_sk = wr.wr_item_sk AND ws.ws_order_number = wr.wr_order_number LEFT JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk WHERE dd.d_moy IN ('8', '11') AND dd.d_current_week = 'N' AND ws.ws_web_page_sk IN ('58', '41', '42', '15', '20') AND ws.ws_ext_list_price = 4407.89 AND (wp.wp_rec_end_date IN ('1999-09-03', '2001-09-02', '2000-09-02') OR wp.wp_creation_date_sk IN (2450815, 2450812, 2450813)) AND wr.wr_return_amt IN (78.84, 5987.96, 1527.93, 522.48, 1155.36, 2771.56) AND wr.wr_return_amt_inc_tax = 191.45 GROUP BY dd.d_year;
