SELECT cc.cc_name, cc.cc_class, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(ss.ss_quantity) AS total_sold_quantity, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_net_profit, cd.cd_gender, cd.cd_marital_status, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers FROM call_center cc JOIN store_returns sr ON cc.cc_call_center_sk = sr.sr_store_sk JOIN store_sales ss ON sr.sr_item_sk = ss.ss_item_sk AND sr.sr_ticket_number = ss.ss_ticket_number JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk WHERE cc.cc_class IN ('large', 'medium', 'small') AND cc.cc_call_center_sk IN (3, 2, 6) AND sr.sr_cdemo_sk IN (864476, 1163495, 1520527) AND sr.sr_return_amt IN (314.00, 13.08, 1010.36) AND cd.cd_gender IN ('F', 'M') AND cd.cd_marital_status IN ('W', 'U', 'D') AND ss.ss_list_price IN (33.74, 25.41, 32.01) AND ss.ss_coupon_amt IN (31.24, 6.48, 7.15) GROUP BY cc.cc_name, cc.cc_class, cd.cd_gender, cd.cd_marital_status ORDER BY total_net_profit DESC;
SELECT sm.sm_type, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_quantity) AS total_web_quantity_sold, AVG(ws.ws_sales_price) AS avg_web_sales_price, SUM(cr.cr_return_quantity) AS total_return_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cr.cr_order_number) AS total_returns FROM web_sales ws JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk LEFT JOIN catalog_returns cr ON ws.ws_order_number = cr.cr_order_number AND ws.ws_item_sk = cr.cr_item_sk WHERE sm.sm_type IN ('EXPRESS', 'OVERNIGHT', 'NEXT DAY') GROUP BY sm.sm_type, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY sm.sm_type, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status;
SELECT ws.ws_web_site_sk, ws.ws_item_sk, i.i_product_name, i.i_category, sm.sm_type AS shipping_type, w.w_state AS warehouse_state, ca.ca_state AS customer_state, COUNT(*) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_net_profit) AS average_net_profit FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk JOIN customer_address ca ON ws.ws_ship_addr_sk = ca.ca_address_sk WHERE ca.ca_gmt_offset IN ('-8.00', '-10.00', '-5.00', '-9.00', '-7.00') AND (w.w_zip = '35709' OR w.w_zip = '31904') GROUP BY ws.ws_web_site_sk, ws.ws_item_sk, i.i_product_name, i.i_category, sm.sm_type, w.w_state, ca.ca_state ORDER BY total_net_profit DESC, total_orders DESC LIMIT 100;
SELECT cd.cd_education_status, ib.ib_income_band_sk, COUNT(DISTINCT ws.ws_order_number) AS number_of_orders, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_sales_price) AS average_sales_price FROM web_sales ws JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE cd.cd_purchase_estimate IS NOT NULL AND ib.ib_upper_bound <= 110000 AND ib.ib_income_band_sk IN (4, 1, 14, 13, 8) GROUP BY ROLLUP (cd.cd_education_status, ib.ib_income_band_sk) ORDER BY total_net_profit DESC, cd.cd_education_status, ib.ib_income_band_sk;
SELECT ca.ca_city, ca.ca_state, COUNT(DISTINCT ca.ca_address_sk) AS num_addresses, AVG(hd.hd_dep_count) AS avg_dependency_count, SUM(hd.hd_vehicle_count) AS total_vehicles, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT sm.sm_ship_mode_sk) AS num_ship_modes, COUNT(DISTINCT r.r_reason_sk) AS num_reasons, SUM(CASE WHEN cp.cp_department = 'Electronics' THEN 1 ELSE 0 END) AS num_electronics_pages, SUM(CASE WHEN sm.sm_type = 'OVERNIGHT' THEN 1 ELSE 0 END) AS overnight_shipments, AVG(CASE WHEN t.t_am_pm = 'PM' THEN t.t_hour END) AS avg_hour_pm FROM customer_address ca JOIN household_demographics hd ON ca.ca_address_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN ship_mode sm ON sm.sm_carrier = 'UPS' JOIN reason r ON r.r_reason_desc LIKE 'reason %' LEFT JOIN catalog_page cp ON cp.cp_department = ca.ca_city LEFT JOIN time_dim t ON t.t_shift = 'Evening' WHERE r.r_reason_sk IN ('9', '6', '11', '2') AND ib.ib_income_band_sk IN ('20', '6') AND hd.hd_buy_potential = 'Unknown' AND sm.sm_type IN ('LIBRARY', 'OVERNIGHT', 'NEXT DAY') GROUP BY ca.ca_city, ca.ca_state, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ca.ca_city, ca.ca_state;
SELECT c.c_customer_id, sm.sm_type as shipping_type, count(cs_order_number) as total_orders, sum(cs_quantity) as total_quantity, avg(cs_net_paid) as average_net_paid, sum(cs_net_profit) as total_net_profit, date_part('year', d.d_date) as sale_year, d.d_quarter_name as sale_quarter, ib.ib_lower_bound as income_band_lower_bound, ib.ib_upper_bound as income_band_upper_bound FROM catalog_sales cs JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN income_band ib ON c.c_current_hdemo_sk = ib.ib_income_band_sk WHERE d.d_year = 2023 AND sm.sm_code = 'SEA' AND ib.ib_lower_bound >= 30001 AND ib.ib_upper_bound <= 80001 GROUP BY c.c_customer_id, shipping_type, sale_year, sale_quarter, income_band_lower_bound, income_band_upper_bound ORDER BY total_net_profit DESC, total_orders DESC;
SELECT dd.d_year, dd.d_quarter_name, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, SUM(sr.sr_return_amt_inc_tax) AS total_store_return_value, AVG(sr.sr_return_amt_inc_tax) AS avg_store_return_value, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_returns, SUM(cr.cr_return_amt_inc_tax) AS total_catalog_return_value, AVG(cr.cr_return_amt_inc_tax) AS avg_catalog_return_value, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(inv.inv_quantity_on_hand) AS avg_inventory, COUNT(DISTINCT p.p_promo_sk) AS total_promotions, SUM(p.p_cost) AS total_promotion_cost, AVG(p.p_cost) AS avg_promotion_cost FROM date_dim dd LEFT JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk LEFT JOIN catalog_returns cr ON dd.d_date_sk = cr.cr_returned_date_sk LEFT JOIN inventory inv ON dd.d_date_sk = inv.inv_date_sk LEFT JOIN promotion p ON dd.d_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk WHERE dd.d_current_quarter = 'N' AND dd.d_dow IN ('2', '1', '3') AND dd.d_week_seq IN ('357', '270', '599') AND dd.d_day_name IN ('Friday', 'Wednesday', 'Thursday') AND cr.cr_refunded_cash IN ('41.98', '2827.18', '326.60') AND cr.cr_return_tax IN ('78.35', '1.90', '17.50') AND cr.cr_reason_sk IN ('10', '6', '34') AND inv.inv_date_sk = '2450815' AND inv.inv_quantity_on_hand IN ('527', '833', '192') AND sr.sr_store_credit IN ('65.83', '69.57', '46.64') AND sr.sr_return_amt_inc_tax IN ('1345.99', '37.28', '546.00') AND sr.sr_hdemo_sk IN ('5161', '6269', '797') AND p.p_channel_radio = 'N' AND p.p_channel_press = 'N' GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT p.p_promo_name, sm.sm_type AS shipping_method, ca.ca_state AS ship_state, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_ext_discount_amt) AS avg_discount_amount, SUM(ws.ws_net_profit) AS total_profit FROM web_sales ws JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN customer_address ca ON ws.ws_ship_addr_sk = ca.ca_address_sk JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk WHERE d.d_year = 2023 AND p.p_discount_active = '1' AND ca.ca_state IS NOT NULL AND sm.sm_type IS NOT NULL GROUP BY p.p_promo_name, shipping_method, ship_state ORDER BY total_profit DESC, avg_discount_amount DESC, total_orders DESC;
SELECT ws.ws_item_sk, hd.hd_income_band_sk, AVG(ws.ws_net_profit) AS avg_net_profit_web_sales, SUM(cr.cr_net_loss) AS total_net_loss_catalog_returns FROM web_sales ws JOIN catalog_returns cr ON ws.ws_item_sk = cr.cr_item_sk AND ws.ws_order_number = cr.cr_order_number JOIN household_demographics hd ON (ws.ws_bill_hdemo_sk = hd.hd_demo_sk OR ws.ws_ship_hdemo_sk = hd.hd_demo_sk) AND (cr.cr_refunded_hdemo_sk = hd.hd_demo_sk OR cr.cr_returning_hdemo_sk = hd.hd_demo_sk) WHERE hd.hd_buy_potential IN ('0-500', '5001-10000', '>10000', '1001-5000') AND ws.ws_warehouse_sk IN (1, 2) AND cr.cr_warehouse_sk IN (1, 2) AND ws.ws_item_sk IN (8530, 14257, 11258, 15637, 6283) AND cr.cr_item_sk IN (9044, 17656, 9802) GROUP BY ws.ws_item_sk, hd.hd_income_band_sk;
SELECT i.i_category, i.i_class, call_center.cc_name, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT cr.cr_order_number) AS total_returned_orders, MAX(i.i_current_price) AS max_item_price FROM catalog_returns cr JOIN call_center ON cr.cr_call_center_sk = call_center.cc_call_center_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk WHERE i.i_manufact = 'barcallycally' GROUP BY i.i_category, i.i_class, call_center.cc_name ORDER BY total_return_amount DESC, i.i_category, i.i_class, call_center.cc_name;
SELECT hd.hd_demo_sk, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, COUNT(DISTINCT wr.wr_order_number) AS total_web_returns, SUM(sr.sr_return_amt) AS total_store_return_amount, AVG(sr.sr_return_amt) AS avg_store_return_amount, SUM(wr.wr_return_amt) AS total_web_return_amount, AVG(wr.wr_return_amt) AS avg_web_return_amount, SUM(CASE WHEN p.p_channel_radio = 'N' AND p.p_channel_demo = 'N' THEN p.p_cost ELSE 0 END) AS non_radio_demo_promo_cost, AVG(CASE WHEN p.p_channel_radio = 'N' AND p.p_channel_demo = 'N' THEN p.p_response_target ELSE NULL END) AS avg_non_radio_demo_response_target FROM household_demographics hd LEFT JOIN store_returns sr ON hd.hd_demo_sk = sr.sr_hdemo_sk LEFT JOIN web_returns wr ON (hd.hd_demo_sk = wr.wr_refunded_hdemo_sk OR hd.hd_demo_sk = wr.wr_returning_hdemo_sk) LEFT JOIN promotion p ON p.p_promo_sk = sr.sr_reason_sk WHERE hd.hd_demo_sk IN (560, 4858) AND (sr.sr_store_sk IN (8, 10) OR sr.sr_store_sk IS NULL) GROUP BY hd.hd_demo_sk ORDER BY hd.hd_demo_sk;
SELECT ws_item_sk, AVG(ws_net_profit) AS avg_web_net_profit, AVG(ss_net_profit) AS avg_store_net_profit, (AVG(ws_net_profit) - AVG(ss_net_profit)) AS profit_difference FROM web_sales JOIN web_page ON ws_web_page_sk = wp_web_page_sk LEFT JOIN store_sales ON ws_item_sk = ss_item_sk WHERE wp_char_count > 3000 GROUP BY ws_item_sk HAVING AVG(ws_net_profit) IS NOT NULL AND AVG(ss_net_profit) IS NOT NULL ORDER BY profit_difference DESC;
SELECT s.s_store_name, ib.hd_income_band_sk, hd.hd_buy_potential, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS transaction_count FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk LEFT JOIN household_demographics ib ON hd.hd_income_band_sk = ib.hd_income_band_sk WHERE hd.hd_income_band_sk = 9 GROUP BY s.s_store_name, ib.hd_income_band_sk, hd.hd_buy_potential ORDER BY total_sales DESC, average_sales_price DESC;
