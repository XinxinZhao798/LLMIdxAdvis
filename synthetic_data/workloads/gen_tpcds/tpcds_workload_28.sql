SELECT i_category, i_class, i_brand, SUM(i_current_price) AS total_sales_value, AVG(i_current_price) AS avg_sales_price, COUNT(DISTINCT i_item_sk) AS unique_items_sold, COUNT(DISTINCT c_customer_sk) AS unique_customers, c_birth_country, AVG(EXTRACT(YEAR FROM AGE(MAKE_DATE(c_birth_year, c_birth_month, c_birth_day)))) AS avg_customer_age FROM item JOIN customer ON i_manager_id = c_current_addr_sk JOIN time_dim ON t_time_sk = c_first_sales_date_sk WHERE i_rec_start_date <= NOW() AND (i_rec_end_date IS NULL OR i_rec_end_date > NOW()) AND c_preferred_cust_flag = 'Y' AND t_minute IN ('6', '3', '48', '49') GROUP BY ROLLUP(i_category, i_class, i_brand, c_birth_country) ORDER BY total_sales_value DESC, unique_items_sold DESC, i_category, i_class, i_brand, c_birth_country;
SELECT d_year, i_category, SUM(ws_net_paid_inc_tax) AS total_sales, AVG(ws_quantity) AS average_quantity, COUNT(DISTINCT ws_bill_customer_sk) AS unique_customers, SUM(cr_net_loss) AS total_returns_loss, COUNT(DISTINCT cr_returned_date_sk) AS return_days FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN item ON ws_item_sk = i_item_sk LEFT JOIN catalog_returns ON ws_item_sk = cr_item_sk AND ws_order_number = cr_order_number WHERE d_year = 2002 AND ws_net_paid_inc_tax > 0 AND d_current_year = 'N' GROUP BY d_year, i_category ORDER BY total_sales DESC;
SELECT cp.cp_department, hd.hd_buy_potential, w.w_state, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS unique_tickets, SUM(ss.ss_net_paid_inc_tax) AS total_revenue_inc_tax, SUM(ss.ss_net_profit) AS total_net_profit FROM catalog_page cp JOIN store_sales ss ON cp.cp_catalog_page_sk = ss.ss_sold_date_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN warehouse w ON ss.ss_addr_sk = w.w_warehouse_sk WHERE cp.cp_end_date_sk IN ('2451509', '2451817', '2451635') AND hd.hd_vehicle_count IN (0, 1, 2, 3, 4) AND w.w_state = 'TN' AND ss.ss_ticket_number IN (3518, 3677) GROUP BY cp.cp_department, hd.hd_buy_potential, w.w_state ORDER BY total_net_profit DESC;
SELECT i.i_category, i.i_brand, w.w_state, w.w_country, AVG(i.i_current_price) AS avg_price, SUM(i.i_wholesale_cost) AS total_wholesale_cost, COUNT(DISTINCT i.i_item_sk) AS item_count, SUM(inv.inv_quantity_on_hand) AS total_quantity_on_hand FROM item i JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk WHERE w.w_zip = '35709' AND w.w_gmt_offset = -5.00 AND inv.inv_quantity_on_hand > 258 GROUP BY i.i_category, i.i_brand, w.w_state, w.w_country ORDER BY i.i_category, i.i_brand;
SELECT d_year, d_quarter_name, ca_state, COUNT(DISTINCT ws_order_number) AS total_orders, SUM(ws_quantity) AS total_quantity, AVG(ws_sales_price) AS average_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_profit) AS total_net_profit, SUM(ws_ext_tax) AS total_tax_collected FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN customer_address ON ws_bill_addr_sk = ca_address_sk JOIN customer_demographics ON ws_bill_cdemo_sk = cd_demo_sk JOIN catalog_page ON ws_web_page_sk = cp_catalog_page_sk JOIN store ON ws_warehouse_sk = s_store_sk WHERE d_current_quarter = 'N' AND cd_dep_employed_count = 0 AND cp_department = 'DEPARTMENT' AND ws_order_number IN ('25231', '23240', '18952', '15512', '28993', '33703') GROUP BY d_year, d_quarter_name, ca_state ORDER BY d_year, d_quarter_name, ca_state;
SELECT ca.ca_state, ca.ca_city, COUNT(DISTINCT c.c_customer_sk) AS num_customers, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_inc_tax, AVG(wr.wr_return_quantity) AS average_return_quantity, SUM(wr.wr_fee) AS total_fees, AVG(cd.cd_purchase_estimate) AS average_purchase_estimate FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN web_returns wr ON c.c_customer_sk = wr.wr_refunded_customer_sk WHERE ca.ca_state IN ('CA', 'WA', 'GA') AND cd.cd_education_status IN ('College', '4 yr Degree', 'Advanced Degree') AND wr.wr_net_loss > 500 GROUP BY ca.ca_state, ca.ca_city ORDER BY total_return_amount_inc_tax DESC, ca.ca_state, ca.ca_city;
SELECT cp.cp_department AS department, EXTRACT(YEAR FROM d_date) AS sale_year, EXTRACT(MONTH FROM d_date) AS sale_month, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sale_price, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions FROM catalog_page cp JOIN store_sales ss ON cp.cp_catalog_page_sk = ss.ss_item_sk JOIN time_dim td ON ss.ss_sold_time_sk = td.t_time_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE cp.cp_type IN ('monthly', 'bi-annual', 'quarterly') AND ss.ss_item_sk IN (1838, 9235) AND ss.ss_wholesale_cost IN (5.12, 59.59, 25.96, 87.72, 47.56) AND td.t_hour = 1 GROUP BY department, sale_year, sale_month ORDER BY department, sale_year, sale_month;
SELECT c.c_first_name, c.c_last_name, cd.cd_gender, cd.cd_education_status, hd.hd_buy_potential, hd.hd_vehicle_count, COUNT(sr.sr_item_sk) AS total_returns, SUM(sr.sr_return_amt_inc_tax) AS total_return_value, AVG(sr.sr_return_amt_inc_tax) AS avg_return_value, ib.ib_lower_bound, ib.ib_upper_bound, w.w_warehouse_name, w.w_city, w.w_state, ws.web_name, ws.web_manager, COUNT(wr.wr_item_sk) AS total_web_returns, SUM(wr.wr_return_amt_inc_tax) AS total_web_return_value, AVG(wr.wr_return_amt_inc_tax) AS avg_web_return_value FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN warehouse w ON sr.sr_store_sk = w.w_warehouse_sk JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk WHERE cd.cd_credit_rating = 'Good' AND hd.hd_dep_count BETWEEN 1 AND 3 AND ib.ib_lower_bound >= 50000 AND sr.sr_return_amt > 0 AND wr.wr_return_amt > 0 AND ws.web_county = 'Williamson County' GROUP BY c.c_first_name, c.c_last_name, cd.cd_gender, cd.cd_education_status, hd.hd_buy_potential, hd.hd_vehicle_count, ib.ib_lower_bound, ib.ib_upper_bound, w.w_warehouse_name, w.w_city, w.w_state, ws.web_name, ws.web_manager ORDER BY total_return_value DESC, total_web_return_value DESC LIMIT 100;
SELECT c.cp_department, i.i_category, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_fee) AS total_fees_collected, SUM(cr.cr_net_loss) AS total_net_loss, w.w_state, hd.hd_buy_potential FROM catalog_returns cr JOIN catalog_page c ON cr.cr_catalog_page_sk = c.cp_catalog_page_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk WHERE cr.cr_returning_addr_sk IN ('31623', '47914', '49311', '38890', '49597') AND w.w_state = 'TN' AND hd.hd_buy_potential IN ('501-1000', '5001-10000') GROUP BY c.cp_department, i.i_category, w.w_state, hd.hd_buy_potential ORDER BY total_return_amount DESC, c.cp_department, i.i_category;
SELECT ib.ib_income_band_sk, cc.cc_division_name, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amt_inc_tax, SUM(wr.wr_net_loss) AS total_net_loss, COUNT(wr.wr_returned_date_sk) AS total_returns, AVG(hd.hd_dep_count) AS avg_dependents, AVG(hd.hd_vehicle_count) AS avg_vehicles FROM web_returns wr JOIN household_demographics hd ON wr.wr_returning_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN call_center cc ON cc.cc_country = 'United States' AND cc.cc_call_center_sk = wr.wr_refunded_addr_sk WHERE hd.hd_income_band_sk IN (20, 8, 18, 11, 19, 2) GROUP BY ib.ib_income_band_sk, cc.cc_division_name ORDER BY total_net_loss DESC, avg_return_amt_inc_tax DESC;
SELECT dd.d_year, dd.d_quarter_name, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, COUNT(DISTINCT cc.cc_call_center_sk) AS participating_call_centers, SUM(ss.ss_net_paid_inc_tax) AS total_revenue_including_tax, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN call_center cc ON cc.cc_mkt_id::integer = ss.ss_store_sk JOIN catalog_page cp ON ss.ss_sold_date_sk BETWEEN cp.cp_start_date_sk AND cp.cp_end_date_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk WHERE dd.d_year = 2001 AND cc.cc_class = 'small' AND cd.cd_credit_rating = 'Good' AND (cp.cp_type = 'monthly' OR cp.cp_type = 'bi-annual') AND (cc.cc_street_type = 'Way' OR cc.cc_street_type = 'RD' OR cc.cc_street_type = 'Boulevard') AND c.c_last_review_date_sk IN ('2452332', '2452464', '2452647', '2452396', '2452311') AND cd.cd_demo_sk IN ('20368', '16978', '19750', '17504') GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT ca_state, cd_gender, cd_marital_status, sm_type, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(sr_return_quantity) AS total_quantity_returned, AVG(sr_return_amt) AS average_return_amount, SUM(sr_net_loss) AS total_net_loss FROM store_sales JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN customer_demographics ON ss_cdemo_sk = cd_demo_sk JOIN ship_mode ON sm_ship_mode_sk = ss_promo_sk LEFT JOIN store_returns ON sr_ticket_number = ss_ticket_number AND sr_item_sk = ss_item_sk WHERE ca_state IS NOT NULL AND cd_gender IN ('M', 'F') AND cd_marital_status IN ('M', 'U', 'S', 'D') GROUP BY ca_state, cd_gender, cd_marital_status, sm_type ORDER BY total_quantity_sold DESC, average_sales_price DESC;
SELECT ca.ca_country, ca.ca_state, COUNT(DISTINCT sr.sr_ticket_number) AS num_returns, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(sr.sr_return_quantity) AS total_returned_quantity, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN store s ON sr.sr_store_sk = s.s_store_sk WHERE ca.ca_country = 'United States' AND s.s_rec_start_date BETWEEN '1997-03-13' AND '2001-03-13' AND s.s_number_employees BETWEEN 236 AND 288 AND sr.sr_returned_date_sk IN ('2452372', '2451953', '2452254') GROUP BY ca.ca_country, ca.ca_state ORDER BY total_return_amount DESC;
SELECT cc_state, i_category, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS avg_sales_price, COUNT(DISTINCT cs_order_number) AS unique_orders, SUM(ss_net_profit) AS total_store_profit, AVG(ss_wholesale_cost) AS avg_store_wholesale_cost, COUNT(DISTINCT ss_ticket_number) AS unique_store_tickets, SUM(inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT p_promo_sk) AS distinct_promotions FROM call_center JOIN catalog_sales ON cc_call_center_sk = cs_call_center_sk JOIN item ON cs_item_sk = i_item_sk JOIN store_sales ON ss_item_sk = i_item_sk JOIN inventory ON inv_item_sk = i_item_sk JOIN promotion ON (cs_promo_sk = p_promo_sk OR ss_promo_sk = p_promo_sk) JOIN store ON ss_store_sk = s_store_sk WHERE cc_mkt_id IN ('6', '2', '5') AND cc_state = 'TN' AND inv_item_sk IN ('15746', '11656', '6211', '11858') AND i_item_sk IN ('2579', '2638', '2347', '3924', '3976', '4905') AND s_store_sk IN ('8', '11', '6') GROUP BY cc_state, i_category;
SELECT c.c_customer_id AS customer_id, CONCAT(c.c_last_name, ', ', c.c_first_name) AS customer_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, hd.hd_income_band_sk, hd.hd_buy_potential, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(cr.cr_net_loss) AS total_net_loss FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_returning_customer_sk WHERE c.c_first_sales_date_sk IN (2452027, 2451966, 2450163) AND cr.cr_returned_time_sk IN (66035, 17738, 73881) AND cr.cr_return_quantity = 49 GROUP BY customer_id, customer_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, hd.hd_income_band_sk, hd.hd_buy_potential ORDER BY total_returns DESC, total_returned_quantity DESC LIMIT 100;
SELECT ca_state, sm_type, EXTRACT(YEAR FROM d_date) AS year, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk JOIN customer_address ON cs_ship_addr_sk = ca_address_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk WHERE ca_country = 'United States' AND sm_type IN ('TWO DAY', 'EXPRESS', 'OVERNIGHT') AND d_year = EXTRACT(YEAR FROM CURRENT_DATE) GROUP BY ca_state, sm_type, year ORDER BY total_net_profit DESC, ca_state, sm_type;
SELECT cp.cp_department, ca.ca_city, ca.ca_state, COUNT(wr.wr_item_sk) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_including_tax, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_return_ship_cost) AS total_shipping_cost, SUM(wr.wr_net_loss) AS total_net_loss FROM catalog_page cp JOIN web_returns wr ON cp.cp_catalog_page_sk = wr.wr_web_page_sk JOIN customer_address ca ON wr.wr_returning_addr_sk = ca.ca_address_sk WHERE cp.cp_catalog_page_id IN ('AAAAAAAAPOGAAAAA', 'AAAAAAAABBCAAAAA', 'AAAAAAAAGGCAAAAA') AND ca.ca_location_type IN ('single family', 'apartment', 'condo') GROUP BY cp.cp_department, ca.ca_city, ca.ca_state ORDER BY total_net_loss DESC, average_return_amount DESC LIMIT 100;
SELECT cp.cp_department, COUNT(DISTINCT cs.cs_item_sk) AS distinct_items_sold, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_ext_sales_price) AS total_sales, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_ext_discount_amt) AS total_discount_amount FROM catalog_sales cs JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk WHERE cs.cs_sold_date_sk BETWEEN cp.cp_start_date_sk AND cp.cp_end_date_sk GROUP BY cp.cp_department ORDER BY total_sales DESC;
SELECT s.s_store_name, i.i_category, p.p_channel_details, SUM(cs.cs_net_paid_inc_ship) AS total_sales, SUM(cs.cs_net_profit) AS total_profit, COUNT(DISTINCT cs.cs_order_number) AS total_orders, AVG(cs.cs_quantity) AS average_quantity, SUM(wr.wr_net_loss) AS total_net_loss, COUNT(DISTINCT wr.wr_order_number) AS total_returns, r.r_reason_desc FROM store s JOIN catalog_sales cs ON s.s_store_sk = cs.cs_warehouse_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk LEFT JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number LEFT JOIN reason r ON wr.wr_reason_sk = r.r_reason_sk WHERE s.s_country = 'United States' AND ( s.s_store_sk = '8' OR s.s_store_sk = '1' ) AND ( cs.cs_net_paid_inc_ship IN ('6377.67', '3521.76', '158.56', '2257.47', '739.93', '7973.92') ) AND ( r.r_reason_sk IN ('17', '4', '20', '18', '31') OR r.r_reason_sk IS NULL ) AND i.i_class = 'cooking' GROUP BY s.s_store_name, i.i_category, p.p_channel_details, r.r_reason_desc ORDER BY total_sales DESC, total_profit DESC;
SELECT ca_state, ca_country, w_state, w_country, SUM(sr_return_quantity) AS total_returned_quantity, AVG(sr_return_amt) AS average_return_amount, SUM(sr_fee) AS total_fees, COUNT(DISTINCT sr_customer_sk) AS unique_customers_returning, COUNT(DISTINCT sr_ticket_number) AS total_return_transactions FROM store_returns JOIN customer_address ON store_returns.sr_addr_sk = customer_address.ca_address_sk JOIN warehouse ON store_returns.sr_store_sk = warehouse.w_warehouse_sk WHERE customer_address.ca_gmt_offset IN (-6.00, -10.00, -8.00, -9.00, -7.00) AND warehouse.w_zip = '35709' AND store_returns.sr_addr_sk = '47239' GROUP BY ca_state, ca_country, w_state, w_country ORDER BY ca_state, ca_country;
SELECT cc_state, r_reason_desc, SUM(inv_quantity_on_hand) AS total_inventory, AVG(c_birth_year) AS average_customer_birth_year, COUNT(DISTINCT c_customer_sk) AS unique_customers, COUNT(DISTINCT web_site_sk) AS web_sites_operating FROM inventory JOIN reason ON (r_reason_sk = inv_quantity_on_hand) JOIN call_center ON (cc_division = inv_warehouse_sk) JOIN customer ON (c_current_addr_sk = cc_open_date_sk) JOIN web_site ON (web_state = cc_state) WHERE inv_date_sk = 2450815 AND c_customer_id IN ('AAAAAAAACHMAAAAA', 'AAAAAAAANPEAAAAA') AND (cc_rec_end_date IS NULL OR cc_rec_end_date > CURRENT_DATE) AND (web_rec_end_date IS NULL OR web_rec_end_date > CURRENT_DATE) GROUP BY cc_state, r_reason_desc ORDER BY total_inventory DESC, average_customer_birth_year;
