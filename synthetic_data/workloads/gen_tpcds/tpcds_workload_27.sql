SELECT ca_state, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT sr_customer_sk) AS unique_customers_returning, SUM(CASE WHEN p_channel_press = 'N' AND p_channel_catalog = 'N' THEN sr_return_amt ELSE 0 END) AS total_return_amount_no_press_no_catalog, wm.warehouse_count, sm.sm_count, ib.ib_count FROM store_returns sr JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN (SELECT w_state, COUNT(*) AS warehouse_count FROM warehouse GROUP BY w_state) wm ON ca.ca_state = wm.w_state JOIN (SELECT sm_carrier, COUNT(*) AS sm_count FROM ship_mode WHERE sm_carrier IN ('ALLIANCE', 'ZOUROS', 'UPS') GROUP BY sm_carrier) sm ON 1=1 JOIN (SELECT ib_lower_bound, COUNT(*) AS ib_count FROM income_band GROUP BY ib_lower_bound) ib ON 1=1 LEFT JOIN promotion p ON sr.sr_reason_sk = p.p_promo_sk WHERE sr.sr_reason_sk IN (19, 26, 34, 7, 29) AND ca.ca_street_name IN ('Johnson Spruce', '12th View', 'Dogwood 12th', '15th Third', 'Ninth Fourth', '1st 7th') AND sr_return_amt > 0 GROUP BY ca_state, wm.warehouse_count, sm.sm_count, ib.ib_count ORDER BY total_return_amount DESC LIMIT 100;
SELECT dd.d_year, dd.d_quarter_name, SUM(ws.ws_sales_price) AS total_sales, AVG(ws.ws_quantity) AS average_quantity, COUNT(DISTINCT ws.ws_order_number) AS order_count, SUM(CASE WHEN ca.ca_location_type = 'condo' THEN ws.ws_net_paid_inc_tax ELSE 0 END) AS condo_sales_tax, SUM(CASE WHEN ca.ca_location_type = 'single family' THEN ws.ws_net_paid_inc_tax ELSE 0 END) AS single_family_sales_tax, SUM(CASE WHEN ib.ib_income_band_sk = 17 THEN ws.ws_net_paid ELSE 0 END) AS band_17_net_paid, COUNT(DISTINCT CASE WHEN ca.ca_county IN ('Telfair County', 'Cherokee County') THEN ws.ws_bill_addr_sk ELSE NULL END) AS unique_addresses_in_counties, COUNT(DISTINCT CASE WHEN p.p_discount_active = '1' THEN ws.ws_promo_sk ELSE NULL END) AS active_promo_count FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON ws.ws_bill_addr_sk = ca.ca_address_sk JOIN income_band ib ON ws.ws_bill_cdemo_sk = ib.ib_income_band_sk LEFT JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk WHERE dd.d_year = 2023 AND ib.ib_lower_bound >= 0 AND (ca.ca_location_type IN ('condo', 'single family') OR ca.ca_county IN ('Telfair County', 'Cherokee County')) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT cc.cc_city AS call_center_city, cc.cc_state AS call_center_state, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws.ws_order_number) AS number_of_orders, SUM(inv.inv_quantity_on_hand) AS total_inventory_on_hand, SUM(ws.ws_net_profit) AS total_net_profit FROM call_center cc JOIN web_sales ws ON cc.cc_call_center_sk = ws.ws_warehouse_sk JOIN inventory inv ON ws.ws_item_sk = inv.inv_item_sk AND ws.ws_sold_date_sk = inv.inv_date_sk JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk WHERE cc.cc_mkt_id IN ('6', '2', '5') AND cc.cc_suite_number IN ('Suite 70', 'Suite 0', 'Suite U') AND inv.inv_quantity_on_hand IN (645, 327) AND td.t_time_sk IN (247, 1615, 1813, 4029, 3389) AND td.t_hour = 1 GROUP BY call_center_city, call_center_state ORDER BY total_net_profit DESC, call_center_city, call_center_state;
SELECT c.c_preferred_cust_flag AS customer_pref_status, r.r_reason_desc AS return_reason, ws.web_manager AS website_manager, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN customer c ON cr.cr_refunded_customer_sk = c.c_customer_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN web_site ws ON cr.cr_call_center_sk = ws.web_site_sk WHERE c.c_current_addr_sk IN ('17516', '36852', '18429') AND ws.web_manager IN ('Jason Silva', 'Tommy Jones', 'Moses Hicks') AND r.r_reason_desc IN ('reason 23', 'Parts missing') GROUP BY customer_pref_status, return_reason, website_manager ORDER BY total_return_amount DESC, total_returns DESC;
SELECT s.s_division_name, cc.cc_class, dd.d_year, COUNT(DISTINCT s.s_store_sk) AS num_stores, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_net_paid) AS average_sales_per_store, MAX(ss.ss_net_paid) AS max_sales_per_store, MIN(ss.ss_net_paid) AS min_sales_per_store FROM store_sales ss INNER JOIN store s ON ss.ss_store_sk = s.s_store_sk INNER JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk INNER JOIN call_center cc ON s.s_market_id = cc.cc_mkt_id WHERE cc.cc_class IN ('small', 'medium', 'large') AND dd.d_year = 2022 GROUP BY s.s_division_name, cc.cc_class, dd.d_year ORDER BY s.s_division_name, cc.cc_class, total_sales DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT ss.ss_customer_sk) AS num_customers, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_net_profit, SUM(sr.sr_return_quantity) AS total_return_quantity, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_fee) AS avg_return_fee, COUNT(DISTINCT wp.wp_web_page_sk) AS num_visited_pages, SUM(wp.wp_link_count) AS total_link_count FROM income_band ib LEFT JOIN store_sales ss ON ib.ib_income_band_sk = ss.ss_cdemo_sk LEFT JOIN store_returns sr ON ss.ss_customer_sk = sr.sr_customer_sk AND sr.sr_reason_sk IN (21, 2, 14, 30) LEFT JOIN web_page wp ON ss.ss_customer_sk = wp.wp_customer_sk AND wp.wp_type IN ('protected', 'ad') WHERE ss.ss_sold_date_sk IN (2451298, 2450872, 2451390, 2451634) AND ib.ib_upper_bound IN (30000, 130000, 90000) AND ib.ib_income_band_sk IN (17, 6) GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ib.ib_income_band_sk;
SELECT p.p_promo_id, p.p_promo_name, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_tickets, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_ext_discount_amt) AS avg_ticket_discount, SUM(ss.ss_net_paid) AS total_net_sales, SUM(ss.ss_net_profit) AS total_net_profit, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, CASE WHEN hd.hd_buy_potential = '0-500' THEN 'Low' WHEN hd.hd_buy_potential = '501-1000' THEN 'Below Average' WHEN hd.hd_buy_potential = '1001-5000' THEN 'Average' WHEN hd.hd_buy_potential = '5001-10000' THEN 'Above Average' WHEN hd.hd_buy_potential = '>10000' THEN 'High' ELSE 'Unknown' END AS avg_buy_potential, COUNT(DISTINCT hd.hd_income_band_sk) AS distinct_income_bands FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk LEFT JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk GROUP BY p.p_promo_id, p.p_promo_name, hd.hd_buy_potential ORDER BY total_net_sales DESC, total_net_profit DESC;
SELECT s.s_store_id, s.s_zip, cs.cs_sold_date_sk, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_ext_sales_price) AS total_sales, SUM(cs.cs_net_paid) AS net_paid, SUM(cs.cs_net_paid_inc_tax) AS net_paid_inc_tax, SUM(cs.cs_net_profit) AS net_profit, COUNT(DISTINCT cs.cs_order_number) AS total_orders, AVG(sr.sr_return_amt) AS avg_return_amt, SUM(sr.sr_return_quantity) AS total_return_quantity, SUM(sr.sr_net_loss) AS net_loss FROM catalog_sales cs JOIN store s ON cs.cs_ship_customer_sk = s.s_store_sk LEFT JOIN store_returns sr ON cs.cs_item_sk = sr.sr_item_sk AND cs.cs_order_number = sr.sr_ticket_number WHERE s.s_store_id = 'AAAAAAAACAAAAAAA' AND s.s_zip = '35709' GROUP BY s.s_store_id, s.s_zip, cs.cs_sold_date_sk ORDER BY cs.cs_sold_date_sk DESC;
