SELECT d_year, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT sr_customer_sk) AS unique_customers_returning, COUNT(DISTINCT p_promo_sk) AS distinct_promotions, SUM(inv_quantity_on_hand) AS total_inventory_quantity, COUNT(DISTINCT cp_catalog_page_sk) AS num_catalog_pages FROM store_returns JOIN date_dim ON store_returns.sr_returned_date_sk = date_dim.d_date_sk JOIN promotion ON store_returns.sr_item_sk = promotion.p_item_sk JOIN inventory ON store_returns.sr_item_sk = inventory.inv_item_sk JOIN catalog_page ON promotion.p_item_sk = catalog_page.cp_catalog_page_sk WHERE d_fy_year IN ('1900', '1901', '1902', '1904', '1910', '1912') AND p_channel_tv = 'N' AND sr_return_time_sk IN ('42714', '34148', '59678') AND inv_item_sk IN ('9572', '12640', '8512', '13724') AND inv_warehouse_sk IN ('1', '2') GROUP BY d_year ORDER BY d_year;
SELECT cp.cp_department, EXTRACT(YEAR FROM TO_DATE(cp.cp_end_date_sk::varchar, 'YYYYMMDD')) AS year_ended, hd.hd_income_band_sk, COUNT(DISTINCT sr.sr_customer_sk) AS num_customers_returned, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_net_loss) AS average_net_loss, SUM(ss.ss_quantity) AS total_sold_quantity, SUM(ss.ss_net_profit) AS total_net_profit, AVG(c.c_birth_year) AS average_customer_birth_year FROM catalog_page cp JOIN store_returns sr ON cp.cp_catalog_page_sk = sr.sr_reason_sk JOIN store_sales ss ON sr.sr_item_sk = ss.ss_item_sk AND sr.sr_ticket_number = ss.ss_ticket_number JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE cp.cp_end_date_sk IN ('2451114', '2451084', '2451479') AND hd.hd_dep_count IN (3, 6, 7) AND c.c_birth_month IN (2, 6, 12) GROUP BY cp.cp_department, year_ended, hd.hd_income_band_sk ORDER BY total_net_profit DESC, average_net_loss, num_customers_returned;
SELECT cp_department, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_profit) AS total_net_profit, COUNT(DISTINCT ss_ticket_number) AS total_store_sales_tickets, SUM(ss_quantity) AS total_store_quantity_sold, AVG(ss_sales_price) AS average_store_sales_price, SUM(ss_net_paid_inc_tax) AS total_store_net_paid_inc_tax FROM catalog_sales JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk JOIN store_sales ON catalog_sales.cs_item_sk = store_sales.ss_item_sk JOIN store ON store_sales.ss_store_sk = s_store_sk JOIN customer ON store_sales.ss_customer_sk = c_customer_sk WHERE c_birth_country IN ('MOLDOVA, REPUBLIC OF', 'TOGO', 'IRAQ', 'BURUNDI') AND cp_department IS NOT NULL AND cp_start_date_sk IS NOT NULL AND cp_end_date_sk IS NOT NULL AND (cp_end_date_sk - cp_start_date_sk) > 0 AND s_market_id IS NOT NULL GROUP BY cp_department ORDER BY total_net_profit DESC, total_orders DESC LIMIT 10;
SELECT c.c_birth_country, COUNT(DISTINCT c.c_customer_sk) AS num_customers, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_net_paid_inc_tax) AS avg_net_paid_inc_tax, SUM(CASE WHEN ss.ss_net_paid_inc_tax > 1000 THEN ss.ss_quantity ELSE 0 END) AS quantity_sold_above_1000, COUNT(DISTINCT p.p_promo_sk) AS num_promotions, SUM(p.p_cost) AS total_promotion_cost, w.w_state, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft FROM customer c JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN warehouse w ON w.w_zip = c.c_current_addr_sk::character varying WHERE c.c_birth_country IN ('THAILAND', 'ITALY') AND ss.ss_net_paid_inc_tax::text IN ('307.45', '859.21', '1169.72', '3293.51', '222.26') GROUP BY c.c_birth_country, w.w_state ORDER BY total_quantity_sold DESC;
SELECT cd.cd_gender, cd.cd_education_status, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_profit, p.p_channel_details, s.s_store_name FROM store_sales ss JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk WHERE p.p_channel_details IN ('Books expect international, big interests', 'Scenes might make high') AND c.c_last_name IN ('Carter', 'Babcock', 'Hoag') AND s.s_county IN ('Nolan County', 'Winchester city', 'Elliott County', 'Minidoka County') AND ss.ss_sold_date_sk >= 2450460 GROUP BY cd.cd_gender, cd.cd_education_status, p.p_channel_details, s.s_store_name ORDER BY total_sales DESC, total_profit DESC;
SELECT cp.cp_department, hd.hd_buy_potential, w.w_state, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS unique_tickets, SUM(ss.ss_net_paid_inc_tax) AS total_revenue_inc_tax, SUM(ss.ss_net_profit) AS total_net_profit FROM catalog_page cp JOIN store_sales ss ON cp.cp_catalog_page_sk = ss.ss_sold_date_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN warehouse w ON ss.ss_addr_sk = w.w_warehouse_sk WHERE cp.cp_end_date_sk IN ('2451509', '2451817', '2451635') AND hd.hd_vehicle_count IN (0, 1, 2, 3, 4) AND w.w_state = 'TN' AND ss.ss_ticket_number IN (3518, 3677) GROUP BY cp.cp_department, hd.hd_buy_potential, w.w_state ORDER BY total_net_profit DESC;
SELECT cc_state, COUNT(cc_call_center_sk) AS total_call_centers, AVG(cc_employees) AS avg_employees, SUM(cc_sq_ft) AS total_sq_ft, COUNT(DISTINCT p_promo_sk) AS total_promotions, AVG(p_cost) AS avg_promotion_cost, AVG(hd_income_band_sk) AS avg_income_band, AVG(hd_vehicle_count) AS avg_vehicle_count, AVG(cc_tax_percentage) AS avg_tax_percentage, SUM(CASE WHEN p_channel_email = '1' THEN 1 ELSE 0 END) AS total_email_promotions, SUM(CASE WHEN p_channel_tv = '1' THEN 1 ELSE 0 END) AS total_tv_promotions, SUM(CASE WHEN p_channel_radio = '1' THEN 1 ELSE 0 END) AS total_radio_promotions FROM call_center LEFT JOIN promotion ON cc_mkt_id = p_promo_sk LEFT JOIN customer_address ON cc_county = ca_county LEFT JOIN household_demographics ON ca_address_sk = hd_demo_sk WHERE cc_rec_start_date <= CURRENT_DATE AND (cc_rec_end_date IS NULL OR cc_rec_end_date > CURRENT_DATE) AND ca_county IN ('Cowlitz County', 'Bay County', 'Loudon County', 'Santa Rosa County', 'Lebanon County') GROUP BY cc_state ORDER BY total_call_centers DESC;
SELECT cr_returned_date_sk AS return_date, SUM(cr_return_quantity) AS total_catalog_return_quantity, SUM(cr_return_amount) AS total_catalog_return_amount, AVG(cr_return_amount) AS avg_catalog_return_amount, COUNT(DISTINCT cr_refunded_customer_sk) AS unique_catalog_customers, SUM(sr_return_quantity) AS total_store_return_quantity, SUM(sr_return_amt) AS total_store_return_amount, AVG(sr_return_amt) AS avg_store_return_amount, COUNT(DISTINCT sr_customer_sk) AS unique_store_customers, SUM(wr_return_quantity) AS total_web_return_quantity, SUM(wr_return_amt) AS total_web_return_amount, AVG(wr_return_amt) AS avg_web_return_amount, COUNT(DISTINCT wr_returning_customer_sk) AS unique_web_customers FROM catalog_returns JOIN store_returns ON cr_item_sk = sr_item_sk AND cr_order_number = sr_ticket_number JOIN web_returns ON cr_item_sk = wr_item_sk AND cr_order_number = wr_order_number WHERE cr_returned_date_sk IS NOT NULL AND sr_returned_date_sk IS NOT NULL AND wr_returned_date_sk IS NOT NULL GROUP BY cr_returned_date_sk ORDER BY cr_returned_date_sk;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_class, ca.ca_street_type, COUNT(distinct ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_net_paid, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(distinct ss.ss_customer_sk) AS unique_customers_served FROM store_sales ss JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk JOIN call_center cc ON cc.cc_class IN ('small', 'medium', 'large') LEFT JOIN reason r ON r.r_reason_desc = 'reason 31' WHERE ca.ca_street_type IN ('Pkwy', 'Court') AND r.r_reason_sk IS NULL GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_class, ca.ca_street_type ORDER BY total_net_profit DESC, total_sales_transactions DESC;
SELECT cc.cc_name, i.i_category, COUNT(i.i_item_sk) AS total_items_sold, SUM(i.i_current_price) AS total_sales, AVG(i.i_wholesale_cost) AS avg_wholesale_cost FROM call_center cc JOIN item i ON cc.cc_call_center_sk = i.i_manufact_id JOIN ship_mode sm ON sm.sm_ship_mode_sk = i.i_item_sk WHERE cc.cc_rec_end_date < '2000-12-31' AND i.i_category_id IN ('4', '5', '1', '3') AND sm.sm_code = 'AIR' GROUP BY cc.cc_name, i.i_category ORDER BY cc.cc_name, i.i_category;
SELECT d.d_holiday AS "Is Holiday", d.d_day_name AS "Day of Week", AVG(cc.cc_employees) AS "Average Number of Employees", AVG(w.w_warehouse_sq_ft) AS "Average Warehouse Square Feet", COUNT(DISTINCT cc.cc_call_center_sk) AS "Number of Call Centers", COUNT(DISTINCT w.w_warehouse_sk) AS "Number of Warehouses" FROM call_center cc JOIN date_dim d ON cc.cc_open_date_sk = d.d_date_sk OR cc.cc_closed_date_sk = d.d_date_sk JOIN warehouse w ON cc.cc_state = w.w_state GROUP BY d.d_holiday, d.d_day_name ORDER BY d.d_holiday DESC, d.d_day_name;
SELECT s_store_name, sm_type, COUNT(DISTINCT ss_ticket_number) AS total_sales_transactions, SUM(ss_quantity) AS total_units_sold, SUM(ss_net_paid) AS total_revenue, AVG(ss_net_profit) AS average_profit_per_sale, SUM(wr_return_quantity) AS total_units_returned, SUM(wr_net_loss) AS total_loss_from_returns, (SUM(ss_net_paid) - SUM(wr_net_loss)) AS net_revenue_after_returns FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN ship_mode sm ON ss.ss_store_sk = sm.sm_ship_mode_sk LEFT JOIN web_returns wr ON ss.ss_item_sk = wr.wr_item_sk AND ss.ss_ticket_number = wr.wr_order_number WHERE ss_addr_sk IN ('39848', '37282') AND s_store_sk IN (5, 8, 1, 3, 6, 12) AND wr_returning_hdemo_sk IN (772, 5914) AND sm_ship_mode_sk IN (19, 20, 9) AND sm_carrier IN ('USPS', 'DHL', 'UPS') GROUP BY s_store_name, sm_type ORDER BY total_sales_transactions DESC;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, wsit.web_name, wsit.web_manager, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_net_profit) AS average_net_profit_per_sale, MAX(ws.ws_net_profit) AS max_net_profit_single_sale, MIN(ws.ws_net_profit) AS min_net_profit_single_sale FROM web_sales ws JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN web_site wsit ON ws.ws_web_site_sk = wsit.web_site_sk WHERE cd.cd_credit_rating IN ('Low Risk', 'High Risk', 'Good') AND wsit.web_country = 'United States' AND ws.ws_sold_date_sk BETWEEN 2000000 AND 2020000 GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, wsit.web_name, wsit.web_manager ORDER BY total_net_profit DESC, cd.cd_gender, cd.cd_credit_rating;
SELECT d.d_year, d.d_quarter_name, cc.cc_city, cc.cc_state, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt) AS avg_return_amount, COUNT(DISTINCT wr.wr_refunded_customer_sk) AS unique_customers, COUNT(DISTINCT wr.wr_order_number) AS total_orders_returned FROM web_returns wr JOIN date_dim d ON wr.wr_returned_date_sk = d.d_date_sk JOIN time_dim t ON wr.wr_returned_time_sk = t.t_time_sk JOIN call_center cc ON cc.cc_call_center_sk = wr.wr_returning_customer_sk WHERE d.d_year = 2023 AND t.t_sub_shift = 'night' AND cc.cc_city = 'Midway' AND wr.wr_returned_time_sk IN ('76162', '72121', '59518') GROUP BY d.d_year, d.d_quarter_name, cc.cc_city, cc.cc_state ORDER BY d.d_year, d.d_quarter_name, cc.cc_city, cc.cc_state;
SELECT s_state, EXTRACT(YEAR FROM s_rec_start_date) AS year_opened, COUNT(*) AS store_count, SUM(ss_net_profit) AS total_net_profit, AVG(hd_dep_count) AS avg_dependency_count, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_amt) AS avg_return_amount, SUM(sr_net_loss) AS total_net_loss FROM store JOIN store_sales ON s_store_sk = ss_store_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN store_returns ON s_store_sk = sr_store_sk WHERE s_state IN ('CA', 'TX', 'FL') AND s_closed_date_sk IS NULL AND ss_sold_date_sk BETWEEN 2451189 AND 2451489 AND sr_return_tax > 0 AND hd_buy_potential IN ('>10000', '5001-10000', '1001-5000') GROUP BY s_state, year_opened ORDER BY total_net_profit DESC, total_return_amount DESC;
SELECT ca.ca_state, ca.ca_city, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit, p.p_promo_name, SUM(CASE WHEN p.p_channel_press = 'N' THEN cs.cs_net_paid ELSE 0 END) AS net_paid_no_press_promo, SUM(cs.cs_coupon_amt) AS total_coupon_amount FROM customer_address ca JOIN catalog_sales cs ON ca.ca_address_sk = cs.cs_ship_addr_sk LEFT JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE ca.ca_address_sk IN (957, 1773) AND cs.cs_coupon_amt IN (278.88, 333.46, 10.60) AND p.p_channel_press = 'N' AND p.p_start_date_sk IN (2450607, 2450356, 2450342, 2450745) GROUP BY ca.ca_state, ca.ca_city, p.p_promo_name ORDER BY total_net_profit DESC, total_quantity_sold DESC;
