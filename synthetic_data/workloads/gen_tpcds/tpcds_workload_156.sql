SELECT d.d_year, d.d_quarter_name, sum(ws_net_paid) AS total_sales, avg(ws_quantity) AS average_quantity_sold, count(distinct ws_order_number) AS total_orders, count(distinct ws_item_sk) AS unique_items_sold, sum(ws_net_profit) AS total_profit FROM web_sales ws INNER JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk INNER JOIN item i ON ws.ws_item_sk = i.i_item_sk INNER JOIN call_center cc ON cc.cc_division_name LIKE 'pri%' AND cc.cc_country = 'United States' WHERE d.d_year = 2000 AND i.i_rec_start_date BETWEEN '1999-10-28' AND '2001-10-27' AND i.i_manufact = 'ationationable' AND ws.ws_bill_cdemo_sk IN ('371058', '1268921') GROUP BY d.d_year, d.d_quarter_name ORDER BY total_sales DESC, d.d_quarter_name;
SELECT d_year, i_category, COUNT(DISTINCT ss_ticket_number) AS total_sales_transactions, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, SUM(ss_net_profit) AS total_net_profit, SUM(cr_return_amount) AS total_return_amount, COUNT(DISTINCT cr_order_number) AS total_return_transactions, (SUM(ss_net_profit) - SUM(cr_net_loss)) AS net_profit_after_returns FROM store_sales JOIN item ON store_sales.ss_item_sk = item.i_item_sk JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk LEFT JOIN catalog_returns ON store_sales.ss_item_sk = catalog_returns.cr_item_sk AND store_sales.ss_ticket_number = catalog_returns.cr_order_number WHERE store_sales.ss_addr_sk = '19253' AND d_year = 1999 GROUP BY d_year, i_category ORDER BY net_profit_after_returns DESC LIMIT 10;
SELECT s_store_name AS store_name, s_state AS store_state, CONCAT(s_city, ', ', s_state) AS store_location, d_year AS sales_year, d_quarter_name AS sales_quarter, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_sales, AVG(ss_net_paid) AS average_sales_per_transaction, SUM(ss_net_paid_inc_tax) AS total_sales_including_tax, SUM(ss_ext_tax) AS total_tax_collected, COUNT(DISTINCT ss_customer_sk) AS unique_customers, COUNT(DISTINCT ss_ticket_number) AS total_transactions, SUM(wr_return_amt) AS total_returns, SUM(wr_fee) AS total_return_fees, AVG(wr_return_ship_cost) AS average_return_shipping_cost, COUNT(DISTINCT wr_refunded_customer_sk) AS unique_customers_returned, COUNT(DISTINCT wr_order_number) AS total_return_transactions, SUM(wr_net_loss) AS total_net_loss_from_returns, r_reason_desc AS most_common_return_reason FROM store_sales JOIN store ON ss_store_sk = s_store_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk LEFT JOIN web_returns ON ss_item_sk = wr_item_sk AND ss_ticket_number = wr_order_number LEFT JOIN reason ON wr_reason_sk = r_reason_sk WHERE s_state IN ('NY', 'CA') AND d_year = 2023 GROUP BY s_store_name, s_state, s_city, d_year, d_quarter_name, r_reason_desc ORDER BY total_sales DESC, total_quantity_sold DESC LIMIT 10;
SELECT s.s_state, w.w_country, p.p_promo_name, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN warehouse w ON s.s_state = w.w_state LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk AND p.p_channel_catalog = 'N' GROUP BY s.s_state, w.w_country, p.p_promo_name ORDER BY s.s_state, w.w_country, p.p_promo_name;
SELECT ca.ca_city, ca.ca_state, ca.ca_location_type, COUNT(*) AS address_count, AVG(ca.ca_gmt_offset) AS average_gmt_offset, MAX(r.r_reason_sk) AS max_reason_sk, t.t_shift, SUM(CASE WHEN t.t_am_pm = 'AM' THEN 1 ELSE 0 END) AS am_shifts, SUM(CASE WHEN t.t_am_pm = 'PM' THEN 1 ELSE 0 END) AS pm_shifts FROM customer_address ca JOIN reason r ON ca.ca_address_sk = r.r_reason_sk JOIN time_dim t ON t.t_time_sk = r.r_reason_sk WHERE ca.ca_location_type IN ('single family', 'apartment', 'condo') AND t.t_shift = 'third' AND r.r_reason_id IN ('AAAAAAAAOAAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAADCAAAAAA') GROUP BY ca.ca_city, ca.ca_state, ca.ca_location_type, t.t_shift ORDER BY ca.ca_city, ca.ca_state, ca.ca_location_type, t.t_shift;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(cc.cc_employees) AS total_employees, AVG(cc.cc_sq_ft) AS average_square_footage, COUNT(DISTINCT c.c_customer_sk) AS number_of_customers, COUNT(DISTINCT p.p_promo_sk) AS number_of_promotions, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS preferred_customers_count, AVG(CASE WHEN p.p_discount_active = 'Y' THEN p.p_cost ELSE NULL END) AS average_active_discount_cost, MAX(ib.ib_upper_bound) AS max_income_band_upper_bound FROM call_center cc JOIN customer c ON (cc.cc_call_center_sk = c.c_current_addr_sk) JOIN promotion p ON (cc.cc_mkt_id = p.p_item_sk) LEFT JOIN income_band ib ON (c.c_current_hdemo_sk = ib.ib_income_band_sk) WHERE cc.cc_mkt_class IN ('Silly particles could pro', 'Dealers make most historical, direct students') AND cc.cc_mkt_id IN ('6', '2', '5') AND p.p_channel_email = 'N' GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY number_of_customers DESC, total_employees DESC;
SELECT dd.d_year, dd.d_quarter_name, ib.ib_lower_bound, ib.ib_upper_bound, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk WHERE wp.wp_type = 'welcome' AND wp.wp_autogen_flag = 'N' AND dd.d_quarter_seq IN (SELECT DISTINCT d_quarter_seq FROM date_dim WHERE d_year = 2023) AND td.t_hour BETWEEN 8 AND 20 GROUP BY dd.d_year, dd.d_quarter_name, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY dd.d_year, dd.d_quarter_name, ib.ib_lower_bound, ib.ib_upper_bound;
SELECT ca_state, EXTRACT(YEAR FROM d.d_date) AS sales_year, COUNT(DISTINCT c.c_customer_sk) AS num_customers, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS avg_sales_price, SUM(ss_net_profit) AS total_net_profit, SUM(sr_return_amt_inc_tax) AS total_returns, AVG(sr_fee) AS avg_return_fee FROM store_sales ss JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE ca.ca_state IN ('IL', 'KY', 'OR') AND EXTRACT(YEAR FROM d.d_date) IN (2001, 2002) AND ss.ss_sales_price BETWEEN 100 AND 150 AND sr.sr_return_amt_inc_tax > 0 GROUP BY ca_state, sales_year ORDER BY sales_year DESC, ca_state;
SELECT ca.ca_state, ib.ib_lower_bound, ib.ib_upper_bound, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(sr.sr_return_ship_cost) AS total_return_shipping_cost, COUNT(sr.sr_return_amt) AS num_of_returns FROM store_returns sr JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN income_band ib ON sr.sr_hdemo_sk = ib.ib_income_band_sk JOIN web_site ws ON sr.sr_store_sk = ws.web_site_sk WHERE ws.web_market_manager IN ('Gerald Craft', 'Donald Mckinney', 'Jeffrey Campbell', 'Eldon Snow', 'Keith Frazier', 'Gilbert Chapman') GROUP BY ca.ca_state, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ca.ca_state, ib.ib_lower_bound;
SELECT i.i_category, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(inv.inv_quantity_on_hand) AS total_inventory_on_hand, SUM(ss.ss_net_profit) AS total_net_profit FROM item i JOIN store_sales ss ON i.i_item_sk = ss.ss_item_sk JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE i.i_wholesale_cost BETWEEN 4 AND 7 AND inv.inv_date_sk = '2450815' AND ss.ss_ext_sales_price < 5000 AND t.t_hour BETWEEN 0 AND 1 GROUP BY i.i_category ORDER BY total_net_profit DESC;
SELECT c.c_customer_id, AVG(ss.ss_net_profit) AS avg_net_profit, SUM(sr.sr_return_amt_inc_tax) AS total_returns, COUNT(DISTINCT ws.web_site_sk) AS number_of_websites, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid_inc_tax) AS total_sales_inc_tax FROM customer c LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk LEFT JOIN web_site ws ON ws.web_zip = c.c_current_addr_sk::character varying WHERE (ss.ss_hdemo_sk IN ('4776', '3144', '2508', '6460') OR c.c_current_hdemo_sk IN ('5414', '1065', '4963', '3942', '5655', '758')) AND (ws.web_zip IN ('35709', '31904') OR ws.web_rec_end_date IN ('1999-08-16', '2000-08-15', '2001-08-15')) GROUP BY c.c_customer_id ORDER BY avg_net_profit DESC, total_returns DESC, number_of_websites DESC, total_quantity_sold DESC, total_sales_inc_tax DESC;
SELECT c.c_birth_month, COUNT(DISTINCT ss.ss_customer_sk) AS total_customers_made_purchase, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_sales_price) AS avg_sale_amount, COUNT(DISTINCT cr.cr_returning_customer_sk) AS total_customers_made_return, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount FROM customer c LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_returning_customer_sk LEFT JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk AND cp.cp_catalog_page_number = 104 LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk LEFT JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk AND ws.web_open_date_sk = 2450628 WHERE c.c_birth_month IN (5, 6, 11) GROUP BY c.c_birth_month ORDER BY c.c_birth_month;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, COUNT(c.c_customer_sk) AS num_customers, SUM(CASE WHEN p.p_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS num_promotions_used, AVG(hd.hd_vehicle_count) AS avg_vehicles_per_household, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses_involved FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk LEFT JOIN promotion p ON p.p_start_date_sk <= c.c_first_sales_date_sk AND p.p_end_date_sk >= c.c_first_sales_date_sk JOIN warehouse w ON w.w_state = cd.cd_credit_rating WHERE cd.cd_purchase_estimate > 500 AND hd.hd_buy_potential IN ('5001-10000', '>10000') AND p.p_discount_active = 'Y' GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating ORDER BY avg_purchase_estimate DESC, num_customers DESC LIMIT 100;
SELECT ws.web_manager, ws.web_class, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_return_transactions, SUM(cr.cr_return_amt_inc_tax) AS total_catalog_return_amount_inc_tax, COUNT(DISTINCT p.p_promo_sk) AS total_promotions, SUM(p.p_cost) AS total_promotion_cost FROM web_site ws LEFT JOIN store_returns sr ON ws.web_site_sk = sr.sr_store_sk LEFT JOIN catalog_returns cr ON ws.web_site_sk = cr.cr_catalog_page_sk LEFT JOIN promotion p ON cr.cr_item_sk = p.p_item_sk AND cr.cr_returned_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk WHERE ws.web_manager = 'Jimmy Pope' AND (ws.web_zip = '35709' OR ws.web_zip = '31904') GROUP BY ws.web_manager, ws.web_class ORDER BY total_return_amount_inc_tax DESC, total_catalog_return_amount_inc_tax DESC;
SELECT w_state, p_promo_id, p_discount_active, COUNT(DISTINCT cr_order_number) AS total_returns, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_quantity) AS total_returned_quantity, COUNT(DISTINCT sr_ticket_number) AS total_store_returns, SUM(sr_return_amt) AS total_store_return_amount, AVG(sr_return_amt) AS avg_store_return_amount, SUM(sr_return_quantity) AS total_store_returned_quantity FROM catalog_returns JOIN warehouse ON cr_warehouse_sk = w_warehouse_sk JOIN promotion ON cr_catalog_page_sk = p_promo_sk JOIN store_returns ON cr_item_sk = sr_item_sk AND cr_order_number = sr_ticket_number WHERE w_state = 'TN' AND p_promo_id = 'AAAAAAAAMKAAAAAA' AND p_discount_active = 'N' GROUP BY w_state, p_promo_id, p_discount_active ORDER BY total_return_amount DESC;
SELECT sm.sm_type, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_wholesale_cost) AS avg_wholesale_cost, AVG(ws.ws_sales_price) AS avg_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk WHERE w.w_zip = '35709' AND ws.ws_web_site_sk IN (30, 17, 4, 15, 14, 2) AND sm.sm_ship_mode_sk IN (4, 9, 13, 10, 8, 20) GROUP BY sm.sm_type ORDER BY total_net_profit DESC;
SELECT p.p_promo_id, p.p_promo_name, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_net_paid) AS total_revenue, SUM(cs.cs_ext_wholesale_cost) AS total_cost, SUM(cs.cs_net_profit) AS total_profit, AVG(cs.cs_ext_discount_amt) AS average_discount_amount FROM catalog_sales cs JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk GROUP BY p.p_promo_id, p.p_promo_name ORDER BY total_revenue DESC;
