SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, COUNT(c.c_customer_sk) AS num_customers, SUM(CASE WHEN p.p_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS num_promotions_used, AVG(hd.hd_vehicle_count) AS avg_vehicles_per_household, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses_involved FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk LEFT JOIN promotion p ON p.p_start_date_sk <= c.c_first_sales_date_sk AND p.p_end_date_sk >= c.c_first_sales_date_sk JOIN warehouse w ON w.w_state = cd.cd_credit_rating WHERE cd.cd_purchase_estimate > 500 AND hd.hd_buy_potential IN ('5001-10000', '>10000') AND p.p_discount_active = 'Y' GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating ORDER BY avg_purchase_estimate DESC, num_customers DESC LIMIT 100;
SELECT reason.r_reason_desc AS Return_Reason, COUNT(DISTINCT web_returns.wr_order_number) AS Total_Returns, SUM(web_returns.wr_return_amt) AS Total_Return_Amount, AVG(web_returns.wr_return_amt) AS Average_Return_Amount, promotion.p_promo_name AS Promotion_Name, COUNT(DISTINCT promotion.p_promo_sk) AS Total_Promotions_Affected, ship_mode.sm_type AS Shipping_Type, COUNT(DISTINCT ship_mode.sm_ship_mode_sk) AS Total_Shipping_Modes_Used FROM web_returns JOIN reason ON web_returns.wr_reason_sk = reason.r_reason_sk LEFT JOIN promotion ON web_returns.wr_item_sk = promotion.p_item_sk JOIN web_page ON web_returns.wr_web_page_sk = web_page.wp_web_page_sk JOIN ship_mode ON web_returns.wr_order_number = ship_mode.sm_ship_mode_sk WHERE web_returns.wr_return_amt > 0 AND reason.r_reason_desc IN ('No service location in my area', 'Did not like the warranty', 'Stopped working') AND web_page.wp_link_count BETWEEN 15 AND 24 GROUP BY Return_Reason, Promotion_Name, Shipping_Type ORDER BY Total_Returns DESC, Total_Return_Amount DESC;
SELECT hd.hd_demo_sk, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, COUNT(DISTINCT wr.wr_order_number) AS total_web_returns, SUM(sr.sr_return_amt) AS total_store_return_amount, AVG(sr.sr_return_amt) AS avg_store_return_amount, SUM(wr.wr_return_amt) AS total_web_return_amount, AVG(wr.wr_return_amt) AS avg_web_return_amount, SUM(CASE WHEN p.p_channel_radio = 'N' AND p.p_channel_demo = 'N' THEN p.p_cost ELSE 0 END) AS non_radio_demo_promo_cost, AVG(CASE WHEN p.p_channel_radio = 'N' AND p.p_channel_demo = 'N' THEN p.p_response_target ELSE NULL END) AS avg_non_radio_demo_response_target FROM household_demographics hd LEFT JOIN store_returns sr ON hd.hd_demo_sk = sr.sr_hdemo_sk LEFT JOIN web_returns wr ON (hd.hd_demo_sk = wr.wr_refunded_hdemo_sk OR hd.hd_demo_sk = wr.wr_returning_hdemo_sk) LEFT JOIN promotion p ON p.p_promo_sk = sr.sr_reason_sk WHERE hd.hd_demo_sk IN (560, 4858) AND (sr.sr_store_sk IN (8, 10) OR sr.sr_store_sk IS NULL) GROUP BY hd.hd_demo_sk ORDER BY hd.hd_demo_sk;
SELECT i.i_brand, i.i_category, sm.sm_type, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_refund_amount, AVG(cr.cr_return_amount) AS avg_refund_amount_per_return, SUM(cr.cr_return_quantity) AS total_returned_quantity FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN time_dim t ON cr.cr_returned_time_sk = t.t_time_sk WHERE t.t_am_pm = 'AM' GROUP BY i.i_brand, i.i_category, sm.sm_type ORDER BY total_refund_amount DESC, i.i_brand, i.i_category, sm.sm_type;
SELECT sm.sm_type AS shipping_type, COUNT(DISTINCT cr.cr_order_number) AS total_return_transactions, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, COUNT(DISTINCT wr.wr_order_number) AS total_web_return_transactions, SUM(wr.wr_return_amt_inc_tax) AS total_web_return_amount, AVG(wr.wr_return_amt) AS average_web_return_amount FROM ship_mode sm LEFT JOIN catalog_returns cr ON sm.sm_ship_mode_sk = cr.cr_ship_mode_sk LEFT JOIN web_returns wr ON cr.cr_catalog_page_sk = wr.wr_web_page_sk LEFT JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk WHERE wr.wr_refunded_customer_sk IN ('49270', '61504', '79520') OR ws.web_city IN ('Fairview', 'Midway') GROUP BY sm.sm_type ORDER BY total_return_amount DESC, total_web_return_amount DESC;
SELECT ca.ca_state AS customer_state, COUNT(DISTINCT ss.ss_ticket_number) AS total_transactions, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_ext_discount_amt) AS avg_discount_amount, SUM(CASE WHEN p.p_channel_email = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_email_promo, SUM(CASE WHEN p.p_channel_dmail = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_dmail_promo, SUM(CASE WHEN p.p_channel_catalog = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_catalog_promo, SUM(CASE WHEN p.p_channel_tv = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_tv_promo, SUM(CASE WHEN p.p_channel_radio = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_radio_promo, SUM(CASE WHEN p.p_channel_press = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_press_promo, SUM(CASE WHEN p.p_channel_event = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_event_promo, SUM(CASE WHEN p.p_channel_demo = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_demo_promo FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ca.ca_state IS NOT NULL AND ss.ss_net_paid > 0 AND (p.p_channel_email = 'Y' OR p.p_channel_dmail = 'Y' OR p.p_channel_catalog = 'Y' OR p.p_channel_tv = 'Y' OR p.p_channel_radio = 'Y' OR p.p_channel_press = 'Y' OR p.p_channel_event = 'Y' OR p.p_channel_demo = 'Y') GROUP BY ca.ca_state ORDER BY total_sales DESC;
SELECT i.i_category AS item_category, cc.cc_state AS call_center_state, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_sales_price) AS average_sales_price, AVG(ss.ss_ext_discount_amt) AS average_discount_amount FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN call_center cc ON cc.cc_call_center_sk = ss.ss_store_sk WHERE i.i_current_price BETWEEN 4.63 AND 18.31 AND ss.ss_sold_date_sk IS NOT NULL GROUP BY i.i_category, cc.cc_state ORDER BY total_sales DESC, item_category, call_center_state;
