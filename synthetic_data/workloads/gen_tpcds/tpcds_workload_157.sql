SELECT ca.ca_state AS state, CASE WHEN cc.cc_call_center_sk IS NOT NULL THEN 'Call Center' WHEN ws.web_site_sk IS NOT NULL THEN 'Web Site' WHEN st.s_store_sk IS NOT NULL THEN 'Store' ELSE 'Unknown' END AS return_channel, COUNT(*) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, AVG(cr.cr_return_tax) AS avg_return_tax, AVG(cr.cr_return_ship_cost) AS avg_return_ship_cost FROM catalog_returns cr LEFT JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk LEFT JOIN web_site ws ON cr.cr_call_center_sk = ws.web_site_sk LEFT JOIN store st ON cr.cr_call_center_sk = st.s_store_sk LEFT JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk GROUP BY ca.ca_state, CASE WHEN cc.cc_call_center_sk IS NOT NULL THEN 'Call Center' WHEN ws.web_site_sk IS NOT NULL THEN 'Web Site' WHEN st.s_store_sk IS NOT NULL THEN 'Store' ELSE 'Unknown' END ORDER BY state, return_channel;
SELECT i.i_category, COUNT(DISTINCT ss.ss_item_sk) AS item_count, SUM(ss.ss_net_paid) AS total_revenue, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT s.s_store_sk) AS store_count, COUNT(DISTINCT ws.web_site_sk) AS website_count FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN web_site ws ON s.s_market_id = ws.web_mkt_id LEFT JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE s.s_market_id = 8 AND (ws.web_rec_end_date IS NULL OR ws.web_rec_end_date > CURRENT_DATE) AND ss.ss_sold_date_sk BETWEEN 2450654 AND 2450705 AND s.s_state IN ('Leon', 'Holiday Hills', 'Waterloo', 'Pinecrest') GROUP BY i.i_category ORDER BY total_revenue DESC;
SELECT cc_state, COUNT(DISTINCT cc_call_center_sk) AS num_call_centers, AVG(cc_employees) AS avg_employees, SUM(cc_sq_ft) AS total_square_footage, ca.ca_state AS customer_state, COUNT(DISTINCT ca.ca_address_sk) AS num_customer_addresses, AVG(ca.ca_gmt_offset) AS avg_customer_gmt_offset, sm.sm_type AS ship_mode_type, COUNT(DISTINCT sm.sm_ship_mode_sk) AS num_ship_modes, MAX(sm.sm_contract) AS longest_ship_contract FROM call_center cc JOIN customer_address ca ON cc_state = ca.ca_state JOIN ship_mode sm ON TRUE WHERE cc_street_type = 'Way' AND ca.ca_gmt_offset IN ('-9.00', '-6.00', '-10.00', '-5.00', '-7.00') AND sm.sm_ship_mode_id = 'AAAAAAAAJAAAAAAA' GROUP BY cc_state, ca.ca_state, sm.sm_type ORDER BY cc_state, ca.ca_state, sm.sm_type;
SELECT cp.cp_department, hd.hd_income_band_sk, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_items, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_net_loss) AS total_net_loss, web.web_class, COUNT(DISTINCT web.web_site_sk) AS total_web_sites FROM catalog_page cp JOIN store_returns sr ON cp.cp_catalog_page_sk = sr.sr_item_sk JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk JOIN web_site web ON web.web_company_id = cp.cp_catalog_number WHERE cp.cp_start_date_sk IS NOT NULL AND cp.cp_end_date_sk IS NOT NULL AND sr.sr_returned_date_sk BETWEEN cp.cp_start_date_sk AND cp.cp_end_date_sk AND (sr.sr_reversed_charge = 63.95 OR sr.sr_reversed_charge = 41.39) GROUP BY cp.cp_department, hd.hd_income_band_sk, web.web_class ORDER BY total_returns DESC, total_net_loss DESC;
SELECT dd.d_year, dd.d_quarter_name, sm.sm_carrier, sm.sm_code, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_net_paid) AS total_revenue, AVG(cs.cs_net_profit) AS average_profit, SUM(cr.cr_return_quantity) AS total_quantity_returned, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_net_loss) AS average_net_loss, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT cr.cr_returning_customer_sk) AS total_returning_customers FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN income_band ib ON cs.cs_bill_cdemo_sk = ib.ib_income_band_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number AND cs.cs_item_sk = cr.cr_item_sk WHERE cs.cs_net_profit BETWEEN -140.39 AND 2770.24 AND cs.cs_ship_date_sk IN (2451009, 2450882, 2450900) AND sm.sm_carrier IN ('ORIENTAL', 'ZOUROS', 'ALLIANCE') AND sm.sm_code IN ('SURFACE', 'AIR', 'BIKE') AND ib.ib_upper_bound IN (140000, 130000, 30000) AND ib.ib_income_band_sk IN (4, 11, 1) AND ib.ib_lower_bound IN (160001, 100001, 170001) AND dd.d_date_id IN ('AAAAAAAAHBLNECAA', 'AAAAAAAAEDBOECAA', 'AAAAAAAADAKNECAA') AND dd.d_quarter_seq IN (21, 43, 22) AND dd.d_month_seq IN (135, 159, 125) AND dd.d_moy IN (4, 6, 7) AND cr.cr_order_number IN (3796, 710, 4775) AND cr.cr_return_tax IN (28.41, 24.46, 171.99) AND cr.cr_returning_customer_sk IN (14182, 22448, 94068) GROUP BY dd.d_year, dd.d_quarter_name, sm.sm_carrier, sm.sm_code, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_revenue DESC, average_profit DESC;
SELECT ssm.sm_code AS shipping_mode, AVG(ws.ws_ext_ship_cost) AS avg_shipping_cost, SUM(ws.ws_net_paid_inc_tax) AS total_net_sales, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, COUNT(DISTINCT ss.ss_ticket_number) AS total_store_sales_transactions, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns_transactions, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_returns_transactions, (SUM(ws.ws_net_paid_inc_tax) - SUM(sr.sr_return_amt_inc_tax) - SUM(cr.cr_return_amt_inc_tax)) AS net_revenue FROM ship_mode AS ssm LEFT JOIN web_sales AS ws ON ssm.sm_ship_mode_sk = ws.ws_ship_mode_sk LEFT JOIN store_sales AS ss ON ws.ws_item_sk = ss.ss_item_sk LEFT JOIN store_returns AS sr ON ss.ss_item_sk = sr.sr_item_sk AND ss.ss_customer_sk = sr.sr_customer_sk LEFT JOIN catalog_returns AS cr ON cr.cr_item_sk = ws.ws_item_sk AND cr.cr_returning_customer_sk = ws.ws_bill_customer_sk GROUP BY ssm.sm_code ORDER BY net_revenue DESC;
SELECT r.r_reason_desc AS return_reason, s.s_state AS store_state, SUM(cr.cr_net_loss) AS total_net_loss, COUNT(cr.cr_order_number) AS total_returns, SUM(cs.cs_sales_price) AS total_sales, AVG(cs.cs_wholesale_cost) AS average_wholesale_cost FROM catalog_returns cr JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN catalog_sales cs ON cr.cr_order_number = cs.cs_order_number JOIN store s ON cs.cs_ship_addr_sk = s.s_store_sk WHERE s.s_state = 'TN' AND (s.s_rec_end_date = '2000-03-12' OR s.s_rec_end_date = '2001-03-12' OR s.s_rec_end_date = '1999-03-13') AND cr.cr_refunded_cdemo_sk IN ('1036988', '1625235', '677128', '477491', '1394507') AND cs.cs_sales_price IN ('39.95', '82.47', '120.86', '44.27', '31.55', '39.02') AND cs.cs_wholesale_cost IN ('73.36', '50.92', '95.23', '92.26') GROUP BY return_reason, store_state ORDER BY total_net_loss DESC, store_state, return_reason;
