SELECT cd.cd_gender, cd.cd_credit_rating, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, COUNT(cd.cd_demo_sk) AS customer_count, hd.hd_income_band_sk, s.s_state, COUNT(DISTINCT s.s_store_sk) AS store_count FROM customer_demographics cd JOIN customer_address ca ON ca.ca_address_sk = cd.cd_demo_sk JOIN household_demographics hd ON cd.cd_demo_sk = hd.hd_demo_sk JOIN store s ON s.s_state = ca.ca_state GROUP BY cd.cd_gender, cd.cd_credit_rating, hd.hd_income_band_sk, s.s_state ORDER BY cd.cd_gender, cd.cd_credit_rating, hd.hd_income_band_sk, s.s_state;
SELECT t.t_shift, ib.ib_income_band_sk, COUNT(DISTINCT ws.web_site_sk) AS total_websites, AVG(ws.web_tax_percentage) AS avg_tax_percentage, SUM(CASE WHEN ws.web_class = 'Unknown' THEN 1 ELSE 0 END) AS unknown_class_count, MIN(ib.ib_lower_bound) AS min_income_lower_bound, MAX(ib.ib_upper_bound) AS max_income_upper_bound FROM time_dim t JOIN web_site ws ON t.t_time_sk = ws.web_open_date_sk LEFT JOIN income_band ib ON ws.web_mkt_id = ib.ib_income_band_sk WHERE t.t_time_sk IN (1002, 2003, 4384, 955, 433, 1796) AND ws.web_company_id IN (5, 2, 1) AND ws.web_class != 'Unknown' GROUP BY t.t_shift, ib.ib_income_band_sk ORDER BY t.t_shift, ib.ib_income_band_sk;
SELECT cd.cd_education_status, cd.cd_gender, cd.cd_marital_status, COUNT(DISTINCT c.c_customer_sk) AS total_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, AVG(wp.wp_char_count) AS avg_webpage_char_count, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages_accessed, SUM(CASE WHEN cd.cd_credit_rating = 'High' THEN 1 ELSE 0 END) AS high_credit_rating_count, SUM(CASE WHEN cd.cd_credit_rating = 'Medium' THEN 1 ELSE 0 END) AS medium_credit_rating_count, SUM(CASE WHEN cd.cd_credit_rating = 'Low' THEN 1 ELSE 0 END) AS low_credit_rating_count FROM customer_demographics cd JOIN customer c ON cd.cd_demo_sk = c.c_current_cdemo_sk LEFT JOIN web_page wp ON c.c_customer_sk = wp.wp_customer_sk WHERE c.c_birth_country = 'BOTSWANA' AND c.c_email_address LIKE '%@Bk.com' GROUP BY cd.cd_education_status, cd.cd_gender, cd.cd_marital_status ORDER BY cd.cd_education_status, cd.cd_gender, cd.cd_marital_status;
SELECT ca.ca_state AS customer_state, COUNT(DISTINCT ss.ss_ticket_number) AS total_transactions, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_ext_discount_amt) AS avg_discount_amount, SUM(CASE WHEN p.p_channel_email = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_email_promo, SUM(CASE WHEN p.p_channel_dmail = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_dmail_promo, SUM(CASE WHEN p.p_channel_catalog = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_catalog_promo, SUM(CASE WHEN p.p_channel_tv = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_tv_promo, SUM(CASE WHEN p.p_channel_radio = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_radio_promo, SUM(CASE WHEN p.p_channel_press = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_press_promo, SUM(CASE WHEN p.p_channel_event = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_event_promo, SUM(CASE WHEN p.p_channel_demo = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_demo_promo FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ca.ca_state IS NOT NULL AND ss.ss_net_paid > 0 AND (p.p_channel_email = 'Y' OR p.p_channel_dmail = 'Y' OR p.p_channel_catalog = 'Y' OR p.p_channel_tv = 'Y' OR p.p_channel_radio = 'Y' OR p.p_channel_press = 'Y' OR p.p_channel_event = 'Y' OR p.p_channel_demo = 'Y') GROUP BY ca.ca_state ORDER BY total_sales DESC;
SELECT ib.ib_lower_bound, ib.ib_upper_bound, cc.cc_state, d.d_year, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_ext_discount_amt) AS average_discount, COUNT(DISTINCT cs.cs_order_number) AS total_orders FROM catalog_sales cs JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN income_band ib ON cs.cs_bill_customer_sk = ib.ib_income_band_sk JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk WHERE d.d_year = 2003 AND ib.ib_upper_bound IN (40000, 90000, 100000, 20000, 140000, 180000) AND cc.cc_state = 'TN' GROUP BY ib.ib_lower_bound, ib.ib_upper_bound, cc.cc_state, d.d_year ORDER BY ib.ib_lower_bound, total_sales DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, SUM(cr.cr_return_amt_inc_tax) AS total_catalog_return, AVG(cr.cr_fee) AS avg_catalog_fee, COUNT(cr.cr_order_number) AS count_catalog_returns, SUM(wr.wr_return_amt_inc_tax) AS total_web_return, AVG(wr.wr_fee) AS avg_web_fee, COUNT(wr.wr_order_number) AS count_web_returns FROM income_band ib LEFT JOIN catalog_returns cr ON ib.ib_income_band_sk = cr.cr_refunded_cdemo_sk LEFT JOIN web_returns wr ON ib.ib_income_band_sk = wr.wr_refunded_cdemo_sk GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ib.ib_income_band_sk;
SELECT web_site.web_site_id, web_site.web_class, web_site.web_name, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_quantity) AS total_web_quantity_sold, AVG(ws.ws_net_paid) AS avg_web_net_paid, SUM(cr.cr_return_quantity) AS total_catalog_returned_quantity, AVG(cr.cr_return_amount) AS avg_catalog_return_amount, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, SUM(sr.sr_return_amt) AS total_store_return_amount, s.s_store_name, s.s_state, COUNT(DISTINCT cs.cs_order_number) AS total_catalog_orders, SUM(cs.cs_quantity) AS total_catalog_quantity_sold, AVG(cs.cs_net_paid_inc_tax) AS avg_catalog_net_paid_inc_tax, time_dim.t_shift, time_dim.t_sub_shift FROM web_sales ws LEFT JOIN web_site ON ws.ws_web_site_sk = web_site.web_site_sk LEFT JOIN catalog_sales cs ON ws.ws_order_number = cs.cs_order_number LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number LEFT JOIN store_returns sr ON cr.cr_order_number = sr.sr_ticket_number LEFT JOIN store s ON sr.sr_store_sk = s.s_store_sk LEFT JOIN time_dim ON ws.ws_sold_time_sk = time_dim.t_time_sk WHERE s.s_gmt_offset = '-5.00' AND COALESCE(CAST(s.s_closed_date_sk AS TEXT), '') NOT IN ('2451044', '2451189') AND cr.cr_return_quantity IN (95, 94, 84, 23) AND cr.cr_ship_mode_sk IN (14, 5, 19, 8, 2) AND (time_dim.t_sub_shift = 'night' OR time_dim.t_shift = 'third') AND cs.cs_bill_customer_sk IN (49534, 61995) AND cs.cs_net_paid = 3022.20 GROUP BY web_site.web_site_id, web_site.web_class, web_site.web_name, s.s_store_name, s.s_state, time_dim.t_shift, time_dim.t_sub_shift ORDER BY web_site.web_name, s.s_store_name LIMIT 100;
SELECT ws.web_site_id, ws.web_name, ws.web_class, ws.web_market_manager, AVG(p.p_cost) AS average_promotion_cost, SUM(CASE WHEN p.p_channel_email = 'N' THEN 1 ELSE 0 END) AS num_promotions_not_via_email, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages, MAX(hd.hd_dep_count) AS max_dependency_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count FROM web_site ws LEFT JOIN promotion p ON ws.web_site_sk = p.p_item_sk LEFT JOIN catalog_page cp ON cp.cp_catalog_page_number IN (26, 38) AND cp.cp_start_date_sk IN (2450965, 2451115, 2451300, 2451818, 2450935) LEFT JOIN household_demographics hd ON hd.hd_income_band_sk IN (15, 2) GROUP BY ws.web_site_id, ws.web_name, ws.web_class, ws.web_market_manager ORDER BY ws.web_site_id;
SELECT ws.ws_item_sk, hd.hd_income_band_sk, AVG(ws.ws_net_profit) AS avg_net_profit_web_sales, SUM(cr.cr_net_loss) AS total_net_loss_catalog_returns FROM web_sales ws JOIN catalog_returns cr ON ws.ws_item_sk = cr.cr_item_sk AND ws.ws_order_number = cr.cr_order_number JOIN household_demographics hd ON (ws.ws_bill_hdemo_sk = hd.hd_demo_sk OR ws.ws_ship_hdemo_sk = hd.hd_demo_sk) AND (cr.cr_refunded_hdemo_sk = hd.hd_demo_sk OR cr.cr_returning_hdemo_sk = hd.hd_demo_sk) WHERE hd.hd_buy_potential IN ('0-500', '5001-10000', '>10000', '1001-5000') AND ws.ws_warehouse_sk IN (1, 2) AND cr.cr_warehouse_sk IN (1, 2) AND ws.ws_item_sk IN (8530, 14257, 11258, 15637, 6283) AND cr.cr_item_sk IN (9044, 17656, 9802) GROUP BY ws.ws_item_sk, hd.hd_income_band_sk;
SELECT ca_state, sm_type, EXTRACT(YEAR FROM d_date) AS year, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk JOIN customer_address ON cs_ship_addr_sk = ca_address_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk WHERE ca_country = 'United States' AND sm_type IN ('TWO DAY', 'EXPRESS', 'OVERNIGHT') AND d_year = EXTRACT(YEAR FROM CURRENT_DATE) GROUP BY ca_state, sm_type, year ORDER BY total_net_profit DESC, ca_state, sm_type;
