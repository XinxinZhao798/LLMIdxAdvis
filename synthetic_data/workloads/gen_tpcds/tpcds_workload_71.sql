SELECT ca.ca_city, ca.ca_county, AVG(hd.hd_income_band_sk) AS avg_income_band, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, COUNT(DISTINCT wp.wp_web_page_sk) AS num_web_pages_created, COUNT(DISTINCT wp.wp_access_date_sk) AS num_web_pages_accessed, AVG(wp.wp_char_count) AS avg_web_page_char_count FROM customer_address ca JOIN household_demographics hd ON ca.ca_address_sk = hd.hd_demo_sk LEFT JOIN web_page wp ON ca.ca_address_sk = wp.wp_customer_sk WHERE ca.ca_city IN ('Morgantown', 'Forestville', 'Sutton', 'Mount Olive', 'Texas', 'Bridgeport') AND ca.ca_county IN ('Carlton County', 'Bonneville County') AND wp.wp_type IN ('blog', 'article', 'product_review') AND wp.wp_autogen_flag = 'N' GROUP BY ca.ca_city, ca.ca_county ORDER BY ca.ca_city, ca.ca_county;
SELECT cc.cc_name, SUM(CASE WHEN p.p_channel_catalog = 'N' THEN p.p_cost ELSE 0 END) AS total_promotion_cost_catalog, AVG(i.i_current_price) AS average_item_price, COUNT(DISTINCT p.p_promo_sk) AS number_of_promotions, COUNT(DISTINCT i.i_item_sk) AS number_of_items_promoted, SUM(CASE WHEN cc.cc_hours = '8AM-4PM' THEN 1 ELSE 0 END) AS call_centers_8am_to_4pm, SUM(CASE WHEN cc.cc_hours = '8AM-8AM' THEN 1 ELSE 0 END) AS call_centers_24_hours FROM call_center cc JOIN promotion p ON cc.cc_call_center_sk = p.p_promo_sk JOIN item i ON p.p_item_sk = i.i_item_sk WHERE p.p_end_date_sk IN (2450406, 2450872, 2450915, 2450756, 2450513) AND cc.cc_hours IN ('8AM-4PM', '8AM-8AM') GROUP BY cc.cc_name ORDER BY total_promotion_cost_catalog DESC, average_item_price DESC;
SELECT cp.cp_department AS department, i.i_category AS category, i.i_class AS class, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, AVG(hd.hd_dep_count) AS average_dependents, AVG(hd.hd_vehicle_count) AS average_vehicles FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN catalog_page cp ON i.i_item_sk = cp.cp_catalog_page_sk JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE hd.hd_vehicle_count IN (0, 3) AND hd.hd_buy_potential IN ('>10000', '5001-10000', '501-1000', '0-500') AND cp.cp_start_date_sk <= ws.ws_sold_date_sk AND (cp.cp_end_date_sk IS NULL OR cp.cp_end_date_sk >= ws.ws_sold_date_sk) GROUP BY cp.cp_department, i.i_category, i.i_class ORDER BY total_net_profit DESC, total_orders DESC;
SELECT d.d_year, SUM(ss_net_profit) AS total_profit, COUNT(DISTINCT ss_item_sk) AS items_sold, COUNT(DISTINCT ss_ticket_number) AS total_sales_transactions, AVG(ss_net_paid_inc_tax) AS avg_sales_with_tax, w.w_state, w.w_city, COUNT(DISTINCT sr_ticket_number) AS total_return_transactions, SUM(sr_return_amt_inc_tax) AS total_returns_with_tax, AVG(sr_fee) AS avg_return_fee FROM store_sales ss LEFT JOIN store_returns sr ON ss.ss_item_sk = sr.sr_item_sk AND ss.ss_ticket_number = sr.sr_ticket_number JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN warehouse w ON ss.ss_store_sk = w.w_warehouse_sk WHERE d.d_year = 2002 AND ss.ss_store_sk IN (10, 7, 4, 1) AND sr.sr_returned_date_sk IN ('2451033', '2451972') AND w.w_city = 'Midway' GROUP BY d.d_year, w.w_state, w.w_city ORDER BY total_profit DESC;
SELECT cp.cp_department, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cr.cr_returned_date_sk) AS num_return_dates, ca.ca_state, COUNT(DISTINCT ca.ca_address_sk) AS num_addresses, cd.cd_education_status, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS num_customers_refunded, COUNT(DISTINCT cr.cr_returning_customer_sk) AS num_customers_returning, hd.hd_income_band_sk, SUM(hd.hd_dep_count) AS total_dependents, SUM(ib.ib_upper_bound) AS income_band_upper_sum FROM catalog_page cp JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk JOIN customer_address ca ON cr.cr_refunded_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON cr.cr_refunded_cdemo_sk = cd.cd_demo_sk JOIN customer c ON cr.cr_refunded_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE c.c_preferred_cust_flag = 'Y' AND cp.cp_catalog_number = 28 AND ca.ca_address_id IN ('AAAAAAAABDCAAAAA', 'AAAAAAAAGMKAAAAA', 'AAAAAAAADIKAAAAA') AND cr.cr_order_number IN (4413, 1193, 3467, 1390, 1265) GROUP BY cp.cp_department, ca.ca_state, cd.cd_education_status, hd.hd_income_band_sk ORDER BY total_return_amount DESC, num_customers_refunded DESC;
SELECT d.d_year, i.i_category, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT sr.sr_customer_sk) AS unique_customers, w.w_state, w.w_city FROM store_returns sr JOIN date_dim d ON sr.sr_returned_date_sk = d.d_date_sk JOIN item i ON sr.sr_item_sk = i.i_item_sk JOIN warehouse w ON sr.sr_addr_sk = w.w_warehouse_sk WHERE d.d_year = 2023 AND i.i_category_id BETWEEN 1 AND 100 AND w.w_suite_number IN ('Suite 80', 'Suite 0', 'Suite P', 'Suite 470') GROUP BY d.d_year, i.i_category, w.w_state, w.w_city ORDER BY total_return_amount DESC, avg_return_quantity DESC;
SELECT s.s_state, s.s_county, cd.cd_marital_status, COUNT(DISTINCT i.i_item_sk) AS total_items, SUM(i.i_current_price) AS total_revenue, AVG(i.i_wholesale_cost) AS average_wholesale_cost, COUNT(DISTINCT hd.hd_demo_sk) AS total_households, AVG(hd.hd_vehicle_count) AS average_vehicle_count, SUM(CASE WHEN i.i_units = 'Bundle' THEN 1 ELSE 0 END) AS bundle_units, SUM(CASE WHEN i.i_units = 'Pound' THEN 1 ELSE 0 END) AS pound_units, SUM(CASE WHEN i.i_units = 'Oz' THEN 1 ELSE 0 END) AS oz_units, COUNT(DISTINCT s.s_store_sk) AS total_stores, AVG(s.s_floor_space) AS average_floor_space FROM item i JOIN store s ON (i.i_manufact_id = s.s_store_sk) JOIN household_demographics hd ON (s.s_store_sk = hd.hd_income_band_sk) JOIN customer_demographics cd ON (hd.hd_demo_sk = cd.cd_demo_sk) WHERE hd.hd_dep_count IN ('6', '9', '5') AND hd.hd_demo_sk IN ('28', '1536', '3779') AND hd.hd_vehicle_count IN ('2', '1', '3') AND i.i_units IN ('Bundle', 'Pound', 'Oz') AND i.i_rec_end_date IN ('1999-10-27', '2000-10-26', '2001-10-26') AND s.s_market_desc IN ('Events develop i', 'Architects coul', 'Little expectations include yet forward meetings.') AND s.s_state = 'TN' AND s.s_county = 'Williamson County' AND s.s_floor_space IN ('8954883', '9341467', '5285950') AND cd.cd_dep_college_count = '0' AND cd.cd_demo_sk IN ('20554', '21012', '21822') AND cd.cd_marital_status IN ('S', 'M', 'D') GROUP BY s.s_state, s.s_county, cd.cd_marital_status ORDER BY total_revenue DESC, average_wholesale_cost DESC;
SELECT cc_state, SUM(sr_return_amt) AS total_return_amt, AVG(sr_return_amt) AS avg_return_amt, COUNT(*) AS num_returns, SUM(ss_net_profit) AS total_net_profit, AVG(ss_net_profit) AS avg_net_profit, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(wr_return_ship_cost) AS total_return_ship_cost, AVG(wr_return_ship_cost) AS avg_return_ship_cost, COUNT(DISTINCT wr_refunded_customer_sk) AS unique_returned_customers FROM call_center JOIN store_returns ON sr_store_sk = cc_call_center_sk JOIN store_sales ON ss_store_sk = cc_call_center_sk AND store_returns.sr_ticket_number = store_sales.ss_ticket_number JOIN web_returns ON wr_returning_addr_sk = sr_addr_sk WHERE cc_rec_start_date <= CURRENT_DATE AND (cc_rec_end_date IS NULL OR cc_rec_end_date > CURRENT_DATE) AND sr_hdemo_sk IN ('1110', '6655', '2958', '2489', '5750', '5814') AND sr_return_quantity = 36 AND wr_return_ship_cost IN ('460.94', '104.34', '381.68', '830.90') AND wr_returned_time_sk IN ('77442', '66455', '78336', '60895', '70221') AND ss_coupon_amt IN ('1615.93', '743.42') AND ss_net_profit IN ('-1410.96', '-564.39', '-55.72') GROUP BY cc_state ORDER BY total_return_amt DESC;
