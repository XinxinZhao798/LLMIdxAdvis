SELECT s.s_store_sk, s.s_store_name, s.s_city, s.s_state, dd.d_quarter_name, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_units_sold, SUM(ss.ss_net_paid) AS total_revenue, SUM(ss.ss_net_profit) AS total_profit, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions, SUM(sr.sr_return_quantity) AS total_units_returned, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_net_loss) AS total_return_loss, AVG(cd.cd_dep_count) AS avg_customer_dependants, AVG(hd.hd_income_band_sk) AS avg_customer_income_band, r.r_reason_desc AS most_common_return_reason FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk LEFT JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk LEFT JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk LEFT JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE dd.d_quarter_name IS NOT NULL GROUP BY s.s_store_sk, s.s_store_name, s.s_city, s.s_state, dd.d_quarter_name, r.r_reason_desc ORDER BY s.s_store_sk, dd.d_quarter_name;
SELECT ss.ss_store_sk AS store_id, hd.hd_vehicle_count AS vehicle_count, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_items_sold, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_sales_net_profit, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions, SUM(sr.sr_return_quantity) AS total_items_returned, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(sr.sr_net_loss) AS total_returns_net_loss, ARRAY_AGG(DISTINCT r.r_reason_desc) FILTER (WHERE sr.sr_reason_sk IS NOT NULL) AS return_reasons FROM store_sales ss JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk LEFT JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE ss.ss_store_sk IN ('10', '4', '7', '8') AND hd.hd_vehicle_count IN ('3', '2', '1', '4') GROUP BY ss.ss_store_sk, hd.hd_vehicle_count ORDER BY total_sales_net_profit DESC, total_returns_net_loss ASC;
SELECT cp.cp_department, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, COUNT(cr.cr_return_amount) AS num_returns, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_sales_price) AS total_sales, COUNT(cs.cs_sales_price) AS num_sales, ca.ca_state, COUNT(DISTINCT ca.ca_city) AS num_cities FROM catalog_page cp JOIN catalog_sales cs ON cp.cp_catalog_page_sk = cs.cs_catalog_page_sk JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk WHERE cp.cp_catalog_number IN (29, 40) AND cr.cr_refunded_cdemo_sk = 1173022 GROUP BY cp.cp_department, ca.ca_state ORDER BY total_return_amount DESC, total_sales DESC;
SELECT dd.d_year, dd.d_quarter_name, cc.cc_division_name, SUM(wp.wp_char_count) AS total_char_count, AVG(wp.wp_link_count) AS average_link_count, COUNT(*) AS num_web_pages_accessed, COUNT(DISTINCT cc.cc_call_center_sk) AS num_call_centers_involved, COUNT(DISTINCT r.r_reason_sk) AS num_distinct_reasons FROM date_dim AS dd JOIN web_page AS wp ON dd.d_date_sk = wp.wp_access_date_sk JOIN call_center AS cc ON wp.wp_customer_sk = cc.cc_call_center_sk LEFT JOIN reason AS r ON r.r_reason_sk = wp.wp_customer_sk WHERE dd.d_year = 2022 AND dd.d_quarter_name IN ('Q1', 'Q2', 'Q3', 'Q4') AND r.r_reason_sk IN ('15', '31', '3', '32', '5') GROUP BY dd.d_year, dd.d_quarter_name, cc.cc_division_name ORDER BY dd.d_year, dd.d_quarter_name, cc.cc_division_name;
SELECT cp.cp_department, AVG(cr.cr_return_amt_inc_tax) AS avg_return_amount, SUM(cr.cr_return_quantity) AS total_return_quantity, COUNT(cr.cr_item_sk) AS return_count, AVG(t.t_time) AS avg_time_spent_on_page FROM catalog_returns cr JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN customer c ON cr.cr_returning_customer_sk = c.c_customer_sk JOIN web_page wp ON c.c_customer_sk = wp.wp_customer_sk JOIN time_dim t ON cr.cr_returned_time_sk = t.t_time_sk WHERE c.c_preferred_cust_flag = 'Y' AND cp.cp_catalog_number IN (4, 47) AND cp.cp_catalog_page_id IN ('AAAAAAAALNKAAAAA', 'AAAAAAAAEHFAAAAA', 'AAAAAAAAMAIAAAAA', 'AAAAAAAAAAKAAAAA') AND wp.wp_web_page_sk IN (57, 25, 50, 44, 55) AND wp.wp_customer_sk IN (10897, 84146, 37285, 92078) AND t.t_time_id IN ('AAAAAAAAAKCBAAAA', 'AAAAAAAACKOAAAAA') GROUP BY cp.cp_department ORDER BY avg_return_amount DESC, total_return_quantity DESC, return_count DESC;
SELECT cc.cc_name, cc.cc_employees, cc.cc_tax_percentage, SUM(ss.ss_net_paid_inc_tax) AS total_net_sales, AVG(ss.ss_wholesale_cost) AS avg_wholesale_cost, COUNT(DISTINCT ss.ss_item_sk) AS items_sold_count FROM store_sales ss JOIN call_center cc ON ss.ss_store_sk = cc.cc_call_center_sk WHERE ss.ss_sold_date_sk BETWEEN cc.cc_open_date_sk AND COALESCE(cc.cc_closed_date_sk, (SELECT MAX(ss_sold_date_sk) FROM store_sales)) AND cc.cc_tax_percentage IN (0.01, 0.12, 0.05, 0.11) AND ss.ss_item_sk IN (14150, 11113, 2890) GROUP BY cc.cc_name, cc.cc_employees, cc.cc_tax_percentage ORDER BY total_net_sales DESC, avg_wholesale_cost DESC, items_sold_count DESC;
SELECT dd.d_year, dd.d_quarter_name, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_quantity) AS total_web_quantity_sold, SUM(ws.ws_net_paid) AS total_web_net_paid, COUNT(DISTINCT cs.cs_order_number) AS total_catalog_orders, SUM(cs.cs_quantity) AS total_catalog_quantity_sold, SUM(cs.cs_net_paid) AS total_catalog_net_paid, SUM(cr.cr_return_quantity) AS total_returned_quantity, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_fee) AS total_return_fees, SUM(cr.cr_net_loss) AS total_net_loss FROM date_dim dd LEFT JOIN web_sales ws ON ws.ws_sold_date_sk = dd.d_date_sk LEFT JOIN catalog_sales cs ON cs.cs_sold_date_sk = dd.d_date_sk LEFT JOIN catalog_returns cr ON cr.cr_returned_date_sk = dd.d_date_sk WHERE dd.d_year = 2003 GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT cp_type, sm_type, w_city, w_state, SUM(cs_sales_price) AS total_sales, COUNT(DISTINCT cs_order_number) AS number_of_sales_orders, SUM(cr_return_amount) AS total_returns, COUNT(DISTINCT cr_order_number) AS number_of_return_orders, (SUM(cs_sales_price) - SUM(cr_return_amount)) AS net_sales, AVG(cs_sales_price) AS average_sales_price, CASE WHEN SUM(cs_sales_price) > 0 THEN SUM(cr_return_amount) / SUM(cs_sales_price) ELSE 0 END AS return_rate FROM catalog_sales JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk LEFT JOIN catalog_returns ON cs_order_number = cr_order_number GROUP BY cp_type, sm_type, w_city, w_state ORDER BY cp_type, sm_type, w_city, w_state;
SELECT i_category, i_brand, COUNT(DISTINCT i_item_sk) AS num_items, SUM(i_current_price) AS total_current_price, AVG(i_wholesale_cost) AS average_wholesale_cost, MAX(wp_link_count) AS max_link_count, MIN(wp_char_count) AS min_char_count, AVG(t_hour) AS average_hour_of_day FROM item JOIN web_page ON i_item_sk = wp_customer_sk JOIN time_dim ON wp_access_date_sk = t_time_sk WHERE i_container <> 'Unknown' AND i_brand_id IN ('9001011', '9016005', '6015001', '9005009', '9016001') AND wp_link_count IN ('17', '25', '6', '4', '18', '19') GROUP BY i_category, i_brand ORDER BY total_current_price DESC, average_wholesale_cost DESC LIMIT 100;
SELECT ca_state, w_state, AVG(c_hd.hd_dep_count) AS avg_household_dep_count, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_profit) AS total_net_profit, SUM(ss_net_profit) AS total_store_net_profit FROM customer_address ca JOIN catalog_sales cs ON ca.ca_address_sk = cs.cs_bill_addr_sk JOIN household_demographics c_hd ON cs.cs_bill_hdemo_sk = c_hd.hd_demo_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN store_sales ss ON cs.cs_item_sk = ss.ss_item_sk AND cs.cs_order_number = ss.ss_ticket_number WHERE ca.ca_country = 'United States' AND w.w_country = 'United States' AND ss.ss_quantity > 5 AND cs.cs_quantity > 5 AND ca.ca_state IN ('CA', 'TX', 'NY') GROUP BY ca_state, w_state ORDER BY total_net_profit DESC, total_store_net_profit DESC, ca_state, w_state;
