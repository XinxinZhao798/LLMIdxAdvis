SELECT ws.web_site_id, ws.web_name, ws.web_class, ws.web_market_manager, AVG(p.p_cost) AS average_promotion_cost, SUM(CASE WHEN p.p_channel_email = 'N' THEN 1 ELSE 0 END) AS num_promotions_not_via_email, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages, MAX(hd.hd_dep_count) AS max_dependency_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count FROM web_site ws LEFT JOIN promotion p ON ws.web_site_sk = p.p_item_sk LEFT JOIN catalog_page cp ON cp.cp_catalog_page_number IN (26, 38) AND cp.cp_start_date_sk IN (2450965, 2451115, 2451300, 2451818, 2450935) LEFT JOIN household_demographics hd ON hd.hd_income_band_sk IN (15, 2) GROUP BY ws.web_site_id, ws.web_name, ws.web_class, ws.web_market_manager ORDER BY ws.web_site_id;
SELECT d_year, i_category, i_class, SUM(ws_sales_price) AS total_sales, AVG(ws_sales_price) AS avg_sales_price, COUNT(DISTINCT ws_order_number) AS num_orders, SUM(sr_return_amt) AS total_returns, AVG(sr_return_amt) AS avg_return_amt, COUNT(DISTINCT sr_ticket_number) AS num_returns, SUM(ws_net_profit) - SUM(sr_net_loss) AS net_profit FROM web_sales JOIN item ON ws_item_sk = i_item_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk LEFT JOIN store_returns ON sr_item_sk = ws_item_sk AND sr_returned_date_sk = ws_sold_date_sk WHERE d_year = 2002 AND (i_category = 'Electronics' OR i_category = 'Books') AND ws_sales_price > 0 GROUP BY d_year, i_category, i_class ORDER BY d_year, i_category, i_class;
SELECT ib.ib_income_band_sk, cc.cc_division_name, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amt_inc_tax, SUM(wr.wr_net_loss) AS total_net_loss, COUNT(wr.wr_returned_date_sk) AS total_returns, AVG(hd.hd_dep_count) AS avg_dependents, AVG(hd.hd_vehicle_count) AS avg_vehicles FROM web_returns wr JOIN household_demographics hd ON wr.wr_returning_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN call_center cc ON cc.cc_country = 'United States' AND cc.cc_call_center_sk = wr.wr_refunded_addr_sk WHERE hd.hd_income_band_sk IN (20, 8, 18, 11, 19, 2) GROUP BY ib.ib_income_band_sk, cc.cc_division_name ORDER BY total_net_loss DESC, avg_return_amt_inc_tax DESC;
SELECT ca_state, ca_city, ca_country, EXTRACT(YEAR FROM TO_TIMESTAMP(t_time)) AS sale_year, COUNT(DISTINCT w_warehouse_sk) AS number_of_warehouses, SUM(w_warehouse_sq_ft) AS total_warehouse_area, AVG(w_warehouse_sq_ft) AS avg_warehouse_area, COUNT(DISTINCT ca_address_sk) AS number_of_customers, AVG(ca_gmt_offset) AS avg_gmt_offset FROM customer_address JOIN warehouse ON customer_address.ca_state = warehouse.w_state JOIN time_dim ON (warehouse.w_gmt_offset = -5 OR warehouse.w_street_name IN ('Ash Laurel', '6th', 'Wilson Elm', 'View First')) WHERE ca_country = 'United States' AND t_hour BETWEEN 8 AND 17 AND EXTRACT(ISODOW FROM TO_TIMESTAMP(t_time)) < 6 GROUP BY ca_state, ca_city, ca_country, sale_year ORDER BY ca_state, ca_city, sale_year;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, COUNT(c.c_customer_sk) AS num_customers, SUM(CASE WHEN p.p_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS num_promotions_used, AVG(hd.hd_vehicle_count) AS avg_vehicles_per_household, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses_involved FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk LEFT JOIN promotion p ON p.p_start_date_sk <= c.c_first_sales_date_sk AND p.p_end_date_sk >= c.c_first_sales_date_sk JOIN warehouse w ON w.w_state = cd.cd_credit_rating WHERE cd.cd_purchase_estimate > 500 AND hd.hd_buy_potential IN ('5001-10000', '>10000') AND p.p_discount_active = 'Y' GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating ORDER BY avg_purchase_estimate DESC, num_customers DESC LIMIT 100;
SELECT cp_department, SUM(ws_quantity) AS total_quantity_sold, AVG(ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws_bill_customer_sk) AS unique_customers, COUNT(DISTINCT ws_web_page_sk) AS page_views, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_profit) AS total_net_profit FROM web_sales JOIN catalog_page ON web_sales.ws_web_page_sk = catalog_page.cp_catalog_page_sk WHERE catalog_page.cp_catalog_number IN (20, 25, 19) AND catalog_page.cp_department = 'DEPARTMENT' GROUP BY cp_department ORDER BY total_net_profit DESC;
SELECT ws.ws_web_site_sk, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, ws_site.web_tax_percentage, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(cd.cd_dep_college_count) AS total_college_dependents FROM web_sales ws JOIN web_site ws_site ON ws.ws_web_site_sk = ws_site.web_site_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk WHERE ws.ws_sales_price BETWEEN 6.61 AND 60.51 AND ws_site.web_tax_percentage IN ('0.07', '0.02') AND ws_site.web_zip IN ('35709', '31904') AND ws.ws_sold_date_sk IS NOT NULL AND ws.ws_sold_time_sk IS NOT NULL GROUP BY ws.ws_web_site_sk, ws_site.web_tax_percentage, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY ws.ws_web_site_sk, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status;
SELECT ca.ca_state, COUNT(DISTINCT c.c_customer_sk) AS total_customers, AVG(s.s_floor_space) AS average_store_floor_space, SUM(s.s_number_employees) AS total_employees, COUNT(DISTINCT w.web_site_sk) AS total_websites, AVG(w.web_tax_percentage) AS average_web_tax_percentage FROM customer_address ca JOIN customer c ON ca.ca_address_sk = c.c_current_addr_sk JOIN store s ON ca.ca_state = s.s_state JOIN web_site w ON w.web_state = ca.ca_state WHERE c.c_preferred_cust_flag = 'Y' AND c.c_birth_year BETWEEN 1933 AND 1975 AND s.s_company_id = 1 AND w.web_open_date_sk IN ('2450730', '2450747') GROUP BY ca.ca_state ORDER BY total_customers DESC;
SELECT i.i_category, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(wr.wr_return_quantity) AS total_quantity_returned, SUM(wr.wr_return_amt) AS total_return_amount, AVG(inv.inv_quantity_on_hand) AS average_inventory_on_hand FROM item i LEFT JOIN store_sales ss ON ss.ss_item_sk = i.i_item_sk LEFT JOIN web_returns wr ON wr.wr_item_sk = i.i_item_sk LEFT JOIN inventory inv ON inv.inv_item_sk = i.i_item_sk WHERE i.i_category IN ('Electronics', 'Clothing', 'Furniture') AND ss.ss_sold_date_sk BETWEEN 2451453 AND 2451553 AND wr.wr_returned_date_sk BETWEEN 2451453 AND 2451553 AND inv.inv_date_sk BETWEEN 2451453 AND 2451553 GROUP BY i.i_category ORDER BY total_quantity_sold DESC;
SELECT c.c_first_name, c.c_last_name, cs_total_sales, ws_total_sales, (cs_total_net_sales + ws_total_net_sales) AS total_combined_net_sales FROM customer c JOIN (SELECT cs_bill_customer_sk, SUM(cs_net_paid) AS cs_total_sales FROM catalog_sales GROUP BY cs_bill_customer_sk) cs_sales ON c.c_customer_sk = cs_sales.cs_bill_customer_sk JOIN (SELECT ws_bill_customer_sk, SUM(ws_net_paid) AS ws_total_sales FROM web_sales GROUP BY ws_bill_customer_sk) ws_sales ON c.c_customer_sk = ws_sales.ws_bill_customer_sk JOIN (SELECT cs_bill_customer_sk, SUM(cs_net_paid_inc_ship_tax) AS cs_total_net_sales FROM catalog_sales GROUP BY cs_bill_customer_sk) total_cs_sales ON c.c_customer_sk = total_cs_sales.cs_bill_customer_sk JOIN (SELECT ws_bill_customer_sk, SUM(ws_net_paid_inc_ship_tax) AS ws_total_net_sales FROM web_sales GROUP BY ws_bill_customer_sk) total_ws_sales ON c.c_customer_sk = total_ws_sales.ws_bill_customer_sk WHERE c.c_birth_country IN ('BRAZIL', 'ROMANIA', 'ICELAND') AND EXISTS (SELECT 1 FROM call_center WHERE cc_call_center_sk = cs_sales.cs_bill_customer_sk AND cc_company_name LIKE 'pri%') AND EXISTS (SELECT 1 FROM web_site WHERE web_site_sk = ws_sales.ws_bill_customer_sk AND web_street_type IN ('Road', 'Way', 'Dr.', 'Cir.', 'Parkway') AND web_street_number IN ('292', '409', '887', '805')) ORDER BY total_combined_net_sales DESC LIMIT 100;
SELECT ws.web_site_id, st.s_store_name, hd.hd_buy_potential, ws_cat.avg_sales_price, ws_cat.total_quantity_sold, ws_cat.total_net_profit, ws_cat.avg_coupon_amt_used FROM web_site ws JOIN (SELECT ws_web_site_sk, AVG(ws_sales_price) AS avg_sales_price, SUM(ws_quantity) AS total_quantity_sold, SUM(ws_net_profit) AS total_net_profit, AVG(ws_coupon_amt) AS avg_coupon_amt_used FROM web_sales GROUP BY ws_web_site_sk ) ws_cat ON ws_cat.ws_web_site_sk = ws.web_site_sk JOIN store st ON ws.web_mkt_id = st.s_market_id JOIN household_demographics hd ON ws_cat.avg_sales_price BETWEEN hd.hd_income_band_sk AND hd.hd_income_band_sk * 10 WHERE ws.web_open_date_sk IN ('2450594', '2450645', '2450679', '2450798', '2450696') AND st.s_rec_start_date BETWEEN '1997-03-13' AND '2001-03-13' AND hd.hd_buy_potential IN ('0-500', 'Unknown', '1001-5000') GROUP BY ws.web_site_id, st.s_store_name, hd.hd_buy_potential, ws_cat.avg_sales_price, ws_cat.total_quantity_sold, ws_cat.total_net_profit, ws_cat.avg_coupon_amt_used ORDER BY ws.web_site_id, st.s_store_name, hd.hd_buy_potential;
SELECT c.c_customer_id, AVG(ss.ss_net_profit) AS avg_net_profit, SUM(sr.sr_return_amt_inc_tax) AS total_returns, COUNT(DISTINCT ws.web_site_sk) AS number_of_websites, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid_inc_tax) AS total_sales_inc_tax FROM customer c LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk LEFT JOIN web_site ws ON ws.web_zip = c.c_current_addr_sk::character varying WHERE (ss.ss_hdemo_sk IN ('4776', '3144', '2508', '6460') OR c.c_current_hdemo_sk IN ('5414', '1065', '4963', '3942', '5655', '758')) AND (ws.web_zip IN ('35709', '31904') OR ws.web_rec_end_date IN ('1999-08-16', '2000-08-15', '2001-08-15')) GROUP BY c.c_customer_id ORDER BY avg_net_profit DESC, total_returns DESC, number_of_websites DESC, total_quantity_sold DESC, total_sales_inc_tax DESC;
SELECT cp.cp_department, ca.ca_city, ca.ca_state, cd.cd_education_status, td.t_shift, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON cs.cs_ship_cdemo_sk = cd.cd_demo_sk JOIN time_dim td ON cs.cs_sold_time_sk = td.t_time_sk WHERE cp.cp_start_date_sk IN (2451145, 2451271, 2451088, 2450845, 2451360) AND cp.cp_type IN ('bi-annual', 'quarterly') AND td.t_hour IN (1, 0) AND cd.cd_dep_college_count = 0 GROUP BY cp.cp_department, ca.ca_city, ca.ca_state, cd.cd_education_status, td.t_shift ORDER BY total_net_profit DESC, total_orders DESC;
SELECT i_category, ca_state, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_amt) AS avg_return_amount, COUNT(DISTINCT sr_customer_sk) AS unique_customers_returning, COUNT(*) AS total_returns FROM store_returns sr JOIN item i ON sr.sr_item_sk = i.i_item_sk JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ca.ca_gmt_offset IN ('-5.00', '-6.00', '-10.00', '-7.00', '-9.00') AND c.c_birth_month IN (6, 1, 3, 10, 9, 8) AND ca.ca_suite_number IN ('Suite 10', 'Suite I', 'Suite 60', 'Suite 360', 'Suite C', 'Suite 320') GROUP BY i_category, ca_state ORDER BY total_return_amount DESC, unique_customers_returning DESC;
SELECT w.web_name, SUM(ws.ws_net_paid) AS total_revenue, AVG(ws.ws_quantity) AS average_quantity_sold, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_incl_tax, AVG(wr.wr_return_quantity) AS average_return_quantity, COUNT(DISTINCT wr.wr_order_number) AS total_returns, MAX(i.inv_quantity_on_hand) AS max_inventory_on_hand FROM web_sales ws JOIN web_site w ON ws.ws_web_site_sk = w.web_site_sk LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk JOIN inventory i ON ws.ws_item_sk = i.inv_item_sk WHERE w.web_mkt_class IN ('Continuous, social schools shou', 'Broad, new groups show car', 'Necessary, intermediat') AND ws.ws_wholesale_cost BETWEEN 20.49 AND 79.73 AND ws.ws_order_number IN (38859, 41620, 300) AND i.inv_warehouse_sk IN (1, 2) GROUP BY w.web_name ORDER BY total_revenue DESC;
SELECT i.i_category, i.i_brand, sm.sm_type, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt) AS avg_return_amount, SUM(wr.wr_return_amt) AS total_return_amount, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_net_loss) AS total_net_loss FROM web_returns wr JOIN item i ON wr.wr_item_sk = i.i_item_sk JOIN ship_mode sm ON wr.wr_returned_date_sk = sm.sm_ship_mode_sk WHERE i.i_item_id IN ('AAAAAAAAEKBBAAAA', 'AAAAAAAACAAAAAAA', 'AAAAAAAAGCCAAAAA', 'AAAAAAAAKMEAAAAA') AND wr.wr_return_tax IN (29.73, 18.36, 50.38, 6.84) AND wr.wr_fee IN (85.54, 18.90, 40.73, 20.86, 73.81) AND sm.sm_ship_mode_sk IN (13, 7, 6, 16, 10) AND sm.sm_type IN ('TWO DAY', 'OVERNIGHT') GROUP BY i.i_category, i.i_brand, sm.sm_type ORDER BY total_net_loss DESC, total_returned_quantity DESC;
SELECT d.d_year, d.d_quarter_name, sum(ws_net_paid) AS total_sales, avg(ws_quantity) AS average_quantity_sold, count(distinct ws_order_number) AS total_orders, count(distinct ws_item_sk) AS unique_items_sold, sum(ws_net_profit) AS total_profit FROM web_sales ws INNER JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk INNER JOIN item i ON ws.ws_item_sk = i.i_item_sk INNER JOIN call_center cc ON cc.cc_division_name LIKE 'pri%' AND cc.cc_country = 'United States' WHERE d.d_year = 2000 AND i.i_rec_start_date BETWEEN '1999-10-28' AND '2001-10-27' AND i.i_manufact = 'ationationable' AND ws.ws_bill_cdemo_sk IN ('371058', '1268921') GROUP BY d.d_year, d.d_quarter_name ORDER BY total_sales DESC, d.d_quarter_name;
SELECT dd.d_year, dd.d_quarter_name, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit, cc.cc_name AS call_center_name, cc.cc_division_name AS call_center_division, cc.cc_city AS call_center_city FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk WHERE dd.d_qoy IN (1, 2, 3, 4) AND dd.d_dom IN (20, 24) AND cc.cc_sq_ft IN ('4134', '1138', '2268') AND cc.cc_division IN ('1', '4') GROUP BY dd.d_year, dd.d_quarter_name, cc.cc_name, cc.cc_division_name, cc.cc_city ORDER BY dd.d_year, dd.d_quarter_name, total_net_profit DESC;
SELECT cd.cd_education_status, ib.ib_income_band_sk, COUNT(DISTINCT ws.ws_order_number) AS number_of_orders, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_sales_price) AS average_sales_price FROM web_sales ws JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE cd.cd_purchase_estimate IS NOT NULL AND ib.ib_upper_bound <= 110000 AND ib.ib_income_band_sk IN (4, 1, 14, 13, 8) GROUP BY ROLLUP (cd.cd_education_status, ib.ib_income_band_sk) ORDER BY total_net_profit DESC, cd.cd_education_status, ib.ib_income_band_sk;
SELECT c_birth_country, cd_gender, cd_marital_status, cd_education_status, AVG(cd_purchase_estimate) AS avg_purchase_estimate, COUNT(DISTINCT c_customer_sk) AS total_customers, SUM(inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT wr_order_number) AS total_returns, AVG(wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(wr_fee) AS total_return_fees FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN inventory inv ON inv.inv_date_sk = '2450815' JOIN web_returns wr ON wr.wr_refunded_customer_sk = c.c_customer_sk JOIN web_page wp ON wp.wp_web_page_sk = wr.wr_web_page_sk AND wp.wp_max_ad_count IN ('0', '1') JOIN time_dim t ON t.t_time_sk = wr.wr_returned_time_sk AND t.t_time_id IN ('AAAAAAAALDIAAAAA', 'AAAAAAAAPEJAAAAA', 'AAAAAAAAKMNAAAAA', 'AAAAAAAAIHFAAAAA', 'AAAAAAAAOEBBAAAA', 'AAAAAAAALNDAAAAA') JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk WHERE cd.cd_marital_status IN ('D', 'M', 'U', 'S', 'W') AND cd.cd_gender = 'M' GROUP BY c_birth_country, cd_gender, cd_marital_status, cd_education_status ORDER BY avg_purchase_estimate DESC, total_customers DESC LIMIT 100;
SELECT ca.ca_city, ca.ca_county, AVG(hd.hd_income_band_sk) AS avg_income_band, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, COUNT(DISTINCT wp.wp_web_page_sk) AS num_web_pages_created, COUNT(DISTINCT wp.wp_access_date_sk) AS num_web_pages_accessed, AVG(wp.wp_char_count) AS avg_web_page_char_count FROM customer_address ca JOIN household_demographics hd ON ca.ca_address_sk = hd.hd_demo_sk LEFT JOIN web_page wp ON ca.ca_address_sk = wp.wp_customer_sk WHERE ca.ca_city IN ('Morgantown', 'Forestville', 'Sutton', 'Mount Olive', 'Texas', 'Bridgeport') AND ca.ca_county IN ('Carlton County', 'Bonneville County') AND wp.wp_type IN ('blog', 'article', 'product_review') AND wp.wp_autogen_flag = 'N' GROUP BY ca.ca_city, ca.ca_county ORDER BY ca.ca_city, ca.ca_county;
SELECT s.s_store_name, s.s_floor_space, s.s_number_employees, s.s_city, s.s_state, dd.d_year, dd.d_quarter_name, SUM(i.inv_quantity_on_hand) AS total_inventory, AVG(i.inv_quantity_on_hand) AS average_inventory, COUNT(DISTINCT i.inv_item_sk) AS unique_items_count, COUNT(DISTINCT i.inv_warehouse_sk) AS unique_warehouses_count FROM inventory i JOIN store s ON i.inv_warehouse_sk = s.s_store_sk JOIN date_dim dd ON i.inv_date_sk = dd.d_date_sk WHERE dd.d_current_month = 'N' AND s.s_store_name LIKE ANY (ARRAY['%eing%', '%ought%', '%bar%', '%ation%', '%anti%', '%able%']) GROUP BY s.s_store_name, s.s_floor_space, s.s_number_employees, s.s_city, s.s_state, dd.d_year, dd.d_quarter_name ORDER BY s.s_state, s.s_city, dd.d_year, dd.d_quarter_name;
SELECT s_store_name, i_category, cd_gender, cd_education_status, r_reason_desc, COUNT(DISTINCT wr_item_sk) AS unique_items_returned, SUM(wr_return_quantity) AS total_return_quantity, AVG(wr_return_amt) AS avg_return_amount, AVG(i_wholesale_cost) AS avg_wholesale_cost, COUNT(wr_returned_date_sk) AS total_returns FROM web_returns JOIN item ON wr_item_sk = i_item_sk JOIN store ON s_store_sk = wr_returning_addr_sk JOIN customer_demographics ON cd_demo_sk = wr_returning_cdemo_sk JOIN reason ON r_reason_sk = wr_reason_sk JOIN date_dim ON wr_returned_date_sk = d_date_sk JOIN time_dim ON wr_returned_time_sk = t_time_sk WHERE d_year = 2022 AND s_state = 'CA' AND wr_return_amt > 0 AND i_current_price > i_wholesale_cost AND t_shift = 'third' GROUP BY s_store_name, i_category, cd_gender, cd_education_status, r_reason_desc ORDER BY total_return_quantity DESC, avg_return_amount DESC LIMIT 100;
SELECT s_store_name AS store_name, s_state AS store_state, CONCAT(s_city, ', ', s_state) AS store_location, d_year AS sales_year, d_quarter_name AS sales_quarter, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_sales, AVG(ss_net_paid) AS average_sales_per_transaction, SUM(ss_net_paid_inc_tax) AS total_sales_including_tax, SUM(ss_ext_tax) AS total_tax_collected, COUNT(DISTINCT ss_customer_sk) AS unique_customers, COUNT(DISTINCT ss_ticket_number) AS total_transactions, SUM(wr_return_amt) AS total_returns, SUM(wr_fee) AS total_return_fees, AVG(wr_return_ship_cost) AS average_return_shipping_cost, COUNT(DISTINCT wr_refunded_customer_sk) AS unique_customers_returned, COUNT(DISTINCT wr_order_number) AS total_return_transactions, SUM(wr_net_loss) AS total_net_loss_from_returns, r_reason_desc AS most_common_return_reason FROM store_sales JOIN store ON ss_store_sk = s_store_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk LEFT JOIN web_returns ON ss_item_sk = wr_item_sk AND ss_ticket_number = wr_order_number LEFT JOIN reason ON wr_reason_sk = r_reason_sk WHERE s_state IN ('NY', 'CA') AND d_year = 2023 GROUP BY s_store_name, s_state, s_city, d_year, d_quarter_name, r_reason_desc ORDER BY total_sales DESC, total_quantity_sold DESC LIMIT 10;
SELECT i_category, i_class, w_city, p_promo_name, SUM(ws_quantity) AS total_quantity_sold, AVG(ws_sales_price) AS average_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_paid_inc_tax) AS total_net_paid_inc_tax, COUNT(DISTINCT ws_order_number) AS total_orders, COUNT(DISTINCT ws_bill_cdemo_sk) AS total_unique_customers FROM web_sales JOIN item ON ws_item_sk = i_item_sk JOIN warehouse ON ws_warehouse_sk = w_warehouse_sk JOIN promotion ON ws_promo_sk = p_promo_sk JOIN customer_demographics ON ws_bill_cdemo_sk = cd_demo_sk WHERE w_city = 'Fairview' AND p_cost = 1000.00 AND p_channel_demo = 'N' GROUP BY i_category, i_class, w_city, p_promo_name ORDER BY total_net_paid DESC, total_quantity_sold DESC;
SELECT ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT cc.cc_call_center_sk) AS number_of_call_centers, AVG(cc.cc_employees) AS average_employees, SUM(p.p_cost) AS total_promotion_cost, COUNT(DISTINCT p.p_promo_sk) AS number_of_promotions FROM call_center cc JOIN promotion p ON (cc.cc_mkt_id = p.p_promo_sk) JOIN income_band ib ON (cc.cc_gmt_offset >= ib.ib_lower_bound AND cc.cc_gmt_offset < ib.ib_upper_bound) WHERE cc.cc_country = 'United States' AND cc.cc_rec_end_date IS NULL AND p.p_cost = 1000.00 AND ib.ib_lower_bound IN (30001, 10001, 140001, 90001, 0) GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ib.ib_lower_bound;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, ib.ib_income_band_sk, COUNT(sr.sr_item_sk) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(sr.sr_net_loss) AS total_net_loss FROM customer c JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN income_band ib ON c.c_current_hdemo_sk = ib.ib_income_band_sk WHERE sr.sr_return_quantity > 5 AND ib.ib_lower_bound >= 120001 AND (c.c_birth_year BETWEEN 1980 AND 1990) GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, ib.ib_income_band_sk ORDER BY total_net_loss DESC, avg_return_amount DESC LIMIT 100;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, r.r_reason_desc, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_items, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_tax) AS total_tax, SUM(cr.cr_return_ship_cost) AS total_ship_cost, SUM(cr.cr_net_loss) AS total_net_loss FROM call_center cc JOIN catalog_returns cr ON cc.cc_call_center_sk = cr.cr_call_center_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk WHERE cc.cc_zip = '31904' AND cr.cr_return_amt_inc_tax > 0 AND r.r_reason_desc IN ('Found a better price in a store', 'its is a boy') GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, r.r_reason_desc ORDER BY total_returns DESC, total_returned_items DESC;
SELECT ca_state, ca_country, AVG(ca_gmt_offset) AS avg_gmt_offset, COUNT(DISTINCT ca_address_sk) AS num_addresses, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT CASE WHEN t_hour BETWEEN 9 AND 17 THEN ca_address_sk END) AS num_addresses_business_hours FROM customer_address ca JOIN time_dim t ON t.t_time_sk = ca.ca_address_sk JOIN income_band ib ON ib.ib_income_band_sk = ca.ca_address_sk GROUP BY ca_state, ca_country, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ca_state, ca_country, ib.ib_lower_bound;
SELECT sm.sm_type, sm.sm_carrier, COUNT(DISTINCT wr.wr_item_sk) AS total_items_returned, SUM(wr.wr_return_quantity) AS total_quantity_returned, AVG(wr.wr_return_amt) AS average_return_amount, AVG(wr.wr_fee) AS average_fee, SUM(wr.wr_net_loss) AS total_net_loss, ws.web_name, ws.web_manager, ws.web_mkt_class, COUNT(DISTINCT ws.web_site_sk) AS total_sites FROM web_returns wr JOIN ship_mode sm ON wr.wr_returned_date_sk = sm.sm_ship_mode_sk JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk WHERE ws.web_mkt_id IN (3, 4, 6, 2) AND ws.web_street_name = 'Hickory 3rd' AND wr.wr_returned_date_sk BETWEEN 100 AND 200 GROUP BY sm.sm_type, sm.sm_carrier, ws.web_name, ws.web_manager, ws.web_mkt_class ORDER BY total_net_loss DESC, total_quantity_returned DESC LIMIT 10;
