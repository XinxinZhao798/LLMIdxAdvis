SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(wr.wr_return_amt) AS total_return_amt, COUNT(DISTINCT wr.wr_order_number) AS total_returns, (SUM(ws.ws_net_paid_inc_tax) - SUM(wr.wr_return_amt_inc_tax)) AS net_sales_after_returns FROM web_sales ws LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk WHERE ws.ws_sold_date_sk BETWEEN '2451330' AND '2451329' AND cd.cd_dep_employed_count = '0' GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY total_net_paid DESC, total_returns DESC;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_state, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, SUM(cs.cs_net_paid) AS total_net_paid, AVG(cs.cs_net_profit) AS avg_net_profit FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN store s ON ca.ca_state = s.s_state WHERE dd.d_current_quarter = 'N' AND dd.d_following_holiday = 'N' AND cd.cd_credit_rating = 'Good' AND s.s_market_id IS NOT NULL GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state ORDER BY dd.d_year, dd.d_quarter_name, ca.ca_state;
SELECT cp.cp_department, dd.d_year, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount, AVG(cr.cr_return_quantity) AS avg_return_quantity, COUNT(cr.cr_order_number) AS total_returned_orders FROM catalog_returns cr JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN date_dim dd ON cr.cr_returned_date_sk = dd.d_date_sk JOIN household_demographics hd ON cr.cr_returning_cdemo_sk = hd.hd_demo_sk WHERE cp.cp_type = 'monthly' AND hd.hd_buy_potential = 'Unknown' GROUP BY cp.cp_department, dd.d_year ORDER BY total_return_amount DESC, cp.cp_department, dd.d_year;
SELECT i.i_category, i.i_brand, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN web_page wp ON cr.cr_catalog_page_sk = wp.wp_web_page_sk WHERE i.i_brand_id IN ('10003002', '8008007', '7015003', '9001006', '10011007', '10010015') AND wp.wp_url = 'http://www.foo.com' AND wp.wp_customer_sk IN ('98633', '80555') AND cr.cr_ship_mode_sk IN ('10', '18', '12', '2', '6', '8') GROUP BY i.i_category, i.i_brand ORDER BY total_returns DESC, total_returned_quantity DESC;
SELECT dd.d_year AS year, h.hd_income_band_sk AS income_band, r.r_reason_desc AS return_reason, SUM(ss.ss_net_paid) AS total_sales, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, AVG(ss.ss_quantity) AS average_quantity_sold, SUM(cr.cr_return_amount) AS total_returns, COUNT(DISTINCT cr.cr_order_number) AS total_return_transactions, AVG(cr.cr_return_quantity) AS average_quantity_returned FROM date_dim dd LEFT JOIN store_sales ss ON dd.d_date_sk = ss.ss_sold_date_sk LEFT JOIN catalog_returns cr ON dd.d_date_sk = cr.cr_returned_date_sk LEFT JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk LEFT JOIN household_demographics h ON ss.ss_hdemo_sk = h.hd_demo_sk WHERE dd.d_year IS NOT NULL AND (r.r_reason_id IN ('AAAAAAAANAAAAAAA', 'AAAAAAAALBAAAAAA', 'AAAAAAAALAAAAAAA', 'AAAAAAAADAAAAAAA', 'AAAAAAAAJBAAAAAA') OR r.r_reason_id IS NULL) GROUP BY year, income_band, return_reason ORDER BY year, income_band, total_sales DESC;
SELECT ca_state, COUNT(cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN customer_address ON catalog_sales.cs_ship_addr_sk = customer_address.ca_address_sk GROUP BY ca_state HAVING SUM(cs_net_paid_inc_tax) > 50000 ORDER BY total_net_profit DESC;
SELECT ca.ca_state AS customer_state, cp.cp_department AS department, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(cr.cr_item_sk) AS total_return_count, SUM(cr.cr_net_loss) AS total_net_loss, SUM(p.p_cost) AS total_promotion_cost FROM catalog_returns cr JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN promotion p ON cp.cp_catalog_page_sk = p.p_item_sk WHERE cp.cp_department IN ('Electronics', 'Home & Garden', 'Books') AND p.p_cost > 1000 AND cp.cp_end_date_sk IN (2450934, 2451664) AND ca.ca_state = 'CA' AND ca.ca_gmt_offset = -8.00 GROUP BY customer_state, department ORDER BY total_net_loss DESC, total_return_count DESC;
SELECT i.i_category, s.s_state, s.s_market_id, COUNT(DISTINCT i.i_item_sk) AS total_items, AVG(i.i_current_price) AS avg_price, SUM(i.i_wholesale_cost) AS total_wholesale_cost, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages, wp.wp_type, COUNT(DISTINCT wp.wp_customer_sk) AS total_customers_accessed FROM item i JOIN store s ON i.i_manufact_id = s.s_company_id JOIN web_page wp ON wp.wp_type = 'order' WHERE i.i_category IN ('Books', 'Sports', 'Women', 'Men') AND s.s_state = 'TN' AND s.s_market_id = '7' AND i.i_current_price BETWEEN 2.21 AND 81.80 AND (wp.wp_creation_date_sk BETWEEN '2450811' AND '2450813' OR wp.wp_creation_date_sk = '2450808') GROUP BY i.i_category, s.s_state, s.s_market_id, wp.wp_type ORDER BY total_items DESC, avg_price DESC, total_wholesale_cost DESC;
SELECT w_state, AVG(w_warehouse_sq_ft) AS avg_warehouse_sq_ft, SUM(inv_quantity_on_hand) AS total_inventory_on_hand, AVG(sr_return_amt) AS avg_return_amt, SUM(sr_net_loss) AS total_net_loss FROM warehouse w JOIN inventory i ON w.w_warehouse_sk = i.inv_warehouse_sk JOIN store_returns sr ON i.inv_item_sk = sr.sr_item_sk GROUP BY w_state ORDER BY w_state;
SELECT hd.hd_demo_sk, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, COUNT(DISTINCT wr.wr_order_number) AS total_web_returns, SUM(sr.sr_return_amt) AS total_store_return_amount, AVG(sr.sr_return_amt) AS avg_store_return_amount, SUM(wr.wr_return_amt) AS total_web_return_amount, AVG(wr.wr_return_amt) AS avg_web_return_amount, SUM(CASE WHEN p.p_channel_radio = 'N' AND p.p_channel_demo = 'N' THEN p.p_cost ELSE 0 END) AS non_radio_demo_promo_cost, AVG(CASE WHEN p.p_channel_radio = 'N' AND p.p_channel_demo = 'N' THEN p.p_response_target ELSE NULL END) AS avg_non_radio_demo_response_target FROM household_demographics hd LEFT JOIN store_returns sr ON hd.hd_demo_sk = sr.sr_hdemo_sk LEFT JOIN web_returns wr ON (hd.hd_demo_sk = wr.wr_refunded_hdemo_sk OR hd.hd_demo_sk = wr.wr_returning_hdemo_sk) LEFT JOIN promotion p ON p.p_promo_sk = sr.sr_reason_sk WHERE hd.hd_demo_sk IN (560, 4858) AND (sr.sr_store_sk IN (8, 10) OR sr.sr_store_sk IS NULL) GROUP BY hd.hd_demo_sk ORDER BY hd.hd_demo_sk;
SELECT c.c_customer_id, i.i_category, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(ss.ss_quantity) AS total_sales_quantity, SUM(ss.ss_net_paid) AS total_sales_net_paid, AVG(ss.ss_sales_price) AS avg_sales_price, (SUM(ss.ss_net_paid) - SUM(cr.cr_net_loss)) AS net_profit_after_returns FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN customer c ON cr.cr_returning_customer_sk = c.c_customer_sk JOIN store_sales ss ON i.i_item_sk = ss.ss_item_sk AND c.c_customer_sk = ss.ss_customer_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk WHERE ss.ss_hdemo_sk IN (863, 2132, 2496) GROUP BY c.c_customer_id, i.i_category ORDER BY net_profit_after_returns DESC, total_sales_net_paid DESC;
