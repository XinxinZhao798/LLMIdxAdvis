SELECT ws.ws_web_site_sk, web.web_name, COUNT(ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit, SUM(cr.cr_net_loss) AS total_net_loss, (SUM(ws.ws_net_profit) - SUM(cr.cr_net_loss)) AS net_gain_loss, COUNT(DISTINCT ws.ws_bill_customer_sk) AS unique_customers, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_returning_customers, COUNT(DISTINCT cr.cr_item_sk) AS unique_returned_items, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk LEFT JOIN catalog_returns cr ON ws.ws_order_number = cr.cr_order_number AND ws.ws_item_sk = cr.cr_item_sk WHERE web.web_county = 'Williamson County' AND (web.web_rec_end_date = '2000-08-15' OR web.web_rec_end_date = '1999-08-16') AND (ws.ws_ext_sales_price = 1271.34 OR ws.ws_ext_sales_price = 2832.48 OR ws.ws_ext_sales_price = 205.59 OR ws.ws_ext_sales_price = 4175.82 OR ws.ws_ext_sales_price = 885.30) GROUP BY ws.ws_web_site_sk, web.web_name ORDER BY net_gain_loss DESC;
SELECT ws.ws_web_site_sk, ws.ws_web_page_sk, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, w.w_warehouse_name, w.w_county, cd.cd_gender, cd.cd_education_status, cd.cd_credit_rating, COUNT(DISTINCT cd.cd_demo_sk) AS unique_customers FROM web_sales ws JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk WHERE ws.ws_web_page_sk IN ('8', '48', '14', '26', '5') AND w.w_street_name IN ('Ash Laurel', '6th', 'Wilson Elm', 'View First') AND w.w_county = 'Williamson County' AND cd.cd_credit_rating IN ('High Risk', 'Low Risk', 'Good', 'Unknown') GROUP BY ws.ws_web_site_sk, ws.ws_web_page_sk, w.w_warehouse_name, w.w_county, cd.cd_gender, cd.cd_education_status, cd.cd_credit_rating ORDER BY total_net_profit DESC, total_net_paid DESC;
SELECT cp_department, cd_gender, cd_marital_status, cd_education_status, COUNT(DISTINCT sr_ticket_number) AS total_returns, SUM(sr_return_quantity) AS total_returned_quantity, AVG(sr_return_amt) AS average_return_amount, SUM(sr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(sr_fee) AS total_fees, SUM(sr_net_loss) AS total_net_loss FROM catalog_page JOIN store_returns ON cp_catalog_page_sk = sr_returned_date_sk JOIN customer_demographics ON cd_demo_sk = sr_cdemo_sk WHERE cp_department = 'DEPARTMENT' AND (cp_start_date_sk = 2451665 OR cp_start_date_sk = 2451360) GROUP BY cp_department, cd_gender, cd_marital_status, cd_education_status ORDER BY total_returned_quantity DESC;
SELECT ca.ca_state, EXTRACT(YEAR FROM cc.cc_rec_start_date) AS year_started, COUNT(DISTINCT cc.cc_call_center_sk) AS num_call_centers, AVG(cc.cc_employees) AS avg_employees, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_with_tax, SUM(ws.ws_net_paid_inc_ship_tax) AS total_web_sales_amount_with_ship_tax, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, COUNT(DISTINCT r.r_reason_sk) AS num_unique_reasons FROM call_center cc JOIN store_returns sr ON sr.sr_store_sk = cc.cc_call_center_sk JOIN web_sales ws ON ws.ws_warehouse_sk = cc.cc_call_center_sk JOIN customer_address ca ON ca.ca_address_sk = sr.sr_addr_sk JOIN household_demographics hd ON hd.hd_demo_sk = sr.sr_hdemo_sk JOIN reason r ON r.r_reason_sk = sr.sr_reason_sk JOIN warehouse w ON w.w_warehouse_sk = ws.ws_warehouse_sk WHERE (w.w_warehouse_sq_ft = 621234 OR w.w_warehouse_sq_ft = 294242 OR w.w_warehouse_sq_ft = 977787 OR w.w_warehouse_sq_ft = 138504) AND (w.w_warehouse_sk = 2 OR w.w_warehouse_sk = 1) AND (ws.ws_ext_tax = 127.26 OR ws.ws_ext_tax = 30.44) AND hd.hd_vehicle_count = 3 AND (r.r_reason_sk = 25 OR r.r_reason_sk = 20 OR r.r_reason_sk = 4) GROUP BY ca.ca_state, year_started ORDER BY total_return_amount_with_tax DESC, total_web_sales_amount_with_ship_tax DESC;
SELECT cc.cc_state, cc.cc_city, cc.cc_name, AVG(ss.ss_net_profit) AS avg_net_profit, SUM(ss.ss_quantity) AS total_quantity_sold, COUNT(DISTINCT ss.ss_store_sk) AS number_of_stores, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(cc.cc_employees) AS total_employees_in_call_centers, AVG(cc.cc_tax_percentage) AS avg_tax_percentage_by_state FROM store_sales ss JOIN call_center cc ON ss.ss_store_sk = cc.cc_call_center_sk JOIN time_dim td ON ss.ss_sold_time_sk = td.t_time_sk WHERE ss.ss_sold_date_sk IN (SELECT inv_date_sk FROM inventory WHERE inv_quantity_on_hand IN (816, 142, 984)) AND cc.cc_tax_percentage IN (0.01, 0.12, 0.05, 0.11) AND ss.ss_net_profit IN (5.76, 45.76, 66.12, -885.72, -4074.40) AND ss.ss_hdemo_sk IN (7132, 594, 6065, 5700) GROUP BY cc.cc_state, cc.cc_city, cc.cc_name ORDER BY avg_net_profit DESC;
SELECT p.p_promo_name, COUNT(DISTINCT c.c_customer_sk) AS number_of_customers, AVG(ca.ca_gmt_offset) AS average_gmt_offset, SUM(p.p_cost) AS total_promotion_cost, COUNT(DISTINCT web.web_site_sk) AS number_of_websites, web.web_state, ca.ca_state AS customer_address_state, web.web_country, ca.ca_country AS customer_address_country, COUNT(DISTINCT cp.cp_catalog_page_sk) AS number_of_catalog_pages FROM promotion p JOIN customer c ON c.c_current_hdemo_sk = p.p_item_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN web_site web ON web.web_company_id = p.p_item_sk JOIN catalog_page cp ON cp.cp_department = web.web_class WHERE p.p_channel_email = 'N' AND ca.ca_address_id IN ('AAAAAAAADOMAAAAA', 'AAAAAAAABLHAAAAA') AND p.p_cost = 1000.00 AND web.web_street_number = '247' AND cp.cp_type = 'Catalog' GROUP BY web.web_state, ca.ca_state, web.web_country, ca.ca_country, p.p_promo_name HAVING COUNT(DISTINCT c.c_customer_sk) > 10 ORDER BY total_promotion_cost DESC, number_of_customers DESC LIMIT 100;
SELECT i.i_category, i.i_class, i.i_brand, cd.cd_gender, cd.cd_education_status, SUM(ws.ws_sales_price) AS total_sales, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(*) AS number_of_sales, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cr.cr_order_number) AS number_of_returns FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk LEFT JOIN catalog_returns cr ON ws.ws_order_number = cr.cr_order_number AND ws.ws_item_sk = cr.cr_item_sk LEFT JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk GROUP BY i.i_category, i.i_class, i.i_brand, cd.cd_gender, cd.cd_education_status ORDER BY i.i_category, i.i_class, i.i_brand, cd.cd_gender, cd.cd_education_status;
SELECT cp.cp_department, COUNT(*) AS total_catalog_pages, AVG(cp.cp_catalog_number) AS average_catalog_number, SUM(inv.inv_quantity_on_hand) AS total_inventory_quantity, AVG(wr.wr_return_amt_inc_tax) AS average_return_amount_inc_tax, COUNT(DISTINCT wr.wr_order_number) AS total_returned_orders, COUNT(DISTINCT cd.cd_demo_sk) AS unique_customers, SUM(CASE WHEN hd.hd_income_band_sk IS NOT NULL THEN 1 ELSE 0 END) AS households_with_income_band, sm.sm_type AS shipping_type, COUNT(DISTINCT sm.sm_ship_mode_sk) AS count_shipping_modes, ROUND(SUM(wr.wr_fee)::numeric, 2) AS total_fees_collected, ROUND(SUM(wr.wr_reversed_charge)::numeric, 2) AS total_reversed_charges FROM catalog_page cp LEFT JOIN inventory inv ON cp.cp_catalog_page_sk = inv.inv_item_sk LEFT JOIN web_returns wr ON inv.inv_item_sk = wr.wr_item_sk LEFT JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk LEFT JOIN household_demographics hd ON wr.wr_returning_hdemo_sk = hd.hd_demo_sk LEFT JOIN ship_mode sm ON sm.sm_ship_mode_sk IN (9, 10) WHERE cp.cp_start_date_sk IS NOT NULL AND cp.cp_end_date_sk IS NOT NULL AND (wr.wr_reversed_charge IN ('35.79', '219.13', '107.56', '7.03') OR wr.wr_fee IN ('60.42', '16.01', '7.56', '22.38')) AND (inv.inv_quantity_on_hand IN (932, 682, 540) OR inv.inv_item_sk IN (12650, 13507, 12682, 13526)) GROUP BY cp.cp_department, sm.sm_type ORDER BY total_catalog_pages DESC, average_return_amount_inc_tax DESC;
