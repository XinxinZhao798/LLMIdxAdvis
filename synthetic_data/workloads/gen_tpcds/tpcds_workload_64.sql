SELECT ca_state, cc_division_name, AVG(cc_employees) AS avg_cc_employees, COUNT(DISTINCT cc_call_center_sk) AS num_call_centers, SUM(hd_dep_count) AS total_dependents, AVG(hd_vehicle_count) AS avg_num_vehicles, COUNT(DISTINCT c_customer_sk) AS num_customers, COUNT(CASE WHEN hd_buy_potential = '0-500' THEN 1 END) AS count_low_buy_potential, COUNT(CASE WHEN hd_buy_potential = '>10000' THEN 1 END) AS count_high_buy_potential FROM call_center JOIN customer ON c_current_cdemo_sk = cc_call_center_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk WHERE (cc_rec_end_date = '2000-12-31' OR cc_rec_end_date = '2001-12-31') AND hd_dep_count IN (4, 7, 0, 3) AND ca_street_name = 'Fourth Lakeview' GROUP BY ca_state, cc_division_name ORDER BY ca_state, cc_division_name;
SELECT p.p_promo_name, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, AVG(sr.sr_return_amt) AS avg_return_amount, r.r_reason_desc AS most_common_return_reason, COUNT(*) AS reason_count FROM store_returns sr JOIN promotion p ON sr.sr_item_sk = p.p_item_sk JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk LEFT JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE sr.sr_store_sk IN (1, 4, 8) AND p.p_item_sk IN (13903, 4790, 11371, 10280, 11452) AND hd.hd_vehicle_count IN (3, 1) GROUP BY p.p_promo_name, r.r_reason_desc ORDER BY total_returns DESC, avg_return_amount DESC, reason_count DESC LIMIT 100;
SELECT ws_order_number, COUNT(DISTINCT ws_item_sk) AS item_count, SUM(ws_quantity) AS total_quantity, AVG(ws_sales_price) AS avg_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ws_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(ws_net_profit) AS total_net_profit, MIN(ws_ext_ship_cost) AS min_shipping_cost, MAX(ws_ext_ship_cost) AS max_shipping_cost FROM web_sales JOIN catalog_sales ON ws_item_sk = cs_item_sk AND ws_order_number = cs_order_number JOIN store_sales ON ws_item_sk = ss_item_sk AND ws_order_number = ss_ticket_number JOIN web_page ON ws_web_page_sk = wp_web_page_sk JOIN inventory ON ws_item_sk = inv_item_sk WHERE ws_sales_price BETWEEN 100 AND 200 AND cs_sales_price BETWEEN 100 AND 200 AND ss_sales_price BETWEEN 100 AND 200 AND ws_ext_ship_cost BETWEEN 10 AND 1360 AND wp_type = 'Product Review' GROUP BY ws_order_number HAVING COUNT(DISTINCT ws_item_sk) > 1 ORDER BY total_net_profit DESC;
SELECT d_year, d_quarter_name, cd_gender, cd_education_status, SUM(ws_net_profit) AS total_net_profit, AVG(ws_quantity) AS avg_quantity_sold, COUNT(DISTINCT ws_order_number) AS total_orders, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT sr_ticket_number) AS total_return_transactions FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN customer_demographics ON ws_bill_cdemo_sk = cd_demo_sk LEFT JOIN store_returns ON sr_customer_sk = ws_bill_customer_sk AND sr_returned_date_sk = ws_sold_date_sk WHERE d_year = 1999 AND cd_dep_employed_count = 0 AND ws_ext_tax IN ('56.09', '24.79', '237.72', '4.60', '438.93', '37.94') AND ws_web_site_sk IN ('15', '25', '16', '12', '19') AND sr_customer_sk IN ('34000', '49632', '58331', '36235') GROUP BY d_year, d_quarter_name, cd_gender, cd_education_status ORDER BY total_net_profit DESC, total_orders DESC;
SELECT p.p_promo_id, p.p_promo_name, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(DISTINCT ws.ws_item_sk) AS number_of_items_sold, SUM(cr.cr_return_amount) AS total_returns, COUNT(DISTINCT cr.cr_item_sk) AS number_of_items_returned FROM web_sales ws JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk LEFT JOIN catalog_returns cr ON ws.ws_item_sk = cr.cr_item_sk AND ws.ws_order_number = cr.cr_order_number JOIN item i ON ws.ws_item_sk = i.i_item_sk WHERE i.i_class_id = 4 AND c.c_birth_country IN ('GABON', 'ALBANIA', 'RUSSIAN FEDERATION', 'CHINA', 'BELGIUM', 'PORTUGAL') GROUP BY p.p_promo_id, p.p_promo_name ORDER BY total_net_profit DESC;
