SELECT ca.ca_state AS customer_state, SUM(CASE WHEN dd.d_year = 2022 THEN ss.ss_net_paid ELSE 0 END) AS total_sales_2022, SUM(CASE WHEN dd.d_year = 2022 THEN sr.sr_return_amt ELSE 0 END) AS total_returns_2022, COUNT(DISTINCT CASE WHEN dd.d_year = 2022 THEN ss.ss_ticket_number ELSE NULL END) AS sales_transactions_2022, COUNT(DISTINCT CASE WHEN dd.d_year = 2022 THEN sr.sr_ticket_number ELSE NULL END) AS return_transactions_2022, SUM(CASE WHEN dd.d_year = 2023 THEN ss.ss_net_paid ELSE 0 END) AS total_sales_2023, SUM(CASE WHEN dd.d_year = 2023 THEN sr.sr_return_amt ELSE 0 END) AS total_returns_2023, COUNT(DISTINCT CASE WHEN dd.d_year = 2023 THEN ss.ss_ticket_number ELSE NULL END) AS sales_transactions_2023, COUNT(DISTINCT CASE WHEN dd.d_year = 2023 THEN sr.sr_ticket_number ELSE NULL END) AS return_transactions_2023 FROM store_sales ss FULL OUTER JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk JOIN date_dim dd ON (ss.ss_sold_date_sk = dd.d_date_sk OR sr.sr_returned_date_sk = dd.d_date_sk) LEFT JOIN customer_address ca ON (ss.ss_addr_sk = ca.ca_address_sk OR sr.sr_addr_sk = ca.ca_address_sk) WHERE dd.d_year IN (2022, 2023) GROUP BY ca.ca_state ORDER BY ca.ca_state;
SELECT cc.cc_city, i.i_category, COUNT(DISTINCT cc.cc_call_center_sk) AS total_call_centers, SUM(cc.cc_employees) AS total_employees, AVG(cc.cc_sq_ft) AS avg_square_footage, COUNT(DISTINCT i.i_item_sk) AS total_items, AVG(i.i_current_price) AS avg_item_price, MIN(ib.ib_lower_bound) AS min_income_band_lower_bound, MAX(ib.ib_upper_bound) AS max_income_band_upper_bound, AVG(cc.cc_tax_percentage) AS avg_tax_percentage FROM call_center cc JOIN item i ON cc.cc_division = i.i_manufact_id JOIN income_band ib ON ib.ib_income_band_sk = cc.cc_mkt_id WHERE cc.cc_street_type IN ('Boulevard', 'RD', 'Way') AND i.i_units IN ('Dram', 'Ounce', 'Gram') AND ib.ib_income_band_sk IN (3, 5, 7, 8) AND cc.cc_tax_percentage BETWEEN 0.01 AND 0.12 GROUP BY cc.cc_city, i.i_category ORDER BY total_call_centers DESC, avg_item_price ASC LIMIT 10;
SELECT s.s_division_name, cc.cc_class, dd.d_year, COUNT(DISTINCT s.s_store_sk) AS num_stores, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_net_paid) AS average_sales_per_store, MAX(ss.ss_net_paid) AS max_sales_per_store, MIN(ss.ss_net_paid) AS min_sales_per_store FROM store_sales ss INNER JOIN store s ON ss.ss_store_sk = s.s_store_sk INNER JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk INNER JOIN call_center cc ON s.s_market_id = cc.cc_mkt_id WHERE cc.cc_class IN ('small', 'medium', 'large') AND dd.d_year = 2022 GROUP BY s.s_division_name, cc.cc_class, dd.d_year ORDER BY s.s_division_name, cc.cc_class, total_sales DESC;
SELECT cd_gender, cd_marital_status, cd_education_status, sm_type, COUNT(*) AS total_returns, SUM(cr_return_amount) AS total_refund_amount, AVG(cr_return_quantity) AS avg_return_quantity, SUM(cr_fee) AS total_fees, SUM(cr_return_ship_cost) AS total_shipping_costs, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN customer_demographics cd ON cr.cr_returning_cdemo_sk = cd.cd_demo_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN time_dim td ON cr.cr_returned_time_sk = td.t_time_sk JOIN promotion p ON cr.cr_order_number = p.p_promo_sk WHERE td.t_sub_shift = 'night' AND p.p_channel_dmail = 'Y' AND p.p_discount_active = 'N' GROUP BY cd_gender, cd_marital_status, cd_education_status, sm_type ORDER BY total_returns DESC, total_refund_amount DESC;
SELECT cc.cc_division_name, cc.cc_class, wp.wp_type, COUNT(*) AS number_of_calls, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_fee) AS total_fee_collected, SUM(cr.cr_return_ship_cost) AS total_shipping_cost, SUM(cr.cr_net_loss) AS total_net_loss FROM call_center AS cc JOIN catalog_returns AS cr ON cc.cc_call_center_sk = cr.cr_call_center_sk JOIN web_page AS wp ON cr.cr_catalog_page_sk = wp.wp_web_page_sk WHERE cc.cc_division_name LIKE '%anti%' AND (cc.cc_class = 'small' OR cc.cc_class = 'large') AND (wp.wp_char_count = 3128 OR wp.wp_char_count = 701 OR wp.wp_char_count = 2129) GROUP BY cc.cc_division_name, cc.cc_class, wp.wp_type ORDER BY cc.cc_division_name, cc.cc_class, wp.wp_type;
SELECT d.d_year, d.d_quarter_name, d.d_moy, d.d_holiday, w.w_city, w.w_gmt_offset, SUM(wp.wp_link_count) AS total_links, AVG(wp.wp_char_count) AS average_char_count, COUNT(DISTINCT wp.wp_customer_sk) AS distinct_customers, COUNT(*) AS page_count FROM web_page wp JOIN date_dim d ON wp.wp_access_date_sk = d.d_date_sk JOIN warehouse w ON w.w_gmt_offset = '-5.00' WHERE d.d_moy IN ('5', '11') AND (d.d_holiday = 'Y' OR d.d_holiday = 'N') AND w.w_city = 'Fairview' AND NOT EXISTS ( SELECT 1 FROM time_dim t WHERE t.t_time_sk = wp.wp_access_date_sk AND t.t_sub_shift = 'night' ) GROUP BY d.d_year, d.d_quarter_name, d.d_moy, d.d_holiday, w.w_city, w.w_gmt_offset ORDER BY d.d_year, d.d_quarter_name, d.d_moy, total_links DESC;
SELECT ib.ib_income_band_sk, avg(hd.hd_dep_count) AS average_dependents, avg(hd.hd_vehicle_count) AS average_vehicles, sum(cs.cs_quantity) AS total_quantity_sold, sum(cs.cs_net_paid) AS total_net_paid, sum(cs.cs_net_profit) AS total_net_profit, count(DISTINCT cs.cs_order_number) AS total_orders FROM household_demographics hd JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN catalog_sales cs ON hd.hd_demo_sk = cs.cs_bill_hdemo_sk WHERE hd.hd_dep_count IN (9, 7) AND cs.cs_catalog_page_sk IN (149, 116) AND cs.cs_ext_discount_amt IN (1062.45, 2397.98, 286.76) AND ib.ib_income_band_sk IN (8, 5, 2, 9, 13) GROUP BY ib.ib_income_band_sk ORDER BY total_net_profit DESC;
SELECT ws.web_name, ws.web_market_manager, ws.web_class, ws.web_city, COUNT(DISTINCT wp.wp_web_page_sk) AS total_pages, SUM(wp.wp_image_count) AS total_images, SUM(wp.wp_link_count) AS total_links, AVG(wp.wp_char_count) AS avg_char_count, SUM(sr.sr_return_quantity) AS total_returned_quantity, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, COUNT(DISTINCT sr.sr_customer_sk) AS distinct_returning_customers, dd.d_year, dd.d_quarter_name, SUM(CASE WHEN dd.d_holiday = 'Y' THEN 1 ELSE 0 END) AS holiday_count, SUM(CASE WHEN dd.d_weekend = 'Y' THEN 1 ELSE 0 END) AS weekend_count FROM web_site ws JOIN web_page wp ON ws.web_site_sk = wp.wp_web_page_sk JOIN date_dim dd ON wp.wp_access_date_sk = dd.d_date_sk LEFT JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk WHERE dd.d_year IN (2020, 2021) AND ws.web_market_manager IN ('Gilbert Chapman', 'Jeffrey Campbell', 'Keith Frazier') AND ws.web_close_date_sk IS NULL GROUP BY ws.web_name, ws.web_market_manager, ws.web_class, ws.web_city, dd.d_year, dd.d_quarter_name ORDER BY ws.web_market_manager, ws.web_name, dd.d_year, dd.d_quarter_name;
SELECT cc.cc_name AS call_center_name, w.w_warehouse_name AS warehouse_name, s.s_state AS state, SUM(cs.cs_quantity) AS total_items_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_item_sk) AS number_of_unique_items_sold FROM catalog_sales cs INNER JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk INNER JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk INNER JOIN store s ON cc.cc_division = s.s_division_id WHERE cc.cc_market_manager IN ('Matthew Clifton', 'Gary Colburn') AND s.s_country = 'United States' GROUP BY call_center_name, warehouse_name, state ORDER BY total_items_sold DESC, average_sales_price DESC;
SELECT d.d_year, d.d_quarter_name, s.s_state, sm.sm_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_net_paid) AS total_revenue, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_profit FROM catalog_sales cs JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN store s ON cs.cs_ship_addr_sk = s.s_store_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk WHERE d.d_year = (SELECT MAX(d_year) FROM date_dim) - 1 AND s.s_rec_end_date IS NULL GROUP BY d.d_year, d.d_quarter_name, s.s_state, sm.sm_type ORDER BY d.d_year, d.d_quarter_name, s.s_state, sm.sm_type;
SELECT sm.sm_type, w.w_state, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_net_loss) AS total_net_loss, SUM(cs.cs_sales_price) AS total_sales, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_net_profit, SUM(i.inv_quantity_on_hand) AS total_inventory_on_hand FROM catalog_returns cr JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN catalog_sales cs ON cr.cr_item_sk = cs.cs_item_sk AND cr.cr_order_number = cs.cs_order_number JOIN inventory i ON cr.cr_item_sk = i.inv_item_sk AND w.w_warehouse_sk = i.inv_warehouse_sk WHERE cr.cr_returning_customer_sk IN ('98306', '44541', '85') GROUP BY sm.sm_type, w.w_state ORDER BY total_net_loss DESC;
SELECT ws2.web_name AS website, ws2.web_market_manager AS market_manager, cd.cd_gender AS customer_gender, SUM(ws.ws_sales_price) AS total_sales, AVG(ws.ws_sales_price) AS average_sales, COUNT(DISTINCT ws.ws_order_number) AS number_of_orders, SUM(ws.ws_quantity) AS total_quantity_sold, COUNT(DISTINCT c.c_customer_sk) AS number_of_customers, ca.ca_state AS customer_state, ca.ca_city AS customer_city FROM web_sales ws JOIN web_site ws2 ON ws.ws_web_site_sk = ws2.web_site_sk JOIN customer c ON ws.ws_ship_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk WHERE ws.ws_sold_date_sk BETWEEN 2450815 AND 2450815 + 30 AND ws.ws_promo_sk = 212 AND ws2.web_market_manager IN ('Jeffrey Martin', 'William Reyes', 'Kelvin Lynch', 'Frank Cooper', 'Keith Williams', 'John Isaacs') AND ca.ca_gmt_offset BETWEEN -5 AND -3 GROUP BY ws2.web_name, ws2.web_market_manager, cd.cd_gender, ca.ca_state, ca.ca_city ORDER BY total_sales DESC, number_of_orders DESC;
SELECT sm.sm_type AS shipping_type, web.web_site_sk AS website_id, web.web_name AS website_name, i.i_category AS product_category, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_incl_tax, SUM(ws.ws_net_paid_inc_ship) AS total_net_paid_incl_shipping, SUM(ws.ws_net_paid_inc_ship_tax) AS total_net_paid_incl_shipping_tax, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk WHERE sm.sm_type IN ('REGULAR', 'EXPRESS', 'OVERNIGHT') AND web.web_country = 'United States' AND ws.ws_warehouse_sk IN (2, 4) AND i.i_category IN ('Electronics', 'Women', 'Children', 'Home', 'Sports', 'Books') AND dd.d_year = 1999 GROUP BY shipping_type, website_id, website_name, product_category ORDER BY total_net_profit DESC, total_net_paid DESC, website_name, product_category;
SELECT dd.d_year, dd.d_quarter_name, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit, cc.cc_name AS call_center_name, cc.cc_division_name AS call_center_division, cc.cc_city AS call_center_city FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk WHERE dd.d_qoy IN (1, 2, 3, 4) AND dd.d_dom IN (20, 24) AND cc.cc_sq_ft IN ('4134', '1138', '2268') AND cc.cc_division IN ('1', '4') GROUP BY dd.d_year, dd.d_quarter_name, cc.cc_name, cc.cc_division_name, cc.cc_city ORDER BY dd.d_year, dd.d_quarter_name, total_net_profit DESC;
SELECT cp.cp_department, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_items_sold, SUM(ss.ss_net_paid) AS total_net_sales, AVG(ss.ss_ext_discount_amt) AS average_discount_amount, AVG(ss.ss_coupon_amt) AS average_coupon_amount, COUNT(DISTINCT ws.ws_order_number) AS total_web_transactions, SUM(ws.ws_quantity) AS total_web_items_sold, SUM(ws.ws_net_paid) AS total_web_net_sales, AVG(ws.ws_ext_discount_amt) AS average_web_discount_amount, AVG(ws.ws_coupon_amt) AS average_web_coupon_amount FROM catalog_page cp LEFT JOIN store_sales ss ON cp.cp_catalog_page_sk = ss.ss_item_sk LEFT JOIN web_sales ws ON cp.cp_catalog_page_sk = ws.ws_item_sk LEFT JOIN customer c ON (ss.ss_customer_sk = c.c_customer_sk OR ws.ws_bill_customer_sk = c.c_customer_sk) LEFT JOIN promotion p ON (ss.ss_promo_sk = p.p_promo_sk OR ws.ws_promo_sk = p.p_promo_sk) WHERE c.c_current_addr_sk IN ('19802', '46929', '21311', '47125', '38184', '20733') AND ss.ss_customer_sk IN ('4421', '99300', '61176', '55450', '48911', '11041') AND cp.cp_department = 'DEPARTMENT' AND p.p_response_target = 1 AND p.p_channel_event = 'N' GROUP BY cp.cp_department, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo ORDER BY cp.cp_department, total_net_sales DESC;
SELECT dd.d_year, cc.cc_country, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sales_price, COUNT(DISTINCT wp.wp_web_page_sk) AS webpage_count, SUM(ss.ss_net_paid) - SUM(ss.ss_net_paid_inc_tax) AS total_tax_collected FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN call_center cc ON cc.cc_call_center_sk = ss.ss_store_sk LEFT JOIN web_page wp ON dd.d_date_sk = wp.wp_access_date_sk WHERE dd.d_current_week = 'N' AND cc.cc_country = 'United States' AND cc.cc_call_center_sk IN ('3', '1', '5') AND wp.wp_image_count IN ('1', '2', '4', '5', '6', '7') GROUP BY dd.d_year, cc.cc_country ORDER BY dd.d_year, total_quantity_sold DESC;
SELECT p.p_promo_name, p.p_channel_details, cp.cp_department, w.w_state, AVG(ws_net_profit) AS avg_web_sales_profit, AVG(wr_net_loss) AS avg_web_returns_loss, SUM(ws_quantity) AS total_quantity_sold, COUNT(DISTINCT ws_web_page_sk) AS count_unique_pages_sold, COUNT(DISTINCT wr_web_page_sk) AS count_unique_pages_returned FROM promotion p JOIN web_sales ws ON p.p_promo_sk = ws.ws_promo_sk JOIN catalog_page cp ON ws.ws_web_page_sk = cp.cp_catalog_page_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk LEFT JOIN web_returns wr ON ws.ws_item_sk = wr.wr_item_sk AND ws.ws_order_number = wr.wr_order_number WHERE cp.cp_start_date_sk BETWEEN '2450906' AND '2451420' AND cp.cp_end_date_sk BETWEEN '2451419' AND '2451664' AND (wr.wr_returned_date_sk IS NULL OR wr.wr_returned_date_sk BETWEEN ws_sold_date_sk AND ws_sold_date_sk + 30) GROUP BY p.p_promo_name, p.p_channel_details, cp.cp_department, w.w_state ORDER BY avg_web_sales_profit DESC, avg_web_returns_loss DESC;
SELECT cs.cs_order_number AS order_number, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_profit) AS total_net_profit, COUNT(DISTINCT cs.cs_bill_customer_sk) AS unique_customers, ib.ib_lower_bound AS income_lower_bound, ib.ib_upper_bound AS income_upper_bound, SUM(ws.ws_quantity) AS web_total_quantity, AVG(ws.ws_sales_price) AS web_average_sales_price, SUM(ws.ws_net_paid) AS web_total_net_paid, SUM(ws.ws_net_profit) AS web_total_net_profit, COUNT(DISTINCT ws.ws_bill_customer_sk) AS web_unique_customers FROM catalog_sales cs JOIN income_band ib ON cs.cs_bill_hdemo_sk = ib.ib_income_band_sk JOIN web_sales ws ON cs.cs_item_sk = ws.ws_item_sk AND cs.cs_order_number = ws.ws_order_number WHERE cs.cs_ext_tax IN (0.56, 96.57, 30.68, 46.59, 64.13) AND ib.ib_income_band_sk IN (19, 17, 16, 10, 1) GROUP BY cs.cs_order_number, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_net_profit DESC, web_total_net_profit DESC LIMIT 100;
