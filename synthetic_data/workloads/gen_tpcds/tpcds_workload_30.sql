SELECT cp_department, i_category, AVG(i_current_price) AS average_price, SUM(i_wholesale_cost) AS total_wholesale_cost, COUNT(DISTINCT i_item_sk) AS item_count, COUNT(DISTINCT cp_catalog_page_sk) AS page_count, AVG(ib_upper_bound - ib_lower_bound) AS average_income_band_range FROM catalog_page JOIN item ON cp_catalog_page_id = i_item_id JOIN income_band ON i_size::integer = ib_income_band_sk WHERE cp_start_date_sk IS NOT NULL AND cp_end_date_sk IS NOT NULL AND i_rec_start_date <= CURRENT_DATE AND (i_rec_end_date IS NULL OR i_rec_end_date >= CURRENT_DATE) AND ib_lower_bound >= 20000 AND cp_department IN ('Electronics', 'Clothing', 'Home Goods') GROUP BY cp_department, i_category ORDER BY average_price DESC, total_wholesale_cost DESC;
SELECT d_year AS "Year", p_promo_name AS "Promotion Name", COUNT(cr_order_number) AS "Total Returns", SUM(cr_return_quantity) AS "Total Returned Quantity", SUM(cr_return_amount) AS "Total Returned Amount", AVG(cr_return_amount) AS "Average Return Amount", SUM(cr_net_loss) AS "Total Net Loss" FROM catalog_returns cr JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk JOIN promotion p ON d.d_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk WHERE p.p_end_date_sk IN ('2450731', '2450673', '2450658', '2450718') GROUP BY "Year", "Promotion Name" ORDER BY "Year", "Total Returned Amount" DESC;
SELECT sm.sm_type AS shipping_type, web.web_site_sk AS website_id, web.web_name AS website_name, i.i_category AS product_category, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_incl_tax, SUM(ws.ws_net_paid_inc_ship) AS total_net_paid_incl_shipping, SUM(ws.ws_net_paid_inc_ship_tax) AS total_net_paid_incl_shipping_tax, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk WHERE sm.sm_type IN ('REGULAR', 'EXPRESS', 'OVERNIGHT') AND web.web_country = 'United States' AND ws.ws_warehouse_sk IN (2, 4) AND i.i_category IN ('Electronics', 'Women', 'Children', 'Home', 'Sports', 'Books') AND dd.d_year = 1999 GROUP BY shipping_type, website_id, website_name, product_category ORDER BY total_net_profit DESC, total_net_paid DESC, website_name, product_category;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN household_demographics hd ON cs.cs_ship_hdemo_sk = hd.hd_demo_sk WHERE cc.cc_sq_ft IN ('4134', '795', '1138', '649') AND hd.hd_income_band_sk IN ('9', '18', '5', '14', '12') AND hd.hd_vehicle_count IN ('3', '1', '0', '4', '2') GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_net_profit DESC, total_orders DESC, cc.cc_name;
SELECT ca.ca_state AS customer_state, EXTRACT(YEAR FROM d.d_date) AS year_of_return, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_customers, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_refund_amount, AVG(cr.cr_return_amount) AS average_refund_amount, SUM(cr.cr_return_quantity) AS total_returned_quantity, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk WHERE ca.ca_state IS NOT NULL AND cr.cr_returned_date_sk IS NOT NULL GROUP BY customer_state, year_of_return ORDER BY customer_state, year_of_return;
SELECT dd.d_year AS sales_year, dd.d_quarter_name AS sales_quarter, ca.ca_state AS customer_state, cd.cd_education_status AS education_status, cd.cd_gender AS gender, COUNT(DISTINCT c.c_customer_sk) AS num_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS num_preferred_customers FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN date_dim dd ON c.c_first_sales_date_sk = dd.d_date_sk WHERE dd.d_quarter_seq IN (SELECT MAX(d_quarter_seq) FROM date_dim WHERE d_current_quarter = 'Y') GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state, cd.cd_education_status, cd.cd_gender ORDER BY num_customers DESC, avg_purchase_estimate DESC;
SELECT dd.d_year, dd.d_quarter_name, SUM(ws.ws_net_paid) AS total_net_paid, AVG(ws.ws_quantity) AS average_quantity, COUNT(*) AS sales_transactions, SUM(inv.inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT ws.ws_item_sk) AS distinct_items_sold, COUNT(DISTINCT s.s_store_sk) AS number_of_stores, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_quantity) AS average_return_quantity, COUNT(DISTINCT cr.cr_item_sk) AS distinct_items_returned FROM date_dim AS dd JOIN web_sales AS ws ON dd.d_date_sk = ws.ws_sold_date_sk JOIN inventory AS inv ON ws.ws_item_sk = inv.inv_item_sk AND ws.ws_sold_date_sk = inv.inv_date_sk JOIN store AS s ON ws.ws_bill_customer_sk = s.s_store_sk LEFT JOIN catalog_returns AS cr ON ws.ws_item_sk = cr.cr_item_sk AND ws.ws_order_number = cr.cr_order_number WHERE dd.d_current_year = 'N' AND ws.ws_promo_sk IS NOT NULL AND s.s_market_id IN (8, 2, 4, 7) AND inv.inv_warehouse_sk IN (1, 2) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT i.i_category, i.i_color, COUNT(DISTINCT cr.cr_item_sk) AS num_returns, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_return_quantity) AS total_returned_quantity, cc.cc_name AS call_center, w.w_warehouse_name AS warehouse, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages, COUNT(DISTINCT wp.wp_web_page_sk) AS num_web_pages FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN web_page wp ON cp.cp_start_date_sk = wp.wp_creation_date_sk WHERE i.i_color IN ('linen', 'midnight', 'powder', 'tan') AND cp.cp_catalog_number IN (46, 18, 2) AND w.w_gmt_offset = -5.00 GROUP BY i.i_category, i.i_color, cc.cc_name, w.w_warehouse_name ORDER BY total_return_amount DESC;
SELECT ss.ss_store_sk AS store_id, hd.hd_vehicle_count AS vehicle_count, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_items_sold, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_sales_net_profit, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions, SUM(sr.sr_return_quantity) AS total_items_returned, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(sr.sr_net_loss) AS total_returns_net_loss, ARRAY_AGG(DISTINCT r.r_reason_desc) FILTER (WHERE sr.sr_reason_sk IS NOT NULL) AS return_reasons FROM store_sales ss JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk LEFT JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE ss.ss_store_sk IN ('10', '4', '7', '8') AND hd.hd_vehicle_count IN ('3', '2', '1', '4') GROUP BY ss.ss_store_sk, hd.hd_vehicle_count ORDER BY total_sales_net_profit DESC, total_returns_net_loss ASC;
SELECT dd.d_year, dd.d_quarter_name, wa.w_country, ca.ca_state, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, AVG(cd.cd_purchase_estimate) AS avg_customer_purchase_estimate, SUM(CASE WHEN pr.p_channel_email = '1' THEN ws.ws_quantity ELSE 0 END) as total_quantity_sold_via_email, SUM(CASE WHEN pr.p_channel_tv = '1' THEN ws.ws_quantity ELSE 0 END) as total_quantity_sold_via_tv FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON ws.ws_bill_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN warehouse wa ON ws.ws_warehouse_sk = wa.w_warehouse_sk JOIN promotion pr ON ws.ws_promo_sk = pr.p_promo_sk WHERE dd.d_quarter_seq IN (25, 41) AND wa.w_country = 'United States' AND wa.w_street_name IN ('Ash Laurel', '6th', 'Wilson Elm', 'View First') AND cd.cd_purchase_estimate BETWEEN 1000 AND 5500 GROUP BY ROLLUP(dd.d_year, dd.d_quarter_name, wa.w_country, ca.ca_state) ORDER BY dd.d_year, dd.d_quarter_name, wa.w_country, ca.ca_state;
SELECT i.i_category AS item_category, sm.sm_type AS shipping_type, COUNT(DISTINCT cr.cr_order_number) AS catalog_returns_count, SUM(cr.cr_return_quantity) AS total_catalog_return_quantity, AVG(cr.cr_return_amt_inc_tax) AS average_catalog_return_amount, COUNT(DISTINCT sr.sr_ticket_number) AS store_returns_count, SUM(sr.sr_return_quantity) AS total_store_return_quantity, AVG(sr.sr_return_amt_inc_tax) AS average_store_return_amount FROM catalog_returns cr INNER JOIN item i ON cr.cr_item_sk = i.i_item_sk INNER JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk INNER JOIN time_dim t ON cr.cr_returned_date_sk = t.t_time_sk INNER JOIN income_band ib ON cr.cr_refunded_customer_sk = ib.ib_income_band_sk LEFT JOIN store_returns sr ON i.i_item_sk = sr.sr_item_sk AND cr.cr_returned_date_sk = sr.sr_returned_date_sk WHERE t.t_time_sk = 1000 AND ib.ib_lower_bound = 40001 GROUP BY i.i_category, sm.sm_type ORDER BY i.i_category, sm.sm_type;
SELECT c.c_birth_country, COUNT(DISTINCT c.c_customer_sk) AS num_customers, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_net_paid_inc_tax) AS avg_net_paid_inc_tax, SUM(CASE WHEN ss.ss_net_paid_inc_tax > 1000 THEN ss.ss_quantity ELSE 0 END) AS quantity_sold_above_1000, COUNT(DISTINCT p.p_promo_sk) AS num_promotions, SUM(p.p_cost) AS total_promotion_cost, w.w_state, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft FROM customer c JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN warehouse w ON w.w_zip = c.c_current_addr_sk::character varying WHERE c.c_birth_country IN ('THAILAND', 'ITALY') AND ss.ss_net_paid_inc_tax::text IN ('307.45', '859.21', '1169.72', '3293.51', '222.26') GROUP BY c.c_birth_country, w.w_state ORDER BY total_quantity_sold DESC;
SELECT dd.d_year, dd.d_quarter_name, SUM(cs.cs_quantity) AS total_catalog_quantity, AVG(cs.cs_sales_price) AS average_catalog_sales_price, SUM(cs.cs_net_profit) AS total_catalog_net_profit, SUM(ws.ws_quantity) AS total_web_quantity, AVG(ws.ws_sales_price) AS average_web_sales_price, SUM(ws.ws_net_profit) AS total_web_net_profit, SUM(cs.cs_quantity) + SUM(ws.ws_quantity) AS total_combined_quantity, AVG(cs.cs_sales_price * cs.cs_quantity + ws.ws_sales_price * ws.ws_quantity) / AVG(cs.cs_quantity + ws.ws_quantity) AS average_combined_sales_price, SUM(cs.cs_net_profit) + SUM(ws.ws_net_profit) AS total_combined_net_profit FROM date_dim dd LEFT JOIN catalog_sales cs ON dd.d_date_sk = cs.cs_sold_date_sk LEFT JOIN web_sales ws ON dd.d_date_sk = ws.ws_sold_date_sk WHERE dd.d_year = 2001 AND dd.d_current_quarter = 'N' GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT i.i_category, i.i_brand, SUM(cs.cs_ext_sales_price) AS total_sales_value, AVG(cs.cs_ext_sales_price) AS avg_sales_value_per_item, COUNT(cs.cs_item_sk) AS items_sold_count, MAX(cs.cs_sales_price) AS max_item_sales_price, MIN(cs.cs_sales_price) AS min_item_sales_price FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN time_dim t ON cs.cs_sold_date_sk = t.t_time_sk WHERE cs.cs_ext_sales_price BETWEEN 500 AND 6000 AND t.t_time_id IN ('AAAAAAAACJABAAAA', 'AAAAAAAAHEAAAAAA', 'AAAAAAAAHKCAAAAA', 'AAAAAAAACNEAAAAA') GROUP BY ROLLUP(i.i_category, i.i_brand) HAVING SUM(cs.cs_ext_sales_price) > 1000 ORDER BY i.i_category, total_sales_value DESC, i.i_brand;
SELECT d_year, p_channel_details, COUNT(DISTINCT ws_order_number) AS web_order_count, SUM(ws_net_paid) AS total_web_sales, SUM(ws_net_profit) AS total_web_profit, AVG(ws_quantity) AS average_quantity_sold, SUM(ss_net_paid) AS total_store_sales, SUM(ss_net_profit) AS total_store_profit, AVG(ss_quantity) AS average_store_quantity_sold FROM web_sales JOIN store_sales ON ws_item_sk = ss_item_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN promotion ON ws_promo_sk = p_promo_sk WHERE d_year IN (1902, 1903, 1904) AND p_channel_details IS NOT NULL AND (ws_net_paid > 0 OR ss_net_paid > 0) GROUP BY d_year, p_channel_details ORDER BY d_year, p_channel_details;
SELECT r_reason_desc, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, COUNT(*) AS return_count, SUM(cs_net_profit) AS total_sales_net_profit, AVG(cs_net_profit) AS avg_sales_net_profit, COUNT(DISTINCT cs_order_number) AS sales_order_count, SUM(ws_net_profit) AS total_web_net_profit, AVG(ws_net_profit) AS avg_web_net_profit, COUNT(DISTINCT ws_order_number) AS web_order_count FROM catalog_returns JOIN reason ON catalog_returns.cr_reason_sk = reason.r_reason_sk LEFT JOIN catalog_sales ON catalog_returns.cr_item_sk = catalog_sales.cs_item_sk AND catalog_returns.cr_order_number = catalog_sales.cs_order_number LEFT JOIN web_sales ON catalog_returns.cr_item_sk = web_sales.ws_item_sk AND catalog_returns.cr_order_number = web_sales.ws_order_number WHERE catalog_returns.cr_returned_date_sk BETWEEN 2451276 AND 2451276 + 30 AND catalog_returns.cr_return_tax BETWEEN 0 AND 200 AND (catalog_sales.cs_ship_cdemo_sk = 568017 OR web_sales.ws_sold_date_sk = 2451276) AND (catalog_sales.cs_promo_sk IN (253, 289, 228) OR web_sales.ws_promo_sk IN (253, 289, 228)) AND reason.r_reason_id IN ('AAAAAAAAIBAAAAAA', 'AAAAAAAABCAAAAAA', 'AAAAAAAAOBAAAAAA', 'AAAAAAAAMAAAAAAA') GROUP BY r_reason_desc ORDER BY total_return_amount DESC, total_sales_net_profit DESC, total_web_net_profit DESC;
SELECT dd.d_year, dd.d_quarter_name, i.i_category, i.i_brand, COUNT(DISTINCT ws.web_site_sk) AS number_of_websites, COUNT(DISTINCT wp.wp_web_page_sk) AS number_of_web_pages, COUNT(DISTINCT wr.wr_order_number) AS number_of_returns, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_return_quantity) AS avg_return_quantity, AVG(wr.wr_fee) AS avg_return_fee, hd.hd_dep_count, ib.ib_lower_bound AS income_band_lower_bound, ib.ib_upper_bound AS income_band_upper_bound, SUM(hd.hd_vehicle_count) AS total_vehicles FROM web_returns wr JOIN date_dim dd ON wr.wr_returned_date_sk = dd.d_date_sk JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk JOIN item i ON wr.wr_item_sk = i.i_item_sk JOIN web_site ws ON wp.wp_web_page_sk = ws.web_site_sk JOIN household_demographics hd ON wr.wr_returning_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE dd.d_year = 2001 AND i.i_category_id IN (1, 2, 3) AND wr.wr_return_tax > 100 AND hd.hd_income_band_sk = 10 AND wr.wr_refunded_cash BETWEEN 300 AND 4000 GROUP BY dd.d_year, dd.d_quarter_name, i.i_category, i.i_brand, hd.hd_dep_count, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_return_amount DESC, avg_return_quantity DESC, avg_return_fee DESC, number_of_websites, number_of_web_pages;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, COUNT(DISTINCT ws.ws_item_sk) AS unique_items_sold, COUNT(DISTINCT c.c_customer_sk) AS distinct_customers, p.p_promo_name, COUNT(DISTINCT p.p_promo_sk) AS num_promotions_used FROM web_sales ws JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk JOIN web_site ws_site ON ws.ws_web_site_sk = ws_site.web_site_sk WHERE p.p_channel_demo = 'N' AND p.p_channel_press = 'N' AND ib.ib_income_band_sk IN ('15', '19') GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, p.p_promo_name ORDER BY total_net_profit DESC, average_sales_price DESC, total_orders DESC;
