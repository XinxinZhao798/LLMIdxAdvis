SELECT dd.d_year AS year, dd.d_quarter_name AS quarter, SUM(cs.cs_net_profit) AS total_sales_net_profit, SUM(sr.sr_net_loss) AS total_returns_net_loss, AVG(cd.cd_purchase_estimate) AS avg_customer_purchase_estimate, COUNT(DISTINCT cs.cs_order_number) AS total_sales_orders, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_tickets, COUNT(DISTINCT s.s_store_sk) AS total_stores, COUNT(DISTINCT inv.inv_warehouse_sk) AS total_warehouses FROM date_dim dd LEFT JOIN catalog_sales cs ON dd.d_date_sk = cs.cs_sold_date_sk LEFT JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk LEFT JOIN customer_demographics cd ON (cs.cs_bill_cdemo_sk = cd.cd_demo_sk OR sr.sr_cdemo_sk = cd.cd_demo_sk) LEFT JOIN store s ON sr.sr_store_sk = s.s_store_sk LEFT JOIN inventory inv ON dd.d_date_sk = inv.inv_date_sk WHERE dd.d_fy_year = 2003 AND dd.d_fy_quarter_seq = 1 AND cd.cd_credit_rating = 'Low Risk' AND s.s_manager = 'William Ward' GROUP BY year, quarter ORDER BY year, quarter;
SELECT hd.hd_income_band_sk, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, COUNT(DISTINCT sr.sr_customer_sk) AS unique_customers_returned, SUM(CASE WHEN p.p_channel_email = 'Y' THEN sr.sr_return_quantity ELSE 0 END) AS email_promo_returned_quantity, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk JOIN promotion p ON sr.sr_item_sk = p.p_item_sk JOIN inventory i ON sr.sr_item_sk = i.inv_item_sk AND i.inv_warehouse_sk = 1 WHERE hd.hd_demo_sk IN (1588, 4700) AND sr.sr_refunded_cash IN (10.38, 1818.70) GROUP BY hd.hd_income_band_sk ORDER BY total_net_loss DESC;
SELECT w_state, p_promo_id, p_discount_active, COUNT(DISTINCT cr_order_number) AS total_returns, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_quantity) AS total_returned_quantity, COUNT(DISTINCT sr_ticket_number) AS total_store_returns, SUM(sr_return_amt) AS total_store_return_amount, AVG(sr_return_amt) AS avg_store_return_amount, SUM(sr_return_quantity) AS total_store_returned_quantity FROM catalog_returns JOIN warehouse ON cr_warehouse_sk = w_warehouse_sk JOIN promotion ON cr_catalog_page_sk = p_promo_sk JOIN store_returns ON cr_item_sk = sr_item_sk AND cr_order_number = sr_ticket_number WHERE w_state = 'TN' AND p_promo_id = 'AAAAAAAAMKAAAAAA' AND p_discount_active = 'N' GROUP BY w_state, p_promo_id, p_discount_active ORDER BY total_return_amount DESC;
SELECT ca_state, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_net_sales, AVG(ss_net_profit) AS avg_profit_per_sale, SUM(ss_net_paid_inc_tax) - SUM(ss_net_paid) AS total_tax_collected, web_company_name FROM store_sales JOIN customer_address ON store_sales.ss_addr_sk = customer_address.ca_address_sk JOIN web_site ON store_sales.ss_store_sk = web_site.web_site_sk WHERE web_site.web_company_id IN ('5', '1', '4', '6', '2') AND customer_address.ca_country = 'United States' AND EXTRACT(YEAR FROM CURRENT_DATE) - EXTRACT(YEAR FROM web_rec_start_date) <= 10 GROUP BY ca_state, web_company_name ORDER BY total_net_sales DESC, total_quantity_sold DESC;
SELECT cc.cc_name, cc.cc_manager, sm.sm_type, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_net_paid) AS avg_payment, SUM(cs.cs_net_profit) AS total_profit, SUM(cs.cs_coupon_amt) AS total_coupons, p.p_promo_name, COUNT(DISTINCT c.c_customer_sk) AS unique_customers FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk WHERE cc.cc_open_date_sk IN ('2450952', '2450806', '2451063') AND cc.cc_manager IN ('Bob Belcher', 'Felipe Perkins', 'Larry Mccray', 'Mark Hightower') AND cs.cs_ext_sales_price IN ('8162.40', '242.11', '869.67', '42.33') AND c.c_birth_country IN ('GERMANY', 'YEMEN', 'SWAZILAND', 'MARTINIQUE', 'ROMANIA') AND c.c_customer_sk IN ('758', '3345') GROUP BY cc.cc_name, cc.cc_manager, sm.sm_type, p.p_promo_name ORDER BY total_profit DESC, total_orders DESC, avg_payment DESC;
SELECT cp.cp_department, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(ss.ss_ext_sales_price) AS total_sales, AVG(ss.ss_coupon_amt) AS avg_coupon_amount, AVG(ss.ss_sales_price) AS avg_sales_price FROM store_sales ss JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN catalog_page cp ON cp.cp_start_date_sk <= ss.ss_sold_date_sk AND cp.cp_end_date_sk >= ss.ss_sold_date_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE c.c_birth_year = 1981 AND ss.ss_coupon_amt > 0 AND t.t_shift = 'third' GROUP BY cp.cp_department ORDER BY total_sales DESC, avg_sales_price DESC;
SELECT s.s_store_name, s.s_city, s.s_state, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN warehouse w ON s.s_zip = w.w_zip JOIN ship_mode sm ON w.w_country = sm.sm_carrier WHERE ss.ss_sold_date_sk BETWEEN 2451189 AND 2451200 AND ss.ss_quantity > 50 GROUP BY s.s_store_name, s.s_city, s.s_state ORDER BY total_net_profit DESC, total_quantity_sold DESC LIMIT 10;
SELECT i.i_category, i.i_class, i.i_brand, SUM(ws.ws_net_paid) AS total_sales, AVG(ws.ws_quantity) AS average_quantity_sold, SUM(sr.sr_return_amt) AS total_returns, AVG(sr.sr_return_quantity) AS average_quantity_returned, (SUM(ws.ws_net_paid) - SUM(sr.sr_return_amt)) AS net_sales FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN store_returns sr ON ws.ws_item_sk = sr.sr_item_sk LEFT JOIN ( SELECT wr_item_sk, wr_returned_date_sk, SUM(wr_return_amt) AS wr_total_return_amt, SUM(wr_return_ship_cost) AS wr_total_return_ship_cost FROM web_returns GROUP BY wr_item_sk, wr_returned_date_sk ) wr ON ws.ws_item_sk = wr.wr_item_sk WHERE ws.ws_warehouse_sk IN (5, 1, 2) AND ws.ws_wholesale_cost IN (16.07, 45.38, 66.57) AND ws.ws_order_number IN (42297, 10912, 13297) AND sr.sr_ticket_number IN (36370, 38622, 39874) AND sr.sr_return_quantity IN (41, 16, 8) AND i.i_manufact IN ('baresecally', 'ationableought', 'ableationeing') AND i.i_item_id IN ('AAAAAAAAJKDAAAAA', 'AAAAAAAAIACAAAAA', 'AAAAAAAAACIAAAAA') AND wr.wr_returned_date_sk IN (2451906, 2452157, 2451313) AND wr.wr_total_return_ship_cost IN (209.65, 2559.79, 887.24) AND wr.wr_total_return_amt IN (32.76, 437.16, 23.35) GROUP BY i.i_category, i.i_class, i.i_brand ORDER BY net_sales DESC, total_sales DESC, total_returns DESC, i.i_category, i.i_class, i.i_brand;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, SUM(cr.cr_return_amount) AS total_refunds, AVG(cr.cr_return_amount) AS avg_refund_amount, COUNT(*) AS total_return_instances, ws.web_name, ws.web_manager FROM catalog_returns cr JOIN customer c ON cr.cr_returning_customer_sk = c.c_customer_sk JOIN web_site ws ON cr.cr_call_center_sk = ws.web_site_sk WHERE cr.cr_returned_date_sk IN ('2451001', '2450970') AND c.c_birth_year = '1936' AND cr.cr_returning_cdemo_sk IN ('1683351', '1010437', '1147434', '1904377', '447632') AND c.c_customer_id IN ('AAAAAAAAKFNAAAAA', 'AAAAAAAAAFABAAAA') GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, ws.web_name, ws.web_manager ORDER BY total_refunds DESC;
SELECT d_year, SUM(cs_net_paid) AS total_sales, AVG(cs_net_profit) AS average_profit, COUNT(DISTINCT cs_bill_customer_sk) AS unique_customers, SUM(cr_return_amount) AS total_returns, AVG(cr_return_quantity) AS average_return_quantity, COUNT(DISTINCT cr_returning_customer_sk) AS unique_returning_customers FROM date_dim JOIN catalog_sales ON cs_sold_date_sk = d_date_sk JOIN catalog_returns ON cr_returned_date_sk = d_date_sk AND cs_order_number = cr_order_number WHERE d_year IN (2000, 2001, 2002) AND cs_ship_date_sk IS NOT NULL AND cr_returned_date_sk IS NOT NULL AND (cr_refunded_cdemo_sk IN ('719026', '1111847', '660009', '451051') OR cs_bill_cdemo_sk IN ('719026', '1111847', '660009', '451051')) AND cs_item_sk IN (SELECT inv_item_sk FROM inventory WHERE inv_quantity_on_hand > 100) GROUP BY d_year ORDER BY d_year;
SELECT sm.sm_code AS shipping_mode, s.s_store_name AS store_name, cc.cc_name AS call_center_name, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_customers, COUNT(DISTINCT ws.ws_order_number) AS total_web_sales_orders, SUM(ws.ws_net_profit) AS total_web_sales_profit FROM catalog_returns cr JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN store s ON cc.cc_division = s.s_division_id JOIN web_sales ws ON cr.cr_item_sk = ws.ws_item_sk AND cr.cr_order_number = ws.ws_order_number WHERE cr.cr_returned_date_sk BETWEEN 2450952 AND 2451063 AND sm.sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') AND s.s_hours IN ('8AM-12AM', '8AM-4PM') GROUP BY shipping_mode, store_name, call_center_name ORDER BY total_returns DESC, total_return_amount DESC;
SELECT d_year, p_channel_details, COUNT(DISTINCT ws_order_number) AS web_order_count, SUM(ws_net_paid) AS total_web_sales, SUM(ws_net_profit) AS total_web_profit, AVG(ws_quantity) AS average_quantity_sold, SUM(ss_net_paid) AS total_store_sales, SUM(ss_net_profit) AS total_store_profit, AVG(ss_quantity) AS average_store_quantity_sold FROM web_sales JOIN store_sales ON ws_item_sk = ss_item_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN promotion ON ws_promo_sk = p_promo_sk WHERE d_year IN (1902, 1903, 1904) AND p_channel_details IS NOT NULL AND (ws_net_paid > 0 OR ss_net_paid > 0) GROUP BY d_year, p_channel_details ORDER BY d_year, p_channel_details;
SELECT ws.web_manager, ws.web_class, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_return_transactions, SUM(cr.cr_return_amt_inc_tax) AS total_catalog_return_amount_inc_tax, COUNT(DISTINCT p.p_promo_sk) AS total_promotions, SUM(p.p_cost) AS total_promotion_cost FROM web_site ws LEFT JOIN store_returns sr ON ws.web_site_sk = sr.sr_store_sk LEFT JOIN catalog_returns cr ON ws.web_site_sk = cr.cr_catalog_page_sk LEFT JOIN promotion p ON cr.cr_item_sk = p.p_item_sk AND cr.cr_returned_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk WHERE ws.web_manager = 'Jimmy Pope' AND (ws.web_zip = '35709' OR ws.web_zip = '31904') GROUP BY ws.web_manager, ws.web_class ORDER BY total_return_amount_inc_tax DESC, total_catalog_return_amount_inc_tax DESC;
SELECT dd.d_year, dd.d_moy, sm.sm_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_net_paid) AS total_net_sales, AVG(cs.cs_net_paid) AS avg_net_sales_per_order, SUM(sr.sr_return_quantity) AS total_quantity_returned, SUM(sr.sr_net_loss) AS total_net_loss, AVG(sr.sr_net_loss) AS avg_net_loss_per_return, SUM(wr.wr_return_quantity) AS total_web_quantity_returned, SUM(wr.wr_net_loss) AS total_web_net_loss, AVG(wr.wr_net_loss) AS avg_web_net_loss_per_return, COUNT(DISTINCT hd.hd_demo_sk) AS unique_customers FROM date_dim dd LEFT JOIN catalog_sales cs ON dd.d_date_sk = cs.cs_sold_date_sk LEFT JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk LEFT JOIN web_returns wr ON dd.d_date_sk = wr.wr_returned_date_sk LEFT JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk WHERE dd.d_year = 2003 AND sm.sm_carrier IN ('ZOUROS', 'ALLIANCE', 'GREAT EASTERN') AND hd.hd_income_band_sk IN (10, 3, 16) AND hd.hd_buy_potential IN ('Unknown', '501-1000', '1001-5000') GROUP BY dd.d_year, dd.d_moy, sm.sm_type ORDER BY dd.d_year, dd.d_moy, sm.sm_type;
SELECT s.s_store_name, s.s_city, s.s_state, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid) AS total_net_paid, AVG(ws.ws_net_profit) AS average_net_profit, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cd.cd_purchase_estimate) AS average_purchase_estimate, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_page_visits FROM store s JOIN web_sales ws ON s.s_store_sk = ws.ws_ship_addr_sk JOIN income_band ib ON ws.ws_bill_customer_sk = ib.ib_income_band_sk JOIN catalog_returns cr ON ws.ws_item_sk = cr.cr_item_sk AND ws.ws_order_number = cr.cr_order_number JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk WHERE ws.ws_ext_ship_cost IN (176.54, 380.00, 2131.08) AND ws.ws_ext_wholesale_cost IN (1606.13, 264.04, 476.93) AND ib.ib_income_band_sk IN (6, 20, 17) AND ib.ib_upper_bound IN (30000, 50000, 70000) AND s.s_city IN ('Fairview', 'Midway') AND s.s_market_manager IN ('Thomas Benton', 'Dustin Kelly', 'Dean Morrison') AND s.s_suite_number IN ('Suite 410', 'Suite 190', 'Suite 100') AND cr.cr_ship_mode_sk IN (5, 14, 16) AND cr.cr_item_sk IN (13561, 12757, 9220) AND cr.cr_returning_addr_sk IN (8108, 14295, 7472) AND dd.d_following_holiday IN ('N', 'Y') AND dd.d_dow IN (6, 2, 4) AND dd.d_current_year = 'N' AND wp.wp_access_date_sk IN (2452580, 2452611, 2452576) AND wp.wp_image_count IN (3, 7, 4) AND cd.cd_purchase_estimate IN (500, 2000, 3000) AND cd.cd_education_status IN ('4 yr Degree', 'Secondary', '2 yr Degree') AND cd.cd_dep_count IN (2, 1) GROUP BY s.s_store_name, s.s_city, s.s_state, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_net_paid DESC, average_net_profit DESC, total_web_page_visits DESC LIMIT 100;
