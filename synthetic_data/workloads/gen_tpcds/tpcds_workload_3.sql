SELECT s.s_store_id, s.s_store_name, d.d_year, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS preferred_customers, AVG(s.s_number_employees) AS average_employees, AVG(s.s_floor_space) AS average_floor_space, SUM(s.s_tax_precentage) AS total_tax_percentage FROM store s JOIN customer c ON s.s_store_sk = c.c_current_addr_sk JOIN date_dim d ON c.c_first_sales_date_sk = d.d_date_sk WHERE s.s_division_name <> 'Unknown' AND c.c_last_review_date_sk IN ('2452522', '2452308', '2452629', '2452335', '2452592', '2452622') AND c.c_first_name IN ('Tyler', 'Rhona', 'Mohammad') AND d.d_last_dom IN ('2417208', '2418853') AND d.d_following_holiday = 'Y' GROUP BY s.s_store_id, s.s_store_name, d.d_year ORDER BY total_customers DESC, preferred_customers DESC, average_employees DESC, average_floor_space DESC, total_tax_percentage DESC;
SELECT ca_state, EXTRACT(YEAR FROM d.d_date) AS sales_year, COUNT(DISTINCT c.c_customer_sk) AS num_customers, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS avg_sales_price, SUM(ss_net_profit) AS total_net_profit, SUM(sr_return_amt_inc_tax) AS total_returns, AVG(sr_fee) AS avg_return_fee FROM store_sales ss JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE ca.ca_state IN ('IL', 'KY', 'OR') AND EXTRACT(YEAR FROM d.d_date) IN (2001, 2002) AND ss.ss_sales_price BETWEEN 100 AND 150 AND sr.sr_return_amt_inc_tax > 0 GROUP BY ca_state, sales_year ORDER BY sales_year DESC, ca_state;
SELECT c.c_customer_id, COUNT(ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_units_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, sm.sm_type AS shipping_mode, EXTRACT(YEAR FROM d_date) AS sales_year FROM web_sales ws JOIN date_dim d_date ON ws.ws_sold_date_sk = d_date.d_date_sk JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk WHERE d_date.d_year = 2020 GROUP BY c.c_customer_id, sm.sm_type, sales_year ORDER BY total_net_paid DESC, total_net_profit DESC;
SELECT hd.hd_income_band_sk, count(distinct c.c_customer_sk) AS num_customers, sum(cs.cs_quantity) AS total_sales_quantity, sum(cs.cs_net_paid) AS total_sales_amount, sum(sr.sr_return_quantity) AS total_returned_quantity, sum(sr.sr_return_amt) AS total_returned_amount, sum(cs.cs_net_profit) - sum(coalesce(sr.sr_net_loss, 0)) AS net_profit FROM customer c JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk LEFT JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk WHERE hd.hd_income_band_sk IN ('17', '12', '15', '6', '4', '19') AND (cs.cs_sold_date_sk IS NOT NULL OR sr.sr_returned_date_sk IS NOT NULL) GROUP BY hd.hd_income_band_sk ORDER BY net_profit DESC;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, MAX(ss.ss_net_paid_inc_tax) AS max_payment_received, MIN(ss.ss_net_paid_inc_tax) AS min_payment_received FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE cc.cc_rec_start_date BETWEEN '1998-01-01' AND '2001-01-01' AND cc.cc_mkt_desc LIKE '%Rich groups catch longer other fears; future,%' GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_quantity_sold DESC, average_sales_price DESC;
SELECT cp.cp_department, ca.ca_city, ca.ca_state, cd.cd_education_status, td.t_shift, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON cs.cs_ship_cdemo_sk = cd.cd_demo_sk JOIN time_dim td ON cs.cs_sold_time_sk = td.t_time_sk WHERE cp.cp_start_date_sk IN (2451145, 2451271, 2451088, 2450845, 2451360) AND cp.cp_type IN ('bi-annual', 'quarterly') AND td.t_hour IN (1, 0) AND cd.cd_dep_college_count = 0 GROUP BY cp.cp_department, ca.ca_city, ca.ca_state, cd.cd_education_status, td.t_shift ORDER BY total_net_profit DESC, total_orders DESC;
SELECT dd.d_year, dd.d_quarter_name, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cr.cr_item_sk) AS distinct_items_returned, COUNT(DISTINCT cr.cr_returning_customer_sk) AS distinct_customers_returned, SUM(i.i_current_price * cr.cr_return_quantity) AS total_sales_lost, COUNT(DISTINCT wp.wp_web_page_sk) AS distinct_web_pages_accessed, SUM(wp.wp_char_count) AS total_web_chars FROM catalog_returns cr JOIN date_dim dd ON cr.cr_returned_date_sk = dd.d_date_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk LEFT JOIN web_page wp ON dd.d_date_sk = wp.wp_access_date_sk WHERE dd.d_current_day = 'N' AND dd.d_day_name IN ('Wednesday', 'Monday', 'Saturday', 'Thursday', 'Tuesday') AND cr.cr_returning_addr_sk IN ('13215', '22286', '5756', '38251', '6237') GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT cp.cp_department, t.t_shift, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sales_price, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_net_paid_inc_tax) AS total_web_sales_inc_tax FROM catalog_page cp JOIN store_sales ss ON cp.cp_catalog_page_sk = ss.ss_sold_date_sk JOIN web_sales ws ON cp.cp_catalog_page_sk = ws.ws_sold_date_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE cp.cp_end_date_sk IN (2451270, 2451144, 2451361, 2450905, 2450996, 2450994) AND ws.ws_ship_addr_sk IN ('41135', '47817', '1020', '16481') AND ws.ws_net_paid_inc_tax IN (121.18, 8694.75, 8.96, 5623.02, 5896.24) AND ss.ss_quantity IN (3, 63, 59, 95, 61) AND cp.cp_catalog_page_number IN (82, 73) AND t.t_minute IN (29, 57, 42, 24) GROUP BY cp.cp_department, t.t_shift ORDER BY total_quantity_sold DESC, avg_sales_price DESC, total_web_orders DESC, total_web_sales_inc_tax DESC;
SELECT cc.cc_city, i.i_category, COUNT(DISTINCT cc.cc_call_center_sk) AS total_call_centers, SUM(cc.cc_employees) AS total_employees, AVG(cc.cc_sq_ft) AS avg_square_footage, COUNT(DISTINCT i.i_item_sk) AS total_items, AVG(i.i_current_price) AS avg_item_price, MIN(ib.ib_lower_bound) AS min_income_band_lower_bound, MAX(ib.ib_upper_bound) AS max_income_band_upper_bound, AVG(cc.cc_tax_percentage) AS avg_tax_percentage FROM call_center cc JOIN item i ON cc.cc_division = i.i_manufact_id JOIN income_band ib ON ib.ib_income_band_sk = cc.cc_mkt_id WHERE cc.cc_street_type IN ('Boulevard', 'RD', 'Way') AND i.i_units IN ('Dram', 'Ounce', 'Gram') AND ib.ib_income_band_sk IN (3, 5, 7, 8) AND cc.cc_tax_percentage BETWEEN 0.01 AND 0.12 GROUP BY cc.cc_city, i.i_category ORDER BY total_call_centers DESC, avg_item_price ASC LIMIT 10;
SELECT i.i_item_id, i.i_category, i.i_class, i.i_brand, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(cr.cr_returned_date_sk) AS return_count, SUM(cr.cr_fee) AS total_fee, SUM(cr.cr_return_ship_cost) AS total_shipping_cost, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN web_site ws ON cr.cr_returned_date_sk = ws.web_open_date_sk WHERE ws.web_gmt_offset = '-5.00' AND ws.web_mkt_id IN (3, 5, 6, 1, 4, 2) AND i.i_size IN ('small', 'extra large') AND i.i_class IN ('hockey', 'infants', 'portable', 'memory') AND cr.cr_reason_sk = 3 GROUP BY i.i_item_id, i.i_category, i.i_class, i.i_brand ORDER BY total_return_amount DESC, return_count DESC LIMIT 100;
SELECT cp.cp_department, i.i_category, COUNT(DISTINCT cp.cp_catalog_page_sk) AS total_catalog_pages, COUNT(DISTINCT i.i_item_sk) AS total_items, AVG(i.i_current_price) AS avg_item_price, SUM(i.i_wholesale_cost) AS total_wholesale_cost, w.web_name, COUNT(DISTINCT w.web_site_sk) AS total_websites, AVG(w.web_tax_percentage) AS avg_tax_percentage FROM catalog_page cp JOIN item i ON cp.cp_catalog_page_sk = i.i_item_sk JOIN web_site w ON i.i_item_sk = w.web_site_sk WHERE cp.cp_start_date_sk IN ('2451055', '2450905', '2451210', '2451025', '2451605', '2450815') AND w.web_street_type IN ('Way', 'Cir.', 'Ln', 'Ct.', 'Wy') AND i.i_units IN ('N/A', 'Ton') AND cp.cp_catalog_page_sk IN ('3794', '992') GROUP BY cp.cp_department, i.i_category, w.web_name ORDER BY cp.cp_department, i.i_category, w.web_name;
SELECT c.c_last_name, c.c_first_name, c.c_email_address, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_quantity) AS avg_quantity_sold, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_transactions, SUM(wr.wr_fee) AS total_return_fees, AVG(wr.wr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT wr.wr_order_number) AS number_of_returns, r.r_reason_desc AS most_common_return_reason FROM store_sales ss JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk LEFT JOIN web_returns wr ON wr.wr_returning_customer_sk = c.c_customer_sk LEFT JOIN reason r ON wr.wr_reason_sk = r.r_reason_sk WHERE c.c_birth_day IN (12, 23, 14, 10, 22, 11) AND r.r_reason_desc IN ('Wrong size', 'unauthoized purchase', 'reason 32') GROUP BY c.c_last_name, c.c_first_name, c.c_email_address, r.r_reason_desc ORDER BY total_sales DESC, total_return_fees DESC;
SELECT c.c_customer_id, sm.sm_type as shipping_type, count(cs_order_number) as total_orders, sum(cs_quantity) as total_quantity, avg(cs_net_paid) as average_net_paid, sum(cs_net_profit) as total_net_profit, date_part('year', d.d_date) as sale_year, d.d_quarter_name as sale_quarter, ib.ib_lower_bound as income_band_lower_bound, ib.ib_upper_bound as income_band_upper_bound FROM catalog_sales cs JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN income_band ib ON c.c_current_hdemo_sk = ib.ib_income_band_sk WHERE d.d_year = 2023 AND sm.sm_code = 'SEA' AND ib.ib_lower_bound >= 30001 AND ib.ib_upper_bound <= 80001 GROUP BY c.c_customer_id, shipping_type, sale_year, sale_quarter, income_band_lower_bound, income_band_upper_bound ORDER BY total_net_profit DESC, total_orders DESC;
SELECT i_category, i_brand, COUNT(DISTINCT i_item_sk) AS total_items, SUM(i_current_price) AS total_sales_value, AVG(i_wholesale_cost) AS average_wholesale_cost FROM item WHERE i_units IN ('Dozen', 'Bundle', 'Lb') AND i_manufact IN ('eseantieing', 'ableablepri') GROUP BY i_category, i_brand ORDER BY total_sales_value DESC LIMIT 100;
SELECT ca.ca_state AS customer_state, ib.ib_income_band_sk AS income_band, date_dim.d_year AS sale_year, SUM(ss.ss_sales_price) AS total_sales, AVG(ss.ss_sales_price) AS avg_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS sales_transactions, SUM(wr.wr_return_amt) AS total_returns, AVG(wr.wr_return_amt) AS avg_return_amt, COUNT(DISTINCT wr.wr_order_number) AS return_transactions, (SUM(ss.ss_sales_price) - SUM(wr.wr_return_amt)) AS net_sales FROM store_sales ss LEFT JOIN web_returns wr ON ss.ss_item_sk = wr.wr_item_sk AND ss.ss_customer_sk = wr.wr_refunded_customer_sk INNER JOIN date_dim ON ss.ss_sold_date_sk = date_dim.d_date_sk INNER JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk INNER JOIN income_band ib ON ss.ss_cdemo_sk = ib.ib_income_band_sk WHERE ca.ca_state IS NOT NULL AND date_dim.d_year >= 2000 GROUP BY ca.ca_state, ib.ib_income_band_sk, date_dim.d_year ORDER BY ca.ca_state, ib.ib_income_band_sk, date_dim.d_year;
SELECT d_year, d_month_seq, c_birth_country, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_paid) AS total_sales, AVG(cs_sales_price) AS avg_sales_price, SUM(cr_return_amount) AS total_returns, AVG(cr_return_amount) AS avg_return_amount, COUNT(DISTINCT sr_ticket_number) AS total_return_transactions, SUM(sr_return_amt) AS total_returned_amount, AVG(sr_return_amt) AS avg_returned_amount, COUNT(DISTINCT CASE WHEN sr_reason_sk = 26 THEN sr_ticket_number ELSE NULL END) AS total_returns_reason_26, COUNT(DISTINCT CASE WHEN sr_reason_sk = 20 THEN sr_ticket_number ELSE NULL END) AS total_returns_reason_20, SUM(CASE WHEN sr_reason_sk = 26 THEN sr_return_amt ELSE 0 END) AS total_amount_returned_for_reason_26, SUM(CASE WHEN sr_reason_sk = 20 THEN sr_return_amt ELSE 0 END) AS total_amount_returned_for_reason_20 FROM date_dim JOIN catalog_sales ON (cs_sold_date_sk = d_date_sk) JOIN customer ON (cs_bill_customer_sk = c_customer_sk) LEFT JOIN catalog_returns ON (cs_order_number = cr_order_number AND cs_item_sk = cr_item_sk) LEFT JOIN store_returns ON (cs_order_number = sr_ticket_number AND cs_item_sk = sr_item_sk) WHERE d_year = 2023 AND c_birth_country IN ('United States', 'Canada') GROUP BY d_year, d_month_seq, c_birth_country ORDER BY total_sales DESC, total_returns DESC, d_year, d_month_seq, c_birth_country;
SELECT st.s_store_name, st.s_store_id, SUM(ws.ws_net_paid) AS total_net_sales, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(wr.wr_order_number) AS total_returns, AVG(wr.wr_return_amt) AS avg_return_amount, ARRAY_AGG(DISTINCT re.r_reason_desc) AS reasons_for_returns FROM store st LEFT JOIN web_sales ws ON st.s_store_sk = ws.ws_warehouse_sk LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number LEFT JOIN reason re ON wr.wr_reason_sk = re.r_reason_sk WHERE st.s_division_id = 1 AND st.s_tax_precentage BETWEEN 0.01 AND 0.06 GROUP BY st.s_store_name, st.s_store_id ORDER BY total_net_sales DESC, avg_sales_price DESC, total_returns DESC, avg_return_amount DESC;
SELECT p.p_purpose, COUNT(DISTINCT p.p_promo_sk) AS num_promotions, AVG(p.p_cost) AS avg_promo_cost, SUM(CASE WHEN p.p_channel_dmail = 'Y' THEN 1 ELSE 0 END) AS dmail_channel_count, SUM(CASE WHEN p.p_channel_email = 'Y' THEN 1 ELSE 0 END) AS email_channel_count, COUNT(DISTINCT CASE WHEN cd.cd_purchase_estimate > 10000 THEN cd.cd_demo_sk END) AS high_value_customers, COUNT(DISTINCT CASE WHEN cd.cd_gender = 'M' THEN cd.cd_demo_sk END) AS male_customers, COUNT(DISTINCT CASE WHEN cd.cd_gender = 'F' THEN cd.cd_demo_sk END) AS female_customers, COUNT(DISTINCT CASE WHEN cd.cd_marital_status = 'S' THEN cd.cd_demo_sk END) AS single_customers, COUNT(DISTINCT CASE WHEN cd.cd_marital_status = 'M' THEN cd.cd_demo_sk END) AS married_customers FROM promotion p LEFT JOIN customer_demographics cd ON p.p_promo_sk = cd.cd_demo_sk WHERE p.p_discount_active = 'Y' GROUP BY p.p_purpose ORDER BY avg_promo_cost DESC, num_promotions DESC;
SELECT cc.cc_division_name, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_paid_inc_tax) AS total_sales_revenue, AVG(ws.ws_net_paid_inc_tax) AS average_order_value, SUM(sr.sr_return_amt_inc_tax) AS total_returns_revenue, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns_count, (SUM(ws.ws_net_paid_inc_tax) - SUM(sr.sr_return_amt_inc_tax)) AS net_revenue_after_returns FROM call_center cc LEFT JOIN web_sales ws ON cc.cc_call_center_sk = ws.ws_web_site_sk LEFT JOIN store_returns sr ON ws.ws_item_sk = sr.sr_item_sk WHERE cc.cc_division_name IN ('ought', 'ese', 'pri', 'anti') AND ws.ws_sold_date_sk IS NOT NULL AND sr.sr_returned_date_sk IS NOT NULL GROUP BY cc.cc_division_name ORDER BY net_revenue_after_returns DESC;
SELECT hd.hd_dep_count AS number_of_dependents, hd.hd_vehicle_count AS number_of_vehicles, ca.ca_location_type AS customer_location_type, ca.ca_street_type AS street_type, t.t_am_pm AS return_time_period, COUNT(DISTINCT cr.cr_order_number) AS total_returned_orders, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk JOIN time_dim t ON cr.cr_returned_time_sk = t.t_time_sk WHERE ca.ca_location_type IN ('single family', 'apartment', 'condo') AND ca.ca_street_type IN ('Boulevard', 'Ct.', 'Avenue', 'Way', 'Parkway', 'ST') AND t.t_am_pm = 'AM' GROUP BY hd.hd_dep_count, hd.hd_vehicle_count, ca.ca_location_type, ca.ca_street_type, t.t_am_pm ORDER BY total_net_loss DESC, average_return_amount DESC;
SELECT hd.hd_buy_potential, ib.ib_income_band_sk, sm.sm_carrier, r.r_reason_desc, COUNT(*) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_return_quantity) AS total_return_quantity, AVG(cr.cr_return_quantity) AS average_return_quantity FROM catalog_returns cr JOIN customer_demographics cd ON cr.cr_refunded_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON cr.cr_refunded_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk WHERE hd.hd_buy_potential = '5001-10000' AND ib.ib_lower_bound IN (90001, 30001, 60001) AND sm.sm_carrier IN ('GERMA', 'FEDEX', 'BARIAN') AND r.r_reason_desc IN ('Does not work with a product that I have', 'Did not get it on time', 'Did not like the color') GROUP BY hd.hd_buy_potential, ib.ib_income_band_sk, sm.sm_carrier, r.r_reason_desc ORDER BY total_return_amount DESC, total_returns DESC LIMIT 100;
SELECT cp.cp_department, cp.cp_type, COUNT(DISTINCT ws.ws_web_page_sk) AS total_web_pages, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ws.ws_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(ws.ws_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(ws.ws_net_profit) AS total_net_profit FROM catalog_page cp JOIN web_sales ws ON cp.cp_catalog_page_sk = ws.ws_web_page_sk WHERE cp.cp_end_date_sk = 2451114 AND ws.ws_ext_discount_amt = 2691.00 GROUP BY cp.cp_department, cp.cp_type ORDER BY total_net_paid DESC;
SELECT dd.d_year, dd.d_quarter_name, COUNT(DISTINCT ss.ss_ticket_number) AS store_sales_count, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, COUNT(DISTINCT wp.wp_web_page_sk) AS web_pages_accessed, SUM(wp.wp_link_count) AS total_links_accessed FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk LEFT JOIN catalog_returns cr ON cr.cr_returned_date_sk = dd.d_date_sk LEFT JOIN web_page wp ON wp.wp_access_date_sk = dd.d_date_sk WHERE dd.d_year = 2000 AND wp.wp_type = 'product' AND ss.ss_net_paid > 0 AND cr.cr_return_amount IS NOT NULL GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT dd.d_year AS return_year, ca.ca_state AS state, ib.ib_lower_bound || ' - ' || ib.ib_upper_bound AS income_band, COUNT(*) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_return_tax) AS total_return_tax, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN date_dim dd ON cr.cr_returned_date_sk = dd.d_date_sk JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE ca.ca_state IN ('WY', 'GA', 'LA', 'ME', 'MI') AND ib.ib_income_band_sk BETWEEN 6 AND 8 AND dd.d_year = 2023 GROUP BY return_year, state, income_band ORDER BY return_year, state, total_net_loss DESC;
SELECT dd.d_year, dd.d_quarter_name, cc.cc_division_name, SUM(wp.wp_char_count) AS total_char_count, AVG(wp.wp_link_count) AS average_link_count, COUNT(*) AS num_web_pages_accessed, COUNT(DISTINCT cc.cc_call_center_sk) AS num_call_centers_involved, COUNT(DISTINCT r.r_reason_sk) AS num_distinct_reasons FROM date_dim AS dd JOIN web_page AS wp ON dd.d_date_sk = wp.wp_access_date_sk JOIN call_center AS cc ON wp.wp_customer_sk = cc.cc_call_center_sk LEFT JOIN reason AS r ON r.r_reason_sk = wp.wp_customer_sk WHERE dd.d_year = 2022 AND dd.d_quarter_name IN ('Q1', 'Q2', 'Q3', 'Q4') AND r.r_reason_sk IN ('15', '31', '3', '32', '5') GROUP BY dd.d_year, dd.d_quarter_name, cc.cc_division_name ORDER BY dd.d_year, dd.d_quarter_name, cc.cc_division_name;
