SELECT s.s_store_name, s.s_street_name, s.s_street_type, s.s_city, s.s_state, s.s_zip, SUM(sr.sr_return_amt_inc_tax) AS total_store_refunds, AVG(sr.sr_return_amt_inc_tax) AS avg_store_refund, COUNT(sr.sr_return_amt_inc_tax) AS num_store_returns, SUM(wr.wr_return_amt_inc_tax) AS total_web_refunds, AVG(wr.wr_return_amt_inc_tax) AS avg_web_refund, COUNT(wr.wr_return_amt_inc_tax) AS num_web_returns FROM store s LEFT JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk LEFT JOIN date_dim d_store ON sr.sr_returned_date_sk = d_store.d_date_sk LEFT JOIN web_returns wr ON s.s_store_sk = wr.wr_returning_customer_sk LEFT JOIN date_dim d_web ON wr.wr_returned_date_sk = d_web.d_date_sk WHERE s.s_street_type IN ('Road', 'Circle', 'Court') AND (d_store.d_quarter_name = '1906Q2' OR d_web.d_quarter_name = '1906Q2') GROUP BY s.s_store_name, s.s_street_name, s.s_street_type, s.s_city, s.s_state, s.s_zip ORDER BY total_store_refunds DESC, total_web_refunds DESC;
SELECT sm.sm_type AS shipping_type, w.w_city AS warehouse_city, r.r_reason_desc AS return_reason, COUNT(*) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_inc_tax, AVG(cr.cr_fee) AS average_fee, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk GROUP BY shipping_type, warehouse_city, return_reason ORDER BY total_returns DESC, total_returned_quantity DESC;
SELECT cd.cd_education_status, cd.cd_gender, cd.cd_marital_status, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(sr.sr_return_amt_inc_tax) AS total_returns_inc_tax, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, COUNT(sr.sr_item_sk) AS total_returned_items, SUM(sr.sr_net_loss) AS total_net_loss FROM customer_demographics cd JOIN customer c ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN web_page wp ON c.c_customer_sk = wp.wp_customer_sk WHERE c.c_first_shipto_date_sk IN ('2452105', '2451393') AND c.c_first_sales_date_sk IN ('2450519', '2451079') AND cd.cd_gender IN ('M', 'F') AND wp.wp_type IN ('feedback', 'general', 'protected') GROUP BY cd.cd_education_status, cd.cd_gender, cd.cd_marital_status ORDER BY total_returns_inc_tax DESC, avg_purchase_estimate DESC;
SELECT COUNT(DISTINCT c.c_customer_sk) AS total_customers, AVG(w.w_warehouse_sq_ft) AS average_warehouse_size, SUM(p.p_cost) AS total_promotion_cost, s.s_state, s.s_city, COUNT(DISTINCT s.s_store_sk) AS total_stores, AVG(s.s_number_employees) AS average_store_employees FROM customer c JOIN store s ON c.c_current_addr_sk = s.s_store_sk JOIN warehouse w ON s.s_zip = w.w_zip JOIN promotion p ON p.p_channel_event = 'N' AND p.p_purpose != 'Unknown' GROUP BY s.s_state, s.s_city ORDER BY total_customers DESC, average_warehouse_size DESC, total_promotion_cost DESC;
SELECT dd.d_quarter_name, cd.cd_education_status, cd.cd_purchase_estimate, AVG(ss.ss_sales_price) AS avg_sales_price, AVG(sr.sr_return_amt) AS avg_return_amount, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number WHERE dd.d_qoy IN ('1', '2', '3', '4') AND cd.cd_purchase_estimate IN ('1500', '500', '4000') GROUP BY dd.d_quarter_name, cd.cd_education_status, cd.cd_purchase_estimate ORDER BY dd.d_quarter_name, cd.cd_education_status, cd.cd_purchase_estimate;
SELECT cd.cd_education_status, cd.cd_credit_rating, AVG(sr.sr_return_amt) AS avg_store_return_amt, SUM(cr.cr_return_amount) AS sum_catalog_return_amt, COUNT(DISTINCT sr.sr_customer_sk) AS unique_store_customers, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_catalog_customers FROM customer_demographics cd LEFT JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk LEFT JOIN catalog_returns cr ON cd.cd_demo_sk = cr.cr_returning_cdemo_sk LEFT JOIN household_demographics hd ON cd.cd_demo_sk = hd.hd_demo_sk WHERE cd.cd_purchase_estimate IN (3500, 1500, 10000) AND cd.cd_dep_college_count = 0 AND hd.hd_income_band_sk IN (19, 8, 15, 3, 1) GROUP BY cd.cd_education_status, cd.cd_credit_rating ORDER BY avg_store_return_amt DESC, sum_catalog_return_amt DESC;
SELECT i.i_category, i.i_color, COUNT(DISTINCT cr.cr_item_sk) AS num_returns, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_return_quantity) AS total_returned_quantity, cc.cc_name AS call_center, w.w_warehouse_name AS warehouse, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages, COUNT(DISTINCT wp.wp_web_page_sk) AS num_web_pages FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN web_page wp ON cp.cp_start_date_sk = wp.wp_creation_date_sk WHERE i.i_color IN ('linen', 'midnight', 'powder', 'tan') AND cp.cp_catalog_number IN (46, 18, 2) AND w.w_gmt_offset = -5.00 GROUP BY i.i_category, i.i_color, cc.cc_name, w.w_warehouse_name ORDER BY total_return_amount DESC;
SELECT cc.cc_company_name, r.r_reason_desc, COUNT(wr.wr_returned_date_sk) AS total_returns, SUM(wr.wr_return_amt_inc_tax) AS total_refund_amount, AVG(wr.wr_return_amt_inc_tax) AS average_refund_amount FROM web_returns wr JOIN call_center cc ON wr.wr_refunded_customer_sk::text LIKE '%' || cc.cc_call_center_id JOIN reason r ON wr.wr_reason_sk = r.r_reason_sk JOIN household_demographics hd ON wr.wr_refunded_hdemo_sk = hd.hd_demo_sk WHERE cc.cc_company_name IN ('able', 'pri', 'cally', 'ought') AND hd.hd_dep_count = 0 AND hd.hd_income_band_sk IN (17, 20, 13, 15, 2, 1) AND r.r_reason_desc IN ('Not working any more', 'duplicate purchase', 'reason 28', 'Stopped working', 'reason 24', 'reason 27') GROUP BY cc.cc_company_name, r.r_reason_desc ORDER BY total_refund_amount DESC;
SELECT r.r_reason_desc, COUNT(sr.sr_ticket_number) AS return_count, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_return_amt_inc_tax) AS total_amount_incl_tax, SUM(sr.sr_fee) AS total_fees, AVG(wp.wp_link_count) AS average_link_count, AVG(wp.wp_image_count) AS average_image_count FROM store_returns sr JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk LEFT JOIN web_page wp ON c.c_customer_sk = wp.wp_customer_sk WHERE sr.sr_return_quantity > 1 AND c.c_birth_country IN ('YEMEN', 'POLAND', 'SWITZERLAND') AND wp.wp_image_count IN (2, 4, 5) GROUP BY r.r_reason_desc ORDER BY total_returned_quantity DESC, average_return_amount DESC;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, cd.cd_education_status, sum(cs.cs_quantity) as total_quantity_sold, avg(cs.cs_sales_price) as average_sales_price, count(distinct cs.cs_order_number) as number_of_orders, sum(cs.cs_net_profit) as total_net_profit FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE cd.cd_education_status IN ('College', 'Advanced Degree', '4 yr Degree') AND i.i_manager_id IN (69, 90) AND (cs.cs_sold_date_sk BETWEEN 2004001 AND 2004003 OR cs.cs_sold_date_sk BETWEEN 2004025 AND 2004028) AND (w.w_state = 'TN' OR w.w_country = 'United States') AND p.p_channel_email = 'Y' AND cs.cs_quantity >= 5 AND cs.cs_net_profit > 0 GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, cd.cd_education_status HAVING count(distinct cs.cs_order_number) > 1 ORDER BY total_net_profit DESC, number_of_orders DESC, cd.cd_education_status, c.c_last_name, c.c_first_name;
SELECT i_category, i_brand, sum(i_current_price) as total_sales, avg(i_current_price) as avg_price, count(i_item_sk) as item_count, sum(inv_quantity_on_hand) as total_inventory, sum(wr_return_amt_inc_tax) as total_returns, avg(wr_fee) as avg_return_fee, count(distinct wp_web_page_sk) as page_count, sum(case when wp_autogen_flag = 'Y' then 1 else 0 end) as autogen_page_count FROM item LEFT JOIN inventory ON i_item_sk = inv_item_sk LEFT JOIN web_returns ON i_item_sk = wr_item_sk LEFT JOIN web_page ON wr_web_page_sk = wp_web_page_sk LEFT JOIN promotion ON i_item_sk = p_item_sk WHERE i_rec_end_date IS NULL AND (i_category = 'Electronics' OR i_category = 'Home Goods') AND wp_url = 'http://www.foo.com' AND p_discount_active = 'Y' GROUP BY i_category, i_brand ORDER BY total_sales DESC, total_inventory DESC;
SELECT dd.d_year, dd.d_quarter_name, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, SUM(sr.sr_return_amt_inc_tax) AS total_store_return_value, AVG(sr.sr_return_amt_inc_tax) AS avg_store_return_value, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_returns, SUM(cr.cr_return_amt_inc_tax) AS total_catalog_return_value, AVG(cr.cr_return_amt_inc_tax) AS avg_catalog_return_value, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(inv.inv_quantity_on_hand) AS avg_inventory, COUNT(DISTINCT p.p_promo_sk) AS total_promotions, SUM(p.p_cost) AS total_promotion_cost, AVG(p.p_cost) AS avg_promotion_cost FROM date_dim dd LEFT JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk LEFT JOIN catalog_returns cr ON dd.d_date_sk = cr.cr_returned_date_sk LEFT JOIN inventory inv ON dd.d_date_sk = inv.inv_date_sk LEFT JOIN promotion p ON dd.d_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk WHERE dd.d_current_quarter = 'N' AND dd.d_dow IN ('2', '1', '3') AND dd.d_week_seq IN ('357', '270', '599') AND dd.d_day_name IN ('Friday', 'Wednesday', 'Thursday') AND cr.cr_refunded_cash IN ('41.98', '2827.18', '326.60') AND cr.cr_return_tax IN ('78.35', '1.90', '17.50') AND cr.cr_reason_sk IN ('10', '6', '34') AND inv.inv_date_sk = '2450815' AND inv.inv_quantity_on_hand IN ('527', '833', '192') AND sr.sr_store_credit IN ('65.83', '69.57', '46.64') AND sr.sr_return_amt_inc_tax IN ('1345.99', '37.28', '546.00') AND sr.sr_hdemo_sk IN ('5161', '6269', '797') AND p.p_channel_radio = 'N' AND p.p_channel_press = 'N' GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT sm.sm_type, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_wholesale_cost) AS avg_wholesale_cost, AVG(ws.ws_sales_price) AS avg_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk WHERE w.w_zip = '35709' AND ws.ws_web_site_sk IN (30, 17, 4, 15, 14, 2) AND sm.sm_ship_mode_sk IN (4, 9, 13, 10, 8, 20) GROUP BY sm.sm_type ORDER BY total_net_profit DESC;
SELECT c.c_first_name, c.c_last_name, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(s.s_number_employees) AS avg_store_employees, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages, MAX(sm.sm_code) AS max_ship_mode_code FROM customer c JOIN web_page wp ON c.c_customer_sk = wp.wp_customer_sk JOIN store s ON s.s_zip = CAST(c.c_current_addr_sk AS CHAR(10)) JOIN warehouse w ON w.w_zip = s.s_zip JOIN ship_mode sm ON sm.sm_code = w.w_zip WHERE w.w_gmt_offset = '-5.00' AND (wp.wp_char_count = '2129' OR wp.wp_char_count = '2531') AND (wp.wp_rec_end_date = '1999-09-03' OR wp.wp_rec_end_date = '2001-09-02' OR wp.wp_rec_end_date = '2000-09-02') GROUP BY c.c_first_name, c.c_last_name;
SELECT wd.web_class, COUNT(DISTINCT cr.cr_item_sk) AS unique_refunded_items, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_refunded_customers, SUM(cr.cr_return_amt_inc_tax + cr.cr_fee + cr.cr_return_ship_cost) AS total_refund_cost, AVG(cr.cr_return_amt_inc_tax) AS avg_refund_amount_inc_tax, cd.cd_education_status, COUNT(*) AS number_of_returns FROM catalog_returns cr JOIN customer_demographics cd ON cr.cr_refunded_cdemo_sk = cd.cd_demo_sk JOIN web_site wd ON wd.web_country = 'United States' AND wd.web_class IS NOT NULL WHERE EXISTS (SELECT 1 FROM inventory WHERE inv_item_sk = cr.cr_item_sk AND inv_quantity_on_hand > 500) GROUP BY wd.web_class, cd.cd_education_status ORDER BY total_refund_cost DESC, avg_refund_amount_inc_tax DESC, number_of_returns DESC;
SELECT d_year, d_quarter_name, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN date_dim ON catalog_sales.cs_sold_date_sk = date_dim.d_date_sk JOIN customer ON catalog_sales.cs_bill_customer_sk = customer.c_customer_sk JOIN warehouse ON catalog_sales.cs_warehouse_sk = warehouse.w_warehouse_sk WHERE d_year = 2003 AND d_quarter_seq IN (1, 27, 15, 31, 53, 21) AND c_birth_country = 'United States' AND w_country = 'United States' GROUP BY d_year, d_quarter_name ORDER BY d_year, d_quarter_name;
SELECT d.d_year, d.d_quarter_name, d.d_moy, d.d_holiday, w.w_city, w.w_gmt_offset, SUM(wp.wp_link_count) AS total_links, AVG(wp.wp_char_count) AS average_char_count, COUNT(DISTINCT wp.wp_customer_sk) AS distinct_customers, COUNT(*) AS page_count FROM web_page wp JOIN date_dim d ON wp.wp_access_date_sk = d.d_date_sk JOIN warehouse w ON w.w_gmt_offset = '-5.00' WHERE d.d_moy IN ('5', '11') AND (d.d_holiday = 'Y' OR d.d_holiday = 'N') AND w.w_city = 'Fairview' AND NOT EXISTS ( SELECT 1 FROM time_dim t WHERE t.t_time_sk = wp.wp_access_date_sk AND t.t_sub_shift = 'night' ) GROUP BY d.d_year, d.d_quarter_name, d.d_moy, d.d_holiday, w.w_city, w.w_gmt_offset ORDER BY d.d_year, d.d_quarter_name, d.d_moy, total_links DESC;
SELECT cc_state, r_reason_desc, SUM(inv_quantity_on_hand) AS total_inventory, AVG(c_birth_year) AS average_customer_birth_year, COUNT(DISTINCT c_customer_sk) AS unique_customers, COUNT(DISTINCT web_site_sk) AS web_sites_operating FROM inventory JOIN reason ON (r_reason_sk = inv_quantity_on_hand) JOIN call_center ON (cc_division = inv_warehouse_sk) JOIN customer ON (c_current_addr_sk = cc_open_date_sk) JOIN web_site ON (web_state = cc_state) WHERE inv_date_sk = 2450815 AND c_customer_id IN ('AAAAAAAACHMAAAAA', 'AAAAAAAANPEAAAAA') AND (cc_rec_end_date IS NULL OR cc_rec_end_date > CURRENT_DATE) AND (web_rec_end_date IS NULL OR web_rec_end_date > CURRENT_DATE) GROUP BY cc_state, r_reason_desc ORDER BY total_inventory DESC, average_customer_birth_year;
SELECT s_store_name, s_state, COUNT(sr_ticket_number) AS total_returns, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_quantity) AS average_return_quantity, SUM(ws_net_paid_inc_tax) AS total_sales_inc_tax, AVG(ws_list_price) AS average_list_price, AVG(ws_net_profit) AS average_net_profit FROM store s JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk JOIN web_sales ws ON sr.sr_item_sk = ws.ws_item_sk JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE c.c_email_address IN ( 'Adam.Chambers@1fmL5RoSch74.edu', 'William.Kaye@Mx1n74bCJjkc08.edu', 'Imogene.Lewis@813MelxMLZ9gy.com', 'Dorothy.Garza@6Tn1dJ431OQYNTb.org', 'Ora.Spain@CT.edu', 'Denise.Gomez@3GlO.edu' ) AND ws.ws_net_paid_inc_tax IN (15407.14, 2937.00, 988.50, 3439.64, 992.77) AND ws.ws_list_price IN (177.80, 201.11) AND hd.hd_income_band_sk IN (16, 7) AND sr.sr_return_tax IN (215.85, 29.41, 35.05, 67.89) GROUP BY s_store_name, s_state ORDER BY total_return_amount DESC;
SELECT s_store_name, COUNT(DISTINCT ws_order_number) AS total_web_sales_orders, SUM(ws_net_paid) AS total_web_sales_revenue, AVG(ws_quantity) AS avg_web_sales_quantity, SUM(sr_return_amt) AS total_store_returns_revenue, AVG(sr_return_quantity) AS avg_store_returns_quantity, COUNT(DISTINCT cr_order_number) AS total_catalog_returns_orders, SUM(cr_return_amount) AS total_catalog_returns_revenue, AVG(cr_return_quantity) AS avg_catalog_returns_quantity FROM web_sales JOIN store ON ws_ship_customer_sk = s_store_sk JOIN store_returns ON sr_store_sk = s_store_sk JOIN catalog_returns ON cr_catalog_page_sk IN (SELECT cp_catalog_page_sk FROM catalog_page WHERE cp_type = 'monthly') JOIN ship_mode ON web_sales.ws_ship_mode_sk = ship_mode.sm_ship_mode_sk WHERE ws_sold_date_sk BETWEEN 2452235 AND 2452629 AND sr_returned_date_sk = ws_sold_date_sk AND cr_returned_date_sk = ws_sold_date_sk AND ws_net_paid_inc_ship_tax > 7000 AND sm_type IN ('OVERNIGHT', 'REGULAR') GROUP BY s_store_name ORDER BY total_web_sales_revenue DESC;
SELECT s.s_store_name, c.c_first_name, c.c_last_name, COUNT(ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_items_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk WHERE s.s_floor_space IN (9026222, 7557959, 9341467, 6995995, 5219562) AND c.c_current_hdemo_sk IN (6755, 780, 352, 3208, 1770) AND c.c_email_address IN ('Joseph.Hilton@io2VIr.org', 'Scott.Goodman@EN4g6ehG4eh1.com', 'Charles.Fink@5cPLD.com', 'Rosa.Nixon@ghkTsItbO5o8hKtVkdI.com') GROUP BY s.s_store_name, c.c_first_name, c.c_last_name ORDER BY total_net_profit DESC, total_net_paid DESC;
