SELECT dt.d_year, dt.d_quarter_name, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ws.ws_net_paid_inc_tax) AS total_web_net_paid_inc_tax, cc.cc_city, AVG(hd.hd_dep_count) AS average_household_dependency_count, SUM(inv.inv_quantity_on_hand) AS total_inventory_on_hand FROM date_dim dt JOIN store_sales ss ON dt.d_date_sk = ss.ss_sold_date_sk JOIN web_sales ws ON dt.d_date_sk = ws.ws_sold_date_sk JOIN customer c ON (ss.ss_customer_sk = c.c_customer_sk OR ws.ws_bill_customer_sk = c.c_customer_sk) JOIN call_center cc ON (cc.cc_open_date_sk = dt.d_date_sk OR cc.cc_closed_date_sk = dt.d_date_sk) JOIN household_demographics hd ON (c.c_current_hdemo_sk = hd.hd_demo_sk OR ws.ws_bill_hdemo_sk = hd.hd_demo_sk) JOIN inventory inv ON dt.d_date_sk = inv.inv_date_sk WHERE dt.d_moy = 5 AND (dt.d_qoy = 1 OR dt.d_qoy = 2 OR dt.d_qoy = 3) AND (c.c_first_shipto_date_sk IN (2449442, 2451172, 2452404)) AND cc.cc_city = 'Midway' AND (ws.ws_item_sk IN (4, 103, 60)) AND (ws.ws_sales_price IN (38.82, 43.63, 82.62, 63.23)) GROUP BY dt.d_year, dt.d_quarter_name, cc.cc_city ORDER BY total_quantity_sold DESC, average_sales_price DESC, total_inventory_on_hand DESC, dt.d_year, dt.d_quarter_name;
SELECT d.d_year, d.d_quarter_name, p.p_promo_name, sm.sm_type, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_net_profit, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, SUM(ws.ws_net_paid_inc_tax) AS total_web_sales_inc_tax FROM date_dim d JOIN catalog_sales cs ON cs.cs_sold_date_sk = d.d_date_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number LEFT JOIN web_sales ws ON cs.cs_order_number = ws.ws_order_number WHERE d.d_year = 2003 AND p.p_channel_details LIKE '%early%' GROUP BY d.d_year, d.d_quarter_name, p.p_promo_name, sm.sm_type ORDER BY total_net_profit DESC, total_quantity_sold DESC LIMIT 100;
SELECT i_category, i_brand, COUNT(DISTINCT i_item_sk) AS total_items, SUM(i_current_price) AS total_sales_value, AVG(i_wholesale_cost) AS average_wholesale_cost FROM item WHERE i_units IN ('Dozen', 'Bundle', 'Lb') AND i_manufact IN ('eseantieing', 'ableablepri') GROUP BY i_category, i_brand ORDER BY total_sales_value DESC LIMIT 100;
SELECT dd.d_year, dd.d_quarter_name, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cr.cr_item_sk) AS distinct_items_returned, COUNT(DISTINCT cr.cr_returning_customer_sk) AS distinct_customers_returned, SUM(i.i_current_price * cr.cr_return_quantity) AS total_sales_lost, COUNT(DISTINCT wp.wp_web_page_sk) AS distinct_web_pages_accessed, SUM(wp.wp_char_count) AS total_web_chars FROM catalog_returns cr JOIN date_dim dd ON cr.cr_returned_date_sk = dd.d_date_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk LEFT JOIN web_page wp ON dd.d_date_sk = wp.wp_access_date_sk WHERE dd.d_current_day = 'N' AND dd.d_day_name IN ('Wednesday', 'Monday', 'Saturday', 'Thursday', 'Tuesday') AND cr.cr_returning_addr_sk IN ('13215', '22286', '5756', '38251', '6237') GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT d_year, i_category, SUM(wr_return_quantity) AS total_return_quantity, AVG(wr_return_amt) AS avg_return_amount, COUNT(DISTINCT wr_order_number) AS total_orders, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(wr_fee) AS total_fees, SUM(wr_net_loss) AS total_net_loss, r_reason_desc, hd_dep_count, hd_vehicle_count FROM web_returns JOIN date_dim ON web_returns.wr_returned_date_sk = date_dim.d_date_sk JOIN item ON web_returns.wr_item_sk = item.i_item_sk JOIN reason ON web_returns.wr_reason_sk = reason.r_reason_sk JOIN household_demographics ON web_returns.wr_returning_hdemo_sk = household_demographics.hd_demo_sk WHERE d_year = 2022 AND i_wholesale_cost BETWEEN 2.00 AND 10.00 AND i_container <> 'Unknown' GROUP BY d_year, i_category, r_reason_desc, hd_dep_count, hd_vehicle_count ORDER BY total_return_quantity DESC, avg_return_amount DESC;
SELECT ca_state, w_city, wp_type, SUM(cs_net_paid) as total_catalog_sales, AVG(ws_net_paid_inc_ship_tax) as avg_web_sales_inc_ship_tax, COUNT(DISTINCT ws_web_page_sk) as distinct_web_pages_accessed, COUNT(DISTINCT sr_reason_sk) as count_distinct_return_reasons, SUM(sr_return_amt) as total_return_amount, MIN(cs_sales_price) as min_catalog_sales_price, MAX(ws_sales_price) as max_web_sales_price FROM customer_address JOIN catalog_sales ON ca_address_sk = cs_ship_addr_sk JOIN web_sales ON ca_address_sk = ws_bill_addr_sk JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk JOIN web_page ON ws_web_page_sk = wp_web_page_sk LEFT JOIN store_returns ON sr_addr_sk = ca_address_sk WHERE w_city = 'Fairview' AND wp_type IN ('feedback', 'dynamic', 'protected', 'welcome', 'general') AND ws_web_site_sk IN ('22', '17', '24', '18', '2') AND cs_ship_customer_sk IN ('47431', '33123', '91253') GROUP BY ca_state, w_city, wp_type ORDER BY total_catalog_sales DESC, avg_web_sales_inc_ship_tax DESC;
SELECT ca_state, cp_department, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(ss_net_paid) AS total_net_paid, SUM(ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss_net_profit) AS total_net_profit FROM store_sales JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN catalog_page ON ss_promo_sk = cp_catalog_page_sk WHERE ss_sold_date_sk = 2450815 AND cp_description IN ( 'Only nuclear policies understand so basic courts.', 'Just local products used to note well; areas note', 'Women apply in vain in the minutes. Officials can', 'Traditional, clear years used to cover regardless' ) AND ss_cdemo_sk IN ( SELECT cd_demo_sk FROM customer_demographics WHERE cd_dep_count IN ('1', '2') ) GROUP BY ca_state, cp_department ORDER BY total_net_profit DESC, total_quantity_sold DESC;
SELECT cp.cp_department, sm.sm_type, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_net_profit, AVG(cs.cs_net_profit) AS average_net_profit, SUM(wr.wr_return_quantity) AS total_return_quantity, SUM(wr.wr_net_loss) AS total_net_loss FROM catalog_sales cs JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number WHERE cp.cp_type IN ('quarterly', 'bi-annual', 'monthly') AND cs.cs_ext_tax IN (10.31, 370.42, 9.07) GROUP BY cp.cp_department, sm.sm_type ORDER BY total_net_profit DESC, total_net_loss ASC;
SELECT p.p_promo_name, p.p_channel_details, cp.cp_department, w.w_state, AVG(ws_net_profit) AS avg_web_sales_profit, AVG(wr_net_loss) AS avg_web_returns_loss, SUM(ws_quantity) AS total_quantity_sold, COUNT(DISTINCT ws_web_page_sk) AS count_unique_pages_sold, COUNT(DISTINCT wr_web_page_sk) AS count_unique_pages_returned FROM promotion p JOIN web_sales ws ON p.p_promo_sk = ws.ws_promo_sk JOIN catalog_page cp ON ws.ws_web_page_sk = cp.cp_catalog_page_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk LEFT JOIN web_returns wr ON ws.ws_item_sk = wr.wr_item_sk AND ws.ws_order_number = wr.wr_order_number WHERE cp.cp_start_date_sk BETWEEN '2450906' AND '2451420' AND cp.cp_end_date_sk BETWEEN '2451419' AND '2451664' AND (wr.wr_returned_date_sk IS NULL OR wr.wr_returned_date_sk BETWEEN ws_sold_date_sk AND ws_sold_date_sk + 30) GROUP BY p.p_promo_name, p.p_channel_details, cp.cp_department, w.w_state ORDER BY avg_web_sales_profit DESC, avg_web_returns_loss DESC;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, SUM(cr.cr_return_quantity) AS total_catalog_return_quantity, AVG(cr.cr_return_amount) AS avg_catalog_return_amount, COUNT(DISTINCT cr.cr_order_number) AS num_catalog_orders_returned, SUM(sr.sr_return_quantity) AS total_store_return_quantity, AVG(sr.sr_return_amt) AS avg_store_return_amount, COUNT(DISTINCT sr.sr_ticket_number) AS num_store_tickets_returned, (SUM(cr.cr_return_quantity) + SUM(sr.sr_return_quantity)) AS total_combined_return_quantity, (SUM(cr.cr_return_amount) + SUM(sr.sr_return_amt)) AS total_combined_return_amount FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk LEFT JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_refunded_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk WHERE cd.cd_dep_college_count = 0 AND (cd.cd_dep_count = 1 OR cd.cd_dep_count = 2) AND (c.c_birth_month IN (1, 5, 8)) AND (cr.cr_refunded_cdemo_sk IN (720990, 944590, 673975, 63720) OR cr.cr_refunded_cdemo_sk IS NULL) AND (sr.sr_ticket_number::text IN ('40123', '36273') OR sr.sr_ticket_number IS NULL) GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY total_combined_return_amount DESC, c.c_customer_id;
SELECT ca.ca_state AS State, AVG(hd.hd_income_band_sk) AS Avg_Income_Band, AVG(hd.hd_dep_count) AS Avg_Dependent_Count, AVG(hd.hd_vehicle_count) AS Avg_Vehicle_Count, COUNT(*) FILTER (WHERE hd.hd_buy_potential = 'High') AS High_Buying_Potential_Count, COUNT(*) FILTER (WHERE hd.hd_buy_potential = 'Medium') AS Medium_Buying_Potential_Count, COUNT(*) FILTER (WHERE hd.hd_buy_potential = 'Low') AS Low_Buying_Potential_Count, COUNT(DISTINCT ca.ca_address_sk) AS Address_Count, AVG(ws.web_tax_percentage) AS Avg_Web_Tax_Percentage FROM customer_address ca JOIN household_demographics hd ON ca.ca_address_sk = hd.hd_demo_sk JOIN web_site ws ON ca.ca_state = ws.web_state WHERE ca.ca_country = 'United States' AND ws.web_country = 'United States' AND ca.ca_state IS NOT NULL AND ws.web_tax_percentage IS NOT NULL GROUP BY ca.ca_state ORDER BY Avg_Income_Band DESC, High_Buying_Potential_Count DESC, Medium_Buying_Potential_Count DESC, Low_Buying_Potential_Count DESC;
SELECT r.r_reason_desc AS reason_for_return, COUNT(*) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, cd.cd_gender AS customer_gender, cd.cd_education_status AS customer_education, w.w_warehouse_name AS warehouse_name, w.w_city AS warehouse_city, w.w_state AS warehouse_state FROM catalog_returns cr JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN customer_demographics cd ON cr.cr_returning_cdemo_sk = cd.cd_demo_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk GROUP BY r.r_reason_desc, cd.cd_gender, cd.cd_education_status, w.w_warehouse_name, w.w_city, w.w_state ORDER BY total_returns DESC, total_return_amount DESC LIMIT 100;
SELECT cp.cp_department, i.i_category, COUNT(DISTINCT cp.cp_catalog_page_sk) AS total_catalog_pages, COUNT(DISTINCT i.i_item_sk) AS total_items, AVG(i.i_current_price) AS average_item_price, SUM(i.i_wholesale_cost) AS total_wholesale_cost, MAX(hd.hd_dep_count) AS max_dep_count, AVG(hd.hd_vehicle_count) AS average_vehicle_count, COUNT(DISTINCT web.web_site_sk) AS total_websites, web.web_country, SUM(web.web_tax_percentage) AS total_tax_percentage FROM catalog_page cp JOIN item i ON cp.cp_catalog_number = i.i_brand_id JOIN household_demographics hd ON hd.hd_income_band_sk = i.i_class_id JOIN web_site web ON web.web_company_id = i.i_manufact_id WHERE web.web_rec_end_date BETWEEN '1999-08-16' AND '2001-08-15' GROUP BY cp.cp_department, i.i_category, web.web_country ORDER BY total_catalog_pages DESC, total_items DESC, average_item_price ASC, total_websites DESC;
SELECT ca.ca_state, hd.hd_dep_count, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_profit) AS total_net_profit, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns FROM customer_address ca JOIN catalog_sales cs ON ca.ca_address_sk = cs.cs_bill_addr_sk JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk LEFT JOIN store_returns sr ON cs.cs_item_sk = sr.sr_item_sk AND cs.cs_order_number = sr.sr_ticket_number WHERE ca.ca_country = 'United States' AND (hd.hd_dep_count BETWEEN 0 AND 4 OR hd.hd_dep_count IN (6, 9)) AND cs.cs_bill_addr_sk IN (39103, 23918, 32261, 20802) AND cs.cs_bill_cdemo_sk = 625624 GROUP BY ca.ca_state, hd.hd_dep_count ORDER BY total_net_profit DESC, total_return_amount DESC;
SELECT p.p_promo_name, avg(cs.cs_sales_price) AS avg_sales_price, sum(cs.cs_ext_discount_amt) AS total_discount_amount, sum(cs.cs_net_profit) AS total_net_profit, cd.cd_gender, cd.cd_education_status, count(cs.cs_order_number) AS total_orders FROM catalog_sales cs JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk WHERE p.p_channel_email = 'N' AND d.d_year = 2022 GROUP BY p.p_promo_name, cd.cd_gender, cd.cd_education_status ORDER BY total_net_profit DESC;
SELECT w_state, sm_type, EXTRACT(YEAR FROM wp_rec_start_date) AS year, EXTRACT(QUARTER FROM wp_rec_start_date) AS quarter, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk JOIN web_page ON cs_catalog_page_sk = wp_web_page_sk JOIN time_dim ON cs_sold_time_sk = t_time_sk JOIN inventory ON cs_warehouse_sk = inv_warehouse_sk AND cs_item_sk = inv_item_sk WHERE t_time_sk IN (1701, 993, 898, 4227, 3566, 3142) AND sm_carrier IN ('GERMA', 'DHL', 'ORIENTAL', 'PRIVATECARRIER') AND inv_date_sk = 2450815 GROUP BY w_state, sm_type, year, quarter ORDER BY total_net_profit DESC, total_net_paid DESC, total_orders DESC;
SELECT ca_state, i_category, cc_name, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, COUNT(*) AS num_returns, SUM(wr_return_amt) AS total_web_return_amount, AVG(wr_return_amt) AS avg_web_return_amount, COUNT(DISTINCT wr_order_number) AS num_web_returns FROM catalog_returns JOIN customer_address ON cr_returning_addr_sk = ca_address_sk JOIN item ON cr_item_sk = i_item_sk JOIN call_center ON cr_call_center_sk = cc_call_center_sk JOIN web_returns ON cr_item_sk = wr_item_sk AND cr_order_number = wr_order_number WHERE ca_state IN ('TN', 'CA', 'NY') AND cc_company IN ('6', '1', '2', '3') AND i_category_id BETWEEN 1 AND 100 AND (wr_returned_date_sk BETWEEN 2452602 AND 2452606 OR cr_returned_date_sk BETWEEN 2452602 AND 2452606) GROUP BY ROLLUP (ca_state, i_category, cc_name) ORDER BY ca_state, i_category, cc_name;
SELECT i.i_category, i.i_brand, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, AVG(ss.ss_ext_discount_amt) AS average_discount_amount, SUM(ss.ss_net_paid) AS total_net_sales, SUM(ss.ss_net_paid_inc_tax) AS total_net_sales_including_tax, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(DISTINCT p.p_promo_sk) AS number_of_promotions FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE p.p_discount_active = 'Y' AND p.p_start_date_sk IS NOT NULL AND p.p_end_date_sk IS NOT NULL GROUP BY i.i_category, i.i_brand ORDER BY total_net_sales DESC, i.i_category, i.i_brand;
SELECT ws.ws_web_site_sk, ws_site.web_site_id, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS avg_sales_price, SUM(ws.ws_net_profit) AS total_net_profit, cc.cc_call_center_id, cc.cc_name, AVG(cc.cc_employees) AS avg_cc_employees, cd.cd_marital_status, COUNT(DISTINCT cd.cd_demo_sk) AS total_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, hd.hd_buy_potential, AVG(hd.hd_income_band_sk) AS avg_income_band FROM web_sales ws JOIN web_site ws_site ON ws.ws_web_site_sk = ws_site.web_site_sk JOIN call_center cc ON ws_site.web_mkt_id = cc.cc_mkt_id JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk WHERE ws.ws_sales_price > 0 AND ws.ws_sold_date_sk BETWEEN 2451569 AND 2452306 AND ws.ws_web_site_sk IN (4, 18, 20, 29, 27) AND cc.cc_call_center_sk IN (1, 4, 2) AND cd.cd_purchase_estimate > 5000 AND cd.cd_marital_status IN ('D', 'U', 'S', 'M', 'W') AND hd.hd_buy_potential IS NOT NULL GROUP BY ws.ws_web_site_sk, ws_site.web_site_id, cc.cc_call_center_id, cc.cc_name, cd.cd_marital_status, hd.hd_buy_potential ORDER BY total_net_profit DESC, avg_sales_price DESC LIMIT 100;
SELECT sm.sm_type, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_wholesale_cost) AS avg_wholesale_cost, AVG(ws.ws_sales_price) AS avg_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk WHERE w.w_zip = '35709' AND ws.ws_web_site_sk IN (30, 17, 4, 15, 14, 2) AND sm.sm_ship_mode_sk IN (4, 9, 13, 10, 8, 20) GROUP BY sm.sm_type ORDER BY total_net_profit DESC;
SELECT dd.d_year, dd.d_month_seq, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS count_unique_sales_transactions, SUM(sr.sr_return_quantity) AS total_quantity_returned, AVG(sr.sr_return_amt) AS avg_return_amount, COUNT(DISTINCT sr.sr_ticket_number) AS count_unique_return_transactions, SUM(p.p_cost) AS total_promotion_cost, COUNT(DISTINCT p.p_promo_sk) AS count_unique_promotions FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk LEFT JOIN store_returns sr ON ss.ss_item_sk = sr.sr_item_sk AND ss.ss_ticket_number = sr.sr_ticket_number LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE p.p_channel_catalog = 'N' AND dd.d_year = 2002 GROUP BY dd.d_year, dd.d_month_seq ORDER BY dd.d_year, dd.d_month_seq;
SELECT ca.ca_state AS customer_state, EXTRACT(YEAR FROM d_date) AS year_of_return, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, SUM(wr.wr_return_amt) AS total_return_amount, SUM(wr.wr_return_tax) AS total_tax, SUM(wr.wr_return_amt_inc_tax) AS total_amount_including_tax, SUM(wr.wr_return_ship_cost) AS total_shipping_cost, SUM(wr.wr_refunded_cash) AS total_refunded_cash, SUM(wr.wr_reversed_charge) AS total_reversed_charge, SUM(wr.wr_account_credit) AS total_account_credit, SUM(wr.wr_net_loss) AS total_net_loss FROM web_returns wr JOIN customer c ON wr.wr_returning_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN date_dim d ON wr.wr_returned_date_sk = d.d_date_sk WHERE d.d_year >= 2003 GROUP BY ca.ca_state, year_of_return ORDER BY ca.ca_state, year_of_return;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, hd.hd_buy_potential, hd.hd_dep_count, AVG(wr.wr_return_amt) AS avg_return_amount, AVG(wr.wr_return_tax) AS avg_return_tax, AVG(wr.wr_net_loss) AS avg_net_loss, COUNT(*) AS return_count FROM web_returns wr JOIN household_demographics hd ON wr.wr_returning_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN warehouse w ON wr.wr_returning_addr_sk = w.w_warehouse_sk WHERE w.w_city = 'Fairview' AND w.w_country = 'United States' AND hd.hd_buy_potential IN ('501-1000', '5001-10000', '0-500', '1001-5000', '>10000') GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, hd.hd_buy_potential, hd.hd_dep_count ORDER BY ib.ib_income_band_sk, hd.hd_buy_potential, hd.hd_dep_count;
SELECT s.s_store_name, s.s_number_employees, AVG(ss.ss_sales_price) AS average_sale_amount, AVG(sr.sr_return_amt) AS average_return_amount, SUM(inv.inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions FROM store s LEFT JOIN store_sales ss ON s.s_store_sk = ss.ss_store_sk LEFT JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk AND ss.ss_item_sk = sr.sr_item_sk LEFT JOIN inventory inv ON ss.ss_item_sk = inv.inv_item_sk AND s.s_store_sk = inv.inv_warehouse_sk WHERE (ss.ss_sold_date_sk IS NOT NULL OR sr.sr_returned_date_sk IS NOT NULL) AND (ss.ss_item_sk IN (14547, 403, 14095, 8557) OR sr.sr_item_sk IN (14547, 403, 14095, 8557)) AND EXISTS ( SELECT 1 FROM household_demographics hd WHERE (ss.ss_hdemo_sk = hd.hd_demo_sk OR sr.sr_hdemo_sk = hd.hd_demo_sk) AND hd.hd_dep_count = 1 ) GROUP BY s.s_store_name, s.s_number_employees ORDER BY s.s_store_name;
SELECT i.i_category AS item_category, cc.cc_state AS call_center_state, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_sales_price) AS average_sales_price, AVG(ss.ss_ext_discount_amt) AS average_discount_amount FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN call_center cc ON cc.cc_call_center_sk = ss.ss_store_sk WHERE i.i_current_price BETWEEN 4.63 AND 18.31 AND ss.ss_sold_date_sk IS NOT NULL GROUP BY i.i_category, cc.cc_state ORDER BY total_sales DESC, item_category, call_center_state;
SELECT ib.ib_lower_bound, ib.ib_upper_bound, COUNT(hd.hd_demo_sk) AS household_count, AVG(hd.hd_dep_count) AS average_dependency_count, AVG(hd.hd_vehicle_count) AS average_vehicle_count, SUM(CASE WHEN p.p_channel_email = 'N' THEN p.p_cost ELSE 0 END) AS total_cost_non_email_promotions, SUM(CASE WHEN p.p_channel_tv = 'Y' THEN 1 ELSE 0 END) AS number_of_tv_promotions, SUM(CASE WHEN p.p_discount_active = 'Y' THEN p.p_response_target ELSE 0 END) AS total_target_with_active_discount, COUNT(DISTINCT CASE WHEN r.r_reason_desc = 'reason 27' THEN hd.hd_demo_sk ELSE NULL END) AS count_households_reason_27 FROM household_demographics hd LEFT JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk LEFT JOIN promotion p ON hd.hd_demo_sk = p.p_item_sk LEFT JOIN reason r ON p.p_promo_sk = r.r_reason_sk WHERE hd.hd_income_band_sk IN (15, 9, 18, 20) AND p.p_purpose <> 'Unknown' AND ib.ib_lower_bound IN (110001, 100001, 130001) AND ib.ib_upper_bound <> 70000 GROUP BY ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ib.ib_lower_bound, ib.ib_upper_bound;
SELECT sm.sm_type AS shipping_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_profit) AS total_net_profit, COUNT(DISTINCT p.p_promo_sk) AS distinct_promotions_used, SUM(CASE WHEN t.t_am_pm = 'AM' THEN cs.cs_quantity ELSE 0 END) AS total_quantity_am, SUM(CASE WHEN t.t_am_pm = 'PM' THEN cs.cs_quantity ELSE 0 END) AS total_quantity_pm FROM catalog_sales cs JOIN time_dim t ON cs.cs_sold_time_sk = t.t_time_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE cs.cs_sold_date_sk IS NOT NULL AND cs.cs_ship_date_sk IS NOT NULL AND sm.sm_contract IN ('uukTktPYycct8', 'GNJr3g5i7oorKqtX', 'hGoF18SLDDPBj', 'Ek', 'YvxVaJI10') AND p.p_cost = 1000.00 AND p.p_channel_catalog = 'N' GROUP BY sm.sm_type ORDER BY total_net_paid DESC;
