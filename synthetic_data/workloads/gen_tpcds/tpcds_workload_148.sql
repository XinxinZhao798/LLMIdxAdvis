SELECT c.c_preferred_cust_flag AS customer_pref_status, r.r_reason_desc AS return_reason, ws.web_manager AS website_manager, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN customer c ON cr.cr_refunded_customer_sk = c.c_customer_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN web_site ws ON cr.cr_call_center_sk = ws.web_site_sk WHERE c.c_current_addr_sk IN ('17516', '36852', '18429') AND ws.web_manager IN ('Jason Silva', 'Tommy Jones', 'Moses Hicks') AND r.r_reason_desc IN ('reason 23', 'Parts missing') GROUP BY customer_pref_status, return_reason, website_manager ORDER BY total_return_amount DESC, total_returns DESC;
SELECT site.web_name AS website_name, COUNT(DISTINCT ss.ss_ticket_number) AS store_sales_transactions, COUNT(DISTINCT ws.ws_order_number) AS web_sales_transactions, SUM(ss.ss_net_paid_inc_tax) AS total_store_sales, SUM(ws.ws_net_paid_inc_ship_tax) AS total_web_sales, AVG(ss.ss_quantity) AS avg_store_quantity_sold, AVG(ws.ws_quantity) AS avg_web_quantity_sold, cp.cp_department AS department, SUM(CASE WHEN ss.ss_hdemo_sk IN (1437, 496, 6460, 2527, 4508, 4026) THEN ss.ss_net_profit ELSE 0 END) AS store_profit_from_selected_hdemo, SUM(CASE WHEN ws.ws_web_site_sk IN (SELECT web_site_sk FROM web_site WHERE web_company_id IN (3, 5, 2)) THEN ws.ws_net_profit ELSE 0 END) AS web_profit_from_selected_companies FROM store_sales ss FULL OUTER JOIN web_sales ws ON ss.ss_item_sk = ws.ws_item_sk AND ss.ss_sold_date_sk = ws.ws_sold_date_sk LEFT JOIN catalog_page cp ON ws.ws_web_page_sk = cp.cp_catalog_page_sk LEFT JOIN web_site site ON ws.ws_web_site_sk = site.web_site_sk WHERE (cp.cp_catalog_page_sk IN (10, 2795, 1844, 4860) OR cp.cp_catalog_page_sk IS NULL) GROUP BY site.web_name, cp.cp_department ORDER BY total_store_sales DESC, total_web_sales DESC;
SELECT s.s_store_name, s.s_division_name, c.cc_name, c.cc_manager, hd.hd_buy_potential, COUNT(sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, AVG(sr.sr_return_quantity) AS avg_return_quantity, SUM(wr.wr_return_amt_inc_tax) AS total_web_return_amount_inc_tax, AVG(wr.wr_return_quantity) AS avg_web_return_quantity, COUNT(DISTINCT cu.c_customer_sk) AS unique_customers_returning, SUM(hd.hd_dep_count) AS total_dependents, AVG(hd.hd_vehicle_count) AS avg_vehicles_per_household FROM store s JOIN store_returns sr ON sr.sr_store_sk = s.s_store_sk JOIN call_center c ON c.cc_mkt_id = s.s_market_id JOIN customer cu ON cu.c_customer_sk = sr.sr_customer_sk JOIN household_demographics hd ON cu.c_current_hdemo_sk = hd.hd_demo_sk JOIN web_returns wr ON wr.wr_returning_customer_sk = cu.c_customer_sk WHERE c.cc_manager IN ('Bob Belcher', 'Felipe Perkins', 'Larry Mccray', 'Mark Hightower') AND hd.hd_buy_potential IN ('501-1000', '>10000', 'Unknown') AND s.s_division_name = 'Unknown' AND wr.wr_returning_hdemo_sk IN (2871, 6633, 6615, 4553) GROUP BY s.s_store_name, s.s_division_name, c.cc_name, c.cc_manager, hd.hd_buy_potential ORDER BY total_return_amount_inc_tax DESC, total_web_return_amount_inc_tax DESC LIMIT 100;
SELECT ca.ca_city, ca.ca_state, i.i_category, COUNT(DISTINCT c.c_customer_sk) AS number_of_customers, AVG(i.i_current_price) AS average_item_price, SUM(i.i_wholesale_cost) AS total_wholesale_cost, COUNT(i.i_item_sk) AS items_sold, SUM(CASE WHEN c.c_birth_year = 1928 THEN 1 ELSE 0 END) AS customers_born_1928, SUM(CASE WHEN c.c_birth_year = 1948 THEN 1 ELSE 0 END) AS customers_born_1948, SUM(CASE WHEN c.c_birth_country = 'HUNGARY' THEN 1 ELSE 0 END) AS customers_from_hungary, SUM(CASE WHEN c.c_birth_country = 'GUERNSEY' THEN 1 ELSE 0 END) AS customers_from_guernsey, COUNT(DISTINCT CASE WHEN ca.ca_location_type = 'single family' THEN c.c_customer_sk END) AS single_family_homes, COUNT(DISTINCT CASE WHEN ca.ca_location_type = 'apartment' THEN c.c_customer_sk END) AS apartments, COUNT(DISTINCT CASE WHEN ca.ca_location_type = 'condo' THEN c.c_customer_sk END) AS condos FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN item i ON c.c_customer_sk = i.i_manager_id WHERE i.i_size IN ('economy', 'large', 'petite') AND i.i_product_name IN ('barbarbarought', 'esecallyesepri') AND ca.ca_city IN ('Watkins', 'Sawyer', 'Ruth', 'Sheffield') GROUP BY ca.ca_city, ca.ca_state, i.i_category ORDER BY ca.ca_state, ca.ca_city, i.i_category;
SELECT p.p_promo_name AS promotion_name, ib.ib_lower_bound AS income_band_lower_bound, ib.ib_upper_bound AS income_band_upper_bound, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_ext_sales_price) AS total_sales, SUM(ss.ss_ext_discount_amt) AS total_discount_amount, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_customer_sk) AS distinct_customers, SUM(CASE WHEN ss.ss_sales_price < ss.ss_list_price THEN 1 ELSE 0 END) AS count_discounted_sales FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN income_band ib ON ss.ss_cdemo_sk = ib.ib_income_band_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE p.p_discount_active = 'N' AND d.d_year IN (1901, 1903, 1906, 1908) AND ss.ss_ext_sales_price IN (2209.06, 2248.08) AND ib.ib_lower_bound IN (0, 90001, 170001, 120001, 50001) AND ib.ib_upper_bound = 160000 GROUP BY p.p_promo_name, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_sales DESC, promotion_name, income_band_lower_bound, income_band_upper_bound;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, COUNT(c.c_customer_sk) AS num_customers, SUM(CASE WHEN p.p_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS num_promotions_used, AVG(hd.hd_vehicle_count) AS avg_vehicles_per_household, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses_involved FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk LEFT JOIN promotion p ON p.p_start_date_sk <= c.c_first_sales_date_sk AND p.p_end_date_sk >= c.c_first_sales_date_sk JOIN warehouse w ON w.w_state = cd.cd_credit_rating WHERE cd.cd_purchase_estimate > 500 AND hd.hd_buy_potential IN ('5001-10000', '>10000') AND p.p_discount_active = 'Y' GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating ORDER BY avg_purchase_estimate DESC, num_customers DESC LIMIT 100;
SELECT s.s_store_name, s.s_city, s.s_state, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_quantity) AS average_quantity_sold, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_ext_sales_price) AS total_sales, sm.sm_carrier, sm.sm_type, COUNT(DISTINCT ws.ws_item_sk) AS total_items_sold, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT ws.ws_bill_customer_sk) AS total_customers, cp.cp_department, cp.cp_catalog_number, COUNT(DISTINCT cp.cp_catalog_page_sk) AS total_catalog_pages FROM store s JOIN web_sales ws ON s.s_store_sk = ws.ws_warehouse_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN income_band ib ON ws.ws_bill_cdemo_sk = ib.ib_income_band_sk JOIN catalog_page cp ON ws.ws_web_page_sk = cp.cp_catalog_page_sk JOIN web_site w ON ws.ws_web_site_sk = w.web_site_sk WHERE s.s_company_id = '1' AND s.s_county = 'Williamson County' AND ws.ws_ship_addr_sk IN ('9319', '42828', '27709') AND ws.ws_net_profit IN ('1416.80', '918.75', '-485.10') AND sm.sm_carrier IN ('ZOUROS', 'HARMSTORF', 'GERMA') AND sm.sm_ship_mode_sk IN ('11', '3', '9') AND sm.sm_code IN ('BIKE', 'SURFACE', 'AIR') AND w.web_rec_start_date IN ('1999-08-17', '2001-08-16', '2000-08-16') AND w.web_suite_number IN ('Suite 130', 'Suite 150', 'Suite R') AND w.web_tax_percentage IN ('0.01', '0.10', '0.12') AND w.web_company_name IN ('able', 'cally', 'pri') AND ib.ib_upper_bound IN ('110000', '190000', '130000') AND ib.ib_income_band_sk IN ('8', '15', '6') AND ib.ib_lower_bound IN ('20001', '100001', '10001') AND cp.cp_catalog_number IN ('10', '44', '19') AND cp.cp_department = 'DEPARTMENT' AND cp.cp_catalog_page_number IN ('49', '102', '25') AND cp.cp_catalog_page_sk IN ('3484', '375', '1590') GROUP BY s.s_store_name, s.s_city, s.s_state, sm.sm_carrier, sm.sm_type, ib.ib_lower_bound, ib.ib_upper_bound, cp.cp_department, cp.cp_catalog_number ORDER BY total_net_profit DESC, total_sales DESC, total_orders DESC;
SELECT cp.cp_department, dd.d_year, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount, AVG(cr.cr_return_quantity) AS avg_return_quantity, COUNT(cr.cr_order_number) AS total_returned_orders FROM catalog_returns cr JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN date_dim dd ON cr.cr_returned_date_sk = dd.d_date_sk JOIN household_demographics hd ON cr.cr_returning_cdemo_sk = hd.hd_demo_sk WHERE cp.cp_type = 'monthly' AND hd.hd_buy_potential = 'Unknown' GROUP BY cp.cp_department, dd.d_year ORDER BY total_return_amount DESC, cp.cp_department, dd.d_year;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_country, ca.ca_state, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(DISTINCT web.web_site_sk) AS distinct_websites, COUNT(DISTINCT wp.wp_web_page_sk) AS distinct_web_pages FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk JOIN web_page wp ON wp.wp_customer_sk = ss.ss_customer_sk JOIN web_site web ON web.web_company_id = wp.wp_web_page_sk WHERE dd.d_year = 1998 AND ca.ca_country = 'United States' AND ca.ca_state IN ('NY', 'CA', 'TX') AND web.web_company_id IN ('6', '3', '5') AND wp.wp_autogen_flag = 'N' GROUP BY ROLLUP (dd.d_year, dd.d_quarter_name, ca.ca_country, ca.ca_state) ORDER BY dd.d_year, dd.d_quarter_name, ca.ca_country, ca.ca_state;
SELECT cp.cp_department, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_incl_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_net_loss) AS total_net_loss, SUM(p.p_cost) AS total_promotion_cost, COUNT(DISTINCT p.p_promo_sk) AS total_promotions_applied FROM catalog_page cp JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk LEFT JOIN promotion p ON cp.cp_catalog_page_sk = p.p_item_sk WHERE cp.cp_catalog_page_number IN (63, 55, 67, 26) GROUP BY cp.cp_department ORDER BY total_net_loss DESC;
SELECT w_state, w_city, i_category, i_class, i_brand, AVG(i_current_price) AS avg_price, SUM(inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT i_item_sk) AS unique_items_count, MAX(i_current_price) AS max_price, MIN(i_current_price) AS min_price, COUNT(DISTINCT hd_demo_sk) AS unique_households, AVG(hd_dep_count) AS avg_dependency_count FROM warehouse w JOIN inventory inv ON w.w_warehouse_sk = inv.inv_warehouse_sk JOIN item i ON inv.inv_item_sk = i.i_item_sk LEFT JOIN household_demographics hd ON hd.hd_income_band_sk = i.i_brand_id WHERE w.w_zip = '35709' AND w.w_state = 'TN' AND w.w_street_type IN ('Dr.', 'Drive', 'Parkway') AND w.w_city = 'Fairview' AND inv.inv_date_sk = 2450815 AND inv.inv_quantity_on_hand IN (396, 595, 454) AND inv.inv_warehouse_sk IN (2, 1) AND i.i_container = 'Unknown' AND i.i_item_sk IN (4699, 4967, 949) AND hd.hd_dep_count IN (4, 1, 6) AND hd.hd_income_band_sk IN (9, 18, 10) GROUP BY w_state, w_city, i_category, i_class, i_brand ORDER BY total_inventory DESC, avg_price DESC;
SELECT w.w_warehouse_name, i.ib_lower_bound, i.ib_upper_bound, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(wr.wr_return_quantity) AS total_return_quantity, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_fee) AS total_return_fees, COUNT(DISTINCT wr.wr_order_number) AS total_return_transactions FROM warehouse w JOIN store_sales ss ON ss.ss_addr_sk = w.w_warehouse_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN income_band i ON hd.hd_income_band_sk = i.ib_income_band_sk LEFT JOIN web_returns wr ON wr.wr_item_sk = ss.ss_item_sk AND wr.wr_refunded_customer_sk = ss.ss_customer_sk WHERE w.w_county = 'Williamson County' AND ss.ss_sold_time_sk = 35623 AND i.ib_income_band_sk IN (SELECT hd_income_band_sk FROM household_demographics WHERE hd_demo_sk IN (6765, 6298, 2035)) GROUP BY w.w_warehouse_name, i.ib_lower_bound, i.ib_upper_bound ORDER BY w.w_warehouse_name, i.ib_lower_bound;
SELECT d_year, cd_gender, cd_marital_status, cd_education_status, ib_lower_bound, ib_upper_bound, COUNT(DISTINCT c_customer_sk) AS num_customers, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_net_profit) AS total_net_profit, SUM(wr_return_quantity) AS total_quantity_returned, AVG(wr_return_amt) AS avg_return_amount, SUM(inv_quantity_on_hand) AS total_inventory_quantity FROM date_dim JOIN catalog_sales ON (date_dim.d_date_sk = catalog_sales.cs_sold_date_sk) JOIN customer ON (catalog_sales.cs_bill_customer_sk = customer.c_customer_sk) JOIN customer_demographics ON (customer.c_current_cdemo_sk = customer_demographics.cd_demo_sk) JOIN income_band ON (customer_demographics.cd_purchase_estimate BETWEEN income_band.ib_lower_bound AND income_band.ib_upper_bound) LEFT JOIN web_returns ON (catalog_sales.cs_item_sk = web_returns.wr_item_sk AND catalog_sales.cs_order_number = web_returns.wr_order_number) LEFT JOIN inventory ON (catalog_sales.cs_item_sk = inventory.inv_item_sk AND date_dim.d_date_sk = inventory.inv_date_sk) WHERE cd_gender IN ('M', 'F') AND cd_marital_status IN ('M', 'U') AND cd_education_status IN ('4 yr Degree', '2 yr Degree') AND d_year IN (2001, 2002, 2003) AND d_moy BETWEEN 1 AND 6 AND ib_income_band_sk IN (1, 2, 3) AND d_current_year = 'N' GROUP BY d_year, cd_gender, cd_marital_status, cd_education_status, ib_lower_bound, ib_upper_bound ORDER BY d_year, cd_gender, cd_marital_status, cd_education_status, ib_lower_bound, ib_upper_bound;
SELECT c.c_customer_id, hd.hd_buy_potential, COUNT(*) AS number_of_customers, AVG(hd.hd_vehicle_count) AS average_vehicle_count, SUM(hd.hd_dep_count) AS total_dependents, sm.sm_type AS shipping_type, COUNT(DISTINCT sm.sm_carrier) AS number_of_unique_carriers FROM customer c JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN ship_mode sm ON sm.sm_code = c.c_login WHERE c.c_birth_year > 1980 AND c.c_preferred_cust_flag = 'Y' AND sm.sm_code IN ('BIKE', 'SURFACE', 'SEA') GROUP BY c.c_customer_id, hd.hd_buy_potential, sm.sm_type HAVING COUNT(*) > 1 ORDER BY number_of_customers DESC, average_vehicle_count DESC LIMIT 100;
