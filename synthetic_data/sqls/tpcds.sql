SELECT s.s_store_name, s.s_city, s.s_state, s_market_desc, AVG(s.s_number_employees) AS average_employees, AVG(s.s_floor_space) AS average_floor_space, COUNT(DISTINCT s.s_store_sk) AS total_stores, SUM(wp.wp_char_count) AS total_char_count, SUM(wp.wp_link_count) AS total_link_count, SUM(wp.wp_image_count) AS total_image_count, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages, AVG(ib.ib_upper_bound - ib.ib_lower_bound) AS average_income_band_range FROM store s JOIN web_page wp ON s.s_store_sk = wp.wp_customer_sk LEFT JOIN income_band ib ON s.s_market_id = ib.ib_income_band_sk WHERE s.s_rec_start_date <= CURRENT_DATE AND (s.s_rec_end_date IS NULL OR s.s_rec_end_date > CURRENT_DATE) AND (wp.wp_web_page_sk = 33 OR wp.wp_web_page_sk = 6) GROUP BY s.s_store_name, s.s_city, s.s_state, s_market_desc ORDER BY s.s_state, s.s_city, s.s_store_name;
SELECT cr_returned_date_sk AS return_date, SUM(cr_return_quantity) AS total_catalog_return_quantity, SUM(cr_return_amount) AS total_catalog_return_amount, AVG(cr_return_amount) AS avg_catalog_return_amount, COUNT(DISTINCT cr_refunded_customer_sk) AS unique_catalog_customers, SUM(sr_return_quantity) AS total_store_return_quantity, SUM(sr_return_amt) AS total_store_return_amount, AVG(sr_return_amt) AS avg_store_return_amount, COUNT(DISTINCT sr_customer_sk) AS unique_store_customers, SUM(wr_return_quantity) AS total_web_return_quantity, SUM(wr_return_amt) AS total_web_return_amount, AVG(wr_return_amt) AS avg_web_return_amount, COUNT(DISTINCT wr_returning_customer_sk) AS unique_web_customers FROM catalog_returns JOIN store_returns ON cr_item_sk = sr_item_sk AND cr_order_number = sr_ticket_number JOIN web_returns ON cr_item_sk = wr_item_sk AND cr_order_number = wr_order_number WHERE cr_returned_date_sk IS NOT NULL AND sr_returned_date_sk IS NOT NULL AND wr_returned_date_sk IS NOT NULL GROUP BY cr_returned_date_sk ORDER BY cr_returned_date_sk;
SELECT ca.ca_state, COUNT(DISTINCT r.r_reason_sk) AS total_reasons_for_return, AVG(hd.hd_income_band_sk) AS avg_income_band, AVG(hd.hd_dep_count) AS avg_dependants FROM reason r JOIN customer_address ca ON ca.ca_address_sk = r.r_reason_sk JOIN household_demographics hd ON hd.hd_demo_sk = ca.ca_address_sk JOIN time_dim t ON t.t_time_sk = ca.ca_address_sk WHERE r.r_reason_desc IN ('Wrong size', 'Did not get it on time', 'unauthoized purchase', 'Did not like the make', 'No service location in my area') AND hd.hd_buy_potential = 'Y' AND t.t_shift = 'Evening' GROUP BY ca.ca_state ORDER BY total_reasons_for_return DESC, avg_income_band DESC, avg_dependants DESC;
SELECT COUNT(DISTINCT cr.cr_item_sk) AS total_returned_items, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(ss.ss_quantity) AS total_sold_quantity, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ws.ws_quantity) AS total_web_sold_quantity, AVG(ws.ws_sales_price) AS average_web_sales_price FROM catalog_returns cr JOIN store_sales ss ON cr.cr_item_sk = ss.ss_item_sk JOIN web_sales ws ON cr.cr_item_sk = ws.ws_item_sk WHERE cr.cr_returned_date_sk IN (2450960, 2450989, 2451134, 2450922, 2451018) AND ws.ws_ext_discount_amt IN (415.26, 663.25) GROUP BY cr.cr_returned_date_sk;
SELECT cc.cc_name, cc.cc_city, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(ss.ss_net_profit) AS total_net_profit FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN reason r ON r.r_reason_sk = ss.ss_promo_sk WHERE cc.cc_gmt_offset = '-5.00' AND cc.cc_rec_start_date BETWEEN '2001-01-01' AND '2002-01-01' AND ss.ss_quantity IN (65, 96, 9, 80, 52, 68) AND r.r_reason_id = 'AAAAAAAAGBAAAAAA' GROUP BY cc.cc_name, cc.cc_city ORDER BY total_net_profit DESC, total_quantity_sold DESC;
SELECT s.s_store_name, s.s_city, s.s_state, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(sr.sr_net_loss) AS total_net_loss, cd.cd_gender, cd.cd_education_status, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_page_visits, ib.ib_lower_bound, ib.ib_upper_bound FROM store_returns sr JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN web_page wp ON wp.wp_customer_sk = sr.sr_customer_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound WHERE s.s_street_type IN ('Dr.', 'Lane', 'Wy') AND s.s_market_desc IN ('Mysterious employe', 'Architects coul', 'Little expectations include yet forward meetings.') AND s.s_city IN ('Fairview', 'Midway') AND s.s_street_number IN ('337', '767', '175') AND sr.sr_reversed_charge IN ('17.91', '2.40', '5.43') AND sr.sr_return_time_sk IN ('55806', '33650', '38681') AND sr.sr_net_loss IN ('386.38', '1608.66', '1058.95') AND sr.sr_reason_sk IN ('1', '3', '23') AND cd.cd_gender IN ('F', 'M') AND cd.cd_purchase_estimate IN ('9000', '5500', '4000') AND wp.wp_web_page_id IN ('AAAAAAAAKDAAAAAA', 'AAAAAAAAACAAAAAA', 'AAAAAAAAMBAAAAAA') AND wp.wp_url = 'http://www.foo.com' AND wp.wp_autogen_flag IN ('N', 'Y') AND ib.ib_income_band_sk IN ('18', '7', '2') GROUP BY s.s_store_name, s.s_city, s.s_state, cd.cd_gender, cd.cd_education_status, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_net_loss DESC, total_returns DESC, s.s_store_name, cd.cd_gender;
SELECT td.t_shift, sum(ws.ws_quantity) AS total_quantity_sold, avg(ws.ws_sales_price) AS average_sales_price, count(distinct ws.ws_order_number) AS total_orders, count(distinct hd.hd_demo_sk) AS unique_customers, sum(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk WHERE ws.ws_sold_date_sk IS NOT NULL AND ws.ws_warehouse_sk IN (1, 2) AND hd.hd_demo_sk IN (821, 42, 4135, 4677, 808) GROUP BY ROLLUP(td.t_shift) ORDER BY total_net_profit DESC, td.t_shift;
SELECT ca.ca_state, EXTRACT(YEAR FROM cc.cc_rec_start_date) AS year_started, COUNT(DISTINCT cc.cc_call_center_sk) AS num_call_centers, AVG(cc.cc_employees) AS avg_employees, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_with_tax, SUM(ws.ws_net_paid_inc_ship_tax) AS total_web_sales_amount_with_ship_tax, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, COUNT(DISTINCT r.r_reason_sk) AS num_unique_reasons FROM call_center cc JOIN store_returns sr ON sr.sr_store_sk = cc.cc_call_center_sk JOIN web_sales ws ON ws.ws_warehouse_sk = cc.cc_call_center_sk JOIN customer_address ca ON ca.ca_address_sk = sr.sr_addr_sk JOIN household_demographics hd ON hd.hd_demo_sk = sr.sr_hdemo_sk JOIN reason r ON r.r_reason_sk = sr.sr_reason_sk JOIN warehouse w ON w.w_warehouse_sk = ws.ws_warehouse_sk WHERE (w.w_warehouse_sq_ft = 621234 OR w.w_warehouse_sq_ft = 294242 OR w.w_warehouse_sq_ft = 977787 OR w.w_warehouse_sq_ft = 138504) AND (w.w_warehouse_sk = 2 OR w.w_warehouse_sk = 1) AND (ws.ws_ext_tax = 127.26 OR ws.ws_ext_tax = 30.44) AND hd.hd_vehicle_count = 3 AND (r.r_reason_sk = 25 OR r.r_reason_sk = 20 OR r.r_reason_sk = 4) GROUP BY ca.ca_state, year_started ORDER BY total_return_amount_with_tax DESC, total_web_sales_amount_with_ship_tax DESC;
SELECT i.i_item_id, i.i_category, w.w_state, w.w_city, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amt_inc_tax) AS avg_return_amount_incl_tax, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_incl_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_return_ship_cost) AS total_shipping_cost, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk GROUP BY ROLLUP (i.i_item_id, i.i_category, w.w_state, w.w_city) ORDER BY w.w_state, w.w_city, i.i_category, i.i_item_id;
SELECT dd.d_year, dd.d_moy, SUM(inv.inv_quantity_on_hand) AS total_quantity, AVG(inv.inv_quantity_on_hand) AS avg_quantity, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, COUNT(DISTINCT w.w_warehouse_sk) AS warehouses_involved, SUM(CASE WHEN p.p_channel_email = 'Y' THEN p.p_cost ELSE 0 END) AS total_promo_cost_email, SUM(CASE WHEN p.p_channel_tv = 'Y' THEN p.p_cost ELSE 0 END) AS total_promo_cost_tv, COUNT(DISTINCT CASE WHEN p.p_discount_active = 'Y' THEN p.p_promo_sk ELSE NULL END) AS active_discount_promos FROM inventory inv JOIN date_dim dd ON inv.inv_date_sk = dd.d_date_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN customer c ON dd.d_date_sk = c.c_first_sales_date_sk OR dd.d_date_sk = c.c_first_shipto_date_sk LEFT JOIN promotion p ON dd.d_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk WHERE dd.d_year = 1998 AND p.p_channel_event = 'N' AND dd.d_first_dom IN ('2416847', '2417850', '2417728', '2418946') AND inv.inv_warehouse_sk IN ('1', '2') AND c.c_birth_month IN ('3', '5', '6', '10', '4') GROUP BY dd.d_year, dd.d_moy ORDER BY dd.d_year, dd.d_moy;
SELECT d.d_year AS year, d.d_moy AS month, SUM(s.sr_return_amt_inc_tax) AS total_returns_amount, AVG(s.sr_return_amt_inc_tax) AS avg_returns_amount, COUNT(s.sr_ticket_number) AS return_count, SUM(i.inv_quantity_on_hand) AS total_inventory_quantity, AVG(i.inv_quantity_on_hand) AS avg_inventory_quantity FROM date_dim d LEFT JOIN store_returns s ON d.d_date_sk = s.sr_returned_date_sk LEFT JOIN inventory i ON d.d_date_sk = i.inv_date_sk WHERE d.d_year = 2023 GROUP BY d.d_year, d.d_moy ORDER BY d.d_year, d.d_moy;
SELECT i_category, i_class, w_warehouse_name, w_city, w_state, EXTRACT(YEAR FROM i_rec_start_date) AS year_introduced, SUM(cs_sales_price) AS total_sales, AVG(cs_sales_price) AS avg_sales_price, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(inv_quantity_on_hand) AS total_inventory FROM item JOIN catalog_sales ON cs_item_sk = i_item_sk JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk JOIN inventory ON inv_item_sk = i_item_sk AND inv_warehouse_sk = w_warehouse_sk JOIN time_dim ON cs_sold_time_sk = t_time_sk WHERE w_warehouse_name = 'Central' AND t_shift = 'third' AND cs_ship_mode_sk IN ('12', '20', '5') AND t_time IN ('1847', '2034', '2419', '4815', '2779') AND i_rec_start_date >= '2000-01-01' GROUP BY i_category, i_class, w_warehouse_name, w_city, w_state, year_introduced ORDER BY total_sales DESC, total_orders DESC LIMIT 100;
SELECT w_state, AVG(w_warehouse_sq_ft) AS avg_warehouse_sq_ft, SUM(inv_quantity_on_hand) AS total_inventory_on_hand, AVG(sr_return_amt) AS avg_return_amt, SUM(sr_net_loss) AS total_net_loss FROM warehouse w JOIN inventory i ON w.w_warehouse_sk = i.inv_warehouse_sk JOIN store_returns sr ON i.inv_item_sk = sr.sr_item_sk GROUP BY w_state ORDER BY w_state;
SELECT d_year, d_quarter_name, sm_type, ca_state, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, SUM(cs_net_paid) AS total_net_paid, AVG(cs_net_paid_inc_tax) AS avg_net_paid_inc_tax, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN date_dim ON (cs_sold_date_sk = d_date_sk) JOIN ship_mode ON (cs_ship_mode_sk = sm_ship_mode_sk) JOIN customer_address ON (cs_ship_addr_sk = ca_address_sk) JOIN promotion ON (cs_promo_sk = p_promo_sk) JOIN catalog_page ON (cs_catalog_page_sk = cp_catalog_page_sk) WHERE ca_state IN ('CA', 'TN') AND sm_type IN ('NEXT DAY', 'TWO DAY', 'LIBRARY') AND d_year = 2023 AND p_channel_event = 'N' AND cp_department = 'DEPARTMENT' GROUP BY d_year, d_quarter_name, sm_type, ca_state ORDER BY d_year, d_quarter_name, sm_type, ca_state;
SELECT s.s_store_name, SUM(inv.inv_quantity_on_hand) AS Total_Inventory, AVG(inv.inv_quantity_on_hand) AS Average_Inventory, COUNT(DISTINCT inv.inv_item_sk) AS Unique_Items, COUNT(DISTINCT ca.ca_address_sk) AS Number_of_Customers, SUM(CASE WHEN cd.cd_credit_rating = 'High Risk' THEN cd.cd_purchase_estimate ELSE 0 END) AS High_Risk_Estimated_Purchases, AVG(cd.cd_purchase_estimate) AS Avg_Customer_Purchase_Estimate, SUM(cd.cd_dep_count) AS Total_Dependents, COUNT(DISTINCT sm.sm_ship_mode_sk) AS Shipping_Modes_Used FROM store s JOIN inventory inv ON s.s_store_sk = inv.inv_warehouse_sk JOIN customer_address ca ON ca.ca_city = s.s_city AND ca.ca_state = s.s_state JOIN customer_demographics cd ON ca.ca_address_sk = cd.cd_demo_sk JOIN ship_mode sm ON sm.sm_type = 'AIR' WHERE s.s_market_desc = 'Mysterious employe' AND inv.inv_quantity_on_hand IN (794, 3, 631, 744, 849) AND inv.inv_item_sk IN (10984, 6848, 7628) GROUP BY s.s_store_name ORDER BY Total_Inventory DESC, Number_of_Customers DESC LIMIT 100;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, SUM(cr.cr_return_quantity) AS total_catalog_return_quantity, AVG(cr.cr_return_amount) AS avg_catalog_return_amount, COUNT(DISTINCT cr.cr_order_number) AS num_catalog_orders_returned, SUM(sr.sr_return_quantity) AS total_store_return_quantity, AVG(sr.sr_return_amt) AS avg_store_return_amount, COUNT(DISTINCT sr.sr_ticket_number) AS num_store_tickets_returned, (SUM(cr.cr_return_quantity) + SUM(sr.sr_return_quantity)) AS total_combined_return_quantity, (SUM(cr.cr_return_amount) + SUM(sr.sr_return_amt)) AS total_combined_return_amount FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk LEFT JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_refunded_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk WHERE cd.cd_dep_college_count = 0 AND (cd.cd_dep_count = 1 OR cd.cd_dep_count = 2) AND (c.c_birth_month IN (1, 5, 8)) AND (cr.cr_refunded_cdemo_sk IN (720990, 944590, 673975, 63720) OR cr.cr_refunded_cdemo_sk IS NULL) AND (sr.sr_ticket_number::text IN ('40123', '36273') OR sr.sr_ticket_number IS NULL) GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY total_combined_return_amount DESC, c.c_customer_id;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(DISTINCT sr.sr_ticket_number) AS num_returns, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_net_loss) AS average_net_loss, COUNT(DISTINCT ss.ss_ticket_number) AS num_sales, SUM(ss.ss_sales_price) AS total_sales_amount, AVG(ss.ss_quantity) AS average_quantity_sold, SUM(ws.ws_net_paid_inc_tax) AS total_web_net_paid_inc_tax, ws.ws_web_site_sk AS website_id FROM customer_demographics cd LEFT JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk LEFT JOIN store_sales ss ON cd.cd_demo_sk = ss.ss_cdemo_sk LEFT JOIN web_sales ws ON cd.cd_demo_sk = ws.ws_bill_cdemo_sk OR cd.cd_demo_sk = ws.ws_ship_cdemo_sk WHERE cd.cd_dep_count IN ('1', '2') AND cd.cd_marital_status IN ('D', 'S', 'W') AND (sr.sr_return_amt = '225.00' OR sr.sr_return_amt = '3027.92') AND (sr.sr_net_loss = '440.72' OR sr.sr_net_loss = '800.95') AND ss.ss_promo_sk IS NOT NULL AND ws.ws_web_site_sk IS NOT NULL GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, ws.ws_web_site_sk ORDER BY total_return_amount DESC;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(cc.cc_employees) AS total_employees, AVG(cc.cc_sq_ft) AS average_square_footage, COUNT(DISTINCT c.c_customer_sk) AS number_of_customers, COUNT(DISTINCT p.p_promo_sk) AS number_of_promotions, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS preferred_customers_count, AVG(CASE WHEN p.p_discount_active = 'Y' THEN p.p_cost ELSE NULL END) AS average_active_discount_cost, MAX(ib.ib_upper_bound) AS max_income_band_upper_bound FROM call_center cc JOIN customer c ON (cc.cc_call_center_sk = c.c_current_addr_sk) JOIN promotion p ON (cc.cc_mkt_id = p.p_item_sk) LEFT JOIN income_band ib ON (c.c_current_hdemo_sk = ib.ib_income_band_sk) WHERE cc.cc_mkt_class IN ('Silly particles could pro', 'Dealers make most historical, direct students') AND cc.cc_mkt_id IN ('6', '2', '5') AND p.p_channel_email = 'N' GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY number_of_customers DESC, total_employees DESC;
SELECT i.i_category, cc.cc_mkt_class, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_wholesale_cost) AS avg_wholesale_cost FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk WHERE cc.cc_name IN ('North Midwest', 'Mid Atlantic') AND i.i_class_id IN (3, 5, 12, 10) AND i.i_rec_start_date = '2001-10-27' GROUP BY i.i_category, cc.cc_mkt_class ORDER BY i.i_category, cc.cc_mkt_class;
SELECT cd.cd_education_status, d.d_year, SUM(ss_ext_sales_price) AS total_sales, AVG(ss_ext_sales_price) AS avg_sales_amount, COUNT(cr.cr_order_number) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount FROM customer_demographics cd JOIN store_sales ss ON cd.cd_demo_sk = ss.ss_cdemo_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk LEFT JOIN catalog_returns cr ON ss.ss_ticket_number = cr.cr_order_number WHERE d.d_year IN (1998, 1999, 2000) GROUP BY cd.cd_education_status, d.d_year ORDER BY cd.cd_education_status, d.d_year;
SELECT dd.d_year, dd.d_quarter_name, i.i_category, i.i_brand, s.s_store_name, s.s_state, s.s_country, COUNT(distinct ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, SUM(ws.ws_ext_sales_price) AS total_sales, AVG(ws.ws_sales_price) AS avg_sales_price, SUM(ws.ws_net_paid) AS net_paid, SUM(ws.ws_net_paid_inc_tax) AS net_paid_inc_tax, SUM(ws.ws_net_profit) AS net_profit FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN store s ON s.s_store_sk = ws.ws_bill_customer_sk WHERE s.s_country = 'United States' AND dd.d_year = 2001 AND i.i_category IN ('Shoes', 'Sports') AND i.i_rec_start_date BETWEEN '2000-01-01' AND '2001-12-31' AND s.s_tax_precentage IN ('0.06', '0.01', '0.11', '0.03', '0.08') GROUP BY dd.d_year, dd.d_quarter_name, i.i_category, i.i_brand, s.s_store_name, s.s_state, s.s_country ORDER BY total_sales DESC, net_profit DESC;
SELECT c.cp_department, i.i_category, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_fee) AS total_fees_collected, SUM(cr.cr_net_loss) AS total_net_loss, w.w_state, hd.hd_buy_potential FROM catalog_returns cr JOIN catalog_page c ON cr.cr_catalog_page_sk = c.cp_catalog_page_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk WHERE cr.cr_returning_addr_sk IN ('31623', '47914', '49311', '38890', '49597') AND w.w_state = 'TN' AND hd.hd_buy_potential IN ('501-1000', '5001-10000') GROUP BY c.cp_department, i.i_category, w.w_state, hd.hd_buy_potential ORDER BY total_return_amount DESC, c.cp_department, i.i_category;
SELECT i_category, d_year, d_quarter_name, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(sr_return_quantity) AS total_quantity_returned, SUM(sr_return_amt) AS total_return_amount, SUM(ws_net_paid_inc_ship_tax) AS total_web_sales_inc_ship_tax, AVG(ws_quantity) AS average_web_sales_quantity, COUNT(DISTINCT ws_bill_customer_sk) AS unique_web_customers FROM item JOIN store_sales ON ss_item_sk = i_item_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN store_returns ON sr_item_sk = ss_item_sk AND sr_returned_date_sk = ss_sold_date_sk JOIN web_sales ON ws_item_sk = ss_item_sk AND ws_sold_date_sk = ss_sold_date_sk WHERE d_year = 2022 AND i_category IN ('Electronics', 'Clothing', 'Home Goods') AND ss_list_price BETWEEN 50 AND 150 AND ws_net_paid_inc_tax > 100 GROUP BY i_category, d_year, d_quarter_name ORDER BY total_quantity_sold DESC, total_web_sales_inc_ship_tax DESC LIMIT 100;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address, SUM(cr.cr_return_amount) AS total_catalog_returns, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_return_orders, AVG(cr.cr_return_quantity) AS avg_catalog_return_quantity, SUM(wr.wr_return_amt) AS total_web_returns, COUNT(DISTINCT wr.wr_order_number) AS total_web_return_orders, AVG(wr.wr_return_quantity) AS avg_web_return_quantity, SUM(ws.ws_sales_price) AS total_web_sales, AVG(ws.ws_quantity) AS avg_web_sales_quantity, COUNT(DISTINCT ws.ws_order_number) AS total_web_sales_orders, SUM(ws.ws_net_profit) AS total_web_net_profit FROM customer c LEFT JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_returning_customer_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk LEFT JOIN web_sales ws ON c.c_customer_sk = ws.ws_ship_customer_sk GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address ORDER BY total_web_net_profit DESC, total_catalog_returns DESC, total_web_returns DESC LIMIT 100;
SELECT c.c_customer_id AS customer_id, cd.cd_gender AS customer_gender, cd.cd_education_status AS customer_education_status, cd.cd_credit_rating AS customer_credit_rating, cd.cd_purchase_estimate AS estimated_purchase, SUM(cd.cd_dep_college_count) AS total_college_dependents, hd.hd_income_band_sk AS household_income_band, hd.hd_buy_potential AS household_buying_potential, COUNT(DISTINCT ws.web_site_id) AS number_of_websites_visited, AVG(ws.web_tax_percentage) AS average_tax_percentage FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN time_dim t ON c.c_first_shipto_date_sk = t.t_time_sk JOIN web_site ws ON c.c_current_addr_sk = ws.web_site_sk WHERE cd.cd_credit_rating = 'High' AND cd.cd_dep_college_count = 0 AND hd.hd_income_band_sk IN (10, 6, 17, 13, 15) AND hd.hd_buy_potential = '501-1000' AND t.t_sub_shift = 'night' AND t.t_minute IN (0, 30, 40) AND ws.web_gmt_offset = -5.00 AND ws.web_zip = '35709' GROUP BY c.c_customer_id, cd.cd_gender, cd.cd_education_status, cd.cd_credit_rating, cd.cd_purchase_estimate, hd.hd_income_band_sk, hd.hd_buy_potential ORDER BY estimated_purchase DESC, total_college_dependents DESC, household_income_band;
SELECT r.r_reason_desc, COUNT(sr.sr_ticket_number) AS return_count, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_return_amt_inc_tax) AS total_amount_incl_tax, SUM(sr.sr_fee) AS total_fees, AVG(wp.wp_link_count) AS average_link_count, AVG(wp.wp_image_count) AS average_image_count FROM store_returns sr JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk LEFT JOIN web_page wp ON c.c_customer_sk = wp.wp_customer_sk WHERE sr.sr_return_quantity > 1 AND c.c_birth_country IN ('YEMEN', 'POLAND', 'SWITZERLAND') AND wp.wp_image_count IN (2, 4, 5) GROUP BY r.r_reason_desc ORDER BY total_returned_quantity DESC, average_return_amount DESC;
SELECT d_year, d_quarter_name, ca_state, SUM(ws_net_profit) AS total_net_profit, AVG(sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, COUNT(DISTINCT ws_order_number) AS total_orders, COUNT(DISTINCT sr_ticket_number) AS total_returns FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN customer_address ON ws_ship_addr_sk = ca_address_sk JOIN store_returns ON ws_order_number = sr_ticket_number AND ws_item_sk = sr_item_sk AND ws_bill_customer_sk = sr_customer_sk WHERE d_year = 2001 AND ca_state IN ('CA', 'NY', 'TX') AND ws_ship_mode_sk IN (15, 9, 19) AND ws_net_profit > 0 AND ws_ship_customer_sk IN (91411, 13153, 53110, 78552, 62671) AND sr_return_amt_inc_tax IN (211.69, 1118.88) AND sr_customer_sk IN (30509, 42705, 90022, 87597) GROUP BY d_year, d_quarter_name, ca_state ORDER BY total_net_profit DESC, avg_return_amount_inc_tax DESC;
SELECT ca.ca_state AS customer_state, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sale_price, SUM(cr.cr_return_quantity) AS total_quantity_returned, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, COUNT(DISTINCT p.p_promo_sk) AS total_promotions_used, COUNT(DISTINCT w.w_warehouse_sk) AS total_warehouses_used FROM customer_address ca JOIN customer c ON ca.ca_address_sk = c.c_current_addr_sk JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk WHERE ca.ca_state IS NOT NULL AND p.p_channel_radio = 'N' AND (p.p_promo_name LIKE '%bar%' OR p.p_promo_name LIKE '%anti%') AND w.w_warehouse_id IN ('AAAAAAAABAAAAAAA', 'AAAAAAAADAAAAAAA', 'AAAAAAAAEAAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAACAAAAAAA') AND cs.cs_catalog_page_sk IN ( SELECT cp_catalog_page_sk FROM catalog_page WHERE cp_catalog_page_number IN (29, 24, 40) ) GROUP BY ca.ca_state ORDER BY total_return_amount DESC, average_sale_price DESC LIMIT 100;
SELECT sm.sm_type AS shipping_method, dd.d_year AS year, dd.d_quarter_name AS quarter, SUM(cs.cs_net_paid_inc_ship_tax) AS total_sales, COUNT(DISTINCT cs.cs_order_number) AS total_sales_orders, SUM(cr.cr_net_loss) AS total_returns, COUNT(DISTINCT cr.cr_order_number) AS total_return_orders FROM ship_mode sm LEFT JOIN catalog_sales cs ON sm.sm_ship_mode_sk = cs.cs_ship_mode_sk LEFT JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number WHERE sm.sm_code IN ('AIR', 'SEA', 'SURFACE', 'BIKE') AND dd.d_quarter_seq IN (47, 48) GROUP BY shipping_method, year, quarter ORDER BY year, quarter, shipping_method;
SELECT ca.ca_city, sm.sm_type AS shipping_type, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_quantity) AS total_web_quantity_sold, AVG(ws.ws_sales_price) AS average_web_sales_price, SUM(ws.ws_net_profit) AS total_web_net_profit, COUNT(DISTINCT cs.cs_order_number) AS total_catalog_orders, SUM(cs.cs_quantity) AS total_catalog_quantity_sold, AVG(cs.cs_sales_price) AS average_catalog_sales_price, SUM(cs.cs_net_profit) AS total_catalog_net_profit, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_net_loss) AS total_net_loss FROM customer_address ca LEFT JOIN web_sales ws ON ca.ca_address_sk = ws.ws_bill_addr_sk LEFT JOIN catalog_sales cs ON ca.ca_address_sk = cs.cs_bill_addr_sk LEFT JOIN store_returns sr ON ca.ca_address_sk = sr.sr_addr_sk LEFT JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk WHERE ca.ca_city IN ('Ruth', 'Tabor', 'Altamont', 'Morgantown', 'Hartland', 'Richville') AND (ws.ws_wholesale_cost IN (9.45, 10.23, 52.95, 12.11, 47.17) OR cs.cs_bill_customer_sk IN (79309, 53472, 7567, 9353, 49484) OR sr.sr_returned_date_sk IN (2452085, 2451229)) GROUP BY ca.ca_city, sm.sm_type ORDER BY ca.ca_city, shipping_type;
SELECT dd.d_year, dd.d_quarter_name, w.w_state, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(inv.inv_quantity_on_hand) AS avg_inventory, COUNT(DISTINCT inv.inv_warehouse_sk) AS number_of_warehouses, COUNT(DISTINCT web.web_site_sk) AS number_of_websites, SUM(cc.cc_employees) AS total_employees, AVG(cc.cc_tax_percentage) AS avg_tax_percentage FROM inventory inv JOIN date_dim dd ON inv.inv_date_sk = dd.d_date_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN web_site web ON web.web_state = w.w_state JOIN call_center cc ON cc.cc_state = w.w_state WHERE inv.inv_quantity_on_hand IN (232, 844, 624) AND dd.d_year = 2023 AND web.web_open_date_sk <= dd.d_date_sk AND (web.web_close_date_sk IS NULL OR web.web_close_date_sk >= dd.d_date_sk) AND cc.cc_open_date_sk <= dd.d_date_sk AND (cc.cc_closed_date_sk IS NULL OR cc.cc_closed_date_sk >= dd.d_date_sk) GROUP BY dd.d_year, dd.d_quarter_name, w.w_state ORDER BY dd.d_year, dd.d_quarter_name, w.w_state;
SELECT cc_state, cc_city, ca_country, COUNT(DISTINCT cc_call_center_sk) AS number_of_call_centers, SUM(cc_employees) AS total_employees, AVG(cc_tax_percentage) AS avg_tax_percentage, SUM(s_number_employees) AS total_store_employees, AVG(s_tax_precentage) AS avg_store_tax, SUM(ws_quantity) AS total_items_sold, SUM(ws_net_paid) AS total_revenue, SUM(ws_net_profit) AS total_profit, AVG(ws_net_profit) AS avg_profit_per_sale, SUM(ws_ext_ship_cost) AS total_shipping_cost FROM call_center JOIN store ON cc_zip = s_zip JOIN web_sales ON ws_ship_addr_sk IN (SELECT ca_address_sk FROM customer_address WHERE ca_zip = cc_zip) JOIN customer_address ON cc_zip = ca_zip WHERE cc_hours IN ('8AM-4PM', '8AM-8AM') AND ws_net_profit NOT IN (-1167.89, -63.88, -192.70, -49.59) AND ca_country = 'United States' AND ca_gmt_offset IN (-8.00, -9.00) GROUP BY cc_state, cc_city, ca_country ORDER BY total_profit DESC;
SELECT ws.web_name, d.d_year, d.d_moy, COUNT(DISTINCT wp.wp_web_page_sk) AS total_pages, SUM(wp.wp_char_count) AS total_char_count, SUM(wp.wp_link_count) AS total_link_count, SUM(wp.wp_image_count) AS total_image_count, AVG(p.p_cost) AS average_promo_cost, SUM(CASE WHEN p.p_discount_active = 'Y' THEN p.p_cost ELSE 0 END) AS total_discounted_promo_cost, COUNT(DISTINCT c.c_customer_sk) AS total_customers, COUNT(DISTINCT CASE WHEN c.c_preferred_cust_flag = 'Y' THEN c.c_customer_sk ELSE NULL END) AS preferred_customers FROM web_site ws JOIN web_page wp ON wp.wp_customer_sk = ws.web_site_sk JOIN date_dim d ON wp.wp_access_date_sk = d.d_date_sk LEFT JOIN promotion p ON p.p_start_date_sk <= d.d_date_sk AND p.p_end_date_sk >= d.d_date_sk LEFT JOIN customer c ON c.c_customer_sk = wp.wp_customer_sk WHERE ws.web_manager IN ('John Isaacs', 'James Bernard') AND wp.wp_autogen_flag = 'N' AND c.c_birth_year = 1973 GROUP BY ws.web_name, d.d_year, d.d_moy ORDER BY ws.web_name, d.d_year, d.d_moy;
SELECT d_year, i_category, SUM(inv_quantity_on_hand) AS total_inventory, AVG(i_current_price) AS avg_item_price, COUNT(DISTINCT inv_warehouse_sk) AS num_warehouses, SUM(wr_return_amt) AS total_return_amount, AVG(wr_return_ship_cost) AS avg_return_ship_cost, COUNT(DISTINCT wr_order_number) AS num_returns FROM inventory JOIN item ON inv_item_sk = i_item_sk JOIN date_dim ON inv_date_sk = d_date_sk LEFT JOIN web_returns ON wr_item_sk = i_item_sk AND wr_returned_date_sk = d_date_sk WHERE d_year = 2002 GROUP BY d_year, i_category ORDER BY total_inventory DESC, total_return_amount DESC LIMIT 10;
SELECT i.i_class, t.t_am_pm, COUNT(DISTINCT ss.ss_ticket_number) AS total_store_sales_transactions, SUM(ss.ss_net_paid) AS total_store_sales_revenue, AVG(ss.ss_net_paid) AS avg_store_sales_revenue, COUNT(DISTINCT ws.ws_order_number) AS total_web_sales_transactions, SUM(ws.ws_net_paid_inc_tax) AS total_web_sales_revenue, AVG(ws.ws_net_paid_inc_tax) AS avg_web_sales_revenue, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_returns_transactions, SUM(cr.cr_return_amount) AS total_catalog_returns_cost, AVG(cr.cr_return_amount) AS avg_catalog_returns_cost FROM item i LEFT JOIN store_sales ss ON i.i_item_sk = ss.ss_item_sk LEFT JOIN web_sales ws ON i.i_item_sk = ws.ws_item_sk LEFT JOIN catalog_returns cr ON i.i_item_sk = cr.cr_item_sk LEFT JOIN time_dim t ON (ss.ss_sold_time_sk = t.t_time_sk OR ws.ws_sold_time_sk = t.t_time_sk OR cr.cr_returned_time_sk = t.t_time_sk) WHERE i.i_class IN ('karoke', 'paint', 'personal') AND t.t_am_pm = 'AM' GROUP BY i.i_class, t.t_am_pm ORDER BY i.i_class, t.t_am_pm;
SELECT ca_state, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, COUNT(*) AS return_count, SUM(ss_net_profit) AS total_store_sales_profit, AVG(ss_net_profit) AS avg_store_sales_profit, COUNT(DISTINCT ss_customer_sk) AS store_customer_count, SUM(ws_net_profit) AS total_web_sales_profit, AVG(ws_net_profit) AS avg_web_sales_profit, COUNT(DISTINCT ws_bill_customer_sk) AS web_customer_count FROM catalog_returns JOIN customer_address ON cr_returning_addr_sk = ca_address_sk JOIN store_sales ON catalog_returns.cr_item_sk = store_sales.ss_item_sk JOIN web_sales ON catalog_returns.cr_item_sk = web_sales.ws_item_sk JOIN promotion ON store_sales.ss_promo_sk = promotion.p_promo_sk AND web_sales.ws_promo_sk = promotion.p_promo_sk JOIN household_demographics ON (catalog_returns.cr_returning_hdemo_sk = household_demographics.hd_demo_sk OR store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk OR web_sales.ws_ship_hdemo_sk = household_demographics.hd_demo_sk) WHERE promotion.p_channel_demo = 'N' AND household_demographics.hd_income_band_sk IN (8, 10) AND household_demographics.hd_buy_potential IN ('>10000', 'Unknown', '0-500', '5001-10000', '1001-5000', '501-1000') AND catalog_returns.cr_reason_sk IN (9, 32, 23, 19) AND promotion.p_end_date_sk IN (2450545, 2450776) GROUP BY ca_state ORDER BY total_return_amount DESC;
SELECT d_year AS "Year", p_promo_name AS "Promotion Name", COUNT(cr_order_number) AS "Total Returns", SUM(cr_return_quantity) AS "Total Returned Quantity", SUM(cr_return_amount) AS "Total Returned Amount", AVG(cr_return_amount) AS "Average Return Amount", SUM(cr_net_loss) AS "Total Net Loss" FROM catalog_returns cr JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk JOIN promotion p ON d.d_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk WHERE p.p_end_date_sk IN ('2450731', '2450673', '2450658', '2450718') GROUP BY "Year", "Promotion Name" ORDER BY "Year", "Total Returned Amount" DESC;
SELECT cc.cc_division_name, ib.ib_upper_bound, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_net_paid, AVG(ss.ss_net_profit) AS average_net_profit, COUNT(DISTINCT ss.ss_store_sk) AS number_of_stores, COUNT(DISTINCT cs.cs_call_center_sk) AS number_of_call_centers, COUNT(DISTINCT hd.hd_demo_sk) AS number_of_household_demographics, SUM(CASE WHEN cr.cr_return_amount > 0 THEN 1 ELSE 0 END) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_fee) AS average_return_fee FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN call_center cc ON s.s_store_sk = cc.cc_call_center_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk LEFT JOIN catalog_sales cs ON ss.ss_ticket_number = cs.cs_order_number LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number WHERE ss.ss_sold_date_sk IN (2451072, 2451839, 2451935, 2451452, 2451580, 2451465) AND cc.cc_division_name IN ('anti', 'ought', 'pri', 'ese') AND ib.ib_upper_bound IN (150000, 60000, 190000, 70000, 170000, 30000) GROUP BY cc.cc_division_name, ib.ib_upper_bound ORDER BY total_net_paid DESC, average_net_profit DESC;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_state, ca.ca_city, COUNT(DISTINCT sr.sr_customer_sk) AS number_of_returning_customers, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(sr.sr_fee) AS total_fees_collected, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr INNER JOIN date_dim dd ON sr.sr_returned_date_sk = dd.d_date_sk INNER JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk INNER JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk WHERE dd.d_year = 2022 AND hd.hd_buy_potential = '>10000' AND dd.d_quarter_seq = 52 GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state, ca.ca_city ORDER BY total_net_loss DESC, avg_return_amount_inc_tax DESC LIMIT 10;
SELECT i.i_category, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(wr.wr_return_quantity) AS total_quantity_returned, SUM(wr.wr_return_amt) AS total_return_amount, AVG(inv.inv_quantity_on_hand) AS average_inventory_on_hand FROM item i LEFT JOIN store_sales ss ON ss.ss_item_sk = i.i_item_sk LEFT JOIN web_returns wr ON wr.wr_item_sk = i.i_item_sk LEFT JOIN inventory inv ON inv.inv_item_sk = i.i_item_sk WHERE i.i_category IN ('Electronics', 'Clothing', 'Furniture') AND ss.ss_sold_date_sk BETWEEN 2451453 AND 2451553 AND wr.wr_returned_date_sk BETWEEN 2451453 AND 2451553 AND inv.inv_date_sk BETWEEN 2451453 AND 2451553 GROUP BY i.i_category ORDER BY total_quantity_sold DESC;
SELECT ws.web_name, ws.web_market_manager, ws.web_class, ws.web_city, COUNT(DISTINCT wp.wp_web_page_sk) AS total_pages, SUM(wp.wp_image_count) AS total_images, SUM(wp.wp_link_count) AS total_links, AVG(wp.wp_char_count) AS avg_char_count, SUM(sr.sr_return_quantity) AS total_returned_quantity, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, COUNT(DISTINCT sr.sr_customer_sk) AS distinct_returning_customers, dd.d_year, dd.d_quarter_name, SUM(CASE WHEN dd.d_holiday = 'Y' THEN 1 ELSE 0 END) AS holiday_count, SUM(CASE WHEN dd.d_weekend = 'Y' THEN 1 ELSE 0 END) AS weekend_count FROM web_site ws JOIN web_page wp ON ws.web_site_sk = wp.wp_web_page_sk JOIN date_dim dd ON wp.wp_access_date_sk = dd.d_date_sk LEFT JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk WHERE dd.d_year IN (2020, 2021) AND ws.web_market_manager IN ('Gilbert Chapman', 'Jeffrey Campbell', 'Keith Frazier') AND ws.web_close_date_sk IS NULL GROUP BY ws.web_name, ws.web_market_manager, ws.web_class, ws.web_city, dd.d_year, dd.d_quarter_name ORDER BY ws.web_market_manager, ws.web_name, dd.d_year, dd.d_quarter_name;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, COUNT(DISTINCT c.c_customer_sk) AS num_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid_inc_tax) AS total_sales_with_tax, SUM(wr.wr_return_quantity) AS total_quantity_returned, SUM(wr.wr_return_amt_inc_tax) AS total_returns_with_tax, SUM(ss.ss_net_profit) - SUM(wr.wr_net_loss) AS net_profit FROM customer_demographics cd JOIN customer c ON cd.cd_demo_sk = c.c_current_cdemo_sk LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk WHERE (ss.ss_sold_date_sk BETWEEN 20030101 AND 20031231 OR wr.wr_returned_date_sk BETWEEN 20030101 AND 20031231) GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating ORDER BY net_profit DESC;
SELECT cd.cd_gender, cd.cd_education_status, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_profit, p.p_channel_details, s.s_store_name FROM store_sales ss JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk WHERE p.p_channel_details IN ('Books expect international, big interests', 'Scenes might make high') AND c.c_last_name IN ('Carter', 'Babcock', 'Hoag') AND s.s_county IN ('Nolan County', 'Winchester city', 'Elliott County', 'Minidoka County') AND ss.ss_sold_date_sk >= 2450460 GROUP BY cd.cd_gender, cd.cd_education_status, p.p_channel_details, s.s_store_name ORDER BY total_sales DESC, total_profit DESC;
SELECT w_city, cp_department, AVG(cs_quantity) AS average_quantity, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS average_sales_price, SUM(cs_sales_price) AS total_sales, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN catalog_page ON catalog_sales.cs_catalog_page_sk = catalog_page.cp_catalog_page_sk JOIN warehouse ON catalog_sales.cs_warehouse_sk = warehouse.w_warehouse_sk WHERE w_city = 'Fairview' AND cp_department = 'DEPARTMENT' AND cp_description IN ( 'New resources might go from a proposals. Urgently', 'Only nuclear policies understand so basic courts.', 'Years withdraw most various, corresponding areas.', 'Facilities know changes. Now difficult changes go' ) GROUP BY w_city, cp_department ORDER BY total_net_profit DESC;
SELECT cc.cc_name, cc.cc_manager, c.cd_education_status, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, COUNT(DISTINCT c.cd_demo_sk) AS number_of_unique_customers FROM store_sales ss JOIN call_center cc ON ss.ss_store_sk = cc.cc_call_center_sk JOIN customer_demographics c ON ss.ss_cdemo_sk = c.cd_demo_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk JOIN catalog_page cp ON ss.ss_promo_sk = cp.cp_catalog_page_sk WHERE cc.cc_manager IN ('Larry Mccray', 'Felipe Perkins') AND cp.cp_type IN ('bi-annual', 'monthly', 'quarterly') AND t.t_hour BETWEEN 0 AND 1 AND c.cd_dep_college_count = 0 AND ss.ss_sold_date_sk IS NOT NULL GROUP BY cc.cc_name, cc.cc_manager, c.cd_education_status ORDER BY total_quantity_sold DESC, average_sales_price DESC;
SELECT p.p_promo_name AS promotion_name, ib.ib_lower_bound AS income_band_lower_bound, ib.ib_upper_bound AS income_band_upper_bound, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_ext_sales_price) AS total_sales, SUM(ss.ss_ext_discount_amt) AS total_discount_amount, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_customer_sk) AS distinct_customers, SUM(CASE WHEN ss.ss_sales_price < ss.ss_list_price THEN 1 ELSE 0 END) AS count_discounted_sales FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN income_band ib ON ss.ss_cdemo_sk = ib.ib_income_band_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE p.p_discount_active = 'N' AND d.d_year IN (1901, 1903, 1906, 1908) AND ss.ss_ext_sales_price IN (2209.06, 2248.08) AND ib.ib_lower_bound IN (0, 90001, 170001, 120001, 50001) AND ib.ib_upper_bound = 160000 GROUP BY p.p_promo_name, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_sales DESC, promotion_name, income_band_lower_bound, income_band_upper_bound;
SELECT s.s_city, sm.sm_type, COUNT(sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, SUM(sr.sr_return_amt) AS total_returned_amount, AVG(sr.sr_return_amt) AS average_returned_amount, SUM(sr.sr_return_tax) AS total_returned_tax, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN ship_mode sm ON sr.sr_reason_sk = sm.sm_ship_mode_sk WHERE s.s_city IN ('Midway', 'Fairview') AND sm.sm_type = 'LIBRARY' AND sr.sr_returned_date_sk BETWEEN 20180101 AND 20181231 GROUP BY s.s_city, sm.sm_type ORDER BY s.s_city, sm.sm_type;
SELECT hd.hd_income_band_sk, COUNT(DISTINCT ss.ss_customer_sk) AS num_customers, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE hd.hd_income_band_sk IN (18, 2) AND t.t_hour BETWEEN 8 AND 17 GROUP BY hd.hd_income_band_sk ORDER BY total_net_profit DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT hd.hd_demo_sk) AS household_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, SUM(CASE WHEN cp.cp_department = 'DEPARTMENT' THEN 1 ELSE 0 END) AS department_page_count, sm.sm_carrier, COUNT(DISTINCT sm.sm_ship_mode_sk) AS ship_mode_count FROM household_demographics hd JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk LEFT JOIN catalog_page cp ON cp.cp_catalog_number = hd.hd_income_band_sk AND cp.cp_catalog_page_number IN (100, 52, 68) LEFT JOIN ship_mode sm ON sm.sm_ship_mode_sk = hd.hd_vehicle_count AND sm.sm_carrier IN ('ORIENTAL', 'GREAT EASTERN', 'USPS') WHERE hd.hd_income_band_sk IN (7, 19, 4) AND hd.hd_dep_count IN (0, 4, 1) AND hd.hd_demo_sk IN (390, 179, 2543) AND ib.ib_upper_bound IN (130000, 160000, 20000) AND ib.ib_lower_bound IN (130001, 10001, 140001) AND sm.sm_contract IN ('qENFQ', 'I3uCelXtjP', 'GNJr3g5i7oorKqtX') GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_carrier ORDER BY ib.ib_upper_bound DESC, household_count DESC;
SELECT AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_ext_discount_amt) AS total_discount_amount, COUNT(DISTINCT p.p_promo_sk) AS number_of_promotions FROM web_sales ws JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk JOIN store s ON s.s_zip = '31904' JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk WHERE wp.wp_image_count IN (2, 3, 5) AND wp.wp_autogen_flag = 'N' AND (s.s_street_name = 'Lee 6th' OR s.s_street_name = '4th') AND p.p_channel_press = 'N' AND ws.ws_bill_hdemo_sk IN (2055, 5724, 3336) AND p.p_cost = 1000.00 GROUP BY s.s_market_id;
SELECT p.p_promo_name, sm.sm_type AS shipping_method, ca.ca_state AS ship_state, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_ext_discount_amt) AS avg_discount_amount, SUM(ws.ws_net_profit) AS total_profit FROM web_sales ws JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN customer_address ca ON ws.ws_ship_addr_sk = ca.ca_address_sk JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk WHERE d.d_year = 2023 AND p.p_discount_active = '1' AND ca.ca_state IS NOT NULL AND sm.sm_type IS NOT NULL GROUP BY p.p_promo_name, shipping_method, ship_state ORDER BY total_profit DESC, avg_discount_amount DESC, total_orders DESC;
SELECT dd.d_year AS return_year, ca.ca_state AS state, ib.ib_lower_bound || ' - ' || ib.ib_upper_bound AS income_band, COUNT(*) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_return_tax) AS total_return_tax, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN date_dim dd ON cr.cr_returned_date_sk = dd.d_date_sk JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE ca.ca_state IN ('WY', 'GA', 'LA', 'ME', 'MI') AND ib.ib_income_band_sk BETWEEN 6 AND 8 AND dd.d_year = 2023 GROUP BY return_year, state, income_band ORDER BY return_year, state, total_net_loss DESC;
SELECT cp.cp_department, hd.hd_buy_potential, w.w_state, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS unique_tickets, SUM(ss.ss_net_paid_inc_tax) AS total_revenue_inc_tax, SUM(ss.ss_net_profit) AS total_net_profit FROM catalog_page cp JOIN store_sales ss ON cp.cp_catalog_page_sk = ss.ss_sold_date_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN warehouse w ON ss.ss_addr_sk = w.w_warehouse_sk WHERE cp.cp_end_date_sk IN ('2451509', '2451817', '2451635') AND hd.hd_vehicle_count IN (0, 1, 2, 3, 4) AND w.w_state = 'TN' AND ss.ss_ticket_number IN (3518, 3677) GROUP BY cp.cp_department, hd.hd_buy_potential, w.w_state ORDER BY total_net_profit DESC;
SELECT wsit.web_site_id, wsit.web_name, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_paid) AS total_sales, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(DISTINCT wr.wr_order_number) AS total_returns, AVG(wr.wr_return_amt) AS avg_return_amt, SUM(CASE WHEN ws.ws_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS promo_sales_count, SUM(CASE WHEN ws.ws_promo_sk IS NULL THEN 1 ELSE 0 END) AS non_promo_sales_count, AVG(hd.hd_dep_count) AS avg_household_dependents, AVG(hd.hd_vehicle_count) AS avg_household_vehicles FROM web_sales ws LEFT JOIN web_site wsit ON ws.ws_web_site_sk = wsit.web_site_sk LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk LEFT JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk LEFT JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk LEFT JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk GROUP BY wsit.web_site_id, wsit.web_name ORDER BY total_sales DESC;
SELECT d_year, i_category, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, SUM(cs_net_paid) AS total_sales, AVG(cs_net_profit) AS average_profit_per_sale, SUM(cr_return_quantity) AS total_quantity_returned, SUM(cr_return_amount) AS total_returns, AVG(cr_net_loss) AS average_loss_per_return FROM catalog_sales JOIN item ON cs_item_sk = i_item_sk JOIN date_dim ON cs_sold_date_sk = d_date_sk LEFT JOIN catalog_returns ON cs_order_number = cr_order_number AND cs_item_sk = cr_item_sk WHERE (i_class_id IN (7, 14, 9)) AND (cr_reason_sk IN (17, 4, 20, 34, 25) OR cr_reason_sk IS NULL) AND (cs_coupon_amt IN (1589.39, 1893.80, 3358.21) OR cs_coupon_amt IS NULL) AND (catalog_sales.cs_ext_wholesale_cost IN (936.76, 3257.86) OR catalog_sales.cs_ext_wholesale_cost IS NULL) GROUP BY d_year, i_category ORDER BY d_year DESC, i_category;
SELECT d_year, i_category, sm_type, COUNT(*) AS total_shipments, SUM(i_current_price * i_wholesale_cost) AS revenue, AVG(i_current_price) AS avg_price, AVG(i_wholesale_cost) AS avg_cost FROM date_dim, item, ship_mode, income_band WHERE i_rec_start_date <= d_date AND (i_rec_end_date IS NULL OR i_rec_end_date >= d_date) AND sm_ship_mode_sk IN (SELECT sm_ship_mode_sk FROM ship_mode WHERE sm_type = 'AIR' OR sm_type = 'GROUND') AND ib_income_band_sk IN (4, 15, 3, 18) AND ib_upper_bound IN (200000, 50000) GROUP BY d_year, i_category, sm_type ORDER BY revenue DESC, d_year, i_category;
SELECT w_state, ca_state, s_state, web_state, COUNT(DISTINCT c.c_customer_sk) AS num_customers, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses, COUNT(DISTINCT s.s_store_sk) AS num_stores, COUNT(DISTINCT web.web_site_sk) AS num_websites, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_net_paid, AVG(ss_net_profit) AS avg_net_profit, SUM(ss_net_paid_inc_tax) AS total_net_paid_inc_tax FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN web_site web ON s.s_market_id = web.web_mkt_id JOIN warehouse w ON w.w_state = s.s_state JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE s.s_manager IN ('David Thomas', 'Scott Smith', 'William Ward', 'Brett Yates', 'Robert Thompson', 'Edwin Adams') AND web.web_city IN ('Fairview', 'Midway') AND s.s_market_id IN ('8', '6', '4', '2') GROUP BY ROLLUP(w_state, ca_state, s_state, web_state) ORDER BY w_state, ca_state, s_state, web_state;
SELECT cp.cp_type, w.w_state, COUNT(cs.cs_order_number) AS total_sales_orders, SUM(cs.cs_quantity) AS total_sales_quantity, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_sales_net_paid, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_net_loss) AS total_returns_net_loss, COUNT(DISTINCT wr.wr_order_number) AS total_web_returns_orders, AVG(wr.wr_return_amt) AS average_web_return_amount, SUM(wr.wr_net_loss) AS total_web_returns_net_loss FROM catalog_sales cs JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk LEFT JOIN store_returns sr ON cs.cs_item_sk = sr.sr_item_sk AND cs.cs_order_number = sr.sr_ticket_number LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number WHERE cp.cp_type IN ('quarterly', 'bi-annual', 'monthly') AND cp.cp_end_date_sk IN (2450904, 2451574, 2451419, 2451634, 2451144) AND w.w_country = 'United States' GROUP BY cp.cp_type, w.w_state ORDER BY total_sales_net_paid DESC;
SELECT cp_department, s_state, sm_type, COUNT(distinct cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, SUM(cs_net_paid) AS total_net_paid, AVG(cs_net_paid) AS avg_order_value, SUM(cs_net_profit) AS total_net_profit, COUNT(distinct hd_demo_sk) AS unique_customers, AVG(hd_vehicle_count) AS avg_vehicles_per_customer, AVG(hd_dep_count) AS avg_dependents_per_customer FROM catalog_sales JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk JOIN store ON cs_bill_customer_sk = s_store_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk JOIN household_demographics ON cs_bill_hdemo_sk = hd_demo_sk WHERE cp_start_date_sk <= 2450822 AND cp_end_date_sk >= 2450822 AND s_state = 'TN' AND sm_contract IN ('hGoF18SLDDPBj', 'GNJr3g5i7oorKqtX') AND cs_sold_date_sk BETWEEN 2450815 AND 2450829 AND cs_quantity IN (35, 88, 62, 12, 76) GROUP BY cp_department, s_state, sm_type ORDER BY total_net_paid DESC, total_orders DESC;
SELECT p.p_promo_id, p.p_promo_name, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_net_paid) AS total_revenue, SUM(cs.cs_ext_wholesale_cost) AS total_cost, SUM(cs.cs_net_profit) AS total_profit, AVG(cs.cs_ext_discount_amt) AS average_discount_amount FROM catalog_sales cs JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk GROUP BY p.p_promo_id, p.p_promo_name ORDER BY total_revenue DESC;
SELECT dd.d_year, dd.d_month_seq, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_profit) AS total_profit, COUNT(cs.cs_order_number) AS total_orders, SUM(sr.sr_return_amt) AS total_return_amt, COUNT(sr.sr_ticket_number) AS total_returns, (COUNT(sr.sr_ticket_number)::numeric / COUNT(cs.cs_order_number)) * 100 AS return_rate FROM customer_demographics cd JOIN customer c ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk LEFT JOIN store_returns sr ON cs.cs_order_number = sr.sr_ticket_number AND cs.cs_item_sk = sr.sr_item_sk WHERE dd.d_year = 2001 AND cs.cs_sales_price BETWEEN 50.00 AND 200.00 AND cd.cd_credit_rating = 'Good' GROUP BY dd.d_year, dd.d_month_seq, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY dd.d_year, dd.d_month_seq, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status;
SELECT ca.ca_city, ib.ib_income_band_sk, AVG(cs.cs_sales_price) AS avg_sales_price, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cs.cs_order_number) AS total_sales_orders, COUNT(DISTINCT cr.cr_order_number) AS total_return_orders, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cr.cr_return_quantity) AS total_quantity_returned FROM catalog_sales cs JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk JOIN catalog_returns cr ON cr.cr_returning_addr_sk = ca.ca_address_sk JOIN income_band ib ON ca.ca_gmt_offset = ib.ib_income_band_sk WHERE ca.ca_city IN ('Shannon', 'Gilbert', 'Sheridan', 'Winslow') AND ib.ib_upper_bound IN (40000, 90000, 80000, 140000, 160000, 30000) GROUP BY ca.ca_city, ib.ib_income_band_sk ORDER BY ca.ca_city, ib.ib_income_band_sk;
SELECT s_store_name, COUNT(DISTINCT ws_order_number) AS total_web_sales_orders, SUM(ws_net_paid) AS total_web_sales_revenue, AVG(ws_quantity) AS avg_web_sales_quantity, SUM(sr_return_amt) AS total_store_returns_revenue, AVG(sr_return_quantity) AS avg_store_returns_quantity, COUNT(DISTINCT cr_order_number) AS total_catalog_returns_orders, SUM(cr_return_amount) AS total_catalog_returns_revenue, AVG(cr_return_quantity) AS avg_catalog_returns_quantity FROM web_sales JOIN store ON ws_ship_customer_sk = s_store_sk JOIN store_returns ON sr_store_sk = s_store_sk JOIN catalog_returns ON cr_catalog_page_sk IN (SELECT cp_catalog_page_sk FROM catalog_page WHERE cp_type = 'monthly') JOIN ship_mode ON web_sales.ws_ship_mode_sk = ship_mode.sm_ship_mode_sk WHERE ws_sold_date_sk BETWEEN 2452235 AND 2452629 AND sr_returned_date_sk = ws_sold_date_sk AND cr_returned_date_sk = ws_sold_date_sk AND ws_net_paid_inc_ship_tax > 7000 AND sm_type IN ('OVERNIGHT', 'REGULAR') GROUP BY s_store_name ORDER BY total_web_sales_revenue DESC;
SELECT d_year, i_category, SUM(ss_quantity) AS total_store_sales_quantity, AVG(ss_sales_price) AS avg_store_sales_price, AVG(cs_sales_price) AS avg_catalog_sales_price, AVG(ws_sales_price) AS avg_web_sales_price, SUM(ss_net_paid) AS total_store_net_paid, SUM(cs_net_paid) AS total_catalog_net_paid, SUM(ws_net_paid) AS total_web_net_paid, COUNT(DISTINCT ss_store_sk) AS number_of_stores, COUNT(DISTINCT cs_catalog_page_sk) AS number_of_catalog_pages, COUNT(DISTINCT ws_web_site_sk) AS number_of_websites FROM store_sales JOIN date_dim ON (ss_sold_date_sk = d_date_sk) JOIN item ON (ss_item_sk = i_item_sk) LEFT JOIN catalog_sales ON (ss_item_sk = cs_item_sk AND ss_sold_date_sk = cs_sold_date_sk) LEFT JOIN web_sales ON (ss_item_sk = ws_item_sk AND ss_sold_date_sk = ws_sold_date_sk) WHERE d_year = 1999 AND (ss_net_paid > 900 OR cs_net_paid > 900 OR ws_net_paid > 900) AND i_manager_id IN (65, 2, 85) GROUP BY d_year, i_category ORDER BY total_store_sales_quantity DESC, total_store_net_paid DESC, i_category;
SELECT d.d_year, d.d_quarter_name, s.s_state, sm.sm_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_net_paid) AS total_revenue, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_profit FROM catalog_sales cs JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN store s ON cs.cs_ship_addr_sk = s.s_store_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk WHERE d.d_year = (SELECT MAX(d_year) FROM date_dim) - 1 AND s.s_rec_end_date IS NULL GROUP BY d.d_year, d.d_quarter_name, s.s_state, sm.sm_type ORDER BY d.d_year, d.d_quarter_name, s.s_state, sm.sm_type;
SELECT cd.cd_education_status, COUNT(*) AS total_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(cs.cs_quantity) AS total_items_sold, SUM(cs.cs_net_paid) AS total_revenue, SUM(sr.sr_return_quantity) AS total_items_returned, SUM(sr.sr_net_loss) AS total_loss FROM customer_demographics cd LEFT JOIN catalog_sales cs ON cd.cd_demo_sk = cs.cs_bill_cdemo_sk LEFT JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk WHERE cd.cd_credit_rating IN ('High Risk', 'Low Risk', 'Good') AND cs.cs_order_number IN (136032, 15467, 59785, 76201, 136250, 105478) AND sr.sr_item_sk IN (13089, 10527, 1538, 10362, 3961) AND sr.sr_hdemo_sk IN (1928, 4567, 1918, 2937) GROUP BY cd.cd_education_status ORDER BY total_revenue DESC;
SELECT c.c_customer_id, AVG(ss.ss_net_profit) AS avg_net_profit, SUM(sr.sr_return_amt_inc_tax) AS total_returns, COUNT(DISTINCT ws.web_site_sk) AS number_of_websites, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid_inc_tax) AS total_sales_inc_tax FROM customer c LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk LEFT JOIN web_site ws ON ws.web_zip = c.c_current_addr_sk::character varying WHERE (ss.ss_hdemo_sk IN ('4776', '3144', '2508', '6460') OR c.c_current_hdemo_sk IN ('5414', '1065', '4963', '3942', '5655', '758')) AND (ws.web_zip IN ('35709', '31904') OR ws.web_rec_end_date IN ('1999-08-16', '2000-08-15', '2001-08-15')) GROUP BY c.c_customer_id ORDER BY avg_net_profit DESC, total_returns DESC, number_of_websites DESC, total_quantity_sold DESC, total_sales_inc_tax DESC;
SELECT cc.cc_division_name, i.i_manufact_id, i.i_category, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, COUNT(DISTINCT cr.cr_order_number) AS total_returned_orders, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(cr.cr_return_quantity) AS total_returned_quantity FROM call_center cc JOIN catalog_returns cr ON cc.cc_call_center_sk = cr.cr_call_center_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN customer c ON cr.cr_returning_customer_sk = c.c_customer_sk WHERE cc.cc_tax_percentage IN ('0.01', '0.12') AND i.i_manufact_id IN ('347', '497') AND c.c_birth_year IN ('1974', '1946', '1962', '1987', '1964') AND c.c_birth_country IN ('CAPE VERDE', 'POLAND', 'PITCAIRN', 'PAPUA NEW GUINEA', 'BELIZE', 'NIUE') GROUP BY cc.cc_division_name, i.i_manufact_id, i.i_category ORDER BY total_return_amount DESC;
SELECT cp.cp_department AS department, i.i_category AS category, i.i_class AS class, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, AVG(hd.hd_dep_count) AS average_dependents, AVG(hd.hd_vehicle_count) AS average_vehicles FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN catalog_page cp ON i.i_item_sk = cp.cp_catalog_page_sk JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE hd.hd_vehicle_count IN (0, 3) AND hd.hd_buy_potential IN ('>10000', '5001-10000', '501-1000', '0-500') AND cp.cp_start_date_sk <= ws.ws_sold_date_sk AND (cp.cp_end_date_sk IS NULL OR cp.cp_end_date_sk >= ws.ws_sold_date_sk) GROUP BY cp.cp_department, i.i_category, i.i_class ORDER BY total_net_profit DESC, total_orders DESC;
SELECT s.s_store_sk, s.s_store_name, s.s_city, s.s_state, dd.d_quarter_name, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_units_sold, SUM(ss.ss_net_paid) AS total_revenue, SUM(ss.ss_net_profit) AS total_profit, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions, SUM(sr.sr_return_quantity) AS total_units_returned, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_net_loss) AS total_return_loss, AVG(cd.cd_dep_count) AS avg_customer_dependants, AVG(hd.hd_income_band_sk) AS avg_customer_income_band, r.r_reason_desc AS most_common_return_reason FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk LEFT JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk LEFT JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk LEFT JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE dd.d_quarter_name IS NOT NULL GROUP BY s.s_store_sk, s.s_store_name, s.s_city, s.s_state, dd.d_quarter_name, r.r_reason_desc ORDER BY s.s_store_sk, dd.d_quarter_name;
SELECT hd.hd_dep_count, hd.hd_vehicle_count, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT p.p_promo_sk) AS num_promotions, SUM(p.p_cost) AS total_promo_cost, AVG(p.p_cost) AS avg_promo_cost, COUNT(DISTINCT r.r_reason_sk) AS num_reasons, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, SUM(CASE WHEN p.p_channel_event = 'N' THEN 1 ELSE 0 END) AS non_event_promos, SUM(CASE WHEN p.p_response_target = 1 THEN 1 ELSE 0 END) AS target_response_promos FROM promotion p JOIN household_demographics hd ON p.p_item_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk LEFT JOIN reason r ON r.r_reason_sk = p.p_promo_sk WHERE p.p_channel_event = 'N' AND p.p_response_target = 1 GROUP BY hd.hd_dep_count, hd.hd_vehicle_count, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_promo_cost DESC, num_promotions DESC;
SELECT p.p_promo_id, p.p_promo_name, COUNT(ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws INNER JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk INNER JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk INNER JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk INNER JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE p.p_channel_press = 'N' AND hd.hd_vehicle_count IN (1, 2) AND ib.ib_income_band_sk IN (20, 8) AND p.p_purpose <> 'Unknown' GROUP BY p.p_promo_id, p.p_promo_name ORDER BY total_net_profit DESC, total_quantity_sold DESC;
SELECT cp.cp_department AS department, EXTRACT(YEAR FROM d_date) AS sale_year, EXTRACT(MONTH FROM d_date) AS sale_month, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sale_price, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions FROM catalog_page cp JOIN store_sales ss ON cp.cp_catalog_page_sk = ss.ss_item_sk JOIN time_dim td ON ss.ss_sold_time_sk = td.t_time_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE cp.cp_type IN ('monthly', 'bi-annual', 'quarterly') AND ss.ss_item_sk IN (1838, 9235) AND ss.ss_wholesale_cost IN (5.12, 59.59, 25.96, 87.72, 47.56) AND td.t_hour = 1 GROUP BY department, sale_year, sale_month ORDER BY department, sale_year, sale_month;
SELECT cp.cp_department AS department, i.i_category AS category, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, AVG(cd.cd_purchase_estimate) AS average_purchase_estimate, COUNT(DISTINCT cd.cd_demo_sk) AS unique_customers FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk WHERE cd.cd_education_status IN ('4 yr Degree', 'Advanced Degree', 'College', 'Primary', 'Secondary', '2 yr Degree') AND cp.cp_type = 'Catalog' AND i.i_brand_id IS NOT NULL GROUP BY cp.cp_department, i.i_category ORDER BY total_net_paid DESC, average_sales_price DESC LIMIT 10;
SELECT d_year, sm_type, COUNT(DISTINCT cr_order_number) AS total_orders_returned, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_quantity) AS total_returned_quantity, COUNT(DISTINCT cr_refunded_customer_sk) AS unique_customers_refunded, COUNT(DISTINCT p_promo_sk) AS total_promotions_involved, ib_lower_bound, ib_upper_bound, COUNT(DISTINCT cr_item_sk) AS unique_items_returned FROM catalog_returns JOIN date_dim ON catalog_returns.cr_returned_date_sk = date_dim.d_date_sk JOIN ship_mode ON catalog_returns.cr_ship_mode_sk = ship_mode.sm_ship_mode_sk LEFT JOIN promotion ON catalog_returns.cr_item_sk = promotion.p_item_sk LEFT JOIN customer ON catalog_returns.cr_refunded_customer_sk = customer.c_customer_sk LEFT JOIN income_band ON customer.c_current_cdemo_sk = income_band.ib_income_band_sk WHERE date_dim.d_day_name IN ('Saturday', 'Wednesday', 'Monday', 'Sunday', 'Friday') AND date_dim.d_fy_week_seq IN (678, 348, 524, 575) AND ship_mode.sm_code IN ('BIKE', 'SURFACE') AND catalog_returns.cr_order_number IN ('5596', '4666', '2090', '4550', '3303') AND income_band.ib_lower_bound IN (150001, 10001, 100001) GROUP BY d_year, sm_type, ib_lower_bound, ib_upper_bound ORDER BY d_year DESC, sm_type, ib_lower_bound;
SELECT ca.ca_state, ib.ib_income_band_sk, i.i_category, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS avg_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN customer_address ca ON ws.ws_ship_addr_sk = ca.ca_address_sk JOIN income_band ib ON ws.ws_ship_hdemo_sk = ib.ib_income_band_sk WHERE i.i_class IN ('infants', 'diamonds', 'camcorders', 'karoke', 'pendants', 'wireless') AND ca.ca_street_name IN ('Oak Franklin', 'Park Fourteenth', '2nd 5th', 'Second Main') AND ws.ws_ship_hdemo_sk IN ('5884', '5775', '5849', '958', '2572') AND ws.ws_ext_list_price IN ('5273.64', '22629.95', '2666.62') AND ib.ib_income_band_sk IN ('1', '6', '14', '13', '2') GROUP BY ca.ca_state, ib.ib_income_band_sk, i.i_category ORDER BY total_net_profit DESC, ca.ca_state, ib.ib_income_band_sk, i.i_category;
SELECT sm.sm_type AS shipping_type, web.web_site_sk AS website_id, web.web_name AS website_name, i.i_category AS product_category, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_incl_tax, SUM(ws.ws_net_paid_inc_ship) AS total_net_paid_incl_shipping, SUM(ws.ws_net_paid_inc_ship_tax) AS total_net_paid_incl_shipping_tax, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk WHERE sm.sm_type IN ('REGULAR', 'EXPRESS', 'OVERNIGHT') AND web.web_country = 'United States' AND ws.ws_warehouse_sk IN (2, 4) AND i.i_category IN ('Electronics', 'Women', 'Children', 'Home', 'Sports', 'Books') AND dd.d_year = 1999 GROUP BY shipping_type, website_id, website_name, product_category ORDER BY total_net_profit DESC, total_net_paid DESC, website_name, product_category;
SELECT ws.ws_web_site_sk, ws_site.web_site_id, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS avg_sales_price, SUM(ws.ws_net_profit) AS total_net_profit, cc.cc_call_center_id, cc.cc_name, AVG(cc.cc_employees) AS avg_cc_employees, cd.cd_marital_status, COUNT(DISTINCT cd.cd_demo_sk) AS total_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, hd.hd_buy_potential, AVG(hd.hd_income_band_sk) AS avg_income_band FROM web_sales ws JOIN web_site ws_site ON ws.ws_web_site_sk = ws_site.web_site_sk JOIN call_center cc ON ws_site.web_mkt_id = cc.cc_mkt_id JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk WHERE ws.ws_sales_price > 0 AND ws.ws_sold_date_sk BETWEEN 2451569 AND 2452306 AND ws.ws_web_site_sk IN (4, 18, 20, 29, 27) AND cc.cc_call_center_sk IN (1, 4, 2) AND cd.cd_purchase_estimate > 5000 AND cd.cd_marital_status IN ('D', 'U', 'S', 'M', 'W') AND hd.hd_buy_potential IS NOT NULL GROUP BY ws.ws_web_site_sk, ws_site.web_site_id, cc.cc_call_center_id, cc.cc_name, cd.cd_marital_status, hd.hd_buy_potential ORDER BY total_net_profit DESC, avg_sales_price DESC LIMIT 100;
SELECT i_brand, i_class, i_category, i_manufact, avg(i_current_price) AS avg_price, avg(i_wholesale_cost) AS avg_cost, sum(inv_quantity_on_hand) AS total_inventory, count(DISTINCT inv_item_sk) AS unique_items_stocked, count(DISTINCT wp_web_page_sk) AS web_pages_count, avg(wp_char_count) AS avg_web_page_char_count FROM item JOIN inventory ON i_item_sk = inv_item_sk JOIN web_page ON wp_web_page_id = i_item_id WHERE inv_date_sk = 2450815 AND i_formulation = '537582860saddle45401' AND wp_web_page_id IN ('AAAAAAAACAAAAAAA', 'AAAAAAAAHDAAAAAA', 'AAAAAAAABDAAAAAA', 'AAAAAAAACDAAAAAA', 'AAAAAAAAABAAAAAA') GROUP BY i_brand, i_class, i_category, i_manufact ORDER BY total_inventory DESC, avg_price DESC;
SELECT i.i_category AS item_category, cc.cc_state AS call_center_state, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_sales_price) AS average_sales_price, AVG(ss.ss_ext_discount_amt) AS average_discount_amount FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN call_center cc ON cc.cc_call_center_sk = ss.ss_store_sk WHERE i.i_current_price BETWEEN 4.63 AND 18.31 AND ss.ss_sold_date_sk IS NOT NULL GROUP BY i.i_category, cc.cc_state ORDER BY total_sales DESC, item_category, call_center_state;
SELECT hd.hd_vehicle_count AS "Vehicle Count", COUNT(DISTINCT ws.ws_order_number) AS "Number of Orders", SUM(ws.ws_sales_price) AS "Total Sales Amount", AVG(ws.ws_sales_price) AS "Average Sales Price", COUNT(ws.ws_item_sk) AS "Items Sold", p.p_promo_name AS "Promotion Name", CASE WHEN p.p_discount_active = 'Y' THEN 'Discount Active' ELSE 'No Discount' END AS "Discount Status" FROM web_sales ws JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk JOIN customer c ON ws.ws_ship_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE p.p_discount_active = 'Y' AND hd.hd_vehicle_count IN (0, 2, 3) GROUP BY hd.hd_vehicle_count, p.p_promo_name, p.p_discount_active ORDER BY "Total Sales Amount" DESC, "Vehicle Count";
SELECT dt.d_year, dt.d_quarter_name, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ws.ws_net_paid_inc_tax) AS total_web_net_paid_inc_tax, cc.cc_city, AVG(hd.hd_dep_count) AS average_household_dependency_count, SUM(inv.inv_quantity_on_hand) AS total_inventory_on_hand FROM date_dim dt JOIN store_sales ss ON dt.d_date_sk = ss.ss_sold_date_sk JOIN web_sales ws ON dt.d_date_sk = ws.ws_sold_date_sk JOIN customer c ON (ss.ss_customer_sk = c.c_customer_sk OR ws.ws_bill_customer_sk = c.c_customer_sk) JOIN call_center cc ON (cc.cc_open_date_sk = dt.d_date_sk OR cc.cc_closed_date_sk = dt.d_date_sk) JOIN household_demographics hd ON (c.c_current_hdemo_sk = hd.hd_demo_sk OR ws.ws_bill_hdemo_sk = hd.hd_demo_sk) JOIN inventory inv ON dt.d_date_sk = inv.inv_date_sk WHERE dt.d_moy = 5 AND (dt.d_qoy = 1 OR dt.d_qoy = 2 OR dt.d_qoy = 3) AND (c.c_first_shipto_date_sk IN (2449442, 2451172, 2452404)) AND cc.cc_city = 'Midway' AND (ws.ws_item_sk IN (4, 103, 60)) AND (ws.ws_sales_price IN (38.82, 43.63, 82.62, 63.23)) GROUP BY dt.d_year, dt.d_quarter_name, cc.cc_city ORDER BY total_quantity_sold DESC, average_sales_price DESC, total_inventory_on_hand DESC, dt.d_year, dt.d_quarter_name;
SELECT dd.d_year, dd.d_quarter_name, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk WHERE dd.d_year = 2022 GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT ws_site.web_market_manager, SUM(ws.ws_sales_price) AS total_sales, AVG(ws.ws_sales_price) AS average_sales, COUNT(ws.ws_order_number) AS number_of_orders, COUNT(DISTINCT ws.ws_item_sk) AS number_of_items_sold, SUM(sr.sr_return_amt) AS total_returns, AVG(sr.sr_return_amt) AS average_return_amount, COUNT(DISTINCT sr.sr_ticket_number) AS number_of_returns FROM web_sales ws JOIN web_site ws_site ON ws.ws_web_site_sk = ws_site.web_site_sk LEFT JOIN store_returns sr ON ws.ws_bill_customer_sk = sr.sr_customer_sk AND ws.ws_item_sk = sr.sr_item_sk WHERE ws_site.web_open_date_sk IN (2450594, 2450798, 2450747, 2450577, 2450807, 2450645) GROUP BY ws_site.web_market_manager ORDER BY total_sales DESC;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_net_profit) AS avg_profit, COUNT(DISTINCT ss.ss_ticket_number) AS num_of_sales, SUM(sr.sr_net_loss) AS total_returns_loss, COUNT(DISTINCT sr.sr_ticket_number) AS num_of_returns, SUM(CASE WHEN sr.sr_refunded_cash > 0 THEN 1 ELSE 0 END) AS num_of_cash_refunds FROM customer c LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name HAVING SUM(ss.ss_net_paid) > 0 OR SUM(sr.sr_net_loss) > 0 ORDER BY total_sales DESC, total_returns_loss DESC;
SELECT sm.sm_ship_mode_id, sm.sm_type, cc.cc_name, cc.cc_city, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders FROM catalog_sales cs JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk GROUP BY sm.sm_ship_mode_id, sm.sm_type, cc.cc_name, cc.cc_city ORDER BY total_sales DESC, sm.sm_ship_mode_id, cc.cc_name;
SELECT cc.cc_name, w.w_warehouse_name, cd.cd_education_status, SUM(cs.cs_net_profit) AS total_profit, AVG(cs.cs_sales_price) AS average_sale_price, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_fee) AS average_return_fee FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number AND cs.cs_item_sk = cr.cr_item_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk WHERE cc.cc_hours = '8AM-8AM' AND w.w_gmt_offset = '-5.00' AND cc.cc_street_name IN ('Center Hill', 'Pine Ridge', 'Ash Hill') AND cr.cr_returning_addr_sk IN ('38685', '5389', '1090') GROUP BY cc.cc_name, w.w_warehouse_name, cd.cd_education_status ORDER BY total_profit DESC, total_returns DESC;
SELECT item.i_category, item.i_class, reason.r_reason_desc, COUNT(DISTINCT catalog_returns.cr_order_number) AS total_catalog_returns, SUM(catalog_returns.cr_return_amount) AS total_catalog_return_amount, AVG(catalog_returns.cr_return_amount) AS avg_catalog_return_amount, SUM(catalog_returns.cr_return_tax) AS total_catalog_return_tax, COUNT(DISTINCT store_returns.sr_ticket_number) AS total_store_returns, SUM(store_returns.sr_return_amt) AS total_store_return_amount, AVG(store_returns.sr_return_amt) AS avg_store_return_amount, SUM(store_returns.sr_return_tax) AS total_store_return_tax FROM catalog_returns JOIN item ON catalog_returns.cr_item_sk = item.i_item_sk JOIN reason ON catalog_returns.cr_reason_sk = reason.r_reason_sk JOIN store_returns ON catalog_returns.cr_item_sk = store_returns.sr_item_sk WHERE item.i_category IN ('Children', 'Men', 'Shoes', 'Women', 'Home', 'Sports') AND item.i_class IN ('rings', 'camping', 'wallpaper') AND (catalog_returns.cr_returned_date_sk BETWEEN 88 AND 4202 OR store_returns.sr_returned_date_sk BETWEEN 88 AND 4202) GROUP BY item.i_category, item.i_class, reason.r_reason_desc ORDER BY item.i_category, item.i_class, reason.r_reason_desc;
SELECT t_hour, COUNT(DISTINCT ws_order_number) AS number_of_transactions, SUM(ws_net_paid) AS total_sales_amount, AVG(ws_ext_discount_amt) AS average_discount_amount FROM web_sales ws JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk LEFT JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk WHERE td.t_am_pm = 'AM' AND (p.p_purpose IS NULL OR p.p_purpose <> 'Unknown') GROUP BY t_hour ORDER BY t_hour;
SELECT s.s_store_name, s.s_city, s.s_state, SUM(s.s_number_employees) AS total_employees, AVG(s.s_floor_space) AS average_floor_space, COUNT(DISTINCT cp.cp_catalog_page_sk) AS number_of_catalog_pages, SUM(CASE WHEN r.r_reason_id = 'AAAAAAAAMBAAAAAA' THEN 1 ELSE 0 END) AS count_mb_reason, SUM(CASE WHEN r.r_reason_id = 'AAAAAAAACAAAAAAA' THEN 1 ELSE 0 END) AS count_ca_reason, AVG(s.s_tax_precentage) AS average_tax_percentage FROM store s LEFT JOIN catalog_page cp ON (s.s_store_sk = cp.cp_catalog_number) LEFT JOIN reason r ON (r.r_reason_desc = cp.cp_description) WHERE s.s_street_type IN ('Boulevard', 'Court', 'Dr.', 'Circle') AND s.s_number_employees > 200 AND cp.cp_end_date_sk = '2451634' AND cp.cp_catalog_page_id IN ('AAAAAAAAFHPAAAAA', 'AAAAAAAAGPGAAAAA') GROUP BY s.s_store_name, s.s_city, s.s_state ORDER BY s.s_store_name;
SELECT i.i_category, c.c_birth_country, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk WHERE i.i_rec_start_date >= '1999-10-28' AND i.i_rec_start_date <= '2001-10-27' AND i.i_brand IN ('importocorp #2', 'exportiexporti #2', 'scholarbrand #3', 'namelessmaxi #10', 'exportiexporti #1') AND ws.ws_web_page_sk IN (19, 18, 56, 24) AND c.c_birth_country IN ('MARSHALL ISLANDS', 'NEW CALEDONIA', 'MALTA', 'CHILE', 'GRENADA') GROUP BY i.i_category, c.c_birth_country ORDER BY total_net_profit DESC, total_net_paid DESC, i.i_category, c.c_birth_country;
SELECT ca_state, sm_type, hd_income_band_sk, COUNT(*) AS total_returns, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_amount) AS sum_return_amount, MAX(cr_return_amount) AS max_return_amount, MIN(cr_return_amount) AS min_return_amount, AVG(cr_fee) AS avg_fee, SUM(cr_fee) AS sum_fee FROM catalog_returns JOIN customer_address ON catalog_returns.cr_returning_addr_sk = customer_address.ca_address_sk JOIN household_demographics ON catalog_returns.cr_returning_hdemo_sk = household_demographics.hd_demo_sk JOIN ship_mode ON catalog_returns.cr_ship_mode_sk = ship_mode.sm_ship_mode_sk WHERE cr_return_tax > 200 AND cr_order_number IN (4607, 1986, 3937, 3931) AND hd_income_band_sk IN (4, 10) AND sm_contract IN ('6Hzzp4JkzjqD8MGXLCDa', 'Xjy3ZPuiDjzHlRx14Z3', 'O9V6oF8RJnLMmZYd1', 'I3uCelXtjP', 'OrDuVy2H', 'qENFQ') AND sm_carrier IN ('BOXBUNDLES', 'ZOUROS', 'DHL', 'MSC', 'GREAT EASTERN', 'AIRBORNE') GROUP BY ca_state, sm_type, hd_income_band_sk ORDER BY ca_state, sm_type, hd_income_band_sk;
SELECT sm_type, sm_carrier, t_shift, cd_gender, cd_marital_status, cd_education_status, AVG(cd_purchase_estimate) AS avg_purchase_estimate, COUNT(DISTINCT wr_refunded_customer_sk) AS count_distinct_refunded_customers, SUM(wr_return_quantity) AS total_return_quantity, SUM(wr_return_amt) AS total_return_amount, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(wr_net_loss) AS total_net_loss FROM web_returns JOIN ship_mode ON sm_ship_mode_sk = wr_item_sk JOIN time_dim ON t_time_sk = wr_returned_time_sk JOIN customer_demographics ON cd_demo_sk = wr_returning_cdemo_sk GROUP BY ROLLUP(sm_type, sm_carrier, t_shift, cd_gender, cd_marital_status, cd_education_status) ORDER BY sm_type, sm_carrier, t_shift, cd_gender, cd_marital_status, cd_education_status;
SELECT s.s_store_name, s.s_number_employees, AVG(ss.ss_sales_price) AS average_sale_amount, AVG(sr.sr_return_amt) AS average_return_amount, SUM(inv.inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions FROM store s LEFT JOIN store_sales ss ON s.s_store_sk = ss.ss_store_sk LEFT JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk AND ss.ss_item_sk = sr.sr_item_sk LEFT JOIN inventory inv ON ss.ss_item_sk = inv.inv_item_sk AND s.s_store_sk = inv.inv_warehouse_sk WHERE (ss.ss_sold_date_sk IS NOT NULL OR sr.sr_returned_date_sk IS NOT NULL) AND (ss.ss_item_sk IN (14547, 403, 14095, 8557) OR sr.sr_item_sk IN (14547, 403, 14095, 8557)) AND EXISTS ( SELECT 1 FROM household_demographics hd WHERE (ss.ss_hdemo_sk = hd.hd_demo_sk OR sr.sr_hdemo_sk = hd.hd_demo_sk) AND hd.hd_dep_count = 1 ) GROUP BY s.s_store_name, s.s_number_employees ORDER BY s.s_store_name;
SELECT d.d_year AS year, d.d_month_seq AS month_sequence, COUNT(DISTINCT ss.ss_store_sk) AS num_stores, SUM(ss.ss_quantity) AS total_items_sold, SUM(ss.ss_net_paid_inc_tax) AS total_sales_inc_tax, AVG(ss.ss_ext_discount_amt) AS average_discount, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_fee) AS average_return_fee, COUNT(DISTINCT cr.cr_call_center_sk) FILTER (WHERE cc.cc_class = 'small') AS num_small_class_call_centers, COUNT(DISTINCT cr.cr_call_center_sk) FILTER (WHERE cc.cc_class = 'medium') AS num_medium_class_call_centers, COUNT(DISTINCT cr.cr_call_center_sk) FILTER (WHERE cc.cc_class = 'large') AS num_large_class_call_centers FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk LEFT JOIN catalog_returns cr ON ss.ss_ticket_number = cr.cr_order_number LEFT JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk WHERE d.d_month_seq IS NOT NULL AND ss.ss_store_sk IS NOT NULL GROUP BY year, month_sequence ORDER BY year, month_sequence;
SELECT w_state, p_promo_id, p_discount_active, COUNT(DISTINCT cr_order_number) AS total_returns, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_quantity) AS total_returned_quantity, COUNT(DISTINCT sr_ticket_number) AS total_store_returns, SUM(sr_return_amt) AS total_store_return_amount, AVG(sr_return_amt) AS avg_store_return_amount, SUM(sr_return_quantity) AS total_store_returned_quantity FROM catalog_returns JOIN warehouse ON cr_warehouse_sk = w_warehouse_sk JOIN promotion ON cr_catalog_page_sk = p_promo_sk JOIN store_returns ON cr_item_sk = sr_item_sk AND cr_order_number = sr_ticket_number WHERE w_state = 'TN' AND p_promo_id = 'AAAAAAAAMKAAAAAA' AND p_discount_active = 'N' GROUP BY w_state, p_promo_id, p_discount_active ORDER BY total_return_amount DESC;
SELECT cp.cp_department, r.r_reason_desc, COUNT(DISTINCT cr.cr_order_number) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_quantity) AS avg_return_quantity, SUM(cr.cr_return_quantity) AS total_return_quantity, AVG(cr.cr_net_loss) AS avg_net_loss, SUM(cr.cr_net_loss) AS total_net_loss, AVG(ws.ws_net_paid_inc_ship_tax) AS avg_sale_amount_inc_ship_tax, SUM(ws.ws_net_paid_inc_ship_tax) AS total_sale_amount_inc_ship_tax FROM catalog_returns cr JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN web_sales ws ON cr.cr_item_sk = ws.ws_item_sk AND cr.cr_order_number = ws.ws_order_number JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk WHERE cp.cp_start_date_sk IS NOT NULL AND cp.cp_end_date_sk IS NOT NULL AND i.i_size IN ('large', 'petite', 'N/A') AND hd.hd_dep_count IN (6, 2, 0) AND hd.hd_income_band_sk IN (15, 14, 17, 18, 8) AND cr.cr_return_ship_cost IN (1215.68, 5.50, 311.58, 319.00, 3656.16, 1740.04) AND ws.ws_net_paid_inc_ship_tax = 1414.78 AND i.i_formulation IN ('ivory457370549352452', '77416linen1913860202', '32linen2899537977429', '61439655670steel4120') GROUP BY cp.cp_department, r.r_reason_desc ORDER BY total_return_amount DESC, avg_return_amount DESC, total_returns DESC;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, hd.hd_buy_potential, AVG(cr.cr_return_amt_inc_tax) AS avg_return_amount_inc_tax, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity FROM catalog_returns cr JOIN customer_demographics cd ON cr.cr_returning_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk JOIN store s ON cr.cr_returning_addr_sk = s.s_store_sk WHERE cd.cd_marital_status IN ('D', 'S') AND hd.hd_buy_potential IN ('5001-10000', '0-500', '501-1000', 'Unknown', '1001-5000') AND s.s_company_id = 1 GROUP BY ROLLUP(cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, hd.hd_buy_potential) ORDER BY total_returns DESC, avg_return_amount_inc_tax DESC;
SELECT i.i_category, i.i_brand, SUM(cs.cs_ext_sales_price) AS total_sales_value, AVG(cs.cs_ext_sales_price) AS avg_sales_value_per_item, COUNT(cs.cs_item_sk) AS items_sold_count, MAX(cs.cs_sales_price) AS max_item_sales_price, MIN(cs.cs_sales_price) AS min_item_sales_price FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN time_dim t ON cs.cs_sold_date_sk = t.t_time_sk WHERE cs.cs_ext_sales_price BETWEEN 500 AND 6000 AND t.t_time_id IN ('AAAAAAAACJABAAAA', 'AAAAAAAAHEAAAAAA', 'AAAAAAAAHKCAAAAA', 'AAAAAAAACNEAAAAA') GROUP BY ROLLUP(i.i_category, i.i_brand) HAVING SUM(cs.cs_ext_sales_price) > 1000 ORDER BY i.i_category, total_sales_value DESC, i.i_brand;
SELECT cc.cc_name, i.i_category, COUNT(i.i_item_sk) AS total_items_sold, SUM(i.i_current_price) AS total_sales, AVG(i.i_wholesale_cost) AS avg_wholesale_cost FROM call_center cc JOIN item i ON cc.cc_call_center_sk = i.i_manufact_id JOIN ship_mode sm ON sm.sm_ship_mode_sk = i.i_item_sk WHERE cc.cc_rec_end_date < '2000-12-31' AND i.i_category_id IN ('4', '5', '1', '3') AND sm.sm_code = 'AIR' GROUP BY cc.cc_name, i.i_category ORDER BY cc.cc_name, i.i_category;
SELECT d_year, SUM(cs_net_paid) AS total_sales, AVG(cs_net_profit) AS average_profit, COUNT(DISTINCT cs_bill_customer_sk) AS unique_customers, SUM(cr_return_amount) AS total_returns, AVG(cr_return_quantity) AS average_return_quantity, COUNT(DISTINCT cr_returning_customer_sk) AS unique_returning_customers FROM date_dim JOIN catalog_sales ON cs_sold_date_sk = d_date_sk JOIN catalog_returns ON cr_returned_date_sk = d_date_sk AND cs_order_number = cr_order_number WHERE d_year IN (2000, 2001, 2002) AND cs_ship_date_sk IS NOT NULL AND cr_returned_date_sk IS NOT NULL AND (cr_refunded_cdemo_sk IN ('719026', '1111847', '660009', '451051') OR cs_bill_cdemo_sk IN ('719026', '1111847', '660009', '451051')) AND cs_item_sk IN (SELECT inv_item_sk FROM inventory WHERE inv_quantity_on_hand > 100) GROUP BY d_year ORDER BY d_year;
SELECT dd.d_year, dd.d_quarter_name, SUM(i.inv_quantity_on_hand) AS total_quantity_on_hand, AVG(i.inv_quantity_on_hand) AS avg_quantity_on_hand, COUNT(DISTINCT i.inv_warehouse_sk) AS number_of_warehouses, COUNT(DISTINCT i.inv_item_sk) AS number_of_items, SUM(CASE WHEN dd.d_holiday = 'Y' THEN i.inv_quantity_on_hand ELSE 0 END) AS holiday_stock, SUM(CASE WHEN dd.d_weekend = 'Y' THEN i.inv_quantity_on_hand ELSE 0 END) AS weekend_stock, r.r_reason_desc, COUNT(*) FILTER (WHERE r.r_reason_sk IN (33, 17, 35, 12)) AS count_reasons FROM inventory i JOIN date_dim dd ON i.inv_date_sk = dd.d_date_sk LEFT JOIN reason r ON r.r_reason_sk IN (33, 17, 35, 12) WHERE dd.d_year = 2023 GROUP BY dd.d_year, dd.d_quarter_name, r.r_reason_desc ORDER BY dd.d_year, dd.d_quarter_name, r.r_reason_desc;
SELECT i.i_category, i.i_brand, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_tickets, SUM(ss.ss_quantity) AS total_items_sold, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_sales_profit, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_tickets, SUM(sr.sr_return_quantity) AS total_items_returned, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(sr.sr_net_loss) AS total_return_loss, AVG(hd.hd_dep_count) AS avg_dependency_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count FROM item i JOIN store_sales ss ON i.i_item_sk = ss.ss_item_sk LEFT JOIN store_returns sr ON i.i_item_sk = sr.sr_item_sk AND ss.ss_ticket_number = sr.sr_ticket_number LEFT JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk WHERE i.i_brand IN ('corpunivamalg #17', 'namelessnameless #4', 'brandmaxi #10', 'exportimaxi #7') AND i.i_size IN ('large', 'N/A') AND ss.ss_hdemo_sk IN (4195, 6112, 6478, 517, 450, 4114) AND ss.ss_net_paid BETWEEN 34.68 AND 1485.96 GROUP BY i.i_category, i.i_brand ORDER BY total_sales_profit DESC, total_return_loss ASC;
SELECT ca.ca_state, hd.hd_dep_count, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_profit) AS total_net_profit, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns FROM customer_address ca JOIN catalog_sales cs ON ca.ca_address_sk = cs.cs_bill_addr_sk JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk LEFT JOIN store_returns sr ON cs.cs_item_sk = sr.sr_item_sk AND cs.cs_order_number = sr.sr_ticket_number WHERE ca.ca_country = 'United States' AND (hd.hd_dep_count BETWEEN 0 AND 4 OR hd.hd_dep_count IN (6, 9)) AND cs.cs_bill_addr_sk IN (39103, 23918, 32261, 20802) AND cs.cs_bill_cdemo_sk = 625624 GROUP BY ca.ca_state, hd.hd_dep_count ORDER BY total_net_profit DESC, total_return_amount DESC;
SELECT d_year AS year, d_quarter_name AS quarter, sm_type AS shipping_type, p_promo_name AS promotion_name, COUNT(*) AS total_shipments, AVG(cd_purchase_estimate) AS average_purchase_estimate, SUM(p_cost) AS total_promotion_cost, COUNT(DISTINCT r_reason_sk) AS unique_reasons_count FROM date_dim JOIN promotion ON (d_date_sk = p_start_date_sk OR d_date_sk = p_end_date_sk) JOIN ship_mode ON sm_ship_mode_sk = 9 JOIN customer_demographics ON cd_credit_rating = 'Good' LEFT JOIN reason ON r_reason_desc IN ('Does not work with a product that I have', 'reason 32') WHERE d_year = 2023 AND sm_contract = 'O9V6oF8RJnLMmZYd1' AND p_discount_active = 'Y' GROUP BY year, quarter, shipping_type, promotion_name ORDER BY year, quarter, total_promotion_cost DESC;
SELECT p.p_promo_name, d_return.d_year AS return_year, d_return.d_quarter_name, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, SUM(cr.cr_return_amount) AS total_returned_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN date_dim d_return ON cr.cr_returned_date_sk = d_return.d_date_sk JOIN promotion p ON cr.cr_item_sk = p.p_item_sk JOIN date_dim d_start ON p.p_start_date_sk = d_start.d_date_sk JOIN date_dim d_end ON p.p_end_date_sk = d_end.d_date_sk WHERE cr.cr_call_center_sk IN ('2', '4') AND cr.cr_reason_sk IN ('11', '25') AND d_return.d_current_week = 'N' AND p.p_channel_tv = 'N' AND p.p_channel_radio = 'N' AND d_return.d_date BETWEEN d_start.d_date AND d_end.d_date GROUP BY p.p_promo_name, return_year, d_return.d_quarter_name ORDER BY total_returned_amount DESC, total_returns DESC, return_year, d_return.d_quarter_name;
SELECT s_store_name, sm_type, COUNT(DISTINCT ss_ticket_number) AS total_sales_transactions, SUM(ss_quantity) AS total_units_sold, SUM(ss_net_paid) AS total_revenue, AVG(ss_net_profit) AS average_profit_per_sale, SUM(wr_return_quantity) AS total_units_returned, SUM(wr_net_loss) AS total_loss_from_returns, (SUM(ss_net_paid) - SUM(wr_net_loss)) AS net_revenue_after_returns FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN ship_mode sm ON ss.ss_store_sk = sm.sm_ship_mode_sk LEFT JOIN web_returns wr ON ss.ss_item_sk = wr.wr_item_sk AND ss.ss_ticket_number = wr.wr_order_number WHERE ss_addr_sk IN ('39848', '37282') AND s_store_sk IN (5, 8, 1, 3, 6, 12) AND wr_returning_hdemo_sk IN (772, 5914) AND sm_ship_mode_sk IN (19, 20, 9) AND sm_carrier IN ('USPS', 'DHL', 'UPS') GROUP BY s_store_name, sm_type ORDER BY total_sales_transactions DESC;
SELECT cp.cp_department, COUNT(*) AS total_pages, AVG(wp.wp_link_count) AS average_link_count, SUM(wp.wp_image_count) AS total_image_count, COUNT(DISTINCT hd.hd_demo_sk) AS unique_households, AVG(hd.hd_vehicle_count) AS average_vehicle_count FROM catalog_page cp JOIN web_page wp ON cp.cp_catalog_page_sk = wp.wp_customer_sk JOIN household_demographics hd ON wp.wp_customer_sk = hd.hd_demo_sk WHERE cp.cp_catalog_number IN (29, 27, 21, 36) AND wp.wp_autogen_flag = 'Y' AND wp.wp_url LIKE 'http://www.foo.com%' GROUP BY cp.cp_department ORDER BY total_pages DESC, average_link_count DESC;
SELECT s_state, s_city, s_county, COUNT(DISTINCT s_store_sk) AS num_stores, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, SUM(ss_net_paid) AS total_net_paid, SUM(ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss_net_profit) AS total_net_profit, COUNT(DISTINCT ss_customer_sk) AS unique_customers, AVG(inv_quantity_on_hand) AS average_inventory_on_hand FROM store JOIN store_sales ON s_store_sk = ss_store_sk JOIN inventory ON ss_item_sk = inv_item_sk AND ss_store_sk = inv_warehouse_sk JOIN time_dim ON ss_sold_time_sk = t_time_sk WHERE inv_quantity_on_hand IN (553, 372, 818, 629, 791, 623) AND inv_warehouse_sk IN (1, 2) AND t_hour BETWEEN 9 AND 17 GROUP BY s_state, s_city, s_county ORDER BY s_state, s_city, s_county;
SELECT cc.cc_name, SUM(CASE WHEN p.p_channel_catalog = 'N' THEN p.p_cost ELSE 0 END) AS total_promotion_cost_catalog, AVG(i.i_current_price) AS average_item_price, COUNT(DISTINCT p.p_promo_sk) AS number_of_promotions, COUNT(DISTINCT i.i_item_sk) AS number_of_items_promoted, SUM(CASE WHEN cc.cc_hours = '8AM-4PM' THEN 1 ELSE 0 END) AS call_centers_8am_to_4pm, SUM(CASE WHEN cc.cc_hours = '8AM-8AM' THEN 1 ELSE 0 END) AS call_centers_24_hours FROM call_center cc JOIN promotion p ON cc.cc_call_center_sk = p.p_promo_sk JOIN item i ON p.p_item_sk = i.i_item_sk WHERE p.p_end_date_sk IN (2450406, 2450872, 2450915, 2450756, 2450513) AND cc.cc_hours IN ('8AM-4PM', '8AM-8AM') GROUP BY cc.cc_name ORDER BY total_promotion_cost_catalog DESC, average_item_price DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, hd.hd_buy_potential, hd.hd_dep_count, AVG(wr.wr_return_amt) AS avg_return_amount, AVG(wr.wr_return_tax) AS avg_return_tax, AVG(wr.wr_net_loss) AS avg_net_loss, COUNT(*) AS return_count FROM web_returns wr JOIN household_demographics hd ON wr.wr_returning_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN warehouse w ON wr.wr_returning_addr_sk = w.w_warehouse_sk WHERE w.w_city = 'Fairview' AND w.w_country = 'United States' AND hd.hd_buy_potential IN ('501-1000', '5001-10000', '0-500', '1001-5000', '>10000') GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, hd.hd_buy_potential, hd.hd_dep_count ORDER BY ib.ib_income_band_sk, hd.hd_buy_potential, hd.hd_dep_count;
SELECT dd.d_year, dd.d_quarter_name, i.i_category, sum(ss.ss_quantity) as total_quantity_sold, avg(ss.ss_sales_price) as avg_sales_price, sum(ss.ss_net_paid) as total_net_sales, sum(ss.ss_net_profit) as total_net_profit, count(distinct ss.ss_ticket_number) as total_sales_transactions, sum(wr.wr_return_quantity) as total_quantity_returned, sum(wr.wr_net_loss) as total_net_loss, count(distinct wr.wr_order_number) as total_return_transactions FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk LEFT JOIN web_returns wr ON ss.ss_item_sk = wr.wr_item_sk AND ss.ss_sold_date_sk = wr.wr_returned_date_sk GROUP BY dd.d_year, dd.d_quarter_name, i.i_category ORDER BY dd.d_year, dd.d_quarter_name, i.i_category;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, cd.cd_education_status, sum(cs.cs_quantity) as total_quantity_sold, avg(cs.cs_sales_price) as average_sales_price, count(distinct cs.cs_order_number) as number_of_orders, sum(cs.cs_net_profit) as total_net_profit FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE cd.cd_education_status IN ('College', 'Advanced Degree', '4 yr Degree') AND i.i_manager_id IN (69, 90) AND (cs.cs_sold_date_sk BETWEEN 2004001 AND 2004003 OR cs.cs_sold_date_sk BETWEEN 2004025 AND 2004028) AND (w.w_state = 'TN' OR w.w_country = 'United States') AND p.p_channel_email = 'Y' AND cs.cs_quantity >= 5 AND cs.cs_net_profit > 0 GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, cd.cd_education_status HAVING count(distinct cs.cs_order_number) > 1 ORDER BY total_net_profit DESC, number_of_orders DESC, cd.cd_education_status, c.c_last_name, c.c_first_name;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk WHERE cc.cc_market_manager IN ('Julius Durham', 'Matthew Clifton', 'Gary Colburn', 'Julius Tran') GROUP BY ROLLUP(cc.cc_name, cc.cc_city, cc.cc_state, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status) ORDER BY cc.cc_name, cc.cc_city, cc.cc_state, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status;
SELECT p.p_channel_dmail AS promo_channel_direct_mail, p.p_channel_email AS promo_channel_email, p.p_channel_catalog AS promo_channel_catalog, p.p_channel_tv AS promo_channel_tv, p.p_channel_radio AS promo_channel_radio, p.p_channel_press AS promo_channel_press, p.p_channel_event AS promo_channel_event, p.p_channel_demo AS promo_channel_demo, COUNT(p.p_promo_sk) AS num_promotions, SUM(p.p_cost) AS total_promo_cost, AVG(p.p_cost) AS avg_promo_cost, SUM(i.inv_quantity_on_hand) AS total_inventory_qty FROM promotion p LEFT JOIN inventory i ON p.p_item_sk = i.inv_item_sk WHERE p.p_discount_active = '1' GROUP BY promo_channel_direct_mail, promo_channel_email, promo_channel_catalog, promo_channel_tv, promo_channel_radio, promo_channel_press, promo_channel_event, promo_channel_demo ORDER BY num_promotions DESC, total_promo_cost DESC;
SELECT r.r_reason_desc, COUNT(*) AS total_returns, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_amt) AS average_return_amount, SUM(sr_return_quantity) AS total_returned_quantity, SUM(sr_fee) AS total_return_fees, SUM(sr_net_loss) AS total_net_loss FROM store_returns sr JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE sr.sr_return_amt > 0 AND r.r_reason_desc IN ('reason 26', 'reason 34', 'Did not fit', 'Not the product that was ordred') GROUP BY r.r_reason_desc ORDER BY total_return_amount DESC;
SELECT reason.r_reason_desc AS Return_Reason, COUNT(DISTINCT web_returns.wr_order_number) AS Total_Returns, SUM(web_returns.wr_return_amt) AS Total_Return_Amount, AVG(web_returns.wr_return_amt) AS Average_Return_Amount, promotion.p_promo_name AS Promotion_Name, COUNT(DISTINCT promotion.p_promo_sk) AS Total_Promotions_Affected, ship_mode.sm_type AS Shipping_Type, COUNT(DISTINCT ship_mode.sm_ship_mode_sk) AS Total_Shipping_Modes_Used FROM web_returns JOIN reason ON web_returns.wr_reason_sk = reason.r_reason_sk LEFT JOIN promotion ON web_returns.wr_item_sk = promotion.p_item_sk JOIN web_page ON web_returns.wr_web_page_sk = web_page.wp_web_page_sk JOIN ship_mode ON web_returns.wr_order_number = ship_mode.sm_ship_mode_sk WHERE web_returns.wr_return_amt > 0 AND reason.r_reason_desc IN ('No service location in my area', 'Did not like the warranty', 'Stopped working') AND web_page.wp_link_count BETWEEN 15 AND 24 GROUP BY Return_Reason, Promotion_Name, Shipping_Type ORDER BY Total_Returns DESC, Total_Return_Amount DESC;
SELECT ca.ca_state, sm.sm_type, ws.ws_web_site_sk, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN customer_address ca ON ws.ws_ship_addr_sk = ca.ca_address_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk WHERE ca.ca_state IN ('CT', 'SD') AND sm.sm_type = 'OVERNIGHT' AND ws.ws_web_site_sk IN (SELECT web_site_sk FROM web_site WHERE web_market_manager = 'John Doe') AND dd.d_year = 2023 AND dd.d_moy BETWEEN 1 AND 6 GROUP BY ca.ca_state, sm.sm_type, ws.ws_web_site_sk ORDER BY total_net_profit DESC;
SELECT ca_state, ca_county, COUNT(DISTINCT c_customer_sk) AS total_customers, COUNT(DISTINCT ws_order_number) AS total_web_orders, SUM(ws_net_paid) AS total_web_sales, SUM(ws_net_profit) AS total_web_profit, COUNT(DISTINCT sr_ticket_number) AS total_returns, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_quantity) AS average_return_quantity, r_reason_desc FROM customer JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN web_sales ON ws_bill_customer_sk = c_customer_sk LEFT JOIN store_returns ON sr_customer_sk = c_customer_sk AND sr_reason_sk IS NOT NULL LEFT JOIN reason ON sr_reason_sk = r_reason_sk JOIN time_dim ON ws_sold_time_sk = t_time_sk JOIN warehouse ON ws_warehouse_sk = w_warehouse_sk WHERE ca_state IN ('CA', 'TX') AND ((t_hour = '1' AND t_am_pm = 'AM') OR (t_hour = '0')) AND (w_street_number IN ('534', '368', '651', '600')) AND (r_reason_id = 'AAAAAAAANAAAAAAA' OR r_reason_id IS NULL) GROUP BY ca_state, ca_county, r_reason_desc ORDER BY total_web_sales DESC, ca_state, ca_county;
SELECT i_category, i_class, w_city, p_promo_name, SUM(ws_quantity) AS total_quantity_sold, AVG(ws_sales_price) AS average_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_paid_inc_tax) AS total_net_paid_inc_tax, COUNT(DISTINCT ws_order_number) AS total_orders, COUNT(DISTINCT ws_bill_cdemo_sk) AS total_unique_customers FROM web_sales JOIN item ON ws_item_sk = i_item_sk JOIN warehouse ON ws_warehouse_sk = w_warehouse_sk JOIN promotion ON ws_promo_sk = p_promo_sk JOIN customer_demographics ON ws_bill_cdemo_sk = cd_demo_sk WHERE w_city = 'Fairview' AND p_cost = 1000.00 AND p_channel_demo = 'N' GROUP BY i_category, i_class, w_city, p_promo_name ORDER BY total_net_paid DESC, total_quantity_sold DESC;
SELECT d_year, cd_gender, cd_marital_status, cd_education_status, ib_lower_bound, ib_upper_bound, COUNT(DISTINCT c_customer_sk) AS num_customers, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_net_profit) AS total_net_profit, SUM(wr_return_quantity) AS total_quantity_returned, AVG(wr_return_amt) AS avg_return_amount, SUM(inv_quantity_on_hand) AS total_inventory_quantity FROM date_dim JOIN catalog_sales ON (date_dim.d_date_sk = catalog_sales.cs_sold_date_sk) JOIN customer ON (catalog_sales.cs_bill_customer_sk = customer.c_customer_sk) JOIN customer_demographics ON (customer.c_current_cdemo_sk = customer_demographics.cd_demo_sk) JOIN income_band ON (customer_demographics.cd_purchase_estimate BETWEEN income_band.ib_lower_bound AND income_band.ib_upper_bound) LEFT JOIN web_returns ON (catalog_sales.cs_item_sk = web_returns.wr_item_sk AND catalog_sales.cs_order_number = web_returns.wr_order_number) LEFT JOIN inventory ON (catalog_sales.cs_item_sk = inventory.inv_item_sk AND date_dim.d_date_sk = inventory.inv_date_sk) WHERE cd_gender IN ('M', 'F') AND cd_marital_status IN ('M', 'U') AND cd_education_status IN ('4 yr Degree', '2 yr Degree') AND d_year IN (2001, 2002, 2003) AND d_moy BETWEEN 1 AND 6 AND ib_income_band_sk IN (1, 2, 3) AND d_current_year = 'N' GROUP BY d_year, cd_gender, cd_marital_status, cd_education_status, ib_lower_bound, ib_upper_bound ORDER BY d_year, cd_gender, cd_marital_status, cd_education_status, ib_lower_bound, ib_upper_bound;
SELECT s_state, s_city, COUNT(DISTINCT s_store_sk) AS num_stores, SUM(inv_quantity_on_hand) AS total_inventory, AVG(cd_purchase_estimate) AS avg_purchase_estimate, COUNT(DISTINCT wp_web_page_sk) AS num_web_pages, SUM(wp_link_count) AS total_link_count, COUNT(CASE WHEN cd_credit_rating = 'High Risk' THEN 1 END) AS high_risk_customers, COUNT(CASE WHEN cd_credit_rating = 'Low Risk' THEN 1 END) AS low_risk_customers, AVG(cd_dep_count) AS avg_dep_count, SUM(cd_dep_employed_count) AS total_dep_employed_count, AVG(s_number_employees) AS avg_store_employees, AVG(s_floor_space) AS avg_store_floor_space FROM store LEFT JOIN inventory ON s_store_sk = inv_warehouse_sk LEFT JOIN customer_demographics ON s_market_id = cd_demo_sk LEFT JOIN web_page ON s_store_sk = wp_customer_sk WHERE s_rec_end_date IS NULL AND wp_char_count IN (1147, 1711, 6577) AND inv_quantity_on_hand IN (505, 375, 593, 141, 402, 949) AND s_suite_number IN ('Suite D', 'Suite 80', 'Suite 190', 'Suite 100') AND s_division_name = 'Unknown' AND cd_dep_employed_count = 0 AND cd_credit_rating IN ('High Risk', 'Low Risk', 'Good', 'Unknown') GROUP BY s_state, s_city ORDER BY s_state, s_city;
SELECT s.s_store_name, s.s_city, s.s_state, p.p_promo_name, p.p_channel_details, SUM(wr.wr_return_amt) AS total_refund_amount, AVG(wr.wr_fee) AS average_fee, COUNT(DISTINCT wr.wr_returned_date_sk) AS unique_return_days, COUNT(*) AS total_returns, cd.cd_gender, cd.cd_education_status, COUNT(DISTINCT cd.cd_demo_sk) AS unique_customers FROM web_returns wr JOIN store s ON wr.wr_returning_addr_sk = s.s_store_sk JOIN promotion p ON wr.wr_item_sk = p.p_item_sk JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk WHERE s.s_tax_precentage = '0.01' AND s.s_gmt_offset = '-5.00' AND p.p_discount_active = 'N' AND wr.wr_refunded_cdemo_sk IN ('991117', '972552', '90047') AND wr.wr_returning_addr_sk IN ('33543', '41829') GROUP BY s.s_store_name, s.s_city, s.s_state, p.p_promo_name, p.p_channel_details, cd.cd_gender, cd.cd_education_status ORDER BY total_refund_amount DESC, unique_return_days DESC;
SELECT dd.d_year, dd.d_quarter_name, SUM(cs.cs_net_paid_inc_ship_tax) AS total_sales, AVG(cs.cs_net_paid_inc_ship_tax) AS avg_sales, COUNT(*) AS number_of_sales, SUM(cr.cr_return_amt_inc_tax) AS total_returns, AVG(cr.cr_return_amt_inc_tax) AS avg_returns, COUNT(cr.cr_order_number) AS number_of_returns, SUM(hd.hd_dep_count) AS total_dependants, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_size FROM date_dim dd LEFT JOIN catalog_sales cs ON dd.d_date_sk = cs.cs_sold_date_sk LEFT JOIN catalog_returns cr ON dd.d_date_sk = cr.cr_returned_date_sk LEFT JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk LEFT JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk WHERE dd.d_year = 1999 AND (cs.cs_net_paid_inc_ship_tax > 1000 OR cr.cr_return_amt_inc_tax > 100) AND hd.hd_buy_potential = '1001-5000' AND hd.hd_dep_count BETWEEN 4 AND 9 AND cr.cr_ship_mode_sk IN (4, 7) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT c.c_salutation, sm.sm_type AS shipping_type, AVG(cs.cs_net_paid) AS average_net_paid, SUM(cs.cs_quantity) AS total_quantity_sold, COUNT(DISTINCT cs.cs_order_number) AS total_orders, ca.ca_state AS customer_state, ca.ca_country AS customer_country, COUNT(DISTINCT ca.ca_city) AS number_of_cities_sold_to FROM catalog_sales cs JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk WHERE cs.cs_ext_sales_price > 2500 AND sm.sm_ship_mode_id = 'AAAAAAAAGAAAAAAA' AND c.c_salutation = 'Mr.' GROUP BY c.c_salutation, sm.sm_type, ca.ca_state, ca.ca_country ORDER BY average_net_paid DESC, total_quantity_sold DESC;
SELECT d_year, i_category, COUNT(DISTINCT c_customer_sk) AS total_customers, SUM(cr_return_quantity) AS total_returned_quantity, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_amount) AS total_return_amount, SUM(cr_fee) AS total_fees, AVG(i_current_price) AS avg_item_price, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns JOIN date_dim ON cr_returned_date_sk = d_date_sk JOIN customer ON cr_returning_customer_sk = c_customer_sk JOIN item ON cr_item_sk = i_item_sk WHERE cr_return_quantity = 2 GROUP BY d_year, i_category ORDER BY total_return_amount DESC, total_net_loss DESC LIMIT 100;
SELECT d.d_year, d.d_quarter_name, sum(ws_net_paid) AS total_sales, avg(ws_quantity) AS average_quantity_sold, count(distinct ws_order_number) AS total_orders, count(distinct ws_item_sk) AS unique_items_sold, sum(ws_net_profit) AS total_profit FROM web_sales ws INNER JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk INNER JOIN item i ON ws.ws_item_sk = i.i_item_sk INNER JOIN call_center cc ON cc.cc_division_name LIKE 'pri%' AND cc.cc_country = 'United States' WHERE d.d_year = 2000 AND i.i_rec_start_date BETWEEN '1999-10-28' AND '2001-10-27' AND i.i_manufact = 'ationationable' AND ws.ws_bill_cdemo_sk IN ('371058', '1268921') GROUP BY d.d_year, d.d_quarter_name ORDER BY total_sales DESC, d.d_quarter_name;
SELECT r.r_reason_desc, COUNT(DISTINCT sr.sr_ticket_number) AS num_store_returns, SUM(sr.sr_refunded_cash) AS total_store_refunded, AVG(sr.sr_return_amt_inc_tax) AS avg_store_return, COUNT(DISTINCT cr.cr_order_number) AS num_catalog_returns, SUM(cr.cr_refunded_cash) AS total_catalog_refunded, AVG(cr.cr_return_amt_inc_tax) AS avg_catalog_return FROM store_returns sr FULL OUTER JOIN catalog_returns cr ON sr.sr_reason_sk = cr.cr_reason_sk JOIN reason r ON r.r_reason_sk = sr.sr_reason_sk OR r.r_reason_sk = cr.cr_reason_sk LEFT JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk WHERE (sr.sr_customer_sk IN (67809, 3762, 6067) OR cr.cr_returning_hdemo_sk IN (6684, 3972, 3528, 1943, 4100, 4193)) AND (r.r_reason_id IN ('AAAAAAAANBAAAAAA', 'AAAAAAAADCAAAAAA', 'AAAAAAAAACAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAAFBAAAAAA', 'AAAAAAAAOBAAAAAA')) AND w.w_street_number = '651' AND w.w_county = 'Williamson County' GROUP BY r.r_reason_desc ORDER BY total_store_refunded DESC, total_catalog_refunded DESC;
SELECT i_category, w_state, COUNT(DISTINCT ws_order_number) AS web_sales_orders, SUM(ws_net_paid) AS total_web_sales_revenue, AVG(ws_quantity) AS avg_web_sales_quantity, SUM(sr_return_amt) AS total_store_returns, AVG(sr_return_quantity) AS avg_store_return_quantity, COUNT(DISTINCT sr_ticket_number) AS store_return_tickets, SUM(cr_return_amount) AS total_catalog_returns, AVG(cr_return_quantity) AS avg_catalog_return_quantity, COUNT(DISTINCT cr_order_number) AS catalog_return_orders FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk LEFT JOIN store_returns sr ON ws.ws_item_sk = sr.sr_item_sk AND ws.ws_order_number = sr.sr_ticket_number LEFT JOIN catalog_returns cr ON ws.ws_item_sk = cr.cr_item_sk AND ws.ws_order_number = cr.cr_order_number WHERE ws.ws_sold_date_sk BETWEEN 20000101 AND 20001231 AND ws.ws_ext_list_price IN ('3366.00', '12.38', '298.41') AND EXISTS ( SELECT 1 FROM inventory WHERE ws.ws_item_sk = inv_item_sk AND inv_warehouse_sk = ws.ws_warehouse_sk AND inv_date_sk BETWEEN 20000101 AND 20001231 AND inv_quantity_on_hand > 0 ) GROUP BY i_category, w_state ORDER BY i_category, w_state;
SELECT i.i_category, r.r_reason_desc, COUNT(*) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_quantity) AS total_return_quantity, AVG(cr.cr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_customers_returned, COUNT(DISTINCT ss.ss_store_sk) AS stores_involved, SUM(ss.ss_sales_price) AS total_sales_amount, AVG(ss.ss_sales_price) AS average_sales_price FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk LEFT JOIN store_sales ss ON cr.cr_item_sk = ss.ss_item_sk AND cr.cr_order_number = ss.ss_ticket_number WHERE i.i_size IN ('medium', 'large') AND (cr.cr_returned_date_sk BETWEEN 19990101 AND 19991231 OR cr.cr_returned_date_sk IS NULL) AND i.i_rec_end_date > '2000-01-01' GROUP BY i.i_category, r.r_reason_desc ORDER BY total_return_amount DESC, total_returns DESC LIMIT 10;
SELECT p.p_promo_id, p.p_promo_name, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_tickets, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_ext_discount_amt) AS avg_ticket_discount, SUM(ss.ss_net_paid) AS total_net_sales, SUM(ss.ss_net_profit) AS total_net_profit, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, CASE WHEN hd.hd_buy_potential = '0-500' THEN 'Low' WHEN hd.hd_buy_potential = '501-1000' THEN 'Below Average' WHEN hd.hd_buy_potential = '1001-5000' THEN 'Average' WHEN hd.hd_buy_potential = '5001-10000' THEN 'Above Average' WHEN hd.hd_buy_potential = '>10000' THEN 'High' ELSE 'Unknown' END AS avg_buy_potential, COUNT(DISTINCT hd.hd_income_band_sk) AS distinct_income_bands FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk LEFT JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk GROUP BY p.p_promo_id, p.p_promo_name, hd.hd_buy_potential ORDER BY total_net_sales DESC, total_net_profit DESC;
SELECT hd.hd_demo_sk, COUNT(DISTINCT ws.ws_order_number) AS total_orders, AVG(ws.ws_quantity) AS average_quantity, SUM(ws.ws_net_paid) AS total_net_paid, AVG(ws.ws_net_profit) AS average_net_profit, COUNT(DISTINCT CASE WHEN p.p_channel_press = 'N' THEN ws.ws_order_number END) AS non_press_promo_orders FROM household_demographics hd JOIN web_sales ws ON hd.hd_demo_sk = ws.ws_bill_hdemo_sk JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk JOIN time_dim t ON ws.ws_sold_time_sk = t.t_time_sk WHERE hd.hd_income_band_sk IS NOT NULL AND p.p_promo_name IS NOT NULL AND t.t_am_pm IS NOT NULL AND ws.ws_net_paid > 0 AND ws.ws_sales_price BETWEEN 1000 AND 4000 GROUP BY hd.hd_demo_sk HAVING COUNT(DISTINCT ws.ws_order_number) > 5 ORDER BY total_net_paid DESC, total_orders DESC LIMIT 10;
SELECT ws_site.web_site_id, i.i_category, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, SUM(ws.ws_net_paid) AS total_revenue, SUM(ws.ws_net_profit) AS total_profit, AVG(ws.ws_net_paid_inc_tax) AS average_revenue_inc_tax, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_amt_inc_tax) AS average_return_amount_inc_tax, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT hd.hd_demo_sk) AS count_households, AVG(hd.hd_vehicle_count) AS average_vehicles_per_household FROM web_sales ws INNER JOIN web_site ws_site ON ws.ws_web_site_sk = ws_site.web_site_sk INNER JOIN item i ON ws.ws_item_sk = i.i_item_sk LEFT JOIN store_returns sr ON ws.ws_item_sk = sr.sr_item_sk AND ws.ws_order_number = sr.sr_ticket_number INNER JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk INNER JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE ws.ws_sales_price BETWEEN 50 AND 200 AND ib.ib_income_band_sk IN (1, 7, 5, 16, 19) GROUP BY ws_site.web_site_id, i.i_category, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_revenue DESC;
SELECT r.r_reason_desc AS reason_for_return, COUNT(*) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, cd.cd_gender AS customer_gender, cd.cd_education_status AS customer_education, w.w_warehouse_name AS warehouse_name, w.w_city AS warehouse_city, w.w_state AS warehouse_state FROM catalog_returns cr JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN customer_demographics cd ON cr.cr_returning_cdemo_sk = cd.cd_demo_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk GROUP BY r.r_reason_desc, cd.cd_gender, cd.cd_education_status, w.w_warehouse_name, w.w_city, w.w_state ORDER BY total_returns DESC, total_return_amount DESC LIMIT 100;
SELECT d_year, d_quarter_name, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN date_dim ON catalog_sales.cs_sold_date_sk = date_dim.d_date_sk JOIN customer ON catalog_sales.cs_bill_customer_sk = customer.c_customer_sk JOIN warehouse ON catalog_sales.cs_warehouse_sk = warehouse.w_warehouse_sk WHERE d_year = 2003 AND d_quarter_seq IN (1, 27, 15, 31, 53, 21) AND c_birth_country = 'United States' AND w_country = 'United States' GROUP BY d_year, d_quarter_name ORDER BY d_year, d_quarter_name;
SELECT ca_state, ca_city, SUM(ws_quantity) AS total_quantity_sold, AVG(ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws_order_number) AS number_of_orders, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_profit) AS total_net_profit FROM web_sales JOIN customer_address ON web_sales.ws_ship_addr_sk = customer_address.ca_address_sk JOIN inventory ON web_sales.ws_item_sk = inventory.inv_item_sk WHERE web_sales.ws_web_site_sk IN ('16', '29', '24', '23', '3') AND inventory.inv_warehouse_sk IN ('1', '2') AND inventory.inv_item_sk IN ('9766', '15184', '10474', '14785', '12391') GROUP BY ca_state, ca_city ORDER BY total_net_profit DESC, total_quantity_sold DESC LIMIT 100;
SELECT s.s_store_name, i.i_brand, i.i_category, dd.d_year, SUM(s.s_number_employees) AS total_number_employees, AVG(i.i_current_price) AS average_price, COUNT(DISTINCT h.hd_demo_sk) AS unique_household_count, SUM(CASE WHEN dd.d_holiday = 'Y' THEN 1 ELSE 0 END) AS holiday_count, SUM(CASE WHEN dd.d_weekend = 'Y' THEN 1 ELSE 0 END) AS weekend_count FROM store s JOIN item i ON s.s_store_sk = i.i_manufact_id JOIN date_dim dd ON s.s_closed_date_sk = dd.d_date_sk JOIN household_demographics h ON h.hd_income_band_sk = s.s_market_id JOIN time_dim t ON t.t_time_sk = dd.d_date_sk WHERE s.s_store_sk IN (11, 9, 5, 3) AND i.i_item_id IN ('AAAAAAAAGPIAAAAA', 'AAAAAAAAOFKAAAAA', 'AAAAAAAAKJEAAAAA', 'AAAAAAAAMLJAAAAA', 'AAAAAAAANPCBAAAA', 'AAAAAAAAEBGAAAAA') AND i.i_brand_id IN (6004005, 7004007) AND dd.d_current_year = 'N' AND dd.d_last_dom IN (2418367, 2415812, 2418122) AND t.t_hour IN (1, 0) GROUP BY s.s_store_name, i.i_brand, i.i_category, dd.d_year;
SELECT ca_state, cd_gender, cd_marital_status, cd_education_status, AVG(cd_purchase_estimate) AS avg_purchase_estimate, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_net_paid, SUM(ss_net_profit) AS total_net_profit FROM store_sales JOIN customer_address ON store_sales.ss_addr_sk = customer_address.ca_address_sk JOIN customer_demographics ON store_sales.ss_cdemo_sk = customer_demographics.cd_demo_sk WHERE ca_zip IN ('22562', '41934', '39101', '43301', '36549') GROUP BY ca_state, cd_gender, cd_marital_status, cd_education_status ORDER BY ca_state, cd_gender, cd_marital_status, cd_education_status;
SELECT i_category, i_class, COUNT(DISTINCT i_item_sk) AS item_count, AVG(i_current_price) AS avg_current_price, SUM(sr_return_quantity) AS total_return_quantity, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_amt) AS avg_return_amount, w_state, ca_state, sm_type, COUNT(DISTINCT sr_ticket_number) AS total_returns FROM store_returns JOIN item ON sr_item_sk = i_item_sk JOIN warehouse ON sr_store_sk = w_warehouse_sk JOIN customer_address ON sr_addr_sk = ca_address_sk JOIN ship_mode ON sr_return_time_sk::text LIKE sm_ship_mode_id WHERE sr_returned_date_sk IS NOT NULL AND i_rec_start_date <= CURRENT_DATE AND (i_rec_end_date IS NULL OR i_rec_end_date > CURRENT_DATE) AND w_gmt_offset = '-5.00' AND w_zip = '35709' AND i_manufact IN ('oughtoughtese', 'eingbarought', 'eseation') AND sr_return_time_sk IN (37755, 53252) GROUP BY i_category, i_class, w_state, ca_state, sm_type ORDER BY total_return_amount DESC, total_return_quantity DESC;
SELECT cp.cp_department, ca.ca_city, ca.ca_state, COUNT(wr.wr_item_sk) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_including_tax, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_return_ship_cost) AS total_shipping_cost, SUM(wr.wr_net_loss) AS total_net_loss FROM catalog_page cp JOIN web_returns wr ON cp.cp_catalog_page_sk = wr.wr_web_page_sk JOIN customer_address ca ON wr.wr_returning_addr_sk = ca.ca_address_sk WHERE cp.cp_catalog_page_id IN ('AAAAAAAAPOGAAAAA', 'AAAAAAAABBCAAAAA', 'AAAAAAAAGGCAAAAA') AND ca.ca_location_type IN ('single family', 'apartment', 'condo') GROUP BY cp.cp_department, ca.ca_city, ca.ca_state ORDER BY total_net_loss DESC, average_return_amount DESC LIMIT 100;
SELECT cc.cc_name, ca.ca_state, sum(ss.ss_quantity) AS total_quantity_sold, avg(ss.ss_sales_price) AS average_sales_price, count(DISTINCT sr.sr_ticket_number) AS total_returns, sum(sr.sr_return_amt) AS total_return_amount, sum(sr.sr_fee) AS total_return_fees, sum(ws.ws_net_paid_inc_ship_tax) AS total_web_sales_incl_ship_tax, sum(ws.ws_net_profit) AS total_web_profit FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number JOIN web_sales ws ON cc.cc_call_center_sk = ws.ws_warehouse_sk JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk WHERE cc.cc_company IN ('1', '2', '3') AND sr.sr_return_ship_cost IN (174.24, 2574.09, 3006.72) AND ca.ca_state IN ('CA', 'TX', 'NY') GROUP BY cc.cc_name, ca.ca_state ORDER BY total_return_amount DESC, total_web_profit DESC LIMIT 100;
SELECT ca.ca_county, ca.ca_state, w.w_warehouse_name, hd.hd_income_band_sk, SUM(inv.inv_quantity_on_hand) AS total_quantity_on_hand, AVG(hd.hd_dep_count) AS average_dependency_count, AVG(hd.hd_vehicle_count) AS average_vehicle_count, COUNT(DISTINCT ca.ca_address_sk) AS total_addresses, COUNT(DISTINCT hd.hd_demo_sk) AS total_households FROM inventory inv JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN customer_address ca ON ca.ca_state = w.w_state JOIN household_demographics hd ON ca.ca_zip = w.w_zip WHERE ca.ca_county = 'Jeff Davis County' AND (ca.ca_zip = '78482' OR ca.ca_zip = '48054') AND (inv.inv_warehouse_sk = 1 OR inv.inv_warehouse_sk = 2) AND (inv.inv_item_sk IN (7786, 9218, 15079, 13832, 11164)) GROUP BY ca.ca_county, ca.ca_state, w.w_warehouse_name, hd.hd_income_band_sk ORDER BY ca.ca_county, ca.ca_state, w.w_warehouse_name, hd.hd_income_band_sk;
SELECT ss.ss_item_sk AS item_sku, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid_inc_tax) AS total_sales_inc_tax, AVG(ss.ss_ext_discount_amt) AS avg_discount_amt, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(wr.wr_return_quantity) AS total_quantity_returned, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(wr.wr_net_loss) AS total_net_loss_from_returns, SUM(ws.ws_net_profit) AS total_net_profit_from_web_sales FROM store_sales ss LEFT JOIN web_returns wr ON ss.ss_item_sk = wr.wr_item_sk AND ss.ss_ticket_number = wr.wr_order_number LEFT JOIN web_sales ws ON ss.ss_item_sk = ws.ws_item_sk AND ss.ss_ticket_number = ws.ws_order_number GROUP BY ss.ss_item_sk ORDER BY total_net_profit_from_web_sales DESC;
SELECT ca_state, cp_department, p_promo_name, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(ss_net_paid) AS total_net_paid, SUM(ss_net_profit) AS total_net_profit FROM store_sales JOIN promotion ON ss_promo_sk = p_promo_sk JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN catalog_page ON ss_item_sk = cp_catalog_page_sk WHERE p_end_date_sk IN ('2450360', '2450791', '2450178', '2450468', '2450825') GROUP BY ca_state, cp_department, p_promo_name ORDER BY ca_state, cp_department, p_promo_name;
SELECT c.cp_department AS department, i.i_category AS category, COUNT(DISTINCT c.cp_catalog_page_sk) AS num_catalog_pages, COUNT(DISTINCT i.i_item_sk) AS num_items, AVG(i.i_current_price) AS avg_current_price, SUM(i.i_wholesale_cost * i.i_units::int) AS total_wholesale_cost, w.web_name AS website_name, COUNT(DISTINCT w.web_site_sk) AS num_websites, AVG(w.web_tax_percentage) AS avg_tax_percentage FROM catalog_page c JOIN item i ON c.cp_catalog_page_sk = i.i_item_sk JOIN web_site w ON c.cp_department = w.web_class WHERE i.i_category IN ('Shoes', 'Home') AND i.i_rec_start_date <= CURRENT_DATE AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date > CURRENT_DATE) AND w.web_rec_start_date <= CURRENT_DATE AND (w.web_rec_end_date IS NULL OR w.web_rec_end_date > CURRENT_DATE) GROUP BY c.cp_department, i.i_category, w.web_name ORDER BY department, category, website_name;
SELECT s.s_division_name, AVG(s.s_floor_space) AS avg_floor_space, AVG(s.s_number_employees) AS avg_number_employees, AVG(ib.ib_upper_bound) AS avg_income_upper_bound, COUNT(wp.wp_web_page_sk) AS web_page_count, SUM(wp.wp_image_count) AS total_image_count, SUM(wp.wp_link_count) AS total_link_count FROM store AS s INNER JOIN income_band AS ib ON s.s_store_sk = ib.ib_income_band_sk LEFT JOIN web_page AS wp ON wp.wp_customer_sk = s.s_store_sk WHERE s.s_rec_start_date >= '2020-01-01' AND (s.s_rec_end_date IS NULL OR s.s_rec_end_date <= '2023-01-01') AND ib.ib_upper_bound BETWEEN 60000 AND 190000 AND wp.wp_type = 'monthly' GROUP BY s.s_division_name ORDER BY avg_floor_space DESC, avg_number_employees DESC;
SELECT dd.d_year, dd.d_quarter_name, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS avg_return_amt, COUNT(DISTINCT sr.sr_customer_sk) AS unique_customers, COUNT(DISTINCT hd.hd_demo_sk) AS unique_households, r.r_reason_desc, COUNT(*) AS return_instances, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN date_dim dd ON sr.sr_returned_date_sk = dd.d_date_sk LEFT JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk LEFT JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE dd.d_fy_year BETWEEN 1907 AND 1913 GROUP BY dd.d_year, dd.d_quarter_name, r.r_reason_desc ORDER BY dd.d_year, total_returned_quantity DESC, avg_return_amt DESC;
SELECT ws.ws_web_site_sk, web.web_name, COUNT(ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit, SUM(cr.cr_net_loss) AS total_net_loss, (SUM(ws.ws_net_profit) - SUM(cr.cr_net_loss)) AS net_gain_loss, COUNT(DISTINCT ws.ws_bill_customer_sk) AS unique_customers, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_returning_customers, COUNT(DISTINCT cr.cr_item_sk) AS unique_returned_items, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk LEFT JOIN catalog_returns cr ON ws.ws_order_number = cr.cr_order_number AND ws.ws_item_sk = cr.cr_item_sk WHERE web.web_county = 'Williamson County' AND (web.web_rec_end_date = '2000-08-15' OR web.web_rec_end_date = '1999-08-16') AND (ws.ws_ext_sales_price = 1271.34 OR ws.ws_ext_sales_price = 2832.48 OR ws.ws_ext_sales_price = 205.59 OR ws.ws_ext_sales_price = 4175.82 OR ws.ws_ext_sales_price = 885.30) GROUP BY ws.ws_web_site_sk, web.web_name ORDER BY net_gain_loss DESC;
SELECT ca.ca_state AS customer_state, SUM(CASE WHEN dd.d_year = 2022 THEN ss.ss_net_paid ELSE 0 END) AS total_sales_2022, SUM(CASE WHEN dd.d_year = 2022 THEN sr.sr_return_amt ELSE 0 END) AS total_returns_2022, COUNT(DISTINCT CASE WHEN dd.d_year = 2022 THEN ss.ss_ticket_number ELSE NULL END) AS sales_transactions_2022, COUNT(DISTINCT CASE WHEN dd.d_year = 2022 THEN sr.sr_ticket_number ELSE NULL END) AS return_transactions_2022, SUM(CASE WHEN dd.d_year = 2023 THEN ss.ss_net_paid ELSE 0 END) AS total_sales_2023, SUM(CASE WHEN dd.d_year = 2023 THEN sr.sr_return_amt ELSE 0 END) AS total_returns_2023, COUNT(DISTINCT CASE WHEN dd.d_year = 2023 THEN ss.ss_ticket_number ELSE NULL END) AS sales_transactions_2023, COUNT(DISTINCT CASE WHEN dd.d_year = 2023 THEN sr.sr_ticket_number ELSE NULL END) AS return_transactions_2023 FROM store_sales ss FULL OUTER JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk JOIN date_dim dd ON (ss.ss_sold_date_sk = dd.d_date_sk OR sr.sr_returned_date_sk = dd.d_date_sk) LEFT JOIN customer_address ca ON (ss.ss_addr_sk = ca.ca_address_sk OR sr.sr_addr_sk = ca.ca_address_sk) WHERE dd.d_year IN (2022, 2023) GROUP BY ca.ca_state ORDER BY ca.ca_state;
SELECT i.i_category AS item_category, COUNT(DISTINCT i.i_item_sk) AS unique_items_sold, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid) AS total_sales, AVG(ws.ws_sales_price) AS average_sales_price, AVG(ws.ws_net_profit) AS average_net_profit FROM item i JOIN web_sales ws ON i.i_item_sk = ws.ws_item_sk JOIN inventory inv ON ws.ws_item_sk = inv.inv_item_sk WHERE i.i_current_price > 50 AND inv.inv_warehouse_sk IN (1, 2) AND ws.ws_ship_date_sk IN (2452335, 2452146, 2450987, 2452543) GROUP BY i.i_category ORDER BY total_sales DESC;
SELECT i.i_category, i.i_size, hd.hd_buy_potential, COUNT(p.p_promo_sk) AS total_promotions, SUM(p.p_cost) AS total_promo_cost, AVG(p.p_cost) AS average_promo_cost, CASE WHEN p.p_channel_catalog = 'N' THEN 'Not Catalog' ELSE 'Catalog' END AS promo_channel_catalog, SUM(CASE WHEN p.p_discount_active = 'Y' THEN 1 ELSE 0 END) AS active_discounts FROM promotion p JOIN item i ON p.p_item_sk = i.i_item_sk JOIN household_demographics hd ON i.i_size = hd.hd_buy_potential JOIN customer_demographics cd ON hd.hd_income_band_sk = cd.cd_purchase_estimate WHERE i.i_size IN ('economy', 'medium', 'large') AND hd.hd_buy_potential IN ('>10000', 'Unknown', '0-500', '5001-10000', '1001-5000', '501-1000') AND p.p_channel_catalog = 'N' AND i.i_category_id = '8' AND p.p_purpose NOT IN ('Unknown') GROUP BY i.i_category, i.i_size, hd.hd_buy_potential, promo_channel_catalog ORDER BY total_promotions DESC, total_promo_cost DESC;
SELECT cd.cd_education_status, cd.cd_gender, cd.cd_marital_status, cd.cd_credit_rating, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_incl_tax, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amount_incl_tax, COUNT(wr.wr_returned_date_sk) AS total_returns, p.p_channel_email, p.p_channel_dmail, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo FROM web_returns wr JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk JOIN promotion p ON wr.wr_item_sk = p.p_item_sk WHERE wr.wr_fee IN (16.46, 25.83, 12.23, 28.11, 82.98) AND wr.wr_reversed_charge = 33.99 AND cd.cd_dep_employed_count = 0 GROUP BY cd.cd_education_status, cd.cd_gender, cd.cd_marital_status, cd.cd_credit_rating, p.p_channel_email, p.p_channel_dmail, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo ORDER BY total_return_amount_incl_tax DESC;
SELECT d_year, d_moy, sm_type, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_paid) AS total_revenue, SUM(cs_net_profit) AS total_profit, AVG(cs_quantity) AS average_quantity, AVG(cs_net_paid_inc_tax) AS average_revenue_inc_tax, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_quantity) AS average_return_quantity, COUNT(DISTINCT wp_web_page_sk) AS total_web_page_visits, COUNT(DISTINCT s_store_sk) AS total_stores, COUNT(DISTINCT cc_call_center_sk) AS total_call_centers FROM date_dim LEFT JOIN catalog_sales ON cs_sold_date_sk = d_date_sk LEFT JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk LEFT JOIN catalog_returns ON cr_returned_date_sk = d_date_sk LEFT JOIN web_page ON wp_access_date_sk = d_date_sk LEFT JOIN store ON s_store_sk = cs_ship_customer_sk LEFT JOIN call_center ON cc_call_center_sk = cs_call_center_sk LEFT JOIN customer_demographics ON cs_ship_cdemo_sk = cd_demo_sk WHERE d_year = 2001 AND d_moy BETWEEN 1 AND 6 AND cs_net_paid IS NOT NULL AND sm_type IS NOT NULL AND (cc_sq_ft = '3514' OR cc_sq_ft = '4134' OR cc_sq_ft = '1138') AND (cc_rec_end_date = '2000-12-31' OR cc_rec_end_date = '2001-12-31' OR cc_rec_end_date = '2000-01-01') AND (cc_company = '6' OR cc_company = '3' OR cc_company = '1') AND (cr_return_ship_cost = '2.66' OR cr_return_ship_cost = '13.49' OR cr_return_ship_cost = '26.44') AND (cr_catalog_page_sk = '380' OR cr_catalog_page_sk = '219' OR cr_catalog_page_sk = '388') AND (cr_returned_time_sk = '45077' OR cr_returned_time_sk = '77627' OR cr_returned_time_sk = '32496') AND (sm_contract = '2mM8l' OR sm_contract = 'uukTktPYycct8' OR sm_contract = 'fop0bcSd91J26IVpR') AND (sm_ship_mode_sk = '10' OR sm_ship_mode_sk = '6' OR sm_ship_mode_sk = '4') AND (sm_code = 'SEA' OR sm_code = 'BIKE' OR sm_code = 'SURFACE') AND (sm_carrier = 'FEDEX' OR sm_carrier = 'ZHOU' OR sm_carrier = 'PRIVATECARRIER') AND (cs_ext_tax = '89.97' OR cs_ext_tax = '687.10' OR cs_ext_tax = '221.70') AND (cs_ship_hdemo_sk = '2057' OR cs_ship_hdemo_sk = '6324' OR cs_ship_hdemo_sk = '6945') AND (cs_net_paid_inc_ship_tax = '1307.73' OR cs_net_paid_inc_ship_tax = '1740.39' OR cs_net_paid_inc_ship_tax = '1487.69') AND (d_weekend = 'N' OR d_weekend = 'Y') AND (s_gmt_offset = '-5.00') AND (s_store_sk = '1' OR s_store_sk = '12' OR s_store_sk = '9') AND (s_store_name = 'anti' OR s_store_name = 'ese' OR s_store_name = 'eing') AND (wp_access_date_sk = '2452555' OR wp_access_date_sk = '2452645' OR wp_access_date_sk = '2452576') AND (wp_customer_sk = '20213' OR wp_customer_sk = '98376' OR wp_customer_sk = '60150') AND (wp_web_page_id = 'AAAAAAAAEDAAAAAA' OR wp_web_page_id = 'AAAAAAAAHDAAAAAA' OR wp_web_page_id = 'AAAAAAAAOAAAAAAA') AND (wp_web_page_sk = '3' OR wp_web_page_sk = '17' OR wp_web_page_sk = '36') AND (cd_demo_sk = '18975' OR cd_demo_sk = '21210' OR cd_demo_sk = '20876') AND (cd_dep_count = '2' OR cd_dep_count = '1') GROUP BY d_year, d_moy, sm_type ORDER BY d_year, d_moy, sm_type;
SELECT sm.sm_type AS Ship_Mode_Type, web.web_name AS Website_Name, COUNT(*) AS Total_Orders, SUM(cs.cs_quantity) AS Total_Quantity_Sold, AVG(cs.cs_sales_price) AS Average_Sales_Price, SUM(cs.cs_net_paid) AS Total_Net_Paid, SUM(cs.cs_net_profit) AS Total_Net_Profit, AVG(inv.inv_quantity_on_hand) AS Average_Inventory_On_Hand FROM catalog_sales cs JOIN ship_mode sm ON sm.sm_ship_mode_sk = cs.cs_ship_mode_sk JOIN web_site web ON web.web_site_sk = cs.cs_ship_customer_sk JOIN inventory inv ON inv.inv_item_sk = cs.cs_item_sk AND inv.inv_warehouse_sk = cs.cs_warehouse_sk JOIN time_dim td ON td.t_time_sk = cs.cs_sold_time_sk WHERE td.t_minute IN ('40', '56', '11', '1', '36') AND web.web_company_id IN ('3', '5', '6', '1', '4', '2') AND cs.cs_sold_time_sk IN ('40476', '14275', '33265', '81680') GROUP BY sm.sm_type, web.web_name ORDER BY Total_Net_Paid DESC, Website_Name, Ship_Mode_Type;
SELECT ca_country, sm_type, COUNT(*) AS shipment_count, AVG(ca_gmt_offset) AS avg_gmt_offset, SUM(CASE WHEN r_reason_sk IN (28, 20, 15, 23, 17) THEN 1 ELSE 0 END) AS high_priority_reason_count FROM customer_address JOIN ship_mode ON ca_address_sk = sm_ship_mode_sk LEFT JOIN reason ON r_reason_sk = ca_address_sk WHERE ca_country = 'United States' AND r_reason_id IN ('AAAAAAAALBAAAAAA', 'AAAAAAAAPAAAAAAA', 'AAAAAAAAKAAAAAAA') AND ca_address_id IN ('AAAAAAAALPBAAAAA', 'AAAAAAAAJIMAAAAA') GROUP BY ca_country, sm_type ORDER BY shipment_count DESC, avg_gmt_offset;
SELECT ws2.web_name AS website, ws2.web_market_manager AS market_manager, cd.cd_gender AS customer_gender, SUM(ws.ws_sales_price) AS total_sales, AVG(ws.ws_sales_price) AS average_sales, COUNT(DISTINCT ws.ws_order_number) AS number_of_orders, SUM(ws.ws_quantity) AS total_quantity_sold, COUNT(DISTINCT c.c_customer_sk) AS number_of_customers, ca.ca_state AS customer_state, ca.ca_city AS customer_city FROM web_sales ws JOIN web_site ws2 ON ws.ws_web_site_sk = ws2.web_site_sk JOIN customer c ON ws.ws_ship_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk WHERE ws.ws_sold_date_sk BETWEEN 2450815 AND 2450815 + 30 AND ws.ws_promo_sk = 212 AND ws2.web_market_manager IN ('Jeffrey Martin', 'William Reyes', 'Kelvin Lynch', 'Frank Cooper', 'Keith Williams', 'John Isaacs') AND ca.ca_gmt_offset BETWEEN -5 AND -3 GROUP BY ws2.web_name, ws2.web_market_manager, cd.cd_gender, ca.ca_state, ca.ca_city ORDER BY total_sales DESC, number_of_orders DESC;
SELECT s.s_store_name, d.d_year, d.d_quarter_name, SUM(ss.ss_wholesale_cost) AS total_wholesale_cost, SUM(ss.ss_list_price) AS total_list_price, SUM(ss.ss_sales_price) AS total_sales, AVG(ss.ss_sales_price) AS average_sales, COUNT(DISTINCT ss.ss_ticket_number) AS total_transactions, SUM(CASE WHEN p.p_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS promo_sales_count, SUM(CASE WHEN p.p_promo_sk IS NOT NULL THEN ss.ss_sales_price ELSE 0 END) AS promo_sales_amount, SUM(CASE WHEN d.d_weekend = 'Y' THEN ss.ss_quantity ELSE 0 END) AS weekend_quantity_sold, AVG(CASE WHEN d.d_weekend = 'Y' THEN ss.ss_sales_price ELSE NULL END) AS weekend_avg_sale_price FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE s.s_country = 'United States' AND d.d_year = 2000 AND d.d_quarter_seq BETWEEN 1 AND 4 GROUP BY s.s_store_name, d.d_year, d.d_quarter_name ORDER BY s.s_store_name, d.d_year, d.d_quarter_name;
SELECT ws.ws_web_site_sk, ws.ws_item_sk, i.i_product_name, i.i_category, sm.sm_type AS shipping_type, w.w_state AS warehouse_state, ca.ca_state AS customer_state, COUNT(*) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_net_profit) AS average_net_profit FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk JOIN customer_address ca ON ws.ws_ship_addr_sk = ca.ca_address_sk WHERE ca.ca_gmt_offset IN ('-8.00', '-10.00', '-5.00', '-9.00', '-7.00') AND (w.w_zip = '35709' OR w.w_zip = '31904') GROUP BY ws.ws_web_site_sk, ws.ws_item_sk, i.i_product_name, i.i_category, sm.sm_type, w.w_state, ca.ca_state ORDER BY total_net_profit DESC, total_orders DESC LIMIT 100;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, dd.d_year, SUM(ws.ws_ext_sales_price) AS total_sales, AVG(ws.ws_ext_sales_price) AS avg_sales, COUNT(*) AS number_of_sales, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_return_amount) AS avg_returns, COUNT(DISTINCT cr.cr_order_number) AS number_of_returns FROM web_sales ws JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk LEFT JOIN catalog_returns cr ON cr.cr_returned_date_sk = dd.d_date_sk AND cr.cr_refunded_customer_sk = c.c_customer_sk WHERE dd.d_year = 2001 GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, dd.d_year ORDER BY total_sales DESC, total_returns DESC LIMIT 100;
SELECT d_year, SUM(cs_net_paid) AS total_sales, AVG(cs_quantity) AS average_quantity, COUNT(DISTINCT cs_order_number) AS total_orders, hd_dep_count, hd_vehicle_count, p_channel_dmail, p_channel_demo FROM catalog_sales JOIN date_dim ON (catalog_sales.cs_sold_date_sk = date_dim.d_date_sk) JOIN household_demographics ON (catalog_sales.cs_bill_hdemo_sk = household_demographics.hd_demo_sk) JOIN promotion ON (catalog_sales.cs_promo_sk = promotion.p_promo_sk) WHERE d_year = 1999 AND hd_dep_count >= 2 AND hd_vehicle_count >= 1 AND (p_channel_dmail = 'Y' OR p_channel_demo = 'N') GROUP BY d_year, hd_dep_count, hd_vehicle_count, p_channel_dmail, p_channel_demo ORDER BY total_sales DESC;
SELECT d_year, d_month_seq, c_birth_country, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_paid) AS total_sales, AVG(cs_sales_price) AS avg_sales_price, SUM(cr_return_amount) AS total_returns, AVG(cr_return_amount) AS avg_return_amount, COUNT(DISTINCT sr_ticket_number) AS total_return_transactions, SUM(sr_return_amt) AS total_returned_amount, AVG(sr_return_amt) AS avg_returned_amount, COUNT(DISTINCT CASE WHEN sr_reason_sk = 26 THEN sr_ticket_number ELSE NULL END) AS total_returns_reason_26, COUNT(DISTINCT CASE WHEN sr_reason_sk = 20 THEN sr_ticket_number ELSE NULL END) AS total_returns_reason_20, SUM(CASE WHEN sr_reason_sk = 26 THEN sr_return_amt ELSE 0 END) AS total_amount_returned_for_reason_26, SUM(CASE WHEN sr_reason_sk = 20 THEN sr_return_amt ELSE 0 END) AS total_amount_returned_for_reason_20 FROM date_dim JOIN catalog_sales ON (cs_sold_date_sk = d_date_sk) JOIN customer ON (cs_bill_customer_sk = c_customer_sk) LEFT JOIN catalog_returns ON (cs_order_number = cr_order_number AND cs_item_sk = cr_item_sk) LEFT JOIN store_returns ON (cs_order_number = sr_ticket_number AND cs_item_sk = sr_item_sk) WHERE d_year = 2023 AND c_birth_country IN ('United States', 'Canada') GROUP BY d_year, d_month_seq, c_birth_country ORDER BY total_sales DESC, total_returns DESC, d_year, d_month_seq, c_birth_country;
SELECT i.i_category AS item_category, AVG(i.i_current_price) AS avg_current_price, COUNT(i.i_item_sk) AS total_item_count, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, AVG(cd.cd_purchase_estimate) FILTER (WHERE cd.cd_credit_rating = 'Good') AS avg_good_credit_purchase_estimate, AVG(cd.cd_purchase_estimate) FILTER (WHERE cd.cd_credit_rating = 'High Risk') AS avg_high_risk_credit_purchase_estimate, AVG(cd.cd_purchase_estimate) FILTER (WHERE cd.cd_credit_rating = 'Low Risk') AS avg_low_risk_credit_purchase_estimate FROM item i JOIN promotion p ON i.i_item_sk = p.p_item_sk JOIN customer c ON p.p_start_date_sk <= c.c_first_sales_date_sk AND p.p_end_date_sk >= c.c_first_sales_date_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk WHERE i.i_category IN ('Home', 'Electronics', 'Sports') AND c.c_first_sales_date_sk = '2452263' AND p.p_discount_active = '1' GROUP BY i.i_category ORDER BY avg_current_price DESC;
SELECT d_year, d_month_seq, cc_state, p_channel_tv, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_ticket_number) AS unique_tickets, SUM(ss_coupon_amt) AS total_coupon_amount_used, SUM(ss_net_paid_inc_tax) AS total_sales_with_tax, SUM(ss_net_profit) AS total_net_profit FROM date_dim JOIN store_sales ON d_date_sk = ss_sold_date_sk JOIN call_center ON cc_call_center_sk = ss_store_sk JOIN promotion ON p_promo_sk = ss_promo_sk WHERE d_year = 1999 AND p_channel_tv = 'Y' AND ss_addr_sk IN ('31017', '33096', '32929') AND ss_coupon_amt IN (65.92, 3048.43) AND (cc_state = 'CA' OR cc_state = 'NY') GROUP BY d_year, d_month_seq, cc_state, p_channel_tv ORDER BY d_year, d_month_seq, cc_state, p_channel_tv;
SELECT cd.cd_education_status, cd.cd_gender, cd.cd_marital_status, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(sr.sr_return_amt_inc_tax) AS total_returns_inc_tax, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, COUNT(sr.sr_item_sk) AS total_returned_items, SUM(sr.sr_net_loss) AS total_net_loss FROM customer_demographics cd JOIN customer c ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN web_page wp ON c.c_customer_sk = wp.wp_customer_sk WHERE c.c_first_shipto_date_sk IN ('2452105', '2451393') AND c.c_first_sales_date_sk IN ('2450519', '2451079') AND cd.cd_gender IN ('M', 'F') AND wp.wp_type IN ('feedback', 'general', 'protected') GROUP BY cd.cd_education_status, cd.cd_gender, cd.cd_marital_status ORDER BY total_returns_inc_tax DESC, avg_purchase_estimate DESC;
SELECT p.p_promo_name AS promotion_name, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_return_amt_inc_tax) - SUM(wr.wr_fee) AS net_loss_after_fees, COUNT(DISTINCT wp.wp_web_page_id) AS distinct_pages_involved, sm.sm_type AS ship_method_type, MAX(wr.wr_return_amt_inc_tax) AS max_return_amount_incl_tax, MIN(wr.wr_return_amt_inc_tax) AS min_return_amount_incl_tax, COUNT(DISTINCT CASE WHEN cd.cd_gender = 'M' THEN wr.wr_returning_customer_sk END) AS male_customers, COUNT(DISTINCT CASE WHEN cd.cd_gender = 'F' THEN wr.wr_returning_customer_sk END) AS female_customers FROM web_returns wr INNER JOIN promotion p ON wr.wr_reason_sk = p.p_promo_sk INNER JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk INNER JOIN ship_mode sm ON CAST(SUBSTRING(wp.wp_url FROM 'http://www.%#"sm"#"%' FOR '#') AS INTEGER) = sm.sm_ship_mode_sk LEFT JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk WHERE wr.wr_returned_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk AND wp.wp_url = 'http://www.foo.com' AND wp.wp_link_count IN (15, 11) AND wr.wr_return_tax = 52.13 GROUP BY p.p_promo_name, sm.sm_type ORDER BY total_returns DESC, net_loss_after_fees DESC;
SELECT s_state, i_category, COUNT(DISTINCT i_item_sk) AS num_items, SUM(i_current_price) AS total_current_price, AVG(i_wholesale_cost) AS avg_wholesale_cost, COUNT(DISTINCT w_warehouse_sk) AS num_warehouses, SUM(w_warehouse_sq_ft) AS total_warehouse_sq_ft, COUNT(DISTINCT wp_web_page_sk) AS num_web_pages, AVG(wp_char_count) AS avg_char_count_on_web_pages FROM store JOIN item ON (s_store_sk = i_manufact_id) JOIN warehouse ON (s_zip = w_zip) JOIN web_page ON (wp_access_date_sk = '2452583' OR wp_access_date_sk = '2452565' OR wp_access_date_sk = '2452618') WHERE s_state IN ('CA', 'TX', 'NY') AND i_category IN ('Electronics', 'Clothing', 'Furniture') GROUP BY s_state, i_category ORDER BY s_state, i_category;
SELECT s.s_store_name, COUNT(sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_fee) AS total_fees_collected, SUM(sr.sr_net_loss) AS total_net_loss, cd.cd_credit_rating, COUNT(DISTINCT cd.cd_demo_sk) AS unique_customers_returning, w.w_warehouse_name, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft_used, p.p_promo_name, SUM(p.p_cost) AS total_promotion_cost, AVG(wp.wp_link_count) AS average_webpage_link_count FROM store_returns sr INNER JOIN store s ON sr.sr_store_sk = s.s_store_sk INNER JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk INNER JOIN warehouse w ON s.s_zip = w.w_zip INNER JOIN promotion p ON sr.sr_reason_sk = p.p_promo_sk INNER JOIN web_page wp ON wp.wp_customer_sk = sr.sr_customer_sk WHERE s.s_rec_start_date BETWEEN '1997-03-13' AND '2001-03-13' AND s.s_store_name IN ('ese', 'ought', 'cally') AND wp.wp_creation_date_sk::text IN ('2450814', '2450813', '2450815') AND wp.wp_rec_start_date BETWEEN '1997-09-03' AND '2001-09-03' AND sr.sr_reversed_charge = 13.92 AND cd.cd_credit_rating IN ('Low Risk', 'High Risk', 'Unknown', 'Good') GROUP BY s.s_store_name, cd.cd_credit_rating, w.w_warehouse_name, p.p_promo_name ORDER BY total_returns DESC, total_net_loss DESC;
SELECT cc.cc_name AS CallCenter, SUM(cr.cr_return_amount) AS TotalReturnAmount, AVG(cr.cr_return_amount) AS AverageReturnAmount, COUNT(cr.cr_order_number) AS NumberOfReturns, r.r_reason_desc AS ReturnReason, ib.ib_lower_bound AS IncomeBandLowerBound, ib.ib_upper_bound AS IncomeBandUpperBound, COUNT(DISTINCT ws.ws_order_number) AS NumberOfWebSales, SUM(ws.ws_net_profit) AS TotalWebSalesProfit FROM catalog_returns cr INNER JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk INNER JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk INNER JOIN income_band ib ON cr.cr_refunded_cdemo_sk = ib.ib_income_band_sk LEFT JOIN web_sales ws ON cr.cr_order_number = ws.ws_order_number WHERE cc.cc_market_manager IN ('Julius Durham', 'Matthew Clifton', 'Gary Colburn', 'Julius Tran') AND ib.ib_upper_bound IN (50000, 130000, 180000, 60000, 160000) AND ib.ib_lower_bound IN (0, 50001, 170001, 60001, 110001, 90001) AND ws.ws_warehouse_sk IN (3, 1, 2, 5) AND cc.cc_call_center_id IN ('AAAAAAAACAAAAAAA', 'AAAAAAAABAAAAAAA', 'AAAAAAAAEAAAAAAA') GROUP BY CallCenter, ReturnReason, IncomeBandLowerBound, IncomeBandUpperBound ORDER BY TotalReturnAmount DESC, NumberOfReturns DESC, TotalWebSalesProfit DESC;
SELECT cp.cp_department, i.i_category, i.i_brand, sm.sm_type, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN catalog_page cp ON i.i_item_sk = cp.cp_catalog_page_sk JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = ss.ss_item_sk WHERE cp.cp_type IN ('quarterly', 'bi-annual', 'monthly') AND cp.cp_description LIKE '%services%' AND i.i_product_name IN ('antin stpriought', 'eingcallyoughtable', 'antieseationese') AND ss.ss_coupon_amt IN (0.70, 58.75, 218.97) AND sm.sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') GROUP BY cp.cp_department, i.i_category, i.i_brand, sm.sm_type ORDER BY total_net_profit DESC, total_quantity_sold DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_paid_inc_ship) AS total_revenue_inc_ship, AVG(cs.cs_net_paid_inc_tax) AS avg_revenue_inc_tax, wp.wp_type, COUNT(wp.wp_web_page_sk) AS page_count, SUM(wp.wp_image_count) AS total_image_count, r.r_reason_desc, COUNT(r.r_reason_sk) AS reason_count FROM catalog_sales cs JOIN income_band ib ON cs.cs_bill_hdemo_sk = ib.ib_income_band_sk JOIN web_page wp ON cs.cs_catalog_page_sk = wp.wp_web_page_sk LEFT JOIN reason r ON cs.cs_ship_mode_sk = r.r_reason_sk WHERE cs.cs_ship_cdemo_sk IN ('895212', '186278', '897167') AND cs.cs_net_paid_inc_ship IN (3933.80, 801.00, 5246.97) AND cs.cs_net_paid_inc_tax IN (103.42, 7068.42, 500.16) AND cs.cs_sold_date_sk IN (2450829, 2450822, 2450816) AND r.r_reason_desc IN ('Wrong size', 'No service location in my area', 'Lost my job') AND r.r_reason_id IN ('AAAAAAAANAAAAAAA', 'AAAAAAAAOAAAAAAA', 'AAAAAAAACCAAAAAA') AND r.r_reason_sk IN (11, 14, 19) AND wp.wp_autogen_flag IN ('N', 'Y') AND wp.wp_type IN ('ad', 'order', 'dynamic') AND wp.wp_image_count IN (1, 3, 6) AND wp.wp_web_page_sk IN (44, 58, 40) AND ib.ib_upper_bound IN (70000, 200000, 140000) AND ib.ib_income_band_sk IN (10, 15, 2) AND ib.ib_lower_bound IN (130001, 190001, 20001) GROUP BY ib.ib_income_band_sk, wp.wp_type, r.r_reason_desc ORDER BY total_revenue_inc_ship DESC, avg_revenue_inc_tax DESC, total_orders DESC, page_count DESC, total_image_count DESC, reason_count DESC;
SELECT cc_state, COUNT(DISTINCT cc_call_center_sk) AS num_call_centers, AVG(cc_employees) AS avg_employees, SUM(cc_sq_ft) AS total_square_footage, ca.ca_state AS customer_state, COUNT(DISTINCT ca.ca_address_sk) AS num_customer_addresses, AVG(ca.ca_gmt_offset) AS avg_customer_gmt_offset, sm.sm_type AS ship_mode_type, COUNT(DISTINCT sm.sm_ship_mode_sk) AS num_ship_modes, MAX(sm.sm_contract) AS longest_ship_contract FROM call_center cc JOIN customer_address ca ON cc_state = ca.ca_state JOIN ship_mode sm ON TRUE WHERE cc_street_type = 'Way' AND ca.ca_gmt_offset IN ('-9.00', '-6.00', '-10.00', '-5.00', '-7.00') AND sm.sm_ship_mode_id = 'AAAAAAAAJAAAAAAA' GROUP BY cc_state, ca.ca_state, sm.sm_type ORDER BY cc_state, ca.ca_state, sm.sm_type;
SELECT s.s_store_name, s.s_city, s.s_state, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN warehouse w ON s.s_zip = w.w_zip JOIN ship_mode sm ON w.w_country = sm.sm_carrier WHERE ss.ss_sold_date_sk BETWEEN 2451189 AND 2451200 AND ss.ss_quantity > 50 GROUP BY s.s_store_name, s.s_city, s.s_state ORDER BY total_net_profit DESC, total_quantity_sold DESC LIMIT 10;
SELECT ca.ca_state, cd.cd_education_status, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(ss.ss_quantity) AS total_sales_quantity, AVG(ss.ss_net_profit) AS avg_net_profit, SUM(sr.sr_return_quantity) AS total_return_quantity, AVG(sr.sr_net_loss) AS avg_net_loss, AVG(inv.inv_quantity_on_hand) AS avg_inventory_on_hand FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk LEFT JOIN inventory inv ON inv.inv_warehouse_sk = ca.ca_address_sk WHERE ca.ca_country = 'SERBIA' AND cd.cd_purchase_estimate BETWEEN 3500 AND 10000 AND inv.inv_warehouse_sk IN (1, 2) GROUP BY ca.ca_state, cd.cd_education_status ORDER BY ca.ca_state, cd.cd_education_status;
SELECT dd.d_year, dd.d_quarter_name, SUM(cs.cs_net_paid_inc_tax) AS total_revenue, AVG(cs.cs_net_paid_inc_tax) AS avg_revenue_per_sale, COUNT(cs.cs_order_number) AS total_orders, AVG(cd.cd_purchase_estimate) AS avg_customer_purchase_estimate, COUNT(DISTINCT c.c_customer_sk) AS total_customers, AVG(i.inv_quantity_on_hand) AS avg_inventory_quantity, COUNT(DISTINCT w.web_site_sk) AS total_web_sites FROM date_dim dd JOIN catalog_sales cs ON dd.d_date_sk = cs.cs_sold_date_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN inventory i ON cs.cs_sold_date_sk = i.inv_date_sk JOIN web_site w ON w.web_zip = '35709' OR w.web_zip = '31904' WHERE dd.d_year = 2000 AND cd.cd_gender = 'M' AND cd.cd_dep_college_count = 0 AND cs.cs_item_sk IN ('34', '4', '13', '54') AND i.inv_date_sk = 2450815 GROUP BY dd.d_year, dd.d_quarter_name ORDER BY total_revenue DESC, avg_revenue_per_sale DESC;
SELECT i.i_category AS item_category, ib.ib_income_band_sk AS income_band_id, COUNT(DISTINCT i.i_item_sk) AS num_items_sold, SUM(inv.inv_quantity_on_hand) AS total_quantity, AVG(i.i_current_price) AS average_sales_price FROM inventory inv JOIN item i ON inv.inv_item_sk = i.i_item_sk JOIN income_band ib ON i.i_wholesale_cost BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound WHERE i.i_rec_start_date <= CURRENT_DATE AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date > CURRENT_DATE) GROUP BY i.i_category, ib.ib_income_band_sk ORDER BY ib.ib_income_band_sk, average_sales_price DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, COUNT(DISTINCT ws.ws_item_sk) AS unique_items_sold, COUNT(DISTINCT c.c_customer_sk) AS distinct_customers, p.p_promo_name, COUNT(DISTINCT p.p_promo_sk) AS num_promotions_used FROM web_sales ws JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk JOIN web_site ws_site ON ws.ws_web_site_sk = ws_site.web_site_sk WHERE p.p_channel_demo = 'N' AND p.p_channel_press = 'N' AND ib.ib_income_band_sk IN ('15', '19') GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, p.p_promo_name ORDER BY total_net_profit DESC, average_sales_price DESC, total_orders DESC;
SELECT ca_state, ca_city, ca_country, EXTRACT(YEAR FROM TO_TIMESTAMP(t_time)) AS sale_year, COUNT(DISTINCT w_warehouse_sk) AS number_of_warehouses, SUM(w_warehouse_sq_ft) AS total_warehouse_area, AVG(w_warehouse_sq_ft) AS avg_warehouse_area, COUNT(DISTINCT ca_address_sk) AS number_of_customers, AVG(ca_gmt_offset) AS avg_gmt_offset FROM customer_address JOIN warehouse ON customer_address.ca_state = warehouse.w_state JOIN time_dim ON (warehouse.w_gmt_offset = -5 OR warehouse.w_street_name IN ('Ash Laurel', '6th', 'Wilson Elm', 'View First')) WHERE ca_country = 'United States' AND t_hour BETWEEN 8 AND 17 AND EXTRACT(ISODOW FROM TO_TIMESTAMP(t_time)) < 6 GROUP BY ca_state, ca_city, ca_country, sale_year ORDER BY ca_state, ca_city, sale_year;
SELECT dd.d_year, dd.d_quarter_name, cd.cd_education_status, sum(cr.cr_return_quantity) AS total_returned_quantity, avg(cr.cr_return_amount) AS avg_return_amount, count(distinct cr.cr_refunded_customer_sk) AS unique_customers_refunded, sum(inv.inv_quantity_on_hand) AS total_inventory_on_hand, sum(p.p_cost) AS total_promotion_cost FROM catalog_returns cr JOIN date_dim dd ON cr.cr_returned_date_sk = dd.d_date_sk JOIN customer_demographics cd ON cr.cr_returning_cdemo_sk = cd.cd_demo_sk JOIN inventory inv ON cr.cr_item_sk = inv.inv_item_sk AND inv.inv_date_sk = dd.d_date_sk JOIN promotion p ON p.p_item_sk = cr.cr_item_sk AND p.p_start_date_sk <= dd.d_date_sk AND p.p_end_date_sk >= dd.d_date_sk WHERE dd.d_year = 2022 AND cd.cd_dep_college_count = 0 AND dd.d_qoy IN (1, 2, 3, 4) AND cr.cr_item_sk IN (12109, 7004, 944, 13729, 16502) GROUP BY dd.d_year, dd.d_quarter_name, cd.cd_education_status ORDER BY dd.d_year, dd.d_quarter_name, cd.cd_education_status;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_ext_discount_amt) AS average_discount, COUNT(cs.cs_order_number) AS number_of_orders, SUM(inv.inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT p.p_promo_id) AS number_of_promotions_used FROM call_center cc LEFT JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk LEFT JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk LEFT JOIN inventory inv ON cs.cs_item_sk = inv.inv_item_sk AND cc.cc_division = inv.inv_warehouse_sk WHERE cs.cs_sold_date_sk IN ('2450823', '2450816', '2450827', '2450829', '2450820') AND cs.cs_promo_sk IN ('130', '96', '160', '128') GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_sales DESC;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales, SUM(CASE WHEN p.p_discount_active = '1' THEN ss.ss_net_paid_inc_tax ELSE 0 END) AS total_revenue_with_discount, SUM(CASE WHEN p.p_discount_active = '0' THEN ss.ss_net_paid_inc_tax ELSE 0 END) AS total_revenue_without_discount FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE cc.cc_sq_ft IN ('1138', '4134', '649', '3514', '2268') AND ss.ss_net_paid_inc_tax IN ('3576.44', '1406.62', '935.06', '961.29', '3070.18', '6397.11') AND ss.ss_list_price = '158.68' GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_quantity_sold DESC, average_sales_price DESC;
SELECT cp.cp_department, sm.sm_type, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_net_profit, AVG(cs.cs_net_profit) AS average_net_profit, SUM(wr.wr_return_quantity) AS total_return_quantity, SUM(wr.wr_net_loss) AS total_net_loss FROM catalog_sales cs JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number WHERE cp.cp_type IN ('quarterly', 'bi-annual', 'monthly') AND cs.cs_ext_tax IN (10.31, 370.42, 9.07) GROUP BY cp.cp_department, sm.sm_type ORDER BY total_net_profit DESC, total_net_loss ASC;
SELECT ws.web_class, AVG(ws.web_tax_percentage) AS average_tax_percentage, CA.ca_state, SUM(CA.ca_gmt_offset) AS total_gmt_offset, COUNT(DISTINCT SM.sm_ship_mode_sk) AS shipping_mode_count FROM web_site AS ws JOIN customer_address AS CA ON ws.web_state = CA.ca_state JOIN ship_mode AS SM ON ws.web_zip = SM.sm_code WHERE CA.ca_state IN ('NH', 'MI', 'MD', 'UT') GROUP BY ws.web_class, CA.ca_state ORDER BY ws.web_class, CA.ca_state;
SELECT ws_site.web_name, ws_site.web_manager, ws_site.web_mkt_class, ws_site.web_mkt_desc, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN web_site ws_site ON ws.ws_web_site_sk = ws_site.web_site_sk WHERE ws.ws_ship_date_sk IN (2451986, 2451883) AND ws_site.web_company_name IN ('ought', 'cally', 'anti', 'able') AND ws_site.web_market_manager IN ('Joe George', 'Frank Cooper', 'Jeffrey Martin') GROUP BY ws_site.web_name, ws_site.web_manager, ws_site.web_mkt_class, ws_site.web_mkt_desc ORDER BY total_net_profit DESC;
SELECT cd.cd_education_status, cd.cd_credit_rating, AVG(sr.sr_return_amt) AS avg_store_return_amt, SUM(cr.cr_return_amount) AS sum_catalog_return_amt, COUNT(DISTINCT sr.sr_customer_sk) AS unique_store_customers, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_catalog_customers FROM customer_demographics cd LEFT JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk LEFT JOIN catalog_returns cr ON cd.cd_demo_sk = cr.cr_returning_cdemo_sk LEFT JOIN household_demographics hd ON cd.cd_demo_sk = hd.hd_demo_sk WHERE cd.cd_purchase_estimate IN (3500, 1500, 10000) AND cd.cd_dep_college_count = 0 AND hd.hd_income_band_sk IN (19, 8, 15, 3, 1) GROUP BY cd.cd_education_status, cd.cd_credit_rating ORDER BY avg_store_return_amt DESC, sum_catalog_return_amt DESC;
SELECT cp.cp_department, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_quantity) AS total_return_quantity, COUNT(DISTINCT cr.cr_returned_date_sk) AS num_return_dates, SUM(ss.ss_net_paid) AS total_store_sales, SUM(ss.ss_quantity) AS total_store_quantity_sold, AVG(ws.ws_net_profit) AS avg_web_net_profit, SUM(ws.ws_quantity) AS total_web_quantity_sold FROM catalog_page cp JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk JOIN store_sales ss ON ss.ss_customer_sk = cr.cr_refunded_customer_sk JOIN web_sales ws ON ws.ws_bill_customer_sk = cr.cr_refunded_customer_sk WHERE cp.cp_end_date_sk BETWEEN 2450964 AND 2451694 AND cr.cr_return_amt_inc_tax BETWEEN 500 AND 1500 AND ss.ss_net_paid BETWEEN 500 AND 2100 AND ws.ws_ext_ship_cost BETWEEN 50 AND 1000 GROUP BY cp.cp_department ORDER BY total_return_quantity DESC, avg_return_amount DESC;
SELECT cs.cs_order_number AS order_number, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_profit) AS total_net_profit, COUNT(DISTINCT cs.cs_bill_customer_sk) AS unique_customers, ib.ib_lower_bound AS income_lower_bound, ib.ib_upper_bound AS income_upper_bound, SUM(ws.ws_quantity) AS web_total_quantity, AVG(ws.ws_sales_price) AS web_average_sales_price, SUM(ws.ws_net_paid) AS web_total_net_paid, SUM(ws.ws_net_profit) AS web_total_net_profit, COUNT(DISTINCT ws.ws_bill_customer_sk) AS web_unique_customers FROM catalog_sales cs JOIN income_band ib ON cs.cs_bill_hdemo_sk = ib.ib_income_band_sk JOIN web_sales ws ON cs.cs_item_sk = ws.ws_item_sk AND cs.cs_order_number = ws.ws_order_number WHERE cs.cs_ext_tax IN (0.56, 96.57, 30.68, 46.59, 64.13) AND ib.ib_income_band_sk IN (19, 17, 16, 10, 1) GROUP BY cs.cs_order_number, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_net_profit DESC, web_total_net_profit DESC LIMIT 100;
SELECT dd.d_year, dd.d_quarter_name, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit, cc.cc_name AS call_center_name, cc.cc_division_name AS call_center_division, cc.cc_city AS call_center_city FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk WHERE dd.d_qoy IN (1, 2, 3, 4) AND dd.d_dom IN (20, 24) AND cc.cc_sq_ft IN ('4134', '1138', '2268') AND cc.cc_division IN ('1', '4') GROUP BY dd.d_year, dd.d_quarter_name, cc.cc_name, cc.cc_division_name, cc.cc_city ORDER BY dd.d_year, dd.d_quarter_name, total_net_profit DESC;
SELECT d_year, d_quarter_name, sm_type AS shipping_type, COUNT(DISTINCT sr_customer_sk) AS num_customers_returned, SUM(sr_return_quantity) AS total_returned_qty, AVG(sr_return_amt) AS avg_return_amt, SUM(sr_return_amt) AS sum_return_amt, SUM(sr_fee) AS total_fees, SUM(sr_net_loss) AS total_net_loss, COUNT(DISTINCT wr_refunded_customer_sk) AS num_customers_refunded, SUM(wr_return_quantity) AS total_refunded_qty, AVG(wr_return_amt) AS avg_refunded_amt, SUM(wr_return_amt) AS sum_refunded_amt, SUM(wr_fee) AS total_wr_fees, SUM(wr_net_loss) AS total_wr_net_loss FROM date_dim JOIN store_returns ON (date_dim.d_date_sk = store_returns.sr_returned_date_sk) JOIN ship_mode ON (store_returns.sr_item_sk = ship_mode.sm_ship_mode_sk) JOIN web_returns ON (store_returns.sr_returned_date_sk = web_returns.wr_returned_date_sk) WHERE sm_carrier = 'MSC' AND d_year = 2022 GROUP BY d_year, d_quarter_name, sm_type ORDER BY d_year, d_quarter_name, sm_type;
SELECT cp.cp_department, cp.cp_catalog_number, cp.cp_description, cp.cp_type, t.t_shift, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_return_ship_cost) AS total_return_ship_cost, SUM(cr.cr_net_loss) AS net_loss FROM catalog_page cp JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk JOIN time_dim t ON cr.cr_returned_time_sk = t.t_time_sk WHERE cp.cp_end_date_sk IN ('2451087', '2451178') AND t.t_shift = 'third' AND cp.cp_catalog_page_sk IN ('562', '3351', '1660') GROUP BY cp.cp_department, cp.cp_catalog_number, cp.cp_description, cp.cp_type, t.t_shift ORDER BY cp.cp_department, cp.cp_catalog_number, cp.cp_description;
SELECT s.s_store_id, s.s_store_name, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS preferred_customers, AVG(s.s_number_employees) AS average_number_of_employees, AVG(s.s_floor_space) AS average_floor_space, SUM(CASE WHEN r.r_reason_desc = 'Did not get it on time' THEN 1 ELSE 0 END) AS complaints_not_ontime, SUM(CASE WHEN r.r_reason_desc = 'duplicate purchase' THEN 1 ELSE 0 END) AS complaints_duplicate_purchases, SUM(CASE WHEN r.r_reason_desc = 'Does not work with a product that I have' THEN 1 ELSE 0 END) AS complaints_incompatibility, SUM(CASE WHEN r.r_reason_desc = 'Did not like the make' THEN 1 ELSE 0 END) AS complaints_dislike_make, COUNT(DISTINCT CASE WHEN c.c_first_sales_date_sk BETWEEN 2449741 AND 2452333 THEN c.c_customer_sk END) AS customers_with_first_purchase FROM store s LEFT JOIN customer c ON s.s_store_sk = c.c_current_addr_sk LEFT JOIN reason r ON r.r_reason_sk = c.c_last_review_date_sk WHERE c.c_birth_day IN (24, 1, 22, 4) GROUP BY s.s_store_id, s.s_store_name ORDER BY s.s_store_id;
SELECT ca.ca_country, COUNT(DISTINCT cp.cp_catalog_page_sk) AS total_catalog_pages, COUNT(DISTINCT p.p_promo_sk) AS total_promotions, SUM(p.p_cost) AS total_promotion_cost, AVG(p.p_response_target) AS average_promotion_response_target, SUM(sr.sr_return_amt_inc_tax) AS total_returns_inc_tax, AVG(sr.sr_return_amt_inc_tax) AS average_return_inc_tax, SUM(sr.sr_net_loss) AS total_net_loss, COUNT(DISTINCT sr.sr_returned_date_sk) AS days_with_returns FROM promotion p JOIN catalog_page cp ON cp.cp_start_date_sk <= p.p_end_date_sk AND cp.cp_end_date_sk >= p.p_start_date_sk JOIN store_returns sr ON sr.sr_reason_sk = p.p_promo_sk JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk WHERE ca.ca_country = 'United States' AND p.p_end_date_sk IN ('2450816', '2450904', '2450773') AND p.p_purpose <> 'Unknown' AND cp.cp_end_date_sk IN ('2450964', '2451419', '2451664') GROUP BY ca.ca_country ORDER BY total_returns_inc_tax DESC;
SELECT d_year, cp_department, COUNT(DISTINCT c_customer_sk) AS number_of_customers, SUM(cr_return_quantity) AS total_return_quantity, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_fee) AS total_fee, SUM(cr_return_amt_inc_tax) AS total_return_amount_inc_tax, p_promo_name, COUNT(DISTINCT p_promo_sk) AS number_of_promotions_used FROM date_dim, customer, catalog_page, catalog_returns LEFT JOIN promotion ON cr_item_sk = p_item_sk WHERE cr_returned_date_sk = d_date_sk AND cr_refunded_customer_sk = c_customer_sk AND cr_catalog_page_sk = cp_catalog_page_sk AND d_year = 2022 AND p_channel_details = 'Good, foreign problems will n' AND cp_department IN ('Books', 'Electronics') AND c_preferred_cust_flag = 'Y' GROUP BY d_year, cp_department, p_promo_name ORDER BY d_year, avg_return_amount DESC, total_return_quantity DESC;
SELECT dd.d_year, dd.d_quarter_name, AVG(cd.cd_purchase_estimate) as avg_purchase_estimate, SUM(cd.cd_dep_count) as total_dep_count, SUM(cd.cd_dep_employed_count) as total_dep_employed_count, SUM(cd.cd_dep_college_count) as total_dep_college_count, COUNT(DISTINCT dd.d_date_sk) as num_days, COUNT(DISTINCT td.t_time_sk) as num_time_entries FROM date_dim dd JOIN customer_demographics cd ON dd.d_year = cd.cd_purchase_estimate / 1000 JOIN time_dim td ON td.t_minute IN (6, 51) WHERE dd.d_current_quarter = 'N' AND dd.d_fy_year IN ('1913', '1912', '1903') GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT cp.cp_department, COUNT(DISTINCT cs.cs_item_sk) AS distinct_items_sold, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_ext_sales_price) AS total_sales, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_ext_discount_amt) AS total_discount_amount FROM catalog_sales cs JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk WHERE cs.cs_sold_date_sk BETWEEN cp.cp_start_date_sk AND cp.cp_end_date_sk GROUP BY cp.cp_department ORDER BY total_sales DESC;
SELECT w_state, sm_type, EXTRACT(YEAR FROM wp_rec_start_date) AS year, EXTRACT(QUARTER FROM wp_rec_start_date) AS quarter, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk JOIN web_page ON cs_catalog_page_sk = wp_web_page_sk JOIN time_dim ON cs_sold_time_sk = t_time_sk JOIN inventory ON cs_warehouse_sk = inv_warehouse_sk AND cs_item_sk = inv_item_sk WHERE t_time_sk IN (1701, 993, 898, 4227, 3566, 3142) AND sm_carrier IN ('GERMA', 'DHL', 'ORIENTAL', 'PRIVATECARRIER') AND inv_date_sk = 2450815 GROUP BY w_state, sm_type, year, quarter ORDER BY total_net_profit DESC, total_net_paid DESC, total_orders DESC;
SELECT cp_department, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_profit) AS total_net_profit, COUNT(DISTINCT ss_ticket_number) AS total_store_sales_tickets, SUM(ss_quantity) AS total_store_quantity_sold, AVG(ss_sales_price) AS average_store_sales_price, SUM(ss_net_paid_inc_tax) AS total_store_net_paid_inc_tax FROM catalog_sales JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk JOIN store_sales ON catalog_sales.cs_item_sk = store_sales.ss_item_sk JOIN store ON store_sales.ss_store_sk = s_store_sk JOIN customer ON store_sales.ss_customer_sk = c_customer_sk WHERE c_birth_country IN ('MOLDOVA, REPUBLIC OF', 'TOGO', 'IRAQ', 'BURUNDI') AND cp_department IS NOT NULL AND cp_start_date_sk IS NOT NULL AND cp_end_date_sk IS NOT NULL AND (cp_end_date_sk - cp_start_date_sk) > 0 AND s_market_id IS NOT NULL GROUP BY cp_department ORDER BY total_net_profit DESC, total_orders DESC LIMIT 10;
SELECT w.w_state, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(w.w_gmt_offset) AS average_gmt_offset, COUNT(r.r_reason_sk) AS gift_exchange_occurrences FROM warehouse w LEFT JOIN reason r ON r.r_reason_desc = 'Gift exchange' JOIN time_dim t ON t.t_minute BETWEEN 25 AND 35 GROUP BY w.w_state ORDER BY total_warehouse_sq_ft DESC, average_gmt_offset DESC;
SELECT ca.ca_state, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(CASE WHEN p.p_channel_event = 'N' THEN ss.ss_quantity ELSE 0 END) AS quantity_sold_no_event_channel, SUM(CASE WHEN p.p_channel_email = 'N' THEN ss.ss_quantity ELSE 0 END) AS quantity_sold_no_email_channel, COUNT(DISTINCT i.inv_warehouse_sk) AS distinct_warehouses_stocked, AVG(i.inv_quantity_on_hand) AS avg_quantity_on_hand FROM store_sales ss JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk LEFT JOIN inventory i ON ss.ss_item_sk = i.inv_item_sk WHERE i.inv_warehouse_sk IN (1, 2) AND i.inv_date_sk = 2450815 GROUP BY ca.ca_state ORDER BY total_net_profit DESC, ca.ca_state;
SELECT cc.cc_name, i.i_category, cd.cd_education_status, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN call_center cc ON cc.cc_gmt_offset = '-5.00' JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk WHERE i.i_units = 'Pallet' AND c.c_birth_day IN (3, 20) AND cd.cd_education_status IN ('2 yr Degree', 'Advanced Degree', 'Secondary', 'College') AND ws.ws_sold_date_sk IS NOT NULL GROUP BY cc.cc_name, i.i_category, cd.cd_education_status ORDER BY total_net_profit DESC, total_orders DESC;
SELECT s.s_state AS store_state, COUNT(DISTINCT s.s_store_sk) AS store_count, SUM(s.s_number_employees) AS total_employees, AVG(s.s_floor_space) AS avg_floor_space, ROUND(AVG(s.s_tax_precentage), 2) AS avg_store_tax_percentage, w.web_market_manager, COUNT(DISTINCT w.web_site_sk) AS website_count, ROUND(AVG(w.web_tax_percentage), 2) AS avg_website_tax_percentage, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound FROM store s JOIN web_site w ON s.s_market_id = w.web_mkt_id JOIN income_band ib ON ib.ib_lower_bound <= s.s_number_employees AND ib.ib_upper_bound >= s.s_number_employees WHERE s.s_state IN ('CA', 'TX', 'NY') AND w.web_market_manager IN ('Jarvis Allen', 'James Harris', 'Albert Leung', 'Philip Sampson') AND ib.ib_income_band_sk IN ('20', '5', '3', '2') GROUP BY s.s_state, w.web_market_manager, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY s.s_state, w.web_market_manager, ib.ib_income_band_sk;
SELECT cc.cc_name AS "Call Center Name", cc.cc_city AS "City", cc.cc_state AS "State", COUNT(cr.cr_order_number) AS "Total Returns Processed", AVG(cr.cr_return_amount) AS "Average Return Amount", SUM(cr.cr_net_loss) AS "Total Net Loss", w.w_warehouse_name AS "Warehouse Name", w.w_warehouse_sq_ft AS "Warehouse Square Feet", wn.AvgNetLossPerWarehouseSqFt AS "Avg. Net Loss per Warehouse Sq Ft" FROM catalog_returns cr JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN (SELECT cr_warehouse_sk, AVG(cr_net_loss) AS AvgNetLossPerWarehouseSqFt FROM catalog_returns GROUP BY cr_warehouse_sk) wn ON wn.cr_warehouse_sk = w.w_warehouse_sk WHERE cc.cc_state = 'TN' AND w.w_country = 'United States' GROUP BY cc.cc_call_center_sk, cc.cc_name, cc.cc_city, cc.cc_state, w.w_warehouse_name, w.w_warehouse_sq_ft, wn.AvgNetLossPerWarehouseSqFt ORDER BY "Total Net Loss" DESC, "Average Return Amount" DESC;
SELECT hd.hd_income_band_sk, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, COUNT(DISTINCT sr.sr_customer_sk) AS unique_customers_returned, SUM(CASE WHEN p.p_channel_email = 'Y' THEN sr.sr_return_quantity ELSE 0 END) AS email_promo_returned_quantity, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk JOIN promotion p ON sr.sr_item_sk = p.p_item_sk JOIN inventory i ON sr.sr_item_sk = i.inv_item_sk AND i.inv_warehouse_sk = 1 WHERE hd.hd_demo_sk IN (1588, 4700) AND sr.sr_refunded_cash IN (10.38, 1818.70) GROUP BY hd.hd_income_band_sk ORDER BY total_net_loss DESC;
SELECT ib.ib_lower_bound, ib.ib_upper_bound, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_tickets, SUM(ss.ss_net_paid_inc_tax) AS total_revenue_inc_tax, SUM(ss.ss_net_profit) AS total_profit, AVG(hd.hd_dep_count) AS average_dependency_count, AVG(hd.hd_vehicle_count) AS average_vehicle_count FROM store_sales ss JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk GROUP BY ib.ib_lower_bound, ib.ib_upper_bound HAVING COUNT(DISTINCT ss.ss_ticket_number) > 10 ORDER BY total_revenue_inc_tax DESC;
SELECT cc.cc_name, cc.cc_class, cc.cc_hours, ca.ca_city, ca.ca_state, hd.hd_buy_potential, hd.hd_vehicle_count, SUM(cs.cs_net_paid_inc_ship_tax) AS total_sales, AVG(cs.cs_net_paid_inc_ship_tax) AS avg_sales, COUNT(DISTINCT cs.cs_order_number) AS number_of_orders, SUM(wr.wr_return_amt_inc_tax) AS total_returns, AVG(wr.wr_return_amt_inc_tax) AS avg_returns, COUNT(DISTINCT wr.wr_order_number) AS number_of_returns FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number WHERE cc.cc_hours IN ('8AM-4PM', '8AM-8AM') AND cc.cc_class IN ('large', 'small', 'medium') AND cc.cc_county = 'Williamson County' AND cc.cc_division_name IN ('pri', 'ese', 'ought') AND hd.hd_buy_potential IN ('Unknown', '5001-10000', '501-1000') AND hd.hd_vehicle_count IN (4, 2, 0) AND ca.ca_zip IN ('73951', '52565', '72297') AND ca.ca_city IN ('Millwood', 'Forest', 'Newport') AND cs.cs_net_paid_inc_ship_tax IN (5723.12, 5673.95, 2697.52) AND cs.cs_ship_addr_sk IN (9885, 17067, 29571) AND wr.wr_return_tax IN (46.49, 3.87, 51.37) AND wr.wr_return_ship_cost IN (547.26, 948.48, 764.52) AND wr.wr_item_sk IN (10976, 17844, 12276) GROUP BY cc.cc_name, cc.cc_class, cc.cc_hours, ca.ca_city, ca.ca_state, hd.hd_buy_potential, hd.hd_vehicle_count ORDER BY total_sales DESC, total_returns DESC;
SELECT d_year, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT sr_customer_sk) AS unique_customers_returning, COUNT(DISTINCT p_promo_sk) AS distinct_promotions, SUM(inv_quantity_on_hand) AS total_inventory_quantity, COUNT(DISTINCT cp_catalog_page_sk) AS num_catalog_pages FROM store_returns JOIN date_dim ON store_returns.sr_returned_date_sk = date_dim.d_date_sk JOIN promotion ON store_returns.sr_item_sk = promotion.p_item_sk JOIN inventory ON store_returns.sr_item_sk = inventory.inv_item_sk JOIN catalog_page ON promotion.p_item_sk = catalog_page.cp_catalog_page_sk WHERE d_fy_year IN ('1900', '1901', '1902', '1904', '1910', '1912') AND p_channel_tv = 'N' AND sr_return_time_sk IN ('42714', '34148', '59678') AND inv_item_sk IN ('9572', '12640', '8512', '13724') AND inv_warehouse_sk IN ('1', '2') GROUP BY d_year ORDER BY d_year;
SELECT cc.cc_state, AVG(cc.cc_employees) AS avg_employees, SUM(cc.cc_sq_ft) AS total_sq_ft, COUNT(DISTINCT hd.hd_demo_sk) AS households_with_buy_potential, SUM(CASE WHEN p.p_discount_active = 'Y' THEN p.p_cost ELSE 0 END) AS total_active_promo_cost FROM call_center cc LEFT JOIN household_demographics hd ON hd.hd_income_band_sk IN (5, 1, 17, 14) AND hd.hd_buy_potential IS NOT NULL LEFT JOIN promotion p ON p.p_discount_active = 'Y' AND p.p_channel_press = 'N' WHERE cc.cc_state = 'TN' GROUP BY cc.cc_state;
SELECT r.r_reason_desc AS return_reason, s.s_state AS store_state, SUM(cr.cr_net_loss) AS total_net_loss, COUNT(cr.cr_order_number) AS total_returns, SUM(cs.cs_sales_price) AS total_sales, AVG(cs.cs_wholesale_cost) AS average_wholesale_cost FROM catalog_returns cr JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN catalog_sales cs ON cr.cr_order_number = cs.cs_order_number JOIN store s ON cs.cs_ship_addr_sk = s.s_store_sk WHERE s.s_state = 'TN' AND (s.s_rec_end_date = '2000-03-12' OR s.s_rec_end_date = '2001-03-12' OR s.s_rec_end_date = '1999-03-13') AND cr.cr_refunded_cdemo_sk IN ('1036988', '1625235', '677128', '477491', '1394507') AND cs.cs_sales_price IN ('39.95', '82.47', '120.86', '44.27', '31.55', '39.02') AND cs.cs_wholesale_cost IN ('73.36', '50.92', '95.23', '92.26') GROUP BY return_reason, store_state ORDER BY total_net_loss DESC, store_state, return_reason;
SELECT i.i_category AS item_category, p.p_promo_name AS promotion_name, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT cr.cr_order_number) AS total_return_transactions, SUM(cr.cr_return_quantity) AS total_quantity_returned, SUM(ss.ss_net_profit) AS total_net_profit, CASE WHEN SUM(ss.ss_net_profit) >= 0 THEN 'Profitable' ELSE 'Not Profitable' END AS profitability_status FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk LEFT JOIN catalog_returns cr ON ss.ss_item_sk = cr.cr_item_sk AND ss.ss_ticket_number = cr.cr_order_number JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk WHERE dd.d_year = 2022 AND dd.d_current_year = 'Y' AND p.p_channel_catalog = 'N' AND p.p_channel_event = 'N' GROUP BY i.i_category, p.p_promo_name ORDER BY total_net_profit DESC, total_sales_transactions DESC;
SELECT dd.d_year, dd.d_quarter_name, sm.sm_carrier, sm.sm_code, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_net_paid) AS total_revenue, AVG(cs.cs_net_profit) AS average_profit, SUM(cr.cr_return_quantity) AS total_quantity_returned, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_net_loss) AS average_net_loss, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT cr.cr_returning_customer_sk) AS total_returning_customers FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN income_band ib ON cs.cs_bill_cdemo_sk = ib.ib_income_band_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number AND cs.cs_item_sk = cr.cr_item_sk WHERE cs.cs_net_profit BETWEEN -140.39 AND 2770.24 AND cs.cs_ship_date_sk IN (2451009, 2450882, 2450900) AND sm.sm_carrier IN ('ORIENTAL', 'ZOUROS', 'ALLIANCE') AND sm.sm_code IN ('SURFACE', 'AIR', 'BIKE') AND ib.ib_upper_bound IN (140000, 130000, 30000) AND ib.ib_income_band_sk IN (4, 11, 1) AND ib.ib_lower_bound IN (160001, 100001, 170001) AND dd.d_date_id IN ('AAAAAAAAHBLNECAA', 'AAAAAAAAEDBOECAA', 'AAAAAAAADAKNECAA') AND dd.d_quarter_seq IN (21, 43, 22) AND dd.d_month_seq IN (135, 159, 125) AND dd.d_moy IN (4, 6, 7) AND cr.cr_order_number IN (3796, 710, 4775) AND cr.cr_return_tax IN (28.41, 24.46, 171.99) AND cr.cr_returning_customer_sk IN (14182, 22448, 94068) GROUP BY dd.d_year, dd.d_quarter_name, sm.sm_carrier, sm.sm_code, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_revenue DESC, average_profit DESC;
SELECT s.s_store_name, s.s_city, ca.ca_state, COUNT(DISTINCT ss.ss_ticket_number) AS store_sales_count, SUM(ss.ss_net_paid) AS total_store_sales_revenue, COUNT(DISTINCT sr.sr_ticket_number) AS store_returns_count, SUM(sr.sr_return_amt) AS total_store_returns_revenue, COUNT(DISTINCT cs.cs_order_number) AS catalog_sales_count, SUM(cs.cs_net_paid) AS total_catalog_sales_revenue, COUNT(DISTINCT cr.cr_order_number) AS catalog_returns_count, SUM(cr.cr_return_amount) AS total_catalog_returns_revenue, w.w_warehouse_name, SUM(cr.cr_fee) AS total_cr_fee, AVG(cr.cr_return_amount) AS avg_catalog_return_amount, MAX(ss.ss_net_profit) AS max_store_sale_profit FROM store AS s LEFT JOIN store_sales AS ss ON s.s_store_sk = ss.ss_store_sk LEFT JOIN store_returns AS sr ON s.s_store_sk = sr.sr_store_sk LEFT JOIN warehouse AS w ON w.w_city = s.s_city AND w.w_county = s.s_county LEFT JOIN catalog_sales AS cs ON cs.cs_warehouse_sk = w.w_warehouse_sk LEFT JOIN catalog_returns AS cr ON cr.cr_warehouse_sk = w.w_warehouse_sk LEFT JOIN customer_address AS ca ON ca.ca_address_sk = sr.sr_addr_sk WHERE s.s_company_id = 1 AND s.s_geography_class = 'Unknown' AND w.w_city = 'Fairview' AND w.w_county = 'Williamson County' AND cr.cr_fee IN ('26.50', '75.45', '76.31', '11.75', '16.52', '56.95') AND cr.cr_ship_mode_sk IN ('8', '20', '4', '1', '11') AND sr.sr_addr_sk IN ('11867', '40243') AND sr.sr_reversed_charge IN ('0.68', '96.26', '6.63', '3.63') GROUP BY s.s_store_name, s.s_city, ca.ca_state, w.w_warehouse_name ORDER BY total_store_sales_revenue DESC;
SELECT sm.sm_ship_mode_id, sm.sm_type, sm.sm_carrier, COUNT(DISTINCT cr.cr_order_number) AS total_orders_returned, SUM(cr.cr_return_quantity) AS total_quantity_returned, AVG(cr.cr_return_amt_inc_tax) AS avg_refunded_amount_inc_tax, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN time_dim t ON cr.cr_returned_time_sk = t.t_time_sk JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk WHERE d.d_year = 2003 AND sm.sm_carrier IN ('HARMSTORF', 'TBS', 'ZOUROS', 'MSC', 'DIAMOND', 'AIRBORNE') GROUP BY sm.sm_ship_mode_id, sm.sm_type, sm.sm_carrier ORDER BY total_net_loss DESC;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS total_tickets, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = ss.ss_promo_sk JOIN income_band ib ON ib.ib_income_band_sk = cd.cd_demo_sk WHERE sm.sm_contract IN ('ldhM8IvpzHgdbBgDfI', 'qENFQ', '6Hzzp4JkzjqD8MGXLCDa', 'uukTktPYycct8') AND t.t_hour IN (1, 0) AND ib.ib_upper_bound <= 10000 AND ib.ib_income_band_sk IN (18, 2, 4, 16, 13, 9) AND cd.cd_credit_rating IN ('High Risk', 'Low Risk', 'Good', 'Unknown') AND cd.cd_marital_status IN ('D', 'M', 'W', 'U') GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating ORDER BY total_net_profit DESC, total_tickets DESC;
SELECT st.s_store_name, st.s_store_id, SUM(ws.ws_net_paid) AS total_net_sales, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(wr.wr_order_number) AS total_returns, AVG(wr.wr_return_amt) AS avg_return_amount, ARRAY_AGG(DISTINCT re.r_reason_desc) AS reasons_for_returns FROM store st LEFT JOIN web_sales ws ON st.s_store_sk = ws.ws_warehouse_sk LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number LEFT JOIN reason re ON wr.wr_reason_sk = re.r_reason_sk WHERE st.s_division_id = 1 AND st.s_tax_precentage BETWEEN 0.01 AND 0.06 GROUP BY st.s_store_name, st.s_store_id ORDER BY total_net_sales DESC, avg_sales_price DESC, total_returns DESC, avg_return_amount DESC;
SELECT cd.cd_gender, cd.cd_education_status, cd.cd_credit_rating, ib.ib_income_band_sk, sm.sm_type, COUNT(*) AS number_of_sales, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, SUM(CASE WHEN ws.ws_sales_price > ws.ws_wholesale_cost THEN 1 ELSE 0 END) AS profitable_sales_count FROM web_sales ws JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk WHERE cd.cd_credit_rating = 'High Risk' AND ib.ib_upper_bound IN (60000, 160000, 180000, 200000) AND sm.sm_ship_mode_id IN ('AAAAAAAAGAAAAAAA', 'AAAAAAAAABAAAAAA', 'AAAAAAAAKAAAAAAA', 'AAAAAAAALAAAAAAA', 'AAAAAAAAJAAAAAAA') GROUP BY cd.cd_gender, cd.cd_education_status, cd.cd_credit_rating, ib.ib_income_band_sk, sm.sm_type ORDER BY total_net_profit DESC, total_net_paid DESC;
SELECT sm_type, AVG(ws_quantity) AS avg_quantity, AVG(ws_sales_price) AS avg_sales_price, SUM(ws_ext_sales_price) AS total_sales, COUNT(DISTINCT ws_bill_customer_sk) AS unique_customers, COUNT(DISTINCT ws_ship_customer_sk) AS unique_ship_to_customers, AVG(cd_purchase_estimate) AS avg_purchase_estimate, SUM(cd_dep_count) AS total_dependents, AVG(hd_income_band_sk) AS avg_income_band, SUM(hd_vehicle_count) AS total_vehicles FROM web_sales JOIN ship_mode ON ws_ship_mode_sk = sm_ship_mode_sk JOIN customer_demographics ON ws_bill_cdemo_sk = cd_demo_sk JOIN household_demographics ON ws_bill_hdemo_sk = hd_demo_sk JOIN customer ON ws_bill_customer_sk = c_customer_sk WHERE ws_sales_price BETWEEN 100.00 AND 200.00 AND cd_credit_rating = 'Good' AND hd_buy_potential = '5001-10000' AND c_current_addr_sk IN ('45401', '18617', '42292', '26887', '5997') GROUP BY sm_type;
SELECT ca_state, sm_type, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_net_profit) AS total_profit FROM catalog_sales JOIN customer_address ON cs_ship_addr_sk = ca_address_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk WHERE cp_catalog_page_number IN (73, 12, 56, 26) AND ca_country = 'United States' AND sm_type = 'AIR' GROUP BY ca_state, sm_type ORDER BY total_profit DESC;
SELECT hd.hd_income_band_sk, p.p_channel_details, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs.cs_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(cs.cs_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE hd.hd_income_band_sk IN (12, 6, 4) AND p.p_promo_sk IN (262, 88, 196, 231, 119, 83) AND cs.cs_net_paid IN (499.47, 9920.40) GROUP BY hd.hd_income_band_sk, p.p_channel_details ORDER BY hd.hd_income_band_sk, p.p_channel_details;
SELECT ws.ws_web_site_sk, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, ws_site.web_tax_percentage, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(cd.cd_dep_college_count) AS total_college_dependents FROM web_sales ws JOIN web_site ws_site ON ws.ws_web_site_sk = ws_site.web_site_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk WHERE ws.ws_sales_price BETWEEN 6.61 AND 60.51 AND ws_site.web_tax_percentage IN ('0.07', '0.02') AND ws_site.web_zip IN ('35709', '31904') AND ws.ws_sold_date_sk IS NOT NULL AND ws.ws_sold_time_sk IS NOT NULL GROUP BY ws.ws_web_site_sk, ws_site.web_tax_percentage, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY ws.ws_web_site_sk, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, hd.hd_buy_potential, hd.hd_income_band_sk, COUNT(DISTINCT cr.cr_order_number) AS total_returned_orders, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, AVG(cr.cr_return_tax) AS avg_return_tax, AVG(cr.cr_net_loss) AS avg_net_loss FROM catalog_returns cr JOIN customer_demographics cd ON cr.cr_returning_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk WHERE cr.cr_call_center_sk IN (1, 2, 4) AND hd.hd_buy_potential IN ('0-500', '501-1000', '>10000') AND hd.hd_income_band_sk = 20 AND cd.cd_dep_employed_count = 0 AND cd.cd_gender IN ('M', 'F') GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, hd.hd_buy_potential, hd.hd_income_band_sk ORDER BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, hd.hd_buy_potential, hd.hd_income_band_sk;
SELECT s.s_store_name, s.s_company_name, COUNT(DISTINCT inv.inv_item_sk) AS unique_items_stocked, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(p.p_cost) AS average_promotion_cost, SUM(CASE WHEN p.p_channel_dmail = 'Y' THEN 1 ELSE 0 END) AS total_direct_mail_promotions, COUNT(DISTINCT ca.ca_address_sk) AS distinct_customer_addresses, d.d_year, d.d_quarter_name FROM store s JOIN inventory inv ON s.s_store_sk = inv.inv_warehouse_sk JOIN promotion p ON p.p_item_sk = inv.inv_item_sk JOIN customer_address ca ON s.s_zip = ca.ca_zip JOIN date_dim d ON inv.inv_date_sk = d.d_date_sk WHERE d.d_year = 2023 AND s.s_market_id IN (1, 2, 3) AND p.p_channel_dmail = 'Y' AND ca.ca_gmt_offset BETWEEN -7.00 AND -5.00 GROUP BY s.s_store_name, s.s_company_name, d.d_year, d.d_quarter_name ORDER BY s.s_store_name, d.d_year, d.d_quarter_name;
SELECT ca.ca_state AS customer_state, i.i_category AS item_category, SUM(cs.cs_sales_price) AS total_sales, AVG(cs.cs_quantity) AS average_quantity_sold, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk WHERE i.i_container <> 'Unknown' AND cs.cs_sold_date_sk IS NOT NULL AND ca.ca_country = 'United States' GROUP BY customer_state, item_category HAVING SUM(cs.cs_sales_price) > 10000 ORDER BY total_sales DESC, customer_state, item_category;
SELECT cp.cp_department, ca.ca_state, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs.cs_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(cs.cs_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk WHERE cs.cs_net_paid_inc_ship > 500 AND cp.cp_catalog_page_sk IN (621, 2091, 4644, 4608, 3010) AND ca.ca_state IS NOT NULL GROUP BY cp.cp_department, ca.ca_state ORDER BY cp.cp_department, ca.ca_state;
SELECT dd.d_year AS sale_year, dd.d_moy AS sale_month, dd.d_dom AS sale_day, COUNT(DISTINCT ss.ss_ticket_number) AS store_sales_count, SUM(ss.ss_quantity) AS store_items_sold, AVG(ss.ss_sales_price) AS avg_store_sale_price, SUM(cs.cs_net_paid_inc_tax) AS catalog_total_revenue_inc_tax, SUM(ws.ws_net_paid_inc_ship_tax) AS web_total_revenue_inc_ship_tax, AVG(cc.cc_employees) AS avg_call_center_employees, ws.ws_web_site_sk, web_site.web_name FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN catalog_sales cs ON ss.ss_sold_date_sk = cs.cs_sold_date_sk JOIN web_sales ws ON ss.ss_sold_date_sk = ws.ws_sold_date_sk JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk JOIN web_site ON ws.ws_web_site_sk = web_site.web_site_sk WHERE dd.d_year = 2000 AND ss.ss_list_price BETWEEN 100 AND 200 AND ws.ws_quantity IN (64, 84, 57) AND cc.cc_open_date_sk IS NOT NULL AND ws.ws_web_page_sk IN (211, 510, 171, 90, 132, 78) AND dd.d_last_dom IN ('2418669', '2418489', '2415993', '2419340', '2418000', '2417392') GROUP BY sale_year, sale_month, sale_day, ws.ws_web_site_sk, web_site.web_name ORDER BY sale_year, sale_month, sale_day, ws.ws_web_site_sk;
SELECT dd.d_year, dd.d_quarter_name, wa.w_country, ca.ca_state, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, AVG(cd.cd_purchase_estimate) AS avg_customer_purchase_estimate, SUM(CASE WHEN pr.p_channel_email = '1' THEN ws.ws_quantity ELSE 0 END) as total_quantity_sold_via_email, SUM(CASE WHEN pr.p_channel_tv = '1' THEN ws.ws_quantity ELSE 0 END) as total_quantity_sold_via_tv FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON ws.ws_bill_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN warehouse wa ON ws.ws_warehouse_sk = wa.w_warehouse_sk JOIN promotion pr ON ws.ws_promo_sk = pr.p_promo_sk WHERE dd.d_quarter_seq IN (25, 41) AND wa.w_country = 'United States' AND wa.w_street_name IN ('Ash Laurel', '6th', 'Wilson Elm', 'View First') AND cd.cd_purchase_estimate BETWEEN 1000 AND 5500 GROUP BY ROLLUP(dd.d_year, dd.d_quarter_name, wa.w_country, ca.ca_state) ORDER BY dd.d_year, dd.d_quarter_name, wa.w_country, ca.ca_state;
SELECT i.i_item_id, i.i_category, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_sales_price) AS avg_sales_price, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_net_profit) AS avg_net_profit, COUNT(DISTINCT w.w_warehouse_sk) AS number_of_warehouses_used FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk WHERE i.i_category IN ('Electronics', 'Clothing') AND c.c_email_address LIKE '%@%' AND cs.cs_sold_date_sk BETWEEN 20000101 AND 20001231 GROUP BY i.i_item_id, i.i_category ORDER BY total_sales DESC, avg_sales_price DESC LIMIT 10;
SELECT cc.cc_name, cc.cc_class, cc.cc_employees, cc.cc_sq_ft, AVG(cc.cc_tax_percentage) AS avg_tax_percentage, COUNT(DISTINCT ca.ca_address_sk) AS unique_customer_addresses, SUM(ib.ib_upper_bound - ib.ib_lower_bound) AS total_income_band_range, d.d_year, COUNT(DISTINCT d.d_date_sk) AS working_days FROM call_center cc JOIN date_dim d ON (cc.cc_open_date_sk = d.d_date_sk OR cc.cc_closed_date_sk = d.d_date_sk) JOIN customer_address ca ON (cc.cc_state = ca.ca_state) JOIN time_dim t ON (t.t_hour BETWEEN 8 AND 17) JOIN income_band ib ON (ib.ib_lower_bound >= 40001 AND ib.ib_upper_bound <= 70000) WHERE cc.cc_zip = '31904' AND d.d_dow IN (0, 3, 4) AND t.t_minute IN ('8', '14', '35', '46', '52', '55') AND cc.cc_mkt_class IN ( 'Silly particles could pro', 'Dealers make most historical, direct students', 'Wrong troops shall work sometimes in a opti', 'A bit narrow forms matter animals. Consist', 'More than other authori' ) GROUP BY cc.cc_name, cc.cc_class, cc.cc_employees, cc.cc_sq_ft, d.d_year;
SELECT cc.cc_name, COUNT(ws.ws_order_number) AS total_online_orders, SUM(ws.ws_quantity) AS total_items_sold, SUM(ws.ws_net_paid) AS total_revenue, SUM(ws.ws_net_profit) AS total_profit, AVG(ws.ws_quantity) AS avg_items_per_order, SUM(sr.sr_return_quantity) AS total_items_returned, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_quantity) AS avg_items_returned_per_order, SUM(wr.wr_return_quantity) AS web_total_items_returned, SUM(wr.wr_return_amt) AS web_total_return_amount, AVG(wr.wr_return_quantity) AS web_avg_items_returned_per_order, COUNT(DISTINCT sm.sm_ship_mode_sk) AS distinct_shipping_modes_used, SUM(promo.p_cost) AS total_promotional_cost FROM call_center cc LEFT JOIN web_sales ws ON cc.cc_call_center_sk = ws.ws_web_page_sk LEFT JOIN store_returns sr ON ws.ws_order_number = sr.sr_ticket_number LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number LEFT JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN promotion promo ON ws.ws_promo_sk = promo.p_promo_sk WHERE cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date > CURRENT_DATE GROUP BY cc.cc_name ORDER BY total_revenue DESC;
SELECT cc.cc_country, dd.d_year, sm.sm_type, COUNT(DISTINCT cc.cc_call_center_sk) AS num_call_centers, SUM(hd.hd_vehicle_count) AS total_vehicles, AVG(hd.hd_dep_count) AS avg_dep_count, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages FROM call_center cc JOIN date_dim dd ON cc.cc_open_date_sk = dd.d_date_sk JOIN household_demographics hd ON cc.cc_mkt_id = hd.hd_income_band_sk JOIN catalog_page cp ON cc.cc_division = cp.cp_catalog_number JOIN ship_mode sm ON cc.cc_company = sm.sm_carrier::integer WHERE cc.cc_country = 'United States' AND hd.hd_demo_sk IN ('2794', '432') AND hd.hd_income_band_sk IN ('7', '2', '11', '12') AND dd.d_current_year = 'N' AND cp.cp_catalog_page_id IN ('AAAAAAAACKOAAAAA', 'AAAAAAAAODAAAAAA', 'AAAAAAAAEBMAAAAA', 'AAAAAAAAGLCBAAAA') AND dd.d_same_day_lq = '2419796' GROUP BY cc.cc_country, dd.d_year, sm.sm_type ORDER BY dd.d_year, sm.sm_type;
SELECT ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_type, COUNT(DISTINCT cp.cp_catalog_page_sk) AS total_catalog_pages, MIN(cp.cp_catalog_number) AS min_catalog_number, MAX(cp.cp_catalog_number) AS max_catalog_number, COUNT(DISTINCT sm.sm_ship_mode_sk) AS total_ship_modes FROM income_band ib CROSS JOIN ship_mode sm LEFT JOIN catalog_page cp ON cp.cp_department = 'Books' WHERE sm.sm_type IN ('LIBRARY', 'REGULAR') GROUP BY ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_type ORDER BY ib.ib_lower_bound, sm.sm_type;
SELECT inv.inv_item_sk, SUM(inv.inv_quantity_on_hand) AS total_quantity_on_hand, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, COUNT(wr.wr_item_sk) AS count_returns, wp.wp_type FROM inventory inv LEFT JOIN web_returns wr ON inv.inv_item_sk = wr.wr_item_sk LEFT JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk WHERE inv.inv_date_sk = 2450815 AND wp.wp_type IN ('protected', 'feedback', 'ad', 'dynamic', 'welcome', 'general') AND wp.wp_max_ad_count IN (0, 1, 2) GROUP BY inv.inv_item_sk, wp.wp_type ORDER BY inv.inv_item_sk, wp.wp_type;
SELECT c.c_first_name, c.c_last_name, cd.cd_gender, cd.cd_education_status, hd.hd_buy_potential, hd.hd_vehicle_count, COUNT(sr.sr_item_sk) AS total_returns, SUM(sr.sr_return_amt_inc_tax) AS total_return_value, AVG(sr.sr_return_amt_inc_tax) AS avg_return_value, ib.ib_lower_bound, ib.ib_upper_bound, w.w_warehouse_name, w.w_city, w.w_state, ws.web_name, ws.web_manager, COUNT(wr.wr_item_sk) AS total_web_returns, SUM(wr.wr_return_amt_inc_tax) AS total_web_return_value, AVG(wr.wr_return_amt_inc_tax) AS avg_web_return_value FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN warehouse w ON sr.sr_store_sk = w.w_warehouse_sk JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk WHERE cd.cd_credit_rating = 'Good' AND hd.hd_dep_count BETWEEN 1 AND 3 AND ib.ib_lower_bound >= 50000 AND sr.sr_return_amt > 0 AND wr.wr_return_amt > 0 AND ws.web_county = 'Williamson County' GROUP BY c.c_first_name, c.c_last_name, cd.cd_gender, cd.cd_education_status, hd.hd_buy_potential, hd.hd_vehicle_count, ib.ib_lower_bound, ib.ib_upper_bound, w.w_warehouse_name, w.w_city, w.w_state, ws.web_name, ws.web_manager ORDER BY total_return_value DESC, total_web_return_value DESC LIMIT 100;
SELECT s.s_state, cd.cd_gender, COUNT(DISTINCT s.s_store_sk) AS total_stores, AVG(s.s_floor_space) AS avg_floor_space, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_ext_discount_amt) AS avg_discount_amount FROM store_sales ss JOIN customer_demographics cd ON cd.cd_demo_sk = ss.ss_cdemo_sk JOIN store s ON s.s_store_sk = ss.ss_store_sk WHERE ss.ss_ext_sales_price > 0 AND cd.cd_gender IN ('M', 'F') AND s.s_state IS NOT NULL GROUP BY s.s_state, cd.cd_gender ORDER BY s.s_state, cd.cd_gender, total_sales DESC;
SELECT cc.cc_name, cc.cc_class, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(ss.ss_quantity) AS total_sold_quantity, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_net_profit, cd.cd_gender, cd.cd_marital_status, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers FROM call_center cc JOIN store_returns sr ON cc.cc_call_center_sk = sr.sr_store_sk JOIN store_sales ss ON sr.sr_item_sk = ss.ss_item_sk AND sr.sr_ticket_number = ss.ss_ticket_number JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk WHERE cc.cc_class IN ('large', 'medium', 'small') AND cc.cc_call_center_sk IN (3, 2, 6) AND sr.sr_cdemo_sk IN (864476, 1163495, 1520527) AND sr.sr_return_amt IN (314.00, 13.08, 1010.36) AND cd.cd_gender IN ('F', 'M') AND cd.cd_marital_status IN ('W', 'U', 'D') AND ss.ss_list_price IN (33.74, 25.41, 32.01) AND ss.ss_coupon_amt IN (31.24, 6.48, 7.15) GROUP BY cc.cc_name, cc.cc_class, cd.cd_gender, cd.cd_marital_status ORDER BY total_net_profit DESC;
SELECT cc.cc_country, cc.cc_open_date_sk, i.i_category, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_paid_inc_tax) - SUM(cs.cs_net_paid) AS total_tax_collected, SUM(cs.cs_net_profit) AS total_net_profit, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_net_loss) AS total_net_loss FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number WHERE cc.cc_country = 'United States' AND cc.cc_open_date_sk IN ('2450952', '2450806', '2451063') GROUP BY ROLLUP(cc.cc_country, cc.cc_open_date_sk, i.i_category) ORDER BY cc.cc_country, cc.cc_open_date_sk, i.i_category;
SELECT sm.sm_type, sm.sm_carrier, w.web_site_sk, w.web_mkt_class, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, SUM(ws.ws_net_paid) AS total_net_paid, AVG(ws.ws_net_paid_inc_ship_tax) AS avg_net_paid_inc_ship_tax, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN web_site w ON ws.ws_web_site_sk = w.web_site_sk WHERE ws.ws_net_paid BETWEEN 100 AND 3000 AND sm.sm_code IN ('SEA', 'SURFACE') AND w.web_street_type = 'Road' AND w.web_mkt_class LIKE 'Broad, new groups show car%' GROUP BY ROLLUP(sm.sm_type, sm.sm_carrier, w.web_site_sk, w.web_mkt_class) ORDER BY total_net_profit DESC, total_quantity DESC, avg_net_paid_inc_ship_tax DESC;
SELECT ca_state, ca_city, SUM(cs_net_paid_inc_tax) AS total_sales, AVG(cs_net_paid_inc_tax) AS avg_sales, COUNT(DISTINCT cs_order_number) AS num_sales_orders, SUM(cr_return_amt_inc_tax) AS total_returns, AVG(cr_return_amt_inc_tax) AS avg_returns, COUNT(DISTINCT cr_order_number) AS num_return_orders, SUM(cr_net_loss) AS total_net_loss FROM customer_address JOIN catalog_sales ON cs_bill_addr_sk = ca_address_sk LEFT JOIN catalog_returns ON cr_order_number = cs_order_number JOIN web_sales ON ws_order_number = cs_order_number JOIN time_dim ON ws_sold_time_sk = t_time_sk JOIN web_page ON ws_web_page_sk = wp_web_page_sk WHERE t_sub_shift = 'night' AND ws_ship_date_sk = 2450935 AND ws_web_page_sk IN (41, 3, 18, 4, 45) AND wp_creation_date_sk IN (2450810, 2450808, 2450812, 2450809) GROUP BY ca_state, ca_city ORDER BY ca_state, ca_city;
SELECT wsit.web_name AS website_name, wsit.web_class AS website_class, wsit.web_manager AS website_manager, cc.cc_name AS call_center_name, cc.cc_manager AS call_center_manager, SUM(cs.cs_net_paid) AS total_catalog_sales, AVG(cs.cs_net_paid) AS avg_catalog_sales, COUNT(DISTINCT cs.cs_order_number) AS total_catalog_orders, SUM(ws.ws_net_paid) AS total_web_sales, AVG(ws.ws_net_paid) AS avg_web_sales, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders FROM web_sales ws JOIN web_site wsit ON ws.ws_web_site_sk = wsit.web_site_sk LEFT JOIN catalog_sales cs ON ws.ws_order_number = cs.cs_order_number LEFT JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk WHERE wsit.web_country = 'United States' AND (cc.cc_division_name IN ('anti', 'ought', 'pri', 'ese') OR cc.cc_division_name IS NULL) GROUP BY wsit.web_name, wsit.web_class, wsit.web_manager, cc.cc_name, cc.cc_manager ORDER BY total_catalog_sales DESC, total_web_sales DESC;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, COUNT(c.c_customer_sk) AS num_customers, SUM(CASE WHEN p.p_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS num_promotions_used, AVG(hd.hd_vehicle_count) AS avg_vehicles_per_household, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses_involved FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk LEFT JOIN promotion p ON p.p_start_date_sk <= c.c_first_sales_date_sk AND p.p_end_date_sk >= c.c_first_sales_date_sk JOIN warehouse w ON w.w_state = cd.cd_credit_rating WHERE cd.cd_purchase_estimate > 500 AND hd.hd_buy_potential IN ('5001-10000', '>10000') AND p.p_discount_active = 'Y' GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating ORDER BY avg_purchase_estimate DESC, num_customers DESC LIMIT 100;
SELECT web.web_name, web.web_class, web.web_manager, web.web_mkt_class, time_dim.t_hour, time_dim.t_shift, COUNT(cs.cs_order_number) as total_orders, SUM(cs.cs_quantity) as total_quantity, AVG(cs.cs_sales_price) as average_sales_price, SUM(cs.cs_ext_sales_price) as total_extended_sales_price, SUM(cs.cs_ext_discount_amt) as total_discount_amount, SUM(cs.cs_net_paid) as total_net_paid, SUM(cs.cs_net_profit) as total_net_profit FROM catalog_sales cs JOIN time_dim ON cs.cs_sold_time_sk = time_dim.t_time_sk JOIN web_site web ON cs.cs_call_center_sk = web.web_site_sk WHERE cs.cs_item_sk IN (46, 5) AND cs.cs_ext_sales_price IN (240.00, 708.63) AND web.web_site_id IN ('AAAAAAAAHAAAAAAA', 'AAAAAAAAOAAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAAEAAAAAAA', 'AAAAAAAADBAAAAAA') AND web.web_class <> 'Unknown' GROUP BY web.web_name, web.web_class, web.web_manager, web.web_mkt_class, time_dim.t_hour, time_dim.t_shift ORDER BY web.web_name, time_dim.t_hour, time_dim.t_shift;
SELECT COUNT(DISTINCT cc.cc_call_center_sk) AS num_call_centers, AVG(cc.cc_employees) AS avg_employees, SUM(sr.sr_return_amt_inc_tax) AS total_store_returns_inc_tax, AVG(wr.wr_return_amt_inc_tax) AS avg_web_returns_inc_tax, COUNT(DISTINCT wr.wr_web_page_sk) AS num_web_pages_with_returns, COUNT(DISTINCT sr.sr_reason_sk) AS num_unique_return_reasons_store, COUNT(DISTINCT wr.wr_reason_sk) AS num_unique_return_reasons_web, SUM(CASE WHEN sr.sr_return_quantity > 0 THEN 1 ELSE 0 END) AS num_store_returns_with_quantity, SUM(CASE WHEN wr.wr_return_quantity > 0 THEN 1 ELSE 0 END) AS num_web_returns_with_quantity, SUM(CASE WHEN ws.web_mkt_id = 3 THEN 1 ELSE 0 END) AS num_websites_market_id_3 FROM call_center cc LEFT JOIN store_returns sr ON cc.cc_call_center_sk = sr.sr_store_sk LEFT JOIN web_returns wr ON cc.cc_call_center_sk = wr.wr_refunded_addr_sk LEFT JOIN web_site ws ON cc.cc_call_center_sk = ws.web_site_sk GROUP BY cc.cc_division ORDER BY total_store_returns_inc_tax DESC;
SELECT hd.hd_buy_potential, COUNT(hd.hd_demo_sk) AS households_count, AVG(hd.hd_dep_count) AS avg_dependents_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, SUM(CASE WHEN ib.ib_lower_bound >= 60001 AND ib.ib_upper_bound <= 180001 THEN 1 ELSE 0 END) AS mid_income_band_households, SUM(CASE WHEN ib.ib_lower_bound < 60001 THEN 1 ELSE 0 END) AS low_income_band_households, SUM(CASE WHEN ib.ib_lower_bound > 180001 THEN 1 ELSE 0 END) AS high_income_band_households FROM household_demographics hd JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk GROUP BY hd.hd_buy_potential ORDER BY hd.hd_buy_potential;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_ext_discount_amt) AS avg_discount_amount, COUNT(DISTINCT ss.ss_ticket_number) AS total_tickets, COUNT(DISTINCT p.p_promo_sk) AS total_promotions FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE p.p_channel_dmail = 'Y' AND ss.ss_sold_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_sales DESC, avg_discount_amount DESC;
SELECT d_year, i_category, s_store_name, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS avg_sales_price, SUM(ss_net_profit) AS total_net_profit, COUNT(DISTINCT ss_customer_sk) AS unique_customers, AVG(hd_dep_count) AS avg_household_dep_count, AVG(hd_vehicle_count) AS avg_household_vehicle_count FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN item ON ss_item_sk = i_item_sk JOIN store ON ss_store_sk = s_store_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk WHERE d_year = 2001 AND i_category_id IN ('3', '7', '4', '6') AND hd_income_band_sk IN ('7', '3', '9', '15', '20', '18') GROUP BY d_year, i_category, s_store_name ORDER BY total_net_profit DESC, avg_sales_price DESC LIMIT 100;
SELECT c.c_birth_country, sm.sm_type AS shipping_type, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_ext_tax) AS total_tax_collected, SUM(ws.ws_coupon_amt) AS total_coupon_amount, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk GROUP BY c.c_birth_country, sm.sm_type ORDER BY c.c_birth_country, sm.sm_type;
SELECT ws.web_class, ws.web_market_manager, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS number_of_orders, SUM(wr.wr_return_quantity) AS total_quantity_returned, SUM(wr.wr_net_loss) AS total_net_loss FROM catalog_sales cs JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number JOIN web_site ws ON cs.cs_warehouse_sk = ws.web_site_sk WHERE cs.cs_sold_date_sk IS NOT NULL AND wr.wr_returned_date_sk IS NOT NULL AND ws.web_close_date_sk IN ('2447080', '2447148', '2448752', '2448854', '2448956', '2448820') AND ws.web_mkt_desc IN ('Concerned, royal weeks should announce.', 'Companies grow cells. Apart true eyes u', 'Formerly long minds deal aside parties. Lef', 'Political affairs ought to') GROUP BY ws.web_class, ws.web_market_manager ORDER BY total_quantity_sold DESC, total_net_loss ASC;
SELECT s.s_store_name, s.s_city, s.s_state, COUNT(DISTINCT c.c_customer_sk) AS number_of_customers, SUM(cd.cd_purchase_estimate) AS total_purchase_estimate, AVG(cd.cd_dep_count) AS avg_dependents, AVG(cd.cd_dep_employed_count) AS avg_employed_dependents, AVG(cd.cd_dep_college_count) AS avg_college_dependents, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, ib.ib_lower_bound AS income_band_lower_bound, ib.ib_upper_bound AS income_band_upper_bound FROM store s JOIN customer c ON s.s_store_sk = c.c_current_addr_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE s.s_rec_start_date = '2001-03-13' AND s.s_number_employees IN (229, 271) AND EXISTS ( SELECT 1 FROM web_page wp WHERE wp.wp_customer_sk = c.c_customer_sk AND wp.wp_access_date_sk IN (2452583, 2452648) ) GROUP BY s.s_store_name, s.s_city, s.s_state, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY s.s_store_name, s.s_city, s.s_state;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, SUM(cr.cr_return_amount) AS total_refunds, AVG(cr.cr_return_amount) AS avg_refund_amount, COUNT(*) AS total_return_instances, ws.web_name, ws.web_manager FROM catalog_returns cr JOIN customer c ON cr.cr_returning_customer_sk = c.c_customer_sk JOIN web_site ws ON cr.cr_call_center_sk = ws.web_site_sk WHERE cr.cr_returned_date_sk IN ('2451001', '2450970') AND c.c_birth_year = '1936' AND cr.cr_returning_cdemo_sk IN ('1683351', '1010437', '1147434', '1904377', '447632') AND c.c_customer_id IN ('AAAAAAAAKFNAAAAA', 'AAAAAAAAAFABAAAA') GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, ws.web_name, ws.web_manager ORDER BY total_refunds DESC;
SELECT wp.wp_type AS web_page_type, i.i_brand AS item_brand, ca.ca_state AS customer_state, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_items_sold, SUM(ws.ws_sales_price) AS total_sales, AVG(i.i_wholesale_cost) AS average_wholesale_cost FROM web_sales ws JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN customer_address ca ON ws.ws_ship_addr_sk = ca.ca_address_sk WHERE wp.wp_autogen_flag = 'Y' AND wp.wp_type IN ('order', 'dynamic') AND i.i_brand IN ('brandunivamalg #10', 'scholarbrand #7', 'maxibrand #2') GROUP BY web_page_type, item_brand, customer_state ORDER BY total_sales DESC, total_orders DESC LIMIT 10;
SELECT d_year, web_country, SUM(ws_net_paid_inc_ship_tax) AS total_revenue, AVG(ws_net_paid_inc_ship_tax) AS avg_order_value, COUNT(DISTINCT ws_order_number) AS total_orders, SUM(ws_quantity) AS total_units_sold, SUM(ws_ext_wholesale_cost) AS total_cost, (SUM(ws_net_paid_inc_ship_tax) - SUM(ws_ext_wholesale_cost)) AS total_profit FROM web_sales JOIN web_site ON ws_web_site_sk = web_site_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk WHERE web_country = 'United States' AND d_year = 2001 GROUP BY d_year, web_country ORDER BY total_revenue DESC;
SELECT d_year, c_preferred_cust_flag, cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT cr_order_number) AS total_returns, COUNT(DISTINCT cr_returning_customer_sk) AS distinct_returning_customers FROM catalog_returns JOIN date_dim ON catalog_returns.cr_returned_date_sk = date_dim.d_date_sk JOIN customer ON catalog_returns.cr_returning_customer_sk = customer.c_customer_sk JOIN customer_demographics ON customer.c_current_cdemo_sk = customer_demographics.cd_demo_sk WHERE d_year = 2003 AND cd_dep_count IN ('1', '2') AND c_birth_day IN (6, 20) AND cr_warehouse_sk IN (1, 2, 4) AND c_current_addr_sk IN (28702, 39227, 11533, 21702) GROUP BY d_year, c_preferred_cust_flag, cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate ORDER BY total_return_amount DESC, avg_return_quantity DESC, total_returns DESC, distinct_returning_customers DESC;
SELECT wd.web_class, COUNT(DISTINCT cr.cr_item_sk) AS unique_refunded_items, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_refunded_customers, SUM(cr.cr_return_amt_inc_tax + cr.cr_fee + cr.cr_return_ship_cost) AS total_refund_cost, AVG(cr.cr_return_amt_inc_tax) AS avg_refund_amount_inc_tax, cd.cd_education_status, COUNT(*) AS number_of_returns FROM catalog_returns cr JOIN customer_demographics cd ON cr.cr_refunded_cdemo_sk = cd.cd_demo_sk JOIN web_site wd ON wd.web_country = 'United States' AND wd.web_class IS NOT NULL WHERE EXISTS (SELECT 1 FROM inventory WHERE inv_item_sk = cr.cr_item_sk AND inv_quantity_on_hand > 500) GROUP BY wd.web_class, cd.cd_education_status ORDER BY total_refund_cost DESC, avg_refund_amount_inc_tax DESC, number_of_returns DESC;
SELECT ca_state, cd_education_status, COUNT(DISTINCT c_customer_sk) AS total_customers, SUM(cd_purchase_estimate) AS total_purchase_estimate, AVG(cd_dep_count) AS average_dependents, SUM(CASE WHEN cd_gender = 'F' THEN 1 ELSE 0 END) AS female_customers, SUM(CASE WHEN cd_gender = 'M' THEN 1 ELSE 0 END) AS male_customers, COUNT(DISTINCT r_reason_sk) AS total_return_reasons, COUNT(DISTINCT i_item_sk) AS total_items_sold, SUM(inv_quantity_on_hand) AS total_inventory_quantity, AVG(i_current_price) AS average_item_price FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN inventory inv ON inv.inv_warehouse_sk = c.c_current_addr_sk JOIN item i ON i.i_item_sk = inv.inv_item_sk LEFT JOIN reason r ON r.r_reason_sk = inv.inv_warehouse_sk WHERE ca.ca_street_number IN ('470', '984', '743') AND cd_education_status IN ('College', 'Unknown', 'Advanced Degree', '2 yr Degree') AND cd_dep_employed_count = '0' AND ca_state IN (SELECT cc_state FROM call_center WHERE cc_street_name IN ('Center Hill', 'Pine Ridge', 'Ash Hill')) GROUP BY ca_state, cd_education_status ORDER BY total_customers DESC, total_purchase_estimate DESC;
SELECT ws.web_name, ws.web_class, ws.web_manager, ws.web_market_manager, COUNT(DISTINCT wp.wp_web_page_sk) AS total_pages, AVG(wp.wp_char_count) AS avg_char_count, SUM(wp.wp_link_count) AS total_link_count, SUM(wp.wp_image_count) AS total_image_count, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_fee) AS avg_return_fee, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS preferred_customer_count FROM web_site ws LEFT JOIN web_page wp ON ws.web_site_sk = wp.wp_customer_sk LEFT JOIN web_returns wr ON wp.wp_web_page_sk = wr.wr_web_page_sk LEFT JOIN customer c ON wr.wr_returning_customer_sk = c.c_customer_sk GROUP BY ws.web_name, ws.web_class, ws.web_manager, ws.web_market_manager ORDER BY total_return_amount DESC, total_pages DESC LIMIT 100;
SELECT ca_state, sm_type, COUNT(*) AS total_returns, SUM(cr_return_quantity) AS total_returned_quantity, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_amt_inc_tax) AS total_return_amount_inc_tax, AVG(cr_fee) AS avg_fee, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns JOIN customer_address ON catalog_returns.cr_returning_addr_sk = customer_address.ca_address_sk JOIN ship_mode ON catalog_returns.cr_ship_mode_sk = ship_mode.sm_ship_mode_sk JOIN time_dim ON catalog_returns.cr_returned_time_sk = time_dim.t_time_sk JOIN household_demographics ON catalog_returns.cr_returning_hdemo_sk = household_demographics.hd_demo_sk WHERE cr_return_amt_inc_tax > 1000.00 AND time_dim.t_minute IN (40, 31, 37) AND time_dim.t_shift = 'third' AND household_demographics.hd_buy_potential IN ('5001-10000', '1001-5000', '>10000') AND household_demographics.hd_demo_sk = 2502 GROUP BY ca_state, sm_type ORDER BY total_return_amount_inc_tax DESC, avg_return_amount DESC;
SELECT ca_state, ca_country, w_state, w_country, SUM(sr_return_quantity) AS total_returned_quantity, AVG(sr_return_amt) AS average_return_amount, SUM(sr_fee) AS total_fees, COUNT(DISTINCT sr_customer_sk) AS unique_customers_returning, COUNT(DISTINCT sr_ticket_number) AS total_return_transactions FROM store_returns JOIN customer_address ON store_returns.sr_addr_sk = customer_address.ca_address_sk JOIN warehouse ON store_returns.sr_store_sk = warehouse.w_warehouse_sk WHERE customer_address.ca_gmt_offset IN (-6.00, -10.00, -8.00, -9.00, -7.00) AND warehouse.w_zip = '35709' AND store_returns.sr_addr_sk = '47239' GROUP BY ca_state, ca_country, w_state, w_country ORDER BY ca_state, ca_country;
SELECT d_year, d_quarter_name, p_promo_name, COUNT(DISTINCT sr_ticket_number) AS total_returns, SUM(sr_return_quantity) AS total_returned_quantity, AVG(sr_return_amt) AS avg_return_amount, SUM(sr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(sr_net_loss) AS total_net_loss, COUNT(DISTINCT sr_customer_sk) AS distinct_customers_returning, COUNT(DISTINCT sr_item_sk) AS distinct_items_returned FROM store_returns sr JOIN date_dim ON sr.sr_returned_date_sk = date_dim.d_date_sk JOIN promotion ON sr.sr_returned_date_sk BETWEEN promotion.p_start_date_sk AND promotion.p_end_date_sk WHERE d_year = 2000 AND promotion.p_channel_radio = 'N' AND promotion.p_discount_active = 'Y' GROUP BY d_year, d_quarter_name, p_promo_name ORDER BY d_year, d_quarter_name, p_promo_name;
SELECT cp.cp_department, cp.cp_type, COUNT(DISTINCT ws.ws_web_page_sk) AS total_web_pages, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ws.ws_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(ws.ws_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(ws.ws_net_profit) AS total_net_profit FROM catalog_page cp JOIN web_sales ws ON cp.cp_catalog_page_sk = ws.ws_web_page_sk WHERE cp.cp_end_date_sk = 2451114 AND ws.ws_ext_discount_amt = 2691.00 GROUP BY cp.cp_department, cp.cp_type ORDER BY total_net_paid DESC;
SELECT p.p_promo_name, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, AVG(sr.sr_return_amt) AS avg_return_amount, r.r_reason_desc AS most_common_return_reason, COUNT(*) AS reason_count FROM store_returns sr JOIN promotion p ON sr.sr_item_sk = p.p_item_sk JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk LEFT JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE sr.sr_store_sk IN (1, 4, 8) AND p.p_item_sk IN (13903, 4790, 11371, 10280, 11452) AND hd.hd_vehicle_count IN (3, 1) GROUP BY p.p_promo_name, r.r_reason_desc ORDER BY total_returns DESC, avg_return_amount DESC, reason_count DESC LIMIT 100;
SELECT dd.d_year, dd.d_quarter_name, COUNT(sr.sr_ticket_number) AS store_return_count, SUM(sr.sr_return_amt_inc_tax) AS store_total_return_amount_inc_tax, AVG(sr.sr_return_quantity) AS store_avg_return_quantity, SUM(sr.sr_net_loss) AS store_total_net_loss, COUNT(wr.wr_order_number) AS web_return_count, SUM(wr.wr_return_amt_inc_tax) AS web_total_return_amount_inc_tax, AVG(wr.wr_return_quantity) AS web_avg_return_quantity, SUM(wr.wr_net_loss) AS web_total_net_loss FROM date_dim dd LEFT JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk LEFT JOIN web_returns wr ON dd.d_date_sk = wr.wr_returned_date_sk AND wr.wr_returning_addr_sk = '49674' WHERE dd.d_year = 2023 AND dd.d_quarter_seq BETWEEN 202301 AND 202304 GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT i.i_category, i.i_brand, AVG(cs.cs_quantity) AS avg_catalog_quantity, AVG(ws.ws_quantity) AS avg_web_quantity, SUM(cs.cs_net_paid) AS total_catalog_sales, SUM(ws.ws_net_paid) AS total_web_sales, COUNT(DISTINCT cs.cs_order_number) AS num_catalog_orders, COUNT(DISTINCT ws.ws_order_number) AS num_web_orders, COUNT(DISTINCT cs.cs_promo_sk) AS num_catalog_promotions, COUNT(DISTINCT ws.ws_promo_sk) AS num_web_promotions FROM item i LEFT JOIN catalog_sales cs ON i.i_item_sk = cs.cs_item_sk LEFT JOIN web_sales ws ON i.i_item_sk = ws.ws_item_sk GROUP BY i.i_category, i.i_brand ORDER BY i.i_category, i.i_brand;
SELECT d_year, i_category, i_class, SUM(ws_sales_price) AS total_sales, AVG(ws_sales_price) AS avg_sales_price, COUNT(DISTINCT ws_order_number) AS num_orders, SUM(sr_return_amt) AS total_returns, AVG(sr_return_amt) AS avg_return_amt, COUNT(DISTINCT sr_ticket_number) AS num_returns, SUM(ws_net_profit) - SUM(sr_net_loss) AS net_profit FROM web_sales JOIN item ON ws_item_sk = i_item_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk LEFT JOIN store_returns ON sr_item_sk = ws_item_sk AND sr_returned_date_sk = ws_sold_date_sk WHERE d_year = 2002 AND (i_category = 'Electronics' OR i_category = 'Books') AND ws_sales_price > 0 GROUP BY d_year, i_category, i_class ORDER BY d_year, i_category, i_class;
SELECT dd.d_year AS year, dd.d_quarter_name AS quarter, SUM(cs.cs_net_profit) AS total_sales_net_profit, SUM(sr.sr_net_loss) AS total_returns_net_loss, AVG(cd.cd_purchase_estimate) AS avg_customer_purchase_estimate, COUNT(DISTINCT cs.cs_order_number) AS total_sales_orders, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_tickets, COUNT(DISTINCT s.s_store_sk) AS total_stores, COUNT(DISTINCT inv.inv_warehouse_sk) AS total_warehouses FROM date_dim dd LEFT JOIN catalog_sales cs ON dd.d_date_sk = cs.cs_sold_date_sk LEFT JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk LEFT JOIN customer_demographics cd ON (cs.cs_bill_cdemo_sk = cd.cd_demo_sk OR sr.sr_cdemo_sk = cd.cd_demo_sk) LEFT JOIN store s ON sr.sr_store_sk = s.s_store_sk LEFT JOIN inventory inv ON dd.d_date_sk = inv.inv_date_sk WHERE dd.d_fy_year = 2003 AND dd.d_fy_quarter_seq = 1 AND cd.cd_credit_rating = 'Low Risk' AND s.s_manager = 'William Ward' GROUP BY year, quarter ORDER BY year, quarter;
SELECT p_promo_name, SUM(cs_quantity) AS total_quantity_sold, SUM(cs_net_paid) AS total_revenue, AVG(cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cr_return_quantity) AS total_quantity_returned, SUM(cr_return_amount) AS total_returns, AVG(sr_return_amt) AS average_return_amount, COUNT(DISTINCT sr_ticket_number) AS total_return_tickets FROM catalog_sales JOIN promotion ON cs_promo_sk = p_promo_sk AND p_channel_tv = 'N' LEFT JOIN catalog_returns ON cs_item_sk = cr_item_sk AND cs_order_number = cr_order_number LEFT JOIN store_returns ON cs_item_sk = sr_item_sk AND sr_store_sk IN ('8', '2', '10', '4') WHERE cs_ship_date_sk = 2450936 GROUP BY p_promo_name ORDER BY total_revenue DESC;
SELECT cp.cp_department, s.s_state, AVG(sr.sr_net_loss) AS avg_net_loss, AVG(s.s_floor_space) AS avg_store_floor_space, AVG(sr.sr_return_quantity) AS avg_items_returned FROM store_returns sr INNER JOIN store s ON sr.sr_store_sk = s.s_store_sk INNER JOIN catalog_page cp ON s.s_market_id = cp.cp_catalog_number INNER JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk WHERE s.s_rec_end_date IS NULL AND ca.ca_location_type = 'condo' AND s.s_company_id = 1 GROUP BY cp.cp_department, s.s_state ORDER BY avg_net_loss DESC, avg_store_floor_space DESC, avg_items_returned DESC LIMIT 10;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_class, ca.ca_street_type, COUNT(distinct ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_net_paid, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(distinct ss.ss_customer_sk) AS unique_customers_served FROM store_sales ss JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk JOIN call_center cc ON cc.cc_class IN ('small', 'medium', 'large') LEFT JOIN reason r ON r.r_reason_desc = 'reason 31' WHERE ca.ca_street_type IN ('Pkwy', 'Court') AND r.r_reason_sk IS NULL GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_class, ca.ca_street_type ORDER BY total_net_profit DESC, total_sales_transactions DESC;
SELECT sm.sm_type, w.w_state, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_net_loss) AS total_net_loss, SUM(cs.cs_sales_price) AS total_sales, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_net_profit, SUM(i.inv_quantity_on_hand) AS total_inventory_on_hand FROM catalog_returns cr JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN catalog_sales cs ON cr.cr_item_sk = cs.cs_item_sk AND cr.cr_order_number = cs.cs_order_number JOIN inventory i ON cr.cr_item_sk = i.inv_item_sk AND w.w_warehouse_sk = i.inv_warehouse_sk WHERE cr.cr_returning_customer_sk IN ('98306', '44541', '85') GROUP BY sm.sm_type, w.w_state ORDER BY total_net_loss DESC;
SELECT s.s_store_name, s.s_street_name, s.s_street_type, s.s_city, s.s_state, s.s_zip, SUM(sr.sr_return_amt_inc_tax) AS total_store_refunds, AVG(sr.sr_return_amt_inc_tax) AS avg_store_refund, COUNT(sr.sr_return_amt_inc_tax) AS num_store_returns, SUM(wr.wr_return_amt_inc_tax) AS total_web_refunds, AVG(wr.wr_return_amt_inc_tax) AS avg_web_refund, COUNT(wr.wr_return_amt_inc_tax) AS num_web_returns FROM store s LEFT JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk LEFT JOIN date_dim d_store ON sr.sr_returned_date_sk = d_store.d_date_sk LEFT JOIN web_returns wr ON s.s_store_sk = wr.wr_returning_customer_sk LEFT JOIN date_dim d_web ON wr.wr_returned_date_sk = d_web.d_date_sk WHERE s.s_street_type IN ('Road', 'Circle', 'Court') AND (d_store.d_quarter_name = '1906Q2' OR d_web.d_quarter_name = '1906Q2') GROUP BY s.s_store_name, s.s_street_name, s.s_street_type, s.s_city, s.s_state, s.s_zip ORDER BY total_store_refunds DESC, total_web_refunds DESC;
SELECT ca.ca_state, ca.ca_country, COUNT(DISTINCT c.c_customer_sk) AS num_customers, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_return_tax) AS total_return_tax, AVG(sr.sr_return_amt) AS avg_return_amount_per_customer, SUM(sr.sr_net_loss) AS total_net_loss FROM customer c JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN income_band ib ON c.c_current_hdemo_sk = ib.ib_income_band_sk WHERE c.c_preferred_cust_flag = 'Y' AND ib.ib_income_band_sk IN (2, 6, 14, 17, 19) AND ib.ib_upper_bound <= 30000 GROUP BY ca.ca_state, ca.ca_country ORDER BY total_return_amount DESC, ca.ca_state, ca.ca_country;
SELECT ca.ca_state, i.i_category, SUM(cs.cs_sales_price) AS total_sales, AVG(cs.cs_net_profit) AS avg_net_profit, COUNT(DISTINCT cs.cs_order_number) AS order_count FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk WHERE ca.ca_location_type = 'single family' AND i.i_brand_id IN ('9013007', '10012013', '9001003', '7015010', '7010010', '10007007') AND cs.cs_net_paid_inc_ship_tax BETWEEN 100 AND 5000 AND ca.ca_county IN ('Wahkiakum County', 'Murray County') GROUP BY ca.ca_state, i.i_category ORDER BY total_sales DESC, avg_net_profit DESC;
SELECT i.i_category, i.i_class, i.i_brand, sum(ss.ss_quantity) AS total_quantity_sold, avg(ss.ss_sales_price) AS average_sales_price, sum(ss.ss_net_profit) AS total_net_profit, count(DISTINCT ss.ss_ticket_number) AS number_of_transactions, sum(ss.ss_coupon_amt) AS total_coupon_amount, ib.ib_lower_bound, ib.ib_upper_bound, date_dim.d_year, date_dim.d_quarter_name, COUNT(DISTINCT case when ss.ss_coupon_amt > 0 THEN ss.ss_ticket_number END) AS transactions_with_coupons FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN date_dim ON ss.ss_sold_date_sk = date_dim.d_date_sk WHERE date_dim.d_year IN (2019, 2020) AND ib.ib_lower_bound >= 0 AND ib.ib_upper_bound <= 130000 GROUP BY i.i_category, i.i_class, i.i_brand, ib.ib_lower_bound, ib.ib_upper_bound, date_dim.d_year, date_dim.d_quarter_name ORDER BY total_net_profit DESC, total_quantity_sold DESC LIMIT 100;
SELECT d_year, d_qoy, cc_name, COUNT(DISTINCT cr_order_number) AS num_returns, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, COUNT(DISTINCT sr_ticket_number) AS num_store_returns, SUM(sr_return_amt) AS total_store_return_amount, AVG(sr_return_amt) AS avg_store_return_amount, SUM(hd_dep_count) AS total_dependants, AVG(hd_vehicle_count) AS avg_vehicles FROM date_dim JOIN catalog_returns ON cr_returned_date_sk = d_date_sk JOIN call_center ON cr_call_center_sk = cc_call_center_sk JOIN store_returns ON sr_returned_date_sk = d_date_sk JOIN household_demographics ON cr_returning_hdemo_sk = hd_demo_sk AND sr_hdemo_sk = hd_demo_sk WHERE d_qoy = 2 AND d_following_holiday = 'Y' AND hd_income_band_sk = 15 AND (cr_item_sk IN (10036, 2977) OR sr_item_sk IN (10036, 2977)) AND (cr_refunded_customer_sk IN (78674, 95319, 63625, 45060, 53817, 43545) OR sr_customer_sk IN (78674, 95319, 63625, 45060, 53817, 43545)) AND cc_street_name IN ('Center Hill', 'Pine Ridge', 'Ash Hill') GROUP BY d_year, d_qoy, cc_name ORDER BY d_year, d_qoy, cc_name;
SELECT dd.d_year, dd.d_quarter_name, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, SUM(sr.sr_return_amt_inc_tax) AS total_store_return_value, AVG(sr.sr_return_amt_inc_tax) AS avg_store_return_value, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_returns, SUM(cr.cr_return_amt_inc_tax) AS total_catalog_return_value, AVG(cr.cr_return_amt_inc_tax) AS avg_catalog_return_value, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(inv.inv_quantity_on_hand) AS avg_inventory, COUNT(DISTINCT p.p_promo_sk) AS total_promotions, SUM(p.p_cost) AS total_promotion_cost, AVG(p.p_cost) AS avg_promotion_cost FROM date_dim dd LEFT JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk LEFT JOIN catalog_returns cr ON dd.d_date_sk = cr.cr_returned_date_sk LEFT JOIN inventory inv ON dd.d_date_sk = inv.inv_date_sk LEFT JOIN promotion p ON dd.d_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk WHERE dd.d_current_quarter = 'N' AND dd.d_dow IN ('2', '1', '3') AND dd.d_week_seq IN ('357', '270', '599') AND dd.d_day_name IN ('Friday', 'Wednesday', 'Thursday') AND cr.cr_refunded_cash IN ('41.98', '2827.18', '326.60') AND cr.cr_return_tax IN ('78.35', '1.90', '17.50') AND cr.cr_reason_sk IN ('10', '6', '34') AND inv.inv_date_sk = '2450815' AND inv.inv_quantity_on_hand IN ('527', '833', '192') AND sr.sr_store_credit IN ('65.83', '69.57', '46.64') AND sr.sr_return_amt_inc_tax IN ('1345.99', '37.28', '546.00') AND sr.sr_hdemo_sk IN ('5161', '6269', '797') AND p.p_channel_radio = 'N' AND p.p_channel_press = 'N' GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT cs.cs_bill_customer_sk AS customer_sk, SUM(cs.cs_net_paid) AS total_sales, SUM(cr.cr_refunded_cash) AS total_catalog_refunds, SUM(wr.wr_refunded_cash) AS total_web_refunds, SUM(cr.cr_net_loss) AS total_catalog_net_loss, SUM(wr.wr_net_loss) AS total_web_net_loss, (SUM(cs.cs_net_paid) - SUM(cr.cr_refunded_cash) - SUM(wr.wr_refunded_cash)) AS net_amount_paid_after_refunds FROM catalog_sales cs LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number AND cs.cs_item_sk = cr.cr_item_sk LEFT JOIN web_returns wr ON cs.cs_order_number = wr.wr_order_number AND cs.cs_item_sk = wr.wr_item_sk GROUP BY cs.cs_bill_customer_sk HAVING cs.cs_bill_customer_sk IS NOT NULL ORDER BY net_amount_paid_after_refunds DESC;
SELECT ws.web_site_id, ws.web_name, td.t_shift, td.t_hour, COUNT(wr.wr_order_number) AS return_count, SUM(wr.wr_return_quantity) AS total_return_quantity, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amt_inc_tax, SUM(wr.wr_return_amt_inc_tax) AS sum_return_amt_inc_tax, SUM(wr.wr_fee) AS total_fee, SUM(wr.wr_return_ship_cost) AS total_return_ship_cost, SUM(wr.wr_net_loss) AS total_net_loss FROM web_returns wr JOIN time_dim td ON wr.wr_returned_time_sk = td.t_time_sk JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk WHERE wr.wr_return_amt_inc_tax >= 100.00 AND td.t_shift = 'Evening' GROUP BY ws.web_site_id, ws.web_name, td.t_shift, td.t_hour ORDER BY ws.web_site_id, td.t_hour;
SELECT cd.cd_gender, cd.cd_credit_rating, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, COUNT(cd.cd_demo_sk) AS customer_count, hd.hd_income_band_sk, s.s_state, COUNT(DISTINCT s.s_store_sk) AS store_count FROM customer_demographics cd JOIN customer_address ca ON ca.ca_address_sk = cd.cd_demo_sk JOIN household_demographics hd ON cd.cd_demo_sk = hd.hd_demo_sk JOIN store s ON s.s_state = ca.ca_state GROUP BY cd.cd_gender, cd.cd_credit_rating, hd.hd_income_band_sk, s.s_state ORDER BY cd.cd_gender, cd.cd_credit_rating, hd.hd_income_band_sk, s.s_state;
SELECT r_reason_desc, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, COUNT(*) AS return_count, SUM(cs_net_profit) AS total_sales_net_profit, AVG(cs_net_profit) AS avg_sales_net_profit, COUNT(DISTINCT cs_order_number) AS sales_order_count, SUM(ws_net_profit) AS total_web_net_profit, AVG(ws_net_profit) AS avg_web_net_profit, COUNT(DISTINCT ws_order_number) AS web_order_count FROM catalog_returns JOIN reason ON catalog_returns.cr_reason_sk = reason.r_reason_sk LEFT JOIN catalog_sales ON catalog_returns.cr_item_sk = catalog_sales.cs_item_sk AND catalog_returns.cr_order_number = catalog_sales.cs_order_number LEFT JOIN web_sales ON catalog_returns.cr_item_sk = web_sales.ws_item_sk AND catalog_returns.cr_order_number = web_sales.ws_order_number WHERE catalog_returns.cr_returned_date_sk BETWEEN 2451276 AND 2451276 + 30 AND catalog_returns.cr_return_tax BETWEEN 0 AND 200 AND (catalog_sales.cs_ship_cdemo_sk = 568017 OR web_sales.ws_sold_date_sk = 2451276) AND (catalog_sales.cs_promo_sk IN (253, 289, 228) OR web_sales.ws_promo_sk IN (253, 289, 228)) AND reason.r_reason_id IN ('AAAAAAAAIBAAAAAA', 'AAAAAAAABCAAAAAA', 'AAAAAAAAOBAAAAAA', 'AAAAAAAAMAAAAAAA') GROUP BY r_reason_desc ORDER BY total_return_amount DESC, total_sales_net_profit DESC, total_web_net_profit DESC;
SELECT cp.cp_department, cp.cp_catalog_number, w.w_city, w.w_state, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(ss.ss_quantity) AS total_sales_quantity, SUM(ss.ss_sales_price) AS total_sales_amount, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions FROM catalog_page cp JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk JOIN store_sales ss ON cr.cr_item_sk = ss.ss_item_sk AND cr.cr_order_number = ss.ss_ticket_number JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE w.w_gmt_offset = '-5.00' AND (cp.cp_start_date_sk IS NOT NULL AND cp.cp_end_date_sk IS NOT NULL) AND (ib.ib_lower_bound > 10000 OR ss.ss_sales_price > 50) AND (cr.cr_return_amount > 0 AND ss.ss_sales_price > 0) AND ss.ss_ticket_number IN ('3322', '3479', '3625', '3649') GROUP BY cp.cp_department, cp.cp_catalog_number, w.w_city, w.w_state, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_sales_amount DESC, average_sales_price DESC, total_returns DESC;
SELECT d_year, d_qoy, hd_income_band_sk, COUNT(DISTINCT ss_customer_sk) AS total_customers, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS avg_sales_price, SUM(ss_net_paid_inc_tax) AS total_revenue, AVG(ws_wholesale_cost) AS avg_wholesale_cost, SUM(ws_net_profit) AS total_web_profit, COUNT(DISTINCT ws_order_number) AS total_web_orders, SUM(wr_return_quantity) AS total_return_quantity, SUM(wr_return_amt_inc_tax) AS total_return_amount FROM date_dim JOIN store_sales ON ss_sold_date_sk = d_date_sk JOIN web_sales ON ws_sold_date_sk = d_date_sk JOIN web_returns ON wr_returned_date_sk = d_date_sk AND ws_item_sk = wr_item_sk JOIN household_demographics ON (ss_hdemo_sk = hd_demo_sk OR ws_ship_hdemo_sk = hd_demo_sk OR wr_returning_hdemo_sk = hd_demo_sk) WHERE d_year = 1999 AND hd_income_band_sk IN (8, 9, 10) AND ss_addr_sk IN (43285, 30010, 21588) AND ss_net_paid_inc_tax > 5000 AND wr_refunded_cdemo_sk IN ('55573', '303149', '71175') AND wr_return_tax IN (12.36, 35.06, 21.54, 6.11, 363.36, 106.37) GROUP BY d_year, d_qoy, hd_income_band_sk ORDER BY total_revenue DESC, total_web_profit DESC;
SELECT s.s_city, COUNT(DISTINCT s.s_store_sk) AS number_of_stores, SUM(s.s_number_employees) AS total_employees, SUM(s.s_floor_space) AS total_floor_space, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_sq_ft, COUNT(DISTINCT cp.cp_catalog_page_sk) AS number_of_catalog_pages FROM store s LEFT JOIN warehouse w ON s.s_city = w.w_city LEFT JOIN catalog_page cp ON cp.cp_catalog_page_number BETWEEN 80 AND 90 WHERE s.s_city IN ('Fairview', 'Midway') AND (s.s_closed_date_sk IS NULL OR s.s_closed_date_sk > CAST(to_char(CURRENT_DATE, 'J') AS INTEGER)) GROUP BY s.s_city ORDER BY s.s_city;
SELECT cp.cp_department, sm.sm_type, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(sr_return_amt) AS total_return_amount, AVG(sr_refunded_cash) AS average_refunded_cash, SUM(cs_net_profit) - SUM(sr_net_loss) AS net_profit_after_returns FROM catalog_sales cs JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN store_returns sr ON cs.cs_item_sk = sr.sr_item_sk AND cs.cs_order_number = sr.sr_ticket_number GROUP BY cp.cp_department, sm.sm_type ORDER BY net_profit_after_returns DESC;
SELECT d_year, w_state AS warehouse_state, sm_type AS shipping_type, p_promo_name, COUNT(DISTINCT cc_call_center_sk) AS number_of_call_centers, SUM(inv_quantity_on_hand) AS total_inventory, AVG(w_warehouse_sq_ft) AS average_warehouse_size, MAX(p_cost) AS max_promotion_cost, MIN(p_cost) AS min_promotion_cost, AVG(p_cost) AS average_promotion_cost, SUM(CASE WHEN p_channel_demo = 'N' THEN p_cost ELSE 0 END) AS sum_cost_non_demo_promotions FROM date_dim JOIN inventory ON inv_date_sk = d_date_sk JOIN warehouse ON w_warehouse_sk = inv_warehouse_sk JOIN ship_mode ON w_zip = sm_ship_mode_id JOIN call_center ON cc_zip = w_zip LEFT JOIN promotion ON p_promo_sk = inv_item_sk WHERE d_year = 1998 AND w_warehouse_sq_ft IN (977787, 294242, 621234, 138504) AND w_zip = '35709' AND d_quarter_seq IN (24, 3) AND d_fy_week_seq IN (444, 401, 706, 517, 70) AND inv_item_sk IN (6008, 6322, 13964, 9541) AND p_channel_demo = 'N' GROUP BY d_year, warehouse_state, shipping_type, p_promo_name ORDER BY d_year, warehouse_state, shipping_type, p_promo_name;
SELECT s.s_store_id, s.s_store_name, i.i_category, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, COUNT(DISTINCT ca.ca_address_sk) AS unique_addresses, SUM(ca.ca_gmt_offset) AS total_gmt_offset FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk WHERE s.s_suite_number = 'Suite 190' AND s.s_division_name <> 'Unknown' AND ca.ca_street_number IN ('142', '497', '990', '467') AND ss.ss_sold_date_sk IS NOT NULL GROUP BY s.s_store_id, s.s_store_name, i.i_category ORDER BY total_net_profit DESC, s.s_store_name, i.i_category;
SELECT dd.d_year, dd.d_month_seq, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS count_unique_sales_transactions, SUM(sr.sr_return_quantity) AS total_quantity_returned, AVG(sr.sr_return_amt) AS avg_return_amount, COUNT(DISTINCT sr.sr_ticket_number) AS count_unique_return_transactions, SUM(p.p_cost) AS total_promotion_cost, COUNT(DISTINCT p.p_promo_sk) AS count_unique_promotions FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk LEFT JOIN store_returns sr ON ss.ss_item_sk = sr.sr_item_sk AND ss.ss_ticket_number = sr.sr_ticket_number LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE p.p_channel_catalog = 'N' AND dd.d_year = 2002 GROUP BY dd.d_year, dd.d_month_seq ORDER BY dd.d_year, dd.d_month_seq;
SELECT i.i_brand_id AS brand_id, i.i_brand AS brand_name, i.i_category_id AS category_id, i.i_category AS category_name, s.s_store_name AS store_name, s.s_city AS store_city, s.s_state AS store_state, to_char(t_hour, 'FM00') || ':' || to_char(t_minute, 'FM00') AS sale_time, COUNT(cs.cs_item_sk) AS total_sales_count, SUM(cs.cs_ext_sales_price) AS total_sales_amount, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_ext_discount_amt) AS total_discount_amount FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN time_dim td ON cs.cs_sold_time_sk = td.t_time_sk JOIN store s ON cs.cs_warehouse_sk = s.s_store_sk WHERE cs.cs_net_paid_inc_ship > 2000 AND cs.cs_ext_discount_amt > 0 GROUP BY i.i_brand_id, i.i_brand, i.i_category_id, i.i_category, s.s_store_name, s.s_city, s.s_state, t_hour, t_minute ORDER BY total_sales_amount DESC, brand_id, category_id, store_name, sale_time;
SELECT c.c_birth_year, r.r_reason_desc, AVG(sr.sr_return_amt_inc_tax) AS avg_store_return_amount_inc_tax, AVG(wr.wr_return_amt_inc_tax) AS avg_web_return_amount_inc_tax, SUM(sr.sr_return_quantity) AS total_store_return_quantity, SUM(wr.wr_return_quantity) AS total_web_return_quantity, AVG(sr.sr_fee) AS avg_store_fee, AVG(wr.wr_fee) AS avg_web_fee, COUNT(DISTINCT sr.sr_customer_sk) AS num_customers_store, COUNT(DISTINCT wr.wr_refunded_customer_sk) AS num_customers_web FROM customer c LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_refunded_customer_sk LEFT JOIN reason r ON r.r_reason_sk = sr.sr_reason_sk OR r.r_reason_sk = wr.wr_reason_sk WHERE c.c_preferred_cust_flag = 'Y' AND (sr.sr_return_amt IS NOT NULL OR wr.wr_return_amt IS NOT NULL) GROUP BY c.c_birth_year, r.r_reason_desc ORDER BY c.c_birth_year, avg_store_return_amount_inc_tax DESC, avg_web_return_amount_inc_tax DESC;
SELECT d_year, i_brand, i_class, i_category, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, SUM(cs_net_paid) AS total_revenue, AVG(cs_net_paid_inc_tax) AS avg_revenue_inc_tax, AVG(cs_net_paid_inc_ship_tax) AS avg_revenue_inc_ship_tax, SUM(cs_net_profit) AS total_profit, COUNT(DISTINCT cs_item_sk) AS distinct_items_sold, MAX(cs_sales_price) AS max_sales_price, MIN(cs_sales_price) AS min_sales_price FROM catalog_sales JOIN date_dim ON (cs_sold_date_sk = d_date_sk) JOIN item ON (cs_item_sk = i_item_sk) JOIN time_dim ON (cs_sold_time_sk = t_time_sk) WHERE d_year = 2000 AND t_hour BETWEEN 0 AND 1 AND t_sub_shift = 'night' AND i_rec_end_date >= '1999-10-27' AND i_rec_end_date <= '2001-10-26' AND cs_sold_date_sk IN ('2450821', '2450823') GROUP BY d_year, i_brand, i_class, i_category ORDER BY total_revenue DESC;
SELECT i_category, i_class, COUNT(DISTINCT cr_order_number) AS total_returns, SUM(cr_return_quantity) AS total_returned_quantity, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_net_loss) AS total_net_loss, COUNT(DISTINCT ws_order_number) AS total_sales_orders, SUM(ws_quantity) AS total_sold_quantity, AVG(ws_sales_price) AS avg_sales_price, SUM(ws_net_profit) AS total_net_profit FROM catalog_returns JOIN item ON catalog_returns.cr_item_sk = item.i_item_sk JOIN web_sales ON item.i_item_sk = web_sales.ws_item_sk JOIN customer ON web_sales.ws_bill_customer_sk = customer.c_customer_sk JOIN income_band ON customer.c_current_hdemo_sk = income_band.ib_income_band_sk WHERE cr_returned_date_sk BETWEEN 20000101 AND 20001231 AND ws_sold_date_sk BETWEEN 20000101 AND 20001231 AND ib_income_band_sk IN (5, 8) AND cr_net_loss > 100 GROUP BY i_category, i_class ORDER BY total_net_loss DESC, total_net_profit DESC;
SELECT dd.d_year, dd.d_quarter_name, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, COUNT(DISTINCT ca.ca_city) AS number_of_cities, COUNT(DISTINCT ws.web_site_sk) AS number_of_websites, SUM(cr.cr_return_quantity) AS total_return_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_net_loss) AS total_net_loss FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk JOIN web_site ws ON ws.web_open_date_sk = dd.d_date_sk LEFT JOIN catalog_returns cr ON cr.cr_returned_date_sk = dd.d_date_sk WHERE dd.d_year IN (2001, 2002) AND ca.ca_street_number = '789' AND ws.web_city IN ('Fairview', 'Midway') AND dd.d_quarter_seq IN (20, 49, 51) AND cr.cr_reason_sk IS NOT NULL AND EXISTS (SELECT 1 FROM reason WHERE cr_reason_sk = r_reason_sk AND r_reason_desc IN ('Gift exchange', 'Found a better price in a store', 'Not the product that was ordred')) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT ca.ca_state AS customer_state, COUNT(DISTINCT ss.ss_ticket_number) AS total_transactions, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_ext_discount_amt) AS avg_discount_amount, SUM(CASE WHEN p.p_channel_email = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_email_promo, SUM(CASE WHEN p.p_channel_dmail = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_dmail_promo, SUM(CASE WHEN p.p_channel_catalog = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_catalog_promo, SUM(CASE WHEN p.p_channel_tv = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_tv_promo, SUM(CASE WHEN p.p_channel_radio = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_radio_promo, SUM(CASE WHEN p.p_channel_press = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_press_promo, SUM(CASE WHEN p.p_channel_event = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_event_promo, SUM(CASE WHEN p.p_channel_demo = 'Y' THEN ss.ss_net_paid ELSE 0 END) AS total_sales_demo_promo FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ca.ca_state IS NOT NULL AND ss.ss_net_paid > 0 AND (p.p_channel_email = 'Y' OR p.p_channel_dmail = 'Y' OR p.p_channel_catalog = 'Y' OR p.p_channel_tv = 'Y' OR p.p_channel_radio = 'Y' OR p.p_channel_press = 'Y' OR p.p_channel_event = 'Y' OR p.p_channel_demo = 'Y') GROUP BY ca.ca_state ORDER BY total_sales DESC;
SELECT cp.cp_department, ca.ca_city, ca.ca_state, cd.cd_education_status, td.t_shift, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON cs.cs_ship_cdemo_sk = cd.cd_demo_sk JOIN time_dim td ON cs.cs_sold_time_sk = td.t_time_sk WHERE cp.cp_start_date_sk IN (2451145, 2451271, 2451088, 2450845, 2451360) AND cp.cp_type IN ('bi-annual', 'quarterly') AND td.t_hour IN (1, 0) AND cd.cd_dep_college_count = 0 GROUP BY cp.cp_department, ca.ca_city, ca.ca_state, cd.cd_education_status, td.t_shift ORDER BY total_net_profit DESC, total_orders DESC;
SELECT s.s_store_name, i.i_category, p.p_channel_details, SUM(cs.cs_net_paid_inc_ship) AS total_sales, SUM(cs.cs_net_profit) AS total_profit, COUNT(DISTINCT cs.cs_order_number) AS total_orders, AVG(cs.cs_quantity) AS average_quantity, SUM(wr.wr_net_loss) AS total_net_loss, COUNT(DISTINCT wr.wr_order_number) AS total_returns, r.r_reason_desc FROM store s JOIN catalog_sales cs ON s.s_store_sk = cs.cs_warehouse_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk LEFT JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number LEFT JOIN reason r ON wr.wr_reason_sk = r.r_reason_sk WHERE s.s_country = 'United States' AND ( s.s_store_sk = '8' OR s.s_store_sk = '1' ) AND ( cs.cs_net_paid_inc_ship IN ('6377.67', '3521.76', '158.56', '2257.47', '739.93', '7973.92') ) AND ( r.r_reason_sk IN ('17', '4', '20', '18', '31') OR r.r_reason_sk IS NULL ) AND i.i_class = 'cooking' GROUP BY s.s_store_name, i.i_category, p.p_channel_details, r.r_reason_desc ORDER BY total_sales DESC, total_profit DESC;
SELECT cc.cc_name, cc.cc_manager, sm.sm_type, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_net_paid) AS avg_payment, SUM(cs.cs_net_profit) AS total_profit, SUM(cs.cs_coupon_amt) AS total_coupons, p.p_promo_name, COUNT(DISTINCT c.c_customer_sk) AS unique_customers FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk WHERE cc.cc_open_date_sk IN ('2450952', '2450806', '2451063') AND cc.cc_manager IN ('Bob Belcher', 'Felipe Perkins', 'Larry Mccray', 'Mark Hightower') AND cs.cs_ext_sales_price IN ('8162.40', '242.11', '869.67', '42.33') AND c.c_birth_country IN ('GERMANY', 'YEMEN', 'SWAZILAND', 'MARTINIQUE', 'ROMANIA') AND c.c_customer_sk IN ('758', '3345') GROUP BY cc.cc_name, cc.cc_manager, sm.sm_type, p.p_promo_name ORDER BY total_profit DESC, total_orders DESC, avg_payment DESC;
SELECT p.p_promo_name, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, SUM(cs_net_paid) AS total_net_paid, AVG(cs_net_profit) AS average_net_profit, COUNT(DISTINCT cr_order_number) AS total_returns, SUM(cr_return_quantity) AS total_quantity_returned, SUM(cr_net_loss) AS total_net_loss, AVG(hd.hd_vehicle_count) AS average_vehicle_count FROM catalog_sales cs JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk LEFT JOIN catalog_returns cr ON cs.cs_item_sk = cr.cr_item_sk AND cs.cs_order_number = cr.cr_order_number JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk WHERE cs.cs_ext_wholesale_cost > 100 AND hd.hd_vehicle_count IN (0, 2, 3, 4) AND (cr.cr_returned_time_sk IS NULL OR cr.cr_returned_time_sk IN (80039, 82096, 81103)) GROUP BY p.p_promo_name ORDER BY total_net_paid DESC, total_net_loss ASC LIMIT 100;
SELECT ca.ca_state, ca.ca_county, ca.ca_city, AVG(inv.inv_quantity_on_hand) AS avg_quantity_on_hand, COUNT(DISTINCT sm.sm_ship_mode_sk) AS num_shipment_modes, COUNT(DISTINCT ca.ca_address_sk) AS num_addresses FROM inventory inv JOIN customer_address ca ON inv.inv_warehouse_sk = ca.ca_address_sk JOIN time_dim td ON inv.inv_date_sk = td.t_time_sk JOIN ship_mode sm ON sm.sm_ship_mode_id LIKE 'AAAAAAA%' WHERE td.t_time_id = 'AAAAAAAAAGCAAAAA' AND ca.ca_address_sk IN (3195, 2241, 86, 2256, 3606) AND inv.inv_date_sk = 2450815 AND sm.sm_ship_mode_id IN ('AAAAAAAAEBAAAAAA', 'AAAAAAAAKAAAAAAA', 'AAAAAAAAMAAAAAAA', 'AAAAAAAAOAAAAAAA') GROUP BY ROLLUP (ca.ca_state, ca.ca_county, ca.ca_city) ORDER BY ca.ca_state, ca.ca_county, ca.ca_city;
SELECT s.s_store_name, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, AVG(ss.ss_net_profit) AS average_net_profit, COUNT(DISTINCT p.p_promo_sk) AS number_of_promotions_run, SUM(CASE WHEN p.p_channel_tv = 'N' THEN ss.ss_quantity ELSE 0 END) AS quantity_sold_with_no_tv_promo FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN call_center cc ON s.s_market_id = cc.cc_mkt_id JOIN inventory i ON ss.ss_item_sk = i.inv_item_sk AND i.inv_date_sk = ss.ss_sold_date_sk WHERE ss.ss_sold_time_sk IN (63444, 44081, 71662, 70433) AND i.inv_item_sk IN (15889, 8930) AND i.inv_date_sk = 2450815 AND p.p_cost = 1000.00 AND cc.cc_sq_ft IN (795, 2268, 3514, 1138, 649) AND cc.cc_open_date_sk IN (2450806, 2450952) GROUP BY s.s_store_name ORDER BY total_net_paid DESC;
SELECT dd.d_year, i.i_category, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_profit) AS total_net_profit, COUNT(DISTINCT wr_order_number) AS total_returns, SUM(wr_return_quantity) AS total_quantity_returned, AVG(wr_return_amt) AS average_return_amount, SUM(wr_net_loss) AS total_net_loss FROM date_dim dd JOIN catalog_sales cs ON dd.d_date_sk = cs.cs_sold_date_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk LEFT JOIN web_returns wr ON i.i_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number WHERE dd.d_year = 2001 AND i.i_size = 'medium' AND ( wr.wr_refunded_hdemo_sk = '4852' OR wr.wr_fee IN ('29.43', '58.44') OR dd.d_same_day_lq IN ('2415041', '2417033', '2416545', '2418165', '2417025', '2416046') ) GROUP BY dd.d_year, i.i_category ORDER BY total_net_profit DESC, total_net_loss ASC;
SELECT i_category, i_brand, sum(i_current_price) as total_sales, avg(i_current_price) as avg_price, count(i_item_sk) as item_count, sum(inv_quantity_on_hand) as total_inventory, sum(wr_return_amt_inc_tax) as total_returns, avg(wr_fee) as avg_return_fee, count(distinct wp_web_page_sk) as page_count, sum(case when wp_autogen_flag = 'Y' then 1 else 0 end) as autogen_page_count FROM item LEFT JOIN inventory ON i_item_sk = inv_item_sk LEFT JOIN web_returns ON i_item_sk = wr_item_sk LEFT JOIN web_page ON wr_web_page_sk = wp_web_page_sk LEFT JOIN promotion ON i_item_sk = p_item_sk WHERE i_rec_end_date IS NULL AND (i_category = 'Electronics' OR i_category = 'Home Goods') AND wp_url = 'http://www.foo.com' AND p_discount_active = 'Y' GROUP BY i_category, i_brand ORDER BY total_sales DESC, total_inventory DESC;
SELECT ca.ca_city, ca.ca_state, i.i_category, COUNT(DISTINCT c.c_customer_sk) AS number_of_customers, AVG(i.i_current_price) AS average_item_price, SUM(i.i_wholesale_cost) AS total_wholesale_cost, COUNT(i.i_item_sk) AS items_sold, SUM(CASE WHEN c.c_birth_year = 1928 THEN 1 ELSE 0 END) AS customers_born_1928, SUM(CASE WHEN c.c_birth_year = 1948 THEN 1 ELSE 0 END) AS customers_born_1948, SUM(CASE WHEN c.c_birth_country = 'HUNGARY' THEN 1 ELSE 0 END) AS customers_from_hungary, SUM(CASE WHEN c.c_birth_country = 'GUERNSEY' THEN 1 ELSE 0 END) AS customers_from_guernsey, COUNT(DISTINCT CASE WHEN ca.ca_location_type = 'single family' THEN c.c_customer_sk END) AS single_family_homes, COUNT(DISTINCT CASE WHEN ca.ca_location_type = 'apartment' THEN c.c_customer_sk END) AS apartments, COUNT(DISTINCT CASE WHEN ca.ca_location_type = 'condo' THEN c.c_customer_sk END) AS condos FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN item i ON c.c_customer_sk = i.i_manager_id WHERE i.i_size IN ('economy', 'large', 'petite') AND i.i_product_name IN ('barbarbarought', 'esecallyesepri') AND ca.ca_city IN ('Watkins', 'Sawyer', 'Ruth', 'Sheffield') GROUP BY ca.ca_city, ca.ca_state, i.i_category ORDER BY ca.ca_state, ca.ca_city, i.i_category;
SELECT ca_state, EXTRACT(YEAR FROM d.d_date) AS sales_year, COUNT(DISTINCT c.c_customer_sk) AS num_customers, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS avg_sales_price, SUM(ss_net_profit) AS total_net_profit, SUM(sr_return_amt_inc_tax) AS total_returns, AVG(sr_fee) AS avg_return_fee FROM store_sales ss JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk WHERE ca.ca_state IN ('IL', 'KY', 'OR') AND EXTRACT(YEAR FROM d.d_date) IN (2001, 2002) AND ss.ss_sales_price BETWEEN 100 AND 150 AND sr.sr_return_amt_inc_tax > 0 GROUP BY ca_state, sales_year ORDER BY sales_year DESC, ca_state;
SELECT cc.cc_name AS call_center_name, w.w_warehouse_name AS warehouse_name, s.s_state AS state, SUM(cs.cs_quantity) AS total_items_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_item_sk) AS number_of_unique_items_sold FROM catalog_sales cs INNER JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk INNER JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk INNER JOIN store s ON cc.cc_division = s.s_division_id WHERE cc.cc_market_manager IN ('Matthew Clifton', 'Gary Colburn') AND s.s_country = 'United States' GROUP BY call_center_name, warehouse_name, state ORDER BY total_items_sold DESC, average_sales_price DESC;
SELECT ca.ca_state, COUNT(DISTINCT ca.ca_address_sk) AS num_customers, AVG(inv.inv_quantity_on_hand) AS avg_inventory_quantity, t.t_shift, COUNT(DISTINCT inv.inv_warehouse_sk) AS num_warehouses FROM customer_address ca JOIN inventory inv ON ca.ca_address_sk = inv.inv_warehouse_sk JOIN time_dim t ON inv.inv_date_sk = t.t_time_sk WHERE t.t_shift IN ('Morning', 'Afternoon', 'Evening') GROUP BY ca.ca_state, t.t_shift ORDER BY ca.ca_state, t.t_shift;
SELECT web_site.web_site_id, web_site.web_class, web_site.web_name, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_quantity) AS total_web_quantity_sold, AVG(ws.ws_net_paid) AS avg_web_net_paid, SUM(cr.cr_return_quantity) AS total_catalog_returned_quantity, AVG(cr.cr_return_amount) AS avg_catalog_return_amount, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, SUM(sr.sr_return_amt) AS total_store_return_amount, s.s_store_name, s.s_state, COUNT(DISTINCT cs.cs_order_number) AS total_catalog_orders, SUM(cs.cs_quantity) AS total_catalog_quantity_sold, AVG(cs.cs_net_paid_inc_tax) AS avg_catalog_net_paid_inc_tax, time_dim.t_shift, time_dim.t_sub_shift FROM web_sales ws LEFT JOIN web_site ON ws.ws_web_site_sk = web_site.web_site_sk LEFT JOIN catalog_sales cs ON ws.ws_order_number = cs.cs_order_number LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number LEFT JOIN store_returns sr ON cr.cr_order_number = sr.sr_ticket_number LEFT JOIN store s ON sr.sr_store_sk = s.s_store_sk LEFT JOIN time_dim ON ws.ws_sold_time_sk = time_dim.t_time_sk WHERE s.s_gmt_offset = '-5.00' AND COALESCE(CAST(s.s_closed_date_sk AS TEXT), '') NOT IN ('2451044', '2451189') AND cr.cr_return_quantity IN (95, 94, 84, 23) AND cr.cr_ship_mode_sk IN (14, 5, 19, 8, 2) AND (time_dim.t_sub_shift = 'night' OR time_dim.t_shift = 'third') AND cs.cs_bill_customer_sk IN (49534, 61995) AND cs.cs_net_paid = 3022.20 GROUP BY web_site.web_site_id, web_site.web_class, web_site.web_name, s.s_store_name, s.s_state, time_dim.t_shift, time_dim.t_sub_shift ORDER BY web_site.web_name, s.s_store_name LIMIT 100;
SELECT dd.d_year, dd.d_quarter_name, i.i_category, COUNT(sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_items, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN date_dim dd ON sr.sr_returned_date_sk = dd.d_date_sk JOIN item i ON sr.sr_item_sk = i.i_item_sk JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN time_dim td ON sr.sr_return_time_sk = td.t_time_sk WHERE (i.i_brand_id IN ('8007010', '6006007', '9004004', '9010002') OR i.i_container = 'Unknown') AND dd.d_quarter_name IN ('1907Q4', '1912Q3', '1913Q3') AND td.t_time_sk = '4464' AND td.t_shift = 'third' GROUP BY dd.d_year, dd.d_quarter_name, i.i_category ORDER BY dd.d_year, dd.d_quarter_name, total_returned_items DESC;
SELECT ws.web_site_id, st.s_store_name, hd.hd_buy_potential, ws_cat.avg_sales_price, ws_cat.total_quantity_sold, ws_cat.total_net_profit, ws_cat.avg_coupon_amt_used FROM web_site ws JOIN (SELECT ws_web_site_sk, AVG(ws_sales_price) AS avg_sales_price, SUM(ws_quantity) AS total_quantity_sold, SUM(ws_net_profit) AS total_net_profit, AVG(ws_coupon_amt) AS avg_coupon_amt_used FROM web_sales GROUP BY ws_web_site_sk ) ws_cat ON ws_cat.ws_web_site_sk = ws.web_site_sk JOIN store st ON ws.web_mkt_id = st.s_market_id JOIN household_demographics hd ON ws_cat.avg_sales_price BETWEEN hd.hd_income_band_sk AND hd.hd_income_band_sk * 10 WHERE ws.web_open_date_sk IN ('2450594', '2450645', '2450679', '2450798', '2450696') AND st.s_rec_start_date BETWEEN '1997-03-13' AND '2001-03-13' AND hd.hd_buy_potential IN ('0-500', 'Unknown', '1001-5000') GROUP BY ws.web_site_id, st.s_store_name, hd.hd_buy_potential, ws_cat.avg_sales_price, ws_cat.total_quantity_sold, ws_cat.total_net_profit, ws_cat.avg_coupon_amt_used ORDER BY ws.web_site_id, st.s_store_name, hd.hd_buy_potential;
SELECT s.s_store_name, s.s_city, s.s_state, i.i_category, i.i_brand, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(i.i_current_price) AS average_price, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS preferred_customers_count FROM store s JOIN inventory inv ON s.s_store_sk = inv.inv_warehouse_sk JOIN item i ON inv.inv_item_sk = i.i_item_sk JOIN customer c ON s.s_store_sk = c.c_current_addr_sk WHERE s.s_state IN ('CA', 'TX', 'NY') AND c.c_last_review_date_sk BETWEEN 2452306 AND 2452404 AND i.i_rec_start_date <= CURRENT_DATE AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date > CURRENT_DATE) GROUP BY s.s_store_name, s.s_city, s.s_state, i.i_category, i.i_brand ORDER BY total_inventory DESC, s.s_store_name, i.i_category, i.i_brand;
SELECT c.c_first_name, c.c_last_name, ca.ca_state, w.w_warehouse_name, SUM(i.inv_quantity_on_hand) AS total_inventory, AVG(cc.cc_tax_percentage) AS average_tax_percentage, COUNT(DISTINCT cc.cc_call_center_sk) AS number_of_call_centers FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN inventory i ON ca.ca_address_sk = i.inv_warehouse_sk JOIN warehouse w ON i.inv_warehouse_sk = w.w_warehouse_sk JOIN call_center cc ON w.w_state = cc.cc_state WHERE ca.ca_state IN ('MA', 'FL') AND w.w_warehouse_id IN ('AAAAAAAADAAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAABAAAAAAA') AND cc.cc_tax_percentage IN (0.01, 0.05, 0.11, 0.12) GROUP BY c.c_first_name, c.c_last_name, ca.ca_state, w.w_warehouse_name ORDER BY total_inventory DESC, average_tax_percentage, number_of_call_centers DESC;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, wsit.web_name, wsit.web_manager, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_net_profit) AS average_net_profit_per_sale, MAX(ws.ws_net_profit) AS max_net_profit_single_sale, MIN(ws.ws_net_profit) AS min_net_profit_single_sale FROM web_sales ws JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN web_site wsit ON ws.ws_web_site_sk = wsit.web_site_sk WHERE cd.cd_credit_rating IN ('Low Risk', 'High Risk', 'Good') AND wsit.web_country = 'United States' AND ws.ws_sold_date_sk BETWEEN 2000000 AND 2020000 GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, wsit.web_name, wsit.web_manager ORDER BY total_net_profit DESC, cd.cd_gender, cd.cd_credit_rating;
SELECT r.r_reason_desc, sm.sm_type AS shipping_type, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_qty, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_inc_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_net_loss) AS total_net_loss, COUNT(DISTINCT s.s_store_sk) AS num_stores_with_returns, AVG(s.s_number_employees) AS avg_store_employees, AVG(s.s_floor_space) AS avg_store_floor_space, SUM(sr.sr_return_amt) AS total_store_return_amt, SUM(sr.sr_return_amt_inc_tax) AS total_store_return_inc_tax FROM catalog_returns cr JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN store_returns sr ON cr.cr_item_sk = sr.sr_item_sk AND cr.cr_order_number = sr.sr_ticket_number LEFT JOIN store s ON sr.sr_store_sk = s.s_store_sk WHERE r.r_reason_desc IN ('Gift exchange', 'duplicate purchase', 'Did not like the make', 'Found a better extended warranty in a store') AND sm.sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') AND (s.s_street_number IN ('337', '255', '175') OR s.s_state = 'TN') GROUP BY r.r_reason_desc, shipping_type ORDER BY total_returns DESC;
SELECT sm.sm_type AS shipping_type, COUNT(DISTINCT cr.cr_order_number) AS total_return_transactions, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, COUNT(DISTINCT wr.wr_order_number) AS total_web_return_transactions, SUM(wr.wr_return_amt_inc_tax) AS total_web_return_amount, AVG(wr.wr_return_amt) AS average_web_return_amount FROM ship_mode sm LEFT JOIN catalog_returns cr ON sm.sm_ship_mode_sk = cr.cr_ship_mode_sk LEFT JOIN web_returns wr ON cr.cr_catalog_page_sk = wr.wr_web_page_sk LEFT JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk WHERE wr.wr_refunded_customer_sk IN ('49270', '61504', '79520') OR ws.web_city IN ('Fairview', 'Midway') GROUP BY sm.sm_type ORDER BY total_return_amount DESC, total_web_return_amount DESC;
SELECT cd.cd_gender, ib.ib_lower_bound AS income_lower_bound, ib.ib_upper_bound AS income_upper_bound, sm.sm_type AS shipping_type, COUNT(sr.sr_return_amt) AS total_returns, SUM(sr.sr_return_amt) AS total_value_of_returns, AVG(sr.sr_return_amt) AS average_return_value, SUM(sr.sr_return_quantity) AS total_quantity_returned FROM store_returns sr JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound JOIN ship_mode sm ON sm.sm_ship_mode_sk = sr.sr_item_sk WHERE sm.sm_type IN ('OVERNIGHT') AND cd.cd_gender IN ('M', 'F') GROUP BY cd.cd_gender, income_lower_bound, income_upper_bound, shipping_type ORDER BY total_value_of_returns DESC, total_returns DESC;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN household_demographics hd ON cs.cs_ship_hdemo_sk = hd.hd_demo_sk WHERE cc.cc_sq_ft IN ('4134', '795', '1138', '649') AND hd.hd_income_band_sk IN ('9', '18', '5', '14', '12') AND hd.hd_vehicle_count IN ('3', '1', '0', '4', '2') GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_net_profit DESC, total_orders DESC, cc.cc_name;
SELECT ca_state, ca_country, AVG(wp_char_count) AS average_character_count, SUM(wp_link_count) AS total_link_count, COUNT(wp_web_page_sk) AS total_pages, AVG(ib_lower_bound) AS average_income_lower_bound, AVG(ib_upper_bound) AS average_income_upper_bound, COUNT(DISTINCT ib_income_band_sk) AS distinct_income_band_count FROM web_page JOIN customer_address ON wp_customer_sk = ca_address_sk JOIN income_band ON ca_address_id::integer = ib_income_band_sk WHERE wp_type = 'product' AND ca_country = 'United States' AND ib_lower_bound >= 70001 AND (ib_income_band_sk IN (3, 8, 1, 10, 13, 9) OR wp_autogen_flag = 'Y') GROUP BY ca_state, ca_country ORDER BY ca_state, ca_country;
SELECT ca_state, ca_country, COUNT(DISTINCT ca_address_sk) AS num_addresses, SUM(p_cost) AS total_promotion_cost, AVG(p_cost) AS avg_promotion_cost, COUNT(DISTINCT p_promo_sk) AS num_promotions, COUNT(DISTINCT web_site_sk) AS num_websites, SUM(web_tax_percentage) AS total_tax_percentage, AVG(web_tax_percentage) AS avg_tax_percentage FROM customer_address JOIN promotion ON ca_address_sk = p_item_sk JOIN web_site ON ca_address_sk = web_mkt_id WHERE ca_state IN ('DE', 'NH', 'MI', 'MA', 'ID', 'NY') AND ca_country = 'United States' AND p_discount_active = '1' AND web_rec_start_date <= CURRENT_DATE AND (web_rec_end_date IS NULL OR web_rec_end_date >= CURRENT_DATE) GROUP BY ca_state, ca_country ORDER BY ca_state, ca_country;
SELECT cc.cc_division_name, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_paid_inc_tax) AS total_sales_revenue, AVG(ws.ws_net_paid_inc_tax) AS average_order_value, SUM(sr.sr_return_amt_inc_tax) AS total_returns_revenue, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns_count, (SUM(ws.ws_net_paid_inc_tax) - SUM(sr.sr_return_amt_inc_tax)) AS net_revenue_after_returns FROM call_center cc LEFT JOIN web_sales ws ON cc.cc_call_center_sk = ws.ws_web_site_sk LEFT JOIN store_returns sr ON ws.ws_item_sk = sr.sr_item_sk WHERE cc.cc_division_name IN ('ought', 'ese', 'pri', 'anti') AND ws.ws_sold_date_sk IS NOT NULL AND sr.sr_returned_date_sk IS NOT NULL GROUP BY cc.cc_division_name ORDER BY net_revenue_after_returns DESC;
SELECT cd.cd_education_status, cd.cd_marital_status, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, AVG(CASE WHEN cd.cd_credit_rating LIKE 'Good%' THEN 1 WHEN cd.cd_credit_rating LIKE 'Fair%' THEN 2 WHEN cd.cd_credit_rating LIKE 'Poor%' THEN 3 ELSE NULL END) AS avg_credit_rating_score, COUNT(DISTINCT wp.wp_web_page_sk) AS web_page_count, wp.wp_type, AVG(wp.wp_link_count) AS avg_link_count, AVG(wp.wp_image_count) AS avg_image_count FROM customer_demographics cd LEFT JOIN web_page wp ON cd.cd_demo_sk = wp.wp_customer_sk LEFT JOIN time_dim td ON wp.wp_access_date_sk = td.t_time_sk WHERE cd.cd_marital_status IN ('D', 'U', 'S', 'M', 'W') AND td.t_hour > 18 AND (td.t_am_pm = 'PM') GROUP BY cd.cd_education_status, cd.cd_marital_status, wp.wp_type ORDER BY cd.cd_education_status, cd.cd_marital_status, web_page_count DESC;
SELECT i.i_category AS item_category, i.i_brand AS item_brand, p.p_channel_details AS promotion_channel, SUM(cs.cs_ext_sales_price) AS total_sales, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(cs.cs_item_sk) AS items_sold_count FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE p.p_channel_dmail = 'N' AND p.p_channel_event = 'N' AND i.i_units IN ('Oz', 'Ounce', 'Tsp', 'Dozen') GROUP BY i.i_category, i.i_brand, p.p_channel_details ORDER BY total_sales DESC, i.i_category, i.i_brand;
SELECT r.r_reason_desc AS return_reason, c.c_preferred_cust_flag AS preferred_customer, t.t_am_pm AS purchase_time_period, COUNT(wr.wr_order_number) AS total_returns, SUM(wr.wr_refunded_cash) AS total_refunded_amount, AVG(wr.wr_refunded_cash) AS avg_refunded_amount FROM web_returns wr JOIN reason r ON wr.wr_reason_sk = r.r_reason_sk JOIN customer c ON wr.wr_returning_customer_sk = c.c_customer_sk JOIN catalog_sales cs ON wr.wr_order_number = cs.cs_order_number JOIN time_dim t ON cs.cs_sold_time_sk = t.t_time_sk GROUP BY r.r_reason_desc, c.c_preferred_cust_flag, t.t_am_pm ORDER BY total_refunded_amount DESC, total_returns DESC;
SELECT i.i_category, cd.cd_gender, sm.sm_type, SUM(i.i_current_price) AS total_sales, AVG(i.i_wholesale_cost) AS average_wholesale, COUNT(DISTINCT inv.inv_warehouse_sk) AS unique_warehouses, COUNT(DISTINCT p.p_promo_sk) AS promotion_count FROM item AS i JOIN inventory AS inv ON i.i_item_sk = inv.inv_item_sk JOIN promotion AS p ON i.i_item_sk = p.p_item_sk AND p.p_channel_email = 'N' JOIN ship_mode AS sm ON sm.sm_ship_mode_sk = inv.inv_warehouse_sk JOIN customer_demographics AS cd ON cd.cd_demo_sk = i.i_manager_id WHERE i.i_rec_start_date <= '2023-01-01' AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date >= '2023-01-01') AND p.p_end_date_sk IN ('2450342', '2450365', '2450396', '2450787', '2450351') GROUP BY i.i_category, cd.cd_gender, sm.sm_type ORDER BY total_sales DESC, i.i_category, cd.cd_gender, sm.sm_type;
SELECT cp.cp_department, i.i_category, i.i_brand, sm.sm_type, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages, COUNT(DISTINCT i.i_item_sk) AS num_items, AVG(i.i_current_price) AS avg_current_price, SUM(i.i_wholesale_cost) AS total_wholesale_cost, COUNT(DISTINCT t.t_time_sk) AS num_time_records, COUNT(DISTINCT sm.sm_ship_mode_sk) AS num_ship_modes FROM catalog_page cp JOIN item i ON cp.cp_catalog_page_sk = i.i_item_sk JOIN time_dim t ON cp.cp_start_date_sk = t.t_time_sk OR cp.cp_end_date_sk = t.t_time_sk JOIN ship_mode sm ON sm.sm_carrier = i.i_manufact WHERE i.i_category IN ('Shoes', 'Jewelry', 'Sports', 'Home', 'Electronics') GROUP BY cp.cp_department, i.i_category, i.i_brand, sm.sm_type ORDER BY num_catalog_pages DESC, num_items DESC;
SELECT d_year, d_quarter_name, cp_department, c_birth_country, COUNT(DISTINCT ws_order_number) AS total_orders, SUM(ws_quantity) AS total_quantity, AVG(ws_sales_price) AS average_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_profit) AS total_net_profit FROM web_sales JOIN date_dim ON web_sales.ws_sold_date_sk = date_dim.d_date_sk JOIN customer ON web_sales.ws_bill_customer_sk = customer.c_customer_sk JOIN catalog_page ON web_sales.ws_web_page_sk = catalog_page.cp_catalog_page_sk WHERE d_year = 2001 AND d_quarter_name IN ('1901Q1', '1911Q1', '1910Q2') AND ws_ext_discount_amt IN (262.20, 1117.90, 736.02) AND c_birth_country IS NOT NULL GROUP BY d_year, d_quarter_name, cp_department, c_birth_country ORDER BY d_year, d_quarter_name, cp_department, c_birth_country;
SELECT sm.sm_type AS shipping_type, i.i_category AS item_category, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_refunded_amount, AVG(cr.cr_return_amount) AS average_refund_amount FROM catalog_returns cr JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk WHERE cr.cr_returned_date_sk IS NOT NULL AND sm.sm_type IN ('NEXT DAY', 'TWO DAY', 'EXPRESS') AND i.i_category IN ('Electronics', 'Clothing', 'Furniture') GROUP BY sm.sm_type, i.i_category ORDER BY total_refunded_amount DESC, total_returns DESC, average_refund_amount DESC;
SELECT w_state, w_city, p_promo_name, COUNT(DISTINCT wr_order_number) AS total_returns, SUM(wr_return_quantity) AS total_returned_quantity, AVG(wr_return_amt) AS avg_return_amount, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(wr_fee) AS total_fees, SUM(wr_net_loss) AS total_net_loss FROM warehouse JOIN web_returns ON w_warehouse_sk = wr_returning_addr_sk JOIN promotion ON p_promo_sk = wr_web_page_sk WHERE w_street_name = 'Ash Laurel' AND p_channel_catalog = 'N' AND p_channel_press = 'N' AND wr_account_credit IN ('618.25', '63.54', '2191.76', '19.59', '469.21', '464.73') GROUP BY w_state, w_city, p_promo_name ORDER BY total_net_loss DESC, w_state, w_city;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, COUNT(DISTINCT ss.ss_customer_sk) AS store_customer_count, SUM(ss.ss_quantity) AS store_quantity_sum, AVG(ss.ss_sales_price) AS store_average_sales_price, SUM(cs.cs_quantity) AS catalog_quantity_sum, AVG(cs.cs_sales_price) AS catalog_average_sales_price, SUM(ws.ws_quantity) AS web_quantity_sum, AVG(ws.ws_sales_price) AS web_average_sales_price, SUM(sr.sr_return_quantity) AS store_return_quantity_sum, SUM(wr.wr_return_quantity) AS web_return_quantity_sum, ib.ib_lower_bound, ib.ib_upper_bound FROM customer_demographics cd JOIN store_sales ss ON cd.cd_demo_sk = ss.ss_cdemo_sk JOIN catalog_sales cs ON cd.cd_demo_sk = cs.cs_bill_cdemo_sk JOIN web_sales ws ON cd.cd_demo_sk = ws.ws_bill_cdemo_sk JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk JOIN web_returns wr ON cd.cd_demo_sk = wr.wr_refunded_cdemo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating;
SELECT d.d_year, d.d_quarter_name, COUNT(distinct wp.wp_web_page_sk) AS webpage_count, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(sr.sr_fee) AS total_return_fees, MAX(cp.cp_catalog_page_number) AS max_catalog_page_number, sm.sm_type AS ship_mode_type, COUNT(distinct ib.ib_income_band_sk) AS income_band_count FROM date_dim d LEFT JOIN web_page wp ON d.d_date_sk = wp.wp_access_date_sk LEFT JOIN store_returns sr ON d.d_date_sk = sr.sr_returned_date_sk LEFT JOIN catalog_page cp ON (d.d_date_sk >= cp.cp_start_date_sk AND d.d_date_sk <= cp.cp_end_date_sk) LEFT JOIN ship_mode sm ON sr.sr_return_ship_cost BETWEEN 36.08 AND 716.95 LEFT JOIN income_band ib ON sr.sr_return_amt_inc_tax BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound WHERE d.d_current_quarter = 'N' AND d.d_year = 2022 AND sm.sm_contract IN ('UaAJjKDnL4gTOqbpj', 'O9V6oF8RJnLMmZYd1', 'fop0bcSd91J26IVpR', 'A5BYO1qH8HGTTN', '5FKNB0j8aaqTB') AND cp.cp_catalog_page_id IN ('AAAAAAAAAEIAAAAA', 'AAAAAAAAMNNAAAAA') GROUP BY d.d_year, d.d_quarter_name, sm.sm_type ORDER BY d.d_year, d.d_quarter_name;
SELECT s.s_store_name, s.s_state, sum(inv.inv_quantity_on_hand) AS total_inventory, avg(hd.hd_dep_count) AS avg_dependents, avg(hd.hd_vehicle_count) AS avg_vehicles, count(DISTINCT sr.sr_ticket_number) AS num_store_returns, sum(sr.sr_return_amt_inc_tax) AS total_store_return_value, sum(wr.wr_return_amt_inc_tax) AS total_web_return_value, sum(sr.sr_net_loss) AS total_store_net_loss, sum(wr.wr_net_loss) AS total_web_net_loss FROM store s LEFT JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk LEFT JOIN web_returns wr ON wr.wr_returning_hdemo_sk = sr.sr_hdemo_sk LEFT JOIN inventory inv ON inv.inv_warehouse_sk = s.s_store_sk LEFT JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk WHERE s.s_gmt_offset = '-5.00' AND inv.inv_date_sk = 2450815 AND s.s_store_id = 'AAAAAAAABAAAAAAA' AND ( inv.inv_item_sk IN ('14480', '13390', '12130', '9782', '14476', '8896') OR wr.wr_item_sk IN ('8516', '362') ) AND ( hd.hd_vehicle_count IN (3, 1, 0, 4, 2) OR hd.hd_buy_potential IN ('5001-10000', 'Unknown', '0-500', '1001-5000', '>10000') ) GROUP BY s.s_store_name, s.s_state ORDER BY total_inventory DESC, total_store_return_value DESC;
SELECT ws.web_site_id, ws.web_name, ws.web_class, ws.web_market_manager, AVG(p.p_cost) AS average_promotion_cost, SUM(CASE WHEN p.p_channel_email = 'N' THEN 1 ELSE 0 END) AS num_promotions_not_via_email, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages, MAX(hd.hd_dep_count) AS max_dependency_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count FROM web_site ws LEFT JOIN promotion p ON ws.web_site_sk = p.p_item_sk LEFT JOIN catalog_page cp ON cp.cp_catalog_page_number IN (26, 38) AND cp.cp_start_date_sk IN (2450965, 2451115, 2451300, 2451818, 2450935) LEFT JOIN household_demographics hd ON hd.hd_income_band_sk IN (15, 2) GROUP BY ws.web_site_id, ws.web_name, ws.web_class, ws.web_market_manager ORDER BY ws.web_site_id;
SELECT hd.hd_income_band_sk, sm.sm_type, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt) AS avg_return_amount, SUM(wr.wr_return_amt) AS sum_return_amount, SUM(wr.wr_fee) AS sum_fees, SUM(wr.wr_return_ship_cost) AS sum_shipping_costs, SUM(wr.wr_net_loss) AS sum_net_loss FROM web_returns wr JOIN household_demographics hd ON wr.wr_refunded_hdemo_sk = hd.hd_demo_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = wr.wr_returned_time_sk GROUP BY hd.hd_income_band_sk, sm.sm_type ORDER BY sum_net_loss DESC;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_class, ws.web_site_id, ws.web_name, ws.web_class, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_ext_discount_amt) AS avg_discount, COUNT(DISTINCT cs.cs_order_number) AS total_orders FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN web_site ws ON cc.cc_mkt_id = ws.web_mkt_id JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk WHERE cc.cc_mkt_class IN ('A bit narrow forms matter animals.', 'Dealers make most historical, direct students') AND cp.cp_catalog_page_sk BETWEEN 4000 AND 4200 AND cp.cp_description IN ('Women apply in vain in the minutes. Officials can', 'Better fine individuals predict small, optimistic') GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_class, ws.web_site_id, ws.web_name, ws.web_class ORDER BY total_sales DESC;
SELECT i.i_category, i.i_brand, COUNT(*) AS total_items_sold, SUM(ss.ss_quantity) AS total_quantity_sold_store, SUM(ws.ws_quantity) AS total_quantity_sold_web, AVG(ss.ss_sales_price) AS avg_sales_price_store, AVG(ws.ws_sales_price) AS avg_sales_price_web, SUM(ss.ss_net_paid) AS total_net_paid_store, SUM(ws.ws_net_paid) AS total_net_paid_web, SUM(ss.ss_net_profit) AS total_net_profit_store, SUM(ws.ws_net_profit) AS total_net_profit_web FROM item i LEFT JOIN store_sales ss ON i.i_item_sk = ss.ss_item_sk LEFT JOIN web_sales ws ON i.i_item_sk = ws.ws_item_sk WHERE i.i_rec_start_date <= '2001-08-16' AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date > '2001-08-16') AND EXISTS (SELECT 1 FROM inventory WHERE i.i_item_sk = inv_item_sk AND inv_date_sk = 2450815) GROUP BY i.i_category, i.i_brand ORDER BY total_net_profit_store DESC, total_net_profit_web DESC;
SELECT w_state, t_shift, sm_type as shipping_type, avg(hd_income_band_sk) as avg_income_band, sum(case when hd_buy_potential = 'High' then 1 else 0 end) as high_buy_potential_count, avg(hd_dep_count) as avg_dependent_count, avg(hd_vehicle_count) as avg_vehicle_count, count(distinct sm_ship_mode_sk) as shipping_mode_count FROM household_demographics hd JOIN warehouse w ON hd.hd_demo_sk = w.w_warehouse_sk JOIN time_dim td ON td.t_time_sk = w.w_warehouse_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = w.w_warehouse_sk WHERE hd.hd_dep_count IN (2, 3, 6, 9) AND hd.hd_vehicle_count IN (0, 1, 2, 3, 4) AND td.t_shift IS NOT NULL AND sm.sm_type IS NOT NULL GROUP BY w_state, t_shift, sm_type ORDER BY avg_income_band DESC, high_buy_potential_count DESC, avg_vehicle_count DESC;
SELECT dd.d_year, dd.d_quarter_name, cp.cp_department, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_net_paid) AS total_net_paid, AVG(cs.cs_net_paid / cs.cs_quantity) AS avg_net_paid_per_item, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk WHERE dd.d_current_day = 'N' AND dd.d_qoy = '3' AND cs.cs_ship_hdemo_sk IN ('340', '2787', '2515', '487', '576', '6271') AND cp.cp_catalog_page_sk IN ('1948', '1122', '4477', '1780') GROUP BY dd.d_year, dd.d_quarter_name, cp.cp_department ORDER BY dd.d_year, dd.d_quarter_name, cp.cp_department;
SELECT cd.cd_gender, cd.cd_marital_status, td.t_shift, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_units_sold, SUM(ss.ss_net_paid) AS total_revenue, AVG(ss.ss_net_paid) AS average_revenue_per_transaction, SUM(CASE WHEN p.p_channel_dmail = 'Y' THEN 1 ELSE 0 END) AS total_dmail_promotions, SUM(CASE WHEN p.p_channel_email = 'Y' THEN 1 ELSE 0 END) AS total_email_promotions, SUM(CASE WHEN p.p_channel_tv = 'Y' THEN 1 ELSE 0 END) AS total_tv_promotions FROM store_sales ss JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN time_dim td ON ss.ss_sold_time_sk = td.t_time_sk LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE ss.ss_hdemo_sk IN ('4855', '5486') GROUP BY cd.cd_gender, cd.cd_marital_status, td.t_shift ORDER BY total_revenue DESC, total_units_sold DESC;
SELECT ca_state, COUNT(DISTINCT ca_address_sk) AS num_addresses, SUM(s_number_employees) AS total_employees, AVG(s_floor_space) AS avg_floor_space, SUM(CASE WHEN s_hours LIKE '%24%' THEN 1 ELSE 0 END) AS stores_open_24h, SUM(CASE WHEN web_gmt_offset = '-5.00' THEN 1 ELSE 0 END) AS websites_gmt_minus_5, COUNT(DISTINCT r_reason_sk) AS num_distinct_reasons, AVG(web_tax_percentage) AS avg_web_tax_percentage FROM customer_address JOIN store ON ca_county = s_county AND ca_state = s_state JOIN web_site ON s_state = web_state LEFT JOIN reason ON r_reason_id IN ('AAAAAAAAFAAAAAAA', 'AAAAAAAABCAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAAMAAAAAAA', 'AAAAAAAAJBAAAAAA', 'AAAAAAAAGAAAAAAA') WHERE ca_street_type IN ('Court', 'Cir.') AND web_close_date_sk IN ('2447148', '2447046') GROUP BY ca_state ORDER BY num_addresses DESC;
SELECT ca_state, count(*) AS address_count, avg(ca_gmt_offset) AS average_gmt_offset, sm_type, sm_carrier, count(DISTINCT sm_ship_mode_sk) AS unique_ship_mode_count, ib_lower_bound, ib_upper_bound, sum(CASE WHEN ib_upper_bound <= 20000 THEN 1 ELSE 0 END) AS low_income_band_count, sum(CASE WHEN ib_upper_bound > 20000 AND ib_upper_bound <= 40000 THEN 1 ELSE 0 END) AS mid_income_band_count, sum(CASE WHEN ib_upper_bound > 170000 THEN 1 ELSE 0 END) AS high_income_band_count, avg(ib_lower_bound + ib_upper_bound) / 2 AS average_income_band FROM customer_address JOIN ship_mode ON ca_zip = left(sm_ship_mode_id, 5) JOIN income_band ON ib_income_band_sk::text = right(sm_ship_mode_id, length(sm_ship_mode_id) - 5) GROUP BY ca_state, sm_type, sm_carrier, ib_lower_bound, ib_upper_bound ORDER BY ca_state, sm_type, sm_carrier, ib_lower_bound;
SELECT dd.d_year, ca.ca_state, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS order_count, SUM(cs.cs_net_paid_inc_tax) AS total_revenue_inc_tax, SUM(cs.cs_net_profit) AS total_profit FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON cs.cs_bill_addr_sk = ca.ca_address_sk JOIN store s ON ca.ca_state = s.s_state JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk WHERE dd.d_fy_year = 1912 GROUP BY dd.d_year, ca.ca_state ORDER BY total_revenue_inc_tax DESC, ca.ca_state;
SELECT s_store_name, i_category, cd_gender, cd_education_status, r_reason_desc, COUNT(DISTINCT wr_item_sk) AS unique_items_returned, SUM(wr_return_quantity) AS total_return_quantity, AVG(wr_return_amt) AS avg_return_amount, AVG(i_wholesale_cost) AS avg_wholesale_cost, COUNT(wr_returned_date_sk) AS total_returns FROM web_returns JOIN item ON wr_item_sk = i_item_sk JOIN store ON s_store_sk = wr_returning_addr_sk JOIN customer_demographics ON cd_demo_sk = wr_returning_cdemo_sk JOIN reason ON r_reason_sk = wr_reason_sk JOIN date_dim ON wr_returned_date_sk = d_date_sk JOIN time_dim ON wr_returned_time_sk = t_time_sk WHERE d_year = 2022 AND s_state = 'CA' AND wr_return_amt > 0 AND i_current_price > i_wholesale_cost AND t_shift = 'third' GROUP BY s_store_name, i_category, cd_gender, cd_education_status, r_reason_desc ORDER BY total_return_quantity DESC, avg_return_amount DESC LIMIT 100;
SELECT cp.cp_department, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_quantity) AS total_return_quantity, AVG(cr.cr_fee) AS avg_fee, i.i_category, i.i_class, COUNT(DISTINCT c.c_customer_sk) AS total_customers, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, SUM(wr.wr_account_credit) AS total_account_credit FROM catalog_page cp JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN customer c ON cr.cr_returning_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN web_returns wr ON i.i_item_sk = wr.wr_item_sk AND cr.cr_order_number = wr.wr_order_number WHERE i.i_formulation IN ('83313678042thistle61', '41681222olive4963389', '57585sienna024168653') AND i.i_product_name IN ('oughtbarn stpri', 'oughteingeingable', 'barcallycally', 'antieseantiable', 'antiprioughtable', 'priationpri') AND wr.wr_account_credit IN ('8.73', '59.44', '133.59') AND hd.hd_vehicle_count IN ('4', '2', '0', '1') AND c.c_email_address = 'Andrew.Lowery@T7T4.com' GROUP BY cp.cp_department, i.i_category, i.i_class ORDER BY total_return_amount DESC, avg_vehicle_count DESC, total_account_credit DESC;
SELECT wsit.web_site_id, wsit.web_name, cp.cp_department, AVG(ws.ws_sales_price) AS avg_sales_price, SUM(ws.ws_quantity) AS total_quantity_sold, COUNT(DISTINCT ws.ws_bill_customer_sk) AS unique_customers, AVG(cd.cd_purchase_estimate) AS avg_customer_purchase_estimate, SUM(CASE WHEN cd.cd_gender = 'M' THEN 1 ELSE 0 END) AS male_customers, SUM(CASE WHEN cd.cd_gender = 'F' THEN 1 ELSE 0 END) AS female_customers, AVG(cd.cd_dep_college_count) AS avg_college_dependents FROM web_sales ws JOIN web_site wsit ON ws.ws_web_site_sk = wsit.web_site_sk JOIN catalog_page cp ON ws.ws_web_page_sk = cp.cp_catalog_page_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk WHERE cp.cp_catalog_number IN (22, 31, 24, 15, 3) AND wsit.web_county = 'Williamson County' AND wsit.web_street_type IN ('Ct.', 'Avenue', 'Parkway', 'Pkwy', 'Dr.', 'Cir.') AND cd.cd_purchase_estimate IN (8000, 5000, 1000, 9500, 2000) AND cd.cd_dep_college_count = 0 GROUP BY wsit.web_site_id, wsit.web_name, cp.cp_department ORDER BY avg_sales_price DESC, total_quantity_sold DESC;
SELECT i.i_category, s.s_state, s.s_market_id, COUNT(DISTINCT i.i_item_sk) AS total_items, AVG(i.i_current_price) AS avg_price, SUM(i.i_wholesale_cost) AS total_wholesale_cost, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages, wp.wp_type, COUNT(DISTINCT wp.wp_customer_sk) AS total_customers_accessed FROM item i JOIN store s ON i.i_manufact_id = s.s_company_id JOIN web_page wp ON wp.wp_type = 'order' WHERE i.i_category IN ('Books', 'Sports', 'Women', 'Men') AND s.s_state = 'TN' AND s.s_market_id = '7' AND i.i_current_price BETWEEN 2.21 AND 81.80 AND (wp.wp_creation_date_sk BETWEEN '2450811' AND '2450813' OR wp.wp_creation_date_sk = '2450808') GROUP BY i.i_category, s.s_state, s.s_market_id, wp.wp_type ORDER BY total_items DESC, avg_price DESC, total_wholesale_cost DESC;
SELECT w.web_name, cp.cp_department, sm.sm_type, COUNT(distinct i.i_item_sk) as total_items, SUM(i.i_current_price) as total_sales, AVG(i.i_wholesale_cost) as avg_wholesale_cost, COUNT(distinct w.web_site_sk) as total_websites FROM web_site w JOIN catalog_page cp ON w.web_site_sk = cp.cp_catalog_number JOIN item i ON cp.cp_department = i.i_category JOIN ship_mode sm ON sm.sm_carrier = i.i_manufact WHERE i.i_category = 'Music' AND w.web_city IN ('Fairview', 'Midway') AND sm.sm_ship_mode_id IN ('AAAAAAAAIAAAAAAA', 'AAAAAAAALAAAAAAA') AND i.i_item_id IN ('AAAAAAAAJCCAAAAA', 'AAAAAAAANGMAAAAA', 'AAAAAAAAICDAAAAA', 'AAAAAAAAHLABAAAA', 'AAAAAAAAIIEAAAAA', 'AAAAAAAALAOAAAAA') AND w.web_name IN ('site_3', 'site_4', 'site_1', 'site_0', 'site_2') GROUP BY w.web_name, cp.cp_department, sm.sm_type ORDER BY total_sales DESC;
SELECT d_year, d_quarter_name, COUNT(DISTINCT cc_call_center_sk) AS num_call_centers, COUNT(DISTINCT w_warehouse_sk) AS num_warehouses, COUNT(DISTINCT sr_item_sk) AS num_returned_items, COUNT(DISTINCT wp_web_page_sk) AS num_web_pages, COUNT(DISTINCT web_site_sk) AS num_web_sites, SUM(sr_return_amt) AS total_return_amount, AVG(w_warehouse_sq_ft) AS avg_warehouse_size, SUM(wp_image_count) AS total_images_on_web_pages FROM date_dim LEFT JOIN call_center ON (cc_open_date_sk = d_date_sk OR cc_closed_date_sk = d_date_sk) LEFT JOIN warehouse ON d_date_sk = w_warehouse_sk LEFT JOIN store_returns ON sr_returned_date_sk = d_date_sk LEFT JOIN web_page ON wp_creation_date_sk = d_date_sk OR wp_access_date_sk = d_date_sk LEFT JOIN web_site ON web_open_date_sk = d_date_sk OR web_close_date_sk = d_date_sk WHERE d_year = 2001 AND (web_site.web_street_type = 'Court' OR web_site.web_street_type = 'Way') AND warehouse.w_county = 'Williamson County' AND warehouse.w_street_name LIKE '6th%' AND web_page.wp_max_ad_count BETWEEN 0 AND 4 AND web_page.wp_rec_start_date BETWEEN '1999-09-01' AND '2001-09-05' AND date_dim.d_fy_week_seq IN (84, 305, 207, 95) GROUP BY d_year, d_quarter_name ORDER BY d_year, d_quarter_name;
SELECT i_category, i_class, COUNT(DISTINCT i_item_sk) AS num_items, AVG(i_current_price) AS avg_price, SUM(inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT wr_order_number) AS num_returns, SUM(wr_return_quantity) AS total_returned_quantity, SUM(wr_return_amt) AS total_return_amount, cd_gender, AVG(cd_purchase_estimate) AS avg_purchase_estimate, SUM(CASE WHEN cd_gender = 'M' THEN 1 ELSE 0 END) AS male_customers, SUM(CASE WHEN cd_gender = 'F' THEN 1 ELSE 0 END) AS female_customers, web_name, SUM(wr_return_amt_inc_tax) AS total_return_amount_incl_tax FROM item JOIN inventory ON i_item_sk = inv_item_sk JOIN web_returns ON i_item_sk = wr_item_sk JOIN customer_demographics ON wr_returning_cdemo_sk = cd_demo_sk JOIN web_site ON wr_web_page_sk = web_site_sk WHERE inv_date_sk = 2450815 AND i_rec_start_date >= '1997-08-16' AND (i_rec_end_date IS NULL OR i_rec_end_date > CURRENT_DATE) AND web_rec_start_date BETWEEN '1999-08-17' AND '2001-08-16' AND cd_dep_employed_count = 0 AND wr_returning_customer_sk IN (77230, 88571, 67431) GROUP BY i_category, i_class, cd_gender, web_name ORDER BY total_return_amount DESC, avg_price DESC, total_inventory DESC;
SELECT cc.cc_name, i.i_category, SUM(ss.ss_quantity) AS total_quantity, AVG(ss.ss_sales_price) AS avg_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN call_center cc ON cc.cc_division = i.i_class_id JOIN warehouse w ON w.w_warehouse_sk = cc.cc_division WHERE cc.cc_call_center_sk IN ('5', '3', '1') AND cc.cc_division IN ('1', '4', '5', '3') AND w.w_warehouse_sk IN ('3', '5', '1', '4', '2') AND ss.ss_net_paid_inc_tax = '3682.66' GROUP BY cc.cc_name, i.i_category ORDER BY total_net_paid DESC, avg_sales_price DESC;
SELECT s.s_store_name, s.s_city, s.s_state, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid) AS total_net_paid, AVG(ws.ws_net_profit) AS average_net_profit, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cd.cd_purchase_estimate) AS average_purchase_estimate, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_page_visits FROM store s JOIN web_sales ws ON s.s_store_sk = ws.ws_ship_addr_sk JOIN income_band ib ON ws.ws_bill_customer_sk = ib.ib_income_band_sk JOIN catalog_returns cr ON ws.ws_item_sk = cr.cr_item_sk AND ws.ws_order_number = cr.cr_order_number JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk WHERE ws.ws_ext_ship_cost IN (176.54, 380.00, 2131.08) AND ws.ws_ext_wholesale_cost IN (1606.13, 264.04, 476.93) AND ib.ib_income_band_sk IN (6, 20, 17) AND ib.ib_upper_bound IN (30000, 50000, 70000) AND s.s_city IN ('Fairview', 'Midway') AND s.s_market_manager IN ('Thomas Benton', 'Dustin Kelly', 'Dean Morrison') AND s.s_suite_number IN ('Suite 410', 'Suite 190', 'Suite 100') AND cr.cr_ship_mode_sk IN (5, 14, 16) AND cr.cr_item_sk IN (13561, 12757, 9220) AND cr.cr_returning_addr_sk IN (8108, 14295, 7472) AND dd.d_following_holiday IN ('N', 'Y') AND dd.d_dow IN (6, 2, 4) AND dd.d_current_year = 'N' AND wp.wp_access_date_sk IN (2452580, 2452611, 2452576) AND wp.wp_image_count IN (3, 7, 4) AND cd.cd_purchase_estimate IN (500, 2000, 3000) AND cd.cd_education_status IN ('4 yr Degree', 'Secondary', '2 yr Degree') AND cd.cd_dep_count IN (2, 1) GROUP BY s.s_store_name, s.s_city, s.s_state, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_net_paid DESC, average_net_profit DESC, total_web_page_visits DESC LIMIT 100;
SELECT w.web_name, w.web_manager, SUM(i.i_current_price) AS total_current_price, AVG(i.i_wholesale_cost) AS average_wholesale_cost, COUNT(i.i_item_sk) AS item_count, SM.sm_type, MAX(i.i_current_price) AS max_price, MIN(i.i_current_price) AS min_price FROM web_site AS w JOIN item AS i ON w.web_site_sk = i.i_manufact_id JOIN ship_mode AS SM ON SM.sm_ship_mode_sk = i.i_item_sk WHERE i.i_rec_start_date <= CURRENT_DATE AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date > CURRENT_DATE) AND SM.sm_type IN ('EXPRESS', 'OVERNIGHT', 'REGULAR') AND i.i_current_price IN (5.40, 8.89) GROUP BY w.web_name, w.web_manager, SM.sm_type ORDER BY total_current_price DESC, item_count DESC;
SELECT cp.cp_department, COUNT(DISTINCT ss.ss_item_sk) AS num_products_sold, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid_inc_tax) AS total_sales, AVG(ss.ss_sales_price) AS average_sales_price FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN catalog_page cp ON ss.ss_item_sk = cp.cp_catalog_page_sk JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk WHERE s.s_floor_space IN (6995995, 9078805) AND s.s_market_desc IN ('Mysterious employe', 'Little expectations include yet forward meetings.', 'Events develop i', 'Architects coul') AND p.p_discount_active = '1' AND cd.cd_dep_count IN (1, 2) AND cd.cd_marital_status IN ('D', 'U', 'S', 'M', 'W') AND ss.ss_ext_discount_amt IN (24.03, 205.34) GROUP BY cp.cp_department ORDER BY total_sales DESC;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(wr.wr_return_amt) AS total_return_amt, COUNT(DISTINCT wr.wr_order_number) AS total_returns, (SUM(ws.ws_net_paid_inc_tax) - SUM(wr.wr_return_amt_inc_tax)) AS net_sales_after_returns FROM web_sales ws LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk WHERE ws.ws_sold_date_sk BETWEEN '2451330' AND '2451329' AND cd.cd_dep_employed_count = '0' GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY total_net_paid DESC, total_returns DESC;
SELECT cc_division_name, cc_market_manager, SUM(ws_net_profit) AS total_profit, AVG(ws_quantity) AS average_quantity_sold, COUNT(DISTINCT ws_order_number) AS total_orders, SUM(wr_net_loss) AS total_net_loss, COUNT(DISTINCT wr_order_number) AS total_returns FROM call_center JOIN web_sales ON cc_call_center_sk = ws_warehouse_sk JOIN web_returns ON ws_order_number = wr_order_number WHERE ws_sold_date_sk BETWEEN 2000 AND 3000 AND ws_ship_mode_sk IN (1, 2) AND wr_reason_sk IN (12, 35, 30, 1, 29) AND cc_market_manager IN ('Julius Durham', 'Matthew Clifton', 'Gary Colburn', 'Julius Tran') GROUP BY cc_division_name, cc_market_manager ORDER BY total_profit DESC, total_net_loss ASC;
SELECT ca_state, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_net_sales, AVG(ss_net_profit) AS avg_profit_per_sale, SUM(ss_net_paid_inc_tax) - SUM(ss_net_paid) AS total_tax_collected, web_company_name FROM store_sales JOIN customer_address ON store_sales.ss_addr_sk = customer_address.ca_address_sk JOIN web_site ON store_sales.ss_store_sk = web_site.web_site_sk WHERE web_site.web_company_id IN ('5', '1', '4', '6', '2') AND customer_address.ca_country = 'United States' AND EXTRACT(YEAR FROM CURRENT_DATE) - EXTRACT(YEAR FROM web_rec_start_date) <= 10 GROUP BY ca_state, web_company_name ORDER BY total_net_sales DESC, total_quantity_sold DESC;
SELECT d_year, s_state, COUNT(DISTINCT cr_order_number) AS total_returns, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_quantity) AS avg_return_quantity, SUM(cr_net_loss) AS total_net_loss, COUNT(DISTINCT hd_demo_sk) AS unique_customers_returning, AVG(w_warehouse_sq_ft) AS avg_warehouse_size, SUM(wp_image_count) AS total_images_on_web_pages FROM catalog_returns JOIN date_dim ON catalog_returns.cr_returned_date_sk = date_dim.d_date_sk JOIN store ON store.s_store_sk = catalog_returns.cr_warehouse_sk JOIN household_demographics ON household_demographics.hd_demo_sk = catalog_returns.cr_returning_hdemo_sk JOIN warehouse ON warehouse.w_warehouse_sk = catalog_returns.cr_warehouse_sk JOIN web_page ON web_page.wp_web_page_sk = catalog_returns.cr_catalog_page_sk WHERE web_page.wp_web_page_id IN ('AAAAAAAAJBAAAAAA', 'AAAAAAAANAAAAAAA', 'AAAAAAAAGBAAAAAA') AND web_page.wp_image_count IN (5, 6, 3) AND store.s_geography_class = 'Unknown' AND store.s_store_sk IN (2, 1, 3) AND store.s_gmt_offset = '-5.00' AND store.s_rec_end_date IN ('1999-03-13', '2000-03-12', '2001-03-12') AND date_dim.d_first_dom IN (2419007, 2415690, 2416481) AND date_dim.d_dom IN (16, 4, 9) AND warehouse.w_warehouse_sq_ft IN (294242, 621234, 138504) AND warehouse.w_street_name IN ('Wilson Elm', 'Ash Laurel', 'View First') AND warehouse.w_zip = '35709' AND warehouse.w_warehouse_sk IN (1, 2, 5) AND household_demographics.hd_buy_potential IN ('501-1000', '0-500', '5001-10000') AND household_demographics.hd_vehicle_count IN (4, 3, 0) AND catalog_returns.cr_item_sk IN (16927, 16472, 1372) AND catalog_returns.cr_catalog_page_sk IN (402, 110, 207) AND catalog_returns.cr_refunded_customer_sk IN (57217, 356, 4491) AND catalog_returns.cr_returning_customer_sk IN (45137, 1961, 8472) GROUP BY d_year, s_state ORDER BY d_year, s_state;
SELECT cc.cc_city, cc.cc_name, i.i_category, sum(sr.sr_return_amt_inc_tax) AS total_return_amount_including_tax, avg(sr.sr_return_quantity) AS average_return_quantity, count(sr.sr_ticket_number) AS total_returns, sum(CASE WHEN hd.hd_dep_count BETWEEN 1 AND 3 THEN sr.sr_return_amt_inc_tax ELSE 0 END) AS return_amount_families_1_to_3_kids, sum(CASE WHEN hd.hd_dep_count >= 4 THEN sr.sr_return_amt_inc_tax ELSE 0 END) AS return_amount_families_4_or_more_kids, sum(CASE WHEN sr.sr_return_amt > 0 AND sr.sr_fee > 0 THEN 1 ELSE 0 END) AS returns_with_fees FROM store_returns sr JOIN item i ON sr.sr_item_sk = i.i_item_sk JOIN call_center cc ON cc.cc_city = 'Midway' LEFT JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk WHERE sr.sr_returned_date_sk IS NOT NULL AND sr.sr_store_credit > 0 GROUP BY cc.cc_city, cc.cc_name, i.i_category ORDER BY total_return_amount_including_tax DESC, cc.cc_city, cc.cc_name, i.i_category;
SELECT CAST(SUBSTRING(CAST(cr.cr_returned_date_sk AS VARCHAR), 1, 4) AS INTEGER) AS return_year, CAST(SUBSTRING(CAST(cr.cr_returned_date_sk AS VARCHAR), 5, 2) AS INTEGER) AS return_month, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_customers, COUNT(*) AS total_returns, SUM(p.p_cost) AS promotion_cost, s.s_store_name, s.s_city FROM catalog_returns cr JOIN promotion p ON cr.cr_item_sk = p.p_item_sk JOIN store s ON s.s_store_sk = cr.cr_returning_addr_sk WHERE CAST(SUBSTRING(CAST(cr.cr_returned_date_sk AS VARCHAR), 1, 4) AS INTEGER) = 2023 AND s.s_number_employees BETWEEN 200 AND 300 AND s.s_store_id IN ('AAAAAAAABAAAAAAA', 'AAAAAAAAHAAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAAKAAAAAAA', 'AAAAAAAAEAAAAAAA') AND cr.cr_refunded_addr_sk = 30891 AND p.p_channel_press = 'N' GROUP BY return_year, return_month, s.s_store_name, s.s_city ORDER BY total_return_amount DESC, s.s_store_name, s.s_city;
SELECT c.c_customer_id, p.p_promo_name, SUM(cs.cs_net_profit) AS total_catalog_net_profit, AVG(cs.cs_sales_price) AS avg_catalog_sales_price, COUNT(DISTINCT cs.cs_order_number) AS num_of_catalog_orders, SUM(ws.ws_net_profit) AS total_web_net_profit, AVG(ws.ws_sales_price) AS avg_web_sales_price, COUNT(DISTINCT ws.ws_order_number) AS num_of_web_orders FROM customer c INNER JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk INNER JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk INNER JOIN promotion p ON (cs.cs_promo_sk = p.p_promo_sk AND ws.ws_promo_sk = p.p_promo_sk) WHERE c.c_preferred_cust_flag = 'Y' AND (cs.cs_sold_date_sk = 2450827 OR cs.cs_sold_date_sk = 2450822) AND (p.p_channel_demo = 'N') AND (ws.ws_web_page_sk IN (SELECT wp_web_page_sk FROM web_page WHERE wp_customer_sk IN (1898, 16769))) GROUP BY c.c_customer_id, p.p_promo_name ORDER BY total_catalog_net_profit DESC, total_web_net_profit DESC;
SELECT d_year, d_quarter_name, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_profit) AS total_profit, AVG(cs_net_profit) AS avg_profit_per_order, SUM(cs_quantity) AS total_items_sold, SUM(cr_net_loss) AS total_returns_loss, COUNT(DISTINCT cr_order_number) AS total_return_orders, AVG(cr_return_amount) AS avg_return_amount, COUNT(DISTINCT inv_item_sk) AS distinct_items_in_inventory, AVG(inv_quantity_on_hand) AS avg_inventory_quantity FROM date_dim JOIN catalog_sales ON (cs_sold_date_sk = date_dim.d_date_sk) JOIN catalog_returns ON (cr_returned_date_sk = date_dim.d_date_sk) JOIN inventory ON (inv_date_sk = date_dim.d_date_sk) JOIN store ON (store.s_rec_start_date <= date_dim.d_date AND (store.s_rec_end_date IS NULL OR store.s_rec_end_date >= date_dim.d_date)) WHERE d_year = 2001 AND cs_item_sk = 24 AND cr_refunded_customer_sk IN ('87999', '35845', '11067') AND inv_quantity_on_hand IN (801, 112, 394, 739, 17, 940) AND cr_net_loss IN (30.69, 55.49) AND inv_date_sk = 2450815 AND store.s_company_id = 1 AND store.s_suite_number IN ('Suite 410', 'Suite 80', 'Suite T', 'Suite 190') GROUP BY d_year, d_quarter_name ORDER BY d_year, d_quarter_name;
SELECT i.i_category, i.i_brand, t.t_shift, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantities_sold, AVG(ss.ss_sales_price) AS average_selling_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) - SUM(ss.ss_net_paid) AS total_tax_collected, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE ss.ss_sold_date_sk IN (2451375, 2451147, 2451762, 2451572, 2452439, 2452222) AND ss.ss_sales_price BETWEEN 4.90 AND 95.65 GROUP BY i.i_category, i.i_brand, t.t_shift ORDER BY total_net_profit DESC, i.i_category, i.i_brand, t.t_shift;
SELECT i.i_category, i.i_class, i.i_brand, cd.cd_gender, cd.cd_education_status, SUM(ws.ws_sales_price) AS total_sales, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(*) AS number_of_sales, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cr.cr_order_number) AS number_of_returns FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk LEFT JOIN catalog_returns cr ON ws.ws_order_number = cr.cr_order_number AND ws.ws_item_sk = cr.cr_item_sk LEFT JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk GROUP BY i.i_category, i.i_class, i.i_brand, cd.cd_gender, cd.cd_education_status ORDER BY i.i_category, i.i_class, i.i_brand, cd.cd_gender, cd.cd_education_status;
SELECT c.c_first_name, c.c_last_name, c.c_email_address, cd.cd_education_status, cd.cd_credit_rating, sum(cs.cs_quantity) AS total_quantity_sold, avg(cs.cs_sales_price) AS average_sales_price, sum(cs.cs_net_profit) AS total_net_profit, cp.cp_department, w.w_warehouse_name, w.w_state FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk WHERE c.c_birth_day IN (10, 3, 18) AND w.w_street_type IN ('Parkway', 'Avenue', 'Drive') AND cd.cd_dep_college_count = 0 GROUP BY c.c_first_name, c.c_last_name, c.c_email_address, cd.cd_education_status, cd.cd_credit_rating, cp.cp_department, w.w_warehouse_name, w.w_state ORDER BY total_net_profit DESC, c.c_last_name, c.c_first_name;
SELECT sm.sm_carrier, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_profit, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_quantity_returned, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_net_loss) AS total_loss, COUNT(DISTINCT ss.ss_ticket_number) AS total_store_sales, SUM(ss.ss_quantity) AS total_store_quantity_sold, AVG(ss.ss_sales_price) AS average_store_sales_price, SUM(ss.ss_net_profit) AS total_store_profit FROM ship_mode sm LEFT JOIN catalog_sales cs ON sm.sm_ship_mode_sk = cs.cs_ship_mode_sk LEFT JOIN store_returns sr ON sr.sr_store_sk = cs.cs_bill_customer_sk LEFT JOIN store_sales ss ON ss.ss_store_sk = sr.sr_store_sk WHERE sm.sm_carrier IN ('UPS', 'BARIAN') AND sm.sm_ship_mode_id IN ('AAAAAAAAOAAAAAAA', 'AAAAAAAADAAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAACAAAAAAA') AND cs.cs_bill_hdemo_sk = 3987 AND sr.sr_return_time_sk IN (60750, 41614, 39692, 44726) AND EXISTS (SELECT 1 FROM web_site WHERE web_zip IN ('35709', '31904') AND web_site_sk = cs.cs_warehouse_sk) GROUP BY sm.sm_carrier ORDER BY total_profit DESC, total_loss ASC;
SELECT w_state, i_manufact_id, i_manufact, SUM(sr_return_amt + wr_return_amt) AS total_return_amount, AVG(sr_return_amt + wr_return_amt) AS avg_return_amount, COUNT(DISTINCT sr_ticket_number) AS count_store_returns, COUNT(DISTINCT wr_order_number) AS count_web_returns, SUM(CASE WHEN p_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS promo_related_returns FROM warehouse w LEFT JOIN store_returns sr ON w.w_warehouse_sk = sr.sr_addr_sk LEFT JOIN web_returns wr ON w.w_warehouse_sk = wr.wr_refunded_addr_sk LEFT JOIN item i ON i.i_item_sk = sr.sr_item_sk OR i.i_item_sk = wr.wr_item_sk LEFT JOIN promotion p ON p.p_item_sk = i.i_item_sk AND (sr.sr_returned_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk OR wr.wr_returned_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk) WHERE w_state = 'TN' AND i_manufact_id IN (70, 177, 479) GROUP BY w_state, i_manufact_id, i_manufact HAVING SUM(sr_return_amt + wr_return_amt) > 0 ORDER BY total_return_amount DESC;
SELECT ca.ca_state, cd.cd_education_status, COUNT(DISTINCT c.c_customer_sk) AS total_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(cd.cd_dep_count) AS total_dependents, SUM(cd.cd_dep_employed_count) AS total_employed_dependents, SUM(cd.cd_dep_college_count) AS total_college_dependents, AVG(hd.hd_income_band_sk) AS avg_income_band, AVG(hd.hd_vehicle_count) AS avg_vehicle_count FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE ca.ca_state IS NOT NULL AND cd.cd_education_status IS NOT NULL GROUP BY ca.ca_state, cd.cd_education_status ORDER BY ca.ca_state, cd.cd_education_status;
SELECT sm.sm_type, sm.sm_carrier, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs.cs_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(cs.cs_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(cs.cs_net_profit) AS total_net_profit, AVG(wp.wp_image_count) AS avg_image_count_on_webpage FROM catalog_sales cs JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN web_page wp ON cs.cs_catalog_page_sk = wp.wp_web_page_sk WHERE wp.wp_image_count = 2 GROUP BY sm.sm_type, sm.sm_carrier ORDER BY total_net_paid DESC;
SELECT site.web_name AS website_name, COUNT(DISTINCT ss.ss_ticket_number) AS store_sales_transactions, COUNT(DISTINCT ws.ws_order_number) AS web_sales_transactions, SUM(ss.ss_net_paid_inc_tax) AS total_store_sales, SUM(ws.ws_net_paid_inc_ship_tax) AS total_web_sales, AVG(ss.ss_quantity) AS avg_store_quantity_sold, AVG(ws.ws_quantity) AS avg_web_quantity_sold, cp.cp_department AS department, SUM(CASE WHEN ss.ss_hdemo_sk IN (1437, 496, 6460, 2527, 4508, 4026) THEN ss.ss_net_profit ELSE 0 END) AS store_profit_from_selected_hdemo, SUM(CASE WHEN ws.ws_web_site_sk IN (SELECT web_site_sk FROM web_site WHERE web_company_id IN (3, 5, 2)) THEN ws.ws_net_profit ELSE 0 END) AS web_profit_from_selected_companies FROM store_sales ss FULL OUTER JOIN web_sales ws ON ss.ss_item_sk = ws.ws_item_sk AND ss.ss_sold_date_sk = ws.ws_sold_date_sk LEFT JOIN catalog_page cp ON ws.ws_web_page_sk = cp.cp_catalog_page_sk LEFT JOIN web_site site ON ws.ws_web_site_sk = site.web_site_sk WHERE (cp.cp_catalog_page_sk IN (10, 2795, 1844, 4860) OR cp.cp_catalog_page_sk IS NULL) GROUP BY site.web_name, cp.cp_department ORDER BY total_store_sales DESC, total_web_sales DESC;
SELECT dd.d_quarter_name, cd.cd_education_status, cd.cd_purchase_estimate, AVG(ss.ss_sales_price) AS avg_sales_price, AVG(sr.sr_return_amt) AS avg_return_amount, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number WHERE dd.d_qoy IN ('1', '2', '3', '4') AND cd.cd_purchase_estimate IN ('1500', '500', '4000') GROUP BY dd.d_quarter_name, cd.cd_education_status, cd.cd_purchase_estimate ORDER BY dd.d_quarter_name, cd.cd_education_status, cd.cd_purchase_estimate;
SELECT w.w_warehouse_name, cp.cp_department, cd.cd_education_status, hd.hd_buy_potential, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(*) AS number_of_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_quantity) AS average_return_quantity, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_return_ship_cost) AS total_ship_cost, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN customer_demographics cd ON cr.cr_refunded_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON cr.cr_refunded_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE cr.cr_returned_date_sk BETWEEN 2450810 AND 2450820 AND cp.cp_catalog_number BETWEEN 100 AND 200 AND cr.cr_order_number IN (5410, 3479, 2, 4547, 2428, 2527) AND w.w_suite_number IN ('Suite 80', 'Suite 0', 'Suite P', 'Suite 470') AND cr.cr_refunded_hdemo_sk IN (5152, 662, 6967) AND cd.cd_credit_rating = 'Excellent' GROUP BY w.w_warehouse_name, cp.cp_department, cd.cd_education_status, hd.hd_buy_potential, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_return_amount DESC, w.w_warehouse_name, cp.cp_department;
SELECT ca.ca_country, r.r_reason_desc, COUNT(cr.cr_order_number) AS return_count, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_inc_tax, AVG(cr.cr_return_amt_inc_tax) AS avg_return_inc_tax FROM catalog_returns cr JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN customer_address ca ON cr.cr_refunded_addr_sk = ca.ca_address_sk WHERE ca.ca_country = 'United States' AND r.r_reason_desc = 'reason 27' GROUP BY ca.ca_country, r.r_reason_desc ORDER BY total_return_amount DESC;
SELECT s.s_store_name, s.s_city, s.s_manager, COUNT(DISTINCT sm.sm_ship_mode_sk) AS distinct_shipping_modes, SUM(s.s_floor_space) AS total_floor_space, AVG(s.s_number_employees) AS average_number_of_employees, SUM(s.s_tax_precentage) AS total_tax_percentage, COUNT(*) AS count_of_stores FROM store s LEFT JOIN ship_mode sm ON s.s_store_sk = sm.sm_ship_mode_sk LEFT JOIN reason r ON r.r_reason_sk = s.s_closed_date_sk WHERE s.s_manager IN ('Scott Smith', 'William Ward') AND s.s_city IN ('Fairview', 'Midway') AND r.r_reason_id IN ('AAAAAAAAOBAAAAAA', 'AAAAAAAAMBAAAAAA', 'AAAAAAAAGAAAAAAA', 'AAAAAAAAJBAAAAAA') AND sm.sm_type IN ('NEXT DAY', 'TWO DAY', 'LIBRARY', 'EXPRESS', 'REGULAR', 'OVERNIGHT') GROUP BY s.s_store_name, s.s_city, s.s_manager ORDER BY s.s_city, s.s_store_name;
SELECT dd.d_dow AS day_of_week, cd.cd_gender AS gender, cd.cd_marital_status AS marital_status, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, AVG(CASE WHEN cd.cd_credit_rating = 'Good' THEN 1 WHEN cd.cd_credit_rating = 'Bad' THEN 0 ELSE NULL END) AS avg_credit_good, COUNT(*) AS customer_count FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN date_dim dd ON c.c_first_sales_date_sk = dd.d_date_sk WHERE dd.d_dow = '6' AND cd.cd_dep_count = '2' AND cd.cd_marital_status IN ('M', 'U') AND c.c_first_shipto_date_sk = 2451880 GROUP BY dd.d_dow, cd.cd_gender, cd.cd_marital_status ORDER BY cd.cd_gender, cd.cd_marital_status, avg_purchase_estimate DESC;
SELECT cp_department, i_category, i_class, COUNT(DISTINCT i_item_sk) AS item_count, SUM(i_current_price) AS total_price, AVG(i_current_price) AS average_price, AVG(i_wholesale_cost) AS average_cost, SUM(i_wholesale_cost) AS total_cost, sm_type, COUNT(DISTINCT sm_ship_mode_sk) AS ship_mode_count FROM catalog_page JOIN item ON (cp_catalog_page_sk = i_item_sk) JOIN ship_mode ON (i_item_sk = sm_ship_mode_sk) WHERE cp_catalog_page_sk IN (2547, 2038, 1714) GROUP BY cp_department, i_category, i_class, sm_type ORDER BY cp_department, i_category, i_class;
SELECT ib.ib_lower_bound, ib.ib_upper_bound, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT hd.hd_demo_sk) AS unique_households, COUNT(DISTINCT cc.cc_call_center_sk) AS total_call_centers, SUM(wh.w_warehouse_sq_ft) AS total_warehouse_sq_ft FROM store_sales ss JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN call_center cc ON cc.cc_mkt_id = ss.ss_sold_date_sk JOIN warehouse wh ON wh.w_warehouse_sk = ss.ss_addr_sk WHERE hd.hd_buy_potential = '>10000' AND ib.ib_upper_bound < 150000 AND ss.ss_ext_list_price > 2100 AND cc.cc_gmt_offset = -5.00 AND cc.cc_mkt_desc LIKE 'Rich groups catch longer other fears; future,%' GROUP BY ib.ib_lower_bound, ib.ib_upper_bound;
SELECT cc.cc_city AS call_center_city, cc.cc_state AS call_center_state, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws.ws_order_number) AS number_of_orders, SUM(inv.inv_quantity_on_hand) AS total_inventory_on_hand, SUM(ws.ws_net_profit) AS total_net_profit FROM call_center cc JOIN web_sales ws ON cc.cc_call_center_sk = ws.ws_warehouse_sk JOIN inventory inv ON ws.ws_item_sk = inv.inv_item_sk AND ws.ws_sold_date_sk = inv.inv_date_sk JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk WHERE cc.cc_mkt_id IN ('6', '2', '5') AND cc.cc_suite_number IN ('Suite 70', 'Suite 0', 'Suite U') AND inv.inv_quantity_on_hand IN (645, 327) AND td.t_time_sk IN (247, 1615, 1813, 4029, 3389) AND td.t_hour = 1 GROUP BY call_center_city, call_center_state ORDER BY total_net_profit DESC, call_center_city, call_center_state;
SELECT ca_state, i_category, cc_name, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, COUNT(*) AS num_returns, SUM(wr_return_amt) AS total_web_return_amount, AVG(wr_return_amt) AS avg_web_return_amount, COUNT(DISTINCT wr_order_number) AS num_web_returns FROM catalog_returns JOIN customer_address ON cr_returning_addr_sk = ca_address_sk JOIN item ON cr_item_sk = i_item_sk JOIN call_center ON cr_call_center_sk = cc_call_center_sk JOIN web_returns ON cr_item_sk = wr_item_sk AND cr_order_number = wr_order_number WHERE ca_state IN ('TN', 'CA', 'NY') AND cc_company IN ('6', '1', '2', '3') AND i_category_id BETWEEN 1 AND 100 AND (wr_returned_date_sk BETWEEN 2452602 AND 2452606 OR cr_returned_date_sk BETWEEN 2452602 AND 2452606) GROUP BY ROLLUP (ca_state, i_category, cc_name) ORDER BY ca_state, i_category, cc_name;
SELECT r.r_reason_desc, cc.cc_name AS call_center_name, cc.cc_city AS call_center_city, cc.cc_state AS call_center_state, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_items, SUM(cr.cr_fee) AS total_fees_collected, SUM(cr.cr_store_credit) AS total_store_credit_issued, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk WHERE cr.cr_returned_date_sk BETWEEN 20000101 AND 20001231 AND cr.cr_returning_hdemo_sk IN (5491, 6517, 636, 7063, 3950, 2509) GROUP BY r.r_reason_desc, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_return_amount DESC, total_returns DESC;
SELECT wd.wp_type AS web_page_type, cd.cd_education_status AS customer_education_status, cd.cd_credit_rating AS customer_credit_rating, COUNT(DISTINCT cr.cr_order_number) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, COUNT(DISTINCT ws.ws_order_number) AS total_sales_orders, AVG(ws.ws_net_profit) AS avg_net_profit, SUM(ws.ws_net_profit) AS total_net_profit, SUM(ws.ws_quantity) AS total_items_sold, AVG(ws.ws_sales_price) AS avg_sales_price FROM catalog_returns cr JOIN customer_demographics cd ON cr.cr_returning_cdemo_sk = cd.cd_demo_sk JOIN web_sales ws ON cr.cr_order_number = ws.ws_order_number JOIN web_page wd ON ws.ws_web_page_sk = wd.wp_web_page_sk WHERE wd.wp_char_count = 1564 AND (ws.ws_ext_wholesale_cost = 1838.55 OR ws.ws_ext_wholesale_cost = 3498.48 OR ws.ws_ext_wholesale_cost = 1969.22 OR ws.ws_ext_wholesale_cost = 5894.70 OR ws.ws_ext_wholesale_cost = 5691.84) AND (ws.ws_net_paid = 34.31 OR ws.ws_net_paid = 2469.75 OR ws.ws_net_paid = 2146.56 OR ws.ws_net_paid = 35.86) AND cd.cd_marital_status = 'D' AND (cd.cd_demo_sk = 20608 OR cd.cd_demo_sk = 17946 OR cd.cd_demo_sk = 16993 OR cd.cd_demo_sk = 17510 OR cd.cd_demo_sk = 20633) AND cr.cr_call_center_sk = 2 AND cr.cr_item_sk = 14684 GROUP BY wd.wp_type, cd.cd_education_status, cd.cd_credit_rating ORDER BY total_returns DESC, total_net_profit DESC;
SELECT p.p_promo_name, COUNT(DISTINCT sr.sr_customer_sk) AS number_of_customers, COUNT(sr.sr_ticket_number) AS number_of_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, SUM(sr.sr_return_amt) AS total_return_amount, AVG(hd.hd_vehicle_count) AS avg_vehicles_per_household, ib.ib_lower_bound AS income_band_lower_bound, ib.ib_upper_bound AS income_band_upper_bound, COUNT(DISTINCT cd.cd_demo_sk) AS number_of_unique_customers_demographics, SUM(CASE WHEN cd.cd_gender = 'M' THEN 1 ELSE 0 END) AS male_customer_count, SUM(CASE WHEN cd.cd_gender = 'F' THEN 1 ELSE 0 END) AS female_customer_count, SUM(CASE WHEN cd.cd_credit_rating = 'Low Risk' THEN 1 ELSE 0 END) AS low_risk_credit_customers, SUM(CASE WHEN cd.cd_credit_rating = 'High Risk' THEN 1 ELSE 0 END) AS high_risk_credit_customers FROM store_returns sr JOIN promotion p ON sr.sr_reason_sk = p.p_promo_sk AND p.p_channel_catalog = 'N' LEFT JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk LEFT JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk LEFT JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE p.p_purpose = 'Unknown' AND ib.ib_income_band_sk IN (19, 7, 13, 8, 15, 10) AND sr.sr_customer_sk IN (77634, 47097) AND cd.cd_credit_rating IN ('Low Risk', 'High Risk', 'Unknown') GROUP BY p.p_promo_name, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_return_amount DESC;
SELECT cd.cd_education_status, cd.cd_credit_rating, COUNT(c.c_customer_sk) AS total_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(cd.cd_dep_count) AS total_dependents, SUM(cd.cd_dep_employed_count) AS employed_dependents, SUM(cd.cd_dep_college_count) AS college_dependents FROM customer_demographics cd JOIN customer c ON cd.cd_demo_sk = c.c_current_cdemo_sk LEFT JOIN promotion p ON c.c_current_hdemo_sk = p.p_promo_sk WHERE cd.cd_credit_rating IN ('High Risk', 'Low Risk', 'Good', 'Unknown') AND c.c_last_review_date_sk IN (2452297, 2452588) GROUP BY cd.cd_education_status, cd.cd_credit_rating ORDER BY cd.cd_education_status, cd.cd_credit_rating;
SELECT cp.cp_department, i.i_category, i.i_brand, sm.sm_carrier, s.s_store_name, s.s_company_name, COUNT(DISTINCT inv.inv_item_sk) AS num_items, SUM(inv.inv_quantity_on_hand) AS total_quantity, AVG(i.i_current_price) AS avg_current_price, MAX(i.i_wholesale_cost) AS max_wholesale_cost, MIN(s.s_number_employees) AS min_num_employees, AVG(s.s_tax_precentage) AS avg_tax_percentage FROM catalog_page cp JOIN item i ON cp.cp_catalog_page_sk = i.i_item_sk JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = inv.inv_warehouse_sk JOIN store s ON s.s_store_sk = inv.inv_warehouse_sk WHERE i.i_brand = 'exportibrand #7' AND s.s_number_employees = 271 AND sm.sm_carrier IN ('BOXBUNDLES', 'ALLIANCE', 'PRIVATECARRIER', 'ORIENTAL', 'UPS') AND inv.inv_warehouse_sk IN (1, 2) GROUP BY cp.cp_department, i.i_category, i.i_brand, sm.sm_carrier, s.s_store_name, s.s_company_name ORDER BY total_quantity DESC, avg_current_price DESC;
SELECT s.s_store_name, s.s_company_name, s.s_city, s.s_state, COUNT(DISTINCT w.w_warehouse_sk) AS total_warehouses, COUNT(DISTINCT c.cp_catalog_page_sk) AS total_catalog_pages, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages, AVG(s.s_floor_space) AS average_floor_space, SUM(s.s_number_employees) AS total_employees, AVG(s.s_tax_precentage) AS average_tax_percentage, COUNT(DISTINCT ca.ca_address_sk) FILTER (WHERE ca.ca_country = 'United States') AS total_us_customer_addresses, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft FROM store s LEFT JOIN warehouse w ON s.s_zip = w.w_zip LEFT JOIN catalog_page c ON s.s_market_id = c.cp_catalog_number LEFT JOIN web_page wp ON wp.wp_type = 'bi-annual' LEFT JOIN customer_address ca ON s.s_state = ca.ca_state WHERE s.s_rec_end_date IS NULL AND c.cp_type IN ('quarterly', 'bi-annual') AND c.cp_start_date_sk NOT IN ('2451453', '2451270') AND wp.wp_web_page_sk IN ('52', '2', '42', '39', '10') AND wp.wp_autogen_flag = 'N' GROUP BY s.s_store_sk, s.s_store_name, s.s_company_name, s.s_city, s.s_state ORDER BY s.s_store_name, s.s_state;
SELECT s_state, cd_gender, cd_marital_status, cd_education_status, hd_buy_potential, AVG(cd_purchase_estimate) AS avg_purchase_estimate, SUM(s_number_employees) AS total_employees, COUNT(DISTINCT s_store_sk) AS num_stores, MIN(s_floor_space) AS min_floor_space, MAX(s_floor_space) AS max_floor_space, AVG(s_floor_space) AS avg_floor_space, COUNT(DISTINCT hd_demo_sk) AS num_households, SUM(hd_vehicle_count) AS total_vehicles, AVG(hd_vehicle_count) AS avg_vehicles_per_household FROM store JOIN household_demographics ON (s_store_sk = hd_demo_sk) JOIN customer_demographics ON (hd_demo_sk = cd_demo_sk) WHERE s_country = 'United States' AND s_state IN ('CA', 'TX', 'FL') AND cd_dep_employed_count = 0 AND hd_buy_potential LIKE 'Unknown%' AND cd_education_status IN ('College', '4 yr Degree', 'Graduate Degree') AND s_market_id IS NOT NULL GROUP BY s_state, cd_gender, cd_marital_status, cd_education_status, hd_buy_potential ORDER BY s_state, avg_purchase_estimate DESC, total_employees DESC LIMIT 50;
SELECT p.p_promo_name, COUNT(DISTINCT c.c_customer_sk) AS number_of_customers, AVG(ca.ca_gmt_offset) AS average_gmt_offset, SUM(p.p_cost) AS total_promotion_cost, COUNT(DISTINCT web.web_site_sk) AS number_of_websites, web.web_state, ca.ca_state AS customer_address_state, web.web_country, ca.ca_country AS customer_address_country, COUNT(DISTINCT cp.cp_catalog_page_sk) AS number_of_catalog_pages FROM promotion p JOIN customer c ON c.c_current_hdemo_sk = p.p_item_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN web_site web ON web.web_company_id = p.p_item_sk JOIN catalog_page cp ON cp.cp_department = web.web_class WHERE p.p_channel_email = 'N' AND ca.ca_address_id IN ('AAAAAAAADOMAAAAA', 'AAAAAAAABLHAAAAA') AND p.p_cost = 1000.00 AND web.web_street_number = '247' AND cp.cp_type = 'Catalog' GROUP BY web.web_state, ca.ca_state, web.web_country, ca.ca_country, p.p_promo_name HAVING COUNT(DISTINCT c.c_customer_sk) > 10 ORDER BY total_promotion_cost DESC, number_of_customers DESC LIMIT 100;
SELECT i.i_category, i.i_brand, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN web_page wp ON cr.cr_catalog_page_sk = wp.wp_web_page_sk WHERE i.i_brand_id IN ('10003002', '8008007', '7015003', '9001006', '10011007', '10010015') AND wp.wp_url = 'http://www.foo.com' AND wp.wp_customer_sk IN ('98633', '80555') AND cr.cr_ship_mode_sk IN ('10', '18', '12', '2', '6', '8') GROUP BY i.i_category, i.i_brand ORDER BY total_returns DESC, total_returned_quantity DESC;
SELECT c.c_customer_id, hd.hd_buy_potential, COUNT(*) AS number_of_customers, AVG(hd.hd_vehicle_count) AS average_vehicle_count, SUM(hd.hd_dep_count) AS total_dependents, sm.sm_type AS shipping_type, COUNT(DISTINCT sm.sm_carrier) AS number_of_unique_carriers FROM customer c JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN ship_mode sm ON sm.sm_code = c.c_login WHERE c.c_birth_year > 1980 AND c.c_preferred_cust_flag = 'Y' AND sm.sm_code IN ('BIKE', 'SURFACE', 'SEA') GROUP BY c.c_customer_id, hd.hd_buy_potential, sm.sm_type HAVING COUNT(*) > 1 ORDER BY number_of_customers DESC, average_vehicle_count DESC LIMIT 100;
SELECT d_year, cc_city, sm_carrier, cd_gender, cd_marital_status, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_quantity) AS average_return_quantity, COUNT(sr_ticket_number) AS number_of_returns, MAX(sr_return_amt_inc_tax) AS max_return_amount_including_tax, MIN(sr_fee) AS min_return_fee FROM store_returns sr JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN date_dim d ON sr.sr_returned_date_sk = d.d_date_sk JOIN call_center cc ON cc.cc_call_center_sk = sr.sr_store_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = sr.sr_reason_sk WHERE d_year = 2002 AND cd_gender = 'F' AND sm_carrier IN ('RUPEKSA', 'DIAMOND') AND cc_market_manager IN ('Julius Durham', 'Matthew Clifton', 'Gary Colburn', 'Julius Tran') AND sr_return_tax IN (8.58, 50.84) GROUP BY d_year, cc_city, sm_carrier, cd_gender, cd_marital_status ORDER BY total_return_amount DESC, number_of_returns DESC LIMIT 100;
SELECT ca.ca_city, ca.ca_state, ca.ca_location_type, COUNT(*) AS address_count, AVG(ca.ca_gmt_offset) AS average_gmt_offset, MAX(r.r_reason_sk) AS max_reason_sk, t.t_shift, SUM(CASE WHEN t.t_am_pm = 'AM' THEN 1 ELSE 0 END) AS am_shifts, SUM(CASE WHEN t.t_am_pm = 'PM' THEN 1 ELSE 0 END) AS pm_shifts FROM customer_address ca JOIN reason r ON ca.ca_address_sk = r.r_reason_sk JOIN time_dim t ON t.t_time_sk = r.r_reason_sk WHERE ca.ca_location_type IN ('single family', 'apartment', 'condo') AND t.t_shift = 'third' AND r.r_reason_id IN ('AAAAAAAAOAAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAADCAAAAAA') GROUP BY ca.ca_city, ca.ca_state, ca.ca_location_type, t.t_shift ORDER BY ca.ca_city, ca.ca_state, ca.ca_location_type, t.t_shift;
SELECT w_state, COUNT(DISTINCT w_warehouse_sk) AS total_warehouses, SUM(w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(w_warehouse_sq_ft) AS avg_warehouse_sq_ft, SUM(sr_return_amt) AS total_return_amt, AVG(sr_return_amt) AS avg_return_amt, COUNT(DISTINCT sr_ticket_number) AS total_return_transactions, SUM(wp_char_count) AS total_webpage_char_count, AVG(wp_link_count) AS avg_webpage_link_count, COUNT(DISTINCT web_site_sk) AS total_websites, SUM(web_tax_percentage) AS total_web_tax_percentage, AVG(web_tax_percentage) AS avg_web_tax_percentage FROM warehouse w LEFT JOIN store_returns sr ON w.w_warehouse_sk = sr.sr_store_sk LEFT JOIN web_page wp ON w.w_warehouse_sk = wp.wp_customer_sk LEFT JOIN web_site ws ON wp.wp_web_page_sk = ws.web_site_sk GROUP BY w_state ORDER BY total_return_amt DESC;
SELECT w.web_name, w.web_manager, w.web_mkt_class, SUM(ws.ws_sales_price) AS total_sales, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN web_site w ON ws.ws_web_site_sk = w.web_site_sk JOIN time_dim t ON ws.ws_sold_time_sk = t.t_time_sk WHERE w.web_open_date_sk IN ('2450577', '2450594', '2450807', '2450679') AND t.t_am_pm = 'PM' GROUP BY w.web_name, w.web_manager, w.web_mkt_class ORDER BY total_sales DESC;
SELECT p_channel_dmail AS direct_mail, p_channel_email AS email, p_channel_catalog AS catalog, p_channel_tv AS tv, p_channel_radio AS radio, p_channel_press AS press, p_channel_event AS event, p_channel_demo AS demo, SUM(p_cost) AS total_promo_cost, COUNT(p_promo_sk) AS num_promotions, AVG(sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, COUNT(sr_returned_date_sk) AS total_returns FROM promotion p LEFT JOIN store_returns sr ON p.p_item_sk = sr.sr_item_sk LEFT JOIN date_dim d1 ON p.p_start_date_sk = d1.d_date_sk LEFT JOIN date_dim d2 ON sr.sr_returned_date_sk = d2.d_date_sk LEFT JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE d1.d_fy_year = 1911 AND r.r_reason_sk IN ('15', '19', '29', '8') GROUP BY p_channel_dmail, p_channel_email, p_channel_catalog, p_channel_tv, p_channel_radio, p_channel_press, p_channel_event, p_channel_demo ORDER BY total_promo_cost DESC;
SELECT SUM(cr_return_amount) AS total_catalog_returns, AVG(sr_return_amt) AS average_store_returns, COUNT(DISTINCT ss_customer_sk) AS unique_customers_making_purchases, SUM(ss_net_paid_inc_tax) AS total_sales_revenue_inc_tax, SUM(ss_net_profit) AS total_sales_net_profit FROM catalog_returns JOIN store_returns ON cr_item_sk = sr_item_sk AND cr_order_number = sr_ticket_number JOIN store_sales ON cr_item_sk = ss_item_sk AND cr_order_number = ss_ticket_number WHERE cr_refunded_addr_sk IN ('48782', '39638', '44776', '9470') AND cr_catalog_page_sk IN ('238', '365', '2') AND sr_return_tax IN ('34.09', '13.62') GROUP BY cr_refunded_addr_sk;
SELECT dd.d_year, cc.cc_country, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sales_price, COUNT(DISTINCT wp.wp_web_page_sk) AS webpage_count, SUM(ss.ss_net_paid) - SUM(ss.ss_net_paid_inc_tax) AS total_tax_collected FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN call_center cc ON cc.cc_call_center_sk = ss.ss_store_sk LEFT JOIN web_page wp ON dd.d_date_sk = wp.wp_access_date_sk WHERE dd.d_current_week = 'N' AND cc.cc_country = 'United States' AND cc.cc_call_center_sk IN ('3', '1', '5') AND wp.wp_image_count IN ('1', '2', '4', '5', '6', '7') GROUP BY dd.d_year, cc.cc_country ORDER BY dd.d_year, total_quantity_sold DESC;
SELECT cc.cc_state, AVG(cd.hd_dep_count) AS avg_dependent_count, AVG(cd.hd_vehicle_count) AS avg_vehicle_count, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_sales_price) AS total_sales, AVG(cs.cs_sales_price) AS average_sales_price, AVG(cs.cs_ext_discount_amt) AS average_discount_amount, COUNT(DISTINCT cs.cs_order_number) AS total_transactions FROM catalog_sales cs JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk LEFT JOIN household_demographics cd ON cs.cs_ship_hdemo_sk = cd.hd_demo_sk WHERE cs.cs_sold_date_sk IS NOT NULL AND cc.cc_state IS NOT NULL GROUP BY cc.cc_state ORDER BY total_sales DESC LIMIT 5;
SELECT age_group, hd_buy_potential, AVG(ss_net_paid) AS avg_sales, SUM(ss_quantity) AS total_quantity_sold, COUNT(DISTINCT ss_customer_sk) AS unique_customers FROM customer c JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk CROSS JOIN (SELECT CASE WHEN c_birth_year BETWEEN 1946 AND 1964 THEN 'Baby Boomers' WHEN c_birth_year BETWEEN 1965 AND 1980 THEN 'Generation X' WHEN c_birth_year BETWEEN 1981 AND 1996 THEN 'Millennials' WHEN c_birth_year >= 1997 THEN 'Generation Z' ELSE 'Unknown' END AS age_group, c_customer_sk FROM customer) AS cust_age_group WHERE cust_age_group.c_customer_sk = c.c_customer_sk GROUP BY age_group, hd_buy_potential ORDER BY age_group, hd_buy_potential;
SELECT i_category, i_class, i_brand, SUM(i_current_price) AS total_sales_value, AVG(i_current_price) AS avg_sales_price, COUNT(DISTINCT i_item_sk) AS unique_items_sold, COUNT(DISTINCT c_customer_sk) AS unique_customers, c_birth_country, AVG(EXTRACT(YEAR FROM AGE(MAKE_DATE(c_birth_year, c_birth_month, c_birth_day)))) AS avg_customer_age FROM item JOIN customer ON i_manager_id = c_current_addr_sk JOIN time_dim ON t_time_sk = c_first_sales_date_sk WHERE i_rec_start_date <= NOW() AND (i_rec_end_date IS NULL OR i_rec_end_date > NOW()) AND c_preferred_cust_flag = 'Y' AND t_minute IN ('6', '3', '48', '49') GROUP BY ROLLUP(i_category, i_class, i_brand, c_birth_country) ORDER BY total_sales_value DESC, unique_items_sold DESC, i_category, i_class, i_brand, c_birth_country;
SELECT ws_item_sk, AVG(ws_net_profit) AS avg_web_net_profit, AVG(ss_net_profit) AS avg_store_net_profit, (AVG(ws_net_profit) - AVG(ss_net_profit)) AS profit_difference FROM web_sales JOIN web_page ON ws_web_page_sk = wp_web_page_sk LEFT JOIN store_sales ON ws_item_sk = ss_item_sk WHERE wp_char_count > 3000 GROUP BY ws_item_sk HAVING AVG(ws_net_profit) IS NOT NULL AND AVG(ss_net_profit) IS NOT NULL ORDER BY profit_difference DESC;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_credit_rating, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, COUNT(sr.sr_ticket_number) AS total_returns FROM customer_demographics cd JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk WHERE hd.hd_buy_potential IN ('5001-10000', '>10000') AND sr.sr_reversed_charge > 50 GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_credit_rating HAVING AVG(cd.cd_purchase_estimate) > 500 ORDER BY avg_purchase_estimate DESC, total_return_amount_inc_tax DESC;
SELECT sm.sm_type, w.w_county, w.w_warehouse_sq_ft, ca.ca_street_type, cd.cd_credit_rating, cd.cd_purchase_estimate, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(cd.cd_dep_employed_count) AS avg_employed_dependents, COUNT(DISTINCT ca.ca_address_sk) AS num_customer_addresses FROM ship_mode sm JOIN warehouse w ON sm.sm_ship_mode_sk = w.w_warehouse_sk JOIN inventory inv ON w.w_warehouse_sk = inv.inv_warehouse_sk JOIN customer_address ca ON w.w_state = ca.ca_state JOIN customer_demographics cd ON ca.ca_address_sk = cd.cd_demo_sk JOIN catalog_page cp ON cp.cp_department = w.w_county WHERE sm.sm_type IN ('OVERNIGHT', 'LIBRARY', 'NEXT DAY') AND sm.sm_contract IN ('OrDuVy2H', 'I3uCelXtjP', 'Ek') AND w.w_zip = '35709' AND w.w_county = 'Williamson County' AND w.w_warehouse_sq_ft IN ('138504', '294242', '977787') AND ca.ca_street_type IN ('Road', 'Way', 'Ct.') AND ca.ca_address_id IN ('AAAAAAAAOPNAAAAA', 'AAAAAAAAJEDAAAAA', 'AAAAAAAAGEGAAAAA') AND cd.cd_credit_rating IN ('Good', 'High Risk', 'Unknown') AND cd.cd_dep_employed_count = '0' AND cd.cd_purchase_estimate IN ('9000', '5500', '3500') AND cd.cd_demo_sk IN ('20710', '17420', '21031') AND cp.cp_catalog_page_sk IN ('767', '3436', '3795') AND cp.cp_catalog_number IN ('15', '25', '21') AND cp.cp_catalog_page_number IN ('101', '57', '25') AND inv.inv_item_sk IN ('6955', '13411', '10159') AND inv.inv_warehouse_sk IN ('2', '1') GROUP BY sm.sm_type, w.w_county, w.w_warehouse_sq_ft, ca.ca_street_type, cd.cd_credit_rating, cd.cd_purchase_estimate ORDER BY total_inventory DESC, num_catalog_pages DESC, avg_employed_dependents DESC, num_customer_addresses DESC;
SELECT i.i_category, i.i_brand, w.w_state, COUNT(DISTINCT cr.cr_order_number) as total_returns, SUM(cr.cr_return_amount) as total_return_amount, AVG(cr.cr_return_amount) as avg_return_amount, SUM(cr.cr_return_quantity) as total_return_quantity, AVG(cr.cr_return_quantity) as avg_return_quantity, COUNT(DISTINCT wr.wr_order_number) as total_web_returns, SUM(wr.wr_return_amt) as total_web_return_amount, AVG(wr.wr_return_amt) as avg_web_return_amount, SUM(wr.wr_return_quantity) as total_web_return_quantity, AVG(wr.wr_return_quantity) as avg_web_return_quantity, SUM(cr.cr_refunded_cash + wr.wr_refunded_cash) as total_refunded_cash, SUM(cr.cr_return_ship_cost + wr.wr_return_ship_cost) as total_shipping_cost FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk LEFT JOIN web_returns wr ON cr.cr_item_sk = wr.wr_item_sk AND cr.cr_order_number = wr.wr_order_number GROUP BY i.i_category, i.i_brand, w.w_state ORDER BY total_returns DESC, total_return_amount DESC, total_web_returns DESC, total_web_return_amount DESC;
SELECT ib.ib_income_band_sk, cc.cc_division_name, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amt_inc_tax, SUM(wr.wr_net_loss) AS total_net_loss, COUNT(wr.wr_returned_date_sk) AS total_returns, AVG(hd.hd_dep_count) AS avg_dependents, AVG(hd.hd_vehicle_count) AS avg_vehicles FROM web_returns wr JOIN household_demographics hd ON wr.wr_returning_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN call_center cc ON cc.cc_country = 'United States' AND cc.cc_call_center_sk = wr.wr_refunded_addr_sk WHERE hd.hd_income_band_sk IN (20, 8, 18, 11, 19, 2) GROUP BY ib.ib_income_band_sk, cc.cc_division_name ORDER BY total_net_loss DESC, avg_return_amt_inc_tax DESC;
SELECT r.r_reason_desc AS reason_for_return, w.w_state AS warehouse_state, COUNT(wr.wr_order_number) AS number_of_returns, AVG(wr.wr_return_amt_inc_tax) AS average_return_amount_inc_tax, SUM(wr.wr_return_tax) AS total_return_tax, AVG(wr.wr_net_loss) AS average_net_loss FROM web_returns wr JOIN reason r ON wr.wr_reason_sk = r.r_reason_sk JOIN warehouse w ON wr.wr_returning_addr_sk = w.w_warehouse_sk WHERE r.r_reason_desc IN ('reason 33', 'it is a girl', 'Lost my job', 'Found a better extended warranty in a store') AND w.w_warehouse_name IN ('Important issues liv', 'Bad cards must make.', 'Conventional childr', 'Doors canno') AND wr.wr_return_amt_inc_tax > 0 GROUP BY reason_for_return, warehouse_state ORDER BY number_of_returns DESC, average_return_amount_inc_tax DESC;
SELECT d_year, web_name, COUNT(DISTINCT ws_order_number) AS total_orders, SUM(ws_quantity) AS total_quantity_sold, AVG(ws_net_paid_inc_tax) AS average_net_paid_inc_tax, SUM(ws_net_profit) AS total_net_profit FROM web_sales JOIN web_site ON web_sales.ws_web_site_sk = web_site.web_site_sk JOIN date_dim ON web_sales.ws_sold_date_sk = date_dim.d_date_sk WHERE d_year IN (1911, 1912) AND ws_net_paid_inc_tax > 100 AND ws_wholesale_cost < 100 AND web_sales.ws_web_site_sk IN ( SELECT web_site_sk FROM web_site WHERE web_class = 'Platinum' ) GROUP BY d_year, web_name ORDER BY total_net_profit DESC, d_year, web_name;
SELECT cp.cp_department, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cr.cr_returned_date_sk) AS num_return_dates, ca.ca_state, COUNT(DISTINCT ca.ca_address_sk) AS num_addresses, cd.cd_education_status, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS num_customers_refunded, COUNT(DISTINCT cr.cr_returning_customer_sk) AS num_customers_returning, hd.hd_income_band_sk, SUM(hd.hd_dep_count) AS total_dependents, SUM(ib.ib_upper_bound) AS income_band_upper_sum FROM catalog_page cp JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk JOIN customer_address ca ON cr.cr_refunded_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON cr.cr_refunded_cdemo_sk = cd.cd_demo_sk JOIN customer c ON cr.cr_refunded_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE c.c_preferred_cust_flag = 'Y' AND cp.cp_catalog_number = 28 AND ca.ca_address_id IN ('AAAAAAAABDCAAAAA', 'AAAAAAAAGMKAAAAA', 'AAAAAAAADIKAAAAA') AND cr.cr_order_number IN (4413, 1193, 3467, 1390, 1265) GROUP BY cp.cp_department, ca.ca_state, cd.cd_education_status, hd.hd_income_band_sk ORDER BY total_return_amount DESC, num_customers_refunded DESC;
SELECT cp.cp_department, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(ws.ws_net_profit) AS total_net_profit FROM catalog_page cp JOIN web_sales ws ON cp.cp_catalog_page_sk = ws.ws_web_page_sk JOIN customer c ON ws.ws_ship_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk WHERE cp.cp_end_date_sk IN (2450996, 2451087) AND cp.cp_catalog_page_number IN (3, 25, 96, 38, 39) AND wp.wp_rec_end_date IS NOT NULL AND wp.wp_image_count IN (5, 6, 7, 1, 4) AND cd.cd_purchase_estimate IS NOT NULL GROUP BY cp.cp_department ORDER BY total_net_profit DESC;
SELECT s.s_store_id, s.s_store_name, AVG(sr.sr_refunded_cash) AS avg_refunded_cash, SUM(sr.sr_refunded_cash) AS total_refunded_cash, COUNT(sr.sr_ticket_number) AS total_returns, AVG(sr.sr_net_loss) AS avg_net_loss, cd.cd_education_status, cd.cd_marital_status, COUNT(cd.cd_demo_sk) AS demographic_count FROM store_returns sr JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk WHERE s.s_store_sk = 2 AND sr.sr_refunded_cash = 63.85 GROUP BY s.s_store_id, s.s_store_name, cd.cd_education_status, cd.cd_marital_status ORDER BY total_refunded_cash DESC, avg_net_loss DESC;
SELECT r.r_reason_desc, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_items, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_net_loss) AS total_net_loss, SUM(cs.cs_quantity) AS total_sold_quantity, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_sales_price) AS total_sales, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_returns cr JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN catalog_sales cs ON cr.cr_item_sk = cs.cs_item_sk AND cr.cr_order_number = cs.cs_order_number WHERE cr.cr_returned_date_sk IS NOT NULL AND (cr.cr_refunded_addr_sk IN (18593, 5341, 29829) OR r.r_reason_desc IN ('reason 29', 'reason 28', 'reason 31', 'Lost my job', 'Did not get it on time')) GROUP BY r.r_reason_desc ORDER BY total_returns DESC, total_return_amount DESC;
SELECT i.i_category, SUM(ss.ss_ext_sales_price) AS total_sales, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, COUNT(DISTINCT ss.ss_item_sk) AS unique_items_sold, COUNT(ss.ss_ticket_number) AS total_transactions FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk WHERE s.s_tax_precentage BETWEEN 0.03 AND 0.11 AND i.i_current_price BETWEEN 30 AND 90 GROUP BY i.i_category ORDER BY total_sales DESC, i.i_category;
SELECT ca.ca_state, COUNT(DISTINCT c.c_customer_sk) AS num_customers, COUNT(wr.wr_order_number) AS num_returns, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_return_amt) AS avg_return_amount FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_refunded_customer_sk WHERE c.c_customer_sk IN (2939, 1085, 4773) GROUP BY ca.ca_state ORDER BY total_return_amount DESC, num_returns DESC;
SELECT ca_state, cd_marital_status, hd_buy_potential, COUNT(DISTINCT c_customer_sk) AS num_customers, AVG(ws_quantity) AS avg_quantity_sold, SUM(ws_net_paid_inc_tax) AS total_paid_inc_tax, SUM(ws_net_profit) AS total_net_profit FROM customer JOIN web_sales ON c_customer_sk = ws_bill_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk WHERE ca_county IN ('Esmeralda County', 'Clallam County', 'Henderson County', 'Plumas County', 'Wells County') AND hd_buy_potential IN ('>10000', 'Unknown', '0-500', '5001-10000', '1001-5000', '501-1000') AND cd_marital_status IN ('D', 'M', 'U', 'S', 'W') GROUP BY ROLLUP (ca_state, cd_marital_status, hd_buy_potential) ORDER BY ca_state, cd_marital_status, hd_buy_potential;
SELECT c.c_birth_country, COUNT(DISTINCT c.c_customer_sk) AS total_customers, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_sq_ft FROM customer c JOIN warehouse w ON c.c_birth_country = w.w_country GROUP BY c.c_birth_country ORDER BY total_customers DESC, avg_warehouse_sq_ft DESC;
SELECT p.p_promo_name, avg(cs.cs_sales_price) AS avg_sales_price, sum(cs.cs_ext_discount_amt) AS total_discount_amount, sum(cs.cs_net_profit) AS total_net_profit, cd.cd_gender, cd.cd_education_status, count(cs.cs_order_number) AS total_orders FROM catalog_sales cs JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk WHERE p.p_channel_email = 'N' AND d.d_year = 2022 GROUP BY p.p_promo_name, cd.cd_gender, cd.cd_education_status ORDER BY total_net_profit DESC;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_manager, cc.cc_county, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid_inc_tax) AS total_net_sales_inc_tax, COUNT(*) AS total_sales_transactions, SUM(wr.wr_return_quantity) AS total_quantity_returned, SUM(wr.wr_net_loss) AS total_net_loss FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number WHERE cc.cc_manager IN ('Bob Belcher', 'Felipe Perkins', 'Larry Mccray', 'Mark Hightower') AND (wr.wr_net_loss = 420.16 OR wr.wr_net_loss = 722.98 OR wr.wr_net_loss IS NULL) AND cc.cc_county = 'Williamson County' AND (cs.cs_net_paid_inc_ship_tax IN (916.29, 1861.60, 1365.77, 6061.91, 2472.55) OR wr.wr_returned_time_sk IN (8001, 30891, 54739, 78943, 77408, 21386)) GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_manager, cc.cc_county ORDER BY total_net_sales_inc_tax DESC, total_net_loss ASC;
SELECT i.i_category, i.i_brand, COUNT(DISTINCT i.i_item_sk) AS num_items, SUM(i.i_current_price) AS total_current_price, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, COUNT(DISTINCT c.c_customer_sk) AS num_customers, AVG(c.c_birth_year) AS avg_customer_birth_year, r.r_reason_desc, COUNT(*) AS num_return_reasons FROM item i JOIN customer c ON i.i_manager_id = c.c_current_cdemo_sk LEFT JOIN reason r ON r.r_reason_desc IN ('Package was damaged', 'Did not like the make', 'Parts missing') WHERE i.i_rec_start_date >= '2020-01-01' AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date > CURRENT_DATE) GROUP BY i.i_category, i.i_brand, r.r_reason_desc ORDER BY i.i_category, i.i_brand, r.r_reason_desc;
SELECT cp.cp_department, i.i_category, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(CASE WHEN sr.sr_return_amt > 0 THEN sr.sr_return_amt_inc_tax ELSE 0 END) AS total_return_amount_incl_tax, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_net_loss) AS total_net_loss, t.t_shift AS return_shift, EXTRACT(HOUR FROM TIME '00:00' + sr_return_time_sk * INTERVAL '1 second') AS return_hour FROM store_returns sr JOIN item i ON sr.sr_item_sk = i.i_item_sk JOIN catalog_page cp ON i.i_category_id = cp.cp_catalog_number JOIN time_dim t ON sr.sr_return_time_sk = t.t_time_sk WHERE sr.sr_addr_sk IN (17337, 36342) GROUP BY cp.cp_department, i.i_category, t.t_shift, return_hour ORDER BY total_returns DESC, total_returned_quantity DESC, average_return_amount DESC, total_return_amount_incl_tax DESC, total_fees DESC, total_net_loss DESC;
SELECT cp.cp_department, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_sales_quantity, SUM(ss.ss_net_paid) AS total_sales_amount, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions, SUM(sr.sr_return_quantity) AS total_return_quantity, SUM(sr.sr_net_loss) AS total_return_amount, AVG(hd.hd_dep_count) AS avg_dependents, AVG(hd.hd_vehicle_count) AS avg_vehicles FROM catalog_page cp LEFT JOIN store_sales ss ON cp.cp_catalog_page_sk = ss.ss_sold_date_sk LEFT JOIN store_returns sr ON cp.cp_catalog_page_sk = sr.sr_returned_date_sk LEFT JOIN time_dim td ON ss.ss_sold_time_sk = td.t_time_sk LEFT JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk WHERE cp.cp_start_date_sk IN ('2451450', '2451545', '2451115', '2450997', '2450935', '2451330') GROUP BY cp.cp_department ORDER BY cp.cp_department;
SELECT w_state, ib_income_band_sk, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_net_paid) AS average_net_paid, SUM(cs_net_profit) AS total_profit, COUNT(DISTINCT ws_order_number) AS total_web_orders, SUM(ws_quantity) AS total_web_quantity, AVG(ws_net_paid_inc_ship) AS average_web_net_paid_inc_ship, SUM(ws_net_profit) AS total_web_profit, COUNT(DISTINCT wr_order_number) AS total_returns, SUM(wr_return_quantity) AS total_returned_quantity, AVG(wr_return_amt_inc_tax) AS average_return_amount_inc_tax, SUM(wr_net_loss) AS total_net_loss FROM warehouse w JOIN catalog_sales cs ON w.w_warehouse_sk = cs.cs_warehouse_sk JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN web_sales ws ON w.w_warehouse_sk = ws.ws_warehouse_sk JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number WHERE w.w_county = 'Williamson County' AND w.w_warehouse_sk IN (2, 3) AND cs.cs_ship_addr_sk IN (27775, 21962, 3537, 27769) AND wr.wr_refunded_customer_sk IN (51283, 671, 63734, 16023, 8581, 84835) AND ib.ib_lower_bound IN (80001, 30001, 0, 140001, 110001) GROUP BY w_state, ib_income_band_sk ORDER BY w_state, ib_income_band_sk;
SELECT d.d_year, d.d_quarter_name, SUM(ss_net_profit) AS total_profit, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(wr_return_amt) AS total_returns, COUNT(DISTINCT wr_refunded_customer_sk) AS unique_refunded_customers, COUNT(wr_return_quantity) AS total_returned_items FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk LEFT JOIN web_returns wr ON ss.ss_item_sk = wr.wr_item_sk AND ss.ss_ticket_number = wr.wr_order_number WHERE d.d_year = 2002 AND ss.ss_ext_discount_amt > 0 GROUP BY d.d_year, d.d_quarter_name ORDER BY d.d_year, d.d_quarter_name;
SELECT i_category, i_brand, ca_state, w_state, COUNT(DISTINCT i_item_sk) AS item_count, SUM(i_current_price) AS total_price, AVG(i_wholesale_cost) AS avg_wholesale_cost, SUM(i_current_price - i_wholesale_cost) AS total_profit, COUNT(DISTINCT ca_address_sk) AS customer_address_count, COUNT(DISTINCT w_warehouse_sk) AS warehouse_count FROM item JOIN customer_address ON i_manager_id = ca_address_sk JOIN warehouse ON i_manufact_id = w_warehouse_sk WHERE i_rec_start_date <= CURRENT_DATE AND (i_rec_end_date IS NULL OR i_rec_end_date > CURRENT_DATE) AND ca_city = 'Second 4th' AND w_street_name IN ('Wilson Elm', '6th', 'View First') GROUP BY i_category, i_brand, ca_state, w_state ORDER BY i_category, i_brand, ca_state, w_state;
SELECT d.d_year, d.d_quarter_name, d.d_moy, d.d_holiday, w.w_city, w.w_gmt_offset, SUM(wp.wp_link_count) AS total_links, AVG(wp.wp_char_count) AS average_char_count, COUNT(DISTINCT wp.wp_customer_sk) AS distinct_customers, COUNT(*) AS page_count FROM web_page wp JOIN date_dim d ON wp.wp_access_date_sk = d.d_date_sk JOIN warehouse w ON w.w_gmt_offset = '-5.00' WHERE d.d_moy IN ('5', '11') AND (d.d_holiday = 'Y' OR d.d_holiday = 'N') AND w.w_city = 'Fairview' AND NOT EXISTS ( SELECT 1 FROM time_dim t WHERE t.t_time_sk = wp.wp_access_date_sk AND t.t_sub_shift = 'night' ) GROUP BY d.d_year, d.d_quarter_name, d.d_moy, d.d_holiday, w.w_city, w.w_gmt_offset ORDER BY d.d_year, d.d_quarter_name, d.d_moy, total_links DESC;
SELECT s_state AS state, AVG(ws_sales_price) AS avg_web_sales_price, SUM(ws_quantity) AS total_web_sales_quantity, COUNT(DISTINCT s_store_sk) AS num_stores, COUNT(DISTINCT w_warehouse_sk) AS num_warehouses FROM web_sales JOIN store ON web_sales.ws_ship_addr_sk = store.s_store_sk JOIN warehouse ON web_sales.ws_warehouse_sk = warehouse.w_warehouse_sk GROUP BY state ORDER BY state;
SELECT dd.d_year, dd.d_quarter_name, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_quantity) AS total_web_quantity_sold, SUM(ws.ws_net_paid) AS total_web_net_paid, COUNT(DISTINCT cs.cs_order_number) AS total_catalog_orders, SUM(cs.cs_quantity) AS total_catalog_quantity_sold, SUM(cs.cs_net_paid) AS total_catalog_net_paid, SUM(cr.cr_return_quantity) AS total_returned_quantity, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_fee) AS total_return_fees, SUM(cr.cr_net_loss) AS total_net_loss FROM date_dim dd LEFT JOIN web_sales ws ON ws.ws_sold_date_sk = dd.d_date_sk LEFT JOIN catalog_sales cs ON cs.cs_sold_date_sk = dd.d_date_sk LEFT JOIN catalog_returns cr ON cr.cr_returned_date_sk = dd.d_date_sk WHERE dd.d_year = 2003 GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, SUM(cs.cs_quantity) AS total_catalog_quantity, AVG(cs.cs_sales_price) AS avg_catalog_sales_price, COUNT(DISTINCT cs.cs_order_number) AS num_catalog_orders, SUM(ws.ws_quantity) AS total_web_quantity, AVG(ws.ws_sales_price) AS avg_web_sales_price, COUNT(DISTINCT ws.ws_order_number) AS num_web_orders, SUM(cs.cs_net_profit) AS total_catalog_net_profit, SUM(ws.ws_net_profit) AS total_web_net_profit FROM customer_demographics cd LEFT JOIN catalog_sales cs ON cd.cd_demo_sk = cs.cs_bill_cdemo_sk LEFT JOIN web_sales ws ON cd.cd_demo_sk = ws.ws_bill_cdemo_sk WHERE (cs.cs_bill_cdemo_sk IN (182647, 387585) OR ws.ws_ship_mode_sk IN (12, 2, 5)) GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY total_catalog_net_profit DESC, total_web_net_profit DESC;
SELECT s.s_store_name, count(distinct ss.ss_ticket_number) as total_sales_transactions, sum(ss.ss_quantity) as total_items_sold, sum(ss.ss_net_paid_inc_tax) as total_sales_revenue, sum(cr.cr_return_quantity) as total_items_returned, sum(cr.cr_return_amt_inc_tax) as total_returned_revenue, sum(inv.inv_quantity_on_hand) as total_inventory_quantity FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk LEFT JOIN catalog_returns cr ON ss.ss_item_sk = cr.cr_item_sk AND ss.ss_ticket_number = cr.cr_order_number LEFT JOIN inventory inv ON ss.ss_item_sk = inv.inv_item_sk WHERE s.s_country = 'United States' AND (inv.inv_item_sk = 12400 OR inv.inv_item_sk = 10369 OR inv.inv_item_sk = 8875) AND (ss.ss_ext_list_price = 5535.38 OR ss.ss_ext_list_price = 6147.90 OR ss.ss_ext_list_price = 8470.00 OR ss.ss_ext_list_price = 4720.95 OR ss.ss_ext_list_price = 5696.87 OR ss.ss_ext_list_price = 37.40) AND (cr.cr_return_tax = 123.73 OR cr.cr_return_tax = 44.47 OR cr.cr_return_tax = 115.68 OR cr.cr_return_tax = 4.37) GROUP BY s.s_store_name;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, COUNT(*) AS total_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, AVG(ss.ss_sales_price) AS avg_sales_price, s.s_state, s.s_city, t.t_shift FROM customer_demographics cd JOIN store_sales ss ON cd.cd_demo_sk = ss.ss_cdemo_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE cd.cd_dep_count IN (1, 2) AND s.s_market_id IS NOT NULL GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_credit_rating, s.s_state, s.s_city, t.t_shift ORDER BY total_net_paid DESC, s.s_state, s.s_city LIMIT 100;
SELECT dd.d_year, dd.d_quarter_name, SUM(ws.ws_net_paid) AS total_net_paid, AVG(ws.ws_quantity) AS average_quantity, COUNT(*) AS sales_transactions, SUM(inv.inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT ws.ws_item_sk) AS distinct_items_sold, COUNT(DISTINCT s.s_store_sk) AS number_of_stores, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_quantity) AS average_return_quantity, COUNT(DISTINCT cr.cr_item_sk) AS distinct_items_returned FROM date_dim AS dd JOIN web_sales AS ws ON dd.d_date_sk = ws.ws_sold_date_sk JOIN inventory AS inv ON ws.ws_item_sk = inv.inv_item_sk AND ws.ws_sold_date_sk = inv.inv_date_sk JOIN store AS s ON ws.ws_bill_customer_sk = s.s_store_sk LEFT JOIN catalog_returns AS cr ON ws.ws_item_sk = cr.cr_item_sk AND ws.ws_order_number = cr.cr_order_number WHERE dd.d_current_year = 'N' AND ws.ws_promo_sk IS NOT NULL AND s.s_market_id IN (8, 2, 4, 7) AND inv.inv_warehouse_sk IN (1, 2) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT d_year, d_moy, c.c_last_name, cd.cd_education_status, cd.cd_marital_status, COUNT(*) AS customer_count, SUM(cd.cd_purchase_estimate) AS total_purchase_estimate, AVG(cd.cd_dep_count) AS average_dependents, AVG(cd.cd_dep_employed_count) AS average_employed_dependents, AVG(cd.cd_dep_college_count) AS average_college_dependents FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN date_dim d ON c.c_first_sales_date_sk = d.d_date_sk WHERE c.c_first_sales_date_sk IN (2449879, 2452004, 2451328, 2452389, 2450342, 2449052) AND c.c_last_name IN ('Searcy', 'Joyner', 'Livingston', 'Wise', 'Webb', 'Branch') AND cd.cd_marital_status IN ('S', 'U', 'W', 'M') AND cd.cd_education_status = 'Advanced Degree' AND d.d_last_dom IN ('2417090', '2415990') GROUP BY d_year, d_moy, c.c_last_name, cd.cd_education_status, cd.cd_marital_status ORDER BY d_year DESC, d_moy DESC, c.c_last_name;
SELECT dd.d_year, dd.d_quarter_name, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cr.cr_item_sk) AS distinct_items_returned, COUNT(DISTINCT cr.cr_returning_customer_sk) AS distinct_customers_returned, SUM(i.i_current_price * cr.cr_return_quantity) AS total_sales_lost, COUNT(DISTINCT wp.wp_web_page_sk) AS distinct_web_pages_accessed, SUM(wp.wp_char_count) AS total_web_chars FROM catalog_returns cr JOIN date_dim dd ON cr.cr_returned_date_sk = dd.d_date_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk LEFT JOIN web_page wp ON dd.d_date_sk = wp.wp_access_date_sk WHERE dd.d_current_day = 'N' AND dd.d_day_name IN ('Wednesday', 'Monday', 'Saturday', 'Thursday', 'Tuesday') AND cr.cr_returning_addr_sk IN ('13215', '22286', '5756', '38251', '6237') GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT cp.cp_department, i.i_category, w.w_state, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, COUNT(DISTINCT cr.cr_returned_date_sk) AS count_return_days, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, AVG(i.i_current_price) AS avg_current_price, SUM(sr.sr_return_amt) AS total_store_return_amount, AVG(sr.sr_return_amt) AS avg_store_return_amount, COUNT(DISTINCT sr.sr_customer_sk) AS count_distinct_customers_returning FROM catalog_page cp JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk AND w.w_warehouse_sk = inv.inv_warehouse_sk LEFT JOIN store_returns sr ON i.i_item_sk = sr.sr_item_sk WHERE cp.cp_department = 'DEPARTMENT' AND w.w_state = 'TN' AND (i.i_product_name = 'prin st' OR i.i_product_name = 'eingprin stable') GROUP BY cp.cp_department, i.i_category, w.w_state ORDER BY total_returned_quantity DESC, avg_return_amount DESC;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, cc.cc_tax_percentage, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amt_inc_tax, SUM(wr.wr_return_amt) AS total_return_amt, SUM(wr.wr_return_tax) AS total_return_tax, COUNT(DISTINCT wr.wr_returning_customer_sk) AS distinct_returning_customers FROM web_returns wr JOIN customer c ON wr.wr_returning_customer_sk = c.c_customer_sk JOIN call_center cc ON cc.cc_city = c.c_login JOIN catalog_page cp ON wr.wr_web_page_sk = cp.cp_catalog_page_sk WHERE cp.cp_start_date_sk BETWEEN 2451088 AND 2451510 AND wr.wr_return_amt > 0 AND cc.cc_tax_percentage IS NOT NULL GROUP BY cc.cc_name, cc.cc_city, cc.cc_state, cc.cc_tax_percentage ORDER BY total_return_amt DESC, avg_return_amt_inc_tax DESC;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, AVG(cc.cc_employees) AS average_employee_count, SUM(cc.cc_sq_ft) AS total_call_center_sq_ft, COUNT(DISTINCT w.w_warehouse_sk) AS number_of_warehouses, AVG(w.w_warehouse_sq_ft) AS average_warehouse_sq_ft, SUM(wp.wp_link_count) AS total_web_page_link_count, COUNT(DISTINCT cp.cp_catalog_page_sk) AS number_of_catalog_pages FROM call_center cc LEFT JOIN warehouse w ON cc.cc_city = w.w_city AND cc.cc_state = w.w_state LEFT JOIN web_page wp ON wp.wp_url LIKE '%' || cc.cc_state || '%' LEFT JOIN catalog_page cp ON cc.cc_division = cp.cp_catalog_number WHERE cc.cc_class IN ('small', 'medium', 'large') AND wp.wp_autogen_flag = 'N' AND cp.cp_start_date_sk IN ('2451636', '2451271') AND w.w_suite_number = 'Suite 0' AND w.w_warehouse_sq_ft IN ('621234', '294242', '977787', '138504') GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_call_center_sq_ft DESC, average_employee_count DESC LIMIT 100;
SELECT sm.sm_type AS shipping_mode, hd.hd_vehicle_count AS household_vehicle_count, COUNT(DISTINCT ws.ws_order_number) AS total_sales_orders, SUM(ws.ws_quantity) AS total_sales_quantity, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid_inc_tax) AS total_sales_amount_inc_tax, COUNT(DISTINCT wr.wr_order_number) AS total_return_orders, SUM(wr.wr_return_quantity) AS total_return_quantity, AVG(wr.wr_return_amt_inc_tax) AS average_return_amount_inc_tax, SUM(wr.wr_net_loss) AS total_net_loss FROM web_sales ws LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number LEFT JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk LEFT JOIN inventory inv ON ws.ws_item_sk = inv.inv_item_sk WHERE inv.inv_warehouse_sk IN (1, 2) AND inv.inv_item_sk IN (15040, 8833, 9514) AND hd.hd_vehicle_count = '1' GROUP BY sm.sm_type, hd.hd_vehicle_count ORDER BY total_sales_amount_inc_tax DESC, total_net_loss DESC;
SELECT w_state, cd_education_status, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT cr_order_number) AS total_orders_returned, SUM(inv_quantity_on_hand) AS total_inventory_on_hand FROM catalog_returns JOIN customer_demographics ON cr_returning_cdemo_sk = cd_demo_sk JOIN warehouse ON cr_warehouse_sk = w_warehouse_sk JOIN inventory ON (catalog_returns.cr_warehouse_sk = inventory.inv_warehouse_sk AND catalog_returns.cr_item_sk = inventory.inv_item_sk) JOIN web_page ON cr_catalog_page_sk = wp_web_page_sk WHERE w_street_type IN ('Drive', 'Dr.', 'Avenue', 'Parkway') AND cd_dep_count IN (1, 2) AND cd_education_status IN ('Secondary', 'Unknown') AND wp_max_ad_count = 2 AND wp_autogen_flag = 'Y' GROUP BY w_state, cd_education_status ORDER BY total_return_amount DESC, avg_return_quantity DESC, total_orders_returned DESC, total_inventory_on_hand DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, td.t_am_pm, AVG(ws.ws_sales_price) AS avg_sales_price, SUM(ws.ws_quantity) AS total_sales_quantity, SUM(wr.wr_return_quantity) AS total_return_quantity, SUM(wr.wr_net_loss) AS total_net_loss FROM web_sales ws JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND td.t_time_sk = wr.wr_returned_time_sk WHERE td.t_am_pm = 'AM' GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, td.t_am_pm ORDER BY ib.ib_income_band_sk, td.t_am_pm;
SELECT td.t_shift, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, ib.ib_upper_bound, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws.ws_order_number) AS count_orders, SUM(wr.wr_return_quantity) AS total_quantity_returned, AVG(wr.wr_return_amt) AS average_return_amount, COUNT(DISTINCT wr.wr_order_number) AS count_returns FROM web_sales ws INNER JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk INNER JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk INNER JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk WHERE td.t_shift = 'third' AND td.t_sub_shift = 'night' AND (ib.ib_upper_bound = 10000 OR ib.ib_upper_bound = 20000 OR ib.ib_upper_bound = 130000) GROUP BY td.t_shift, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, ib.ib_upper_bound ORDER BY total_quantity_sold DESC, average_sales_price DESC;
SELECT hd.hd_buy_potential, ib.ib_income_band_sk, sm.sm_carrier, r.r_reason_desc, COUNT(*) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_return_quantity) AS total_return_quantity, AVG(cr.cr_return_quantity) AS average_return_quantity FROM catalog_returns cr JOIN customer_demographics cd ON cr.cr_refunded_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON cr.cr_refunded_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk WHERE hd.hd_buy_potential = '5001-10000' AND ib.ib_lower_bound IN (90001, 30001, 60001) AND sm.sm_carrier IN ('GERMA', 'FEDEX', 'BARIAN') AND r.r_reason_desc IN ('Does not work with a product that I have', 'Did not get it on time', 'Did not like the color') GROUP BY hd.hd_buy_potential, ib.ib_income_band_sk, sm.sm_carrier, r.r_reason_desc ORDER BY total_return_amount DESC, total_returns DESC LIMIT 100;
SELECT COALESCE(customer_sales.cd_gender, customer_returns.cd_gender) AS cd_gender, SUM(total_sales) AS total_sales_amount, AVG(average_sales) AS average_sales_amount, COUNT(DISTINCT customer_sales.c_customer_sk) AS number_of_customers, SUM(total_returns) AS total_returns_amount, AVG(average_returns) AS average_returns_amount, COUNT(DISTINCT customer_returns.c_customer_sk) AS number_of_returning_customers FROM ( SELECT c_customer_sk, cd_gender, ss_sold_date_sk, SUM(ss_sales_price) AS total_sales, AVG(ss_sales_price) AS average_sales FROM customer JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk JOIN store_sales ON ss_customer_sk = c_customer_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk WHERE d_year = 2023 AND cd_gender IN ('M', 'F') GROUP BY c_customer_sk, cd_gender, ss_sold_date_sk ) AS customer_sales FULL OUTER JOIN ( SELECT c_customer_sk, cd_gender, sr_returned_date_sk, SUM(sr_return_amt) AS total_returns, AVG(sr_return_amt) AS average_returns FROM customer JOIN customer_demographics ON c_current_cdemo_sk = cd_demo_sk JOIN store_returns ON sr_customer_sk = c_customer_sk JOIN date_dim ON sr_returned_date_sk = d_date_sk WHERE d_year = 2023 AND cd_gender IN ('M', 'F') GROUP BY c_customer_sk, cd_gender, sr_returned_date_sk ) AS customer_returns ON customer_sales.c_customer_sk = customer_returns.c_customer_sk GROUP BY COALESCE(customer_sales.cd_gender, customer_returns.cd_gender);
SELECT w.web_site_id AS website, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(i.i_current_price) AS total_sales, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, ca.ca_state AS state, ca.ca_country AS country, ca.ca_city AS city FROM web_site w JOIN customer c ON w.web_site_sk = c.c_first_sales_date_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN item i ON w.web_site_sk = i.i_manufact_id WHERE ca.ca_zip IN ('67941', '33451', '79275', '59454') AND ca.ca_suite_number IN ('Suite 470', 'Suite 440', 'Suite H', 'Suite R', 'Suite L') AND w.web_rec_start_date <= CURRENT_DATE AND (w.web_rec_end_date IS NULL OR w.web_rec_end_date > CURRENT_DATE) GROUP BY w.web_site_id, ca.ca_state, ca.ca_country, ca.ca_city ORDER BY total_sales DESC;
SELECT i.i_category, i.i_brand, sm.sm_type, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt) AS avg_return_amount, SUM(wr.wr_return_amt) AS total_return_amount, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_net_loss) AS total_net_loss FROM web_returns wr JOIN item i ON wr.wr_item_sk = i.i_item_sk JOIN ship_mode sm ON wr.wr_returned_date_sk = sm.sm_ship_mode_sk WHERE i.i_item_id IN ('AAAAAAAAEKBBAAAA', 'AAAAAAAACAAAAAAA', 'AAAAAAAAGCCAAAAA', 'AAAAAAAAKMEAAAAA') AND wr.wr_return_tax IN (29.73, 18.36, 50.38, 6.84) AND wr.wr_fee IN (85.54, 18.90, 40.73, 20.86, 73.81) AND sm.sm_ship_mode_sk IN (13, 7, 6, 16, 10) AND sm.sm_type IN ('TWO DAY', 'OVERNIGHT') GROUP BY i.i_category, i.i_brand, sm.sm_type ORDER BY total_net_loss DESC, total_returned_quantity DESC;
SELECT r.r_reason_id, r.r_reason_desc, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_quantity) AS avg_returned_quantity, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_tax) AS total_return_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_net_loss) AS total_net_loss, sm.sm_type AS shipping_type, sm.sm_carrier AS carrier, w.w_warehouse_name AS warehouse_name, s.s_store_name AS store_name FROM catalog_returns cr JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN time_dim t ON cr.cr_returned_time_sk = t.t_time_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN store s ON cr.cr_returning_addr_sk = s.s_store_sk WHERE t.t_sub_shift = 'night' AND t.t_shift = 'third' AND w.w_warehouse_sq_ft > 900000 AND r.r_reason_id IN ('AAAAAAAAIAAAAAAA', 'AAAAAAAAIBAAAAAA', 'AAAAAAAAGAAAAAAA', 'AAAAAAAAACAAAAAA', 'AAAAAAAAPBAAAAAA', 'AAAAAAAAOBAAAAAA') GROUP BY r.r_reason_id, r.r_reason_desc, sm.sm_type, sm.sm_carrier, w.w_warehouse_name, s.s_store_name ORDER BY total_return_amount DESC, total_returns DESC;
SELECT i_category, i_brand, EXTRACT(YEAR FROM i_rec_start_date) AS year_started, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_profit) AS total_net_profit, SUM(cs_coupon_amt) AS total_coupon_amount, AVG(cs_net_paid_inc_ship_tax) AS average_net_paid_including_shipping_and_tax FROM item JOIN catalog_sales ON i_item_sk = cs_item_sk WHERE cs_net_paid > 10000 GROUP BY i_category, i_brand, year_started ORDER BY total_net_paid DESC, i_category, i_brand;
SELECT c.c_customer_id, ca.ca_state, i.i_category, i.i_brand, SUM(i.i_current_price) AS total_revenue, AVG(i.i_wholesale_cost) AS average_wholesale_cost, COUNT(DISTINCT w.w_warehouse_sk) AS number_of_warehouses, COUNT(DISTINCT wp.wp_web_page_sk) AS number_of_web_pages FROM customer AS c JOIN customer_address AS ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN item AS i ON i.i_manufact_id = c.c_customer_sk LEFT JOIN warehouse AS w ON w.w_state = ca.ca_state LEFT JOIN web_page AS wp ON wp.wp_customer_sk = c.c_customer_sk WHERE i.i_brand = 'amalgunivamalg #14' AND i.i_product_name IN ('eingprioughtable', 'eingationese', 'n stoughtation', 'antiationese', 'n stableeseese', 'anticallycally') AND ca.ca_country = 'United States' AND w.w_country = ca.ca_country GROUP BY c.c_customer_id, ca.ca_state, i.i_category, i.i_brand ORDER BY total_revenue DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_type, sm.sm_carrier, COUNT(i.i_item_sk) AS total_items_sold, AVG(i.i_current_price) AS average_selling_price, AVG(i.i_wholesale_cost) AS average_wholesale_cost FROM item i JOIN ship_mode sm ON i.i_container = sm.sm_code JOIN income_band ib ON i.i_manager_id = ib.ib_income_band_sk WHERE i.i_product_name = 'antin steing' AND ib.ib_income_band_sk IN (13, 18, 17, 3, 11, 16) AND sm.sm_contract IN ('uukTktPYycct8', '6Hzzp4JkzjqD8MGXLCDa', 'Xjy3ZPuiDjzHlRx14Z3', 'A5BYO1qH8HGTTN') AND i.i_item_id = 'AAAAAAAAMFLAAAAA' AND sm.sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_type, sm.sm_carrier ORDER BY average_selling_price DESC, total_items_sold DESC;
SELECT c.c_customer_id, sm.sm_type as shipping_type, count(cs_order_number) as total_orders, sum(cs_quantity) as total_quantity, avg(cs_net_paid) as average_net_paid, sum(cs_net_profit) as total_net_profit, date_part('year', d.d_date) as sale_year, d.d_quarter_name as sale_quarter, ib.ib_lower_bound as income_band_lower_bound, ib.ib_upper_bound as income_band_upper_bound FROM catalog_sales cs JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN income_band ib ON c.c_current_hdemo_sk = ib.ib_income_band_sk WHERE d.d_year = 2023 AND sm.sm_code = 'SEA' AND ib.ib_lower_bound >= 30001 AND ib.ib_upper_bound <= 80001 GROUP BY c.c_customer_id, shipping_type, sale_year, sale_quarter, income_band_lower_bound, income_band_upper_bound ORDER BY total_net_profit DESC, total_orders DESC;
SELECT s.s_division_id, s.s_division_name, sm.sm_type, AVG(i.i_current_price) AS avg_item_price, COUNT(DISTINCT i.i_item_sk) AS total_items_sold, SUM(i.i_current_price) AS total_sales FROM item i JOIN store s ON i.i_manufact_id = s.s_store_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = s.s_store_sk WHERE i.i_item_id IN ('AAAAAAAABPCBAAAA', 'AAAAAAAAKEPAAAAA', 'AAAAAAAAHIBAAAAA') AND sm.sm_type IN ('EXPRESS', 'TWO DAY', 'NEXT DAY') AND sm.sm_ship_mode_id IN ('AAAAAAAALAAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAACBAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAABAAAAAAA') AND i.i_rec_start_date BETWEEN '1997-01-01' AND '2001-12-31' AND s.s_rec_start_date BETWEEN '1997-01-01' AND '2001-12-31' GROUP BY s.s_division_id, s.s_division_name, sm.sm_type ORDER BY s.s_division_id, sm.sm_type;
SELECT ib.ib_income_band_sk, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages, AVG(wp.wp_char_count) AS avg_char_count, SUM(wp.wp_link_count) AS total_link_count, AVG(wp.wp_image_count) AS avg_image_count, SUM(wr.wr_return_quantity) AS total_return_quantity, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_fee) AS avg_return_fee, SUM(wr.wr_net_loss) AS total_net_loss FROM income_band ib LEFT JOIN web_page wp ON wp.wp_customer_sk = ib.ib_income_band_sk LEFT JOIN web_returns wr ON wr.wr_web_page_sk = wp.wp_web_page_sk WHERE wp.wp_rec_start_date BETWEEN '1997-09-03' AND '2001-09-03' AND wp.wp_char_count > 4000 AND wr.wr_return_ship_cost BETWEEN 45.88 AND 361.10 GROUP BY ib.ib_income_band_sk ORDER BY ib.ib_income_band_sk;
SELECT i_category, ca_state, t_shift, COUNT(DISTINCT ws_order_number) AS total_orders, SUM(ws_quantity) AS total_quantity, AVG(ws_net_paid) AS average_net_paid, SUM(ws_net_profit) AS total_profit FROM web_sales JOIN item ON ws_item_sk = i_item_sk JOIN customer_address ON ws_bill_addr_sk = ca_address_sk JOIN time_dim ON ws_sold_time_sk = t_time_sk WHERE i_container = 'Unknown' AND ca_street_name IN ('Davis Hill', 'Center Ash', 'Ridge Forest', 'Lincoln Highland') AND t_am_pm = 'AM' AND t_shift = 'third' GROUP BY i_category, ca_state, t_shift ORDER BY total_profit DESC, total_orders DESC;
SELECT d.d_year, d.d_quarter_name, p.p_promo_name, sm.sm_type, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_net_profit, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, SUM(ws.ws_net_paid_inc_tax) AS total_web_sales_inc_tax FROM date_dim d JOIN catalog_sales cs ON cs.cs_sold_date_sk = d.d_date_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number LEFT JOIN web_sales ws ON cs.cs_order_number = ws.ws_order_number WHERE d.d_year = 2003 AND p.p_channel_details LIKE '%early%' GROUP BY d.d_year, d.d_quarter_name, p.p_promo_name, sm.sm_type ORDER BY total_net_profit DESC, total_quantity_sold DESC LIMIT 100;
SELECT cc.cc_name, cc.cc_class, COUNT(DISTINCT c.c_customer_sk) AS total_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(cd.cd_dep_count) AS total_dependents, COUNT(DISTINCT inv.inv_warehouse_sk) AS unique_warehouses, SUM(inv.inv_quantity_on_hand) AS total_inventory FROM call_center cc JOIN customer c ON (cc.cc_call_center_sk = c.c_current_addr_sk) JOIN customer_demographics cd ON (c.c_current_cdemo_sk = cd.cd_demo_sk) JOIN inventory inv ON (cc.cc_sq_ft = inv.inv_quantity_on_hand) WHERE cc.cc_sq_ft IN (649, 2268, 795, 3514, 1138) AND c.c_birth_month IN (3, 5) AND c.c_birth_day = 18 GROUP BY cc.cc_name, cc.cc_class ORDER BY total_customers DESC, avg_purchase_estimate DESC;
SELECT i_category, cd_gender, cd_marital_status, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(ws_net_profit) AS total_web_net_profit, AVG(wr_fee) AS average_return_fee FROM store_sales JOIN item ON ss_item_sk = i_item_sk JOIN web_sales ON ws_item_sk = ss_item_sk JOIN web_returns ON wr_item_sk = ws_item_sk JOIN customer_demographics ON (ss_cdemo_sk = cd_demo_sk AND ws_bill_cdemo_sk = cd_demo_sk AND wr_refunded_cdemo_sk = cd_demo_sk) WHERE i_wholesale_cost > 14.32 AND (cd_gender = 'M' OR cd_gender = 'F') AND (cd_marital_status = 'M' OR cd_marital_status = 'U') AND ws_net_paid_inc_tax > 100 AND wr_return_amt > 0 GROUP BY i_category, cd_gender, cd_marital_status ORDER BY total_quantity_sold DESC, average_sales_price DESC;
SELECT ws.web_site_id, ws.web_name, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(sr.sr_return_quantity) AS total_return_quantity, SUM(sr.sr_net_loss) AS total_net_loss, COUNT(DISTINCT inv.inv_item_sk) AS number_of_distinct_items_in_inventory, AVG(inv.inv_quantity_on_hand) AS avg_quantity_on_hand_per_warehouse, COUNT(DISTINCT inv.inv_warehouse_sk) AS number_of_warehouses FROM web_site ws LEFT JOIN store_returns sr ON ws.web_site_sk = sr.sr_store_sk LEFT JOIN inventory inv ON sr.sr_item_sk = inv.inv_item_sk WHERE ws.web_street_number IN ('805', '887', '247', '671', '835') AND inv.inv_date_sk = 2450815 AND sr.sr_hdemo_sk IN ('2871', '5640') AND inv.inv_warehouse_sk IN ('1', '2') GROUP BY ws.web_site_id, ws.web_name ORDER BY avg_return_amount_inc_tax DESC, total_return_quantity DESC, total_net_loss DESC;
SELECT w_state, ca_country, COUNT(DISTINCT w_warehouse_sk) AS num_warehouses, COUNT(DISTINCT ca_address_sk) AS num_addresses, SUM(cd_purchase_estimate) AS total_purchase_estimate, AVG(w_warehouse_sq_ft) AS avg_warehouse_size, COUNT(DISTINCT cd_demo_sk) AS num_customer_demographics, MAX(cp_catalog_number) AS max_catalog_number FROM warehouse JOIN customer_address ON w_zip = ca_zip JOIN customer_demographics ON ca_county = w_county JOIN catalog_page ON cp_department = w_warehouse_name WHERE w_warehouse_sq_ft > 5000 AND ca_country = 'United States' AND cp_type = 'Electronics' AND cd_credit_rating = 'Good' GROUP BY w_state, ca_country ORDER BY num_warehouses DESC, total_purchase_estimate DESC;
SELECT dd.d_year, dd.d_quarter_name, SUM(ws.ws_net_paid_inc_tax) AS total_sales, AVG(ws.ws_quantity) AS average_quantity_sold, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(inv.inv_quantity_on_hand) AS total_inventory, ca.ca_state, ca.ca_county, i.i_category, i.i_class, hd.hd_buy_potential, hd.hd_vehicle_count FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk JOIN customer_address ca ON ws.ws_ship_addr_sk = ca.ca_address_sk JOIN household_demographics hd ON ws.ws_ship_hdemo_sk = hd.hd_demo_sk WHERE ws.ws_ext_wholesale_cost IN (570.14, 3704.88, 1543.36) AND ws.ws_warehouse_sk IN (4, 5, 3) AND i.i_current_price IN (1.13, 8.95, 2.88) AND i.i_manager_id IN (27, 17, 99) AND i.i_formulation IN ('867742235steel028826', '47967133139rose58993', '54283dodger150399841') AND i.i_brand_id IN (7006008, 10012017, 7009003) AND inv.inv_date_sk = 2450815 AND inv.inv_quantity_on_hand IN (774, 762, 329) AND hd.hd_buy_potential IN ('Unknown', '>10000', '501-1000') AND hd.hd_vehicle_count IN (0, 1, 3) AND dd.d_fy_quarter_seq IN (36, 23, 32) AND dd.d_month_seq IN (46, 21, 40) AND ca.ca_county IN ('Bon Homme County', 'Vinton County', 'Geary County') AND ca.ca_gmt_offset IN (-10.00, -7.00, -9.00) GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state, ca.ca_county, i.i_category, i.i_class, hd.hd_buy_potential, hd.hd_vehicle_count ORDER BY total_sales DESC, total_inventory DESC, dd.d_year, dd.d_quarter_name;
SELECT s.s_state, COUNT(sr.sr_ticket_number) AS total_returns_count, SUM(sr.sr_return_amt) AS total_returns_amount, AVG(sr.sr_return_amt) AS average_return_amount, AVG(w.w_warehouse_sq_ft) AS average_warehouse_sq_footage FROM store s JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk LEFT JOIN warehouse w ON s.s_state = w.w_state WHERE s.s_closed_date_sk IS NULL GROUP BY s.s_state ORDER BY s.s_state;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_ext_discount_amt) AS avg_discount, COUNT(cs.cs_item_sk) AS items_sold, SUM(sr.sr_return_amt) AS total_returns, COUNT(DISTINCT p.p_promo_sk) AS distinct_promotions_used FROM customer c LEFT JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk LEFT JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE c.c_salutation = 'Mr.' AND c.c_email_address IN ('Karen.Phifer@QY.edu', 'Allen.Turner@4.com', 'Larry.Olivas@7r7DYaK8.org', 'Shelly.Yang@LQxk.edu', 'Michelle.Sonnier@UFxKCExi4F.edu', 'John.Howard@2FPvikS8CVIG.edu') AND p.p_discount_active = 'N' AND cs.cs_ext_list_price IN (2280.36, 12094.39, 702.72, 3046.89, 8066.16) AND cs.cs_net_profit IN (-3051.02, -1521.74, -449.68) AND sr.sr_reversed_charge IN (41.31, 103.80, 2.35, 10.21) AND sr.sr_return_ship_cost IN (1284.78, 122.50) GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address ORDER BY total_sales DESC, avg_discount;
SELECT wp_type AS web_page_type, ca_country AS customer_country, COUNT(DISTINCT wp_web_page_sk) AS num_web_pages, AVG(wp_char_count) AS avg_char_count, SUM(wp_link_count) AS total_link_count, SUM(wp_image_count) AS total_image_count FROM web_page JOIN customer_address ON wp_customer_sk = ca_address_sk JOIN reason ON wp_web_page_sk = r_reason_sk WHERE ca_county IN ('Worcester County', 'Tooele County', 'Page County', 'Wabaunsee County') AND r_reason_desc IN ('reason 27', 'unauthorized purchase', 'Did not get it on time', 'Gift exchange') AND r_reason_sk IN (26, 15, 5) GROUP BY web_page_type, customer_country ORDER BY avg_char_count DESC, total_link_count DESC;
SELECT i.i_category_id, i.i_category, COUNT(DISTINCT sr.sr_item_sk) AS total_returned_items, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount FROM store_returns sr JOIN item i ON sr.sr_item_sk = i.i_item_sk JOIN web_page wp ON wp.wp_access_date_sk = sr.sr_returned_date_sk JOIN catalog_page cp ON sr.sr_returned_date_sk BETWEEN cp.cp_start_date_sk AND cp.cp_end_date_sk WHERE wp.wp_access_date_sk IN ('2452566', '2452648', '2452619', '2452639') AND i.i_category_id IN ('9', '10', '4') GROUP BY i.i_category_id, i.i_category ORDER BY total_return_amount DESC LIMIT 5;
SELECT p.p_promo_name, p.p_purpose, COUNT(DISTINCT ss.ss_ticket_number) AS num_sales, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sale_price, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(DISTINCT sr.sr_ticket_number) AS num_returns, SUM(sr.sr_return_quantity) AS total_quantity_returned, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(sr.sr_net_loss) AS total_net_loss, (SUM(ss.ss_net_profit) - SUM(sr.sr_net_loss)) AS net_effect_of_promotions FROM promotion p LEFT JOIN store_sales ss ON p.p_promo_sk = ss.ss_promo_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number WHERE p.p_cost::decimal > 500.00 AND p.p_purpose <> 'Unknown' AND ss.ss_sold_date_sk IS NOT NULL AND sr.sr_returned_date_sk IS NOT NULL GROUP BY p.p_promo_name, p.p_purpose ORDER BY net_effect_of_promotions DESC;
SELECT dd.d_year, dd.d_quarter_name, ib.ib_lower_bound, ib.ib_upper_bound, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk WHERE wp.wp_type = 'welcome' AND wp.wp_autogen_flag = 'N' AND dd.d_quarter_seq IN (SELECT DISTINCT d_quarter_seq FROM date_dim WHERE d_year = 2023) AND td.t_hour BETWEEN 8 AND 20 GROUP BY dd.d_year, dd.d_quarter_name, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY dd.d_year, dd.d_quarter_name, ib.ib_lower_bound, ib.ib_upper_bound;
SELECT cp.cp_department, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_items_sold, SUM(ss.ss_net_paid) AS total_net_sales, AVG(ss.ss_ext_discount_amt) AS average_discount_amount, AVG(ss.ss_coupon_amt) AS average_coupon_amount, COUNT(DISTINCT ws.ws_order_number) AS total_web_transactions, SUM(ws.ws_quantity) AS total_web_items_sold, SUM(ws.ws_net_paid) AS total_web_net_sales, AVG(ws.ws_ext_discount_amt) AS average_web_discount_amount, AVG(ws.ws_coupon_amt) AS average_web_coupon_amount FROM catalog_page cp LEFT JOIN store_sales ss ON cp.cp_catalog_page_sk = ss.ss_item_sk LEFT JOIN web_sales ws ON cp.cp_catalog_page_sk = ws.ws_item_sk LEFT JOIN customer c ON (ss.ss_customer_sk = c.c_customer_sk OR ws.ws_bill_customer_sk = c.c_customer_sk) LEFT JOIN promotion p ON (ss.ss_promo_sk = p.p_promo_sk OR ws.ws_promo_sk = p.p_promo_sk) WHERE c.c_current_addr_sk IN ('19802', '46929', '21311', '47125', '38184', '20733') AND ss.ss_customer_sk IN ('4421', '99300', '61176', '55450', '48911', '11041') AND cp.cp_department = 'DEPARTMENT' AND p.p_response_target = 1 AND p.p_channel_event = 'N' GROUP BY cp.cp_department, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo ORDER BY cp.cp_department, total_net_sales DESC;
SELECT w.w_warehouse_name, w.w_city, w.w_state, w.w_country, d.d_year, d.d_quarter_name, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_quantity) AS total_web_quantity, AVG(ws.ws_sales_price) AS avg_web_sales_price, SUM(ws.ws_net_paid) AS total_web_net_paid, COUNT(DISTINCT ss.ss_ticket_number) AS total_store_sales, SUM(ss.ss_quantity) AS total_store_quantity, AVG(ss.ss_sales_price) AS avg_store_sales_price, SUM(ss.ss_net_paid) AS total_store_net_paid, SUM(CASE WHEN hd.hd_dep_count BETWEEN 3 AND 5 THEN 1 ELSE 0 END) AS households_with_3_to_5_dependents, SUM(CASE WHEN hd.hd_vehicle_count BETWEEN 1 AND 4 THEN 1 ELSE 0 END) AS households_with_1_to_4_vehicles FROM warehouse w LEFT JOIN web_sales ws ON w.w_warehouse_sk = ws.ws_warehouse_sk LEFT JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk LEFT JOIN household_demographics hd ON ws.ws_ship_hdemo_sk = hd.hd_demo_sk LEFT JOIN store_sales ss ON d.d_date_sk = ss.ss_sold_date_sk AND hd.hd_demo_sk = ss.ss_hdemo_sk WHERE w.w_city = 'Fairview' AND w.w_suite_number IN ('Suite P', 'Suite 0', 'Suite 80') AND w.w_street_type IN ('Avenue', 'Parkway', 'Drive') AND w.w_country = 'United States' AND hd.hd_dep_count IN (3, 4, 5) AND hd.hd_buy_potential IN ('5001-10000', 'Unknown', '501-1000') AND hd.hd_vehicle_count IN (1, 3, 4) AND d.d_following_holiday IN ('N', 'Y') AND d.d_last_dom IN ('2418672', '2418852', '2416539') AND d.d_month_seq IN (24, 151, 94) AND d.d_holiday IN ('N', 'Y') GROUP BY w.w_warehouse_name, w.w_city, w.w_state, w.w_country, d.d_year, d.d_quarter_name ORDER BY w.w_warehouse_name, d.d_year, d.d_quarter_name;
SELECT ca_state, ca_city, COUNT(DISTINCT c_customer_sk) AS number_of_customers, SUM(ss_net_paid) AS total_sales_amount, AVG(ss_quantity) AS average_quantity_sold, SUM(ss_net_profit) AS total_profit, MAX(ib_upper_bound) AS max_income_band_upper_bound, AVG(wr_return_amt) AS average_return_amount FROM customer_address JOIN customer ON c_current_addr_sk = ca_address_sk JOIN store_sales ON ss_customer_sk = c_customer_sk JOIN income_band ON ib_income_band_sk = (SELECT hd_income_band_sk FROM household_demographics WHERE hd_demo_sk = c_current_hdemo_sk) LEFT OUTER JOIN web_returns ON wr_order_number = ss_ticket_number AND wr_item_sk = ss_item_sk WHERE ca_street_type IN ('Dr.', 'Blvd', 'Ln', 'Cir.', 'Boulevard', 'Wy') AND ss_net_paid > 1000 AND ss_quantity < 50 GROUP BY ca_state, ca_city ORDER BY total_sales_amount DESC, average_quantity_sold DESC LIMIT 10;
SELECT c.c_customer_id, c.c_email_address, hd.hd_buy_potential, SUM(wr.wr_return_quantity) AS total_return_quantity, AVG(wr.wr_return_amt) AS avg_return_amount, COUNT(DISTINCT wr.wr_order_number) AS num_orders, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_return_ship_cost) AS total_shipping_cost, SUM(wr.wr_refunded_cash) AS total_refunded_cash, SUM(wr.wr_reversed_charge) AS total_reversed_charges, SUM(wr.wr_account_credit) AS total_account_credits, SUM(wr.wr_net_loss) AS total_net_loss FROM customer c JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk GROUP BY c.c_customer_id, c.c_email_address, hd.hd_buy_potential ORDER BY total_return_amount_inc_tax DESC LIMIT 100;
SELECT cs.cc_state AS call_center_state, ws.web_state AS web_site_state, cs.cc_name AS call_center_name, ws.web_name AS web_site_name, COUNT(DISTINCT cs.cc_call_center_sk) AS number_of_call_centers, COUNT(DISTINCT ws.web_site_sk) AS number_of_web_sites, AVG(cs.cc_employees) AS average_employees_per_call_center, AVG(cs.cc_sq_ft) AS average_square_footage_per_call_center, SUM(cd.cd_purchase_estimate) AS total_purchase_estimate, AVG(cd.cd_dep_count) AS average_dependents_per_customer FROM call_center cs JOIN web_site ws ON cs.cc_state = ws.web_state JOIN customer_demographics cd ON (cs.cc_mkt_id = ws.web_mkt_id) WHERE cs.cc_state = 'TN' AND ws.web_state = 'TN' AND (cd.cd_demo_sk = '19181' OR cd.cd_demo_sk = '20612') AND (cd.cd_marital_status = 'M' OR cd.cd_marital_status = 'U') AND ( cs.cc_rec_start_date <= CURRENT_DATE AND (cs.cc_rec_end_date IS NULL OR cs.cc_rec_end_date >= CURRENT_DATE) AND ws.web_rec_start_date <= CURRENT_DATE AND (ws.web_rec_end_date IS NULL OR ws.web_rec_end_date >= CURRENT_DATE) ) GROUP BY cs.cc_state, ws.web_state, cs.cc_name, ws.web_name ORDER BY number_of_call_centers DESC, number_of_web_sites DESC;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_state, COUNT(cp.cp_catalog_page_sk) AS num_catalog_pages, AVG(dd.d_dom) AS avg_day_of_month, SUM(CASE WHEN dd.d_holiday = 'Y' THEN 1 ELSE 0 END) AS num_holidays, SUM(CASE WHEN dd.d_weekend = 'Y' THEN 1 ELSE 0 END) AS num_weekend_days FROM date_dim dd JOIN catalog_page cp ON dd.d_date_sk BETWEEN cp.cp_start_date_sk AND cp.cp_end_date_sk JOIN customer_address ca ON ca.ca_zip = SUBSTRING(cp.cp_description FROM 1 FOR 10) WHERE dd.d_year IN (1910, 1912, 1908, 1905) AND dd.d_dow IN ('6', '0', '4', '1') AND ca.ca_country = 'United States' AND dd.d_dom BETWEEN 1 AND 15 GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state ORDER BY dd.d_year, dd.d_quarter_name, ca.ca_state;
SELECT d.d_year, i.i_category, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT sr.sr_customer_sk) AS unique_customers, w.w_state, w.w_city FROM store_returns sr JOIN date_dim d ON sr.sr_returned_date_sk = d.d_date_sk JOIN item i ON sr.sr_item_sk = i.i_item_sk JOIN warehouse w ON sr.sr_addr_sk = w.w_warehouse_sk WHERE d.d_year = 2023 AND i.i_category_id BETWEEN 1 AND 100 AND w.w_suite_number IN ('Suite 80', 'Suite 0', 'Suite P', 'Suite 470') GROUP BY d.d_year, i.i_category, w.w_state, w.w_city ORDER BY total_return_amount DESC, avg_return_quantity DESC;
SELECT s_store_name, s_state, s_city, d_fy_year, ca_location_type, SUM(ss_quantity) AS total_items_sold, SUM(ss_net_paid) AS total_sales, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(CASE WHEN d_holiday = 'Y' THEN ss_quantity ELSE 0 END) AS holiday_items_sold, SUM(CASE WHEN d_holiday = 'Y' THEN ss_net_paid ELSE 0 END) AS holiday_sales FROM store_sales JOIN store ON store.s_store_sk = store_sales.ss_store_sk JOIN date_dim ON date_dim.d_date_sk = store_sales.ss_sold_date_sk JOIN customer_address ON customer_address.ca_address_sk = store_sales.ss_addr_sk WHERE d_fy_year = (SELECT MAX(d_fy_year) FROM date_dim WHERE d_current_year = 'Y') AND store_sales.ss_list_price BETWEEN 51.03 AND 142.73 AND store_sales.ss_hdemo_sk IN ('3633', '6235', '1050') AND customer_address.ca_location_type IN ('single family', 'apartment') GROUP BY s_store_name, s_state, s_city, d_fy_year, ca_location_type ORDER BY total_sales DESC, s_store_name, s_state, s_city;
SELECT c.c_first_name, c.c_last_name, c.c_birth_country, c.c_email_address, COUNT(sr.sr_return_quantity) AS total_returns, SUM(sr.sr_return_amt) AS total_return_amt, AVG(sr.sr_return_amt) AS avg_return_amt, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_return_ship_cost) AS total_ship_cost, SUM(sr.sr_net_loss) AS total_net_loss, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_carrier FROM customer c JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN income_band ib ON c.c_current_cdemo_sk = ib.ib_income_band_sk JOIN ship_mode sm ON sm.sm_ship_mode_id = 'AAAAAAAABBAAAAAA' WHERE c.c_preferred_cust_flag = 'Y' GROUP BY c.c_first_name, c.c_last_name, c.c_birth_country, c.c_email_address, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_carrier ORDER BY total_return_amt DESC;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(sr_return_amt) AS avg_return_amount, COUNT(DISTINCT sr.sr_ticket_number) AS num_of_returns, COUNT(DISTINCT sm.sm_ship_mode_id) AS num_of_shipping_modes_used FROM customer c JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN inventory inv ON sr.sr_item_sk = inv.inv_item_sk JOIN ship_mode sm ON sm.sm_type = 'NEXT DAY' OR sm.sm_type = 'TWO DAY' WHERE c.c_email_address IN ('Bruce.Ratliff@FDMnSp6ETps.org', 'Louis.Luna@LrZBOvDJ842PiFOfe.edu', 'Anthony.Wilson@BebfByYiKCcg.com') AND c.c_current_hdemo_sk IN ('3673', '5606') GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address ORDER BY c.c_last_name, c.c_first_name;
SELECT ca_state, ca_country, AVG(ca_gmt_offset) AS avg_gmt_offset, COUNT(DISTINCT ca_address_sk) AS num_addresses, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT CASE WHEN t_hour BETWEEN 9 AND 17 THEN ca_address_sk END) AS num_addresses_business_hours FROM customer_address ca JOIN time_dim t ON t.t_time_sk = ca.ca_address_sk JOIN income_band ib ON ib.ib_income_band_sk = ca.ca_address_sk GROUP BY ca_state, ca_country, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ca_state, ca_country, ib.ib_lower_bound;
SELECT s.s_store_name, s.s_city, s.s_state, SUM(i.inv_quantity_on_hand) AS total_quantity_on_hand, AVG(i.inv_quantity_on_hand) AS avg_quantity_on_hand, COUNT(DISTINCT i.inv_item_sk) AS unique_items_count, COUNT(DISTINCT i.inv_warehouse_sk) AS warehouse_count, SUM(wp.wp_link_count) AS total_webpage_links, AVG(wp.wp_image_count) AS avg_webpage_images FROM inventory i JOIN store s ON i.inv_warehouse_sk = s.s_store_sk JOIN web_page wp ON s.s_market_id = wp.wp_customer_sk WHERE i.inv_date_sk = 2450815 AND i.inv_quantity_on_hand IN (499, 291, 296, 643, 586) AND s.s_state IN ('IL', 'KY', 'OR', 'VA', 'FL', 'AL', 'OK', 'IA', 'TX') AND wp.wp_type = 'product' GROUP BY s.s_store_name, s.s_city, s.s_state ORDER BY total_quantity_on_hand DESC, avg_quantity_on_hand DESC;
SELECT c.c_first_name, c.c_last_name, cs_total_sales, ws_total_sales, (cs_total_net_sales + ws_total_net_sales) AS total_combined_net_sales FROM customer c JOIN (SELECT cs_bill_customer_sk, SUM(cs_net_paid) AS cs_total_sales FROM catalog_sales GROUP BY cs_bill_customer_sk) cs_sales ON c.c_customer_sk = cs_sales.cs_bill_customer_sk JOIN (SELECT ws_bill_customer_sk, SUM(ws_net_paid) AS ws_total_sales FROM web_sales GROUP BY ws_bill_customer_sk) ws_sales ON c.c_customer_sk = ws_sales.ws_bill_customer_sk JOIN (SELECT cs_bill_customer_sk, SUM(cs_net_paid_inc_ship_tax) AS cs_total_net_sales FROM catalog_sales GROUP BY cs_bill_customer_sk) total_cs_sales ON c.c_customer_sk = total_cs_sales.cs_bill_customer_sk JOIN (SELECT ws_bill_customer_sk, SUM(ws_net_paid_inc_ship_tax) AS ws_total_net_sales FROM web_sales GROUP BY ws_bill_customer_sk) total_ws_sales ON c.c_customer_sk = total_ws_sales.ws_bill_customer_sk WHERE c.c_birth_country IN ('BRAZIL', 'ROMANIA', 'ICELAND') AND EXISTS (SELECT 1 FROM call_center WHERE cc_call_center_sk = cs_sales.cs_bill_customer_sk AND cc_company_name LIKE 'pri%') AND EXISTS (SELECT 1 FROM web_site WHERE web_site_sk = ws_sales.ws_bill_customer_sk AND web_street_type IN ('Road', 'Way', 'Dr.', 'Cir.', 'Parkway') AND web_street_number IN ('292', '409', '887', '805')) ORDER BY total_combined_net_sales DESC LIMIT 100;
SELECT ca.ca_state AS customer_state, r.r_reason_desc AS return_reason, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_amt) AS total_return_amt, SUM(sr.sr_return_tax) AS total_return_tax, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk GROUP BY ca.ca_state, r.r_reason_desc ORDER BY ca.ca_state, r.r_reason_desc;
SELECT ws.ws_web_site_sk, web.web_name, web.web_class, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, SUM(ws.ws_quantity) as total_quantity_sold, AVG(ws.ws_sales_price) as average_sales_price, COUNT(DISTINCT ws.ws_order_number) as total_orders, SUM(ws.ws_net_paid) as total_net_paid, SUM(ws.ws_net_paid_inc_tax) as total_net_paid_inc_tax, SUM(ws.ws_net_profit) as total_net_profit FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk AND p.p_response_target = '1' WHERE p.p_start_date_sk IN (2451635, 2451362, 2451818, 2451605, 2451420, 2451665) GROUP BY ws.ws_web_site_sk, web.web_name, web.web_class, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY total_net_profit DESC, web.web_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status;
SELECT i.i_item_id, i.i_product_name, i.i_category, COUNT(DISTINCT p.p_promo_sk) AS number_of_promotions, SUM(p.p_cost) AS total_promotion_cost, AVG(i.i_wholesale_cost) AS average_wholesale_cost, s.s_state, s.s_store_name, COUNT(DISTINCT s.s_store_sk) AS number_of_stores, AVG(s.s_tax_precentage) AS average_tax_percentage FROM promotion p JOIN item i ON p.p_item_sk = i.i_item_sk JOIN store s ON s.s_state IN ('AK', 'LA', 'MA', 'IA', 'CO', 'NY') WHERE p.p_start_date_sk BETWEEN '2450133' AND '2450769' AND p.p_end_date_sk BETWEEN '2450150' AND '2450824' AND i.i_product_name IN ('ationeseationable', 'antioughtpriable') AND s.s_gmt_offset = '-5.00' AND s.s_store_id IN ('AAAAAAAAHAAAAAAA', 'AAAAAAAABAAAAAAA', 'AAAAAAAAIAAAAAAA') GROUP BY i.i_item_id, i.i_product_name, i.i_category, s.s_state, s.s_store_name ORDER BY i.i_category, s.s_state, total_promotion_cost DESC;
SELECT w_state, p_purpose, COUNT(DISTINCT wp_web_page_sk) AS total_web_pages, SUM(wp_image_count) AS total_images, AVG(wp_char_count) AS avg_char_count, SUM(CASE WHEN wp_web_page_id IN ('AAAAAAAAOAAAAAAA', 'AAAAAAAAJBAAAAAA', 'AAAAAAAAEBAAAAAA', 'AAAAAAAALCAAAAAA', 'AAAAAAAACAAAAAAA', 'AAAAAAAAGBAAAAAA') THEN 1 ELSE 0 END) AS targeted_web_pages_count, SUM(CASE WHEN t_shift = 'third' THEN 1 ELSE 0 END) AS third_shift_count, AVG(w_warehouse_sq_ft) AS avg_warehouse_size FROM warehouse JOIN promotion ON w_warehouse_sk = p_item_sk JOIN web_page ON wp_customer_sk = w_warehouse_sk JOIN time_dim ON t_time_sk = wp_creation_date_sk WHERE w_state = 'TN' AND (wp_image_count = 4 OR wp_image_count = 1) AND w_warehouse_sk = 2 GROUP BY w_state, p_purpose ORDER BY total_web_pages DESC;
SELECT cp.cp_department, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, COUNT(cr.cr_return_amount) AS num_returns, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_sales_price) AS total_sales, COUNT(cs.cs_sales_price) AS num_sales, ca.ca_state, COUNT(DISTINCT ca.ca_city) AS num_cities FROM catalog_page cp JOIN catalog_sales cs ON cp.cp_catalog_page_sk = cs.cs_catalog_page_sk JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk WHERE cp.cp_catalog_number IN (29, 40) AND cr.cr_refunded_cdemo_sk = 1173022 GROUP BY cp.cp_department, ca.ca_state ORDER BY total_return_amount DESC, total_sales DESC;
SELECT p.p_promo_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_net_paid) AS avg_net_paid, SUM(cs.cs_net_paid_inc_tax) AS sum_net_paid_inc_tax, SUM(ws.ws_net_profit) AS sum_web_net_profit, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_fee) AS avg_return_fee FROM catalog_sales cs JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN web_sales ws ON cs.cs_order_number = ws.ws_order_number AND cs.cs_item_sk = ws.ws_item_sk LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk WHERE cd.cd_credit_rating IN ('Good', 'Unknown') AND p.p_discount_active = 'N' AND cs.cs_net_paid_inc_tax NOT IN ('5209.58', '3100.79') AND NOT EXISTS ( SELECT 1 FROM reason r WHERE r.r_reason_sk = wr.wr_reason_sk AND r.r_reason_desc LIKE 'Wrong size' ) GROUP BY p.p_promo_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY sum_net_paid_inc_tax DESC, total_orders DESC;
SELECT p.p_promo_name, p.p_purpose, p.p_discount_active, SUM(ss.ss_quantity) as total_store_sales_quantity, AVG(ss.ss_sales_price) as avg_store_sales_price, SUM(ws.ws_quantity) as total_web_sales_quantity, AVG(ws.ws_sales_price) as avg_web_sales_price, (SUM(ss.ss_net_paid) + SUM(ws.ws_net_paid)) as total_net_paid, (SUM(ss.ss_net_paid_inc_tax) + SUM(ws.ws_net_paid_inc_tax)) as total_net_paid_inc_tax, (SUM(ss.ss_net_profit) + SUM(ws.ws_net_profit)) as total_net_profit FROM promotion p LEFT JOIN store_sales ss ON p.p_promo_sk = ss.ss_promo_sk LEFT JOIN web_sales ws ON p.p_promo_sk = ws.ws_promo_sk WHERE p.p_channel_tv = 'N' AND p.p_purpose <> 'Unknown' GROUP BY p.p_promo_name, p.p_purpose, p.p_discount_active ORDER BY total_net_profit DESC, total_net_paid DESC, avg_store_sales_price DESC, avg_web_sales_price DESC;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_quantity) AS total_return_quantity, COUNT(*) AS total_returns, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, AVG(hd.hd_dep_count) AS avg_dependent_count FROM call_center cc JOIN catalog_returns cr ON cc.cc_call_center_sk = cr.cr_call_center_sk JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk WHERE cc.cc_country = 'United States' AND cc.cc_rec_start_date > '1998-01-01' AND hd.hd_vehicle_count IN (1, 2, 3) GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_return_quantity DESC, avg_return_amount DESC;
SELECT d_year, cp_department, w_warehouse_name, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_quantity) AS total_quantity_sold, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk WHERE d_year IN (2019, 2020) AND cp_type = 'quarterly' AND w_warehouse_id IN ('AAAAAAAADAAAAAAA', 'AAAAAAAACAAAAAAA') GROUP BY d_year, cp_department, w_warehouse_name ORDER BY d_year DESC, total_net_profit DESC;
SELECT ca.ca_state AS state, i.d_year AS fiscal_year, COUNT(DISTINCT ss.ss_store_sk) AS num_stores, COUNT(DISTINCT ss.ss_item_sk) AS num_products_sold, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_sales, COUNT(DISTINCT sr.sr_store_sk) AS num_stores_with_returns, COUNT(DISTINCT sr.sr_item_sk) AS num_returned_products, SUM(sr.sr_return_quantity) AS total_quantity_returned, SUM(sr.sr_return_amt) AS total_returns, COUNT(DISTINCT cr.cr_call_center_sk) AS num_call_centers_with_returns, COUNT(DISTINCT cr.cr_item_sk) AS num_catalog_returned_products, SUM(cr.cr_return_quantity) AS total_catalog_quantity_returned, SUM(cr.cr_return_amount) AS total_catalog_returns FROM store_sales ss JOIN date_dim i ON ss.ss_sold_date_sk = i.d_date_sk JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number LEFT JOIN catalog_returns cr ON cr.cr_order_number = ss.ss_ticket_number WHERE i.d_fy_year = 2001 GROUP BY ca.ca_state, i.d_year ORDER BY ca.ca_state, i.d_year;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, SUM(cr.cr_return_quantity) AS total_catalog_return_quantity, SUM(cr.cr_return_amount) AS total_catalog_return_amt, AVG(cr.cr_return_amount) AS avg_catalog_return_amt, COUNT(cr.cr_return_amount) AS count_catalog_returns, AVG(cc.cc_tax_percentage) AS avg_call_center_tax_percentage, ws.web_site_id, ws.web_name, ws.web_city, ws.web_state, SUM(wr.wr_return_quantity) AS total_web_return_quantity, SUM(wr.wr_return_amt) AS total_web_return_amt, AVG(wr.wr_return_amt) AS avg_web_return_amt, COUNT(wr.wr_return_amt) AS count_web_returns, AVG(ws.web_tax_percentage) AS avg_web_tax_percentage FROM call_center cc LEFT JOIN catalog_returns cr ON cc.cc_call_center_sk = cr.cr_call_center_sk LEFT JOIN web_site ws ON cc.cc_company = ws.web_company_id LEFT JOIN web_returns wr ON ws.web_site_sk = wr.wr_web_page_sk WHERE (cr.cr_returning_hdemo_sk IN (1311, 6200, 1588, 925, 5366, 4174) OR cr.cr_returning_hdemo_sk IS NULL) AND (cr.cr_reason_sk = 16 OR cr.cr_reason_sk IS NULL) AND cc.cc_rec_start_date <= CURRENT_DATE AND (cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date > CURRENT_DATE) AND ws.web_rec_start_date <= CURRENT_DATE AND (ws.web_rec_end_date IS NULL OR ws.web_rec_end_date > CURRENT_DATE) GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, ws.web_site_id, ws.web_name, ws.web_city, ws.web_state ORDER BY total_catalog_return_amt DESC, total_web_return_amt DESC;
SELECT cd.cd_education_status, ib.ib_income_band_sk, COUNT(DISTINCT ws.ws_order_number) AS number_of_orders, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_sales_price) AS average_sales_price FROM web_sales ws JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE cd.cd_purchase_estimate IS NOT NULL AND ib.ib_upper_bound <= 110000 AND ib.ib_income_band_sk IN (4, 1, 14, 13, 8) GROUP BY ROLLUP (cd.cd_education_status, ib.ib_income_band_sk) ORDER BY total_net_profit DESC, cd.cd_education_status, ib.ib_income_band_sk;
SELECT re.r_reason_desc AS return_reason, sm.sm_type AS ship_mode_type, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS sum_return_amount, SUM(cr.cr_return_tax) AS sum_return_tax, SUM(cr.cr_return_amt_inc_tax) AS sum_return_amt_inc_tax, SUM(cr.cr_fee) AS sum_fees, SUM(cr.cr_return_ship_cost) AS sum_return_ship_cost, SUM(cr.cr_refunded_cash) AS sum_refunded_cash, SUM(cr.cr_reversed_charge) AS sum_reversed_charge, SUM(cr.cr_store_credit) AS sum_store_credit, SUM(cr.cr_net_loss) AS sum_net_loss, wh.w_warehouse_name AS warehouse_name, st.s_store_name AS store_name FROM catalog_returns cr JOIN reason re ON cr.cr_reason_sk = re.r_reason_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse wh ON cr.cr_warehouse_sk = wh.w_warehouse_sk JOIN store st ON cr.cr_returning_customer_sk = st.s_store_sk GROUP BY return_reason, ship_mode_type, warehouse_name, store_name ORDER BY sum_net_loss DESC, total_returned_quantity DESC;
SELECT c.c_birth_year, c.c_birth_country, c.c_preferred_cust_flag, s.s_store_id, s.s_store_name, s.s_city, s.s_state, s.s_market_desc, COUNT(ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws INNER JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk INNER JOIN store s ON ws.ws_ship_addr_sk = s.s_store_sk GROUP BY c.c_birth_year, c.c_birth_country, c.c_preferred_cust_flag, s.s_store_id, s.s_store_name, s.s_city, s.s_state, s.s_market_desc ORDER BY total_net_paid DESC, s.s_state, c.c_birth_year;
SELECT ws.web_manager, ws.web_class, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_return_transactions, SUM(cr.cr_return_amt_inc_tax) AS total_catalog_return_amount_inc_tax, COUNT(DISTINCT p.p_promo_sk) AS total_promotions, SUM(p.p_cost) AS total_promotion_cost FROM web_site ws LEFT JOIN store_returns sr ON ws.web_site_sk = sr.sr_store_sk LEFT JOIN catalog_returns cr ON ws.web_site_sk = cr.cr_catalog_page_sk LEFT JOIN promotion p ON cr.cr_item_sk = p.p_item_sk AND cr.cr_returned_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk WHERE ws.web_manager = 'Jimmy Pope' AND (ws.web_zip = '35709' OR ws.web_zip = '31904') GROUP BY ws.web_manager, ws.web_class ORDER BY total_return_amount_inc_tax DESC, total_catalog_return_amount_inc_tax DESC;
SELECT cc.cc_name, sm.sm_type, CAST(catalog_sales.cs_sold_date_sk AS INTEGER) AS sales_year, SUM(cs_quantity) AS total_quantity_sold, SUM(cs_net_paid) AS total_revenue, AVG(cs_net_profit) AS average_profit, COUNT(DISTINCT cs_order_number) AS total_orders, COUNT(DISTINCT promotion.p_promo_sk) AS total_promotions, SUM(cr_return_amount) AS total_return_amount, SUM(cr_return_quantity) AS total_return_quantity, COUNT(DISTINCT cr_order_number) AS total_return_orders FROM catalog_sales JOIN call_center cc ON catalog_sales.cs_call_center_sk = cc.cc_call_center_sk JOIN ship_mode sm ON catalog_sales.cs_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN promotion ON catalog_sales.cs_promo_sk = promotion.p_promo_sk LEFT JOIN catalog_returns ON catalog_sales.cs_item_sk = catalog_returns.cr_item_sk AND catalog_sales.cs_order_number = catalog_returns.cr_order_number WHERE cc.cc_manager IN ('Julius Durham', 'Matthew Clifton', 'Gary Colburn', 'Julius Tran') AND sm.sm_code IN ('BIKE', 'SEA', 'SURFACE') AND promotion.p_channel_press = 'N' AND catalog_returns.cr_warehouse_sk IN (1, 2) AND catalog_returns.cr_catalog_page_sk IN (366, 295) GROUP BY cc.cc_name, sm.sm_type, sales_year ORDER BY total_revenue DESC, total_orders DESC;
SELECT cp.cp_department, i.i_category, COUNT(DISTINCT cp.cp_catalog_page_sk) AS total_catalog_pages, COUNT(DISTINCT i.i_item_sk) AS total_items, AVG(i.i_current_price) AS average_item_price, SUM(i.i_wholesale_cost) AS total_wholesale_cost, MAX(hd.hd_dep_count) AS max_dep_count, AVG(hd.hd_vehicle_count) AS average_vehicle_count, COUNT(DISTINCT web.web_site_sk) AS total_websites, web.web_country, SUM(web.web_tax_percentage) AS total_tax_percentage FROM catalog_page cp JOIN item i ON cp.cp_catalog_number = i.i_brand_id JOIN household_demographics hd ON hd.hd_income_band_sk = i.i_class_id JOIN web_site web ON web.web_company_id = i.i_manufact_id WHERE web.web_rec_end_date BETWEEN '1999-08-16' AND '2001-08-15' GROUP BY cp.cp_department, i.i_category, web.web_country ORDER BY total_catalog_pages DESC, total_items DESC, average_item_price ASC, total_websites DESC;
SELECT cp.cp_department, i.i_category, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_quantity) AS total_return_quantity, r.r_reason_desc, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_customers_refunded, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_customers_returning, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk WHERE cp.cp_end_date_sk IN ('2451087', '2451239', '2450904', '2450844') GROUP BY cp.cp_department, i.i_category, r.r_reason_desc ORDER BY total_return_amount DESC, total_returns DESC LIMIT 100;
SELECT sm.sm_type, p.p_promo_name, hd.hd_income_band_sk, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs.cs_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(cs.cs_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk JOIN household_demographics hd ON cs.cs_ship_hdemo_sk = hd.hd_demo_sk WHERE sm.sm_ship_mode_sk IN (15, 11, 1) AND sm.sm_type IN ('TWO DAY', 'EXPRESS', 'NEXT DAY') AND p.p_channel_details IN ('Only red systems ring right b', 'Strong cells could dis', 'Finally glad reasons mobili') AND p.p_channel_dmail IN ('N', 'Y') AND p.p_promo_name LIKE '%ese%' OR p.p_promo_name LIKE '%eing%' OR p.p_promo_name LIKE '%able%' AND p.p_purpose = 'Unknown' AND hd.hd_income_band_sk IN (11, 1, 6) AND hd.hd_dep_count IN (5, 0, 2) AND cs.cs_ship_customer_sk IN (6024, 65323, 92049) AND cs.cs_ext_ship_cost IN (36.27, 943.02, 662.47) GROUP BY sm.sm_type, p.p_promo_name, hd.hd_income_band_sk ORDER BY total_net_profit DESC, avg_sales_price DESC, total_orders DESC;
SELECT i_category, i_brand, COUNT(DISTINCT i_item_sk) AS num_items, AVG(i_current_price) AS avg_price, SUM(i_wholesale_cost) AS total_wholesale_cost, COUNT(DISTINCT c_customer_sk) AS num_customers, AVG(hd_dep_count) AS avg_hh_dep_count, AVG(hd_vehicle_count) AS avg_hh_vehicle_count, AVG(income_band.ib_lower_bound + income_band.ib_upper_bound)/2 AS avg_income_band_mid_point FROM item JOIN customer ON i_manager_id = c_customer_sk JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk JOIN income_band ON hd_income_band_sk = income_band.ib_income_band_sk WHERE i_rec_start_date <= CURRENT_DATE AND (i_rec_end_date IS NULL OR i_rec_end_date > CURRENT_DATE) AND (i_wholesale_cost IN (64.92, 7.17, 78.12, 2.36)) AND (i_manufact IN ('barpriable', 'callyoughtought', 'oughteseation', 'oughtbaranti', 'oughtn st', 'eseeseeing')) AND (income_band.ib_income_band_sk IN (9, 19)) AND (household_demographics.hd_income_band_sk IN (4, 18)) GROUP BY i_category, i_brand ORDER BY avg_price DESC, total_wholesale_cost DESC;
SELECT d.d_holiday AS "Is Holiday", d.d_day_name AS "Day of Week", AVG(cc.cc_employees) AS "Average Number of Employees", AVG(w.w_warehouse_sq_ft) AS "Average Warehouse Square Feet", COUNT(DISTINCT cc.cc_call_center_sk) AS "Number of Call Centers", COUNT(DISTINCT w.w_warehouse_sk) AS "Number of Warehouses" FROM call_center cc JOIN date_dim d ON cc.cc_open_date_sk = d.d_date_sk OR cc.cc_closed_date_sk = d.d_date_sk JOIN warehouse w ON cc.cc_state = w.w_state GROUP BY d.d_holiday, d.d_day_name ORDER BY d.d_holiday DESC, d.d_day_name;
SELECT sm.sm_code AS shipping_mode, s.s_store_name AS store_name, cc.cc_name AS call_center_name, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_customers, COUNT(DISTINCT ws.ws_order_number) AS total_web_sales_orders, SUM(ws.ws_net_profit) AS total_web_sales_profit FROM catalog_returns cr JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN store s ON cc.cc_division = s.s_division_id JOIN web_sales ws ON cr.cr_item_sk = ws.ws_item_sk AND cr.cr_order_number = ws.ws_order_number WHERE cr.cr_returned_date_sk BETWEEN 2450952 AND 2451063 AND sm.sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') AND s.s_hours IN ('8AM-12AM', '8AM-4PM') GROUP BY shipping_mode, store_name, call_center_name ORDER BY total_returns DESC, total_return_amount DESC;
SELECT s.s_store_name, s.s_floor_space, s.s_number_employees, s.s_city, s.s_state, dd.d_year, dd.d_quarter_name, SUM(i.inv_quantity_on_hand) AS total_inventory, AVG(i.inv_quantity_on_hand) AS average_inventory, COUNT(DISTINCT i.inv_item_sk) AS unique_items_count, COUNT(DISTINCT i.inv_warehouse_sk) AS unique_warehouses_count FROM inventory i JOIN store s ON i.inv_warehouse_sk = s.s_store_sk JOIN date_dim dd ON i.inv_date_sk = dd.d_date_sk WHERE dd.d_current_month = 'N' AND s.s_store_name LIKE ANY (ARRAY['%eing%', '%ought%', '%bar%', '%ation%', '%anti%', '%able%']) GROUP BY s.s_store_name, s.s_floor_space, s.s_number_employees, s.s_city, s.s_state, dd.d_year, dd.d_quarter_name ORDER BY s.s_state, s.s_city, dd.d_year, dd.d_quarter_name;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(DISTINCT cs.cs_order_number) AS total_catalog_orders, SUM(cs.cs_quantity) AS total_catalog_quantity, AVG(cs.cs_sales_price) AS avg_catalog_sales_price, SUM(ss.ss_net_profit) AS total_store_net_profit, AVG(ss.ss_sales_price) AS avg_store_sales_price, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_page_visits, SUM(wp.wp_link_count) AS total_web_page_links, ws.web_name, ws.web_company_name, ib.ib_lower_bound, ib.ib_upper_bound, s.s_store_name, s.s_number_employees, s.s_floor_space FROM customer_demographics cd LEFT JOIN catalog_sales cs ON cd.cd_demo_sk = cs.cs_bill_cdemo_sk LEFT JOIN store_sales ss ON cd.cd_demo_sk = ss.ss_cdemo_sk LEFT JOIN web_page wp ON cd.cd_demo_sk = wp.wp_customer_sk LEFT JOIN web_site ws ON wp.wp_web_page_id = ws.web_site_id LEFT JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound LEFT JOIN store s ON ss.ss_store_sk = s.s_store_sk LEFT JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk WHERE ib.ib_income_band_sk IN (6, 11, 7) AND (s.s_rec_end_date IN ('1999-03-13', '2000-03-12', '2001-03-12') OR s.s_rec_end_date IS NULL) AND (s.s_store_name LIKE '%cally%' OR s.s_store_name LIKE '%ation%' OR s.s_store_name LIKE '%eing%') AND wp.wp_web_page_id IN ('AAAAAAAAJBAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAAMCAAAAAA') AND wp.wp_web_page_sk IN (30, 40, 9) AND wp.wp_rec_end_date IN ('2000-09-02', '1999-09-03', '2001-09-02') AND cd.cd_dep_college_count = 0 AND cd.cd_marital_status IN ('U', 'W', 'S') AND cd.cd_dep_employed_count = 0 AND ss.ss_sales_price IN (6.97, 54.53, 6.01) AND ss.ss_net_profit IN (-2115.52, -1765.80, -614.39) AND cs.cs_ext_tax IN (18.59, 2.99, 205.24) AND cs.cs_sold_date_sk IN (2450841, 2450829, 2450825) AND ws.web_name IN ('site_2', 'site_4', 'site_0') AND ws.web_street_number IN ('887', '973', '892') AND cp.cp_type IN ('quarterly', 'monthly', 'bi-annual') AND cp.cp_catalog_number IN (31, 32, 13) AND cp.cp_end_date_sk IN (2451574, 2451539, 2451299) GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, ws.web_name, ws.web_company_name, ib.ib_lower_bound, ib.ib_upper_bound, s.s_store_name, s.s_number_employees, s.s_floor_space ORDER BY total_catalog_orders DESC, total_store_net_profit DESC, total_web_page_visits DESC;
SELECT t_shift, EXTRACT(YEAR FROM TO_TIMESTAMP(t_time_id, 'YYYYMMDDHH24MISS')) AS sale_year, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs_order_number) AS number_of_orders, SUM(ws_quantity) AS total_quantity_web_sold, AVG(ws_sales_price) AS average_web_sales_price, COUNT(DISTINCT ws_order_number) AS number_of_web_orders, SUM(wr_return_quantity) AS total_quantity_returned, AVG(wr_return_amt) AS average_return_amount, COUNT(DISTINCT wr_order_number) AS number_of_returns, (SUM(cs_net_profit) + SUM(ws_net_profit) - SUM(wr_net_loss)) AS total_net_profit FROM catalog_sales JOIN time_dim ON cs_sold_time_sk = t_time_sk JOIN web_sales ON cs_order_number = ws_order_number AND cs_item_sk = ws_item_sk JOIN web_returns ON cs_order_number = wr_order_number AND cs_item_sk = wr_item_sk WHERE t_time IN ('2095', '1273', '731', '4867', '571', '4658') AND t_time_id IN ('AAAAAAAACEEAAAAA', 'AAAAAAAAJGMAAAAA', 'AAAAAAAABJLAAAAA', 'AAAAAAAAFHIAAAAA', 'AAAAAAAAFOLAAAAA') GROUP BY t_shift, sale_year ORDER BY sale_year, t_shift;
SELECT dd.d_year, dd.d_month_seq, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(promo.p_response_target) AS avg_response_target, COUNT(DISTINCT cc.cc_call_center_id) AS num_call_centers, SUM(CASE WHEN promo.p_channel_dmail = 'Y' THEN 1 ELSE 0 END) AS dmail_promo_count, SUM(CASE WHEN promo.p_channel_tv = 'N' THEN 1 ELSE 0 END) AS non_tv_promo_count, ib.ib_income_band_sk, COUNT(DISTINCT inv.inv_item_sk) AS unique_items, COUNT(DISTINCT inv.inv_warehouse_sk) AS unique_warehouses FROM date_dim AS dd JOIN inventory AS inv ON dd.d_date_sk = inv.inv_date_sk JOIN promotion AS promo ON dd.d_date_sk BETWEEN promo.p_start_date_sk AND promo.p_end_date_sk JOIN call_center AS cc ON cc.cc_open_date_sk <= dd.d_date_sk AND (cc.cc_closed_date_sk IS NULL OR cc.cc_closed_date_sk >= dd.d_date_sk) JOIN income_band AS ib ON cc.cc_mkt_id = ib.ib_income_band_sk WHERE dd.d_year = 2000 AND inv.inv_warehouse_sk IN (1, 2) AND inv.inv_item_sk IN (8690, 8431, 8896, 6346) AND dd.d_moy BETWEEN 1 AND 6 GROUP BY dd.d_year, dd.d_month_seq, ib.ib_income_band_sk ORDER BY dd.d_year, dd.d_month_seq, total_inventory DESC;
SELECT dd.d_year, dd.d_quarter_name, sm.sm_type, ca.ca_state, COUNT(DISTINCT cp.cp_catalog_page_sk) AS total_catalog_pages, SUM(CASE WHEN ca.ca_location_type = 'single family' THEN 1 ELSE 0 END) AS single_family_count, SUM(CASE WHEN ca.ca_location_type = 'apartment' THEN 1 ELSE 0 END) AS apartment_count, SUM(CASE WHEN ca.ca_location_type = 'condo' THEN 1 ELSE 0 END) AS condo_count, AVG(ca.ca_gmt_offset) AS avg_gmt_offset FROM catalog_page cp JOIN date_dim dd ON cp.cp_start_date_sk = dd.d_date_sk OR cp.cp_end_date_sk = dd.d_date_sk JOIN customer_address ca ON cp.cp_catalog_page_sk = ca.ca_address_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = dd.d_date_sk WHERE dd.d_year = 2023 GROUP BY dd.d_year, dd.d_quarter_name, sm.sm_type, ca.ca_state ORDER BY dd.d_year, dd.d_quarter_name, sm.sm_type, ca.ca_state;
SELECT ca_state, cp_department, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(ss_net_paid) AS total_net_paid, SUM(ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss_net_profit) AS total_net_profit FROM store_sales JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN catalog_page ON ss_promo_sk = cp_catalog_page_sk WHERE ss_sold_date_sk = 2450815 AND cp_description IN ( 'Only nuclear policies understand so basic courts.', 'Just local products used to note well; areas note', 'Women apply in vain in the minutes. Officials can', 'Traditional, clear years used to cover regardless' ) AND ss_cdemo_sk IN ( SELECT cd_demo_sk FROM customer_demographics WHERE cd_dep_count IN ('1', '2') ) GROUP BY ca_state, cp_department ORDER BY total_net_profit DESC, total_quantity_sold DESC;
SELECT s_store_name, s_state, COUNT(sr_ticket_number) AS total_returns, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_quantity) AS average_return_quantity, SUM(ws_net_paid_inc_tax) AS total_sales_inc_tax, AVG(ws_list_price) AS average_list_price, AVG(ws_net_profit) AS average_net_profit FROM store s JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk JOIN web_sales ws ON sr.sr_item_sk = ws.ws_item_sk JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE c.c_email_address IN ( 'Adam.Chambers@1fmL5RoSch74.edu', 'William.Kaye@Mx1n74bCJjkc08.edu', 'Imogene.Lewis@813MelxMLZ9gy.com', 'Dorothy.Garza@6Tn1dJ431OQYNTb.org', 'Ora.Spain@CT.edu', 'Denise.Gomez@3GlO.edu' ) AND ws.ws_net_paid_inc_tax IN (15407.14, 2937.00, 988.50, 3439.64, 992.77) AND ws.ws_list_price IN (177.80, 201.11) AND hd.hd_income_band_sk IN (16, 7) AND sr.sr_return_tax IN (215.85, 29.41, 35.05, 67.89) GROUP BY s_store_name, s_state ORDER BY total_return_amount DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, SUM(cr.cr_return_amt_inc_tax) AS total_catalog_return, AVG(cr.cr_fee) AS avg_catalog_fee, COUNT(cr.cr_order_number) AS count_catalog_returns, SUM(wr.wr_return_amt_inc_tax) AS total_web_return, AVG(wr.wr_fee) AS avg_web_fee, COUNT(wr.wr_order_number) AS count_web_returns FROM income_band ib LEFT JOIN catalog_returns cr ON ib.ib_income_band_sk = cr.cr_refunded_cdemo_sk LEFT JOIN web_returns wr ON ib.ib_income_band_sk = wr.wr_refunded_cdemo_sk GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ib.ib_income_band_sk;
SELECT i.i_category, cd.cd_education_status, cd.cd_marital_status, COUNT(DISTINCT i.i_item_sk) AS item_count, AVG(i.i_current_price) AS avg_current_price, AVG(i.i_wholesale_cost) AS avg_wholesale_cost FROM item i JOIN customer_demographics cd ON cd.cd_demo_sk = i.i_manager_id JOIN household_demographics hd ON hd.hd_demo_sk = i.i_manager_id WHERE i.i_rec_start_date <= CURRENT_DATE AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date > CURRENT_DATE) AND cd.cd_gender IN ('M', 'F') AND cd.cd_marital_status IN ('D', 'U', 'S', 'M', 'W') GROUP BY i.i_category, cd.cd_education_status, cd.cd_marital_status ORDER BY i.i_category, cd.cd_education_status, cd.cd_marital_status;
SELECT cc.cc_city, i.i_category, COUNT(DISTINCT cc.cc_call_center_sk) AS total_call_centers, SUM(cc.cc_employees) AS total_employees, AVG(cc.cc_sq_ft) AS avg_square_footage, COUNT(DISTINCT i.i_item_sk) AS total_items, AVG(i.i_current_price) AS avg_item_price, MIN(ib.ib_lower_bound) AS min_income_band_lower_bound, MAX(ib.ib_upper_bound) AS max_income_band_upper_bound, AVG(cc.cc_tax_percentage) AS avg_tax_percentage FROM call_center cc JOIN item i ON cc.cc_division = i.i_manufact_id JOIN income_band ib ON ib.ib_income_band_sk = cc.cc_mkt_id WHERE cc.cc_street_type IN ('Boulevard', 'RD', 'Way') AND i.i_units IN ('Dram', 'Ounce', 'Gram') AND ib.ib_income_band_sk IN (3, 5, 7, 8) AND cc.cc_tax_percentage BETWEEN 0.01 AND 0.12 GROUP BY cc.cc_city, i.i_category ORDER BY total_call_centers DESC, avg_item_price ASC LIMIT 10;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(i.i_current_price) AS average_item_price, COUNT(DISTINCT c.cd_demo_sk) AS unique_customer_count, SUM(CASE WHEN t.t_shift = 'Morning' THEN 1 ELSE 0 END) AS morning_shifts, SUM(CASE WHEN t.t_shift = 'Evening' THEN 1 ELSE 0 END) AS evening_shifts FROM call_center cc JOIN inventory inv ON cc.cc_call_center_sk = inv.inv_warehouse_sk JOIN item i ON inv.inv_item_sk = i.i_item_sk JOIN customer_demographics c ON i.i_manager_id = c.cd_demo_sk JOIN time_dim t ON inv.inv_date_sk = t.t_time_sk WHERE cc.cc_tax_percentage IN (0.01, 0.05, 0.11, 0.12) AND i.i_category_id IN (7, 6, 2, 9, 5, 10) AND t.t_time_id IN ('AAAAAAAALICBAAAA', 'AAAAAAAALJJAAAAA', 'AAAAAAAAEMJAAAAA', 'AAAAAAAAAEBAAAAA') GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_inventory DESC, average_item_price DESC, unique_customer_count DESC LIMIT 100;
SELECT i.i_category, cc.cc_city, cc.cc_state, sum(cr.cr_return_amount) as total_return_amount, avg(cr.cr_return_amount) as avg_return_amount, count(cr.cr_order_number) as total_returns, count(DISTINCT cr.cr_returning_customer_sk) as unique_customers_returning, sum(cr.cr_return_quantity) as total_returned_items, sum(cr.cr_net_loss) as total_net_loss FROM catalog_returns cr JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN customer c ON cr.cr_returning_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE hd.hd_buy_potential IN ('0-500', 'Unknown') AND cc.cc_mkt_id IN (6, 2, 5) AND cr.cr_returning_cdemo_sk IN (877247, 315703, 978233, 1405433, 1704734, 711632) AND i.i_brand_id IN (9010001, 7011009, 9008009, 7006004, 6013007, 6016005) AND i.i_category IN ('Sports', 'Books', 'Shoes') GROUP BY i.i_category, cc.cc_city, cc.cc_state ORDER BY total_return_amount DESC, avg_return_amount DESC;
SELECT s.s_store_name, s.s_company_name, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_return_quantity) AS average_return_quantity, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_incl_tax, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_net_loss) AS total_net_loss, cd.cd_education_status, AVG(cd.cd_purchase_estimate) AS average_purchase_estimate, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages_involved, td.t_shift, SUM(CASE WHEN td.t_am_pm = 'PM' THEN 1 ELSE 0 END) AS returns_in_pm, SUM(CASE WHEN td.t_am_pm = 'AM' THEN 1 ELSE 0 END) AS returns_in_am FROM store s JOIN web_returns wr ON s.s_store_sk = wr.wr_returning_addr_sk JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk JOIN time_dim td ON wr.wr_returned_time_sk = td.t_time_sk WHERE s.s_tax_precentage BETWEEN 0.06 AND 0.08 AND s.s_company_name <> 'Unknown' AND wp.wp_type = 'feedback' AND wp.wp_rec_start_date > '1999-09-04' AND td.t_minute IN (50, 18) GROUP BY s.s_store_name, s.s_company_name, cd.cd_education_status, td.t_shift ORDER BY total_returns DESC, total_return_amount DESC;
SELECT hd.hd_buy_potential, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_items_sold, AVG(ss.ss_sales_price) AS avg_item_sales_price, SUM(wr.wr_return_quantity) AS total_items_returned, AVG(wr.wr_return_amt) AS avg_return_amount, SUM(sr.sr_return_quantity) AS total_store_returned_items, AVG(sr.sr_return_amt) AS avg_store_return_amount, (SUM(ss.ss_net_profit) - SUM(wr.wr_net_loss) - SUM(sr.sr_net_loss)) AS net_profit_after_returns FROM store_sales ss JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk LEFT JOIN web_returns wr ON ss.ss_item_sk = wr.wr_item_sk AND ss.ss_customer_sk = wr.wr_refunded_customer_sk LEFT JOIN store_returns sr ON ss.ss_item_sk = sr.sr_item_sk AND ss.ss_customer_sk = sr.sr_customer_sk WHERE hd.hd_buy_potential = '>10000' AND ss.ss_store_sk IN (1, 2, 7) AND wr.wr_refunded_customer_sk IN (48471, 57503, 93352) AND wr.wr_refunded_hdemo_sk IN (1649, 5785) AND sr.sr_reason_sk = 5 AND sr.sr_return_amt = 10.56 GROUP BY hd.hd_buy_potential;
SELECT hd.hd_dep_count, COUNT(*) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_return_quantity) AS total_return_quantity, AVG(cr.cr_return_quantity) AS average_return_quantity, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk GROUP BY ROLLUP(hd.hd_dep_count) HAVING hd.hd_dep_count IN (2, 7, 9, 4, 8, 3) ORDER BY hd.hd_dep_count;
SELECT cp.cp_department, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_sales_price) AS avg_sales_price, AVG(cs.cs_net_profit) AS avg_profit FROM catalog_sales cs JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN web_site ws ON cp.cp_department = ws.web_class JOIN income_band ib ON cs.cs_bill_cdemo_sk = ib.ib_income_band_sk WHERE cp.cp_end_date_sk < 2450934 AND ws.web_tax_percentage IN (0.07, 0.08) AND ws.web_state = 'TN' AND ib.ib_upper_bound = 170000 GROUP BY cp.cp_department ORDER BY total_sales DESC;
SELECT w.w_warehouse_name, AVG(i.inv_quantity_on_hand) AS avg_quantity_on_hand, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_including_tax, AVG(ws.ws_quantity) AS avg_quantity_sold, COUNT(DISTINCT s.s_store_sk) AS number_of_stores, COUNT(DISTINCT wp.wp_web_page_sk) AS number_of_web_pages, SUM(ws.ws_ext_sales_price) AS total_sales, SUM(ws.ws_ext_ship_cost) AS total_shipping_cost, AVG(ws.ws_net_profit) AS avg_net_profit FROM warehouse w JOIN inventory i ON w.w_warehouse_sk = i.inv_warehouse_sk JOIN web_sales ws ON w.w_warehouse_sk = ws.ws_warehouse_sk JOIN store s ON w.w_state = s.s_state JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk WHERE i.inv_item_sk IN ('12967', '13462') AND ws.ws_net_paid_inc_ship_tax IN ('2903.39', '10322.19', '71.04') AND ws.ws_ship_cdemo_sk IN ('1497159', '165796', '556771', '542355') AND w.w_zip = '35709' AND w.w_street_type IN ('Avenue', 'Drive', 'Dr.') GROUP BY w.w_warehouse_name ORDER BY w.w_warehouse_name;
SELECT c.c_birth_country, COUNT(DISTINCT c.c_customer_sk) AS num_customers, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_net_paid_inc_tax) AS avg_net_paid_inc_tax, SUM(CASE WHEN ss.ss_net_paid_inc_tax > 1000 THEN ss.ss_quantity ELSE 0 END) AS quantity_sold_above_1000, COUNT(DISTINCT p.p_promo_sk) AS num_promotions, SUM(p.p_cost) AS total_promotion_cost, w.w_state, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft FROM customer c JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN warehouse w ON w.w_zip = c.c_current_addr_sk::character varying WHERE c.c_birth_country IN ('THAILAND', 'ITALY') AND ss.ss_net_paid_inc_tax::text IN ('307.45', '859.21', '1169.72', '3293.51', '222.26') GROUP BY c.c_birth_country, w.w_state ORDER BY total_quantity_sold DESC;
SELECT ca.ca_city, ca.ca_state, sm.sm_type AS shipping_type, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, SUM(cr.cr_return_amount) AS total_returned_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cs.cs_quantity) AS total_sold_quantity, SUM(cs.cs_sales_price) AS total_sales_amount, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(ss.ss_quantity) AS total_store_sold_quantity, SUM(ss.ss_sales_price) AS total_store_sales_amount, AVG(ss.ss_sales_price) AS avg_store_sales_price FROM catalog_returns cr JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN catalog_sales cs ON cr.cr_order_number = cs.cs_order_number AND cr.cr_item_sk = cs.cs_item_sk JOIN store_sales ss ON cs.cs_order_number = ss.ss_ticket_number AND cs.cs_item_sk = ss.ss_item_sk WHERE ca.ca_location_type IN ('single family', 'apartment', 'condo') AND ca.ca_address_sk IN (1045, 2742, 4441, 2983, 912) AND ss.ss_ticket_number IN (3727, 3689, 3508, 3484, 3325, 3364) AND ss.ss_addr_sk = 29811 AND cs.cs_ship_cdemo_sk = 172784 GROUP BY ca.ca_city, ca.ca_state, sm.sm_type ORDER BY total_returned_amount DESC, total_sales_amount DESC, total_store_sales_amount DESC;
SELECT cp.cp_department, AVG(cr.cr_return_amt_inc_tax) AS avg_return_amount, SUM(cr.cr_return_quantity) AS total_return_quantity, COUNT(cr.cr_item_sk) AS return_count, AVG(t.t_time) AS avg_time_spent_on_page FROM catalog_returns cr JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN customer c ON cr.cr_returning_customer_sk = c.c_customer_sk JOIN web_page wp ON c.c_customer_sk = wp.wp_customer_sk JOIN time_dim t ON cr.cr_returned_time_sk = t.t_time_sk WHERE c.c_preferred_cust_flag = 'Y' AND cp.cp_catalog_number IN (4, 47) AND cp.cp_catalog_page_id IN ('AAAAAAAALNKAAAAA', 'AAAAAAAAEHFAAAAA', 'AAAAAAAAMAIAAAAA', 'AAAAAAAAAAKAAAAA') AND wp.wp_web_page_sk IN (57, 25, 50, 44, 55) AND wp.wp_customer_sk IN (10897, 84146, 37285, 92078) AND t.t_time_id IN ('AAAAAAAAAKCBAAAA', 'AAAAAAAACKOAAAAA') GROUP BY cp.cp_department ORDER BY avg_return_amount DESC, total_return_quantity DESC, return_count DESC;
SELECT i.inv_date_sk, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_net_loss) AS total_net_loss, COUNT(DISTINCT p.p_promo_sk) AS total_promotions, SUM(p.p_cost) AS total_promotion_cost, AVG(i.inv_quantity_on_hand) AS average_inventory_quantity FROM inventory i LEFT JOIN catalog_returns cr ON i.inv_item_sk = cr.cr_item_sk LEFT JOIN promotion p ON i.inv_item_sk = p.p_item_sk WHERE i.inv_date_sk BETWEEN 2450705 AND 2450709 AND i.inv_item_sk IN (7891, 13309, 15649, 8698, 9958) AND ( p.p_channel_catalog = 'N' OR p.p_channel_catalog IS NULL ) AND ( cr.cr_returning_cdemo_sk IN (909578, 1587504, 1439824, 941784, 229946) OR cr.cr_returning_cdemo_sk IS NULL ) GROUP BY i.inv_date_sk ORDER BY i.inv_date_sk;
SELECT dd.d_year, id.i_category, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS avg_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(sr.sr_return_amt) AS total_return_amount, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns FROM catalog_sales AS cs JOIN item AS id ON cs.cs_item_sk = id.i_item_sk JOIN date_dim AS dd ON cs.cs_sold_date_sk = dd.d_date_sk LEFT JOIN store_returns AS sr ON cs.cs_item_sk = sr.sr_item_sk AND cs.cs_order_number = sr.sr_ticket_number WHERE dd.d_year = 2003 AND id.i_category IN ('Electronics', 'Clothing', 'Furniture') GROUP BY dd.d_year, id.i_category ORDER BY total_quantity_sold DESC, total_return_amount DESC;
SELECT s.s_store_name, s.s_store_id, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_net_sales, SUM(ss.ss_net_paid_inc_tax) AS total_net_sales_including_tax, SUM(cr.cr_return_quantity) AS total_returned_quantity, SUM(cr.cr_return_amount) AS total_return_amount, r.r_reason_desc AS return_reason, AVG(ss.ss_net_profit) AS average_net_profit_per_sale, COUNT(DISTINCT cr.cr_order_number) AS total_return_transactions, SUM(cr.cr_net_loss) AS total_net_loss_from_returns FROM store s LEFT JOIN store_sales ss ON s.s_store_sk = ss.ss_store_sk LEFT JOIN catalog_returns cr ON ss.ss_item_sk = cr.cr_item_sk AND ss.ss_ticket_number = cr.cr_order_number LEFT JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk WHERE s.s_gmt_offset = '-5.00' AND s.s_division_id = 1 AND ( r.r_reason_desc = 'its is a boy' OR r.r_reason_desc = 'reason 25' OR r.r_reason_desc = 'Found a better extended warranty in a store' OR r.r_reason_desc = 'reason 27' ) GROUP BY s.s_store_name, s.s_store_id, r.r_reason_desc ORDER BY s.s_store_name, s.s_store_id, r.r_reason_desc;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_net_paid_inc_tax) AS avg_sales_inc_tax, COUNT(*) AS number_of_sales, SUM(ws.ws_quantity) AS total_web_quantity_sold, AVG(ws.ws_net_profit) AS avg_web_net_profit FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN web_sales ws ON cs.cs_item_sk = ws.ws_item_sk AND cs.cs_order_number = ws.ws_order_number JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk AND ws.ws_promo_sk = p.p_promo_sk WHERE cs.cs_ship_customer_sk IN (17646, 63607, 15126, 61460) AND p.p_discount_active = '1' AND cc.cc_rec_start_date <= CURRENT_DATE AND (cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date > CURRENT_DATE) GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_sales DESC LIMIT 10;
SELECT i_category, sm_type, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_ext_discount_amt) AS total_discount_amount, AVG(hd_dep_count) AS avg_dependent_count, AVG(hd_vehicle_count) AS avg_vehicle_count FROM catalog_sales JOIN item ON cs_item_sk = i_item_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk JOIN household_demographics ON cs_bill_hdemo_sk = hd_demo_sk JOIN income_band ON hd_income_band_sk = ib_income_band_sk WHERE i_category_id IN ('10', '4', '5', '8') AND ib_upper_bound IN (190000, 120000, 160000, 20000) AND cs_net_paid IN (1406.09, 1460.25, 1011.02, 3996.59, 188.33) GROUP BY i_category, sm_type ORDER BY total_net_paid DESC;
SELECT sm.sm_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(cs.cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs.cs_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(cs.cs_net_profit) AS total_net_profit, SUM(inv.inv_quantity_on_hand) AS total_inventory_quantity, SUM(ss.ss_net_profit) AS total_store_sales_net_profit, SUM(wr.wr_net_loss) AS total_web_returns_net_loss FROM ship_mode sm LEFT JOIN catalog_sales cs ON sm.sm_ship_mode_sk = cs.cs_ship_mode_sk LEFT JOIN inventory inv ON cs.cs_item_sk = inv.inv_item_sk AND inv.inv_warehouse_sk IN (1, 2) LEFT JOIN store_sales ss ON cs.cs_item_sk = ss.ss_item_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk WHERE inv.inv_item_sk = 10208 AND (cs.cs_coupon_amt = 849.23 OR cs.cs_coupon_amt = 20.08) AND cs.cs_order_number IN (99696, 116682, 86052, 116470, 78481) AND wr.wr_net_loss IN (31.29, 420.25, 714.73, 424.40, 381.09) GROUP BY sm.sm_type ORDER BY total_net_profit DESC;
SELECT i.i_category AS item_category, sm.sm_type AS shipping_type, COUNT(DISTINCT cr.cr_order_number) AS catalog_returns_count, SUM(cr.cr_return_quantity) AS total_catalog_return_quantity, AVG(cr.cr_return_amt_inc_tax) AS average_catalog_return_amount, COUNT(DISTINCT sr.sr_ticket_number) AS store_returns_count, SUM(sr.sr_return_quantity) AS total_store_return_quantity, AVG(sr.sr_return_amt_inc_tax) AS average_store_return_amount FROM catalog_returns cr INNER JOIN item i ON cr.cr_item_sk = i.i_item_sk INNER JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk INNER JOIN time_dim t ON cr.cr_returned_date_sk = t.t_time_sk INNER JOIN income_band ib ON cr.cr_refunded_customer_sk = ib.ib_income_band_sk LEFT JOIN store_returns sr ON i.i_item_sk = sr.sr_item_sk AND cr.cr_returned_date_sk = sr.sr_returned_date_sk WHERE t.t_time_sk = 1000 AND ib.ib_lower_bound = 40001 GROUP BY i.i_category, sm.sm_type ORDER BY i.i_category, sm.sm_type;
SELECT cp.cp_department, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(ss.ss_ext_sales_price) AS total_sales, AVG(ss.ss_coupon_amt) AS avg_coupon_amount, AVG(ss.ss_sales_price) AS avg_sales_price FROM store_sales ss JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN catalog_page cp ON cp.cp_start_date_sk <= ss.ss_sold_date_sk AND cp.cp_end_date_sk >= ss.ss_sold_date_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE c.c_birth_year = 1981 AND ss.ss_coupon_amt > 0 AND t.t_shift = 'third' GROUP BY cp.cp_department ORDER BY total_sales DESC, avg_sales_price DESC;
SELECT cc.cc_name AS call_center_name, cc.cc_city AS city, cc.cc_state AS state, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_return_quantity) AS total_returned_items, COUNT(DISTINCT cr.cr_returned_date_sk) AS days_with_returns, SUM(cr.cr_return_amt_inc_tax - cr.cr_return_amount) AS total_tax_collected, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_customers_refunded, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_customers_returning, SUM(CASE WHEN cd.cd_marital_status = 'U' THEN 1 ELSE 0 END) AS unmarried_customers, SUM(CASE WHEN cd.cd_marital_status = 'D' THEN 1 ELSE 0 END) AS divorced_customers, SUM(CASE WHEN cd.cd_marital_status = 'W' THEN 1 ELSE 0 END) AS widowed_customers FROM call_center cc JOIN catalog_returns cr ON cc.cc_call_center_sk = cr.cr_call_center_sk JOIN customer_demographics cd ON cd.cd_demo_sk = cr.cr_refunded_cdemo_sk OR cd.cd_demo_sk = cr.cr_returning_cdemo_sk WHERE cc_rec_end_date IS NULL GROUP BY call_center_name, city, state ORDER BY total_return_amount DESC LIMIT 100;
SELECT s.s_state AS store_state, s.s_city AS store_city, SUM(s.s_floor_space) AS total_store_floor_space, SUM(s.s_number_employees) AS total_store_employees, AVG(s.s_tax_precentage) AS avg_store_tax_percentage, COUNT(DISTINCT w.w_warehouse_sk) AS total_warehouses, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(wp.wp_image_count) AS avg_webpage_image_count, AVG(wp.wp_link_count) AS avg_webpage_link_count FROM store s LEFT JOIN warehouse w ON s.s_city = w.w_city AND s.s_state = w.w_state LEFT JOIN web_page wp ON s.s_store_sk = wp.wp_customer_sk WHERE s.s_geography_class = 'Unknown' AND w.w_street_name IN ('View First', 'Wilson Elm', '6th', 'Ash Laurel') AND w.w_warehouse_id IN ('AAAAAAAACAAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAADAAAAAAA') AND wp.wp_url = 'http://www.foo.com' AND wp.wp_web_page_sk IN ('33', '24', '36', '14', '7', '49') GROUP BY s.s_state, s.s_city ORDER BY s.s_state, s.s_city;
SELECT sm.sm_type, sm.sm_carrier, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_net_paid) AS total_net_paid, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN web_page wp ON cs.cs_catalog_page_sk = wp.wp_web_page_sk WHERE wp.wp_char_count IN (701, 1931) AND sm.sm_type = 'OVERNIGHT' AND cs.cs_call_center_sk IN (1, 2, 4) GROUP BY sm.sm_type, sm.sm_carrier ORDER BY total_net_paid DESC;
SELECT cp.cp_department, sm.sm_type AS shipping_mode, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_items_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(sr.sr_return_quantity) AS total_items_returned, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_net_loss) AS total_net_loss, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages, AVG(wp.wp_link_count) AS average_link_count FROM catalog_sales cs LEFT JOIN store_returns sr ON cs.cs_item_sk = sr.sr_item_sk AND cs.cs_order_number = sr.sr_ticket_number LEFT JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk LEFT JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number LEFT JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk WHERE (wp.wp_access_date_sk = '2452566' OR wp.wp_access_date_sk = '2452583') AND (wp.wp_link_count = 15 OR wp.wp_link_count = 7 OR wp.wp_link_count = 19 OR wp.wp_link_count = 3) GROUP BY cp.cp_department, sm.sm_type ORDER BY total_net_paid DESC, total_net_loss;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, COUNT(*) AS number_of_promotions, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(p.p_cost) AS average_promotion_cost, SUM(CASE WHEN p.p_discount_active = 'Y' THEN 1 ELSE 0 END) AS active_discounts FROM call_center cc JOIN promotion p ON cc.cc_call_center_sk = p.p_item_sk JOIN inventory inv ON p.p_item_sk = inv.inv_item_sk WHERE cc.cc_rec_end_date = '2000-12-31' AND inv.inv_date_sk = 2450815 AND inv.inv_quantity_on_hand IN (104, 11, 180) AND cc.cc_employees IN (1, 2, 3) GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY cc.cc_name, cc.cc_city, cc.cc_state;
SELECT cd.cd_education_status, sm.sm_type, p.p_promo_name, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(DISTINCT CASE WHEN cd.cd_credit_rating = 'High Risk' THEN ss.ss_ticket_number END) AS high_risk_sales_transactions, COUNT(DISTINCT CASE WHEN cd.cd_credit_rating = 'Low Risk' THEN ss.ss_ticket_number END) AS low_risk_sales_transactions, COUNT(DISTINCT CASE WHEN cd.cd_credit_rating = 'Unknown' THEN ss.ss_ticket_number END) AS unknown_risk_sales_transactions FROM store_sales ss JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = ss.ss_addr_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE cd.cd_purchase_estimate IN ('2000', '1000', '4500') AND cd.cd_dep_employed_count = '0' AND sm.sm_ship_mode_sk IN ('13', '8', '20') AND sm.sm_type IN ('OVERNIGHT', 'NEXT DAY', 'EXPRESS') AND p.p_promo_name SIMILAR TO '%(eing|ation|able)%' AND p.p_promo_id IN ('AAAAAAAAJEAAAAAA', 'AAAAAAAALABAAAAA', 'AAAAAAAALNAAAAAA') AND p.p_channel_email = 'N' AND p.p_channel_event = 'N' AND ss.ss_ext_wholesale_cost IN ('3979.00', '2858.52', '5927.86') AND ss.ss_addr_sk IN ('19112', '41507', '33733') AND ss.ss_wholesale_cost IN ('17.80', '5.24', '22.67') AND ss.ss_sold_time_sk IN ('35178', '54001', '41756') GROUP BY cd.cd_education_status, sm.sm_type, p.p_promo_name ORDER BY total_net_profit DESC, total_sales_transactions DESC, average_sales_price DESC;
SELECT cd_gender, cd_marital_status, cd_education_status, sm_carrier, SUM(cs_net_paid_inc_tax) AS total_net_paid_inc_tax, AVG(cs_quantity) AS average_quantity, COUNT(*) AS num_transactions FROM catalog_sales JOIN customer_demographics ON catalog_sales.cs_bill_cdemo_sk = customer_demographics.cd_demo_sk JOIN ship_mode ON catalog_sales.cs_ship_mode_sk = ship_mode.sm_ship_mode_sk JOIN time_dim ON catalog_sales.cs_sold_time_sk = time_dim.t_time_sk WHERE cd_credit_rating = 'Good' AND sm_carrier IN ('UPS', 'FEDEX') AND t_hour BETWEEN 8 AND 17 GROUP BY cd_gender, cd_marital_status, cd_education_status, sm_carrier ORDER BY total_net_paid_inc_tax DESC, average_quantity DESC, num_transactions DESC;
SELECT c.ca_county, COUNT(distinct ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid_inc_tax) AS total_revenue_inc_tax, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN customer_address c ON ws.ws_bill_addr_sk = c.ca_address_sk JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk JOIN store s ON c.ca_state = s.s_state WHERE wp.wp_char_count IN ('5918', '3732', '4894', '2129', '1526') AND c.ca_county IN ('Calloway County', 'Mifflin County', 'Dutchess County', 'Rowan County') AND s.s_number_employees = 297 AND ws.ws_bill_customer_sk IN ('50106', '534', '23933', '77910', '39966') GROUP BY c.ca_county ORDER BY total_revenue_inc_tax DESC, total_net_profit DESC;
SELECT w_country, cr_returned_date_sk AS return_date_sk, i_category, COUNT(DISTINCT cr_order_number) AS total_returns, SUM(cr_return_quantity) AS total_returned_quantity, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN promotion p ON i.i_item_sk = p.p_item_sk AND p.p_discount_active = 'N' WHERE cr.cr_returning_hdemo_sk IN (7008, 2246, 3148, 584, 6843) GROUP BY w_country, return_date_sk, i_category ORDER BY total_net_loss DESC, total_returns DESC;
SELECT dd.d_year, dd.d_quarter_name, i.i_category, i.i_brand, COUNT(DISTINCT ws.web_site_sk) AS number_of_websites, COUNT(DISTINCT wp.wp_web_page_sk) AS number_of_web_pages, COUNT(DISTINCT wr.wr_order_number) AS number_of_returns, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_return_quantity) AS avg_return_quantity, AVG(wr.wr_fee) AS avg_return_fee, hd.hd_dep_count, ib.ib_lower_bound AS income_band_lower_bound, ib.ib_upper_bound AS income_band_upper_bound, SUM(hd.hd_vehicle_count) AS total_vehicles FROM web_returns wr JOIN date_dim dd ON wr.wr_returned_date_sk = dd.d_date_sk JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk JOIN item i ON wr.wr_item_sk = i.i_item_sk JOIN web_site ws ON wp.wp_web_page_sk = ws.web_site_sk JOIN household_demographics hd ON wr.wr_returning_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE dd.d_year = 2001 AND i.i_category_id IN (1, 2, 3) AND wr.wr_return_tax > 100 AND hd.hd_income_band_sk = 10 AND wr.wr_refunded_cash BETWEEN 300 AND 4000 GROUP BY dd.d_year, dd.d_quarter_name, i.i_category, i.i_brand, hd.hd_dep_count, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_return_amount DESC, avg_return_quantity DESC, avg_return_fee DESC, number_of_websites, number_of_web_pages;
SELECT ca_state, i_category, COUNT(DISTINCT sr_customer_sk) AS unique_customers, SUM(sr_return_quantity) AS total_returned_quantity, AVG(sr_return_amt) AS average_return_amount, SUM(sr_return_amt) AS total_return_amount, SUM(sr_fee) AS total_fees_collected, SUM(sr_net_loss) AS total_net_loss FROM store_returns JOIN item ON sr_item_sk = i_item_sk JOIN customer_address ON sr_addr_sk = ca_address_sk WHERE sr_returned_date_sk IS NOT NULL AND sr_store_sk IN (4, 8, 10, 7, 2) AND ca_street_type = 'Cir.' GROUP BY ca_state, i_category ORDER BY ca_state, i_category;
SELECT sm.sm_type AS shipping_type, w.w_city AS warehouse_city, r.r_reason_desc AS return_reason, COUNT(*) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_inc_tax, AVG(cr.cr_fee) AS average_fee, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk GROUP BY shipping_type, warehouse_city, return_reason ORDER BY total_returns DESC, total_returned_quantity DESC;
SELECT ib.ib_lower_bound, ib.ib_upper_bound, COUNT(wr.wr_item_sk) AS total_returns, AVG(wr.wr_net_loss) AS avg_net_loss, AVG(wr.wr_return_amt) AS avg_return_amount FROM web_returns wr JOIN customer c ON wr.wr_refunded_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE wr.wr_net_loss IS NOT NULL AND ib.ib_lower_bound IN (120001, 160001, 170001, 130001, 190001) AND hd.hd_income_band_sk = 14 AND wr.wr_refunded_customer_sk IN (2008, 38728, 70489, 86208, 44407) GROUP BY ib.ib_lower_bound, ib.ib_upper_bound ORDER BY avg_net_loss DESC;
SELECT s_state, s_city, p_channel_demo, p_promo_name, COUNT(DISTINCT sr_ticket_number) AS total_returns, SUM(sr_return_quantity) AS total_returned_quantity, AVG(sr_return_amt) AS average_return_amount, SUM(sr_net_loss) AS total_net_loss, COUNT(DISTINCT ss_ticket_number) AS total_sales, SUM(ss_quantity) AS total_sold_quantity, AVG(ss_sales_price) AS average_sales_price, SUM(ss_net_profit) AS total_net_profit FROM store_returns sr JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN store_sales ss ON sr.sr_item_sk = ss.ss_item_sk AND sr.sr_ticket_number = ss.ss_ticket_number JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk GROUP BY s_state, s_city, p_channel_demo, p_promo_name ORDER BY s_state, s_city, p_channel_demo, p_promo_name;
SELECT cu.c_salutation, wh.w_state, COUNT(DISTINCT cs.cs_order_number) AS total_sales_transactions, SUM(cs.cs_net_paid_inc_tax) AS total_sales_amount, AVG(cs.cs_ext_discount_amt) AS average_discount, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount FROM customer cu LEFT JOIN catalog_sales cs ON cu.c_customer_sk = cs.cs_ship_customer_sk LEFT JOIN store_returns sr ON cu.c_customer_sk = sr.sr_customer_sk LEFT JOIN warehouse wh ON (cs.cs_warehouse_sk = wh.w_warehouse_sk OR sr.sr_store_sk = wh.w_warehouse_sk) LEFT JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE (cs.cs_sold_date_sk IN ('2450819', '2450822', '2450817') OR sr.sr_returned_date_sk IN ('2450819', '2450822', '2450817')) AND (cu.c_salutation IN ('Dr.', 'Mr.', 'Sir', 'Ms.', 'Mrs.', 'Miss')) AND (wh.w_city = 'Fairview') AND (wh.w_suite_number IN ('Suite 80', 'Suite 0', 'Suite P', 'Suite 470')) AND (cu.c_last_review_date_sk IN ('2452425', '2452326', '2452389')) AND (sr.sr_reversed_charge IN ('44.04', '12.34') OR sr.sr_reversed_charge IS NULL) GROUP BY cu.c_salutation, wh.w_state ORDER BY total_sales_amount DESC, total_return_amount ASC;
SELECT ib.ib_lower_bound, ib.ib_upper_bound, COUNT(hd.hd_demo_sk) AS household_count, AVG(hd.hd_dep_count) AS average_dependency_count, AVG(hd.hd_vehicle_count) AS average_vehicle_count, SUM(CASE WHEN p.p_channel_email = 'N' THEN p.p_cost ELSE 0 END) AS total_cost_non_email_promotions, SUM(CASE WHEN p.p_channel_tv = 'Y' THEN 1 ELSE 0 END) AS number_of_tv_promotions, SUM(CASE WHEN p.p_discount_active = 'Y' THEN p.p_response_target ELSE 0 END) AS total_target_with_active_discount, COUNT(DISTINCT CASE WHEN r.r_reason_desc = 'reason 27' THEN hd.hd_demo_sk ELSE NULL END) AS count_households_reason_27 FROM household_demographics hd LEFT JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk LEFT JOIN promotion p ON hd.hd_demo_sk = p.p_item_sk LEFT JOIN reason r ON p.p_promo_sk = r.r_reason_sk WHERE hd.hd_income_band_sk IN (15, 9, 18, 20) AND p.p_purpose <> 'Unknown' AND ib.ib_lower_bound IN (110001, 100001, 130001) AND ib.ib_upper_bound <> 70000 GROUP BY ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ib.ib_lower_bound, ib.ib_upper_bound;
SELECT w.w_city AS warehouse_city, i.i_manufact AS item_manufacturer, i.i_brand AS item_brand, i.i_category AS item_category, COUNT(DISTINCT i.i_item_sk) AS item_count, AVG(i.i_current_price) AS avg_price, SUM(inv.inv_quantity_on_hand) AS total_quantity, AVG(ca.ca_gmt_offset) AS avg_gmt_offset, cd.cd_education_status AS customer_education_status, COUNT(DISTINCT ca.ca_address_sk) AS customer_address_count FROM inventory inv JOIN item i ON inv.inv_item_sk = i.i_item_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN customer_address ca ON w.w_state = ca.ca_state JOIN customer_demographics cd ON ca.ca_zip = cd.cd_purchase_estimate::character varying WHERE w.w_city = 'Fairview' AND i.i_manufact = 'ableeseeing' AND i.i_brand = 'edu packbrand #7' AND inv.inv_date_sk BETWEEN 100 AND 200 AND ca.ca_county LIKE 'Fairview%' GROUP BY w.w_city, i.i_manufact, i.i_brand, i.i_category, cd.cd_education_status ORDER BY w.w_city, i.i_manufact, i.i_brand, i.i_category, cd.cd_education_status;
SELECT i.i_item_id, i.i_item_desc, s.s_state, SUM(ss.ss_quantity) AS total_sales_quantity, AVG(ss.ss_quantity) AS average_sales_quantity, COUNT(DISTINCT ss.ss_ticket_number) AS sales_transactions_count, SUM(sr.sr_return_quantity) AS total_returns_quantity, AVG(sr.sr_return_quantity) AS average_returns_quantity, COUNT(DISTINCT sr.sr_ticket_number) AS returns_transactions_count, SUM(sr.sr_return_amt_inc_tax) AS total_returns_amount_inc_tax, AVG(sr.sr_return_ship_cost) AS average_return_ship_cost FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN store_returns sr ON ss.ss_item_sk = sr.sr_item_sk AND ss.ss_store_sk = sr.sr_store_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE s.s_market_desc IN ('Events develop i', 'Little expectations include yet forward meetings.') AND i.i_current_price > 10 AND t.t_shift = 'third' AND sr.sr_return_tax > 3.00 GROUP BY i.i_item_id, i.i_item_desc, s.s_state ORDER BY total_sales_quantity DESC, total_returns_quantity DESC LIMIT 100;
SELECT cp.cp_department, i.i_category, COUNT(DISTINCT cp.cp_catalog_page_sk) AS total_catalog_pages, COUNT(DISTINCT i.i_item_sk) AS total_items, AVG(i.i_current_price) AS avg_item_price, SUM(i.i_wholesale_cost) AS total_wholesale_cost, w.web_name, COUNT(DISTINCT w.web_site_sk) AS total_websites, AVG(w.web_tax_percentage) AS avg_tax_percentage FROM catalog_page cp JOIN item i ON cp.cp_catalog_page_sk = i.i_item_sk JOIN web_site w ON i.i_item_sk = w.web_site_sk WHERE cp.cp_start_date_sk IN ('2451055', '2450905', '2451210', '2451025', '2451605', '2450815') AND w.web_street_type IN ('Way', 'Cir.', 'Ln', 'Ct.', 'Wy') AND i.i_units IN ('N/A', 'Ton') AND cp.cp_catalog_page_sk IN ('3794', '992') GROUP BY cp.cp_department, i.i_category, w.web_name ORDER BY cp.cp_department, i.i_category, w.web_name;
SELECT cp_department, SUM(ws_quantity) AS total_quantity_sold, AVG(ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws_bill_customer_sk) AS unique_customers, COUNT(DISTINCT ws_web_page_sk) AS page_views, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_profit) AS total_net_profit FROM web_sales JOIN catalog_page ON web_sales.ws_web_page_sk = catalog_page.cp_catalog_page_sk WHERE catalog_page.cp_catalog_number IN (20, 25, 19) AND catalog_page.cp_department = 'DEPARTMENT' GROUP BY cp_department ORDER BY total_net_profit DESC;
SELECT w_state, w_city, ib.ib_income_band_sk AS income_band_sk, p_promo_name, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_sq_ft, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, COUNT(DISTINCT wr.wr_returned_date_sk) AS num_return_days, AVG(wr_return_amt_inc_tax) AS avg_return_amount_inc_tax FROM warehouse w JOIN web_returns wr ON w.w_warehouse_sk = wr.wr_returning_addr_sk JOIN income_band ib ON ib.ib_income_band_sk = wr.wr_returning_hdemo_sk JOIN promotion p ON p.p_item_sk = wr.wr_item_sk WHERE w_state = 'TN' AND w_city = 'Fairview' AND wr_reason_sk IN (7, 17, 21, 6) AND ib_upper_bound IN (50000, 190000, 80000) AND wr_returning_hdemo_sk IN (4812, 3393, 981, 1249) GROUP BY w_state, w_city, ib.ib_income_band_sk, p_promo_name ORDER BY total_return_amount_inc_tax DESC LIMIT 100;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, SUM(ss.ss_net_paid_inc_tax) AS total_sales_including_tax, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customer_count, COUNT(DISTINCT CASE WHEN c.c_preferred_cust_flag = 'Y' THEN ss.ss_customer_sk END) AS preferred_customer_count, SUM(sr.sr_return_amt_inc_tax) AS total_returns_including_tax, COUNT(DISTINCT sr.sr_customer_sk) AS total_return_customers FROM call_center cc LEFT JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk LEFT JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk WHERE cc.cc_rec_start_date > '1998-01-01' AND cc.cc_sq_ft = '1138' GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_sales_including_tax DESC;
SELECT d_year, d_quarter_name, ca_state, COUNT(DISTINCT ws_order_number) AS total_orders, SUM(ws_quantity) AS total_quantity, AVG(ws_sales_price) AS average_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_profit) AS total_net_profit, SUM(ws_ext_tax) AS total_tax_collected FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN customer_address ON ws_bill_addr_sk = ca_address_sk JOIN customer_demographics ON ws_bill_cdemo_sk = cd_demo_sk JOIN catalog_page ON ws_web_page_sk = cp_catalog_page_sk JOIN store ON ws_warehouse_sk = s_store_sk WHERE d_current_quarter = 'N' AND cd_dep_employed_count = 0 AND cp_department = 'DEPARTMENT' AND ws_order_number IN ('25231', '23240', '18952', '15512', '28993', '33703') GROUP BY d_year, d_quarter_name, ca_state ORDER BY d_year, d_quarter_name, ca_state;
SELECT s.s_store_id, s.s_store_name, s.s_city, s.s_state, s.s_country, s.s_tax_precentage, COUNT(DISTINCT inv.inv_item_sk) AS unique_items, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(inv.inv_quantity_on_hand) AS avg_inventory, MAX(i.i_current_price) AS max_item_price, MIN(i.i_current_price) AS min_item_price, AVG(i.i_current_price) AS avg_item_price, COUNT(DISTINCT ca.ca_address_sk) AS customer_address_count, SUM(CASE WHEN d.d_weekend = 'Y' THEN 1 ELSE 0 END) AS weekend_days, SUM(CASE WHEN d.d_holiday = 'Y' THEN 1 ELSE 0 END) AS holiday_days FROM store s JOIN inventory inv ON s.s_store_sk = inv.inv_warehouse_sk JOIN item i ON inv.inv_item_sk = i.i_item_sk JOIN date_dim d ON inv.inv_date_sk = d.d_date_sk JOIN customer_address ca ON s.s_zip = ca.ca_zip WHERE s.s_country = 'United States' AND d.d_month_seq IN (68, 76, 131) AND d.d_current_day = 'N' AND d.d_last_dom IN (2419461, 2416174, 2419399) AND d.d_week_seq IN (41, 224, 47) AND inv.inv_warehouse_sk IN (2, 1) AND inv.inv_item_sk IN (6787, 15910, 13876) AND i.i_item_id IN ('AAAAAAAAJEGAAAAA', 'AAAAAAAAOICBAAAA', 'AAAAAAAAKECBAAAA') AND i.i_rec_start_date IN ('2001-10-27', '1999-10-28', '1997-10-27') AND i.i_current_price IN (9.36, 0.92, 7.12) AND i.i_container = 'Unknown' AND ca.ca_street_number IN ('244', '496', '119') AND ca.ca_zip IN ('82293', '14244', '98877') GROUP BY s.s_store_id, s.s_store_name, s.s_city, s.s_state, s.s_country, s.s_tax_precentage ORDER BY s.s_store_name, total_inventory DESC;
SELECT i.i_category, i.i_class, i.i_brand, SUM(ws.ws_net_paid) AS total_sales, AVG(ws.ws_quantity) AS average_quantity_sold, SUM(sr.sr_return_amt) AS total_returns, AVG(sr.sr_return_quantity) AS average_quantity_returned, (SUM(ws.ws_net_paid) - SUM(sr.sr_return_amt)) AS net_sales FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN store_returns sr ON ws.ws_item_sk = sr.sr_item_sk LEFT JOIN ( SELECT wr_item_sk, wr_returned_date_sk, SUM(wr_return_amt) AS wr_total_return_amt, SUM(wr_return_ship_cost) AS wr_total_return_ship_cost FROM web_returns GROUP BY wr_item_sk, wr_returned_date_sk ) wr ON ws.ws_item_sk = wr.wr_item_sk WHERE ws.ws_warehouse_sk IN (5, 1, 2) AND ws.ws_wholesale_cost IN (16.07, 45.38, 66.57) AND ws.ws_order_number IN (42297, 10912, 13297) AND sr.sr_ticket_number IN (36370, 38622, 39874) AND sr.sr_return_quantity IN (41, 16, 8) AND i.i_manufact IN ('baresecally', 'ationableought', 'ableationeing') AND i.i_item_id IN ('AAAAAAAAJKDAAAAA', 'AAAAAAAAIACAAAAA', 'AAAAAAAAACIAAAAA') AND wr.wr_returned_date_sk IN (2451906, 2452157, 2451313) AND wr.wr_total_return_ship_cost IN (209.65, 2559.79, 887.24) AND wr.wr_total_return_amt IN (32.76, 437.16, 23.35) GROUP BY i.i_category, i.i_class, i.i_brand ORDER BY net_sales DESC, total_sales DESC, total_returns DESC, i.i_category, i.i_class, i.i_brand;
SELECT cd.cd_gender, cd.cd_marital_status, SUM(ss.ss_ext_sales_price) AS total_sales, AVG(ss.ss_coupon_amt) AS average_coupon_amt, COUNT(ss.ss_item_sk) AS total_items_sold, AVG(inv.inv_quantity_on_hand) AS average_inventory_on_hand FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN inventory inv ON ss.ss_item_sk = inv.inv_item_sk WHERE cd.cd_gender IN ('M', 'F') AND ss.ss_ext_sales_price IN (672.96, 2541.35, 528.00, 4835.54, 2912.12, 416.88) AND ss.ss_promo_sk IN (144, 107, 228, 186, 28, 37) AND inv.inv_warehouse_sk IN (1, 2) AND inv.inv_quantity_on_hand = 24 GROUP BY cd.cd_gender, cd.cd_marital_status ORDER BY cd.cd_gender, cd.cd_marital_status;
SELECT cc.cc_division_name, COUNT(DISTINCT cc.cc_call_center_sk) AS num_call_centers, AVG(cc.cc_employees) AS avg_employees, SUM(inv.inv_quantity_on_hand) AS total_inventory, SUM(wr.wr_return_amt_inc_tax) AS total_returns_inc_tax, AVG(wp.wp_link_count) AS avg_link_count_per_page FROM call_center cc JOIN inventory inv ON cc.cc_call_center_sk = inv.inv_warehouse_sk JOIN web_returns wr ON inv.inv_item_sk = wr.wr_item_sk JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk WHERE cc.cc_division IN (1, 3, 5) AND cc.cc_open_date_sk IN (2450952, 2450806, 2451063) AND wr.wr_web_page_sk IN (2, 32, 58, 26, 39) GROUP BY cc.cc_division_name ORDER BY total_returns_inc_tax DESC, avg_link_count_per_page DESC;
SELECT s.s_store_name, s.s_state, sm.sm_type AS ship_mode_type, dd.d_fy_quarter_seq AS fiscal_year_quarter, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_net_profit) AS average_net_profit_per_order, SUM(sr.sr_net_loss) AS total_net_loss_from_returns, AVG(sr.sr_fee) AS average_return_fee FROM store s INNER JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk INNER JOIN web_sales ws ON sr.sr_store_sk = ws.ws_ship_customer_sk INNER JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk INNER JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk WHERE s.s_state IN ('CA', 'TX', 'NY') AND ws.ws_promo_sk IN (283, 240) AND ws.ws_ext_sales_price IN (1516.11, 2342.50, 214.40) AND sr.sr_return_ship_cost IN (3.11, 720.07, 1424.48) AND dd.d_fy_quarter_seq IN (39, 22, 50) GROUP BY s.s_store_name, s.s_state, sm.sm_type, dd.d_fy_quarter_seq ORDER BY total_net_profit DESC;
SELECT w_state, cd_education_status, SUM(inv_quantity_on_hand) AS total_inventory, AVG(sr_return_amt) AS avg_return_amount, COUNT(DISTINCT p_promo_sk) AS num_promotions, SUM(CASE WHEN wp_max_ad_count = 0 THEN 1 ELSE 0 END) AS num_pages_no_ads, AVG(cd_purchase_estimate) AS avg_purchase_estimate, SUM(sr_return_quantity) AS total_returned_quantity FROM warehouse w JOIN inventory i ON w.w_warehouse_sk = i.inv_warehouse_sk JOIN store_returns sr ON i.inv_item_sk = sr.sr_item_sk JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN promotion p ON p.p_item_sk = i.inv_item_sk JOIN web_page wp ON wp.wp_customer_sk = sr.sr_customer_sk WHERE w.w_gmt_offset = -5.00 AND w.w_zip = '35709' AND cd.cd_education_status IN ('4 yr Degree', 'Secondary', '2 yr Degree') AND sr.sr_cdemo_sk = 1839405 AND (wp.wp_max_ad_count = 3 OR wp.wp_max_ad_count = 0) AND wp.wp_rec_end_date = '2001-09-02' GROUP BY w_state, cd_education_status ORDER BY w_state, cd_education_status;
SELECT cd.cd_gender, cd.cd_marital_status, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(cr.cr_return_amount) AS return_count, AVG(cs.cs_sales_price) AS avg_sales_price, COUNT(cs.cs_sales_price) AS sales_count FROM catalog_returns cr JOIN customer_demographics cd ON (cr.cr_returning_cdemo_sk = cd.cd_demo_sk OR cr.cr_refunded_cdemo_sk = cd.cd_demo_sk) JOIN catalog_sales cs ON (cr.cr_order_number = cs.cs_order_number) GROUP BY cd.cd_gender, cd.cd_marital_status ORDER BY total_return_amount DESC, avg_sales_price DESC, return_count DESC, sales_count DESC;
SELECT d.d_year, d.d_quarter_name, cc.cc_city, cc.cc_state, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt) AS avg_return_amount, COUNT(DISTINCT wr.wr_refunded_customer_sk) AS unique_customers, COUNT(DISTINCT wr.wr_order_number) AS total_orders_returned FROM web_returns wr JOIN date_dim d ON wr.wr_returned_date_sk = d.d_date_sk JOIN time_dim t ON wr.wr_returned_time_sk = t.t_time_sk JOIN call_center cc ON cc.cc_call_center_sk = wr.wr_returning_customer_sk WHERE d.d_year = 2023 AND t.t_sub_shift = 'night' AND cc.cc_city = 'Midway' AND wr.wr_returned_time_sk IN ('76162', '72121', '59518') GROUP BY d.d_year, d.d_quarter_name, cc.cc_city, cc.cc_state ORDER BY d.d_year, d.d_quarter_name, cc.cc_city, cc.cc_state;
SELECT s.s_store_name, s.s_city, s.s_state, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_quantity) AS average_quantity_sold, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_ext_sales_price) AS total_sales, sm.sm_carrier, sm.sm_type, COUNT(DISTINCT ws.ws_item_sk) AS total_items_sold, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT ws.ws_bill_customer_sk) AS total_customers, cp.cp_department, cp.cp_catalog_number, COUNT(DISTINCT cp.cp_catalog_page_sk) AS total_catalog_pages FROM store s JOIN web_sales ws ON s.s_store_sk = ws.ws_warehouse_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN income_band ib ON ws.ws_bill_cdemo_sk = ib.ib_income_band_sk JOIN catalog_page cp ON ws.ws_web_page_sk = cp.cp_catalog_page_sk JOIN web_site w ON ws.ws_web_site_sk = w.web_site_sk WHERE s.s_company_id = '1' AND s.s_county = 'Williamson County' AND ws.ws_ship_addr_sk IN ('9319', '42828', '27709') AND ws.ws_net_profit IN ('1416.80', '918.75', '-485.10') AND sm.sm_carrier IN ('ZOUROS', 'HARMSTORF', 'GERMA') AND sm.sm_ship_mode_sk IN ('11', '3', '9') AND sm.sm_code IN ('BIKE', 'SURFACE', 'AIR') AND w.web_rec_start_date IN ('1999-08-17', '2001-08-16', '2000-08-16') AND w.web_suite_number IN ('Suite 130', 'Suite 150', 'Suite R') AND w.web_tax_percentage IN ('0.01', '0.10', '0.12') AND w.web_company_name IN ('able', 'cally', 'pri') AND ib.ib_upper_bound IN ('110000', '190000', '130000') AND ib.ib_income_band_sk IN ('8', '15', '6') AND ib.ib_lower_bound IN ('20001', '100001', '10001') AND cp.cp_catalog_number IN ('10', '44', '19') AND cp.cp_department = 'DEPARTMENT' AND cp.cp_catalog_page_number IN ('49', '102', '25') AND cp.cp_catalog_page_sk IN ('3484', '375', '1590') GROUP BY s.s_store_name, s.s_city, s.s_state, sm.sm_carrier, sm.sm_type, ib.ib_lower_bound, ib.ib_upper_bound, cp.cp_department, cp.cp_catalog_number ORDER BY total_net_profit DESC, total_sales DESC, total_orders DESC;
SELECT ca_state, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_ticket_number) AS total_sales_transactions, SUM(ss_net_profit) AS total_net_profit FROM store_sales JOIN customer_address ON store_sales.ss_addr_sk = customer_address.ca_address_sk WHERE customer_address.ca_country = 'United States' AND store_sales.ss_sold_date_sk BETWEEN 20220101 AND 20221231 GROUP BY ca_state ORDER BY total_net_profit DESC;
SELECT i.i_category, sm.sm_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_profit) AS total_net_profit, AVG(cs.cs_net_profit) AS average_net_profit, SUM(inv.inv_quantity_on_hand) AS total_inventory_on_hand FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk WHERE sm.sm_type = 'EXPRESS' AND inv.inv_date_sk = 2450815 AND (inv.inv_quantity_on_hand IN (339, 505, 759, 226, 679) OR cs.cs_bill_hdemo_sk IN (523, 2390, 5794)) GROUP BY i.i_category, sm.sm_type ORDER BY total_net_profit DESC;
SELECT i_category, i_brand, COUNT(DISTINCT i_item_sk) AS total_items, SUM(i_current_price) AS total_sales_value, AVG(i_wholesale_cost) AS average_wholesale_cost FROM item WHERE i_units IN ('Dozen', 'Bundle', 'Lb') AND i_manufact IN ('eseantieing', 'ableablepri') GROUP BY i_category, i_brand ORDER BY total_sales_value DESC LIMIT 100;
SELECT ca.ca_city, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_profit) AS total_net_profit, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(CASE WHEN p.p_channel_tv = 'N' THEN cs.cs_net_paid_inc_tax ELSE 0 END) AS net_paid_no_tv_promo, AVG(cs.cs_ext_ship_cost) AS average_shipping_cost FROM catalog_sales cs JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk LEFT JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE ca.ca_city IN ('Murphy', 'Hubbard', 'Mount Olive') AND c.c_email_address IN ( 'Joe.Singer@R26XcAkIUF5.org', 'Johanna.Ross@EiP23U7Cb5aeav.org', 'Laurie.Johnson@0P2bV5aT.org', 'Jeanne.Clark@v1rrdNtTL7dd0hh.org' ) GROUP BY ca.ca_city ORDER BY total_net_paid DESC;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, hd.hd_buy_potential, hd.hd_dep_count, hd.hd_vehicle_count, r.r_reason_desc, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_return_amount) AS total_return_amount FROM catalog_returns cr JOIN customer_demographics cd ON cr.cr_returning_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN store s ON cr.cr_warehouse_sk = s.s_store_sk WHERE hd.hd_buy_potential IN ('5001-10000', '1001-5000', '>10000', '0-500', '501-1000') AND s.s_number_employees IN ('297', '294', '236', '245', '278') GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, hd.hd_buy_potential, hd.hd_dep_count, hd.hd_vehicle_count, r.r_reason_desc ORDER BY total_return_amount DESC, total_returned_quantity DESC, cd.cd_credit_rating, hd.hd_buy_potential;
SELECT r.r_reason_desc, ca.ca_state, d.d_moy AS month_of_year, COUNT(sr.sr_ticket_number) AS return_count, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_amt) AS avg_return_amount FROM store_returns sr JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk JOIN date_dim d ON sr.sr_returned_date_sk = d.d_date_sk JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk WHERE d.d_current_year = 'Y' GROUP BY r.r_reason_desc, ca.ca_state, month_of_year ORDER BY r.r_reason_desc, ca.ca_state, month_of_year;
SELECT i.i_category, COUNT(DISTINCT ws.ws_order_number) AS total_sales_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid) - SUM(cr.cr_return_amount) AS net_sales, AVG(ws.ws_sales_price) AS average_sale_amount, COUNT(DISTINCT cr.cr_order_number) AS total_return_orders, SUM(cr.cr_return_quantity) AS total_quantity_returned, AVG(cr.cr_return_amount) AS average_return_amount FROM item i LEFT JOIN web_sales ws ON i.i_item_sk = ws.ws_item_sk LEFT JOIN catalog_returns cr ON i.i_item_sk = cr.cr_item_sk WHERE (ws.ws_sold_date_sk BETWEEN 20010101 AND 20011231 OR cr.cr_returned_date_sk BETWEEN 20010101 AND 20011231) AND i.i_category IN ('Electronics', 'Clothing', 'Home Goods') GROUP BY i.i_category ORDER BY net_sales DESC;
SELECT i.i_category AS item_category, i.i_brand AS item_brand, r.r_reason_desc AS return_reason, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(*) AS return_count FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk GROUP BY i.i_category, i.i_brand, r.r_reason_desc ORDER BY total_return_amount DESC, avg_return_amount DESC, return_count DESC;
SELECT ws_order_number, COUNT(DISTINCT ws_item_sk) AS item_count, SUM(ws_quantity) AS total_quantity, AVG(ws_sales_price) AS avg_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ws_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(ws_net_profit) AS total_net_profit, MIN(ws_ext_ship_cost) AS min_shipping_cost, MAX(ws_ext_ship_cost) AS max_shipping_cost FROM web_sales JOIN catalog_sales ON ws_item_sk = cs_item_sk AND ws_order_number = cs_order_number JOIN store_sales ON ws_item_sk = ss_item_sk AND ws_order_number = ss_ticket_number JOIN web_page ON ws_web_page_sk = wp_web_page_sk JOIN inventory ON ws_item_sk = inv_item_sk WHERE ws_sales_price BETWEEN 100 AND 200 AND cs_sales_price BETWEEN 100 AND 200 AND ss_sales_price BETWEEN 100 AND 200 AND ws_ext_ship_cost BETWEEN 10 AND 1360 AND wp_type = 'Product Review' GROUP BY ws_order_number HAVING COUNT(DISTINCT ws_item_sk) > 1 ORDER BY total_net_profit DESC;
SELECT ca.ca_state, ca.ca_city, COUNT(DISTINCT c.c_customer_sk) AS num_customers, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_inc_tax, AVG(wr.wr_return_quantity) AS average_return_quantity, SUM(wr.wr_fee) AS total_fees, AVG(cd.cd_purchase_estimate) AS average_purchase_estimate FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN web_returns wr ON c.c_customer_sk = wr.wr_refunded_customer_sk WHERE ca.ca_state IN ('CA', 'WA', 'GA') AND cd.cd_education_status IN ('College', '4 yr Degree', 'Advanced Degree') AND wr.wr_net_loss > 500 GROUP BY ca.ca_state, ca.ca_city ORDER BY total_return_amount_inc_tax DESC, ca.ca_state, ca.ca_city;
SELECT dd.d_year, dd.d_quarter_name, SUM(ws.ws_sales_price) AS total_sales, AVG(ws.ws_quantity) AS average_quantity, COUNT(DISTINCT ws.ws_order_number) AS order_count, SUM(CASE WHEN ca.ca_location_type = 'condo' THEN ws.ws_net_paid_inc_tax ELSE 0 END) AS condo_sales_tax, SUM(CASE WHEN ca.ca_location_type = 'single family' THEN ws.ws_net_paid_inc_tax ELSE 0 END) AS single_family_sales_tax, SUM(CASE WHEN ib.ib_income_band_sk = 17 THEN ws.ws_net_paid ELSE 0 END) AS band_17_net_paid, COUNT(DISTINCT CASE WHEN ca.ca_county IN ('Telfair County', 'Cherokee County') THEN ws.ws_bill_addr_sk ELSE NULL END) AS unique_addresses_in_counties, COUNT(DISTINCT CASE WHEN p.p_discount_active = '1' THEN ws.ws_promo_sk ELSE NULL END) AS active_promo_count FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON ws.ws_bill_addr_sk = ca.ca_address_sk JOIN income_band ib ON ws.ws_bill_cdemo_sk = ib.ib_income_band_sk LEFT JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk WHERE dd.d_year = 2023 AND ib.ib_lower_bound >= 0 AND (ca.ca_location_type IN ('condo', 'single family') OR ca.ca_county IN ('Telfair County', 'Cherokee County')) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT hd.hd_income_band_sk, count(distinct c.c_customer_sk) AS num_customers, sum(cs.cs_quantity) AS total_sales_quantity, sum(cs.cs_net_paid) AS total_sales_amount, sum(sr.sr_return_quantity) AS total_returned_quantity, sum(sr.sr_return_amt) AS total_returned_amount, sum(cs.cs_net_profit) - sum(coalesce(sr.sr_net_loss, 0)) AS net_profit FROM customer c JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk LEFT JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk WHERE hd.hd_income_band_sk IN ('17', '12', '15', '6', '4', '19') AND (cs.cs_sold_date_sk IS NOT NULL OR sr.sr_returned_date_sk IS NOT NULL) GROUP BY hd.hd_income_band_sk ORDER BY net_profit DESC;
SELECT s_state, EXTRACT(YEAR FROM s_rec_start_date) AS year_opened, COUNT(*) AS store_count, SUM(ss_net_profit) AS total_net_profit, AVG(hd_dep_count) AS avg_dependency_count, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_amt) AS avg_return_amount, SUM(sr_net_loss) AS total_net_loss FROM store JOIN store_sales ON s_store_sk = ss_store_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN store_returns ON s_store_sk = sr_store_sk WHERE s_state IN ('CA', 'TX', 'FL') AND s_closed_date_sk IS NULL AND ss_sold_date_sk BETWEEN 2451189 AND 2451489 AND sr_return_tax > 0 AND hd_buy_potential IN ('>10000', '5001-10000', '1001-5000') GROUP BY s_state, year_opened ORDER BY total_net_profit DESC, total_return_amount DESC;
SELECT ib.ib_income_band_sk, avg(hd.hd_dep_count) AS average_dependents, avg(hd.hd_vehicle_count) AS average_vehicles, sum(cs.cs_quantity) AS total_quantity_sold, sum(cs.cs_net_paid) AS total_net_paid, sum(cs.cs_net_profit) AS total_net_profit, count(DISTINCT cs.cs_order_number) AS total_orders FROM household_demographics hd JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN catalog_sales cs ON hd.hd_demo_sk = cs.cs_bill_hdemo_sk WHERE hd.hd_dep_count IN (9, 7) AND cs.cs_catalog_page_sk IN (149, 116) AND cs.cs_ext_discount_amt IN (1062.45, 2397.98, 286.76) AND ib.ib_income_band_sk IN (8, 5, 2, 9, 13) GROUP BY ib.ib_income_band_sk ORDER BY total_net_profit DESC;
SELECT d_year, cd_gender, cd_marital_status, cd_education_status, sm_type, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_items_sold, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(cs_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN customer_demographics ON cs_bill_cdemo_sk = cd_demo_sk JOIN date_dim ON cs_sold_date_sk = d_date_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk WHERE d_year = 2003 AND cd_dep_count BETWEEN 1 AND 2 AND cd_purchase_estimate IN (3000, 6000, 8000, 7000) AND sm_ship_mode_id IN ('AAAAAAAABBAAAAAA', 'AAAAAAAAOAAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAAJAAAAAAA') AND sm_contract IN ('GNJr3g5i7oorKqtX', 'O9V6oF8RJnLMmZYd1', 'UaAJjKDnL4gTOqbpj') AND cs_net_paid_inc_tax IN ('3193.96', '1181.18', '1413.67') GROUP BY ROLLUP(d_year, cd_gender, cd_marital_status, cd_education_status, sm_type) ORDER BY d_year, cd_gender, cd_marital_status, cd_education_status, sm_type;
SELECT c.c_first_name, c.c_last_name, ca.ca_state, ca.ca_county, SUM(cs.cs_sales_price) AS total_sales, AVG(cs.cs_sales_price) AS avg_sales_price, COUNT(cs.cs_order_number) AS number_of_orders, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cr.cr_order_number) AS number_of_returns FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number AND cs.cs_item_sk = cr.cr_item_sk JOIN store s ON ca.ca_county = s.s_county AND ca.ca_state = s.s_state JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk WHERE c.c_birth_year IN ('1972', '1975', '1960') AND ca.ca_state = 'TN' AND s.s_county = 'Williamson County' AND cp.cp_description LIKE '%nuclear%' OR cp.cp_description LIKE '%optimistic%' AND cp.cp_end_date_sk IN ('2451239', '2450934', '2450904', '2451389') GROUP BY c.c_first_name, c.c_last_name, ca.ca_state, ca.ca_county ORDER BY total_sales DESC, total_returns DESC LIMIT 100;
SELECT ca.ca_country, ca.ca_state, cp.cp_type, AVG(inv.inv_quantity_on_hand) AS avg_quantity_on_hand, SUM(wr.wr_return_quantity) AS total_returned_quantity, SUM(wr.wr_return_amt) AS total_return_amount, SUM(wr.wr_fee) AS total_return_fees, COUNT(DISTINCT wr.wr_returning_customer_sk) AS distinct_returning_customers FROM web_returns wr JOIN customer_address ca ON wr.wr_returning_addr_sk = ca.ca_address_sk JOIN catalog_page cp ON wr.wr_web_page_sk = cp.cp_catalog_page_sk JOIN inventory inv ON wr.wr_item_sk = inv.inv_item_sk AND wr.wr_returned_date_sk = inv.inv_date_sk WHERE ca.ca_country = 'United States' AND cp.cp_type IN ('bi-annual', 'monthly') AND wr.wr_returning_customer_sk IN ('48847', '59684', '67712', '64182', '84117') GROUP BY ca.ca_country, ca.ca_state, cp.cp_type ORDER BY ca.ca_state, cp.cp_type;
SELECT i.i_category, i.i_brand, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_profit) AS total_net_profit, AVG(hd_dep_count) AS average_dependency_count, AVG(hd_vehicle_count) AS average_vehicle_count FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN household_demographics hd ON cs.cs_ship_hdemo_sk = hd.hd_demo_sk WHERE i.i_category = 'Men' AND (i.i_color = 'lawn' OR i.i_color = 'peach' OR i.i_color = 'red') AND cs.cs_catalog_page_sk IN (118, 44) AND hd.hd_demo_sk IN (714, 1213, 4049, 4231, 2781, 3780) GROUP BY i.i_category, i.i_brand ORDER BY total_net_profit DESC, total_orders DESC;
SELECT c.c_first_name, c.c_last_name, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_quantity) AS average_quantity, COUNT(DISTINCT ss.ss_ticket_number) AS total_transactions, i.i_category, s.s_store_name, sm.sm_type FROM store_sales ss JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = ss.ss_sold_date_sk WHERE c.c_customer_sk IN (179, 972, 3529, 2285, 1595) AND i.i_units = 'Tsp' AND s.s_division_name = 'Unknown' AND ss.ss_sold_date_sk BETWEEN 20000101 AND 20001231 GROUP BY c.c_first_name, c.c_last_name, i.i_category, s.s_store_name, sm.sm_type ORDER BY total_sales DESC, c.c_last_name ASC, c.c_first_name ASC;
SELECT cp.cp_department, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_incl_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_net_loss) AS total_net_loss, SUM(p.p_cost) AS total_promotion_cost, COUNT(DISTINCT p.p_promo_sk) AS total_promotions_applied FROM catalog_page cp JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk LEFT JOIN promotion p ON cp.cp_catalog_page_sk = p.p_item_sk WHERE cp.cp_catalog_page_number IN (63, 55, 67, 26) GROUP BY cp.cp_department ORDER BY total_net_loss DESC;
SELECT dd.d_year, dd.d_quarter_name, cc.cc_name, cc.cc_city, SUM(cr.cr_net_loss) AS total_catalog_net_loss, AVG(cr.cr_return_amount) AS avg_catalog_return_amount, COUNT(DISTINCT cr.cr_order_number) AS count_catalog_orders, SUM(wr.wr_net_loss) AS total_web_net_loss, AVG(wr.wr_return_amt) AS avg_web_return_amount, COUNT(DISTINCT wr.wr_order_number) AS count_web_orders, SUM(inv.inv_quantity_on_hand) AS total_inventory FROM date_dim dd JOIN catalog_returns cr ON dd.d_date_sk = cr.cr_returned_date_sk JOIN web_returns wr ON dd.d_date_sk = wr.wr_returned_date_sk JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk AND wr.wr_returned_date_sk = cc.cc_open_date_sk JOIN inventory inv ON inv.inv_date_sk = dd.d_date_sk WHERE dd.d_year = 1999 AND cc.cc_zip = '31904' AND inv.inv_warehouse_sk IN ('1', '2') GROUP BY dd.d_year, dd.d_quarter_name, cc.cc_name, cc.cc_city ORDER BY dd.d_year, dd.d_quarter_name, cc.cc_name, cc.cc_city;
SELECT t_shift AS shift_period, promotion_summary.channel, COUNT(*) AS promotion_count, SUM(promotion_summary.total_cost) AS total_promotion_cost, AVG(promotion_summary.p_response_target) AS average_response_target, SUM(web_returns_summary.return_quantity) AS total_return_quantity, SUM(web_returns_summary.return_amount) AS total_return_amount, SUM(web_returns_summary.return_amount_inc_tax) AS total_return_amount_inc_tax, AVG(web_returns_summary.fee) AS average_fee, SUM(web_returns_summary.net_loss) AS total_net_loss FROM (SELECT p_promo_sk, p_start_date_sk, p_end_date_sk, p_item_sk, CASE WHEN p_channel_dmail = 'Y' THEN 'Direct Mail' WHEN p_channel_email = 'Y' THEN 'Email' WHEN p_channel_catalog = 'Y' THEN 'Catalog' WHEN p_channel_tv = 'Y' THEN 'TV' WHEN p_channel_radio = 'Y' THEN 'Radio' WHEN p_channel_press = 'Y' THEN 'Press' WHEN p_channel_event = 'Y' THEN 'Event' WHEN p_channel_demo = 'Y' THEN 'Demo' ELSE 'Other' END AS channel, p_cost AS total_cost, p_response_target FROM promotion WHERE p_discount_active = 'Y' ) AS promotion_summary JOIN time_dim ON (promotion_summary.p_start_date_sk = time_dim.t_time_sk OR promotion_summary.p_end_date_sk = time_dim.t_time_sk) LEFT JOIN (SELECT wr_returned_date_sk, wr_returned_time_sk, wr_item_sk, SUM(wr_return_quantity) AS return_quantity, SUM(wr_return_amt) AS return_amount, SUM(wr_return_amt_inc_tax) AS return_amount_inc_tax, AVG(wr_fee) AS fee, SUM(wr_net_loss) AS net_loss FROM web_returns GROUP BY wr_returned_date_sk, wr_returned_time_sk, wr_item_sk ) AS web_returns_summary ON promotion_summary.p_item_sk = web_returns_summary.wr_item_sk GROUP BY shift_period, promotion_summary.channel ORDER BY total_promotion_cost DESC, shift_period;
SELECT dd.d_year AS fiscal_year, dd.d_quarter_name AS quarter, COUNT(DISTINCT ws.web_site_sk) AS number_of_websites, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(hd.hd_dep_count) AS avg_dependency_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, SUM(CASE WHEN hd.hd_buy_potential = '>10000' THEN 1 ELSE 0 END) AS high_buy_potential_count, AVG(ws.web_tax_percentage) AS avg_web_tax_percentage FROM date_dim dd JOIN web_site ws ON dd.d_date_sk = ws.web_open_date_sk OR dd.d_date_sk = ws.web_close_date_sk JOIN warehouse w ON ws.web_zip = w.w_zip JOIN household_demographics hd ON hd.hd_income_band_sk IS NOT NULL WHERE dd.d_fy_year IN (1913, 1900, 1909, 1901, 1902) AND dd.d_weekend = 'N' AND hd.hd_dep_count IN (3, 9, 4, 5, 2, 0) AND hd.hd_buy_potential IN ('5001-10000', '1001-5000', '>10000', 'Unknown', '0-500', '501-1000') AND w.w_warehouse_sq_ft IN (977787, 294242, 621234, 138504) AND ws.web_street_type IN ('ST', 'Drive', 'Wy') GROUP BY fiscal_year, quarter ORDER BY fiscal_year, quarter;
SELECT ca_state, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT sr_customer_sk) AS unique_customers_returning, SUM(CASE WHEN p_channel_press = 'N' AND p_channel_catalog = 'N' THEN sr_return_amt ELSE 0 END) AS total_return_amount_no_press_no_catalog, wm.warehouse_count, sm.sm_count, ib.ib_count FROM store_returns sr JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN (SELECT w_state, COUNT(*) AS warehouse_count FROM warehouse GROUP BY w_state) wm ON ca.ca_state = wm.w_state JOIN (SELECT sm_carrier, COUNT(*) AS sm_count FROM ship_mode WHERE sm_carrier IN ('ALLIANCE', 'ZOUROS', 'UPS') GROUP BY sm_carrier) sm ON 1=1 JOIN (SELECT ib_lower_bound, COUNT(*) AS ib_count FROM income_band GROUP BY ib_lower_bound) ib ON 1=1 LEFT JOIN promotion p ON sr.sr_reason_sk = p.p_promo_sk WHERE sr.sr_reason_sk IN (19, 26, 34, 7, 29) AND ca.ca_street_name IN ('Johnson Spruce', '12th View', 'Dogwood 12th', '15th Third', 'Ninth Fourth', '1st 7th') AND sr_return_amt > 0 GROUP BY ca_state, wm.warehouse_count, sm.sm_count, ib.ib_count ORDER BY total_return_amount DESC LIMIT 100;
SELECT p.p_promo_id, p.p_promo_name, COUNT(DISTINCT cs.cs_item_sk) AS number_of_items_sold, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_selling_price, SUM(cs.cs_ext_sales_price) AS total_sales_amount, SUM(cs.cs_ext_discount_amt) AS total_discount_amount, AVG((cs.cs_ext_discount_amt / cs.cs_ext_list_price) * 100) AS average_discount_percentage, SUM(cs.cs_net_profit) AS total_net_profit, AVG(inv.inv_quantity_on_hand) AS average_inventory_quantity_on_hand FROM catalog_sales cs JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk LEFT JOIN inventory inv ON cs.cs_item_sk = inv.inv_item_sk AND cs.cs_sold_date_sk = inv.inv_date_sk WHERE cs.cs_ext_list_price IN (8856.28, 4863.95, 651.00, 4727.68) GROUP BY p.p_promo_id, p.p_promo_name ORDER BY total_sales_amount DESC;
SELECT c.cc_call_center_id AS call_center, c.cc_name AS call_center_name, c.cc_manager AS call_center_manager, i.i_manufact_id AS manufacturer_id, COUNT(ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM call_center c JOIN web_sales ws ON c.cc_call_center_sk = ws.ws_warehouse_sk JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk WHERE i.i_manufact_id IN (275, 862, 397) AND c.cc_open_date_sk <= dd.d_date_sk AND (c.cc_rec_end_date IS NULL OR c.cc_rec_end_date >= dd.d_date) GROUP BY c.cc_call_center_id, c.cc_name, c.cc_manager, i.i_manufact_id ORDER BY total_net_profit DESC;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT ws.ws_order_number) AS web_order_count, SUM(ws.ws_net_paid) AS total_web_sales, AVG(ws.ws_quantity) AS average_web_quantity, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_quantity) AS average_return_quantity, COUNT(DISTINCT sr.sr_ticket_number) AS return_ticket_count FROM customer_demographics cd JOIN web_sales ws ON cd.cd_demo_sk = ws.ws_bill_cdemo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound LEFT JOIN store_returns sr ON ws.ws_bill_customer_sk = sr.sr_customer_sk AND ws.ws_item_sk = sr.sr_item_sk WHERE cd.cd_dep_count IN ('1', '2') AND ib.ib_income_band_sk IN ('1', '10', '19', '16', '6') AND ws.ws_bill_addr_sk IN ('46947', '12502', '40790', '6718') AND sr.sr_ticket_number IN ('40231', '36947', '37079', '39174', '39687') AND sr.sr_store_credit IN ('113.23', '47.72', '298.96', '136.00', '370.20', '203.23') GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_web_sales DESC, total_return_amount DESC;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_class, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, COUNT(DISTINCT cp.cp_catalog_page_sk) AS catalog_pages_used, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_including_tax, SUM(ss.ss_net_profit) AS total_net_profit, AVG(t.t_hour) AS average_hour_of_sale FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN catalog_page cp ON c.c_current_cdemo_sk = cp.cp_catalog_page_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE (cc.cc_rec_start_date IS NULL OR cc.cc_rec_start_date <= CURRENT_DATE) AND (cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date >= CURRENT_DATE) AND t.t_second IN ('16', '11') AND ss.ss_hdemo_sk IN ('1989', '6188') AND c.c_current_hdemo_sk IN ('3971', '3131', '4808', '7162', '6897', '2935') AND cc.cc_call_center_sk = 5 GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_class ORDER BY total_net_profit DESC, average_sales_price DESC;
SELECT sm.sm_type, sm.sm_carrier, COUNT(DISTINCT wr.wr_item_sk) AS total_items_returned, SUM(wr.wr_return_quantity) AS total_quantity_returned, AVG(wr.wr_return_amt) AS average_return_amount, AVG(wr.wr_fee) AS average_fee, SUM(wr.wr_net_loss) AS total_net_loss, ws.web_name, ws.web_manager, ws.web_mkt_class, COUNT(DISTINCT ws.web_site_sk) AS total_sites FROM web_returns wr JOIN ship_mode sm ON wr.wr_returned_date_sk = sm.sm_ship_mode_sk JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk WHERE ws.web_mkt_id IN (3, 4, 6, 2) AND ws.web_street_name = 'Hickory 3rd' AND wr.wr_returned_date_sk BETWEEN 100 AND 200 GROUP BY sm.sm_type, sm.sm_carrier, ws.web_name, ws.web_manager, ws.web_mkt_class ORDER BY total_net_loss DESC, total_quantity_returned DESC LIMIT 10;
SELECT d_year, sm_type, COUNT(DISTINCT inv_warehouse_sk) AS number_of_warehouses, SUM(inv_quantity_on_hand) AS total_quantity_on_hand, AVG(inv_quantity_on_hand) AS average_quantity_per_warehouse, MAX(inv_quantity_on_hand) AS max_quantity_in_warehouse, MIN(inv_quantity_on_hand) AS min_quantity_in_warehouse FROM inventory JOIN date_dim ON inv_date_sk = d_date_sk JOIN ship_mode ON sm_ship_mode_id = 'AAAAAAAAEAAAAAAA' WHERE d_year = 2023 AND d_day_name = 'Saturday' AND inv_warehouse_sk IN (1, 2) AND d_current_week = 'N' GROUP BY d_year, sm_type ORDER BY total_quantity_on_hand DESC, average_quantity_per_warehouse DESC LIMIT 100;
SELECT sm.sm_type AS shipping_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_items_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_revenue, SUM(cs.cs_net_profit) AS total_profit, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_items_returned, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_net_loss) AS total_loss FROM catalog_sales cs JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN web_returns wr ON cs.cs_order_number = wr.wr_order_number AND cs.cs_item_sk = wr.wr_item_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk WHERE sm.sm_type IN ('REGULAR', 'OVERNIGHT') AND cd.cd_gender IN ('M', 'F') AND cs.cs_quantity IN (91, 62, 46, 68, 45) AND (wr.wr_returned_time_sk = 74117 OR wr.wr_returned_time_sk IS NULL) GROUP BY sm.sm_type ORDER BY total_revenue DESC, total_loss ASC;
SELECT p.p_purpose, COUNT(DISTINCT p.p_promo_sk) AS num_promotions, AVG(p.p_cost) AS avg_promo_cost, SUM(CASE WHEN p.p_channel_dmail = 'Y' THEN 1 ELSE 0 END) AS dmail_channel_count, SUM(CASE WHEN p.p_channel_email = 'Y' THEN 1 ELSE 0 END) AS email_channel_count, COUNT(DISTINCT CASE WHEN cd.cd_purchase_estimate > 10000 THEN cd.cd_demo_sk END) AS high_value_customers, COUNT(DISTINCT CASE WHEN cd.cd_gender = 'M' THEN cd.cd_demo_sk END) AS male_customers, COUNT(DISTINCT CASE WHEN cd.cd_gender = 'F' THEN cd.cd_demo_sk END) AS female_customers, COUNT(DISTINCT CASE WHEN cd.cd_marital_status = 'S' THEN cd.cd_demo_sk END) AS single_customers, COUNT(DISTINCT CASE WHEN cd.cd_marital_status = 'M' THEN cd.cd_demo_sk END) AS married_customers FROM promotion p LEFT JOIN customer_demographics cd ON p.p_promo_sk = cd.cd_demo_sk WHERE p.p_discount_active = 'Y' GROUP BY p.p_purpose ORDER BY avg_promo_cost DESC, num_promotions DESC;
SELECT ca.ca_state, ib.ib_lower_bound, ib.ib_upper_bound, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(sr.sr_return_ship_cost) AS total_return_shipping_cost, COUNT(sr.sr_return_amt) AS num_of_returns FROM store_returns sr JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN income_band ib ON sr.sr_hdemo_sk = ib.ib_income_band_sk JOIN web_site ws ON sr.sr_store_sk = ws.web_site_sk WHERE ws.web_market_manager IN ('Gerald Craft', 'Donald Mckinney', 'Jeffrey Campbell', 'Eldon Snow', 'Keith Frazier', 'Gilbert Chapman') GROUP BY ca.ca_state, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ca.ca_state, ib.ib_lower_bound;
SELECT i.i_category, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(DISTINCT ss.ss_item_sk) AS item_count, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_sales_price) AS average_sale_price FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk AND p.p_channel_catalog = 'N' AND p.p_channel_email = 'N' WHERE ss.ss_customer_sk IS NOT NULL AND p.p_promo_sk IS NULL GROUP BY i.i_category, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY total_sales DESC, i.i_category, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status;
SELECT d_year, d_quarter_name, s_state, COUNT(distinct ss_ticket_number) as total_sales_transactions, SUM(ss_quantity) as total_quantity_sold, SUM(ss_ext_sales_price) as total_sales_value, AVG(ss_sales_price) as average_sales_price, SUM(ss_ext_discount_amt) as total_discount_amount, AVG(ss_ext_discount_amt/ss_quantity) as average_discount_per_unit, SUM(ss_net_paid) as total_net_paid, SUM(ss_net_profit) as total_net_profit FROM store_sales JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk JOIN store ON store_sales.ss_store_sk = store.s_store_sk GROUP BY d_year, d_quarter_name, s_state ORDER BY d_year, d_quarter_name, s_state;
SELECT cd.cd_education_status, ib.ib_lower_bound, ib.ib_upper_bound, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_ext_discount_amt) AS total_discount, COUNT(cs.cs_order_number) AS total_orders FROM customer_demographics cd JOIN catalog_sales cs ON cd.cd_demo_sk = cs.cs_bill_cdemo_sk JOIN income_band ib ON (cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound) GROUP BY cd.cd_education_status, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY cd.cd_education_status, ib.ib_lower_bound;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, SUM(cs.cs_net_paid) AS total_sales, SUM(cr.cr_return_amount) AS total_returns, (SUM(cs.cs_net_paid) - SUM(cr.cr_return_amount)) AS net_profit, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS number_of_orders, COUNT(DISTINCT cr.cr_order_number) AS number_of_returns FROM customer c LEFT JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name HAVING COUNT(DISTINCT cs.cs_order_number) > 0 AND COUNT(DISTINCT cr.cr_order_number) > 0 ORDER BY net_profit DESC, total_sales DESC LIMIT 100;
SELECT dd.d_year AS sales_year, dd.d_quarter_name AS sales_quarter, ca.ca_state AS customer_state, cd.cd_education_status AS education_status, cd.cd_gender AS gender, COUNT(DISTINCT c.c_customer_sk) AS num_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS num_preferred_customers FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN date_dim dd ON c.c_first_sales_date_sk = dd.d_date_sk WHERE dd.d_quarter_seq IN (SELECT MAX(d_quarter_seq) FROM date_dim WHERE d_current_quarter = 'Y') GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state, cd.cd_education_status, cd.cd_gender ORDER BY num_customers DESC, avg_purchase_estimate DESC;
SELECT cd.cd_credit_rating, wp.wp_type, AVG(ws.ws_sales_price) AS avg_sales_amount, SUM(ws.ws_ext_ship_cost) AS total_shipping_cost, AVG(ws.ws_quantity) AS avg_items_per_order, SUM(wr.wr_return_amt) AS total_return_amount, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_inc_tax FROM web_sales ws JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number WHERE cd.cd_credit_rating IN ('Unknown', 'Good', 'High Risk') AND wp.wp_url = 'http://www.foo.com' AND ws.ws_ship_customer_sk IN ('68344', '31854', '75904', '57654') AND ws.ws_ext_ship_cost = 1302.64 AND wp.wp_creation_date_sk IN ('2450810', '2450815', '2450813') AND wr.wr_refunded_customer_sk IN ('21890', '47305', '48588', '57226', '74434') AND wr.wr_order_number IN ('3277', '3156') GROUP BY cd.cd_credit_rating, wp.wp_type ORDER BY total_shipping_cost DESC, avg_sales_amount DESC;
SELECT i_category, i_brand, COUNT(DISTINCT i_item_sk) AS num_items, SUM(i_current_price) AS total_current_price, AVG(i_wholesale_cost) AS average_wholesale_cost, MAX(wp_link_count) AS max_link_count, MIN(wp_char_count) AS min_char_count, AVG(t_hour) AS average_hour_of_day FROM item JOIN web_page ON i_item_sk = wp_customer_sk JOIN time_dim ON wp_access_date_sk = t_time_sk WHERE i_container <> 'Unknown' AND i_brand_id IN ('9001011', '9016005', '6015001', '9005009', '9016001') AND wp_link_count IN ('17', '25', '6', '4', '18', '19') GROUP BY i_category, i_brand ORDER BY total_current_price DESC, average_wholesale_cost DESC LIMIT 100;
SELECT ib_lower_bound, ib_upper_bound, ca_state, ca_city, AVG(ss_quantity) AS avg_quantity_sold, SUM(ss_net_paid) AS total_net_paid, SUM(ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss_net_profit) AS total_net_profit, COUNT(DISTINCT ss_customer_sk) AS unique_customers_count FROM store_sales JOIN customer_address ON store_sales.ss_addr_sk = customer_address.ca_address_sk JOIN household_demographics ON store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk JOIN income_band ON household_demographics.hd_income_band_sk = income_band.ib_income_band_sk WHERE ca_zip IN ('65804', '18828', '28767', '57995') AND ss_sold_time_sk IN ('64456', '55232', '34662', '70640') AND ss_quantity IN (14, 26, 7, 79, 8, 63) GROUP BY ib_lower_bound, ib_upper_bound, ca_state, ca_city ORDER BY ca_state, ca_city, ib_lower_bound, ib_upper_bound;
SELECT dd.d_year, dd.d_month_seq, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, w.w_country AS warehouse_country, c.c_birth_country AS customer_birth_country FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk JOIN customer c ON ws.ws_ship_customer_sk = c.c_customer_sk WHERE dd.d_year = 2023 AND w.w_country IN ('United States', 'Canada') AND c.c_birth_country IN ('MALTA', 'GRENADA') GROUP BY dd.d_year, dd.d_month_seq, w.w_country, c.c_birth_country ORDER BY total_net_profit DESC, dd.d_month_seq, warehouse_country, customer_birth_country;
SELECT w.w_warehouse_name, w.w_warehouse_sq_ft, w.w_city, w.w_state, ib.ib_lower_bound, ib.ib_upper_bound, AVG(cs.cs_sales_price) AS avg_sales_price, AVG(cs.cs_ext_discount_amt) AS avg_discount_amount, SUM(cs.cs_quantity) AS total_quantity_sold, COUNT(DISTINCT cs.cs_order_number) AS total_orders, COUNT(DISTINCT p.p_promo_sk) AS total_promotions_applied FROM catalog_sales cs JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk JOIN income_band ib ON cs.cs_bill_customer_sk = ib.ib_income_band_sk WHERE d.d_year = 2021 AND w.w_county = 'Williamson County' AND p.p_discount_active = 'Y' AND p.p_response_target > 50 AND cs.cs_sales_price IS NOT NULL AND cs.cs_ext_discount_amt IS NOT NULL GROUP BY w.w_warehouse_name, w.w_warehouse_sq_ft, w.w_city, w.w_state, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY avg_sales_price DESC, avg_discount_amount DESC;
SELECT ca.ca_state, EXTRACT(YEAR FROM TO_DATE(c.c_first_shipto_date_sk::text, 'YYYYMMDD')) AS first_shipto_year, p.p_channel_details, COUNT(DISTINCT c.c_customer_sk) AS num_customers, AVG(ws.ws_net_profit) AS avg_web_net_profit, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, COUNT(DISTINCT ws.ws_order_number) AS num_web_orders, COUNT(DISTINCT sr.sr_ticket_number) AS num_returns FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk AND sr.sr_addr_sk = 23889 JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk WHERE c.c_birth_month IN (10, 6, 9, 7, 5) AND p.p_channel_catalog = 'N' AND ws.ws_list_price = 218.80 AND p.p_promo_id IN ('AAAAAAAAPLAAAAAA', 'AAAAAAAAOMAAAAAA', 'AAAAAAAACAAAAAAA') GROUP BY ca.ca_state, first_shipto_year, p.p_channel_details ORDER BY ca.ca_state, first_shipto_year, p.p_channel_details;
SELECT w.w_warehouse_name, i.ib_lower_bound, i.ib_upper_bound, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(wr.wr_return_quantity) AS total_return_quantity, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_fee) AS total_return_fees, COUNT(DISTINCT wr.wr_order_number) AS total_return_transactions FROM warehouse w JOIN store_sales ss ON ss.ss_addr_sk = w.w_warehouse_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN income_band i ON hd.hd_income_band_sk = i.ib_income_band_sk LEFT JOIN web_returns wr ON wr.wr_item_sk = ss.ss_item_sk AND wr.wr_refunded_customer_sk = ss.ss_customer_sk WHERE w.w_county = 'Williamson County' AND ss.ss_sold_time_sk = 35623 AND i.ib_income_band_sk IN (SELECT hd_income_band_sk FROM household_demographics WHERE hd_demo_sk IN (6765, 6298, 2035)) GROUP BY w.w_warehouse_name, i.ib_lower_bound, i.ib_upper_bound ORDER BY w.w_warehouse_name, i.ib_lower_bound;
SELECT cp_department, COUNT(DISTINCT cr_order_number) AS total_returns, SUM(cr_return_quantity) AS total_returned_quantity, AVG(cr_return_amount) AS average_return_amount, SUM(sr_return_amt) AS total_store_return_amount, SUM(ws_net_paid) AS total_web_sales_net_paid, SUM(ws_net_profit) AS total_web_sales_net_profit FROM catalog_page LEFT JOIN catalog_returns ON cp_catalog_page_sk = cr_catalog_page_sk LEFT JOIN store_returns ON cp_catalog_page_sk = sr_item_sk LEFT JOIN web_sales ON cp_catalog_page_sk = ws_item_sk WHERE cr_ship_mode_sk = '20' AND sr_item_sk = '2215' AND sr_fee IN ('40.75', '93.21', '51.60', '38.20', '4.86') GROUP BY cp_department ORDER BY total_returns DESC, total_returned_quantity DESC, average_return_amount DESC, total_store_return_amount DESC, total_web_sales_net_paid DESC, total_web_sales_net_profit DESC;
SELECT ca.ca_state AS customer_state, ib.ib_income_band_sk AS income_band, date_dim.d_year AS sale_year, SUM(ss.ss_sales_price) AS total_sales, AVG(ss.ss_sales_price) AS avg_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS sales_transactions, SUM(wr.wr_return_amt) AS total_returns, AVG(wr.wr_return_amt) AS avg_return_amt, COUNT(DISTINCT wr.wr_order_number) AS return_transactions, (SUM(ss.ss_sales_price) - SUM(wr.wr_return_amt)) AS net_sales FROM store_sales ss LEFT JOIN web_returns wr ON ss.ss_item_sk = wr.wr_item_sk AND ss.ss_customer_sk = wr.wr_refunded_customer_sk INNER JOIN date_dim ON ss.ss_sold_date_sk = date_dim.d_date_sk INNER JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk INNER JOIN income_band ib ON ss.ss_cdemo_sk = ib.ib_income_band_sk WHERE ca.ca_state IS NOT NULL AND date_dim.d_year >= 2000 GROUP BY ca.ca_state, ib.ib_income_band_sk, date_dim.d_year ORDER BY ca.ca_state, ib.ib_income_band_sk, date_dim.d_year;
SELECT cc.cc_name, ws.web_name, i.i_category, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS avg_sales_price, COUNT(DISTINCT cs.cs_bill_customer_sk) AS unique_customers, SUM(wr.wr_return_quantity) AS total_quantity_returned, SUM(wr.wr_net_loss) AS total_net_loss FROM catalog_sales cs JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk JOIN web_site ws ON cc.cc_mkt_id = ws.web_mkt_id JOIN item i ON cs.cs_item_sk = i.i_item_sk LEFT JOIN web_returns wr ON wr.wr_item_sk = i.i_item_sk AND wr.wr_order_number = cs.cs_order_number JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk WHERE cc.cc_class = 'small' AND ws.web_site_sk IN (25, 3) AND d.d_date BETWEEN '2022-01-01' AND '2022-12-31' AND (wr.wr_reason_sk IS NULL OR wr.wr_reason_sk IN (34, 25)) GROUP BY cc.cc_name, ws.web_name, i.i_category ORDER BY total_quantity_sold DESC, total_net_loss ASC;
SELECT s_state, cp_department, COUNT(DISTINCT s_store_sk) AS store_count, AVG(s_number_employees) AS avg_number_employees, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, AVG(wr_return_quantity) AS avg_return_quantity, SUM(wr_net_loss) AS total_net_loss FROM store JOIN catalog_page ON (s_store_sk = cp_catalog_page_sk) JOIN web_returns ON (s_store_sk = wr_returning_addr_sk) WHERE s_suite_number IN ('Suite T', 'Suite 140') AND cp_start_date_sk IS NOT NULL AND wr_returned_date_sk IS NOT NULL GROUP BY ROLLUP(s_state, cp_department) ORDER BY s_state, cp_department;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT cr.cr_returning_customer_sk) AS total_returning_customers_catalog, COUNT(DISTINCT wr.wr_returning_customer_sk) AS total_returning_customers_web, SUM(cr.cr_return_quantity) AS total_return_quantity_catalog, SUM(wr.wr_return_quantity) AS total_return_quantity_web, AVG(cr.cr_return_amount) AS avg_return_amount_catalog, AVG(wr.wr_return_amt) AS avg_return_amount_web, SUM(cr.cr_net_loss) AS total_net_loss_catalog, SUM(wr.wr_net_loss) AS total_net_loss_web FROM income_band ib LEFT JOIN household_demographics hd ON ib.ib_income_band_sk = hd.hd_income_band_sk LEFT JOIN catalog_returns cr ON hd.hd_demo_sk = cr.cr_returning_hdemo_sk LEFT JOIN web_returns wr ON hd.hd_demo_sk = wr.wr_returning_hdemo_sk LEFT JOIN promotion p ON p.p_start_date_sk = '2450215' AND p.p_channel_dmail = 'N' AND (cr.cr_item_sk = p.p_item_sk OR wr.wr_item_sk = p.p_item_sk) WHERE (cr.cr_returned_date_sk IS NOT NULL OR wr.wr_returned_date_sk IS NOT NULL) GROUP BY ib.ib_income_band_sk ORDER BY ib.ib_lower_bound;
SELECT c.c_customer_id, i.i_product_name, i.i_category, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs.cs_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(cs.cs_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_fee) AS total_return_fee, SUM(sr.sr_net_loss) AS total_net_loss, SUM(wr.wr_return_amt) AS total_web_return_amount, SUM(wr.wr_fee) AS total_web_return_fee, SUM(wr.wr_net_loss) AS total_web_net_loss FROM customer c JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk LEFT JOIN store_returns sr ON cs.cs_item_sk = sr.sr_item_sk AND cs.cs_order_number = sr.sr_ticket_number LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk WHERE c.c_preferred_cust_flag = 'Y' AND d.d_year = 2023 GROUP BY c.c_customer_id, i.i_product_name, i.i_category ORDER BY total_net_paid DESC LIMIT 100;
SELECT ca_state, EXTRACT(YEAR FROM d_date) AS sale_year, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, SUM(cs_ext_sales_price) AS total_sales, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_net_profit) AS total_profit FROM catalog_sales JOIN customer ON cs_bill_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN date_dim ON cs_sold_date_sk = d_date_sk WHERE ca_country = 'United States' AND ca_state IN ('LA', 'NC', 'KS', 'MI') AND cs_ext_sales_price > 100.00 AND cs_ext_sales_price < 15000.00 AND d_year = 2022 AND d_moy BETWEEN 1 AND 6 GROUP BY ca_state, sale_year ORDER BY total_sales DESC;
SELECT s_store_name AS store_name, s_state AS store_state, CONCAT(s_city, ', ', s_state) AS store_location, d_year AS sales_year, d_quarter_name AS sales_quarter, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_sales, AVG(ss_net_paid) AS average_sales_per_transaction, SUM(ss_net_paid_inc_tax) AS total_sales_including_tax, SUM(ss_ext_tax) AS total_tax_collected, COUNT(DISTINCT ss_customer_sk) AS unique_customers, COUNT(DISTINCT ss_ticket_number) AS total_transactions, SUM(wr_return_amt) AS total_returns, SUM(wr_fee) AS total_return_fees, AVG(wr_return_ship_cost) AS average_return_shipping_cost, COUNT(DISTINCT wr_refunded_customer_sk) AS unique_customers_returned, COUNT(DISTINCT wr_order_number) AS total_return_transactions, SUM(wr_net_loss) AS total_net_loss_from_returns, r_reason_desc AS most_common_return_reason FROM store_sales JOIN store ON ss_store_sk = s_store_sk JOIN date_dim ON ss_sold_date_sk = d_date_sk LEFT JOIN web_returns ON ss_item_sk = wr_item_sk AND ss_ticket_number = wr_order_number LEFT JOIN reason ON wr_reason_sk = r_reason_sk WHERE s_state IN ('NY', 'CA') AND d_year = 2023 GROUP BY s_store_name, s_state, s_city, d_year, d_quarter_name, r_reason_desc ORDER BY total_sales DESC, total_quantity_sold DESC LIMIT 10;
SELECT d_year, i_category, s_state, SUM(i_current_price) AS total_price, AVG(i_current_price) AS avg_price, COUNT(DISTINCT i_item_sk) AS unique_items_sold, COUNT(DISTINCT s_store_sk) AS number_of_stores, SUM(p_cost) AS total_promotion_cost, AVG(p_cost) AS avg_promotion_cost, COUNT(DISTINCT p_promo_sk) AS number_of_promotions, MAX(wp_max_ad_count) AS max_ad_count_webpage FROM date_dim, item, store, promotion, web_page, ship_mode WHERE i_rec_start_date <= d_date AND (i_rec_end_date IS NULL OR i_rec_end_date > d_date) AND s_rec_start_date <= d_date AND (s_rec_end_date IS NULL OR s_rec_end_date > d_date) AND wp_rec_start_date <= d_date AND (wp_rec_end_date IS NULL OR wp_rec_end_date > d_date) AND p_start_date_sk = d_date_sk AND (p_end_date_sk IS NULL OR p_end_date_sk >= d_date_sk) AND sm_type IN ('REGULAR', 'LIBRARY') AND i_class IN ('sports-apparel', 'decor', 'dvd/vcr players', 'shirts', 'bedding', 'fishing') AND p_channel_event = 'N' AND p_purpose <> 'Unknown' GROUP BY d_year, i_category, s_state ORDER BY d_year, i_category, s_state;
SELECT cp_type, sm_type, w_city, w_state, SUM(cs_sales_price) AS total_sales, COUNT(DISTINCT cs_order_number) AS number_of_sales_orders, SUM(cr_return_amount) AS total_returns, COUNT(DISTINCT cr_order_number) AS number_of_return_orders, (SUM(cs_sales_price) - SUM(cr_return_amount)) AS net_sales, AVG(cs_sales_price) AS average_sales_price, CASE WHEN SUM(cs_sales_price) > 0 THEN SUM(cr_return_amount) / SUM(cs_sales_price) ELSE 0 END AS return_rate FROM catalog_sales JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk LEFT JOIN catalog_returns ON cs_order_number = cr_order_number GROUP BY cp_type, sm_type, w_city, w_state ORDER BY cp_type, sm_type, w_city, w_state;
SELECT dd.d_year, dd.d_month_seq, dd.d_quarter_seq, cc.cc_class, SUM(sr.sr_return_amt) AS total_store_returns, AVG(sr.sr_return_quantity) AS avg_store_return_quantity, COUNT(DISTINCT sr.sr_ticket_number) AS count_store_return_tickets, SUM(wr.wr_return_amt) AS total_web_returns, AVG(wr.wr_return_quantity) AS avg_web_return_quantity, COUNT(DISTINCT wr.wr_order_number) AS count_web_return_orders FROM date_dim dd JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk JOIN web_returns wr ON dd.d_date_sk = wr.wr_returned_date_sk JOIN call_center cc ON cc.cc_open_date_sk = dd.d_date_sk WHERE dd.d_year = 2002 AND cc.cc_rec_start_date = '2002-01-01' AND (cc.cc_street_name = 'Center Hill' OR cc.cc_street_name = 'Ash Hill') AND (wr.wr_returned_time_sk IS NOT NULL AND sr.sr_return_time_sk IS NOT NULL) AND (wr.wr_returned_time_sk IN (SELECT t_time_sk FROM time_dim WHERE t_minute IN ('51', '4', '29', '2', '14', '12'))) AND EXISTS (SELECT 1 FROM warehouse w WHERE w.w_warehouse_sk = sr.sr_item_sk AND w.w_county = 'Williamson County' AND w.w_state = 'TN') GROUP BY dd.d_year, dd.d_month_seq, dd.d_quarter_seq, cc.cc_class ORDER BY dd.d_year, dd.d_month_seq, dd.d_quarter_seq, cc.cc_class;
SELECT d.d_year, SUM(ss_net_profit) AS total_profit, COUNT(DISTINCT ss_item_sk) AS items_sold, COUNT(DISTINCT ss_ticket_number) AS total_sales_transactions, AVG(ss_net_paid_inc_tax) AS avg_sales_with_tax, w.w_state, w.w_city, COUNT(DISTINCT sr_ticket_number) AS total_return_transactions, SUM(sr_return_amt_inc_tax) AS total_returns_with_tax, AVG(sr_fee) AS avg_return_fee FROM store_sales ss LEFT JOIN store_returns sr ON ss.ss_item_sk = sr.sr_item_sk AND ss.ss_ticket_number = sr.sr_ticket_number JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN warehouse w ON ss.ss_store_sk = w.w_warehouse_sk WHERE d.d_year = 2002 AND ss.ss_store_sk IN (10, 7, 4, 1) AND sr.sr_returned_date_sk IN ('2451033', '2451972') AND w.w_city = 'Midway' GROUP BY d.d_year, w.w_state, w.w_city ORDER BY total_profit DESC;
SELECT d_year, d_quarter_name, cc_name, SUM(cs_quantity) AS total_quantity_sold, SUM(cs_net_paid) AS total_net_paid, AVG(cs_net_profit) AS average_net_profit, COUNT(DISTINCT cs_order_number) AS number_of_orders, SUM(ws_quantity) AS total_web_quantity_sold, SUM(ws_net_paid) AS total_web_net_paid, AVG(ws_net_profit) AS average_web_net_profit, COUNT(DISTINCT ws_order_number) AS number_of_web_orders, SUM(cr_return_quantity) AS total_return_quantity, SUM(cr_return_amount) AS total_return_amount, AVG(cr_net_loss) AS average_net_loss, COUNT(DISTINCT cr_order_number) AS number_of_returns FROM date_dim JOIN catalog_sales ON cs_sold_date_sk = d_date_sk JOIN web_sales ON ws_sold_date_sk = d_date_sk JOIN catalog_returns ON cr_returned_date_sk = d_date_sk JOIN call_center ON cs_call_center_sk = cc_call_center_sk WHERE d_fy_year IN ('1910', '1903', '1905', '1900') AND (cs_net_paid_inc_ship_tax IN ('289.42', '1479.37') OR ws_net_paid_inc_ship_tax IN ('3079.90', '243.98', '3911.52')) GROUP BY d_year, d_quarter_name, cc_name ORDER BY d_year, d_quarter_name, cc_name;
SELECT ca.ca_country, hd.hd_buy_potential, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS sum_return_amount, SUM(cr.cr_return_ship_cost) AS sum_return_ship_cost, SUM(cr.cr_net_loss) AS sum_net_loss, w.w_warehouse_sq_ft FROM catalog_returns cr JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk WHERE ca.ca_country = 'United States' AND hd.hd_buy_potential IN ('>10000', '5001-10000', '1001-5000', '501-1000', '0-500', 'Unknown') AND w.w_zip = '35709' GROUP BY ca.ca_country, hd.hd_buy_potential, w.w_warehouse_sq_ft ORDER BY sum_return_amount DESC;
SELECT d_year, d_quarter_name, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs_order_number) AS total_orders, COUNT(DISTINCT c_customer_sk) AS total_customers, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN date_dim ON (cs_sold_date_sk = d_date_sk) JOIN customer ON (cs_bill_customer_sk = c_customer_sk) JOIN time_dim ON (cs_sold_time_sk = t_time_sk) JOIN inventory ON (cs_item_sk = inv_item_sk AND cs_sold_date_sk = inv_date_sk) JOIN income_band ON (c_current_cdemo_sk BETWEEN ib_lower_bound AND ib_upper_bound) WHERE d_current_quarter = 'N' AND d_current_week = 'N' AND t_minute IN ('54', '2', '7', '14', '21', '15') AND inv_warehouse_sk IN ('1', '2') AND inv_item_sk IN ('12016', '13675', '10315', '13106', '14791') AND ib_upper_bound IN ('30000', '20000', '170000', '180000', '70000', '60000') AND ib_lower_bound IN ('160001', '110001', '130001', '180001', '120001', '40001') GROUP BY d_year, d_quarter_name ORDER BY d_year, d_quarter_name;
SELECT cc_state, SUM(sr_return_amt) AS total_return_amt, AVG(sr_return_amt) AS avg_return_amt, COUNT(*) AS num_returns, SUM(ss_net_profit) AS total_net_profit, AVG(ss_net_profit) AS avg_net_profit, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(wr_return_ship_cost) AS total_return_ship_cost, AVG(wr_return_ship_cost) AS avg_return_ship_cost, COUNT(DISTINCT wr_refunded_customer_sk) AS unique_returned_customers FROM call_center JOIN store_returns ON sr_store_sk = cc_call_center_sk JOIN store_sales ON ss_store_sk = cc_call_center_sk AND store_returns.sr_ticket_number = store_sales.ss_ticket_number JOIN web_returns ON wr_returning_addr_sk = sr_addr_sk WHERE cc_rec_start_date <= CURRENT_DATE AND (cc_rec_end_date IS NULL OR cc_rec_end_date > CURRENT_DATE) AND sr_hdemo_sk IN ('1110', '6655', '2958', '2489', '5750', '5814') AND sr_return_quantity = 36 AND wr_return_ship_cost IN ('460.94', '104.34', '381.68', '830.90') AND wr_returned_time_sk IN ('77442', '66455', '78336', '60895', '70221') AND ss_coupon_amt IN ('1615.93', '743.42') AND ss_net_profit IN ('-1410.96', '-564.39', '-55.72') GROUP BY cc_state ORDER BY total_return_amt DESC;
SELECT c.c_preferred_cust_flag AS customer_pref_status, r.r_reason_desc AS return_reason, ws.web_manager AS website_manager, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN customer c ON cr.cr_refunded_customer_sk = c.c_customer_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN web_site ws ON cr.cr_call_center_sk = ws.web_site_sk WHERE c.c_current_addr_sk IN ('17516', '36852', '18429') AND ws.web_manager IN ('Jason Silva', 'Tommy Jones', 'Moses Hicks') AND r.r_reason_desc IN ('reason 23', 'Parts missing') GROUP BY customer_pref_status, return_reason, website_manager ORDER BY total_return_amount DESC, total_returns DESC;
SELECT r_reason_desc, w_state, COUNT(DISTINCT cr_order_number) AS total_catalog_returns, SUM(cr_return_quantity) AS total_returned_quantity, SUM(cr_return_amount) AS total_refund_amount, AVG(cr_return_amount) AS avg_refund_amount_per_return, SUM(cr_fee) AS total_fees, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns JOIN reason ON catalog_returns.cr_reason_sk = reason.r_reason_sk JOIN warehouse ON catalog_returns.cr_warehouse_sk = warehouse.w_warehouse_sk GROUP BY r_reason_desc, w_state ORDER BY total_refund_amount DESC, total_returned_quantity DESC;
SELECT ws.web_name, COUNT(DISTINCT wp.wp_web_page_sk) AS total_pages, AVG(wp.wp_char_count) AS average_char_count, AVG(wp.wp_link_count) AS average_link_count, AVG(wp.wp_image_count) AS average_image_count, SUM(wr.wr_return_quantity) AS total_return_quantity, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_return_amt_inc_tax) AS average_return_with_tax, SUM(wr.wr_net_loss) AS total_net_loss FROM web_site ws JOIN web_page wp ON ws.web_site_sk = wp.wp_customer_sk LEFT JOIN web_returns wr ON wp.wp_web_page_sk = wr.wr_web_page_sk WHERE ws.web_name IN ('site_3', 'site_4', 'site_1', 'site_0', 'site_2') AND ws.web_open_date_sk = 2450645 AND wp.wp_web_page_id IN ('AAAAAAAABAAAAAAA', 'AAAAAAAAGBAAAAAA') AND wr.wr_refunded_addr_sk IN (47075, 5271, 7334) GROUP BY ws.web_name ORDER BY total_return_amount DESC;
SELECT c.c_first_name, c.c_last_name, sm.sm_type AS shipping_type, COUNT(ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_profit) AS total_net_profit, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(wr.wr_return_quantity) AS total_web_returned_quantity, AVG(wr.wr_return_amt) AS average_web_return_amount, COUNT(DISTINCT p.p_promo_sk) AS number_of_promotions, SUM(ws.ws_quantity) AS total_web_quantity_sold, AVG(ws.ws_sales_price) AS average_web_sales_price, SUM(ws.ws_net_profit) AS total_web_net_profit FROM customer c LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk LEFT JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_refunded_customer_sk LEFT JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk OR ws.ws_promo_sk = p.p_promo_sk WHERE c.c_first_sales_date_sk IN (2450046, 2449304, 2451981, 2451206, 2449744) AND sm.sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') GROUP BY c.c_first_name, c.c_last_name, sm.sm_type ORDER BY total_net_profit DESC, total_web_net_profit DESC LIMIT 100;
SELECT ca_state, r_reason_desc, COUNT(*) AS return_count, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_quantity) AS average_quantity_returned, SUM(sr_return_amt_inc_tax) AS total_amount_including_tax, SUM(sr_fee) AS total_fees, SUM(sr_return_ship_cost) AS total_shipping_costs, SUM(sr_refunded_cash) AS total_cash_refunded, SUM(sr_reversed_charge) AS total_reversed_charges, SUM(sr_store_credit) AS total_store_credit_issued, SUM(sr_net_loss) AS total_net_loss FROM store_returns JOIN reason ON store_returns.sr_reason_sk = reason.r_reason_sk JOIN customer_address ON store_returns.sr_addr_sk = customer_address.ca_address_sk WHERE (sr_reason_sk IN (13, 15, 26, 31, 21, 27)) AND (sr_reversed_charge IN (269.66, 29.95, 131.41, 123.32, 10.07, 1.54)) AND (sr_item_sk IN (6759, 10097, 13141, 10841, 4022)) GROUP BY ca_state, r_reason_desc ORDER BY ca_state, total_return_amount DESC;
SELECT ws.ws_web_site_sk, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(ws.ws_order_number) AS total_orders, AVG(ws.ws_quantity) AS avg_quantity, SUM(ws.ws_net_paid_inc_tax) AS total_revenue, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_coupon_amt) AS total_coupon_amt, AVG(hd.hd_dep_count) AS avg_dependency_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, wp.wp_type, COUNT(DISTINCT hd.hd_demo_sk) AS unique_households FROM web_sales ws JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk JOIN household_demographics hd ON ws.ws_ship_hdemo_sk = hd.hd_demo_sk JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk JOIN web_site wsit ON ws.ws_web_site_sk = wsit.web_site_sk WHERE wsit.web_gmt_offset = '-5.00' AND wsit.web_site_sk IN (6, 17, 14) AND td.t_time IN (3552, 4450, 1742) AND ws.ws_sales_price BETWEEN 17.54 AND 205.36 AND ws.ws_item_sk IN (51, 14, 107, 50, 104, 108) GROUP BY ws.ws_web_site_sk, wp.wp_type ORDER BY total_revenue DESC;
SELECT d_year, d_quarter_name, cc_class, COUNT(DISTINCT ss_ticket_number) AS total_tickets, SUM(ss_quantity) AS total_quantity, SUM(ss_net_paid) AS total_net_paid, SUM(ss_net_paid_inc_tax) AS total_net_paid_inc_tax, AVG(ss_sales_price) AS average_sales_price, SUM(ss_net_profit) AS total_net_profit FROM store_sales JOIN date_dim ON (store_sales.ss_sold_date_sk = date_dim.d_date_sk) JOIN call_center ON (store_sales.ss_store_sk = call_center.cc_call_center_sk) WHERE store_sales.ss_customer_sk IN ('21757', '11218') GROUP BY d_year, d_quarter_name, cc_class ORDER BY d_year, d_quarter_name, cc_class;
SELECT s.s_store_id, s.s_store_name, d.d_year, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS preferred_customers, AVG(s.s_number_employees) AS average_employees, AVG(s.s_floor_space) AS average_floor_space, SUM(s.s_tax_precentage) AS total_tax_percentage FROM store s JOIN customer c ON s.s_store_sk = c.c_current_addr_sk JOIN date_dim d ON c.c_first_sales_date_sk = d.d_date_sk WHERE s.s_division_name <> 'Unknown' AND c.c_last_review_date_sk IN ('2452522', '2452308', '2452629', '2452335', '2452592', '2452622') AND c.c_first_name IN ('Tyler', 'Rhona', 'Mohammad') AND d.d_last_dom IN ('2417208', '2418853') AND d.d_following_holiday = 'Y' GROUP BY s.s_store_id, s.s_store_name, d.d_year ORDER BY total_customers DESC, preferred_customers DESC, average_employees DESC, average_floor_space DESC, total_tax_percentage DESC;
SELECT hd.hd_income_band_sk AS income_band, hd.hd_buy_potential AS buy_potential, COUNT(cs.cs_order_number) AS number_of_transactions, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_sales_price) AS average_sales_price FROM catalog_sales cs JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk GROUP BY hd.hd_income_band_sk, hd.hd_buy_potential ORDER BY hd.hd_income_band_sk, hd.hd_buy_potential;
SELECT w_state, EXTRACT(YEAR FROM wp_rec_end_date) AS year, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cr_refunded_customer_sk) AS unique_customers, COUNT(cr_order_number) AS total_returns, SUM(cr_return_quantity) AS total_returned_items FROM catalog_returns cr JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN web_page wp ON cr.cr_catalog_page_sk = wp.wp_web_page_sk WHERE wp.wp_rec_end_date BETWEEN '1999-01-01' AND CURRENT_DATE GROUP BY w_state, year ORDER BY w_state, year;
SELECT w_state, COUNT(DISTINCT ss_store_sk) AS number_of_stores, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_net_paid, AVG(ss_wholesale_cost) AS average_wholesale_cost, AVG(ss_ext_discount_amt) AS average_discount_amount, COUNT(CASE WHEN ss_coupon_amt > 50 THEN ss_ticket_number END) AS count_high_coupon_sales FROM store_sales JOIN warehouse ON ss_addr_sk = w_warehouse_sk WHERE w_state = 'TN' AND w_suite_number = 'Suite 470' AND ss_coupon_amt > 50 GROUP BY w_state ORDER BY total_net_paid DESC;
SELECT s.s_store_name, i.i_brand, i.i_category, AVG(ws_sales_price) AS avg_sales_price, SUM(ws_net_paid_inc_ship_tax) AS total_sales_with_tax, AVG(ws_ext_discount_amt) AS avg_discount_amount, COUNT(DISTINCT ws_item_sk) AS total_items_sold, COUNT(DISTINCT ws_order_number) AS total_orders FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN store s ON s.s_store_sk = ws.ws_warehouse_sk WHERE ws.ws_net_profit >= 100 AND i.i_rec_start_date <= CURRENT_DATE AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date > CURRENT_DATE) AND s.s_rec_start_date <= CURRENT_DATE AND (s.s_rec_end_date IS NULL OR s.s_rec_end_date > CURRENT_DATE) GROUP BY s.s_store_name, i.i_brand, i.i_category ORDER BY total_sales_with_tax DESC, avg_sales_price DESC, total_items_sold DESC LIMIT 100;
SELECT wsite.web_site_id, ca.ca_state, ca.ca_city, ca.ca_zip, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid) AS total_net_paid, AVG(ws.ws_net_profit) AS average_net_profit, SUM(ws.ws_ext_ship_cost) AS total_shipping_cost, SUM(ws.ws_coupon_amt) AS total_coupons_amount FROM web_sales ws JOIN web_site wsite ON ws.ws_web_site_sk = wsite.web_site_sk JOIN customer_address ca ON ws.ws_ship_addr_sk = ca.ca_address_sk WHERE ca.ca_zip IN ('19275', '50164') GROUP BY wsite.web_site_id, ca.ca_state, ca.ca_city, ca.ca_zip ORDER BY total_net_paid DESC;
SELECT ws.web_class, ws.web_name, SUM(cs.cs_net_profit) AS total_catalog_profit, AVG(cs.cs_net_profit) AS avg_catalog_profit, COUNT(cs.cs_order_number) AS total_catalog_orders, SUM(ss.ss_net_profit) AS total_store_profit, AVG(ss.ss_net_profit) AS avg_store_profit, COUNT(ss.ss_ticket_number) AS total_store_sales, SUM(wr.wr_net_loss) AS total_web_return_loss, COUNT(wr.wr_order_number) AS total_web_returns, AVG(hd.hd_dep_count) AS avg_household_dep_count, AVG(hd.hd_vehicle_count) AS avg_household_vehicles FROM web_site ws LEFT JOIN catalog_sales cs ON cs.cs_ship_date_sk = ws.web_site_sk LEFT JOIN store_sales ss ON ss.ss_sold_date_sk = ws.web_open_date_sk LEFT JOIN web_returns wr ON wr.wr_returned_date_sk = ws.web_close_date_sk LEFT JOIN household_demographics hd ON hd.hd_demo_sk = cs.cs_bill_hdemo_sk OR hd.hd_demo_sk = ss.ss_hdemo_sk WHERE ws.web_rec_start_date BETWEEN '1997-08-16' AND '2001-08-16' AND (wr.wr_item_sk IN ('1870', '5485') OR wr.wr_refunded_customer_sk IN ('84641', '95983', '47362', '18574', '28388', '7194')) GROUP BY ws.web_class, ws.web_name ORDER BY ws.web_class, total_catalog_profit DESC;
SELECT p.p_promo_name, sm.sm_type AS shipping_mode, COUNT(wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt_inc_tax) AS total_returned_amount, AVG(wr.wr_return_amt_inc_tax) AS average_return_amount FROM promotion p JOIN web_returns wr ON p.p_promo_sk = wr.wr_reason_sk JOIN inventory i ON wr.wr_item_sk = i.inv_item_sk JOIN warehouse w ON i.inv_warehouse_sk = w.w_warehouse_sk JOIN ship_mode sm ON sm.sm_ship_mode_id = w.w_zip JOIN income_band ib ON ib.ib_income_band_sk = w.w_warehouse_sk WHERE ib.ib_lower_bound >= 30000 AND ib.ib_upper_bound <= 90000 AND i.inv_item_sk IN (14186, 15508, 7795, 15079) AND sm.sm_type = 'EXPRESS' GROUP BY p.p_promo_name, sm.sm_type ORDER BY total_returned_amount DESC;
SELECT sm.sm_type AS shipping_type, COUNT(DISTINCT c.c_customer_sk) AS number_of_customers, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_return_quantity) AS average_return_quantity, SUM(wr.wr_fee) AS total_return_fees, AVG(wr.wr_net_loss) AS average_net_loss, COUNT(DISTINCT cp.cp_catalog_page_sk) AS total_catalog_pages, AVG(hd.hd_vehicle_count) AS average_vehicle_count, SUM(CASE WHEN d.d_weekend = 'Y' THEN 1 ELSE 0 END) AS weekend_dates_count, SUM(CASE WHEN d.d_holiday = 'Y' THEN 1 ELSE 0 END) AS holiday_dates_count FROM ship_mode sm JOIN web_returns wr ON sm.sm_ship_mode_sk = wr.wr_returned_time_sk JOIN customer c ON wr.wr_returning_customer_sk = c.c_customer_sk JOIN catalog_page cp ON cp.cp_start_date_sk = wr.wr_returned_date_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN date_dim d ON wr.wr_returned_date_sk = d.d_date_sk WHERE sm.sm_ship_mode_id IN ('AAAAAAAADBAAAAAA', 'AAAAAAAAMAAAAAAA', 'AAAAAAAAOAAAAAAA') AND sm.sm_type IN ('EXPRESS', 'NEXT DAY', 'OVERNIGHT') AND c.c_last_name IN ('Kyle', 'Reddy', 'Bishop') AND cp.cp_type IN ('quarterly', 'monthly', 'bi-annual') AND hd.hd_vehicle_count IN (3, 1, 0) AND hd.hd_buy_potential IN ('5001-10000', '>10000', 'Unknown') AND d.d_weekend IN ('N', 'Y') GROUP BY sm.sm_type;
SELECT ca_state, w_state, AVG(c_hd.hd_dep_count) AS avg_household_dep_count, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_profit) AS total_net_profit, SUM(ss_net_profit) AS total_store_net_profit FROM customer_address ca JOIN catalog_sales cs ON ca.ca_address_sk = cs.cs_bill_addr_sk JOIN household_demographics c_hd ON cs.cs_bill_hdemo_sk = c_hd.hd_demo_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN store_sales ss ON cs.cs_item_sk = ss.ss_item_sk AND cs.cs_order_number = ss.ss_ticket_number WHERE ca.ca_country = 'United States' AND w.w_country = 'United States' AND ss.ss_quantity > 5 AND cs.cs_quantity > 5 AND ca.ca_state IN ('CA', 'TX', 'NY') GROUP BY ca_state, w_state ORDER BY total_net_profit DESC, total_store_net_profit DESC, ca_state, w_state;
SELECT w.w_warehouse_name, w.w_state, w.w_county, sm.sm_type, sm.sm_carrier, p.p_promo_name, p.p_channel_details, s.s_store_name, s.s_city, s.s_state, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_net_paid, AVG(ss.ss_net_profit) AS average_net_profit, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(wr.wr_return_quantity) AS total_return_quantity, SUM(wr.wr_net_loss) AS total_net_loss FROM warehouse w JOIN store_sales ss ON ss.ss_store_sk = w.w_warehouse_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = ss.ss_sold_date_sk LEFT JOIN web_returns wr ON wr.wr_item_sk = ss.ss_item_sk AND wr.wr_order_number = ss.ss_ticket_number WHERE w.w_county = 'Williamson County' AND w.w_street_name IN ('Ash Laurel', 'Wilson Elm', '6th') AND w.w_warehouse_name IN ('Bad cards must make.', 'Important issues liv', 'Doors canno') AND w.w_state = 'TN' AND wr.wr_web_page_sk IN ('18', '44', '3') AND wr.wr_returned_date_sk IN ('2451082', '2451321', '2452281') AND p.p_channel_event = 'N' AND p.p_channel_press = 'N' AND p.p_item_sk IN ('10297', '13006', '12968') AND p.p_promo_name LIKE '%cally%' OR p.p_promo_name LIKE '%able%' OR p.p_promo_name LIKE '%eing%' AND s.s_rec_start_date IN ('1997-03-13', '2001-03-13', '2000-03-13') AND s.s_closed_date_sk IN ('2451044', '2450910', '2451189') AND sm.sm_type IN ('NEXT DAY', 'TWO DAY', 'LIBRARY') AND sm.sm_carrier IN ('AIRBORNE', 'USPS', 'DHL') AND sm.sm_ship_mode_id IN ('AAAAAAAABBAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAAOAAAAAAA') AND ss.ss_store_sk IN ('10', '1', '7') AND ss.ss_net_profit IN ('182.58', '990.60', '525.80') AND ss.ss_ext_sales_price IN ('6976.75', '971.85', '10.15') GROUP BY w.w_warehouse_name, w.w_state, w.w_county, sm.sm_type, sm.sm_carrier, p.p_promo_name, p.p_channel_details, s.s_store_name, s.s_city, s.s_state ORDER BY total_net_paid DESC, average_net_profit DESC, total_net_loss ASC;
SELECT sm.sm_type AS shipping_type, web.web_site_sk, web.web_name AS website_name, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_paid) AS total_revenue, AVG(ws.ws_quantity) AS average_quantity, AVG(ws.ws_ext_discount_amt) AS average_discount, SUM(ws.ws_coupon_amt) AS total_coupon_amount, SUM(ws.ws_net_profit) AS total_profit FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk WHERE web.web_name IN ('site_3', 'site_4', 'site_1', 'site_0', 'site_2') AND sm.sm_contract IN ('GNJr3g5i7oorKqtX', 'uukTktPYycct8', 'ldhM8IvpzHgdbBgDfI', '2mM8l') AND ws.ws_sold_date_sk BETWEEN 20230101 AND 20231231 GROUP BY sm.sm_type, web.web_site_sk, web.web_name ORDER BY total_revenue DESC;
SELECT i.i_category AS product_category, AVG(i.i_current_price) AS avg_item_price, COUNT(DISTINCT w.wr_order_number) AS total_orders, SUM(w.wr_return_quantity) AS total_items_returned, SUM(w.wr_return_amt) AS total_amount_returned, SUM(w.wr_net_loss) AS total_net_loss FROM item i JOIN web_returns w ON i.i_item_sk = w.wr_item_sk JOIN time_dim t ON t.t_time_sk = w.wr_returned_time_sk JOIN web_page wp ON w.wr_web_page_sk = wp.wp_web_page_sk JOIN customer c ON w.wr_refunded_customer_sk = c.c_customer_sk WHERE w.wr_return_quantity > 0 AND i.i_category IS NOT NULL AND c.c_last_review_date_sk = 2452428 AND (w.wr_refunded_cdemo_sk IN (1473865, 1053973, 323984, 999712) OR w.wr_return_quantity IN (92, 41)) GROUP BY i.i_category ORDER BY total_net_loss DESC, total_amount_returned DESC;
SELECT c.cc_name, c.cc_state, AVG(s.s_number_employees) as avg_store_employees, SUM(sr.sr_return_amt) as total_return_amount, SUM(sr.sr_return_quantity) as total_returned_quantity, COUNT(DISTINCT hd.hd_demo_sk) as unique_household_count, AVG(cd.cd_purchase_estimate) as avg_purchase_estimate FROM call_center c JOIN store s ON c.cc_state = s.s_state AND c.cc_mkt_id = s.s_market_id JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk WHERE c.cc_class = 'small' AND cd.cd_purchase_estimate > 5000 AND hd.hd_income_band_sk IS NOT NULL AND sr.sr_return_ship_cost > 100 AND sr.sr_returned_date_sk IS NOT NULL GROUP BY c.cc_name, c.cc_state ORDER BY total_return_amount DESC, avg_store_employees DESC, unique_household_count DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_net_profit, AVG(hd.hd_dep_count) AS average_dependency_count, AVG(hd.hd_vehicle_count) AS average_vehicle_count, SUM(ws.ws_net_paid_inc_ship) AS total_web_net_paid_inc_ship, AVG(ws.ws_net_paid_inc_ship) AS average_web_net_paid_inc_ship, SUM(ws.ws_quantity) AS total_web_quantity_sold, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, s.s_country, s.s_tax_precentage, MAX(t.t_time) AS max_time_of_purchase, MIN(t.t_time) AS min_time_of_purchase FROM income_band ib LEFT JOIN household_demographics hd ON ib.ib_income_band_sk = hd.hd_income_band_sk LEFT JOIN catalog_sales cs ON hd.hd_demo_sk = cs.cs_bill_hdemo_sk LEFT JOIN web_sales ws ON hd.hd_demo_sk = ws.ws_bill_hdemo_sk LEFT JOIN store s ON s.s_store_sk = cs.cs_warehouse_sk LEFT JOIN time_dim t ON t.t_time_sk = cs.cs_sold_time_sk WHERE s.s_country = 'United States' AND t.t_am_pm = 'AM' AND s.s_tax_precentage IN (0.08, 0.01) AND ws.ws_net_paid_inc_ship IN (1475.10, 4030.95, 1226.89, 21728.07) AND t.t_second = 36 GROUP BY ib.ib_income_band_sk, s.s_country, s.s_tax_precentage ORDER BY total_net_profit DESC, total_web_net_paid_inc_ship DESC;
SELECT cd.cd_education_status, ca.ca_state, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(ss.ss_ticket_number) AS total_sales_transactions FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE d.d_weekend = 'Y' AND d.d_year = 2022 GROUP BY cd.cd_education_status, ca.ca_state ORDER BY cd.cd_education_status, ca.ca_state;
SELECT d_year, ca_state, p_channel_email, p_channel_dmail, p_channel_tv, AVG(p_cost) AS avg_promo_cost, SUM(CASE WHEN p_channel_email = '1' THEN p_cost ELSE 0 END) AS total_email_promo_cost, SUM(CASE WHEN p_channel_dmail = '1' THEN p_cost ELSE 0 END) AS total_dmail_promo_cost, SUM(CASE WHEN p_channel_tv = '1' THEN p_cost ELSE 0 END) AS total_tv_promo_cost, COUNT(*) AS total_promotions, COUNT(DISTINCT p_promo_id) AS distinct_promotions FROM promotion p JOIN date_dim d ON p.p_start_date_sk = d.d_date_sk OR p.p_end_date_sk = d.d_date_sk JOIN customer_address ca ON ca.ca_state = 'CA' WHERE d.d_year = 2001 AND d.d_quarter_seq = 39 AND (d.d_dow = 1 OR d.d_dow = 0) AND p.p_discount_active = '1' GROUP BY d_year, ca_state, p_channel_email, p_channel_dmail, p_channel_tv ORDER BY d_year, ca_state, p_channel_email, p_channel_dmail, p_channel_tv;
SELECT ca.ca_state, cd.cd_gender, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount, AVG(s.s_tax_precentage) AS avg_tax_percentage, COUNT(wr.wr_returned_date_sk) AS total_returns FROM web_returns wr JOIN customer c ON wr.wr_returning_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN store s ON ca.ca_state = s.s_state JOIN date_dim dd ON wr.wr_returned_date_sk = dd.d_date_sk WHERE dd.d_quarter_seq = ( SELECT MAX(d_quarter_seq) - 1 FROM date_dim WHERE d_current_year = 'N' ) AND cd.cd_gender IN ('M', 'F') AND ca.ca_state IS NOT NULL GROUP BY ca.ca_state, cd.cd_gender ORDER BY ca.ca_state, cd.cd_gender;
SELECT i.i_category, i.i_brand, w.w_state, w.w_country, AVG(i.i_current_price) AS avg_price, SUM(i.i_wholesale_cost) AS total_wholesale_cost, COUNT(DISTINCT i.i_item_sk) AS item_count, SUM(inv.inv_quantity_on_hand) AS total_quantity_on_hand FROM item i JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk WHERE w.w_zip = '35709' AND w.w_gmt_offset = -5.00 AND inv.inv_quantity_on_hand > 258 GROUP BY i.i_category, i.i_brand, w.w_state, w.w_country ORDER BY i.i_category, i.i_brand;
SELECT i.i_category AS item_category, c.c_birth_month AS customer_birth_month, w.web_zip AS web_site_zip, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_paid) AS total_revenue, AVG(ws.ws_ext_discount_amt) AS average_discount, AVG(ws.ws_net_profit) AS average_profit FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN web_site w ON ws.ws_web_site_sk = w.web_site_sk WHERE ws.ws_sold_date_sk BETWEEN 2450815 AND 2450915 AND i.i_item_sk IN (10310, 10207, 12818, 10796) AND w.web_zip IN ('35709', '31904') AND c.c_birth_month IN (3, 5) GROUP BY item_category, customer_birth_month, web_site_zip ORDER BY item_category, customer_birth_month, web_site_zip;
SELECT wsite.web_name, SUM(ws.ws_net_paid_inc_tax) AS total_sales_amount, AVG(ws.ws_net_paid_inc_tax) AS average_sales_amount, SUM(ws.ws_ext_tax) AS total_tax_collected, COUNT(ws.ws_order_number) AS transaction_count FROM web_sales ws JOIN web_site wsite ON ws.ws_web_site_sk = wsite.web_site_sk WHERE wsite.web_manager = 'Peter Cassidy' AND ws.ws_warehouse_sk IN (1, 2) AND ws.ws_item_sk IN (10321, 7484, 9104, 10036, 6604, 10466) GROUP BY wsite.web_name ORDER BY total_sales_amount DESC;
SELECT d_year, ca_state, COUNT(DISTINCT c_customer_sk) AS num_customers, SUM(ss_quantity) AS total_quantity, AVG(ss_sales_price) AS avg_sales_price, SUM(ss_net_paid) AS total_net_paid, SUM(ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss_net_profit) AS total_net_profit FROM store_sales JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk JOIN customer ON store_sales.ss_customer_sk = customer.c_customer_sk JOIN customer_address ON customer.c_current_addr_sk = customer_address.ca_address_sk WHERE d_weekend = 'N' AND ss_list_price IN (79.50, 143.98, 117.62) AND ca_state IS NOT NULL GROUP BY d_year, ca_state ORDER BY d_year, ca_state;
SELECT cs.cs_call_center_sk, cc.cc_name AS call_center_name, cp.cp_catalog_page_id, cp.cp_department, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_paid) AS total_revenue, SUM(cs.cs_net_profit) AS total_profit, AVG(cs.cs_net_profit) AS avg_profit_per_sale, cd.cd_marital_status, COUNT(DISTINCT cs.cs_bill_customer_sk) AS unique_customers, SUM(inv.inv_quantity_on_hand) AS total_inventory_on_hand FROM catalog_sales cs LEFT JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk LEFT JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk LEFT JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk LEFT JOIN inventory inv ON cs.cs_item_sk = inv.inv_item_sk AND cs_sold_date_sk = inv.inv_date_sk WHERE cc.cc_country = 'United States' AND cs.cs_net_profit > 0 AND inv.inv_date_sk = 2450815 GROUP BY cs.cs_call_center_sk, call_center_name, cp.cp_catalog_page_id, cp.cp_department, cd.cd_marital_status ORDER BY total_revenue DESC, total_profit DESC LIMIT 100;
SELECT s.s_store_name, w.w_warehouse_name, COUNT(ss.ss_ticket_number) AS total_sales_transactions, AVG(ss.ss_net_paid) AS avg_transaction_amount, SUM(ss.ss_net_paid_inc_tax) AS total_revenue_inc_tax, SUM(wr.wr_return_amt_inc_tax) AS total_returns_inc_tax, (SUM(ss.ss_net_paid_inc_tax) - SUM(wr.wr_return_amt_inc_tax)) AS net_revenue_inc_tax, AVG(wr.wr_fee) AS avg_return_fee, SUM(wr.wr_net_loss) AS total_net_loss_from_returns FROM store s JOIN store_sales ss ON s.s_store_sk = ss.ss_store_sk LEFT JOIN web_returns wr ON ss.ss_ticket_number = wr.wr_order_number JOIN warehouse w ON s.s_state = w.w_state GROUP BY s.s_store_name, w.w_warehouse_name ORDER BY net_revenue_inc_tax DESC, s.s_store_name;
SELECT p.p_promo_name, cs.cs_sold_date_sk, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_net_paid) AS total_revenue, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cr.cr_return_quantity) AS total_quantity_returned, SUM(cr.cr_return_amount) AS total_amount_returned, COUNT(DISTINCT wr.wr_order_number) AS total_web_returns, SUM(wr.wr_return_amt) AS total_web_return_amount, AVG(COALESCE(cd.cd_dep_count, 0)) AS average_customer_dependents, AVG(COALESCE(cd.cd_dep_employed_count, 0)) AS average_employed_dependents, AVG(COALESCE(cd.cd_dep_college_count, 0)) AS average_college_dependents FROM promotion p LEFT JOIN catalog_sales cs ON p.p_promo_sk = cs.cs_promo_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number AND cs.cs_item_sk = cr.cr_item_sk LEFT JOIN web_returns wr ON cs.cs_order_number = wr.wr_order_number AND cs.cs_item_sk = wr.wr_item_sk LEFT JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk WHERE p.p_discount_active = 'Y' AND cs.cs_sold_date_sk IS NOT NULL GROUP BY p.p_promo_name, cs.cs_sold_date_sk ORDER BY p.p_promo_name, cs.cs_sold_date_sk;
SELECT i.i_category AS category, i.i_brand AS brand, SUM(cs.cs_sales_price) AS total_sales, AVG(cs.cs_sales_price) AS avg_sales_price, COUNT(cs.cs_order_number) AS total_orders, AVG(hd.hd_dep_count) AS avg_dependency_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk WHERE w.w_city = 'Fairview' AND w.w_zip = '35709' AND hd.hd_demo_sk IN ('3429', '3835', '1080', '381', '3354') AND cs.cs_sold_time_sk = '67862' GROUP BY i.i_category, i.i_brand ORDER BY total_sales DESC;
SELECT cp_department, i_category, AVG(i_current_price) AS average_price, SUM(i_wholesale_cost) AS total_wholesale_cost, COUNT(DISTINCT i_item_sk) AS item_count, COUNT(DISTINCT cp_catalog_page_sk) AS page_count, AVG(ib_upper_bound - ib_lower_bound) AS average_income_band_range FROM catalog_page JOIN item ON cp_catalog_page_id = i_item_id JOIN income_band ON i_size::integer = ib_income_band_sk WHERE cp_start_date_sk IS NOT NULL AND cp_end_date_sk IS NOT NULL AND i_rec_start_date <= CURRENT_DATE AND (i_rec_end_date IS NULL OR i_rec_end_date >= CURRENT_DATE) AND ib_lower_bound >= 20000 AND cp_department IN ('Electronics', 'Clothing', 'Home Goods') GROUP BY cp_department, i_category ORDER BY average_price DESC, total_wholesale_cost DESC;
SELECT sm.sm_type, sm.sm_carrier, COUNT(DISTINCT inv.inv_item_sk) AS distinct_items_shipped, SUM(inv.inv_quantity_on_hand) AS total_quantity_on_hand, AVG(inv.inv_quantity_on_hand) AS avg_quantity_per_item, s.s_store_name, s.s_company_name, s.s_city, s.s_state, COUNT(DISTINCT s.s_store_sk) AS number_of_stores, AVG(s.s_number_employees) AS avg_employees_per_store, SUM(s.s_floor_space) AS total_floor_space FROM ship_mode sm JOIN inventory inv ON sm.sm_ship_mode_sk = inv.inv_warehouse_sk JOIN store s ON inv.inv_warehouse_sk = s.s_store_sk WHERE inv.inv_item_sk = 11749 AND s.s_rec_end_date IS NULL GROUP BY sm.sm_type, sm.sm_carrier, s.s_store_name, s.s_company_name, s.s_city, s.s_state ORDER BY total_quantity_on_hand DESC, avg_employees_per_store DESC LIMIT 100;
SELECT s.s_state, AVG(cs.cs_net_paid) AS avg_sales, COUNT(sr.sr_ticket_number) AS total_returns, AVG(sr.sr_net_loss) AS avg_net_loss FROM catalog_sales cs JOIN store s ON cs.cs_bill_customer_sk = s.s_store_sk LEFT JOIN store_returns sr ON cs.cs_sold_date_sk = sr.sr_returned_date_sk AND cs.cs_item_sk = sr.sr_item_sk LEFT JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE r.r_reason_desc = 'Did not get it on time' GROUP BY s.s_state ORDER BY avg_sales DESC, total_returns DESC;
SELECT d.d_year AS year, d.d_quarter_name AS quarter, w.w_warehouse_name AS warehouse_name, ib.ib_income_band_sk AS income_band, SUM(inv.inv_quantity_on_hand) AS total_quantity_sold, AVG(inv.inv_quantity_on_hand) AS average_quantity_per_transaction, COUNT(DISTINCT inv.inv_item_sk) AS distinct_item_count, COUNT(*) AS transaction_count FROM inventory inv JOIN date_dim d ON inv.inv_date_sk = d.d_date_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN income_band ib ON ib.ib_income_band_sk BETWEEN 5 AND 15 WHERE d.d_dom = 25 AND w.w_warehouse_sq_ft IN (977787, 294242, 621234, 138504) AND inv.inv_quantity_on_hand IN (781, 841, 802, 251) AND ib.ib_lower_bound >= 90001 GROUP BY year, quarter, warehouse_name, income_band ORDER BY year, quarter, warehouse_name, income_band;
SELECT ws_web.web_site_sk, ws_web.web_name, ws_web.web_state, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_net_paid_inc_tax) AS average_net_paid_inc_tax, COUNT(DISTINCT ws_c.c_customer_sk) AS unique_customers, COUNT(DISTINCT ws_p.p_promo_sk) AS promotion_count, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_ext_sales_price) AS total_sales, SUM(ws.ws_ext_wholesale_cost) AS total_wholesale_cost, SUM(ws.ws_ext_discount_amt) AS total_discount_amount FROM web_sales ws INNER JOIN web_site ws_web ON ws.ws_web_site_sk = ws_web.web_site_sk LEFT JOIN customer ws_c ON ws.ws_bill_customer_sk = ws_c.c_customer_sk LEFT JOIN promotion ws_p ON ws.ws_promo_sk = ws_p.p_promo_sk WHERE ws_web.web_state = 'TN' AND ws_p.p_cost > 1000.00 GROUP BY ws_web.web_site_sk, ws_web.web_name, ws_web.web_state ORDER BY total_net_profit DESC;
SELECT dd.d_year, cd.cd_education_status, count(distinct c.c_customer_sk) as num_customers, sum(wr.wr_return_amt) as total_return_amount, avg(wr.wr_fee) as average_fee, count(distinct wr.wr_order_number) as total_returned_orders, sum(ib.ib_upper_bound) as total_income_upper_bound FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate = ib.ib_income_band_sk JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk JOIN date_dim dd ON wr.wr_returned_date_sk = dd.d_date_sk JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk WHERE dd.d_year = 2023 AND ws.web_company_id IN ('2', '4', '6', '5', '1') AND ib.ib_upper_bound IN (80000, 110000, 130000, 160000) GROUP BY dd.d_year, cd.cd_education_status ORDER BY total_return_amount DESC, average_fee DESC;
SELECT c.c_first_name, c.c_last_name, w.w_state, dd.d_quarter_name, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amt_inc_tax) AS total_refund_amount, AVG(cr.cr_return_amt_inc_tax) AS avg_refund_amount, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN date_dim dd ON cr.cr_returned_date_sk = dd.d_date_sk JOIN customer c ON cr.cr_refunded_customer_sk = c.c_customer_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk WHERE dd.d_quarter_name IN ('1904Q4', '1908Q2', '1910Q1', '1903Q2', '1905Q1', '1912Q2') AND cr.cr_call_center_sk IN (1, 2, 4) AND cr.cr_refunded_customer_sk IN (1743, 46684, 78996, 36586, 29127, 56750) GROUP BY c.c_first_name, c.c_last_name, w.w_state, dd.d_quarter_name ORDER BY w.w_state, dd.d_quarter_name, c.c_last_name, c.c_first_name;
SELECT s.s_state, s.s_city, ca.ca_zip, COUNT(DISTINCT p.p_promo_sk) AS num_promotions, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(s.s_number_employees) AS avg_num_employees, AVG(s.s_floor_space) AS avg_floor_space, SUM(CASE WHEN s.s_tax_precentage > 0 THEN 1 ELSE 0 END) AS stores_with_tax FROM store s LEFT JOIN inventory inv ON s.s_store_sk = inv.inv_warehouse_sk LEFT JOIN customer_address ca ON s.s_zip = ca.ca_zip LEFT JOIN promotion p ON p.p_start_date_sk <= inv.inv_date_sk AND p.p_end_date_sk >= inv.inv_date_sk WHERE s.s_state = 'TN' AND (s.s_city = 'Fairview' OR s.s_city = 'Midway') AND ca.ca_street_name IN ('Oak 4th', '13th Mill', 'Railroad 1st') AND inv.inv_item_sk IN ('15379', '8284', '9997', '14116') GROUP BY s.s_state, s.s_city, ca.ca_zip ORDER BY s.s_state, s.s_city, ca.ca_zip;
SELECT c.c_customer_id, COUNT(ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_units_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, sm.sm_type AS shipping_mode, EXTRACT(YEAR FROM d_date) AS sales_year FROM web_sales ws JOIN date_dim d_date ON ws.ws_sold_date_sk = d_date.d_date_sk JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk WHERE d_date.d_year = 2020 GROUP BY c.c_customer_id, sm.sm_type, sales_year ORDER BY total_net_paid DESC, total_net_profit DESC;
SELECT dd.d_year AS year, h.hd_income_band_sk AS income_band, r.r_reason_desc AS return_reason, SUM(ss.ss_net_paid) AS total_sales, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, AVG(ss.ss_quantity) AS average_quantity_sold, SUM(cr.cr_return_amount) AS total_returns, COUNT(DISTINCT cr.cr_order_number) AS total_return_transactions, AVG(cr.cr_return_quantity) AS average_quantity_returned FROM date_dim dd LEFT JOIN store_sales ss ON dd.d_date_sk = ss.ss_sold_date_sk LEFT JOIN catalog_returns cr ON dd.d_date_sk = cr.cr_returned_date_sk LEFT JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk LEFT JOIN household_demographics h ON ss.ss_hdemo_sk = h.hd_demo_sk WHERE dd.d_year IS NOT NULL AND (r.r_reason_id IN ('AAAAAAAANAAAAAAA', 'AAAAAAAALBAAAAAA', 'AAAAAAAALAAAAAAA', 'AAAAAAAADAAAAAAA', 'AAAAAAAAJBAAAAAA') OR r.r_reason_id IS NULL) GROUP BY year, income_band, return_reason ORDER BY year, income_band, total_sales DESC;
SELECT i_category, i_class, ca_state, cd_gender, cd_education_status, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS avg_return_amount, COUNT(*) AS return_count, SUM(ss_net_profit) AS total_store_sales_profit, AVG(ss_net_profit) AS avg_store_sales_profit, COUNT(DISTINCT ss_ticket_number) AS store_sales_count, SUM(ws_net_profit) AS total_web_sales_profit, AVG(ws_net_profit) AS avg_web_sales_profit, COUNT(DISTINCT ws_order_number) AS web_sales_count FROM catalog_returns JOIN item ON cr_item_sk = i_item_sk JOIN customer_address ON cr_returning_addr_sk = ca_address_sk JOIN customer_demographics ON cr_returning_cdemo_sk = cd_demo_sk LEFT JOIN store_sales ON cr_item_sk = ss_item_sk AND cr_returned_date_sk = ss_sold_date_sk LEFT JOIN web_sales ON cr_item_sk = ws_item_sk AND cr_returned_date_sk = ws_sold_date_sk GROUP BY i_category, i_class, ca_state, cd_gender, cd_education_status ORDER BY total_return_amount DESC, total_store_sales_profit DESC, total_web_sales_profit DESC LIMIT 100;
SELECT d_year, w_state, p_promo_name, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_profit) AS total_profit FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk JOIN promotion ON cs_promo_sk = p_promo_sk WHERE d_year = 2001 AND w_state IN ('WA', 'CA', 'TX') AND p_promo_id IN ('AAAAAAAAKDAAAAAA', 'AAAAAAAAKJAAAAAA', 'AAAAAAAACKAAAAAA') GROUP BY d_year, w_state, p_promo_name ORDER BY total_profit DESC, average_sales_price DESC LIMIT 10;
SELECT st.s_store_name, wh.w_warehouse_name, pm.p_promo_name, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_customers_returned, SUM(cr.cr_fee) AS total_fees_collected, SUM(cr.cr_return_amt_inc_tax) AS total_return_with_tax, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN store st ON cr.cr_returning_addr_sk = st.s_store_sk JOIN warehouse wh ON cr.cr_warehouse_sk = wh.w_warehouse_sk JOIN promotion pm ON cr.cr_item_sk = pm.p_item_sk WHERE cr.cr_returned_date_sk IS NOT NULL AND st.s_hours IN ('8AM-12AM', '8AM-4PM') AND wh.w_county = 'Williamson County' AND wh.w_gmt_offset = '-5.00' AND pm.p_channel_tv = 'N' AND cr.cr_fee IN ('50.79', '65.23', '83.26', '68.14') AND cr.cr_returning_hdemo_sk IN ('6329', '1804', '2496') GROUP BY st.s_store_name, wh.w_warehouse_name, pm.p_promo_name ORDER BY total_returned_quantity DESC, average_return_amount DESC, unique_customers_returned DESC;
SELECT i_category, r_reason_desc, EXTRACT(YEAR FROM d_date) AS return_year, EXTRACT(MONTH FROM d_date) AS return_month, COUNT(DISTINCT cr_order_number) AS total_returns, SUM(cr_return_quantity) AS total_returned_quantity, AVG(cr_return_amount) AS average_return_amount, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN date_dim dd ON cr.cr_returned_date_sk = dd.d_date_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk WHERE dd.d_current_week = 'N' AND r.r_reason_desc IN ('reason 26', 'Did not get it on time', 'Did not like the make', 'reason 23', 'reason 24') GROUP BY i_category, r_reason_desc, return_year, return_month ORDER BY i_category, return_year, return_month, r_reason_desc;
SELECT web.web_name AS website_name, cp.cp_department AS catalog_department, hd.hd_vehicle_count AS vehicle_count, r.r_reason_desc AS return_reason, COUNT(cr.cr_item_sk) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amt_inc_tax) AS avg_return_amount_incl_tax, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_incl_tax, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_net_loss) AS total_net_loss FROM web_site web JOIN catalog_returns cr ON web.web_site_sk = cr.cr_returning_addr_sk JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk WHERE web.web_company_id IN ('4', '1', '3') AND cp.cp_end_date_sk IN ('2451144', '2451389') AND hd.hd_vehicle_count IN ('3', '1', '4', '0') GROUP BY web_name, cp_department, vehicle_count, return_reason ORDER BY total_returns DESC, total_return_amount DESC;
SELECT d_year, d_quarter_name, sum(cs_net_profit) AS total_net_profit, avg(cs_sales_price) AS avg_sales_price, count(DISTINCT cs_order_number) AS order_count FROM catalog_sales JOIN date_dim ON (cs_sold_date_sk = d_date_sk) JOIN customer ON (cs_bill_customer_sk = c_customer_sk) JOIN web_site ON (web_open_date_sk = d_date_sk) JOIN income_band ON (c_current_hdemo_sk = ib_income_band_sk) WHERE d_year = 2002 AND ib_upper_bound <= 60000 AND ib_lower_bound >= 80001 AND c_birth_month IN (6, 9) AND cs_wholesale_cost BETWEEN 65.53 AND 87.24 AND web_rec_start_date BETWEEN '1999-08-17' AND '2000-08-16' GROUP BY d_year, d_quarter_name ORDER BY d_year, d_quarter_name;
SELECT cp.cp_department, sm.sm_carrier, SUM(ss.ss_net_paid_inc_tax) AS total_net_sales, AVG(ss.ss_ext_discount_amt) AS average_discount_amount, COUNT(DISTINCT CASE WHEN c.c_preferred_cust_flag = 'Y' AND ss.ss_net_paid > avg_net_paid THEN ss.ss_customer_sk END) AS high_value_customer_count FROM store_sales ss JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN catalog_page cp ON cp.cp_catalog_number = 7 JOIN ship_mode sm ON sm.sm_carrier IN ('ZHOU', 'DHL', 'GREAT EASTERN', 'USPS', 'PRIVATECARRIER', 'LATVIAN') CROSS JOIN (SELECT AVG(ss_net_paid) as avg_net_paid FROM store_sales) AS avg_sales WHERE ss.ss_store_sk = 7 AND c.c_preferred_cust_flag = 'Y' AND c.c_birth_country IN ('LIECHTENSTEIN', 'ETHIOPIA', 'DENMARK', 'SLOVAKIA') GROUP BY cp.cp_department, sm.sm_carrier ORDER BY total_net_sales DESC, cp.cp_department, sm.sm_carrier;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_state, ca.ca_country, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_paid_inc_ship_tax) AS total_revenue, SUM(cs.cs_net_profit) AS total_profit FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON cs.cs_bill_addr_sk = ca.ca_address_sk JOIN store s ON cs.cs_warehouse_sk = s.s_store_sk WHERE dd.d_year = 2002 AND ca.ca_country = 'United States' AND s.s_division_id = 1 AND ( dd.d_week_seq IN (54, 685, 542) OR dd.d_quarter_seq IN (43, 26, 39) ) AND ( cs.cs_item_sk IN (58, 10, 49) OR cs.cs_warehouse_sk IN (3, 2, 4) ) AND cs.cs_net_paid_inc_ship_tax IN (2242.98, 10093.84, 2662.12) GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state, ca.ca_country ORDER BY total_revenue DESC, total_profit DESC LIMIT 100;
SELECT d_year, SUM(ws_net_profit) AS total_net_profit, AVG(ws_quantity) AS average_quantity_sold, COUNT(DISTINCT ws.ws_web_page_sk) AS count_distinct_pages, SUM(wr_return_amt) AS total_return_amount, AVG(wr_return_quantity) AS average_return_quantity, COUNT(DISTINCT wr.wr_item_sk) AS count_distinct_returned_items FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk LEFT JOIN web_returns wr ON ws.ws_item_sk = wr.wr_item_sk AND ws.ws_order_number = wr.wr_order_number LEFT JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk WHERE dd.d_moy IN ('8', '11') AND dd.d_current_week = 'N' AND ws.ws_web_page_sk IN ('58', '41', '42', '15', '20') AND ws.ws_ext_list_price = 4407.89 AND (wp.wp_rec_end_date IN ('1999-09-03', '2001-09-02', '2000-09-02') OR wp.wp_creation_date_sk IN (2450815, 2450812, 2450813)) AND wr.wr_return_amt IN (78.84, 5987.96, 1527.93, 522.48, 1155.36, 2771.56) AND wr.wr_return_amt_inc_tax = 191.45 GROUP BY dd.d_year;
SELECT s.s_division_name, cc.cc_class, dd.d_year, COUNT(DISTINCT s.s_store_sk) AS num_stores, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_net_paid) AS average_sales_per_store, MAX(ss.ss_net_paid) AS max_sales_per_store, MIN(ss.ss_net_paid) AS min_sales_per_store FROM store_sales ss INNER JOIN store s ON ss.ss_store_sk = s.s_store_sk INNER JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk INNER JOIN call_center cc ON s.s_market_id = cc.cc_mkt_id WHERE cc.cc_class IN ('small', 'medium', 'large') AND dd.d_year = 2022 GROUP BY s.s_division_name, cc.cc_class, dd.d_year ORDER BY s.s_division_name, cc.cc_class, total_sales DESC;
SELECT cc.cc_name AS call_center_name, cc.cc_city AS call_center_city, cc.cc_state AS call_center_state, hd.hd_income_band_sk AS income_band, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_items, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_including_tax, SUM(sr.sr_net_loss) AS total_net_loss FROM call_center cc JOIN store_returns sr ON cc.cc_call_center_sk = sr.sr_store_sk JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk JOIN warehouse w ON cc.cc_state = w.w_state WHERE w.w_county = 'Williamson County' AND hd.hd_demo_sk = 1887 AND cc.cc_rec_start_date <= CURRENT_DATE AND (cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date > CURRENT_DATE) GROUP BY call_center_name, call_center_city, call_center_state, income_band ORDER BY total_returns DESC, total_returned_items DESC;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, r.r_reason_id, r.r_reason_desc, AVG(ws.ws_sales_price) AS avg_sales_price, SUM(ws.ws_ext_discount_amt) AS total_discount_amount, SUM(ws.ws_net_profit) AS total_profit, COUNT(ws.ws_order_number) AS number_of_orders FROM call_center cc JOIN web_sales ws ON cc.cc_call_center_sk = ws.ws_bill_addr_sk JOIN reason r ON r.r_reason_sk = ws.ws_order_number JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk WHERE cc.cc_hours IN ('8AM-8AM', '8AM-4PM') AND cc.cc_street_type IN ('Way', 'RD', 'Boulevard') AND r.r_reason_id IN ('AAAAAAAAEAAAAAAA', 'AAAAAAAAJAAAAAAA', 'AAAAAAAABBAAAAAA', 'AAAAAAAANBAAAAAA', 'AAAAAAAADBAAAAAA', 'AAAAAAAAFAAAAAAA') AND ws.ws_sold_date_sk IN ('2451967', '2450969', '2452345') AND ws.ws_ship_cdemo_sk IN ('1654521', '1866243', '1370635') AND td.t_hour IN (0, 1) AND td.t_second IN ('48', '12', '47', '27', '16') GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, r.r_reason_id, r.r_reason_desc ORDER BY total_profit DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT hd.hd_demo_sk) AS household_count, SUM(cs.cs_ext_sales_price) AS total_sales_amount, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders FROM catalog_sales cs JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN time_dim t ON cs.cs_sold_time_sk = t.t_time_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk WHERE t.t_shift = 'Morning' AND ib.ib_upper_bound <= 190000 AND w.w_gmt_offset = -5.00 AND w.w_street_name IN ('Ash Laurel', '6th', 'Wilson Elm', 'View First') GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ib.ib_income_band_sk;
SELECT cc_state, i_category, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS avg_sales_price, COUNT(DISTINCT cs_order_number) AS unique_orders, SUM(ss_net_profit) AS total_store_profit, AVG(ss_wholesale_cost) AS avg_store_wholesale_cost, COUNT(DISTINCT ss_ticket_number) AS unique_store_tickets, SUM(inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT p_promo_sk) AS distinct_promotions FROM call_center JOIN catalog_sales ON cc_call_center_sk = cs_call_center_sk JOIN item ON cs_item_sk = i_item_sk JOIN store_sales ON ss_item_sk = i_item_sk JOIN inventory ON inv_item_sk = i_item_sk JOIN promotion ON (cs_promo_sk = p_promo_sk OR ss_promo_sk = p_promo_sk) JOIN store ON ss_store_sk = s_store_sk WHERE cc_mkt_id IN ('6', '2', '5') AND cc_state = 'TN' AND inv_item_sk IN ('15746', '11656', '6211', '11858') AND i_item_sk IN ('2579', '2638', '2347', '3924', '3976', '4905') AND s_store_sk IN ('8', '11', '6') GROUP BY cc_state, i_category;
SELECT cd.cd_gender, cd.cd_marital_status, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(ws.ws_net_paid) AS total_web_sales, COUNT(DISTINCT ws.ws_order_number) AS total_orders FROM web_sales ws JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN web_site wsit ON ws.ws_web_site_sk = wsit.web_site_sk WHERE wsit.web_city IN ('Midway', 'Fairview') AND wsit.web_manager IN ('Lewis Wolf', 'William Carter') GROUP BY cd.cd_gender, cd.cd_marital_status ORDER BY total_web_sales DESC, avg_purchase_estimate DESC;
SELECT ca_state, COUNT(DISTINCT c_customer_sk) AS total_customers, SUM(wr_return_amt_inc_tax) AS total_refunds, AVG(wr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT wr_order_number) AS total_return_orders, s_store_name, s_city, s_state FROM customer_address JOIN customer ON customer.c_current_addr_sk = customer_address.ca_address_sk JOIN web_returns ON customer_address.ca_address_sk = web_returns.wr_refunded_addr_sk JOIN store ON customer_address.ca_state = store.s_state WHERE customer.c_preferred_cust_flag = 'Y' AND web_returns.wr_returned_date_sk BETWEEN '20210101' AND '20211231' GROUP BY ca_state, s_store_name, s_city, s_state ORDER BY total_refunds DESC, avg_return_quantity DESC LIMIT 100;
SELECT cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, COUNT(DISTINCT wr_returning_customer_sk) AS num_returning_customers, SUM(wr_return_quantity) AS total_returned_quantity, AVG(wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(wr_net_loss) AS total_net_loss, r_reason_desc, w_warehouse_name, w_city, w_state FROM web_returns JOIN customer_demographics ON web_returns.wr_returning_cdemo_sk = customer_demographics.cd_demo_sk JOIN reason ON web_returns.wr_reason_sk = reason.r_reason_sk JOIN warehouse ON web_returns.wr_returning_addr_sk = warehouse.w_warehouse_sk GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_purchase_estimate, cd_credit_rating, r_reason_desc, w_warehouse_name, w_city, w_state ORDER BY total_net_loss DESC, avg_return_amount_inc_tax DESC LIMIT 100;
SELECT cc.cc_city, cc.cc_state, r.r_reason_desc, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, hd.hd_income_band_sk, COUNT(cr.cr_item_sk) AS total_returned_items, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_fee) AS total_fees, SUM(cr.cr_return_amt_inc_tax) AS total_amount_incl_tax, SUM(cr.cr_net_loss) AS total_net_loss, COUNT(DISTINCT p.p_promo_sk) AS total_promotions_impacted FROM catalog_returns cr LEFT JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk LEFT JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk LEFT JOIN customer_demographics cd ON cr.cr_returning_cdemo_sk = cd.cd_demo_sk LEFT JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk LEFT JOIN promotion p ON p.p_item_sk = cr.cr_item_sk AND p.p_channel_press = 'N' WHERE cr.cr_return_amount BETWEEN 300 AND 4500 AND r.r_reason_desc IN ('reason 24', 'reason 26', 'Parts missing', 'unauthoized purchase') AND cd.cd_purchase_estimate = 9000 GROUP BY cc.cc_city, cc.cc_state, r.r_reason_desc, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, hd.hd_income_band_sk ORDER BY total_return_amount DESC, total_returned_items DESC, cc.cc_city, cc.cc_state;
SELECT s.s_store_name, s.s_city, s.s_state, s.s_county, cc.cc_name AS call_center_name, cc.cc_city AS call_center_city, cc.cc_state AS call_center_state, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_net_loss) AS total_net_loss, COUNT(DISTINCT cr.cr_order_number) AS total_return_orders, COUNT(DISTINCT inv.inv_item_sk) AS total_distinct_items_in_inventory, SUM(inv.inv_quantity_on_hand) AS total_inventory_quantity, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_size, COUNT(DISTINCT p.p_promo_sk) AS total_promotions, SUM(CASE WHEN p.p_channel_event = 'N' AND p.p_channel_demo = 'N' THEN p.p_cost ELSE 0 END) AS total_promo_cost_without_event_demo FROM store s JOIN call_center cc ON s.s_market_id = cc.cc_mkt_id JOIN catalog_returns cr ON cc.cc_call_center_sk = cr.cr_call_center_sk JOIN inventory inv ON inv.inv_warehouse_sk = cr.cr_warehouse_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN promotion p ON p.p_item_sk = inv.inv_item_sk WHERE s.s_county = 'Williamson County' AND cc.cc_state = 'TN' AND cc.cc_division IN (3, 4, 5) AND cr.cr_net_loss IN (102.74, 18.18, 876.19) AND cr.cr_warehouse_sk IN (4, 5, 2) AND w.w_country = 'United States' AND w.w_warehouse_sq_ft IN (294242, 138504, 977787) AND inv.inv_item_sk IN (15163, 10582, 8594) AND inv.inv_quantity_on_hand IN (867, 861, 859) AND cc.cc_street_type IN ('Way', 'RD', 'Boulevard') AND cc.cc_mkt_id IN (2, 6, 5) AND p.p_end_date_sk IN (2450565, 2450562, 2450605) AND p.p_channel_event = 'N' AND p.p_channel_demo = 'N' GROUP BY s.s_store_name, s.s_city, s.s_state, s.s_county, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_returned_quantity DESC, total_net_loss DESC, total_inventory_quantity DESC, avg_warehouse_size DESC;
SELECT d_year, i_category, COUNT(DISTINCT ss_ticket_number) AS total_sales_transactions, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, SUM(ss_net_profit) AS total_net_profit, SUM(cr_return_amount) AS total_return_amount, COUNT(DISTINCT cr_order_number) AS total_return_transactions, (SUM(ss_net_profit) - SUM(cr_net_loss)) AS net_profit_after_returns FROM store_sales JOIN item ON store_sales.ss_item_sk = item.i_item_sk JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk LEFT JOIN catalog_returns ON store_sales.ss_item_sk = catalog_returns.cr_item_sk AND store_sales.ss_ticket_number = catalog_returns.cr_order_number WHERE store_sales.ss_addr_sk = '19253' AND d_year = 1999 GROUP BY d_year, i_category ORDER BY net_profit_after_returns DESC LIMIT 10;
SELECT i.i_category, i.i_class, call_center.cc_name, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT cr.cr_order_number) AS total_returned_orders, MAX(i.i_current_price) AS max_item_price FROM catalog_returns cr JOIN call_center ON cr.cr_call_center_sk = call_center.cc_call_center_sk JOIN item i ON cr.cr_item_sk = i.i_item_sk WHERE i.i_manufact = 'barcallycally' GROUP BY i.i_category, i.i_class, call_center.cc_name ORDER BY total_return_amount DESC, i.i_category, i.i_class, call_center.cc_name;
SELECT w_state, s_county, p_promo_name, COUNT(*) AS num_sales, SUM(cs_net_paid) AS total_net_sales, AVG(cs_net_profit) AS avg_net_profit, SUM(ws_net_paid) AS total_web_net_sales, AVG(ws_net_profit) AS avg_web_net_profit FROM warehouse JOIN catalog_sales ON cs_warehouse_sk = w_warehouse_sk JOIN web_sales ON ws_warehouse_sk = w_warehouse_sk JOIN promotion ON cs_promo_sk = p_promo_sk AND ws_promo_sk = p_promo_sk JOIN store ON w_state = s_state WHERE w_state = 'TN' AND s_county = 'Williamson County' AND (p_promo_id = 'AAAAAAAAIAAAAAAA' OR p_promo_id = 'AAAAAAAACAAAAAAA') GROUP BY w_state, s_county, p_promo_name ORDER BY total_net_sales DESC, total_web_net_sales DESC;
SELECT ca.ca_state, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_return_quantity) AS total_return_quantity, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, COUNT(DISTINCT CASE WHEN c.c_preferred_cust_flag = 'Y' THEN sr.sr_ticket_number ELSE NULL END) AS preferred_customer_returns FROM store_returns sr JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE sr.sr_return_tax BETWEEN 5 AND 130 AND c.c_last_review_date_sk IN (2452499, 2452496, 2452479, 2452342) AND sr.sr_item_sk IN (13538, 16733, 1766, 2599, 3017, 9220) GROUP BY ca.ca_state ORDER BY total_return_amount DESC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, AVG(sr.sr_return_amt) AS avg_return_amount, AVG(sr.sr_return_quantity) AS avg_return_quantity, COUNT(sr.sr_ticket_number) AS total_returns FROM income_band ib JOIN store_returns sr ON sr.sr_cdemo_sk = ib.ib_income_band_sk JOIN inventory i ON sr.sr_item_sk = i.inv_item_sk GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ib.ib_income_band_sk;
SELECT i.i_category AS item_category, COUNT(DISTINCT ss.ss_item_sk) AS total_items_sold, SUM(ss.ss_quantity) AS total_sales_quantity, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_sales_amount, COUNT(DISTINCT sr.sr_item_sk) AS total_items_returned, SUM(sr.sr_return_quantity) AS total_return_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax FROM item i LEFT JOIN store_sales ss ON i.i_item_sk = ss.ss_item_sk LEFT JOIN store_returns sr ON i.i_item_sk = sr.sr_item_sk GROUP BY i.i_category ORDER BY total_sales_amount DESC;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, r.r_reason_desc, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_items, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_tax) AS total_tax, SUM(cr.cr_return_ship_cost) AS total_ship_cost, SUM(cr.cr_net_loss) AS total_net_loss FROM call_center cc JOIN catalog_returns cr ON cc.cc_call_center_sk = cr.cr_call_center_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk WHERE cc.cc_zip = '31904' AND cr.cr_return_amt_inc_tax > 0 AND r.r_reason_desc IN ('Found a better price in a store', 'its is a boy') GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, r.r_reason_desc ORDER BY total_returns DESC, total_returned_items DESC;
SELECT c.cc_name, c.cc_city, c.cc_state, cp.cp_department, p.p_promo_name, t.t_shift, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS number_of_orders, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN call_center c ON cs.cs_call_center_sk = c.cc_call_center_sk JOIN catalog_page cp ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk JOIN time_dim t ON cs.cs_sold_time_sk = t.t_time_sk WHERE c.cc_rec_start_date <= CURRENT_DATE AND (c.cc_rec_end_date IS NULL OR c.cc_rec_end_date > CURRENT_DATE) AND cp.cp_start_date_sk <= cs.cs_sold_date_sk AND (cp.cp_end_date_sk IS NULL OR cp.cp_end_date_sk >= cs.cs_sold_date_sk) AND p.p_discount_active = 'Y' GROUP BY c.cc_name, c.cc_city, c.cc_state, cp.cp_department, p.p_promo_name, t.t_shift ORDER BY total_net_profit DESC, total_quantity_sold DESC LIMIT 100;
SELECT s_state, COUNT(DISTINCT ss_customer_sk) as total_customers, SUM(ss_quantity) as total_quantity_sold, AVG(ss_sales_price) as average_sales_price, SUM(ss_net_profit) as total_net_profit, SUM(cr_return_amount) as total_return_amount, AVG(hd_dep_count) as average_dependent_count FROM store_sales JOIN store ON ss_store_sk = s_store_sk JOIN catalog_returns ON ss_item_sk = cr_item_sk AND ss_ticket_number = cr_order_number JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk GROUP BY s_state ORDER BY total_net_profit DESC LIMIT 10;
SELECT cp.cp_department, ib.ib_income_band_sk, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_net_loss) AS total_net_loss, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, SUM(sr.sr_return_amt_inc_tax) AS total_store_return_value, AVG(sr.sr_fee) AS avg_store_return_fee, SUM(wp.wp_image_count) AS total_web_images FROM catalog_page cp JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk JOIN store_returns sr ON cr.cr_item_sk = sr.sr_item_sk JOIN web_page wp ON cp.cp_catalog_page_sk = wp.wp_web_page_sk JOIN income_band ib ON ib.ib_lower_bound <= cr.cr_return_amount AND ib.ib_upper_bound >= cr.cr_return_amount WHERE cp.cp_start_date_sk BETWEEN 2450965 AND 2451180 AND cr.cr_returned_time_sk IN (68597, 54816, 8520, 49710) AND sr.sr_returned_date_sk BETWEEN 2451108 AND 2452339 AND sr.sr_return_ship_cost = 3.94 GROUP BY cp.cp_department, ib.ib_income_band_sk ORDER BY total_net_loss DESC, total_store_return_value DESC;
SELECT c.c_first_name, c.c_last_name, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(s.s_number_employees) AS avg_store_employees, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages, MAX(sm.sm_code) AS max_ship_mode_code FROM customer c JOIN web_page wp ON c.c_customer_sk = wp.wp_customer_sk JOIN store s ON s.s_zip = CAST(c.c_current_addr_sk AS CHAR(10)) JOIN warehouse w ON w.w_zip = s.s_zip JOIN ship_mode sm ON sm.sm_code = w.w_zip WHERE w.w_gmt_offset = '-5.00' AND (wp.wp_char_count = '2129' OR wp.wp_char_count = '2531') AND (wp.wp_rec_end_date = '1999-09-03' OR wp.wp_rec_end_date = '2001-09-02' OR wp.wp_rec_end_date = '2000-09-02') GROUP BY c.c_first_name, c.c_last_name;
SELECT i.i_category, i.i_class, i.i_brand, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(wr.wr_return_quantity) AS total_quantity_returned, SUM(wr.wr_return_amt) AS total_return_amt, AVG(wr.wr_fee) AS avg_return_fee, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN cs.cs_net_paid ELSE 0 END) AS preferred_customer_sales, COUNT(DISTINCT CASE WHEN c.c_preferred_cust_flag = 'Y' THEN c.c_customer_sk ELSE NULL END) AS preferred_customer_count FROM item i JOIN catalog_sales cs ON i.i_item_sk = cs.cs_item_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk GROUP BY i.i_category, i.i_class, i.i_brand ORDER BY total_net_paid DESC, total_return_amt DESC, avg_sales_price DESC LIMIT 100;
SELECT ca.ca_state AS customer_state, EXTRACT(YEAR FROM d_date) AS year_of_return, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, SUM(wr.wr_return_amt) AS total_return_amount, SUM(wr.wr_return_tax) AS total_tax, SUM(wr.wr_return_amt_inc_tax) AS total_amount_including_tax, SUM(wr.wr_return_ship_cost) AS total_shipping_cost, SUM(wr.wr_refunded_cash) AS total_refunded_cash, SUM(wr.wr_reversed_charge) AS total_reversed_charge, SUM(wr.wr_account_credit) AS total_account_credit, SUM(wr.wr_net_loss) AS total_net_loss FROM web_returns wr JOIN customer c ON wr.wr_returning_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN date_dim d ON wr.wr_returned_date_sk = d.d_date_sk WHERE d.d_year >= 2003 GROUP BY ca.ca_state, year_of_return ORDER BY ca.ca_state, year_of_return;
SELECT cd.cd_education_status, cd.cd_marital_status, ca.ca_state, cd.cd_credit_rating, AVG(cd.cd_purchase_estimate) AS average_purchase_estimate, COUNT(DISTINCT ca.ca_address_sk) AS number_of_addresses, SUM(hd.hd_vehicle_count) AS total_vehicles, AVG(t.t_hour + (t.t_minute / 60.0) + (t.t_second / 3600.0)) AS average_time_of_day FROM customer_demographics cd JOIN customer_address ca ON cd.cd_demo_sk = ca.ca_address_sk JOIN household_demographics hd ON cd.cd_demo_sk = hd.hd_demo_sk JOIN time_dim t ON t.t_time_sk = ca.ca_address_sk WHERE cd.cd_credit_rating IN ('Low Risk', 'High Risk', 'Good') AND t.t_time IN (775, 962) AND t.t_second IN (52, 26, 34) AND ca.ca_address_id IN ('AAAAAAAANJCAAAAA', 'AAAAAAAAFMCAAAAA', 'AAAAAAAAHGOAAAAA', 'AAAAAAAAHEEAAAAA') AND cd.cd_dep_count IN (1, 2) AND hd.hd_dep_count IN (0, 6, 4, 1) AND hd.hd_vehicle_count IN (3, 4) GROUP BY cd.cd_education_status, cd.cd_marital_status, ca.ca_state, cd.cd_credit_rating ORDER BY average_purchase_estimate DESC;
SELECT h.hd_income_band_sk, p.p_promo_name, p.p_channel_dmail, p.p_channel_email, p.p_channel_tv, COUNT(DISTINCT s.ss_ticket_number) AS total_sales_transactions, SUM(s.ss_quantity) AS total_units_sold, SUM(s.ss_net_paid) AS total_revenue, AVG(s.ss_sales_price) AS average_sales_price, r.r_reason_desc, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions, SUM(sr.sr_return_quantity) AS total_units_returned, SUM(sr.sr_net_loss) AS total_loss_from_returns FROM store_sales s LEFT JOIN promotion p ON s.ss_promo_sk = p.p_promo_sk LEFT JOIN household_demographics h ON s.ss_hdemo_sk = h.hd_demo_sk LEFT JOIN store_returns sr ON s.ss_ticket_number = sr.sr_ticket_number AND s.ss_item_sk = sr.sr_item_sk LEFT JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE s.ss_item_sk IN (13423, 9310) GROUP BY h.hd_income_band_sk, p.p_promo_name, p.p_channel_dmail, p.p_channel_email, p.p_channel_tv, r.r_reason_desc ORDER BY total_revenue DESC;
SELECT ca.ca_state, ca.ca_city, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit, p.p_promo_name, SUM(CASE WHEN p.p_channel_press = 'N' THEN cs.cs_net_paid ELSE 0 END) AS net_paid_no_press_promo, SUM(cs.cs_coupon_amt) AS total_coupon_amount FROM customer_address ca JOIN catalog_sales cs ON ca.ca_address_sk = cs.cs_ship_addr_sk LEFT JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE ca.ca_address_sk IN (957, 1773) AND cs.cs_coupon_amt IN (278.88, 333.46, 10.60) AND p.p_channel_press = 'N' AND p.p_start_date_sk IN (2450607, 2450356, 2450342, 2450745) GROUP BY ca.ca_state, ca.ca_city, p.p_promo_name ORDER BY total_net_profit DESC, total_quantity_sold DESC;
SELECT cp.cp_type, cp.cp_department, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS avg_sales_price, COUNT(DISTINCT cs.cs_order_number) AS unique_orders, SUM(sr.sr_return_quantity) AS total_return_quantity, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(inv.inv_quantity_on_hand) AS total_inventory_on_hand, SUM(ss.ss_quantity) AS total_store_sales_quantity, AVG(ss.ss_net_paid) AS avg_net_paid_store_sales FROM catalog_page cp JOIN catalog_sales cs ON cp.cp_catalog_page_sk = cs.cs_catalog_page_sk LEFT JOIN store_returns sr ON cs.cs_item_sk = sr.sr_item_sk AND cs.cs_order_number = CAST(sr.sr_ticket_number AS integer) LEFT JOIN inventory inv ON cs.cs_item_sk = inv.inv_item_sk LEFT JOIN store_sales ss ON cs.cs_item_sk = ss.ss_item_sk AND cs.cs_order_number = CAST(ss.ss_ticket_number AS integer) WHERE cp.cp_catalog_number IN (36, 10, 1, 39, 15, 23) AND cp.cp_type IN ('quarterly', 'bi-annual', 'monthly') AND inv.inv_date_sk = 2450815 AND cs.cs_ship_date_sk = 2450901 AND cs.cs_list_price IN (127.89, 61.80, 132.26) GROUP BY cp.cp_type, cp.cp_department ORDER BY cp.cp_type, cp.cp_department;
SELECT ca_state, cd_gender, cd_education_status, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN customer_address ON cs_bill_addr_sk = ca_address_sk JOIN customer_demographics ON cs_bill_cdemo_sk = cd_demo_sk JOIN time_dim ON cs_sold_time_sk = t_time_sk JOIN web_page ON cs_sold_date_sk = wp_access_date_sk WHERE ca_country = 'United States' AND t_shift = 'Day' AND wp_type IN ('order', 'general') AND cd_gender IN ('M', 'F') AND cd_dep_count IN (1, 2) GROUP BY ca_state, cd_gender, cd_education_status ORDER BY total_net_profit DESC, total_net_paid DESC, avg_sales_price DESC;
SELECT c.c_salutation, SUM(ss.ss_quantity) AS store_sales_quantity, AVG(ss.ss_sales_price) AS store_sales_avg_price, SUM(cs.cs_quantity) AS catalog_sales_quantity, AVG(cs.cs_sales_price) AS catalog_sales_avg_price, SUM(ws.ws_quantity) AS web_sales_quantity, AVG(ws.ws_sales_price) AS web_sales_avg_price, AVG(hd.hd_dep_count) AS avg_household_dep_count, AVG(ib.ib_upper_bound) AS avg_income_upper_bound FROM customer c LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk LEFT JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk LEFT JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk LEFT JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE c.c_salutation IN ('Mr.', 'Miss', 'Sir') AND hd.hd_buy_potential IN ('5001-10000', 'Unknown', '501-1000', '0-500', '>10000') AND hd.hd_income_band_sk IN (1, 6, 12, 18) AND (ss.ss_sold_time_sk IN (50436, 48475, 51865) OR ss.ss_sold_time_sk IS NULL) AND (ss.ss_ext_wholesale_cost IN (3684.31, 3037.11, 5884.90, 4962.49, 1522.56, 3630.06) OR ss.ss_ext_wholesale_cost IS NULL) GROUP BY c.c_salutation ORDER BY c.c_salutation;
SELECT dd.d_year, dd.d_quarter_name, cc.cc_class, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(DISTINCT ss.ss_store_sk) AS number_of_stores, COUNT(DISTINCT w.w_warehouse_sk) AS number_of_warehouses FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN call_center cc ON ss.ss_store_sk = cc.cc_open_date_sk JOIN warehouse w ON ss.ss_store_sk = w.w_warehouse_sk WHERE dd.d_fy_year IN ('1904', '1902', '1903', '1912', '1901', '1907') AND ss.ss_store_sk IN ('8', '4', '7', '10', '1', '2') AND cc.cc_open_date_sk IN ('2451063', '2450952', '2450806') AND cc.cc_suite_number IN ('Suite 0', 'Suite 70', 'Suite U') AND w.w_warehouse_name IN ('Important issues liv', 'Bad cards must make.', 'Conventional childr', 'Doors canno') GROUP BY dd.d_year, dd.d_quarter_name, cc.cc_class ORDER BY dd.d_year, dd.d_quarter_name, cc.cc_class;
SELECT cd_gender, cd_marital_status, cd_education_status, sm_type, COUNT(*) AS total_returns, SUM(cr_return_amount) AS total_refund_amount, AVG(cr_return_quantity) AS avg_return_quantity, SUM(cr_fee) AS total_fees, SUM(cr_return_ship_cost) AS total_shipping_costs, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN customer_demographics cd ON cr.cr_returning_cdemo_sk = cd.cd_demo_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN time_dim td ON cr.cr_returned_time_sk = td.t_time_sk JOIN promotion p ON cr.cr_order_number = p.p_promo_sk WHERE td.t_sub_shift = 'night' AND p.p_channel_dmail = 'Y' AND p.p_discount_active = 'N' GROUP BY cd_gender, cd_marital_status, cd_education_status, sm_type ORDER BY total_returns DESC, total_refund_amount DESC;
SELECT s.s_store_name, c.c_first_name, c.c_last_name, COUNT(ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_items_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk WHERE s.s_floor_space IN (9026222, 7557959, 9341467, 6995995, 5219562) AND c.c_current_hdemo_sk IN (6755, 780, 352, 3208, 1770) AND c.c_email_address IN ('Joseph.Hilton@io2VIr.org', 'Scott.Goodman@EN4g6ehG4eh1.com', 'Charles.Fink@5cPLD.com', 'Rosa.Nixon@ghkTsItbO5o8hKtVkdI.com') GROUP BY s.s_store_name, c.c_first_name, c.c_last_name ORDER BY total_net_profit DESC, total_net_paid DESC;
SELECT sm.sm_type, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_wholesale_cost) AS avg_wholesale_cost, AVG(ws.ws_sales_price) AS avg_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk WHERE w.w_zip = '35709' AND ws.ws_web_site_sk IN (30, 17, 4, 15, 14, 2) AND sm.sm_ship_mode_sk IN (4, 9, 13, 10, 8, 20) GROUP BY sm.sm_type ORDER BY total_net_profit DESC;
SELECT i.i_category, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_items_sold, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(wr.wr_return_quantity) AS total_items_returned, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk LEFT JOIN web_returns wr ON cs.cs_order_number = wr.wr_order_number AND cs.cs_item_sk = wr.wr_item_sk WHERE cd.cd_purchase_estimate >= 10000 AND cd.cd_dep_employed_count = 0 GROUP BY i.i_category ORDER BY i.i_category;
SELECT ca_state, cc_division_name, AVG(cc_employees) AS avg_cc_employees, COUNT(DISTINCT cc_call_center_sk) AS num_call_centers, SUM(hd_dep_count) AS total_dependents, AVG(hd_vehicle_count) AS avg_num_vehicles, COUNT(DISTINCT c_customer_sk) AS num_customers, COUNT(CASE WHEN hd_buy_potential = '0-500' THEN 1 END) AS count_low_buy_potential, COUNT(CASE WHEN hd_buy_potential = '>10000' THEN 1 END) AS count_high_buy_potential FROM call_center JOIN customer ON c_current_cdemo_sk = cc_call_center_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk JOIN household_demographics ON c_current_hdemo_sk = hd_demo_sk WHERE (cc_rec_end_date = '2000-12-31' OR cc_rec_end_date = '2001-12-31') AND hd_dep_count IN (4, 7, 0, 3) AND ca_street_name = 'Fourth Lakeview' GROUP BY ca_state, cc_division_name ORDER BY ca_state, cc_division_name;
SELECT ca.ca_state, ca.ca_city, sum(cs.cs_quantity) AS total_quantity_sold, avg(cs.cs_sales_price) AS average_sales_price, count(distinct cs.cs_order_number) AS total_orders, cd.cd_education_status, sum(cs.cs_net_profit) AS total_net_profit, count(distinct cs.cs_item_sk) AS unique_items_sold, ib.ib_lower_bound, ib.ib_upper_bound FROM catalog_sales cs JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON cs.cs_ship_cdemo_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound WHERE ca.ca_county = 'Lonoke County' AND (cd.cd_gender = 'M' OR cd.cd_gender = 'F') GROUP BY ca.ca_state, ca.ca_city, cd.cd_education_status, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ca.ca_state, ca.ca_city, cd.cd_education_status, total_net_profit DESC;
SELECT c_birth_country, cd_gender, cd_marital_status, cd_education_status, AVG(cd_purchase_estimate) AS avg_purchase_estimate, COUNT(DISTINCT c_customer_sk) AS total_customers, SUM(inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT wr_order_number) AS total_returns, AVG(wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(wr_fee) AS total_return_fees FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN inventory inv ON inv.inv_date_sk = '2450815' JOIN web_returns wr ON wr.wr_refunded_customer_sk = c.c_customer_sk JOIN web_page wp ON wp.wp_web_page_sk = wr.wr_web_page_sk AND wp.wp_max_ad_count IN ('0', '1') JOIN time_dim t ON t.t_time_sk = wr.wr_returned_time_sk AND t.t_time_id IN ('AAAAAAAALDIAAAAA', 'AAAAAAAAPEJAAAAA', 'AAAAAAAAKMNAAAAA', 'AAAAAAAAIHFAAAAA', 'AAAAAAAAOEBBAAAA', 'AAAAAAAALNDAAAAA') JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk WHERE cd.cd_marital_status IN ('D', 'M', 'U', 'S', 'W') AND cd.cd_gender = 'M' GROUP BY c_birth_country, cd_gender, cd_marital_status, cd_education_status ORDER BY avg_purchase_estimate DESC, total_customers DESC LIMIT 100;
SELECT d_year, i_category, SUM(wr_return_quantity) AS total_return_quantity, AVG(wr_return_amt) AS avg_return_amount, COUNT(DISTINCT wr_order_number) AS total_orders, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(wr_fee) AS total_fees, SUM(wr_net_loss) AS total_net_loss, r_reason_desc, hd_dep_count, hd_vehicle_count FROM web_returns JOIN date_dim ON web_returns.wr_returned_date_sk = date_dim.d_date_sk JOIN item ON web_returns.wr_item_sk = item.i_item_sk JOIN reason ON web_returns.wr_reason_sk = reason.r_reason_sk JOIN household_demographics ON web_returns.wr_returning_hdemo_sk = household_demographics.hd_demo_sk WHERE d_year = 2022 AND i_wholesale_cost BETWEEN 2.00 AND 10.00 AND i_container <> 'Unknown' GROUP BY d_year, i_category, r_reason_desc, hd_dep_count, hd_vehicle_count ORDER BY total_return_quantity DESC, avg_return_amount DESC;
SELECT i.i_category, i.i_brand, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_quantity) AS total_web_quantity_sold, SUM(ws.ws_net_paid) AS total_web_net_paid, AVG(ws.ws_net_profit) AS avg_web_net_profit, COUNT(DISTINCT ss.ss_ticket_number) AS total_store_sales_transactions, SUM(ss.ss_quantity) AS total_store_quantity_sold, SUM(ss.ss_net_paid_inc_tax) AS total_store_net_paid_inc_tax, AVG(ss.ss_net_profit) AS avg_store_net_profit, COUNT(DISTINCT hd.hd_demo_sk) AS unique_customers, AVG(hd.hd_dep_count) AS avg_dependent_count FROM item i LEFT JOIN web_sales ws ON i.i_item_sk = ws.ws_item_sk LEFT JOIN store_sales ss ON i.i_item_sk = ss.ss_item_sk LEFT JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk OR ws.ws_ship_hdemo_sk = hd.hd_demo_sk WHERE i.i_brand IN ('edu packunivamalg #16', 'univmaxi #4', 'univnameless #5', 'amalgamalgamalg #17', 'edu packexporti #1') AND (ws.ws_order_number IN ('32000', '17527', '16129', '59722', '23980') OR ss.ss_ticket_number IS NOT NULL) GROUP BY i.i_category, i.i_brand ORDER BY i.i_category, i.i_brand;
SELECT ca.ca_state, COUNT(DISTINCT c.c_customer_sk) AS total_customers, AVG(s.s_floor_space) AS average_store_floor_space, SUM(s.s_number_employees) AS total_employees, COUNT(DISTINCT w.web_site_sk) AS total_websites, AVG(w.web_tax_percentage) AS average_web_tax_percentage FROM customer_address ca JOIN customer c ON ca.ca_address_sk = c.c_current_addr_sk JOIN store s ON ca.ca_state = s.s_state JOIN web_site w ON w.web_state = ca.ca_state WHERE c.c_preferred_cust_flag = 'Y' AND c.c_birth_year BETWEEN 1933 AND 1975 AND s.s_company_id = 1 AND w.web_open_date_sk IN ('2450730', '2450747') GROUP BY ca.ca_state ORDER BY total_customers DESC;
SELECT r.r_reason_desc AS promotion_reason, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_ext_discount_amt) AS total_discount_amount, AVG(cs.cs_net_profit) AS average_net_profit_per_item, cd.cd_gender, cd.cd_education_status, COUNT(DISTINCT c.c_customer_sk) AS unique_customers FROM catalog_sales cs JOIN time_dim t ON cs.cs_sold_time_sk = t.t_time_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN reason r ON cs.cs_promo_sk = r.r_reason_sk WHERE t.t_sub_shift = 'night' AND cs.cs_promo_sk IN (SELECT r_reason_sk FROM reason WHERE r_reason_id IN ('AAAAAAAACAAAAAAA', 'AAAAAAAAKAAAAAAA', 'AAAAAAAAFBAAAAAA', 'AAAAAAAABCAAAAAA', 'AAAAAAAAACAAAAAA', 'AAAAAAAANBAAAAAA')) GROUP BY r.r_reason_desc, cd.cd_gender, cd.cd_education_status ORDER BY total_quantity_sold DESC, average_sales_price DESC;
SELECT c.c_customer_sk, ca.ca_state, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(hd.hd_dep_count) AS avg_dependency_count, COUNT(DISTINCT w.w_warehouse_sk) AS number_of_warehouses, MAX(t.t_time) AS latest_time FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN inventory inv ON inv.inv_warehouse_sk = ca.ca_address_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN time_dim t ON inv.inv_date_sk = t.t_time_sk WHERE ca.ca_state IN ('TX', 'NV') AND hd.hd_vehicle_count = 2 AND t.t_sub_shift = 'night' AND c.c_birth_month IN (2, 9, 12, 4, 5) AND c.c_birth_year IN (1928, 1924) GROUP BY c.c_customer_sk, ca.ca_state ORDER BY total_inventory DESC, avg_dependency_count, number_of_warehouses, latest_time;
SELECT i.i_category, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(inv.inv_quantity_on_hand) AS total_inventory_on_hand, SUM(ss.ss_net_profit) AS total_net_profit FROM item i JOIN store_sales ss ON i.i_item_sk = ss.ss_item_sk JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE i.i_wholesale_cost BETWEEN 4 AND 7 AND inv.inv_date_sk = '2450815' AND ss.ss_ext_sales_price < 5000 AND t.t_hour BETWEEN 0 AND 1 GROUP BY i.i_category ORDER BY total_net_profit DESC;
SELECT c.ca_country, c.ca_city, i.i_category_id, i.i_category, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_net_paid) AS average_sales, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(cr.cr_return_quantity) AS total_quantity_returned, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_customers_returned FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN income_band ib ON ss.ss_hdemo_sk = ib.ib_income_band_sk JOIN customer_address c ON ss.ss_addr_sk = c.ca_address_sk LEFT JOIN catalog_returns cr ON cr.cr_order_number = ss.ss_ticket_number WHERE c.ca_country = 'United States' AND (c.ca_city = 'Gravel Hill' OR c.ca_city = 'Montague') AND (ib.ib_income_band_sk IN (1, 6, 19)) AND (ss.ss_cdemo_sk IN (854925, 898884, 94461)) GROUP BY c.ca_country, c.ca_city, i.i_category_id, i.i_category, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_sales DESC, i.i_category_id;
SELECT sm.sm_type AS shipping_mode_type, sm.sm_carrier AS carrier, cp.cp_department AS catalog_department, COUNT(DISTINCT wr.wr_order_number) AS number_of_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_return_tax) AS total_tax, SUM(wr.wr_return_ship_cost) AS total_shipping_cost, SUM(wr.wr_net_loss) AS total_net_loss FROM web_returns wr JOIN ship_mode sm ON wr.wr_returned_date_sk = sm.sm_ship_mode_sk JOIN catalog_page cp ON wr.wr_web_page_sk = cp.cp_catalog_page_sk WHERE wr.wr_returned_date_sk = 2451368 AND cp.cp_catalog_page_sk IN ('859', '3510', '105', '4419') GROUP BY shipping_mode_type, carrier, catalog_department ORDER BY total_net_loss DESC;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_state, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, SUM(cs.cs_net_paid) AS total_net_paid, AVG(cs.cs_net_profit) AS avg_net_profit FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN store s ON ca.ca_state = s.s_state WHERE dd.d_current_quarter = 'N' AND dd.d_following_holiday = 'N' AND cd.cd_credit_rating = 'Good' AND s.s_market_id IS NOT NULL GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state ORDER BY dd.d_year, dd.d_quarter_name, ca.ca_state;
SELECT s.s_division_id AS store_division_id, s.s_division_name AS store_division_name, hd.hd_income_band_sk AS household_income_band, COUNT(DISTINCT ws.ws_order_number) AS total_web_sales, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, AVG(sr.sr_return_amt) AS average_return_amount FROM store s LEFT JOIN web_sales ws ON s.s_store_sk = ws.ws_ship_customer_sk LEFT JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk LEFT JOIN household_demographics hd ON (ws.ws_ship_hdemo_sk = hd.hd_demo_sk OR sr.sr_hdemo_sk = hd.hd_demo_sk) WHERE ws.ws_order_number IS NOT NULL OR sr.sr_ticket_number IS NOT NULL GROUP BY s.s_division_id, s.s_division_name, hd.hd_income_band_sk ORDER BY s.s_division_id, hd.hd_income_band_sk;
SELECT dd.d_year, dd.d_quarter_name, COUNT(DISTINCT cr.cr_order_number) AS catalog_return_orders, SUM(cr.cr_return_quantity) AS total_catalog_returned_qty, AVG(cr.cr_return_amount) AS avg_catalog_return_amount, SUM(cr.cr_net_loss) AS total_catalog_net_loss, COUNT(DISTINCT wr.wr_order_number) AS web_return_orders, SUM(wr.wr_return_quantity) AS total_web_returned_qty, AVG(wr.wr_return_amt) AS avg_web_return_amount, SUM(wr.wr_net_loss) AS total_web_net_loss, COUNT(DISTINCT h.hd_demo_sk) AS unique_households_affected, SUM(CASE WHEN i.i_rec_end_date = '2001-10-26' THEN cr.cr_return_quantity ELSE 0 END) AS qty_items_end_date_oct26 FROM date_dim dd LEFT JOIN catalog_returns cr ON dd.d_date_sk = cr.cr_returned_date_sk LEFT JOIN web_returns wr ON dd.d_date_sk = wr.wr_returned_date_sk LEFT JOIN item i ON cr.cr_item_sk = i.i_item_sk OR wr.wr_item_sk = i.i_item_sk LEFT JOIN household_demographics h ON cr.cr_returning_hdemo_sk = h.hd_demo_sk OR wr.wr_returning_hdemo_sk = h.hd_demo_sk WHERE dd.d_date IS NOT NULL AND (cr.cr_return_amount > 0 OR wr.wr_return_amt > 0) AND (cr.cr_reason_sk = 28 OR wr.wr_reason_sk = 28) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT c.c_first_name, c.c_last_name, c.c_email_address, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, COUNT(DISTINCT sr.sr_ticket_number) AS number_of_returns, w.web_name, w.web_country FROM customer c JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN web_site w ON w.web_country = 'United States' WHERE sr.sr_return_quantity > 0 AND sr.sr_returned_date_sk BETWEEN w.web_open_date_sk AND w.web_close_date_sk AND w.web_rec_start_date BETWEEN '1997-08-16' AND '2001-08-16' GROUP BY c.c_customer_sk, w.web_site_sk ORDER BY total_returned_quantity DESC, average_return_amount DESC;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, SUM(ws.ws_net_paid_inc_ship_tax) AS total_sales, SUM(ws.ws_ext_ship_cost) AS total_shipping_costs, COUNT(DISTINCT ws.ws_order_number) AS number_of_orders, AVG(ws.ws_net_paid_inc_ship_tax) AS avg_order_value, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_value, COUNT(DISTINCT cr.cr_order_number) AS number_of_returns, SUM(cr.cr_store_credit) AS total_store_credit_issued, SUM(wr.wr_net_loss) AS total_web_net_loss FROM customer c LEFT JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk LEFT JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_returning_customer_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk WHERE ws.ws_ext_ship_cost IN ('445.80', '1378.08') OR ws.ws_net_paid_inc_ship_tax IN ('3521.86', '4835.64', '451.77', '1948.62') OR cr.cr_return_tax IN ('8.78', '157.04', '14.40', '364.85', '21.09', '27.15') OR cr.cr_store_credit IN ('1.34', '1072.41', '2042.86', '1698.25', '143.92') GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name ORDER BY total_sales DESC, number_of_orders DESC, total_returns DESC;
SELECT s.s_store_name, s.s_state, cc.cc_name AS call_center_name, cc.cc_class, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_quantity) AS average_return_quantity, COUNT(DISTINCT sr.sr_customer_sk) AS unique_customers_returning, COUNT(*) AS total_returns FROM store_returns sr JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN call_center cc ON s.s_market_id = cc.cc_mkt_id WHERE sr.sr_return_amt > 0 AND s.s_rec_end_date IN ('1999-03-13', '2000-03-12') AND s.s_floor_space IN (9294113, 5285950, 6995995, 5219562) AND sr.sr_store_sk IN (4, 2, 1, 10, 7) AND cc.cc_country = 'United States' GROUP BY s.s_store_name, s.s_state, cc.cc_name, cc.cc_class ORDER BY total_return_amount DESC, s.s_store_name, cc.cc_name;
SELECT s_state, s_city, ib_lower_bound, ib_upper_bound, AVG(s_number_employees) AS avg_employees, AVG(s_floor_space) AS avg_floor_space, SUM(w_warehouse_sq_ft) AS total_warehouse_sq_ft, COUNT(DISTINCT cp_catalog_page_sk) AS num_catalog_pages, AVG(hd_vehicle_count) AS avg_vehicle_count FROM store JOIN household_demographics ON (s_store_sk = hd_demo_sk) JOIN income_band ON (hd_income_band_sk = ib_income_band_sk) JOIN warehouse ON (s_zip = w_zip) JOIN catalog_page ON (s_market_id = cp_catalog_number) WHERE s_state = 'TN' AND (s_closed_date_sk IN (2450910, 2451189, 2451044) OR s_closed_date_sk IS NULL) AND hd_dep_count IN (2, 3, 4, 5, 8, 9) AND cp_end_date_sk IN (2451087, 2451114, 2450996, 2451664) AND w_warehouse_sq_ft IN (977787, 294242, 621234, 138504) AND w_warehouse_id IN ('AAAAAAAABAAAAAAA', 'AAAAAAAAEAAAAAAA', 'AAAAAAAADAAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAACAAAAAAA') GROUP BY s_state, s_city, ib_lower_bound, ib_upper_bound ORDER BY s_city, ib_lower_bound;
SELECT c.cc_name, c.cc_city, c.cc_state, AVG(c.cc_employees) AS avg_employees, COUNT(DISTINCT c.cc_call_center_id) AS total_call_centers, SUM(hd.hd_vehicle_count) AS total_vehicles, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, COUNT(DISTINCT sm.sm_ship_mode_id) AS total_ship_modes, MAX(cd.cd_credit_rating) AS max_credit_rating FROM call_center c JOIN household_demographics hd ON c.cc_call_center_sk = hd.hd_demo_sk JOIN customer_demographics cd ON hd.hd_demo_sk = cd.cd_demo_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = c.cc_call_center_sk WHERE c.cc_state IN ('TX', 'CA', 'NY') AND cd.cd_purchase_estimate BETWEEN 7000 AND 8000 AND sm.sm_contract IN ('2mM8l', 'yVfotg7Tio3MVhBg6Bkn', 'HVDFCcQ') AND hd.hd_buy_potential IN ('>10000', '5001-10000', '1001-5000', 'Unknown') AND hd.hd_vehicle_count BETWEEN 0 AND 3 GROUP BY c.cc_name, c.cc_city, c.cc_state ORDER BY avg_employees DESC, total_call_centers DESC;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, SUM(cs.cs_net_paid_inc_tax) AS total_revenue, SUM(cs.cs_net_profit) AS total_profit, AVG(cs.cs_net_paid_inc_tax) AS average_revenue_per_sale, COUNT(DISTINCT cs.cs_order_number) AS total_orders, s.s_store_name, s.s_company_name AS store_company_name FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN store s ON s.s_store_sk = cc.cc_call_center_sk WHERE cc.cc_rec_start_date <= CURRENT_DATE AND (cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date > CURRENT_DATE) AND s.s_rec_start_date <= CURRENT_DATE AND (s.s_rec_end_date IS NULL OR s.s_rec_end_date > CURRENT_DATE) AND cs.cs_net_paid_inc_tax > 300 GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, s.s_store_name, s.s_company_name ORDER BY total_revenue DESC, total_profit DESC LIMIT 100;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, MAX(ss.ss_net_paid_inc_tax) AS max_payment_received, MIN(ss.ss_net_paid_inc_tax) AS min_payment_received FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE cc.cc_rec_start_date BETWEEN '1998-01-01' AND '2001-01-01' AND cc.cc_mkt_desc LIKE '%Rich groups catch longer other fears; future,%' GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_quantity_sold DESC, average_sales_price DESC;
SELECT sm.sm_type AS shipping_type, i.i_category AS item_category, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_fee) AS average_fee, SUM(cs.cs_quantity) AS total_sold_quantity, AVG(cs.cs_sales_price) AS average_sales_price, SUM(inv.inv_quantity_on_hand) AS total_inventory_quantity FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN catalog_sales cs ON cr.cr_item_sk = cs.cs_item_sk AND cr.cr_order_number = cs.cs_order_number JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk JOIN customer_demographics cd ON cr.cr_returning_cdemo_sk = cd.cd_demo_sk WHERE i.i_units <> 'N/A' AND i.i_product_name IN ('ablecallybarpri', 'ationeingcallyable', 'callyeingpri', 'barantiableese', 'antioughtn stese') AND cd.cd_dep_count BETWEEN 1 AND 2 GROUP BY sm.sm_type, i.i_category ORDER BY total_return_amount DESC, total_sold_quantity DESC;
SELECT cd.cd_education_status, hd.hd_income_band_sk, COUNT(*) AS total_sales, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_net_profit) AS average_net_profit FROM web_sales ws JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk WHERE cd.cd_marital_status = 'M' AND hd.hd_dep_count >= 2 AND wp.wp_type LIKE 'review%' AND ws.ws_net_profit > 0 GROUP BY cd.cd_education_status, hd.hd_income_band_sk ORDER BY total_net_profit DESC, average_net_profit DESC;
SELECT wp.wp_type, sm.sm_type, COUNT(DISTINCT wr.wr_refunded_customer_sk) AS unique_customers, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amt_inc_tax, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_net_loss) AS total_net_loss FROM web_returns wr JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk JOIN ship_mode sm ON wr.wr_returning_addr_sk = sm.sm_ship_mode_sk WHERE wp.wp_type IN ('feedback', 'order', 'general') AND sm.sm_type = 'TWO DAY' AND wr.wr_returning_addr_sk IN ('28100', '12237', '16942', '45981', '17051', '17924') AND wr.wr_refunded_customer_sk IN ('91486', '46332', '17456', '11868', '724', '87845') GROUP BY wp.wp_type, sm.sm_type;
SELECT dd.d_year AS year, dd.d_moy AS month, dd.d_month_seq AS month_sequence, cp.cp_department AS department, COUNT(cp.cp_catalog_page_sk) AS catalog_page_count, AVG(dd.d_dom) AS average_day_of_month, SUM(CASE WHEN dd.d_weekend = 'Y' THEN 1 ELSE 0 END) AS weekend_days, SUM(CASE WHEN dd.d_holiday = 'Y' THEN 1 ELSE 0 END) AS holiday_days, COUNT(DISTINCT ws.web_site_sk) AS unique_web_sites FROM date_dim dd JOIN catalog_page cp ON dd.d_date_sk BETWEEN cp.cp_start_date_sk AND cp.cp_end_date_sk JOIN web_site ws ON ws.web_open_date_sk <= dd.d_date_sk AND (ws.web_close_date_sk IS NULL OR ws.web_close_date_sk >= dd.d_date_sk) WHERE dd.d_current_month = 'N' AND cp.cp_department = 'DEPARTMENT' AND ws.web_manager IN ('Dwight Aaron', 'Jimmy Pope', 'James Austin', 'Harold Wilson', 'Marshall Conner', 'Charles Castillo') GROUP BY year, month, month_sequence, department ORDER BY year, month_sequence, department;
SELECT ws.web_name, ws.web_manager, i.i_category, i.i_class, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_items, SUM(wr.wr_return_amt) AS total_returned_amount, AVG(wr.wr_return_amt/wr.wr_return_quantity) AS avg_return_amount_per_item, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_net_loss) AS total_net_loss FROM web_returns wr JOIN item i ON wr.wr_item_sk = i.i_item_sk JOIN web_page wp ON wr.wr_web_page_sk = wp.wp_web_page_sk JOIN web_site ws ON wp.wp_web_page_id = ws.web_site_id WHERE ws.web_open_date_sk IN ('2450645', '2450679', '2450781') AND (wr.wr_returning_addr_sk = '7213' OR wr.wr_returning_addr_sk = '17875') GROUP BY ws.web_name, ws.web_manager, i.i_category, i.i_class ORDER BY total_returned_amount DESC, ws.web_name, i.i_category, i.i_class;
SELECT i.i_category AS item_category, s.s_state AS store_state, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales, AVG(ss.ss_net_paid_inc_tax) AS avg_sale_amount, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages, SUM(wp.wp_image_count) AS total_images, AVG(wp.wp_image_count) AS avg_images_per_page FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number LEFT JOIN web_page wp ON ss.ss_customer_sk = wp.wp_customer_sk WHERE s.s_state IN ('CA', 'TX', 'NY') AND i.i_category IN ('Electronics', 'Home Appliances', 'Books') AND ss.ss_sold_date_sk BETWEEN 20020101 AND 20021231 AND (wp.wp_image_count IS NULL OR wp.wp_image_count >= 3) GROUP BY item_category, store_state ORDER BY total_sales DESC, total_return_amount DESC;
SELECT d_year, d_quarter_name, cd_gender, cd_education_status, SUM(ws_net_profit) AS total_net_profit, AVG(ws_quantity) AS avg_quantity_sold, COUNT(DISTINCT ws_order_number) AS total_orders, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT sr_ticket_number) AS total_return_transactions FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN customer_demographics ON ws_bill_cdemo_sk = cd_demo_sk LEFT JOIN store_returns ON sr_customer_sk = ws_bill_customer_sk AND sr_returned_date_sk = ws_sold_date_sk WHERE d_year = 1999 AND cd_dep_employed_count = 0 AND ws_ext_tax IN ('56.09', '24.79', '237.72', '4.60', '438.93', '37.94') AND ws_web_site_sk IN ('15', '25', '16', '12', '19') AND sr_customer_sk IN ('34000', '49632', '58331', '36235') GROUP BY d_year, d_quarter_name, cd_gender, cd_education_status ORDER BY total_net_profit DESC, total_orders DESC;
SELECT p.p_promo_name, COUNT(ss.ss_ticket_number) AS total_sales_transactions, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_ext_discount_amt) AS total_discount_amount, SUM(ss.ss_coupon_amt) AS total_coupon_discount, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_including_tax, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE p.p_discount_active = 'Y' AND ss.ss_sold_date_sk BETWEEN p.p_start_date_sk AND p.p_end_date_sk GROUP BY p.p_promo_name ORDER BY total_net_profit DESC, total_sales_transactions DESC;
SELECT state, item_category, SUM(total_sales_amount) AS total_sales_amount, SUM(total_return_amount) AS total_return_amount, AVG(avg_net_loss_per_return) AS avg_net_loss_per_return FROM ( SELECT web_site.web_state AS state, i.i_category AS item_category, SUM(ws.ws_sales_price) AS total_sales_amount, SUM(wr.wr_return_amt) AS total_return_amount, AVG(wr.wr_net_loss) AS avg_net_loss_per_return FROM web_sales ws INNER JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk INNER JOIN web_site ON ws.ws_web_site_sk = web_site.web_site_sk INNER JOIN item i ON ws.ws_item_sk = i.i_item_sk WHERE web_site.web_state IN ('TN') GROUP BY web_site.web_state, i.i_category UNION ALL SELECT 'Catalog' AS state, i.i_category AS item_category, 0 AS total_sales_amount, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_net_loss) AS avg_net_loss_per_return FROM catalog_returns cr INNER JOIN item i ON cr.cr_item_sk = i.i_item_sk GROUP BY i.i_category ) AS combined_results GROUP BY state, item_category ORDER BY state, item_category;
SELECT ca.ca_state, ib.ib_income_band_sk, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_paid_inc_tax) AS total_sales, AVG(cs.cs_sales_price) AS average_sales_price, SUM(ws.ws_net_paid_inc_tax) AS total_web_sales, AVG(ws.ws_sales_price) AS average_web_sales_price FROM catalog_sales cs JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk JOIN web_sales ws ON cs.cs_order_number = ws.ws_order_number JOIN income_band ib ON (cs.cs_bill_cdemo_sk BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound) WHERE ca.ca_state IN ('CA', 'TX', 'NY', 'FL') AND ib.ib_income_band_sk IN (1, 2, 4, 8, 10) AND cs.cs_sales_price > 0 AND ws.ws_sales_price > 0 GROUP BY ca.ca_state, ib.ib_income_band_sk ORDER BY ca.ca_state, ib.ib_income_band_sk;
SELECT ca_state, r_reason_desc, COUNT(*) AS total_returns, SUM(sr_return_quantity) AS total_returned_quantity, AVG(sr_return_amt_inc_tax) AS average_return_amount_inc_tax, SUM(ss_net_paid_inc_tax) AS total_sales_amount_inc_tax, AVG(ss_quantity) AS average_quantity_sold, SUM(ss_net_profit) AS total_net_profit FROM store_returns JOIN store_sales ON store_returns.sr_item_sk = store_sales.ss_item_sk AND store_returns.sr_ticket_number = store_sales.ss_ticket_number JOIN reason ON store_returns.sr_reason_sk = reason.r_reason_sk JOIN customer_address ON store_returns.sr_addr_sk = customer_address.ca_address_sk GROUP BY ca_state, r_reason_desc ORDER BY ca_state, r_reason_desc;
SELECT ws.web_name, ws.web_manager, cd.cd_gender, cd.cd_credit_rating, SUM(cr.cr_return_amount) AS total_catalog_return_amount, AVG(cr.cr_return_amount) AS avg_catalog_return_amount, COUNT(cr.cr_order_number) AS count_catalog_returns, SUM(wr.wr_return_amt) AS total_web_return_amount, AVG(wr.wr_return_amt) AS avg_web_return_amount, COUNT(wr.wr_order_number) AS count_web_returns FROM web_site ws JOIN web_returns wr ON ws.web_site_sk = wr.wr_web_page_sk JOIN customer_demographics cd ON wr.wr_refunded_cdemo_sk = cd.cd_demo_sk JOIN catalog_returns cr ON cr.cr_catalog_page_sk = ws.web_site_sk AND cr.cr_refunded_cdemo_sk = cd.cd_demo_sk WHERE cd.cd_gender = 'F' AND (cd.cd_credit_rating = 'High Risk' OR cd.cd_credit_rating = 'Low Risk' OR cd.cd_credit_rating = 'Good' OR cd.cd_credit_rating = 'Unknown') AND ws.web_street_number = '828' GROUP BY ws.web_name, ws.web_manager, cd.cd_gender, cd.cd_credit_rating ORDER BY total_catalog_return_amount DESC, total_web_return_amount DESC;
SELECT hd.hd_buy_potential, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_quantity) AS total_quantity_sold, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_incl_tax, COUNT(DISTINCT sr.sr_customer_sk) AS unique_customers_returned FROM store_sales ss LEFT JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk LEFT JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk LEFT JOIN store_returns sr ON ss.ss_customer_sk = sr.sr_customer_sk AND ss.ss_item_sk = sr.sr_item_sk GROUP BY hd.hd_buy_potential ORDER BY total_return_amount_incl_tax DESC;
SELECT dd.d_year, dd.d_quarter_name, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(hd.hd_dep_count) AS avg_dependent_count, COUNT(DISTINCT s.s_store_sk) AS num_stores, AVG(s.s_number_employees) AS avg_store_employees, AVG(s.s_floor_space) AS avg_store_floor_space, SUM(CASE WHEN ca.ca_state = 'CA' THEN 1 ELSE 0 END) AS num_addresses_in_california FROM inventory inv JOIN date_dim dd ON inv.inv_date_sk = dd.d_date_sk JOIN store s ON inv.inv_warehouse_sk = s.s_store_sk JOIN customer_address ca ON s.s_zip = ca.ca_zip JOIN household_demographics hd ON s.s_market_id = hd.hd_income_band_sk WHERE dd.d_year IN (1905, 1913, 1900, 1906, 1910) AND dd.d_current_month = 'N' AND inv.inv_warehouse_sk IN (1, 2) AND hd.hd_income_band_sk IN (20, 11, 4, 17, 7) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT s.s_store_name, ib.hd_income_band_sk, hd.hd_buy_potential, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS transaction_count FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk LEFT JOIN household_demographics ib ON hd.hd_income_band_sk = ib.hd_income_band_sk WHERE hd.hd_income_band_sk = 9 GROUP BY s.s_store_name, ib.hd_income_band_sk, hd.hd_buy_potential ORDER BY total_sales DESC, average_sales_price DESC;
SELECT cc.cc_state, cc.cc_city, cc.cc_name, AVG(ss.ss_net_profit) AS avg_net_profit, SUM(ss.ss_quantity) AS total_quantity_sold, COUNT(DISTINCT ss.ss_store_sk) AS number_of_stores, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(cc.cc_employees) AS total_employees_in_call_centers, AVG(cc.cc_tax_percentage) AS avg_tax_percentage_by_state FROM store_sales ss JOIN call_center cc ON ss.ss_store_sk = cc.cc_call_center_sk JOIN time_dim td ON ss.ss_sold_time_sk = td.t_time_sk WHERE ss.ss_sold_date_sk IN (SELECT inv_date_sk FROM inventory WHERE inv_quantity_on_hand IN (816, 142, 984)) AND cc.cc_tax_percentage IN (0.01, 0.12, 0.05, 0.11) AND ss.ss_net_profit IN (5.76, 45.76, 66.12, -885.72, -4074.40) AND ss.ss_hdemo_sk IN (7132, 594, 6065, 5700) GROUP BY cc.cc_state, cc.cc_city, cc.cc_name ORDER BY avg_net_profit DESC;
SELECT i.i_category, ib.ib_income_band_sk, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_paid_inc_ship_tax) AS total_sales, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cr.cr_return_amount) AS total_returns, COUNT(DISTINCT cr.cr_order_number) AS total_return_orders FROM catalog_sales cs JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN income_band ib ON c.c_current_cdemo_sk = ib.ib_income_band_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number WHERE cs.cs_sold_date_sk IS NOT NULL AND ( ib.ib_lower_bound IN (110001, 190001, 30001) OR ib.ib_income_band_sk IN (1, 9, 3) ) GROUP BY i.i_category, ib.ib_income_band_sk ORDER BY total_sales DESC, total_returns DESC;
SELECT cd.cd_purchase_estimate AS purchase_estimate, ib.ib_lower_bound AS income_band_lower_bound, ib.ib_upper_bound AS income_band_upper_bound, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt) AS total_returned_amount, AVG(wr.wr_return_amt) AS average_return_amount, AVG(wr.wr_fee) AS average_fee, AVG(wr.wr_net_loss) AS average_net_loss FROM web_returns wr INNER JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk INNER JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound WHERE wr.wr_return_quantity > 0 AND cd.cd_purchase_estimate IN (8500, 7000, 1000, 9000, 4500, 5500) AND ib.ib_lower_bound IN (70001, 90001, 180001) GROUP BY cd.cd_purchase_estimate, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_returned_amount DESC;
SELECT cc.cc_name, cc.cc_class, cc.cc_employees, cc.cc_city, COUNT(*) AS num_promotions, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(CASE WHEN cd.cd_marital_status = 'D' THEN 1 ELSE 0 END) AS divorced_customer_count, SUM(CASE WHEN p.p_channel_email = 'N' THEN p.p_cost ELSE 0 END) AS total_promotion_cost_non_email FROM call_center cc JOIN promotion p ON cc.cc_call_center_sk = p.p_item_sk JOIN customer c ON cc.cc_call_center_sk = c.c_current_addr_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk WHERE cc.cc_company = '2' AND cd.cd_dep_college_count = 0 AND p.p_promo_name LIKE '%pri%' OR p.p_promo_name LIKE '%eing%' GROUP BY cc.cc_name, cc.cc_class, cc.cc_employees, cc.cc_city HAVING COUNT(*) > 5 ORDER BY avg_purchase_estimate DESC;
SELECT s.s_store_name, ca.ca_city, cd.cd_marital_status, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(cr.cr_return_quantity) AS total_quantity_returned, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_fee) AS total_return_fees, SUM(cr.cr_store_credit) AS total_store_credit_issued FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk LEFT JOIN catalog_returns cr ON ss.ss_item_sk = cr.cr_item_sk AND ss.ss_ticket_number = cr.cr_order_number WHERE s.s_company_id = '1' AND s.s_number_employees IN ('271', '297', '218') AND cr.cr_fee IN ('1.88', '20.33', '98.78') AND cr.cr_store_credit IN ('209.99', '238.11', '154.49') AND cr.cr_returning_addr_sk IN ('12346', '30572', '1273') AND ca.ca_street_number IN ('667', '111', '746') AND ca.ca_street_type IN ('Street', 'Dr.', 'Way') AND ca.ca_street_name IN ('Maple 5th', 'Walnut Lee', 'Ash Oak') AND ca.ca_city IN ('Fairview', 'Calhoun', 'Sullivan') AND cd.cd_purchase_estimate IN ('8500', '5000', '6500') AND cd.cd_marital_status IN ('U', 'M', 'D') AND ss.ss_hdemo_sk IN ('2140', '4187', '6514') AND ss.ss_ticket_number IN ('3439', '3527', '3698') GROUP BY s.s_store_name, ca.ca_city, cd.cd_marital_status ORDER BY total_quantity_sold DESC, average_sales_price DESC, unique_customers DESC, total_quantity_returned DESC, average_return_amount DESC, total_return_fees DESC, total_store_credit_issued DESC;
SELECT d_year, i_category, s_store_name, s_state, COUNT(DISTINCT c_customer_sk) AS customer_count, SUM(i_current_price) AS total_sales, AVG(i_wholesale_cost) AS average_wholesale_cost, MAX(i_current_price) AS max_item_price, MIN(i_current_price) AS min_item_price FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN item i ON i.i_item_sk = c.c_customer_sk JOIN store s ON s.s_store_sk = c.c_current_addr_sk JOIN date_dim d ON c.c_first_sales_date_sk = d.d_date_sk WHERE i.i_item_sk IN (2285) AND c.c_customer_id IN ('AAAAAAAAHJNAAAAA', 'AAAAAAAAMADFAAAA', 'AAAAAAAAKCPAAAAA', 'AAAAAAAALGEAAAAA') AND s.s_market_desc IN ('Mysterious employe', 'Events develop i') AND s.s_hours = '8AM-12AM' AND d.d_year = 2021 GROUP BY d_year, i_category, s_store_name, s_state ORDER BY total_sales DESC, customer_count DESC;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_state, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, SUM(ws.ws_net_paid) AS total_net_paid, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON ws.ws_bill_addr_sk = ca.ca_address_sk WHERE dd.d_year = 2002 AND ca.ca_country = 'United States' AND ws.ws_net_paid_inc_ship_tax > 1000 GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state ORDER BY dd.d_year, dd.d_quarter_name, ca.ca_state;
SELECT c.c_first_name, c.c_last_name, sum(ss.ss_quantity) as total_items_sold, avg(ss.ss_sales_price) as average_sales_price, sum(ss.ss_net_paid) as total_revenue, sum(ss.ss_net_profit) as total_profit, p.p_promo_name, count(DISTINCT ss.ss_ticket_number) as number_of_sales_transactions FROM store_sales ss JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN inventory i ON ss.ss_item_sk = i.inv_item_sk AND i.inv_date_sk = ss.ss_sold_date_sk WHERE c.c_last_name IN ('Waggoner', 'Hoyt', 'Moffitt', 'Buchanan', 'Orourke') AND i.inv_warehouse_sk IN ('1', '2') AND p.p_channel_catalog = 'N' AND ss.ss_promo_sk IN ('11', '103', '131', '133', '275') GROUP BY c.c_first_name, c.c_last_name, p.p_promo_name ORDER BY total_revenue DESC, c.c_last_name, c.c_first_name;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, AVG(ss.ss_sales_price) AS average_sale_price, SUM(ss.ss_net_paid) AS total_sales, COUNT(ss.ss_ticket_number) AS number_of_sales FROM store_sales ss INNER JOIN call_center cc ON ss.ss_store_sk = cc.cc_call_center_sk GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_sales DESC, average_sale_price DESC LIMIT 10;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, ib.ib_income_band_sk, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid) AS total_net_paid, AVG(ws.ws_net_profit) AS average_net_profit, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ws.ws_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(ws.ws_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax FROM call_center cc JOIN web_sales ws ON cc.cc_call_center_sk = ws.ws_web_site_sk JOIN income_band ib ON ws.ws_bill_cdemo_sk = ib.ib_income_band_sk WHERE cc.cc_rec_end_date > CURRENT_DATE AND ib.ib_lower_bound > 50000 AND ib.ib_upper_bound < 180000 AND ws.ws_list_price BETWEEN 100 AND 200 GROUP BY cc.cc_name, cc.cc_city, cc.cc_state, ib.ib_income_band_sk ORDER BY total_net_paid DESC, cc.cc_state, cc.cc_city;
SELECT dd.d_year, dd.d_qoy, cc.cc_name, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs_net_paid_inc_ship) AS total_net_paid_inc_ship, SUM(cs_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk WHERE cc.cc_name = 'North Midwest' AND dd.d_year = 2003 GROUP BY dd.d_year, dd.d_qoy, cc.cc_name ORDER BY dd.d_year, dd.d_qoy, cc.cc_name;
SELECT s.s_store_name, s.s_division_name, c.cc_name, c.cc_manager, hd.hd_buy_potential, COUNT(sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, AVG(sr.sr_return_quantity) AS avg_return_quantity, SUM(wr.wr_return_amt_inc_tax) AS total_web_return_amount_inc_tax, AVG(wr.wr_return_quantity) AS avg_web_return_quantity, COUNT(DISTINCT cu.c_customer_sk) AS unique_customers_returning, SUM(hd.hd_dep_count) AS total_dependents, AVG(hd.hd_vehicle_count) AS avg_vehicles_per_household FROM store s JOIN store_returns sr ON sr.sr_store_sk = s.s_store_sk JOIN call_center c ON c.cc_mkt_id = s.s_market_id JOIN customer cu ON cu.c_customer_sk = sr.sr_customer_sk JOIN household_demographics hd ON cu.c_current_hdemo_sk = hd.hd_demo_sk JOIN web_returns wr ON wr.wr_returning_customer_sk = cu.c_customer_sk WHERE c.cc_manager IN ('Bob Belcher', 'Felipe Perkins', 'Larry Mccray', 'Mark Hightower') AND hd.hd_buy_potential IN ('501-1000', '>10000', 'Unknown') AND s.s_division_name = 'Unknown' AND wr.wr_returning_hdemo_sk IN (2871, 6633, 6615, 4553) GROUP BY s.s_store_name, s.s_division_name, c.cc_name, c.cc_manager, hd.hd_buy_potential ORDER BY total_return_amount_inc_tax DESC, total_web_return_amount_inc_tax DESC LIMIT 100;
SELECT w.w_warehouse_name, cc.cc_name AS call_center_name, cd.cp_department, sm.sm_type AS ship_mode_type, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_quantity) AS total_quantity_sold, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, SUM(CASE WHEN hd.hd_vehicle_count > 2 THEN ss.ss_net_paid ELSE 0 END) AS net_paid_more_than_2_vehicles, SUM(CASE WHEN cd.cp_type = 'quarterly' THEN ss.ss_net_paid_inc_tax ELSE 0 END) AS net_paid_inc_tax_for_quarterly_pages FROM store_sales ss JOIN warehouse w ON ss.ss_store_sk = w.w_warehouse_sk JOIN call_center cc ON w.w_zip = cc.cc_zip JOIN catalog_page cd ON ss.ss_promo_sk = cd.cp_catalog_page_sk JOIN ship_mode sm ON sm.sm_code = 'AIR' JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk WHERE cc.cc_street_type = 'Boulevard' AND cd.cp_type IN ('quarterly', 'bi-annual') AND w.w_suite_number IN ('Suite 80', 'Suite P') GROUP BY w.w_warehouse_name, cc.cc_name, cd.cp_department, sm.sm_type ORDER BY avg_sales_price DESC, total_quantity_sold DESC, unique_customers DESC, net_paid_more_than_2_vehicles DESC, net_paid_inc_tax_for_quarterly_pages DESC;
SELECT i.i_category, i.i_brand, ca.ca_state, ca.ca_city, SUM(sr.sr_return_amt) AS total_return_amount, AVG(i.i_current_price) AS average_item_price, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(CASE WHEN p.p_promo_sk IS NOT NULL THEN sr.sr_return_quantity ELSE 0 END) AS promo_return_quantity, SUM(CASE WHEN p.p_promo_sk IS NULL THEN sr.sr_return_quantity ELSE 0 END) AS no_promo_return_quantity FROM store_returns sr JOIN item i ON sr.sr_item_sk = i.i_item_sk LEFT JOIN promotion p ON i.i_item_sk = p.p_item_sk JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk WHERE i.i_category_id IN ('4', '2') AND i.i_container <> 'Unknown' GROUP BY i.i_category, i.i_brand, ca.ca_state, ca.ca_city ORDER BY total_return_amount DESC, average_item_price DESC, total_returns DESC;
SELECT s.s_store_name, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, AVG(cd.cd_purchase_estimate) AS average_customer_purchase_estimate, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status FROM store s JOIN web_sales ws ON s.s_store_sk = ws.ws_ship_addr_sk JOIN customer c ON ws.ws_ship_customer_sk = c.c_customer_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk WHERE s.s_company_id = '1' AND cd.cd_marital_status IN ('D', 'M', 'U', 'S', 'W') AND cd.cd_dep_employed_count = 0 AND c.c_current_addr_sk IN (13869, 35082) GROUP BY s.s_store_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY s.s_store_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status;
SELECT sm.sm_type AS shipping_type, sm.sm_code AS shipping_code, sm.sm_carrier AS carrier, COUNT(DISTINCT inv.inv_item_sk) AS unique_items_shipped, SUM(inv.inv_quantity_on_hand) AS total_quantity_on_hand, AVG(wr.wr_return_amt_inc_tax) AS average_return_amount_incl_tax, SUM(wr.wr_fee) AS total_return_fees, SUM(wr.wr_net_loss) AS total_net_loss, COUNT(DISTINCT wr.wr_order_number) AS total_return_orders, td.t_shift AS time_shift, COUNT(DISTINCT td.t_time_sk) AS total_shift_times FROM ship_mode sm JOIN inventory inv ON sm.sm_ship_mode_sk = inv.inv_warehouse_sk LEFT JOIN web_returns wr ON inv.inv_item_sk = wr.wr_item_sk LEFT JOIN time_dim td ON wr.wr_returned_time_sk = td.t_time_sk WHERE td.t_shift = 'third' AND inv.inv_warehouse_sk IN (1, 2) AND inv.inv_item_sk IN (15820, 14284, 6472) AND td.t_time_sk IN ('4753', '787', '4258') GROUP BY sm.sm_type, sm.sm_code, sm.sm_carrier, td.t_shift ORDER BY total_net_loss DESC;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_items, COUNT(DISTINCT cr.cr_returning_customer_sk) AS unique_returning_customers, SUM(case when hd.hd_dep_count IS NOT NULL THEN 1 ELSE 0 END) AS returns_with_dep_count, SUM(case when hd.hd_vehicle_count IS NOT NULL THEN 1 ELSE 0 END) AS returns_with_vehicle_count, COUNT(DISTINCT p.p_promo_sk) AS total_promotions_involved, SUM(p.p_cost) AS total_promotion_cost FROM call_center cc LEFT JOIN catalog_returns cr ON cc.cc_call_center_sk = cr.cr_call_center_sk LEFT JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk LEFT JOIN promotion p ON p.p_item_sk = cr.cr_item_sk WHERE cc.cc_company_name IN ('able', 'ought', 'cally', 'pri') AND cc.cc_hours IN ('8AM-4PM', '8AM-8AM') AND p.p_channel_tv = 'N' AND p.p_purpose = 'Unknown' AND cr.cr_refunded_cash IN ('5415.08', '1.89', '288.51', '2.49', '307.01') GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_return_amount DESC;
SELECT d.d_year, d.d_quarter_name, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(wp.wp_link_count) AS avg_link_count, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS preferred_customers_count, SUM(CASE WHEN d.d_holiday = 'Y' THEN 1 ELSE 0 END) AS holiday_count FROM date_dim d JOIN customer c ON c.c_first_sales_date_sk = d.d_date_sk JOIN inventory inv ON inv.inv_date_sk = d.d_date_sk JOIN web_page wp ON wp.wp_access_date_sk = d.d_date_sk WHERE d.d_year = 2021 GROUP BY d.d_year, d.d_quarter_name ORDER BY d.d_year, d.d_quarter_name;
SELECT hd.hd_income_band_sk, hd.hd_buy_potential, COUNT(DISTINCT hd.hd_demo_sk) AS total_households, AVG(hd.hd_dep_count) AS avg_dependency_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_paid_inc_ship) AS total_net_paid_including_shipping, SUM(cs.cs_net_paid_inc_tax) AS total_net_paid_including_tax, AVG(cs.cs_sales_price) AS avg_sales_price, COUNT(DISTINCT p.p_promo_sk) AS total_promotions_used, SUM(p.p_cost) AS total_promotion_cost FROM household_demographics hd JOIN catalog_sales cs ON hd.hd_demo_sk = cs.cs_bill_hdemo_sk LEFT JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk AND p.p_channel_event = 'N' GROUP BY hd.hd_income_band_sk, hd.hd_buy_potential ORDER BY total_net_paid DESC;
SELECT 'Web' AS return_channel, COUNT(wr_order_number) AS total_returns, SUM(wr_return_quantity) AS total_returned_items, SUM(wr_net_loss) AS total_net_loss, AVG(wr_net_loss) AS avg_net_loss_per_return FROM web_returns UNION ALL SELECT 'Catalog' AS return_channel, COUNT(cr_order_number) AS total_returns, SUM(cr_return_quantity) AS total_returned_items, SUM(cr_net_loss) AS total_net_loss, AVG(cr_net_loss) AS avg_net_loss_per_return FROM catalog_returns UNION ALL SELECT 'Store' AS return_channel, COUNT(sr_ticket_number) AS total_returns, SUM(sr_return_quantity) AS total_returned_items, SUM(sr_net_loss) AS total_net_loss, AVG(sr_net_loss) AS avg_net_loss_per_return FROM store_returns ORDER BY total_net_loss DESC;
SELECT ib_lower_bound, ib_upper_bound, COUNT(DISTINCT ws_bill_customer_sk) AS num_customers, SUM(ws_net_paid) AS total_sales, AVG(ws_quantity) AS avg_quantity_sold, SUM(cr_return_amount) AS total_returns, COUNT(DISTINCT cr_order_number) AS num_returned_orders FROM web_sales JOIN household_demographics ON ws_bill_hdemo_sk = hd_demo_sk JOIN income_band ON hd_income_band_sk = ib_income_band_sk LEFT JOIN catalog_returns ON ws_item_sk = cr_item_sk AND ws_order_number = cr_order_number GROUP BY ib_lower_bound, ib_upper_bound ORDER BY ib_lower_bound;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(cr.cr_order_number) AS total_returns, AVG(cr.cr_return_amount) AS avg_refund_amount, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN customer_demographics cd ON cr.cr_refunded_cdemo_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk AND w.w_street_name IN ('Wilson Elm', 'Ash Laurel', '6th') JOIN time_dim t ON cr.cr_returned_time_sk = t.t_time_sk WHERE t.t_hour BETWEEN 9 AND 17 AND w.w_suite_number IN ('Suite 80', 'Suite 470', 'Suite 0') AND ib.ib_upper_bound IN (130000, 120000, 40000, 200000) GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_net_loss DESC;
SELECT ca.ca_state, c.c_preferred_cust_flag, COUNT(DISTINCT p.p_promo_sk) AS num_promotions, AVG(p.p_cost) AS avg_promo_cost, COUNT(DISTINCT c.c_customer_sk) AS num_customers, SUM(CASE WHEN t.t_shift = 'third' THEN 1 ELSE 0 END) AS num_third_shift_accesses, AVG(wp.wp_link_count) AS avg_web_page_link_count FROM promotion p JOIN customer c ON p.p_item_sk = c.c_current_cdemo_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN web_page wp ON wp.wp_customer_sk = c.c_customer_sk JOIN time_dim t ON t.t_time_sk = wp.wp_access_date_sk WHERE ca.ca_county IN ('Nobles County', 'Otoe County', 'Vilas County', 'Conway County') AND p.p_channel_catalog = 'N' AND t.t_minute IN ('17', '30', '53', '4', '24') AND p.p_channel_details LIKE '%criteria must%' GROUP BY ca.ca_state, c.c_preferred_cust_flag ORDER BY ca.ca_state, c.c_preferred_cust_flag;
SELECT cp.cp_department, COUNT(DISTINCT cp.cp_catalog_page_sk) AS number_of_catalog_pages, AVG(cd.cd_purchase_estimate) AS average_purchase_estimate, SUM(inv.inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT cd.cd_demo_sk) FILTER (WHERE cd.cd_credit_rating = 'High Risk') AS high_risk_customer_count, COUNT(DISTINCT cd.cd_demo_sk) FILTER (WHERE cd.cd_credit_rating = 'Unknown') AS unknown_credit_rating_count, SUM(cd.cd_dep_college_count) AS total_college_dependents FROM catalog_page cp JOIN customer_demographics cd ON cp.cp_catalog_page_sk = cd.cd_demo_sk JOIN inventory inv ON cp.cp_catalog_page_sk = inv.inv_warehouse_sk WHERE cp.cp_department = 'DEPARTMENT' GROUP BY cp.cp_department ORDER BY number_of_catalog_pages DESC;
SELECT w.w_warehouse_name AS warehouse_name, w.w_city AS warehouse_city, w.w_state AS warehouse_state, ib.ib_lower_bound AS income_lower_bound, ib.ib_upper_bound AS income_upper_bound, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_amt) AS avg_return_amount, COUNT(sr.sr_return_amt) AS num_returns, SUM(cr.cr_return_amount) AS total_catalog_return_amount, AVG(cr.cr_return_amount) AS avg_catalog_return_amount, COUNT(cr.cr_return_amount) AS num_catalog_returns FROM store_returns sr JOIN warehouse w ON sr.sr_addr_sk = w.w_warehouse_sk JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN catalog_returns cr ON sr.sr_item_sk = cr.cr_item_sk WHERE w.w_country = 'United States' AND (ib.ib_income_band_sk IN (19, 8, 15) OR sr.sr_customer_sk IN (48071, 49096)) AND sr.sr_refunded_cash IN (53.31, 1261.77, 176.73) AND w.w_warehouse_name IN ('Important issues liv', 'Bad cards must make.', 'Conventional childr', 'Doors canno') GROUP BY w.w_warehouse_name, w.w_city, w.w_state, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_return_amount DESC;
SELECT c.c_first_name, c.c_last_name, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_returns, SUM(cr.cr_return_amount) AS sum_catalog_returns, AVG(cr.cr_return_amount) AS avg_catalog_returns, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, SUM(sr.sr_return_amt) AS sum_store_returns, AVG(sr.sr_return_amt) AS avg_store_returns, COUNT(DISTINCT wr.wr_order_number) AS total_web_returns, SUM(wr.wr_return_amt) AS sum_web_returns, AVG(wr.wr_return_amt) AS avg_web_returns, SUM(cr.cr_return_amount + sr.sr_return_amt + wr.wr_return_amt) AS total_returned_amount, SUM(cr.cr_net_loss + sr.sr_net_loss + wr.wr_net_loss) AS total_net_loss FROM customer c LEFT JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_refunded_customer_sk LEFT JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_refunded_customer_sk WHERE (cr.cr_refunded_addr_sk = 22501 OR sr.sr_customer_sk = 76655 OR wr.wr_returning_addr_sk IN (28032, 35974, 28752, 35185)) AND wr.wr_net_loss IN ('349.19', '1875.35', '119.73', '151.90', '2317.12', '1172.86') AND cr.cr_store_credit IN ('43.17', '27.97', '302.61', '30.81', '19.81', '561.19') AND EXISTS (SELECT 1 FROM web_page wp WHERE wp.wp_type = 'order' AND wp.wp_web_page_sk = wr.wr_web_page_sk) GROUP BY c.c_first_name, c.c_last_name ORDER BY total_returned_amount DESC, total_net_loss DESC;
SELECT cp.cp_department, EXTRACT(YEAR FROM TO_DATE(cp.cp_end_date_sk::varchar, 'YYYYMMDD')) AS year_ended, hd.hd_income_band_sk, COUNT(DISTINCT sr.sr_customer_sk) AS num_customers_returned, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_net_loss) AS average_net_loss, SUM(ss.ss_quantity) AS total_sold_quantity, SUM(ss.ss_net_profit) AS total_net_profit, AVG(c.c_birth_year) AS average_customer_birth_year FROM catalog_page cp JOIN store_returns sr ON cp.cp_catalog_page_sk = sr.sr_reason_sk JOIN store_sales ss ON sr.sr_item_sk = ss.ss_item_sk AND sr.sr_ticket_number = ss.ss_ticket_number JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk WHERE cp.cp_end_date_sk IN ('2451114', '2451084', '2451479') AND hd.hd_dep_count IN (3, 6, 7) AND c.c_birth_month IN (2, 6, 12) GROUP BY cp.cp_department, year_ended, hd.hd_income_band_sk ORDER BY total_net_profit DESC, average_net_loss, num_customers_returned;
SELECT ws.web_site_id, ws.web_class, ws.web_name, COUNT(DISTINCT wr.wr_order_number) AS total_returns, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(wr.wr_refunded_cash) AS total_refunded_cash, SUM(sr.sr_return_quantity) AS store_total_returned_quantity, AVG(sr.sr_return_amt_inc_tax) AS store_avg_return_amount_inc_tax, SUM(sr.sr_refunded_cash) AS store_total_refunded_cash FROM web_site ws JOIN web_page wp ON ws.web_site_sk = wp.wp_web_page_sk JOIN web_returns wr ON wp.wp_web_page_sk = wr.wr_web_page_sk LEFT JOIN store_returns sr ON wr.wr_item_sk = sr.sr_item_sk AND wr.wr_refunded_customer_sk = sr.sr_customer_sk WHERE ws.web_class = 'Unknown' AND ws.web_rec_end_date IN ('2001-08-15', '2000-08-15', '1999-08-16') AND wp.wp_rec_start_date IN ('2000-09-03', '2001-09-03', '1997-09-03') AND wp.wp_link_count IN (7, 11, 19) AND wr.wr_return_amt_inc_tax IN (43.31, 378.40, 532.83) AND wr.wr_refunded_cash IN (2425.04, 1694.98, 8.69) AND sr.sr_customer_sk IN (38344, 71012, 20816) AND sr.sr_cdemo_sk IN (1443482, 746161, 1430182) GROUP BY ws.web_site_id, ws.web_class, ws.web_name ORDER BY total_returns DESC, total_refunded_cash DESC;
SELECT ws.web_name, d.d_year, d.d_quarter_name, i.i_category, SUM(cs_quantity) AS total_quantity_sold, SUM(cs_ext_sales_price) AS total_sales, AVG(cs_sales_price) AS avg_sales_price, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(wr_return_quantity) AS total_returned_quantity, SUM(wr_return_amt) AS total_return_amount, (SUM(cs_ext_sales_price) - SUM(cs_ext_discount_amt)) AS net_sales_after_discounts, (SUM(cs_ext_sales_price) - SUM(wr_return_amt)) AS net_sales_after_returns FROM web_site ws JOIN catalog_sales cs ON ws.web_site_sk = cs.cs_warehouse_sk JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk LEFT JOIN web_returns wr ON cs.cs_order_number = wr.wr_order_number AND cs.cs_item_sk = wr.wr_item_sk WHERE d.d_year = 2001 AND ws.web_zip IN ('35709', '31904') AND i.i_units IN ('Gross', 'Oz') AND d.d_current_day = 'N' GROUP BY ws.web_name, d.d_year, d.d_quarter_name, i.i_category ORDER BY total_sales DESC, net_sales_after_discounts DESC, net_sales_after_returns DESC;
SELECT s.s_store_name, s.s_city, s.s_state, td.t_shift, COUNT(*) AS total_returns, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(CASE WHEN sr.sr_return_amt_inc_tax > 100 THEN 1 ELSE 0 END) AS returns_over_100, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN time_dim td ON sr.sr_return_time_sk = td.t_time_sk JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON sr.sr_cdemo_sk = cd.cd_demo_sk JOIN web_page wp ON sr.sr_store_sk = wp.wp_customer_sk JOIN web_returns wr ON sr.sr_item_sk = wr.wr_item_sk AND sr.sr_ticket_number = wr.wr_order_number WHERE td.t_shift = 'third' AND s.s_gmt_offset = '-5.00' AND ca.ca_address_id IN ('AAAAAAAAGGKAAAAA', 'AAAAAAAANCEAAAAA', 'AAAAAAAAOKGAAAAA') AND (wr.wr_return_amt_inc_tax = '6344.70' OR wr.wr_return_amt_inc_tax = '72.90' OR wr.wr_return_amt_inc_tax = '705.96') GROUP BY s.s_store_name, s.s_city, s.s_state, td.t_shift ORDER BY total_returns DESC, avg_return_amount_inc_tax DESC LIMIT 100;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, AVG(cd.cd_dep_count) AS avg_dependents, AVG(cd.cd_dep_employed_count) AS avg_employed_dependents, AVG(cd.cd_dep_college_count) AS avg_college_dependents, COUNT(DISTINCT sr.sr_customer_sk) AS num_returning_customers, SUM(sr.sr_return_quantity) AS total_returned_quantity, SUM(sr.sr_return_amt) AS total_returned_amount, SUM(sr.sr_return_amt_inc_tax) AS total_returned_amount_inc_tax, AVG(sr.sr_return_amt) AS avg_return_amount, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, MAX(sr.sr_return_amt_inc_tax) AS max_return_amount_inc_tax, MIN(sr.sr_return_amt_inc_tax) AS min_return_amount_inc_tax, td.t_shift, COUNT(DISTINCT wp.wp_web_page_sk) AS num_web_pages, SUM(wp.wp_char_count) AS total_char_count FROM customer_demographics cd JOIN store_returns sr ON cd.cd_demo_sk = sr.sr_cdemo_sk JOIN time_dim td ON sr.sr_return_time_sk = td.t_time_sk LEFT JOIN web_page wp ON cd.cd_demo_sk = wp.wp_customer_sk WHERE cd.cd_gender = 'M' AND sr.sr_return_amt_inc_tax BETWEEN 8.31 AND 5055.81 AND wp.wp_url LIKE 'http://www.foo.com%' AND wp.wp_char_count IN (5676, 3034) GROUP BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, td.t_shift ORDER BY total_returned_amount_inc_tax DESC, avg_dependents DESC LIMIT 100;
SELECT s.s_store_name, p.p_promo_name, i.ib_lower_bound, i.ib_upper_bound, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws.ws_order_number) AS unique_orders, SUM(ws.ws_net_paid_inc_tax) AS total_revenue_inc_tax, SUM(CASE WHEN ws.ws_promo_sk IS NOT NULL THEN ws.ws_quantity ELSE 0 END) AS promo_quantity_sold, SUM(CASE WHEN ws.ws_promo_sk IS NOT NULL THEN ws.ws_sales_price ELSE 0 END) AS promo_sales_revenue FROM web_sales ws JOIN store s ON ws.ws_ship_addr_sk = s.s_store_sk LEFT JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk LEFT JOIN income_band i ON ws.ws_bill_cdemo_sk = i.ib_income_band_sk WHERE s.s_closed_date_sk NOT IN ('2451189', '2450910', '2451044') GROUP BY s.s_store_name, p.p_promo_name, i.ib_lower_bound, i.ib_upper_bound ORDER BY total_revenue_inc_tax DESC, s.s_store_name, p.p_promo_name;
SELECT d_year, sm_type, r_reason_desc, COUNT(*) AS total_returns, SUM(cr_return_amount) AS total_return_amount, AVG(cr_return_amount) AS average_return_amount, SUM(cr_return_quantity) AS total_return_quantity, AVG(cr_return_quantity) AS average_return_quantity FROM catalog_returns JOIN date_dim ON cr_returned_date_sk = d_date_sk JOIN reason ON cr_reason_sk = r_reason_sk JOIN ship_mode ON cr_ship_mode_sk = sm_ship_mode_sk WHERE d_year IN (2020, 2021) AND cr_refunded_hdemo_sk IN ('6319', '1691', '6783', '2583', '2054', '1550') AND cr_refunded_customer_sk IN ('44015', '70912', '7271') GROUP BY d_year, sm_type, r_reason_desc ORDER BY d_year, total_return_amount DESC, total_returns DESC;
SELECT cc.cc_name AS call_center_name, i.i_brand AS item_brand, sum(ws.ws_sales_price) AS total_sales, avg(ws.ws_sales_price) AS average_sales_price, count(ws.ws_order_number) AS total_orders, sum(wr.wr_return_amt) AS total_returns, avg(wr.wr_return_amt) AS average_return_amount, count(DISTINCT wr.wr_order_number) AS total_return_orders, sum(hd.hd_dep_count) AS total_dependents, sum(hd.hd_vehicle_count) AS total_vehicles FROM call_center cc JOIN web_sales ws ON cc.cc_call_center_sk = ws.ws_warehouse_sk JOIN web_returns wr ON ws.ws_item_sk = wr.wr_item_sk AND ws.ws_order_number = wr.wr_order_number JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk WHERE cc.cc_name IN ('North Midwest', 'NY Metro') AND i.i_brand_id IN ('6007005', '10003009', '4001002') AND i.i_wholesale_cost IN (24.96, 1.76, 2.66, 5.22) GROUP BY cc.cc_name, i.i_brand ORDER BY total_sales DESC, total_returns DESC;
SELECT cc.cc_name, cc.cc_employees, cc.cc_tax_percentage, SUM(ss.ss_net_paid_inc_tax) AS total_net_sales, AVG(ss.ss_wholesale_cost) AS avg_wholesale_cost, COUNT(DISTINCT ss.ss_item_sk) AS items_sold_count FROM store_sales ss JOIN call_center cc ON ss.ss_store_sk = cc.cc_call_center_sk WHERE ss.ss_sold_date_sk BETWEEN cc.cc_open_date_sk AND COALESCE(cc.cc_closed_date_sk, (SELECT MAX(ss_sold_date_sk) FROM store_sales)) AND cc.cc_tax_percentage IN (0.01, 0.12, 0.05, 0.11) AND ss.ss_item_sk IN (14150, 11113, 2890) GROUP BY cc.cc_name, cc.cc_employees, cc.cc_tax_percentage ORDER BY total_net_sales DESC, avg_wholesale_cost DESC, items_sold_count DESC;
SELECT ca.ca_state AS customer_state, EXTRACT(YEAR FROM d.d_date) AS year_of_return, COUNT(DISTINCT cr.cr_refunded_customer_sk) AS unique_customers, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_refund_amount, AVG(cr.cr_return_amount) AS average_refund_amount, SUM(cr.cr_return_quantity) AS total_returned_quantity, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk JOIN date_dim d ON cr.cr_returned_date_sk = d.d_date_sk WHERE ca.ca_state IS NOT NULL AND cr.cr_returned_date_sk IS NOT NULL GROUP BY customer_state, year_of_return ORDER BY customer_state, year_of_return;
SELECT web.web_name AS website_name, item.i_category AS product_category, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_net_loss) AS total_net_loss, td.t_shift AS return_shift FROM store_returns sr JOIN item ON sr.sr_item_sk = item.i_item_sk JOIN web_site web ON sr.sr_reason_sk = web.web_site_sk JOIN time_dim td ON sr.sr_return_time_sk = td.t_time_sk WHERE web.web_site_sk IN ('15', '11', '4', '20') AND item.i_current_price IN ('7.20', '1.29', '90.17', '5.18') AND td.t_shift = 'third' AND sr.sr_hdemo_sk = 3371 AND sr.sr_reversed_charge IN ('481.87', '4.35') GROUP BY web.web_name, item.i_category, td.t_shift ORDER BY total_return_amount DESC;
SELECT cp.cp_department, hd.hd_income_band_sk, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_items, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_net_loss) AS total_net_loss, web.web_class, COUNT(DISTINCT web.web_site_sk) AS total_web_sites FROM catalog_page cp JOIN store_returns sr ON cp.cp_catalog_page_sk = sr.sr_item_sk JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk JOIN web_site web ON web.web_company_id = cp.cp_catalog_number WHERE cp.cp_start_date_sk IS NOT NULL AND cp.cp_end_date_sk IS NOT NULL AND sr.sr_returned_date_sk BETWEEN cp.cp_start_date_sk AND cp.cp_end_date_sk AND (sr.sr_reversed_charge = 63.95 OR sr.sr_reversed_charge = 41.39) GROUP BY cp.cp_department, hd.hd_income_band_sk, web.web_class ORDER BY total_returns DESC, total_net_loss DESC;
SELECT w.web_class AS website_category, ca.ca_state AS customer_state, COUNT(ws.ws_order_number) AS total_orders, SUM(ws.ws_net_paid_inc_ship_tax) AS total_sales, AVG(ws.ws_ext_discount_amt) AS avg_discount_amount, AVG(ws.ws_net_profit) AS avg_net_profit FROM web_sales ws JOIN web_site w ON ws.ws_web_site_sk = w.web_site_sk JOIN customer_address ca ON ws.ws_ship_addr_sk = ca.ca_address_sk WHERE ws.ws_net_paid_inc_ship BETWEEN 500 AND 9500 GROUP BY ROLLUP(website_category, customer_state) ORDER BY total_sales DESC, website_category, customer_state;
SELECT w_state, w_city, p_promo_name, p_channel_details, COUNT(ss_ticket_number) AS ticket_count, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, SUM(ss_net_paid) AS total_net_paid, SUM(ss_net_profit) AS total_net_profit FROM store_sales JOIN warehouse ON ss_addr_sk = w_warehouse_sk JOIN promotion ON ss_promo_sk = p_promo_sk JOIN time_dim ON ss_sold_time_sk = t_time_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk WHERE w_country = 'United States' AND t_am_pm = 'PM' AND hd_buy_potential = 'Unknown' AND p_discount_active = 'Y' GROUP BY w_state, w_city, p_promo_name, p_channel_details ORDER BY total_net_profit DESC, total_net_paid DESC LIMIT 10;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, sum(cs.cs_quantity) AS total_quantity_sold, avg(cs.cs_sales_price) AS average_sales_price, sum(cs.cs_net_paid) AS total_net_paid, sum(cs.cs_net_profit) AS total_net_profit, sum(inv.inv_quantity_on_hand) AS total_inventory_quantity, avg(ws.web_tax_percentage) AS average_web_tax_percentage, count(DISTINCT wp.wp_web_page_sk) AS total_web_page_visits, count(DISTINCT wr.wr_order_number) AS total_web_returns, sum(wr.wr_return_amt) AS total_return_amount FROM customer c JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk JOIN inventory inv ON cs.cs_item_sk = inv.inv_item_sk JOIN web_site ws ON ws.web_company_id = c.c_current_addr_sk LEFT JOIN web_page wp ON ws.web_site_sk = wp.wp_customer_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number WHERE inv.inv_item_sk IN ('11134', '7144', '14296') AND inv.inv_warehouse_sk IN ('2', '1') AND cs.cs_catalog_page_sk IN ('2864', '4326', '4631') AND wp.wp_max_ad_count IN ('1', '0', '4') AND ws.web_tax_percentage IN ('0.07', '0.08', '0.01') AND ws.web_mkt_class IN ('Hands look again nice years. Alre', 'Only, temporary services', 'Severe, useful funds lift; just') AND ws.web_suite_number IN ('Suite 30', 'Suite J', 'Suite 460') AND ws.web_manager IN ('Robert Arnold', 'Harold Wilson', 'Jason Silva') AND c.c_customer_sk IN ('3151', '72', '3821') AND c.c_birth_day IN ('20', '2', '10') GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name ORDER BY total_net_profit DESC, total_quantity_sold DESC LIMIT 100;
SELECT r.r_reason_desc, i.i_item_id, i.i_category, p.p_promo_name, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(wr.wr_net_loss) AS total_net_loss, COUNT(*) AS num_of_returns FROM web_returns wr JOIN reason r ON wr.wr_reason_sk = r.r_reason_sk JOIN item i ON wr.wr_item_sk = i.i_item_sk JOIN promotion p ON p.p_item_sk = i.i_item_sk JOIN call_center cc ON cc.cc_call_center_sk = wr.wr_refunded_addr_sk WHERE i.i_current_price > 100.00 AND cc.cc_gmt_offset = -5.00 GROUP BY r.r_reason_desc, i.i_item_id, i.i_category, p.p_promo_name ORDER BY total_net_loss DESC, avg_return_amount_inc_tax DESC;
SELECT cp.cp_department, t.t_shift, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sales_price, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_net_paid_inc_tax) AS total_web_sales_inc_tax FROM catalog_page cp JOIN store_sales ss ON cp.cp_catalog_page_sk = ss.ss_sold_date_sk JOIN web_sales ws ON cp.cp_catalog_page_sk = ws.ws_sold_date_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE cp.cp_end_date_sk IN (2451270, 2451144, 2451361, 2450905, 2450996, 2450994) AND ws.ws_ship_addr_sk IN ('41135', '47817', '1020', '16481') AND ws.ws_net_paid_inc_tax IN (121.18, 8694.75, 8.96, 5623.02, 5896.24) AND ss.ss_quantity IN (3, 63, 59, 95, 61) AND cp.cp_catalog_page_number IN (82, 73) AND t.t_minute IN (29, 57, 42, 24) GROUP BY cp.cp_department, t.t_shift ORDER BY total_quantity_sold DESC, avg_sales_price DESC, total_web_orders DESC, total_web_sales_inc_tax DESC;
SELECT w_state, i_category, i_brand, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_customer_sk) AS unique_customer_count, SUM(ss_net_profit) AS total_net_profit FROM store_sales JOIN item ON ss_item_sk = i_item_sk JOIN inventory ON inv_item_sk = i_item_sk JOIN warehouse ON w_warehouse_sk = inventory.inv_warehouse_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk WHERE (i_rec_start_date BETWEEN '2000-01-01' AND '2002-12-31') AND (inv_date_sk BETWEEN 20010101 AND 20021231) AND (w_street_name IN ('Ash Laurel', '6th', 'Wilson Elm', 'View First')) AND (hd_demo_sk IN (156, 867, 379)) AND (ss_sold_time_sk IN (48439, 35208, 48824, 49199, 58065, 67684)) AND (ss_ext_wholesale_cost IN (2791.40, 1191.68, 2550.20, 1499.76, 3663.96, 2041.47)) GROUP BY w_state, i_category, i_brand ORDER BY total_net_profit DESC, total_quantity_sold DESC LIMIT 100;
SELECT cd.cd_gender, ca.ca_state, AVG(ws.ws_sales_price) AS avg_web_sales, SUM(cr.cr_return_amount) AS total_catalog_returns, COUNT(DISTINCT ws.ws_order_number) AS count_web_orders, COUNT(DISTINCT cr.cr_order_number) AS count_catalog_returns FROM web_sales ws JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN customer_address ca ON ws.ws_bill_addr_sk = ca.ca_address_sk LEFT JOIN catalog_returns cr ON ws.ws_order_number = cr.cr_order_number JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk WHERE d.d_year = 2023 AND ws.ws_net_paid > 0 AND (cr.cr_return_amount IS NULL OR cr.cr_return_amount > 0) GROUP BY cd.cd_gender, ca.ca_state ORDER BY avg_web_sales DESC, total_catalog_returns DESC;
SELECT i.i_category, COUNT(DISTINCT cs.cs_order_number) AS total_catalog_orders, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, AVG(cs.cs_sales_price) AS avg_catalog_sales_price, AVG(ws.ws_sales_price) AS avg_web_sales_price, SUM(cs.cs_net_profit) AS total_catalog_net_profit, SUM(ws.ws_net_profit) AS total_web_net_profit, SUM(CASE WHEN cs.cs_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS promo_catalog_sales, SUM(CASE WHEN ws.ws_promo_sk IS NOT NULL THEN 1 ELSE 0 END) AS promo_web_sales, COUNT(DISTINCT d.d_date_sk) AS days_in_Q4 FROM item i LEFT JOIN catalog_sales cs ON i.i_item_sk = cs.cs_item_sk LEFT JOIN web_sales ws ON i.i_item_sk = ws.ws_item_sk LEFT JOIN date_dim d ON (cs.cs_sold_date_sk = d.d_date_sk OR ws.ws_sold_date_sk = d.d_date_sk) WHERE d.d_quarter_name = 'Q4' GROUP BY i.i_category ORDER BY total_catalog_net_profit DESC, total_web_net_profit DESC;
SELECT ca_state, i_category, sm_type, COUNT(DISTINCT c_customer_sk) AS num_customers, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS avg_sales_price, SUM(ss_net_profit) AS total_net_profit FROM store_sales JOIN customer ON ss_customer_sk = c_customer_sk JOIN item ON ss_item_sk = i_item_sk JOIN ship_mode ON ss_sold_date_sk = sm_ship_mode_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk WHERE ca_gmt_offset IN (-10.00, -6.00, -5.00) AND i_units IN ('Each', 'Dozen', 'Tsp') AND sm_type IN ('REGULAR', 'OVERNIGHT', 'EXPRESS') AND c_first_sales_date_sk IN (2450027, 2449229, 2451727) GROUP BY ca_state, i_category, sm_type ORDER BY total_net_profit DESC, avg_sales_price DESC;
SELECT ssm.sm_code AS shipping_mode, AVG(ws.ws_ext_ship_cost) AS avg_shipping_cost, SUM(ws.ws_net_paid_inc_tax) AS total_net_sales, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, COUNT(DISTINCT ss.ss_ticket_number) AS total_store_sales_transactions, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns_transactions, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_returns_transactions, (SUM(ws.ws_net_paid_inc_tax) - SUM(sr.sr_return_amt_inc_tax) - SUM(cr.cr_return_amt_inc_tax)) AS net_revenue FROM ship_mode AS ssm LEFT JOIN web_sales AS ws ON ssm.sm_ship_mode_sk = ws.ws_ship_mode_sk LEFT JOIN store_sales AS ss ON ws.ws_item_sk = ss.ss_item_sk LEFT JOIN store_returns AS sr ON ss.ss_item_sk = sr.sr_item_sk AND ss.ss_customer_sk = sr.sr_customer_sk LEFT JOIN catalog_returns AS cr ON cr.cr_item_sk = ws.ws_item_sk AND cr.cr_returning_customer_sk = ws.ws_bill_customer_sk GROUP BY ssm.sm_code ORDER BY net_revenue DESC;
SELECT sm.sm_type, sm.sm_code, COUNT(wr.wr_order_number) AS total_returns, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_return_quantity) AS total_returned_quantity, SUM(wr.wr_return_ship_cost) AS total_return_shipping_cost, AVG(hd.hd_dep_count) AS average_dependent_count, AVG(hd.hd_vehicle_count) AS average_vehicle_count, td.t_shift, SUM(CASE WHEN td.t_am_pm = 'AM' THEN 1 ELSE 0 END) AS returns_in_am, SUM(CASE WHEN td.t_am_pm = 'PM' THEN 1 ELSE 0 END) AS returns_in_pm FROM web_returns wr JOIN ship_mode sm ON wr.wr_order_number = sm.sm_ship_mode_sk JOIN household_demographics hd ON wr.wr_returning_hdemo_sk = hd.hd_demo_sk JOIN time_dim td ON wr.wr_returned_time_sk = td.t_time_sk WHERE sm.sm_type IN ('NEXT DAY', 'TWO DAY', 'LIBRARY', 'EXPRESS', 'REGULAR', 'OVERNIGHT') AND sm.sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') AND td.t_second IN ('18', '2', '56', '30') AND wr.wr_return_ship_cost IN ('3700.56', '275.65', '284.48') GROUP BY sm.sm_type, sm.sm_code, td.t_shift ORDER BY total_returns DESC, total_return_shipping_cost DESC;
SELECT dd.d_year as sale_year, dd.d_moy as sale_month, p.p_channel_dmail as promo_dmail, p.p_channel_email as promo_email, p.p_channel_catalog as promo_catalog, p.p_channel_tv as promo_tv, p.p_channel_radio as promo_radio, p.p_channel_press as promo_press, p.p_channel_event as promo_event, p.p_channel_demo as promo_demo, SUM(ws.ws_net_paid) as total_revenue, AVG(ws.ws_ext_discount_amt) as avg_discount_amount, COUNT(DISTINCT ws.ws_order_number) as total_orders FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk GROUP BY dd.d_year, dd.d_moy, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo ORDER BY dd.d_year, dd.d_moy, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo;
SELECT c.c_first_name, c.c_last_name, c.c_email_address, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, COUNT(DISTINCT wr.wr_order_number) AS total_returns, td.t_shift, SUM(wr.wr_fee) AS total_return_fees, SUM(wr.wr_net_loss) AS total_net_loss FROM customer c JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk JOIN inventory inv ON wr.wr_item_sk = inv.inv_item_sk JOIN time_dim td ON wr.wr_returned_time_sk = td.t_time_sk WHERE c.c_email_address IN ('Brandi.Miller@JH5mldviNI7xQKVQj.com', 'Steven.Williams@uxeKdX2slbhOxguR.edu', 'Maryalice.Rivers@4b9MXdByVXI.com') AND c.c_birth_day IN (26, 12, 21) AND inv.inv_quantity_on_hand IN (31, 517, 732) AND inv.inv_date_sk = 2450815 AND inv.inv_item_sk IN (12622, 7663, 9094) AND inv.inv_warehouse_sk IN (2, 1) AND wr.wr_returning_cdemo_sk IN (940737, 1276363, 1374880) AND wr.wr_returned_time_sk IN (69044, 3060, 44094) AND wr.wr_reversed_charge IN (22.11, 1530.12, 160.93) AND wr.wr_reason_sk IN (1, 8, 25) GROUP BY c.c_first_name, c.c_last_name, c.c_email_address, td.t_shift ORDER BY total_inventory DESC, avg_return_amount_inc_tax DESC, total_returns DESC;
SELECT d_year, i_category, SUM(ws_net_paid_inc_tax) AS total_sales, AVG(ws_quantity) AS average_quantity, COUNT(DISTINCT ws_bill_customer_sk) AS unique_customers, SUM(cr_net_loss) AS total_returns_loss, COUNT(DISTINCT cr_returned_date_sk) AS return_days FROM web_sales JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN item ON ws_item_sk = i_item_sk LEFT JOIN catalog_returns ON ws_item_sk = cr_item_sk AND ws_order_number = cr_order_number WHERE d_year = 2002 AND ws_net_paid_inc_tax > 0 AND d_current_year = 'N' GROUP BY d_year, i_category ORDER BY total_sales DESC;
SELECT i.i_category AS item_category, s.s_division_name AS store_division, AVG(i.i_current_price) AS avg_current_price, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages FROM item i JOIN store s ON i.i_manufact_id = s.s_store_sk LEFT JOIN catalog_page cp ON cp.cp_department = s.s_division_name GROUP BY item_category, store_division ORDER BY item_category, store_division;
SELECT dd.d_year, ca.ca_country, ca.ca_state, sm.sm_type, COUNT(DISTINCT hd.hd_demo_sk) AS number_of_households, AVG(hd.hd_vehicle_count) AS avg_vehicles_per_household, SUM(inv.inv_quantity_on_hand) AS total_inventory_on_hand FROM inventory inv JOIN date_dim dd ON inv.inv_date_sk = dd.d_date_sk JOIN customer_address ca ON inv.inv_warehouse_sk = ca.ca_address_sk JOIN household_demographics hd ON ca.ca_address_sk = hd.hd_demo_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = inv.inv_warehouse_sk WHERE dd.d_current_month = 'N' AND hd.hd_vehicle_count IN (0, 3) GROUP BY dd.d_year, ca.ca_country, ca.ca_state, sm.sm_type ORDER BY total_inventory_on_hand DESC, avg_vehicles_per_household DESC;
SELECT dd.d_year, dd.d_quarter_name, SUM(cs.cs_quantity) AS total_catalog_quantity, AVG(cs.cs_sales_price) AS average_catalog_sales_price, SUM(cs.cs_net_profit) AS total_catalog_net_profit, SUM(ws.ws_quantity) AS total_web_quantity, AVG(ws.ws_sales_price) AS average_web_sales_price, SUM(ws.ws_net_profit) AS total_web_net_profit, SUM(cs.cs_quantity) + SUM(ws.ws_quantity) AS total_combined_quantity, AVG(cs.cs_sales_price * cs.cs_quantity + ws.ws_sales_price * ws.ws_quantity) / AVG(cs.cs_quantity + ws.ws_quantity) AS average_combined_sales_price, SUM(cs.cs_net_profit) + SUM(ws.ws_net_profit) AS total_combined_net_profit FROM date_dim dd LEFT JOIN catalog_sales cs ON dd.d_date_sk = cs.cs_sold_date_sk LEFT JOIN web_sales ws ON dd.d_date_sk = ws.ws_sold_date_sk WHERE dd.d_year = 2001 AND dd.d_current_quarter = 'N' GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT cc.cc_name, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_net_paid) AS total_net_paid, AVG(cs.cs_net_paid) AS avg_net_paid_per_order, SUM(cs.cs_net_profit) AS total_net_profit, AVG(cs.cs_net_profit) AS avg_net_profit_per_order, p.p_promo_name, COUNT(DISTINCT p.p_promo_sk) FILTER (WHERE cs.cs_promo_sk IS NOT NULL) AS promo_count, cd.cd_gender, COUNT(DISTINCT cd.cd_demo_sk) FILTER (WHERE cd.cd_gender = 'M') AS male_customers, COUNT(DISTINCT cd.cd_demo_sk) FILTER (WHERE cd.cd_gender = 'F') AS female_customers FROM call_center cc LEFT JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk LEFT JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk LEFT JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk GROUP BY cc.cc_name, p.p_promo_name, cd.cd_gender ORDER BY total_net_paid DESC, total_net_profit DESC;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_net_paid) AS total_sales_amount, AVG(cs.cs_sales_price) AS average_sales_amount_per_order, MAX(cs.cs_sales_price) AS max_sale_amount, AVG(cs.cs_ext_discount_amt) AS average_discount_amount, SUM(cs.cs_ext_tax) AS total_tax_collected, COUNT(DISTINCT cs.cs_bill_customer_sk) AS unique_customers FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk WHERE d.d_date BETWEEN '2023-01-01'::DATE AND '2023-12-31'::DATE AND cs.cs_list_price > 100 GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_sales_amount DESC, average_sales_amount_per_order DESC;
SELECT dd.d_year, dd.d_quarter_name, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, COUNT(DISTINCT cc.cc_call_center_sk) AS participating_call_centers, SUM(ss.ss_net_paid_inc_tax) AS total_revenue_including_tax, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN call_center cc ON cc.cc_mkt_id::integer = ss.ss_store_sk JOIN catalog_page cp ON ss.ss_sold_date_sk BETWEEN cp.cp_start_date_sk AND cp.cp_end_date_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk WHERE dd.d_year = 2001 AND cc.cc_class = 'small' AND cd.cd_credit_rating = 'Good' AND (cp.cp_type = 'monthly' OR cp.cp_type = 'bi-annual') AND (cc.cc_street_type = 'Way' OR cc.cc_street_type = 'RD' OR cc.cc_street_type = 'Boulevard') AND c.c_last_review_date_sk IN ('2452332', '2452464', '2452647', '2452396', '2452311') AND cd.cd_demo_sk IN ('20368', '16978', '19750', '17504') GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT s_state, EXTRACT(YEAR FROM s_rec_start_date) AS year_started, COUNT(DISTINCT s_store_sk) AS number_of_stores, SUM(s_number_employees) AS total_employees, SUM(s_floor_space) AS total_floor_space, AVG(s_tax_precentage) AS avg_tax_percentage, SUM(inv_quantity_on_hand) AS total_inventory, AVG(hd_dep_count) AS avg_dependents, AVG(hd_vehicle_count) AS avg_vehicles, COUNT(DISTINCT p_promo_sk) AS num_promotions, SUM(CASE WHEN p_channel_email = 'Y' THEN p_cost ELSE 0 END) AS email_promotion_cost, SUM(CASE WHEN p_channel_tv = 'Y' THEN p_cost ELSE 0 END) AS tv_promotion_cost, SUM(CASE WHEN p_discount_active = 'Y' THEN 1 ELSE 0 END) AS active_discounts, COUNT(DISTINCT wp_web_page_sk) AS webpage_count, SUM(wp_link_count) AS total_links FROM store LEFT JOIN inventory ON s_store_sk = inv_warehouse_sk AND inv_date_sk = 2450815 LEFT JOIN household_demographics ON s_market_id = hd_income_band_sk LEFT JOIN promotion ON s_store_sk = p_item_sk LEFT JOIN web_page ON wp_access_date_sk = inv_date_sk GROUP BY s_state, year_started ORDER BY s_state, year_started;
SELECT c.c_customer_id, i.i_category, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(ss.ss_quantity) AS total_sales_quantity, SUM(ss.ss_net_paid) AS total_sales_net_paid, AVG(ss.ss_sales_price) AS avg_sales_price, (SUM(ss.ss_net_paid) - SUM(cr.cr_net_loss)) AS net_profit_after_returns FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN customer c ON cr.cr_returning_customer_sk = c.c_customer_sk JOIN store_sales ss ON i.i_item_sk = ss.ss_item_sk AND c.c_customer_sk = ss.ss_customer_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk WHERE ss.ss_hdemo_sk IN (863, 2132, 2496) GROUP BY c.c_customer_id, i.i_category ORDER BY net_profit_after_returns DESC, total_sales_net_paid DESC;
SELECT d_year, d_month_seq, COUNT(wp_web_page_sk) AS total_web_pages, AVG(wp_char_count) AS avg_char_count, SUM(wp_link_count) AS total_links, AVG(wp_image_count) AS avg_image_count, MAX(wp_max_ad_count) AS max_ad_count FROM web_page JOIN date_dim ON wp_access_date_sk = d_date_sk GROUP BY d_year, d_month_seq ORDER BY d_year, d_month_seq;
SELECT c.cc_class, c.cc_city, AVG(c.cc_employees) AS avg_employees, AVG(c.cc_sq_ft) AS avg_sq_ft, AVG(c.cc_tax_percentage) AS avg_tax_percentage, i.i_class, i.i_category, AVG(i.i_current_price) AS avg_current_price, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, COUNT(DISTINCT s.s_store_sk) AS total_stores, AVG(s.s_floor_space) AS avg_floor_space FROM call_center c JOIN item i ON c.cc_class = i.i_class JOIN store s ON c.cc_city = s.s_city WHERE c.cc_open_date_sk IS NOT NULL AND c.cc_rec_start_date <= CURRENT_DATE AND (c.cc_rec_end_date IS NULL OR c.cc_rec_end_date > CURRENT_DATE) AND i.i_rec_start_date <= CURRENT_DATE AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date > CURRENT_DATE) AND s.s_rec_start_date <= CURRENT_DATE AND (s.s_rec_end_date IS NULL OR s.s_rec_end_date > CURRENT_DATE) GROUP BY c.cc_class, c.cc_city, i.i_class, i.i_category ORDER BY avg_employees DESC, avg_current_price DESC;
SELECT ws.ws_web_site_sk, ws.ws_web_page_sk, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, w.w_warehouse_name, w.w_county, cd.cd_gender, cd.cd_education_status, cd.cd_credit_rating, COUNT(DISTINCT cd.cd_demo_sk) AS unique_customers FROM web_sales ws JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk WHERE ws.ws_web_page_sk IN ('8', '48', '14', '26', '5') AND w.w_street_name IN ('Ash Laurel', '6th', 'Wilson Elm', 'View First') AND w.w_county = 'Williamson County' AND cd.cd_credit_rating IN ('High Risk', 'Low Risk', 'Good', 'Unknown') GROUP BY ws.ws_web_site_sk, ws.ws_web_page_sk, w.w_warehouse_name, w.w_county, cd.cd_gender, cd.cd_education_status, cd.cd_credit_rating ORDER BY total_net_profit DESC, total_net_paid DESC;
SELECT dd.d_year AS year, dd.d_month_seq AS month, p.p_channel_dmail AS channel_direct_mail, p.p_channel_email AS channel_email, p.p_channel_catalog AS channel_catalog, p.p_channel_tv AS channel_tv, p.p_channel_radio AS channel_radio, p.p_channel_press AS channel_press, p.p_channel_event AS channel_event, p.p_channel_demo AS channel_demo, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_ext_sales_price) AS total_sales_revenue, SUM(ss.ss_ext_discount_amt) AS total_discount_amount, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_profit) AS total_net_profit FROM promotion p JOIN store_sales ss ON p.p_promo_sk = ss.ss_promo_sk JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk WHERE p.p_cost > 1000.00 AND ss.ss_sales_price > 50.00 GROUP BY dd.d_year, dd.d_month_seq, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo ORDER BY dd.d_year DESC, dd.d_month_seq, total_sales_revenue DESC;
SELECT item.i_product_name, promotion.p_promo_name, call_center.cc_name, COUNT(DISTINCT catalog_sales.cs_item_sk) AS item_sold_count, SUM(catalog_sales.cs_net_paid) AS total_sales, AVG(catalog_sales.cs_ext_discount_amt / NULLIF(catalog_sales.cs_quantity, 0)) AS average_discount_per_item, SUM(catalog_sales.cs_quantity) AS total_units_sold, promotion.p_channel_dmail, promotion.p_channel_email, promotion.p_channel_catalog, promotion.p_channel_tv, promotion.p_channel_radio, promotion.p_channel_press, promotion.p_channel_event, promotion.p_channel_demo FROM catalog_sales INNER JOIN item ON catalog_sales.cs_item_sk = item.i_item_sk INNER JOIN promotion ON catalog_sales.cs_promo_sk = promotion.p_promo_sk INNER JOIN call_center ON catalog_sales.cs_call_center_sk = call_center.cc_call_center_sk WHERE item.i_product_name IN ('barationbarought', 'ableoughtoughtese', 'ablebarn stpri', 'prioughteingable', 'priationanti') AND promotion.p_promo_sk IN (169, 149, 296, 99) AND call_center.cc_call_center_id IN ('AAAAAAAAEAAAAAAA', 'AAAAAAAABAAAAAAA', 'AAAAAAAACAAAAAAA') AND catalog_sales.cs_sold_date_sk IS NOT NULL AND catalog_sales.cs_sold_date_sk BETWEEN 20000101 AND 20001231 GROUP BY item.i_product_name, promotion.p_promo_name, call_center.cc_name, promotion.p_channel_dmail, promotion.p_channel_email, promotion.p_channel_catalog, promotion.p_channel_tv, promotion.p_channel_radio, promotion.p_channel_press, promotion.p_channel_event, promotion.p_channel_demo ORDER BY total_sales DESC, item_sold_count DESC, average_discount_per_item DESC;
SELECT i.i_category, i.i_brand, COUNT(DISTINCT ss.ss_ticket_number) AS num_sales, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss.ss_net_profit) AS total_net_profit, hd.hd_dep_count AS avg_dep_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, AVG(ib.ib_lower_bound) AS avg_income_lower_bound, AVG(ib.ib_upper_bound) AS avg_income_upper_bound FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk JOIN warehouse w ON ss.ss_addr_sk = w.w_warehouse_sk WHERE i.i_rec_start_date <= '2023-01-01' AND (i.i_rec_end_date IS NULL OR i.i_rec_end_date > '2023-01-01') AND t.t_second IN ('17', '49', '15', '2', '36') AND c.c_last_name IN ('Wing', 'Lemus', 'Guerra') AND w.w_warehouse_sq_ft IN (621234, 294242, 977787, 138504) GROUP BY i.i_category, i.i_brand, hd.hd_dep_count ORDER BY total_net_profit DESC, total_net_paid DESC, i.i_category, i.i_brand;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_country, ca.ca_state, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(DISTINCT web.web_site_sk) AS distinct_websites, COUNT(DISTINCT wp.wp_web_page_sk) AS distinct_web_pages FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk JOIN web_page wp ON wp.wp_customer_sk = ss.ss_customer_sk JOIN web_site web ON web.web_company_id = wp.wp_web_page_sk WHERE dd.d_year = 1998 AND ca.ca_country = 'United States' AND ca.ca_state IN ('NY', 'CA', 'TX') AND web.web_company_id IN ('6', '3', '5') AND wp.wp_autogen_flag = 'N' GROUP BY ROLLUP (dd.d_year, dd.d_quarter_name, ca.ca_country, ca.ca_state) ORDER BY dd.d_year, dd.d_quarter_name, ca.ca_country, ca.ca_state;
SELECT i.i_category, AVG(ss.ss_quantity) AS avg_quantity_sold, AVG(ss.ss_sales_price) AS avg_sales_price, AVG(ss.ss_ext_discount_amt) AS avg_discount_amount, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_tickets, COUNT(DISTINCT hd.hd_demo_sk) AS total_high_income_household FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE ib.ib_lower_bound > ( SELECT AVG(ib_inner.ib_lower_bound) FROM income_band ib_inner ) AND ss.ss_net_paid > 2000 AND hd.hd_vehicle_count BETWEEN 2 AND 4 GROUP BY ROLLUP(i.i_category) ORDER BY i.i_category, avg_sales_price DESC;
SELECT sm.sm_type AS shipping_mode, COUNT(DISTINCT sr.sr_ticket_number) AS total_returns, AVG(sr.sr_return_quantity) AS average_returned_quantity, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(CASE WHEN p.p_discount_active = 'Y' THEN 1 ELSE 0 END) AS promotions_with_discount, AVG(p.p_cost) AS average_promotion_cost, COUNT(DISTINCT p.p_promo_sk) AS number_of_promotions_used FROM store_returns sr JOIN promotion p ON sr.sr_item_sk = p.p_item_sk JOIN ship_mode sm ON sm.sm_type IN ('TWO DAY', 'OVERNIGHT', 'EXPRESS') JOIN time_dim t ON sr.sr_return_time_sk = t.t_time_sk WHERE sr.sr_addr_sk::text IN ('38052', '30541', '12047', '37071', '23460', '3442') AND t.t_second::text IN ('51', '12', '16', '37', '57') GROUP BY sm.sm_type ORDER BY total_return_amount DESC;
SELECT d_year, d_quarter_name, COUNT(DISTINCT ss_store_sk) AS num_stores, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_net_sales, AVG(ss_net_profit) AS average_net_profit_per_sale, SUM(wr_return_quantity) AS total_quantity_returned, SUM(wr_net_loss) AS total_net_loss_from_returns, SUM(CASE WHEN hd_vehicle_count = 1 THEN ss_quantity ELSE 0 END) AS quantity_sold_to_1_vehicle_households, AVG(ib_upper_bound) AS average_income_upper_bound, COUNT(DISTINCT r_reason_sk) AS num_unique_return_reasons FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN web_returns ON ss_item_sk = wr_item_sk AND ss_ticket_number = wr_order_number JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN income_band ON hd_income_band_sk = ib_income_band_sk JOIN reason ON wr_reason_sk = r_reason_sk WHERE d_moy IN ('5', '1', '8') AND d_quarter_seq IN ('2', '1', '23') AND ss_sold_time_sk IN ('39484', '37900', '53685') AND ss_cdemo_sk IN ('933209', '1833335', '684959') AND ss_promo_sk IN ('42', '2', '164') AND ss_ext_list_price IN ('528.86', '6921.13', '4979.70') GROUP BY d_year, d_quarter_name ORDER BY d_year, d_quarter_name;
SELECT cc.cc_company_name, r.r_reason_desc, COUNT(wr.wr_returned_date_sk) AS total_returns, SUM(wr.wr_return_amt_inc_tax) AS total_refund_amount, AVG(wr.wr_return_amt_inc_tax) AS average_refund_amount FROM web_returns wr JOIN call_center cc ON wr.wr_refunded_customer_sk::text LIKE '%' || cc.cc_call_center_id JOIN reason r ON wr.wr_reason_sk = r.r_reason_sk JOIN household_demographics hd ON wr.wr_refunded_hdemo_sk = hd.hd_demo_sk WHERE cc.cc_company_name IN ('able', 'pri', 'cally', 'ought') AND hd.hd_dep_count = 0 AND hd.hd_income_band_sk IN (17, 20, 13, 15, 2, 1) AND r.r_reason_desc IN ('Not working any more', 'duplicate purchase', 'reason 28', 'Stopped working', 'reason 24', 'reason 27') GROUP BY cc.cc_company_name, r.r_reason_desc ORDER BY total_refund_amount DESC;
SELECT s.s_store_name, cc.cc_name, COUNT(sr.sr_ticket_number) AS num_returns, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_quantity) AS avg_return_quantity, SUM(p.p_cost) AS total_promo_cost, wp.wp_type, COUNT(DISTINCT wp.wp_web_page_sk) AS num_web_page_visits FROM store s JOIN store_returns sr ON s.s_store_sk = sr.sr_store_sk JOIN call_center cc ON cc.cc_division = s.s_division_id JOIN promotion p ON sr.sr_reason_sk = p.p_promo_sk JOIN web_page wp ON wp.wp_creation_date_sk = sr.sr_returned_date_sk WHERE s.s_county = 'Williamson County' AND s.s_geography_class = 'Unknown' AND cc.cc_gmt_offset = '-5.00' AND cc.cc_suite_number IN ('Suite 70', 'Suite 0', 'Suite U') GROUP BY s.s_store_name, cc.cc_name, wp.wp_type ORDER BY total_return_amount DESC, num_returns DESC, s.s_store_name;
SELECT w_state, i_category, SUM(i_current_price * inv_quantity_on_hand) AS total_value, AVG(i_current_price) AS average_price, COUNT(DISTINCT i_item_sk) AS unique_items_count, COUNT(DISTINCT w_warehouse_sk) AS warehouses_count FROM inventory INNER JOIN item ON inventory.inv_item_sk = item.i_item_sk INNER JOIN warehouse ON inventory.inv_warehouse_sk = warehouse.w_warehouse_sk GROUP BY w_state, i_category ORDER BY total_value DESC, average_price DESC;
SELECT cp.cp_department, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages, COUNT(DISTINCT sm.sm_ship_mode_sk) AS num_ship_modes, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, SUM(CASE WHEN p.p_channel_event = 'N' THEN p.p_cost ELSE 0 END) AS total_promo_cost_no_event, COUNT(DISTINCT r.r_reason_sk) AS num_reasons, MAX(t.t_time) AS max_time FROM catalog_page cp JOIN promotion p ON cp.cp_catalog_page_sk = p.p_item_sk LEFT JOIN ship_mode sm ON sm.sm_code = cp.cp_type LEFT JOIN reason r ON r.r_reason_desc = cp.cp_description LEFT JOIN household_demographics hd ON hd.hd_income_band_sk = cp.cp_catalog_number LEFT JOIN time_dim t ON t.t_time_sk = cp.cp_start_date_sk WHERE cp.cp_end_date_sk IN (2451817, 2450905, 2450904) AND cp.cp_department = 'DEPARTMENT' AND p.p_promo_sk IN (205, 11, 114) AND p.p_cost >= 1000.00 AND p.p_purpose = 'Unknown' AND p.p_channel_event = 'N' AND r.r_reason_desc IN ('Wrong size', 'duplicate purchase', 'reason 31') AND r.r_reason_sk IN (19, 14, 6) AND r.r_reason_id IN ('AAAAAAAAHBAAAAAA', 'AAAAAAAAPBAAAAAA', 'AAAAAAAAMAAAAAAA') AND hd.hd_vehicle_count IN (1, 4, 3) AND hd.hd_dep_count IN (0, 3, 7) AND t.t_time IN (325, 4624, 1921) AND t.t_time_id IN ('AAAAAAAANDCBAAAA', 'AAAAAAAAILGAAAAA', 'AAAAAAAAACNAAAAA') AND sm.sm_code IN ('SEA', 'AIR', 'BIKE') AND sm.sm_contract IN ('P7FBIt8yd', 'O9V6oF8RJnLMmZYd1', 'Ek') AND sm.sm_ship_mode_id IN ('AAAAAAAADBAAAAAA', 'AAAAAAAAIAAAAAAA', 'AAAAAAAAEAAAAAAA') GROUP BY cp.cp_department ORDER BY num_catalog_pages DESC, total_promo_cost_no_event DESC;
SELECT ca_state, p_promo_name, COUNT(*) AS num_sales, SUM(ws_quantity) AS total_quantity_sold, AVG(ws_sales_price) AS average_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_profit) AS total_net_profit FROM web_sales JOIN customer_address ON ws_ship_addr_sk = ca_address_sk JOIN promotion ON ws_promo_sk = p_promo_sk JOIN store ON ws_bill_addr_sk = store.s_store_sk WHERE ca_zip IN ('70913', '28482', '63511', '34098') AND ws_web_site_sk IN (6, 4, 29, 10, 1) AND ws_ship_customer_sk IN (7473, 54186, 56351, 1807) AND s_suite_number IN ('Suite D', 'Suite 260', 'Suite 190', 'Suite C', 'Suite 100') GROUP BY ca_state, p_promo_name ORDER BY total_net_profit DESC, ca_state, p_promo_name;
SELECT p.p_promo_name, sm.sm_type AS shipping_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_net_paid) AS average_sales_per_order, SUM(cs.cs_net_profit) AS total_profit, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_quantity) AS total_web_quantity, SUM(ws.ws_net_paid) AS total_web_sales, AVG(ws.ws_net_paid) AS average_web_sales_per_order, SUM(ws.ws_net_profit) AS total_web_profit FROM promotion p LEFT JOIN catalog_sales cs ON p.p_promo_sk = cs.cs_promo_sk LEFT JOIN web_sales ws ON p.p_promo_sk = ws.ws_promo_sk LEFT JOIN ship_mode sm ON (cs.cs_ship_mode_sk = sm.sm_ship_mode_sk OR ws.ws_ship_mode_sk = sm.sm_ship_mode_sk) WHERE p.p_start_date_sk IN ('2450688', '2450248', '2450699', '2450857', '2450196', '2450745') AND (sm.sm_type IN ('EXPRESS', 'OVERNIGHT', 'TWO DAY', 'NEXT DAY') OR sm.sm_type IS NULL) AND (cs.cs_ship_customer_sk IN ('65147', '83434', '5487', '82518') OR ws.ws_ship_customer_sk IN ('65147', '83434', '5487', '82518')) AND p.p_channel_tv = 'N' GROUP BY p.p_promo_name, sm.sm_type ORDER BY total_sales DESC, total_web_sales DESC;
SELECT sm.sm_type, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_quantity) AS total_web_quantity_sold, AVG(ws.ws_sales_price) AS avg_web_sales_price, SUM(cr.cr_return_quantity) AS total_return_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(DISTINCT cr.cr_order_number) AS total_returns FROM web_sales ws JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk LEFT JOIN catalog_returns cr ON ws.ws_order_number = cr.cr_order_number AND ws.ws_item_sk = cr.cr_item_sk WHERE sm.sm_type IN ('EXPRESS', 'OVERNIGHT', 'NEXT DAY') GROUP BY sm.sm_type, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status ORDER BY sm.sm_type, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status;
SELECT s.s_store_name, cp.cp_department, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(ss.ss_net_profit) AS total_net_profit, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN cs.cs_quantity ELSE 0 END) AS preferred_customer_quantity_sold, AVG(hd.hd_dep_count) AS average_household_dependency_count, AVG(hd.hd_vehicle_count) AS average_household_vehicle_count FROM store s JOIN store_sales ss ON ss.ss_store_sk = s.s_store_sk JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN catalog_sales cs ON cs.cs_ship_customer_sk = c.c_customer_sk JOIN catalog_page cp ON cp.cp_catalog_page_sk = cs.cs_catalog_page_sk WHERE s.s_rec_end_date IS NULL AND ss.ss_sales_price BETWEEN 11.33 AND 139.32 AND ss.ss_quantity IN (11, 33) AND cs.cs_bill_addr_sk IN (20241, 24240, 324) GROUP BY s.s_store_name, cp.cp_department ORDER BY total_net_profit DESC, total_orders DESC LIMIT 10;
SELECT dd.d_year AS return_year, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, r.r_reason_desc AS most_common_reason, MAX(reason_count) AS reason_count FROM catalog_returns cr JOIN date_dim dd ON cr.cr_returned_date_sk = dd.d_date_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk LEFT JOIN (SELECT cr_reason_sk, COUNT(*) AS reason_count FROM catalog_returns GROUP BY cr_reason_sk) AS rc ON rc.cr_reason_sk = cr.cr_reason_sk WHERE dd.d_weekend = 'N' AND dd.d_holiday = 'N' GROUP BY return_year, r.r_reason_desc ORDER BY return_year DESC, reason_count DESC;
SELECT cp.cp_department, ws_site.web_name, COUNT(DISTINCT cs.cs_order_number) AS total_catalog_orders, SUM(cs.cs_net_paid) AS total_catalog_sales, AVG(cs.cs_net_paid) AS avg_catalog_sales, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_net_paid) AS total_web_sales, AVG(ws.ws_net_paid) AS avg_web_sales, SUM(hd.hd_dep_count) AS total_dep_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, COUNT(DISTINCT c.c_customer_sk) AS unique_customers FROM catalog_page cp JOIN catalog_sales cs ON cs.cs_catalog_page_sk = cp.cp_catalog_page_sk JOIN web_sales ws ON ws.ws_bill_customer_sk = cs.cs_bill_customer_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk LEFT JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN web_site ws_site ON ws.ws_web_site_sk = ws_site.web_site_sk WHERE cp.cp_end_date_sk = 2450905 AND cs.cs_net_paid BETWEEN 212.28 AND 1048.16 GROUP BY cp.cp_department, ws_site.web_name ORDER BY total_catalog_sales DESC, total_web_sales DESC LIMIT 100;
SELECT s.s_state, w.w_country, p.p_promo_name, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ss.ss_net_profit) AS total_net_profit FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN warehouse w ON s.s_state = w.w_state LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk AND p.p_channel_catalog = 'N' GROUP BY s.s_state, w.w_country, p.p_promo_name ORDER BY s.s_state, w.w_country, p.p_promo_name;
SELECT ib.ib_income_band_sk, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_profit, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages, cp.cp_department FROM store_sales ss JOIN income_band ib ON ss.ss_hdemo_sk = ib.ib_income_band_sk JOIN catalog_page cp ON cp.cp_start_date_sk <= ss.ss_sold_date_sk AND cp.cp_end_date_sk >= ss.ss_sold_date_sk GROUP BY ib.ib_income_band_sk, cp.cp_department ORDER BY ib.ib_income_band_sk, cp.cp_department;
SELECT ca.ca_city, ca.ca_county, AVG(hd.hd_income_band_sk) AS avg_income_band, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, COUNT(DISTINCT wp.wp_web_page_sk) AS num_web_pages_created, COUNT(DISTINCT wp.wp_access_date_sk) AS num_web_pages_accessed, AVG(wp.wp_char_count) AS avg_web_page_char_count FROM customer_address ca JOIN household_demographics hd ON ca.ca_address_sk = hd.hd_demo_sk LEFT JOIN web_page wp ON ca.ca_address_sk = wp.wp_customer_sk WHERE ca.ca_city IN ('Morgantown', 'Forestville', 'Sutton', 'Mount Olive', 'Texas', 'Bridgeport') AND ca.ca_county IN ('Carlton County', 'Bonneville County') AND wp.wp_type IN ('blog', 'article', 'product_review') AND wp.wp_autogen_flag = 'N' GROUP BY ca.ca_city, ca.ca_county ORDER BY ca.ca_city, ca.ca_county;
SELECT i.i_category, i.i_brand, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, AVG(ss.ss_ext_discount_amt) AS average_discount_amount, SUM(ss.ss_net_paid) AS total_net_sales, SUM(ss.ss_net_paid_inc_tax) AS total_net_sales_including_tax, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(DISTINCT p.p_promo_sk) AS number_of_promotions FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE p.p_discount_active = 'Y' AND p.p_start_date_sk IS NOT NULL AND p.p_end_date_sk IS NOT NULL GROUP BY i.i_category, i.i_brand ORDER BY total_net_sales DESC, i.i_category, i.i_brand;
SELECT c.cc_name, c.cc_class, c.cc_employees, c.cc_sq_ft, AVG(s.s_number_employees) AS avg_store_employees, AVG(s.s_floor_space) AS avg_store_floor_space, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(sr.sr_return_quantity) AS total_return_quantity, COUNT(DISTINCT hd.hd_demo_sk) AS distinct_household_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, SUM(ib.ib_upper_bound) AS total_income_upper_bound, COUNT(DISTINCT s.s_store_sk) AS distinct_store_count FROM call_center c LEFT JOIN store s ON c.cc_mkt_id = s.s_market_id LEFT JOIN store_returns sr ON sr.sr_store_sk = s.s_store_sk LEFT JOIN household_demographics hd ON sr.sr_hdemo_sk = hd.hd_demo_sk LEFT JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE c.cc_sq_ft::integer > 3000 AND sr.sr_return_amt_inc_tax::numeric > 1.5 AND sr.sr_return_ship_cost::numeric BETWEEN 3.5 AND 1601.73 GROUP BY c.cc_name, c.cc_class, c.cc_employees, c.cc_sq_ft ORDER BY total_return_amount DESC, total_return_quantity DESC LIMIT 100;
SELECT s.s_store_name, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_profit) AS total_store_profit, w.w_warehouse_name, sm.sm_type, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(ws.ws_net_profit) AS total_web_profit, SUM(wr.wr_return_quantity) AS total_return_quantity, SUM(wr.wr_net_loss) AS total_return_loss FROM store s LEFT JOIN store_sales ss ON s.s_store_sk = ss.ss_store_sk LEFT JOIN web_sales ws ON ws.ws_item_sk = ss.ss_item_sk LEFT JOIN web_returns wr ON ws.ws_item_sk = wr.wr_item_sk AND ws.ws_order_number = wr.wr_order_number LEFT JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk LEFT JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk WHERE s.s_market_desc IN ('Little expectations include yet forward meetings.', 'Mysterious employe', 'Events develop i', 'Architects coul') AND w.w_warehouse_id IN ('AAAAAAAADAAAAAAA', 'AAAAAAAACAAAAAAA', 'AAAAAAAAEAAAAAAA', 'AAAAAAAAFAAAAAAA') GROUP BY s.s_store_name, w.w_warehouse_name, sm.sm_type ORDER BY total_quantity_sold DESC, total_web_profit DESC, total_return_loss ASC;
SELECT channel, d_year, d_qoy, SUM(quantity) AS total_quantity_sold, SUM(ext_sales_price) AS total_sales_amount, AVG(sales_price) AS average_sales_price, SUM(net_profit) AS total_net_profit FROM ( SELECT 'web' AS channel, dd.d_year, dd.d_qoy, ws.ws_quantity AS quantity, ws.ws_ext_sales_price AS ext_sales_price, ws.ws_sales_price AS sales_price, ws.ws_net_profit AS net_profit FROM web_sales ws JOIN date_dim dd ON ws.ws_sold_date_sk = dd.d_date_sk WHERE dd.d_current_year = 'Y' AND dd.d_qoy = 1 UNION ALL SELECT 'catalog' AS channel, dd.d_year, dd.d_qoy, cs.cs_quantity AS quantity, cs.cs_ext_sales_price AS ext_sales_price, cs.cs_sales_price AS sales_price, cs.cs_net_profit AS net_profit FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk WHERE dd.d_current_year = 'Y' AND dd.d_qoy = 1 ) sales_data GROUP BY channel, d_year, d_qoy ORDER BY channel, d_year, d_qoy;
SELECT cd.cd_education_status, cd.cd_gender, cd.cd_marital_status, COUNT(DISTINCT c.c_customer_sk) AS total_customers, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, AVG(wp.wp_char_count) AS avg_webpage_char_count, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages_accessed, SUM(CASE WHEN cd.cd_credit_rating = 'High' THEN 1 ELSE 0 END) AS high_credit_rating_count, SUM(CASE WHEN cd.cd_credit_rating = 'Medium' THEN 1 ELSE 0 END) AS medium_credit_rating_count, SUM(CASE WHEN cd.cd_credit_rating = 'Low' THEN 1 ELSE 0 END) AS low_credit_rating_count FROM customer_demographics cd JOIN customer c ON cd.cd_demo_sk = c.c_current_cdemo_sk LEFT JOIN web_page wp ON c.c_customer_sk = wp.wp_customer_sk WHERE c.c_birth_country = 'BOTSWANA' AND c.c_email_address LIKE '%@Bk.com' GROUP BY cd.cd_education_status, cd.cd_gender, cd.cd_marital_status ORDER BY cd.cd_education_status, cd.cd_gender, cd.cd_marital_status;
SELECT ca.ca_state AS State, AVG(hd.hd_income_band_sk) AS Avg_Income_Band, AVG(hd.hd_dep_count) AS Avg_Dependent_Count, AVG(hd.hd_vehicle_count) AS Avg_Vehicle_Count, COUNT(*) FILTER (WHERE hd.hd_buy_potential = 'High') AS High_Buying_Potential_Count, COUNT(*) FILTER (WHERE hd.hd_buy_potential = 'Medium') AS Medium_Buying_Potential_Count, COUNT(*) FILTER (WHERE hd.hd_buy_potential = 'Low') AS Low_Buying_Potential_Count, COUNT(DISTINCT ca.ca_address_sk) AS Address_Count, AVG(ws.web_tax_percentage) AS Avg_Web_Tax_Percentage FROM customer_address ca JOIN household_demographics hd ON ca.ca_address_sk = hd.hd_demo_sk JOIN web_site ws ON ca.ca_state = ws.web_state WHERE ca.ca_country = 'United States' AND ws.web_country = 'United States' AND ca.ca_state IS NOT NULL AND ws.web_tax_percentage IS NOT NULL GROUP BY ca.ca_state ORDER BY Avg_Income_Band DESC, High_Buying_Potential_Count DESC, Medium_Buying_Potential_Count DESC, Low_Buying_Potential_Count DESC;
SELECT hd.hd_demo_sk, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, COUNT(DISTINCT wr.wr_order_number) AS total_web_returns, SUM(sr.sr_return_amt) AS total_store_return_amount, AVG(sr.sr_return_amt) AS avg_store_return_amount, SUM(wr.wr_return_amt) AS total_web_return_amount, AVG(wr.wr_return_amt) AS avg_web_return_amount, SUM(CASE WHEN p.p_channel_radio = 'N' AND p.p_channel_demo = 'N' THEN p.p_cost ELSE 0 END) AS non_radio_demo_promo_cost, AVG(CASE WHEN p.p_channel_radio = 'N' AND p.p_channel_demo = 'N' THEN p.p_response_target ELSE NULL END) AS avg_non_radio_demo_response_target FROM household_demographics hd LEFT JOIN store_returns sr ON hd.hd_demo_sk = sr.sr_hdemo_sk LEFT JOIN web_returns wr ON (hd.hd_demo_sk = wr.wr_refunded_hdemo_sk OR hd.hd_demo_sk = wr.wr_returning_hdemo_sk) LEFT JOIN promotion p ON p.p_promo_sk = sr.sr_reason_sk WHERE hd.hd_demo_sk IN (560, 4858) AND (sr.sr_store_sk IN (8, 10) OR sr.sr_store_sk IS NULL) GROUP BY hd.hd_demo_sk ORDER BY hd.hd_demo_sk;
SELECT cc_state, r_reason_desc, SUM(inv_quantity_on_hand) AS total_inventory, AVG(c_birth_year) AS average_customer_birth_year, COUNT(DISTINCT c_customer_sk) AS unique_customers, COUNT(DISTINCT web_site_sk) AS web_sites_operating FROM inventory JOIN reason ON (r_reason_sk = inv_quantity_on_hand) JOIN call_center ON (cc_division = inv_warehouse_sk) JOIN customer ON (c_current_addr_sk = cc_open_date_sk) JOIN web_site ON (web_state = cc_state) WHERE inv_date_sk = 2450815 AND c_customer_id IN ('AAAAAAAACHMAAAAA', 'AAAAAAAANPEAAAAA') AND (cc_rec_end_date IS NULL OR cc_rec_end_date > CURRENT_DATE) AND (web_rec_end_date IS NULL OR web_rec_end_date > CURRENT_DATE) GROUP BY cc_state, r_reason_desc ORDER BY total_inventory DESC, average_customer_birth_year;
SELECT cc_state, COUNT(sr_ticket_number) AS num_of_returns, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_amt) AS avg_return_amount, AVG(sr_fee) AS avg_fee FROM store_returns sr JOIN date_dim dd ON sr.sr_returned_date_sk = dd.d_date_sk JOIN call_center cc ON sr.sr_store_sk = cc.cc_call_center_sk WHERE dd.d_year = 1900 GROUP BY cc_state ORDER BY total_return_amount DESC;
SELECT w.w_warehouse_name, w.w_city, w.w_state, w.w_country, t.t_shift, COUNT(*) AS num_transactions, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_sq_ft, MAX(t.t_hour) AS latest_hour, MIN(t.t_hour) AS earliest_hour FROM warehouse w JOIN time_dim t ON w.w_warehouse_sk = t.t_time_sk WHERE w.w_warehouse_sq_ft IN (621234, 294242, 977787, 138504) AND t.t_hour IN (1, 0) AND t.t_second IN (53, 8, 34, 52) GROUP BY w.w_warehouse_name, w.w_city, w.w_state, w.w_country, t.t_shift ORDER BY total_warehouse_sq_ft DESC, num_transactions DESC;
SELECT c.c_customer_id AS customer_id, CONCAT(c.c_last_name, ', ', c.c_first_name) AS customer_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, hd.hd_income_band_sk, hd.hd_buy_potential, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(cr.cr_net_loss) AS total_net_loss FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_returning_customer_sk WHERE c.c_first_sales_date_sk IN (2452027, 2451966, 2450163) AND cr.cr_returned_time_sk IN (66035, 17738, 73881) AND cr.cr_return_quantity = 49 GROUP BY customer_id, customer_name, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, hd.hd_income_band_sk, hd.hd_buy_potential ORDER BY total_returns DESC, total_returned_quantity DESC LIMIT 100;
SELECT s.s_store_name, w.web_name, SUM(i.i_current_price) AS total_sales_price, AVG(i.i_wholesale_cost) AS average_wholesale_cost, COUNT(DISTINCT c.cp_catalog_page_sk) AS num_catalog_pages, COUNT(DISTINCT w.web_site_sk) AS num_websites, COUNT(DISTINCT wp.wp_web_page_sk) AS num_web_pages, COUNT(DISTINCT sm.sm_ship_mode_sk) AS num_ship_modes, MAX(i.i_current_price) AS max_item_price, MIN(i.i_current_price) AS min_item_price FROM store s JOIN web_site w ON s.s_market_id = w.web_mkt_id JOIN web_page wp ON w.web_site_sk = wp.wp_customer_sk JOIN catalog_page c ON c.cp_department = s.s_geography_class JOIN item i ON i.i_category = c.cp_description JOIN ship_mode sm ON sm.sm_type = wp.wp_type WHERE s.s_company_name = 'Unknown' AND wp.wp_autogen_flag = 'N' AND s.s_street_name IN ('Park Green', 'Park Laurel', '4th') AND w.web_city IN ('Fairview', 'Midway') GROUP BY s.s_store_name, w.web_name ORDER BY total_sales_price DESC, average_wholesale_cost DESC LIMIT 100;
SELECT hd.hd_income_band_sk, cd.cd_education_status, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_ext_discount_amt) AS total_discount_amt, COUNT(ss.ss_ticket_number) AS sales_count FROM store_sales ss JOIN date_dim d ON ss.ss_sold_date_sk = d.d_date_sk JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk WHERE d.d_year = 2022 AND d.d_weekend = 'Y' AND d.d_holiday = 'N' GROUP BY hd.hd_income_band_sk, cd.cd_education_status ORDER BY hd.hd_income_band_sk, cd.cd_education_status;
SELECT cc.cc_name AS call_center_name, i.i_category AS item_category, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN call_center cc ON ws.ws_bill_customer_sk = cc.cc_call_center_sk JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN date_dim d ON ws.ws_sold_date_sk = d.d_date_sk JOIN time_dim t ON ws.ws_sold_time_sk = t.t_time_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk WHERE cc.cc_manager IN ('Bob Belcher', 'Felipe Perkins', 'Larry Mccray', 'Mark Hightower') AND i.i_container = 'Unknown' AND ws.ws_ship_hdemo_sk IN (6862, 4638, 2050, 5884, 1108) AND d.d_year = 2023 AND t.t_am_pm = 'PM' GROUP BY call_center_name, item_category ORDER BY total_net_profit DESC;
SELECT cp.cp_department, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_inc_tax, AVG(cr.cr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(cr.cr_return_quantity) AS total_return_quantity, AVG(cr.cr_return_quantity) AS avg_return_quantity, hd.hd_dep_count, hd.hd_vehicle_count FROM catalog_page cp JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk WHERE cp.cp_catalog_page_sk IN (22, 117, 432, 303) AND cr.cr_return_quantity > 5 AND hd.hd_dep_count IN (3, 8) GROUP BY cp.cp_department, hd.hd_dep_count, hd.hd_vehicle_count ORDER BY total_return_amount_inc_tax DESC, total_returns DESC;
SELECT cp.cp_department, COUNT(DISTINCT cp.cp_catalog_page_sk) AS catalog_pages, AVG(p.p_cost) AS avg_promo_cost, SUM(sr.sr_return_quantity) AS total_returned_quantity, SUM(sr.sr_return_amt) AS total_returned_amount, SUM(sr.sr_net_loss) AS total_net_loss, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, COUNT(sr.sr_item_sk) AS return_transactions, COUNT(DISTINCT r.r_reason_sk) AS distinct_reasons, EXTRACT(YEAR FROM TO_DATE(t.t_time_id, 'YYYYMMDDHH24MISS')) AS return_year FROM catalog_page cp JOIN promotion p ON cp.cp_start_date_sk = p.p_start_date_sk AND cp.cp_end_date_sk = p.p_end_date_sk JOIN store_returns sr ON p.p_item_sk = sr.sr_item_sk JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk JOIN time_dim t ON sr.sr_return_time_sk = t.t_time_sk WHERE t.t_shift = 'third' AND sr.sr_return_tax IN (41.01, 56.78, 283.72) AND cp.cp_catalog_page_id IN ('AAAAAAAAAGFAAAAA', 'AAAAAAAACAJAAAAA', 'AAAAAAAANMNAAAAA', 'AAAAAAAAHGNAAAAA', 'AAAAAAAANFOAAAAA') AND r.r_reason_id IN ('AAAAAAAAGBAAAAAA', 'AAAAAAAALBAAAAAA', 'AAAAAAAAGAAAAAAA') GROUP BY cp.cp_department, EXTRACT(YEAR FROM TO_DATE(t.t_time_id, 'YYYYMMDDHH24MISS')) ORDER BY cp.cp_department, return_year;
SELECT i.i_category, i.i_color, COUNT(DISTINCT cr.cr_item_sk) AS num_returns, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_return_amount) AS total_return_amount, SUM(cr.cr_return_quantity) AS total_returned_quantity, cc.cc_name AS call_center, w.w_warehouse_name AS warehouse, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages, COUNT(DISTINCT wp.wp_web_page_sk) AS num_web_pages FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk JOIN warehouse w ON cr.cr_warehouse_sk = w.w_warehouse_sk JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN web_page wp ON cp.cp_start_date_sk = wp.wp_creation_date_sk WHERE i.i_color IN ('linen', 'midnight', 'powder', 'tan') AND cp.cp_catalog_number IN (46, 18, 2) AND w.w_gmt_offset = -5.00 GROUP BY i.i_category, i.i_color, cc.cc_name, w.w_warehouse_name ORDER BY total_return_amount DESC;
SELECT cd.cd_education_status, cd.cd_marital_status, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, COUNT(cd.cd_credit_rating) FILTER (WHERE cd.cd_credit_rating = 'High') AS high_credit_rating_count, COUNT(cd.cd_credit_rating) FILTER (WHERE cd.cd_credit_rating = 'Low') AS low_credit_rating_count, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT wr.wr_order_number) AS total_return_count, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amount_inc_tax FROM customer_demographics cd JOIN household_demographics hd ON cd.cd_demo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk LEFT JOIN web_returns wr ON cd.cd_demo_sk = wr.wr_refunded_cdemo_sk WHERE cd.cd_dep_employed_count = 0 AND cd.cd_marital_status IN ('W', 'S', 'D') AND ib.ib_lower_bound IN (180001, 190001, 30001, 50001) GROUP BY cd.cd_education_status, cd.cd_marital_status, ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY avg_purchase_estimate DESC, total_return_count DESC, avg_return_amount_inc_tax DESC;
SELECT cp.cp_department, cp.cp_catalog_number, ca.ca_state, cd.cd_education_status, COUNT(DISTINCT c.c_customer_sk) AS number_of_customers, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN catalog_page cp ON cp.cp_catalog_number = ANY('{42, 25, 9}'::integer[]) WHERE cd.cd_education_status = 'College' AND ca.ca_street_number IN ('2', '843', '939', '802', '540') AND sr.sr_returned_date_sk IS NOT NULL GROUP BY cp.cp_department, cp.cp_catalog_number, ca.ca_state, cd.cd_education_status ORDER BY total_net_loss DESC, total_returned_quantity DESC;
SELECT s_state, s_city, AVG(s_number_employees) AS avg_number_employees, SUM(s_floor_space) AS total_floor_space, COUNT(*) AS store_count FROM store WHERE s_gmt_offset = '-5.00' AND s_rec_end_date IS NULL GROUP BY s_state, s_city ORDER BY s_state, s_city;
SELECT cp_department, cp_type, COUNT(DISTINCT cp_catalog_page_sk) AS num_catalog_pages, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, SUM(ss_net_paid_inc_tax) AS total_revenue, SUM(ss_net_profit) AS total_profit, COUNT(DISTINCT ss_customer_sk) AS unique_customers, ib_lower_bound, ib_upper_bound FROM catalog_page JOIN store_sales ON cp_catalog_page_sk = ss_promo_sk JOIN income_band ON ss_hdemo_sk = ib_income_band_sk JOIN time_dim ON ss_sold_time_sk = t_time_sk WHERE cp_start_date_sk IS NOT NULL AND cp_end_date_sk IS NOT NULL AND (cp_type = 'quarterly' OR cp_type = 'monthly') AND t_sub_shift = 'night' AND ib_upper_bound IN (170000, 140000) AND ib_lower_bound >= 120001 GROUP BY cp_department, cp_type, ib_lower_bound, ib_upper_bound ORDER BY total_revenue DESC, total_profit DESC;
SELECT p.p_promo_name, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE cs.cs_sold_date_sk IN (SELECT d_date_sk FROM date_dim WHERE d_year = 2003) AND p.p_channel_email = 'Y' AND cs.cs_net_paid > 0 AND cs.cs_net_profit > 0 GROUP BY p.p_promo_name ORDER BY total_net_profit DESC, total_quantity_sold DESC;
SELECT ws.ws_web_site_sk, ws_item_sk, web_country, SUM(ws_sales_price) AS total_sales_price, AVG(ws_sales_price) AS avg_sales_price, COUNT(ws_order_number) AS total_orders, SUM(ws_quantity) AS total_quantity_sold, SUM(ws_net_profit) AS total_net_profit, SUM(wr_return_quantity) AS total_return_quantity, SUM(wr_return_amt) AS total_return_amount, AVG(wr_fee) AS avg_return_fee, COUNT(DISTINCT wr_order_number) AS total_returned_orders FROM web_sales ws JOIN web_site wsite ON ws.ws_web_site_sk = wsite.web_site_sk LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk WHERE wsite.web_country = 'United States' AND ws.ws_net_paid BETWEEN 141.68 AND 2100.98 AND ws.ws_warehouse_sk = 3 GROUP BY ws.ws_web_site_sk, ws_item_sk, web_country ORDER BY total_net_profit DESC, total_sales_price DESC;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_state, COUNT(wr.wr_return_amt) AS total_returns, SUM(wr.wr_return_amt) AS total_refund_amount, SUM(wr.wr_return_tax) AS total_refund_tax, AVG(wr.wr_return_amt) AS average_refund_amount FROM web_returns wr JOIN date_dim dd ON wr.wr_returned_date_sk = dd.d_date_sk JOIN customer_address ca ON wr.wr_returning_addr_sk = ca.ca_address_sk WHERE wr.wr_return_amt > 100.00 AND ca.ca_state = 'CA' GROUP BY dd.d_year, dd.d_quarter_name, dd.d_quarter_seq, ca.ca_state ORDER BY dd.d_year, dd.d_quarter_seq;
SELECT dd.d_year, dd.d_quarter_name, cc.cc_division_name, SUM(wp.wp_char_count) AS total_char_count, AVG(wp.wp_link_count) AS average_link_count, COUNT(*) AS num_web_pages_accessed, COUNT(DISTINCT cc.cc_call_center_sk) AS num_call_centers_involved, COUNT(DISTINCT r.r_reason_sk) AS num_distinct_reasons FROM date_dim AS dd JOIN web_page AS wp ON dd.d_date_sk = wp.wp_access_date_sk JOIN call_center AS cc ON wp.wp_customer_sk = cc.cc_call_center_sk LEFT JOIN reason AS r ON r.r_reason_sk = wp.wp_customer_sk WHERE dd.d_year = 2022 AND dd.d_quarter_name IN ('Q1', 'Q2', 'Q3', 'Q4') AND r.r_reason_sk IN ('15', '31', '3', '32', '5') GROUP BY dd.d_year, dd.d_quarter_name, cc.cc_division_name ORDER BY dd.d_year, dd.d_quarter_name, cc.cc_division_name;
SELECT s.s_state, s.s_county, cd.cd_marital_status, COUNT(DISTINCT i.i_item_sk) AS total_items, SUM(i.i_current_price) AS total_revenue, AVG(i.i_wholesale_cost) AS average_wholesale_cost, COUNT(DISTINCT hd.hd_demo_sk) AS total_households, AVG(hd.hd_vehicle_count) AS average_vehicle_count, SUM(CASE WHEN i.i_units = 'Bundle' THEN 1 ELSE 0 END) AS bundle_units, SUM(CASE WHEN i.i_units = 'Pound' THEN 1 ELSE 0 END) AS pound_units, SUM(CASE WHEN i.i_units = 'Oz' THEN 1 ELSE 0 END) AS oz_units, COUNT(DISTINCT s.s_store_sk) AS total_stores, AVG(s.s_floor_space) AS average_floor_space FROM item i JOIN store s ON (i.i_manufact_id = s.s_store_sk) JOIN household_demographics hd ON (s.s_store_sk = hd.hd_income_band_sk) JOIN customer_demographics cd ON (hd.hd_demo_sk = cd.cd_demo_sk) WHERE hd.hd_dep_count IN ('6', '9', '5') AND hd.hd_demo_sk IN ('28', '1536', '3779') AND hd.hd_vehicle_count IN ('2', '1', '3') AND i.i_units IN ('Bundle', 'Pound', 'Oz') AND i.i_rec_end_date IN ('1999-10-27', '2000-10-26', '2001-10-26') AND s.s_market_desc IN ('Events develop i', 'Architects coul', 'Little expectations include yet forward meetings.') AND s.s_state = 'TN' AND s.s_county = 'Williamson County' AND s.s_floor_space IN ('8954883', '9341467', '5285950') AND cd.cd_dep_college_count = '0' AND cd.cd_demo_sk IN ('20554', '21012', '21822') AND cd.cd_marital_status IN ('S', 'M', 'D') GROUP BY s.s_state, s.s_county, cd.cd_marital_status ORDER BY total_revenue DESC, average_wholesale_cost DESC;
SELECT ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT cc.cc_call_center_sk) AS number_of_call_centers, AVG(cc.cc_employees) AS average_employees, SUM(p.p_cost) AS total_promotion_cost, COUNT(DISTINCT p.p_promo_sk) AS number_of_promotions FROM call_center cc JOIN promotion p ON (cc.cc_mkt_id = p.p_promo_sk) JOIN income_band ib ON (cc.cc_gmt_offset >= ib.ib_lower_bound AND cc.cc_gmt_offset < ib.ib_upper_bound) WHERE cc.cc_country = 'United States' AND cc.cc_rec_end_date IS NULL AND p.p_cost = 1000.00 AND ib.ib_lower_bound IN (30001, 10001, 140001, 90001, 0) GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ib.ib_lower_bound;
SELECT ca.ca_state, ca.ca_city, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(ws.ws_quantity) AS total_items_sold, AVG(ws.ws_net_paid) AS average_net_paid_per_sale, SUM(ws.ws_net_profit) AS total_net_profit, COUNT(DISTINCT ws.ws_promo_sk) AS distinct_promotions_used FROM customer_address ca JOIN customer c ON c.c_current_addr_sk = ca.ca_address_sk JOIN web_sales ws ON ws.ws_bill_customer_sk = c.c_customer_sk JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk WHERE ca.ca_country = 'United States' AND p.p_channel_details IN ('Signs hear moreover nations. There perfect', 'Regional schemes would devise even loc') AND p.p_response_target = 1 AND ws.ws_sales_price > 0 GROUP BY ca.ca_state, ca.ca_city ORDER BY total_net_profit DESC, ca.ca_state, ca.ca_city;
SELECT w_state, web_name, ca_city, COUNT(DISTINCT cr_order_number) AS total_returns, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_quantity) AS total_returned_quantity, SUM(cr_return_amount) AS total_returned_amount, SUM(cr_fee) AS total_fees, SUM(cr_net_loss) AS total_net_loss, COUNT(DISTINCT ss_ticket_number) AS total_sales_transactions, AVG(ss_sales_price) AS avg_sales_price, SUM(ss_quantity) AS total_sold_quantity, SUM(ss_net_profit) AS total_net_profit FROM warehouse JOIN catalog_returns ON w_warehouse_sk = cr_warehouse_sk JOIN reason ON cr_reason_sk = r_reason_sk JOIN customer_address ON cr_returning_addr_sk = ca_address_sk JOIN store_sales ON cr_item_sk = ss_item_sk AND cr_order_number = ss_ticket_number JOIN store ON ss_store_sk = s_store_sk JOIN web_site ON s_store_sk = web_site_sk WHERE w_country = 'United States' AND ca_street_number IN ('125', '871', '690') AND ca_city = 'Glenville' AND web_rec_end_date IN ('1999-08-16', '2000-08-15', '2001-08-15') AND web_site_sk IN ('25', '29', '21', '17') GROUP BY w_state, web_name, ca_city ORDER BY total_returns DESC, total_net_profit DESC;
SELECT cc.cc_name, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, AVG(cs.cs_net_profit) AS average_net_profit FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN store s ON cc.cc_division = s.s_division_id JOIN web_page wp ON c.c_customer_sk = wp.wp_customer_sk WHERE s.s_rec_end_date IN ('2001-03-12', '2000-03-12', '1999-03-13') AND s.s_floor_space IN (8954883, 9078805, 9341467, 5285950) AND c.c_birth_country = 'LESOTHO' AND c.c_customer_id IN ('AAAAAAAAKJFAAAAA', 'AAAAAAAALPMAAAAA', 'AAAAAAAAHPBBAAAA', 'AAAAAAAAHHFAAAAA', 'AAAAAAAAMCKAAAAA', 'AAAAAAAAKKABAAAA') AND wp.wp_url = 'http://www.foo.com' GROUP BY cc.cc_name;
SELECT cp.cp_department, dd.d_year, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount, AVG(cr.cr_return_quantity) AS avg_return_quantity, COUNT(cr.cr_order_number) AS total_returned_orders FROM catalog_returns cr JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN date_dim dd ON cr.cr_returned_date_sk = dd.d_date_sk JOIN household_demographics hd ON cr.cr_returning_cdemo_sk = hd.hd_demo_sk WHERE cp.cp_type = 'monthly' AND hd.hd_buy_potential = 'Unknown' GROUP BY cp.cp_department, dd.d_year ORDER BY total_return_amount DESC, cp.cp_department, dd.d_year;
SELECT p.p_promo_name, p.p_channel_details, cp.cp_department, w.w_state, AVG(ws_net_profit) AS avg_web_sales_profit, AVG(wr_net_loss) AS avg_web_returns_loss, SUM(ws_quantity) AS total_quantity_sold, COUNT(DISTINCT ws_web_page_sk) AS count_unique_pages_sold, COUNT(DISTINCT wr_web_page_sk) AS count_unique_pages_returned FROM promotion p JOIN web_sales ws ON p.p_promo_sk = ws.ws_promo_sk JOIN catalog_page cp ON ws.ws_web_page_sk = cp.cp_catalog_page_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk LEFT JOIN web_returns wr ON ws.ws_item_sk = wr.wr_item_sk AND ws.ws_order_number = wr.wr_order_number WHERE cp.cp_start_date_sk BETWEEN '2450906' AND '2451420' AND cp.cp_end_date_sk BETWEEN '2451419' AND '2451664' AND (wr.wr_returned_date_sk IS NULL OR wr.wr_returned_date_sk BETWEEN ws_sold_date_sk AND ws_sold_date_sk + 30) GROUP BY p.p_promo_name, p.p_channel_details, cp.cp_department, w.w_state ORDER BY avg_web_sales_profit DESC, avg_web_returns_loss DESC;
SELECT ca_state, sm_type, EXTRACT(YEAR FROM d_date) AS year, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_net_paid) AS total_net_paid, SUM(cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs_net_paid_inc_ship_tax) AS total_net_paid_inc_ship_tax, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk JOIN customer_address ON cs_ship_addr_sk = ca_address_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk WHERE ca_country = 'United States' AND sm_type IN ('TWO DAY', 'EXPRESS', 'OVERNIGHT') AND d_year = EXTRACT(YEAR FROM CURRENT_DATE) GROUP BY ca_state, sm_type, year ORDER BY total_net_profit DESC, ca_state, sm_type;
SELECT c.c_birth_country, i.i_category, ss.ss_sold_date_sk AS sales_period, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(inv.inv_quantity_on_hand) AS total_inventory_on_hand, (SUM(ss.ss_net_paid) - SUM(ss.ss_quantity * i.i_wholesale_cost)) AS total_profit FROM store_sales ss JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk AND ss.ss_item_sk = inv.inv_item_sk WHERE i.i_size IN ('extra large', 'large', 'economy') AND i.i_manufact_id IN ('302', '74', '552') AND c.c_birth_country IN ('ANDORRA', 'HONG KONG', 'SUDAN') AND c.c_birth_month IN ('12', '3', '5') AND ss.ss_sales_price IN ('71.33', '20.06', '18.34') AND ss.ss_net_paid IN ('2427.39', '6300.00', '3723.80') AND ss.ss_promo_sk IN ('148', '58', '30') AND inv.inv_date_sk = '2450815' AND inv.inv_warehouse_sk IN ('2', '1') AND inv.inv_item_sk IN ('7018', '8266', '13327') AND inv.inv_quantity_on_hand IN ('693', '377', '403') GROUP BY c.c_birth_country, i.i_category, sales_period ORDER BY total_profit DESC, total_net_paid DESC, total_quantity_sold DESC, average_sales_price DESC;
SELECT p_channel_dmail, p_channel_email, p_channel_catalog, p_channel_tv, p_channel_radio, p_channel_press, p_channel_event, p_channel_demo, AVG(p_cost) AS average_promo_cost, SUM(p_cost) AS total_promo_cost, COUNT(p_promo_sk) AS number_of_promotions, SUM(inv_quantity_on_hand) AS total_inventory, AVG(inv_quantity_on_hand) AS average_inventory, COUNT(DISTINCT inv_item_sk) AS distinct_items_in_inventory, MIN(ib_lower_bound) AS min_income_band_lower_bound, MAX(ib_upper_bound) AS max_income_band_upper_bound FROM promotion JOIN inventory ON promotion.p_item_sk = inventory.inv_item_sk LEFT JOIN income_band ON inventory.inv_quantity_on_hand BETWEEN income_band.ib_lower_bound AND income_band.ib_upper_bound WHERE p_response_target = 1 AND ib_income_band_sk IN (10, 19, 13) AND inv_item_sk = 15788 AND inv_quantity_on_hand IN (329, 356, 513, 875, 262) AND p_discount_active = 'Y' GROUP BY p_channel_dmail, p_channel_email, p_channel_catalog, p_channel_tv, p_channel_radio, p_channel_press, p_channel_event, p_channel_demo ORDER BY number_of_promotions DESC, total_promo_cost DESC;
SELECT ib.ib_lower_bound, ib.ib_upper_bound, cc.cc_state, d.d_year, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_ext_discount_amt) AS average_discount, COUNT(DISTINCT cs.cs_order_number) AS total_orders FROM catalog_sales cs JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN income_band ib ON cs.cs_bill_customer_sk = ib.ib_income_band_sk JOIN call_center cc ON cs.cs_call_center_sk = cc.cc_call_center_sk WHERE d.d_year = 2003 AND ib.ib_upper_bound IN (40000, 90000, 100000, 20000, 140000, 180000) AND cc.cc_state = 'TN' GROUP BY ib.ib_lower_bound, ib.ib_upper_bound, cc.cc_state, d.d_year ORDER BY ib.ib_lower_bound, total_sales DESC;
SELECT dd.d_month_seq, dd.d_quarter_seq, dd.d_year, cp.cp_type, COUNT(DISTINCT inv.inv_item_sk) AS low_stock_items, AVG(inv.inv_quantity_on_hand) AS avg_quantity_on_hand, MIN(inv.inv_quantity_on_hand) AS min_quantity_on_hand, MAX(inv.inv_quantity_on_hand) AS max_quantity_on_hand, COUNT(DISTINCT inv.inv_warehouse_sk) AS affected_warehouses FROM inventory inv JOIN date_dim dd ON inv.inv_date_sk = dd.d_date_sk JOIN catalog_page cp ON inv.inv_item_sk = cp.cp_catalog_page_sk WHERE inv.inv_quantity_on_hand < 750 AND dd.d_year = 2022 GROUP BY dd.d_month_seq, dd.d_quarter_seq, dd.d_year, cp.cp_type ORDER BY dd.d_year, dd.d_quarter_seq, dd.d_month_seq, cp.cp_type;
SELECT ca.ca_city, ca.ca_state, COUNT(DISTINCT cc.cc_call_center_id) AS num_call_centers, SUM(cc.cc_employees) AS total_employees, AVG(hd.hd_dep_count) AS avg_household_dep_count, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_return_quantity) AS total_returned_items, COUNT(DISTINCT sr.sr_ticket_number) AS num_return_transactions, AVG(sr.sr_fee) AS avg_return_fee FROM call_center cc JOIN customer_address ca ON cc.cc_city = ca.ca_city AND cc.cc_state = ca.ca_state JOIN household_demographics hd ON hd.hd_income_band_sk BETWEEN 9 AND 15 JOIN store_returns sr ON sr.sr_addr_sk = ca.ca_address_sk JOIN ship_mode sm ON sm.sm_contract IN ('A5BYO1qH8HGTTN', 'Xjy3ZPuiDjzHlRx14Z3', '2mM8l', '6Hzzp4JkzjqD8MGXLCDa') WHERE ca.ca_city IN ('Lewisburg', 'Wright', 'Valley View', 'Argyle', 'Plainview', 'Andover') AND sm.sm_type = 'REGULAR' AND ca.ca_gmt_offset IN (-6.00, -9.00, -5.00, -10.00) AND (hd.hd_dep_count IN (0, 3, 7, 8, 9) OR hd.hd_dep_count IS NULL) GROUP BY ca.ca_city, ca.ca_state ORDER BY total_return_amount DESC, total_employees DESC, num_return_transactions DESC;
SELECT ca.ca_location_type, COUNT(DISTINCT p.p_promo_sk) AS num_promotions, SUM(p.p_cost) AS total_promotion_cost, SUM(CASE WHEN p.p_channel_dmail = '1' THEN 1 ELSE 0 END) AS dmail_promotions, SUM(CASE WHEN p.p_channel_email = '1' THEN 1 ELSE 0 END) AS email_promotions, SUM(CASE WHEN p.p_channel_catalog = '1' THEN 1 ELSE 0 END) AS catalog_promotions, SUM(CASE WHEN p.p_channel_tv = '1' THEN 1 ELSE 0 END) AS tv_promotions, SUM(CASE WHEN p.p_channel_radio = '1' THEN 1 ELSE 0 END) AS radio_promotions, SUM(CASE WHEN p.p_channel_press = '1' THEN 1 ELSE 0 END) AS press_promotions, SUM(CASE WHEN p.p_channel_event = '1' THEN 1 ELSE 0 END) AS event_promotions, SUM(CASE WHEN p.p_channel_demo = '1' THEN 1 ELSE 0 END) AS demo_promotions, AVG(p.p_cost) AS avg_promotion_cost_per_channel FROM promotion p JOIN customer_address ca ON p.p_item_sk = ca.ca_address_sk WHERE ca.ca_location_type IN ('single family', 'apartment', 'condo') AND ca.ca_street_type LIKE '%Way%' AND p.p_cost >= 1000.00 AND p.p_promo_id IN ('AAAAAAAAEGAAAAAA', 'AAAAAAAAGJAAAAAA', 'AAAAAAAAHFAAAAAA', 'AAAAAAAAPBBAAAAA') GROUP BY ca.ca_location_type ORDER BY total_promotion_cost DESC;
SELECT hd.hd_dep_count AS number_of_dependents, hd.hd_vehicle_count AS number_of_vehicles, ca.ca_location_type AS customer_location_type, ca.ca_street_type AS street_type, t.t_am_pm AS return_time_period, COUNT(DISTINCT cr.cr_order_number) AS total_returned_orders, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN household_demographics hd ON cr.cr_returning_hdemo_sk = hd.hd_demo_sk JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk JOIN time_dim t ON cr.cr_returned_time_sk = t.t_time_sk WHERE ca.ca_location_type IN ('single family', 'apartment', 'condo') AND ca.ca_street_type IN ('Boulevard', 'Ct.', 'Avenue', 'Way', 'Parkway', 'ST') AND t.t_am_pm = 'AM' GROUP BY hd.hd_dep_count, hd.hd_vehicle_count, ca.ca_location_type, ca.ca_street_type, t.t_am_pm ORDER BY total_net_loss DESC, average_return_amount DESC;
SELECT s.s_store_name, s.s_manager, SUM(cs.cs_net_profit) AS total_profit, AVG(cs.cs_quantity) AS average_quantity_sold, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(wr.wr_net_loss) AS total_net_loss, AVG(wr.wr_fee) AS average_return_fee, COUNT(DISTINCT wr.wr_order_number) AS total_returns, r.r_reason_desc, d.d_year, d.d_quarter_name FROM store s JOIN catalog_sales cs ON s.s_store_sk = cs.cs_ship_addr_sk JOIN web_returns wr ON cs.cs_order_number = wr.wr_order_number JOIN date_dim d ON cs.cs_sold_date_sk = d.d_date_sk JOIN reason r ON wr.wr_reason_sk = r.r_reason_sk WHERE s.s_manager IN ('Raymond Jacobs', 'William Ward') AND r.r_reason_desc IN ('duplicate purchase', 'Did not fit') AND d.d_year = 2001 AND d.d_quarter_name IN ('Q1', 'Q2', 'Q3', 'Q4') GROUP BY s.s_store_name, s.s_manager, r.r_reason_desc, d.d_year, d.d_quarter_name ORDER BY total_profit DESC, total_net_loss DESC;
SELECT ca.ca_city, ca.ca_state, COUNT(DISTINCT ca.ca_address_sk) AS num_addresses, AVG(hd.hd_dep_count) AS avg_dependency_count, SUM(hd.hd_vehicle_count) AS total_vehicles, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT sm.sm_ship_mode_sk) AS num_ship_modes, COUNT(DISTINCT r.r_reason_sk) AS num_reasons, SUM(CASE WHEN cp.cp_department = 'Electronics' THEN 1 ELSE 0 END) AS num_electronics_pages, SUM(CASE WHEN sm.sm_type = 'OVERNIGHT' THEN 1 ELSE 0 END) AS overnight_shipments, AVG(CASE WHEN t.t_am_pm = 'PM' THEN t.t_hour END) AS avg_hour_pm FROM customer_address ca JOIN household_demographics hd ON ca.ca_address_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN ship_mode sm ON sm.sm_carrier = 'UPS' JOIN reason r ON r.r_reason_desc LIKE 'reason %' LEFT JOIN catalog_page cp ON cp.cp_department = ca.ca_city LEFT JOIN time_dim t ON t.t_shift = 'Evening' WHERE r.r_reason_sk IN ('9', '6', '11', '2') AND ib.ib_income_band_sk IN ('20', '6') AND hd.hd_buy_potential = 'Unknown' AND sm.sm_type IN ('LIBRARY', 'OVERNIGHT', 'NEXT DAY') GROUP BY ca.ca_city, ca.ca_state, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ca.ca_city, ca.ca_state;
SELECT cp.cp_department, COUNT(ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_sales_price) AS total_sales_amount, AVG(ss.ss_ext_discount_amt) AS average_discount_amount, SUM(ss.ss_quantity) AS total_items_sold, SUM(ss.ss_coupon_amt) AS total_coupon_amount_used FROM catalog_page cp JOIN store_sales ss ON cp.cp_catalog_page_sk = ss.ss_sold_date_sk WHERE cp.cp_catalog_number BETWEEN 25 AND 41 AND ss.ss_sold_date_sk BETWEEN 20020101 AND 20021231 AND ss.ss_ext_list_price IN (2602.80, 627.44, 6715.50, 6951.00, 6762.70, 4044.30) AND ss.ss_coupon_amt IN (393.68, 57.05) GROUP BY cp.cp_department ORDER BY total_sales_amount DESC;
SELECT hd.hd_income_band_sk, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_net_profit, SUM(sr.sr_return_quantity) AS total_quantity_returned, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_fee) AS average_return_fee, SUM(sr.sr_net_loss) AS total_net_loss, (SUM(cs.cs_net_profit) - SUM(sr.sr_net_loss)) AS net_gain_loss FROM household_demographics hd LEFT JOIN catalog_sales cs ON hd.hd_demo_sk = cs.cs_bill_hdemo_sk OR hd.hd_demo_sk = cs.cs_ship_hdemo_sk LEFT JOIN store_returns sr ON hd.hd_demo_sk = sr.sr_hdemo_sk LEFT JOIN time_dim td ON cs.cs_sold_time_sk = td.t_time_sk OR sr.sr_return_time_sk = td.t_time_sk WHERE (cs.cs_ship_cdemo_sk IN ('512236', '76858', '1078452', '1665528', '234732', '598521') OR cs.cs_ext_ship_cost IN ('4483.57', '946.40', '622.83', '8.12', '342.58', '889.92')) AND (td.t_time_id IN ('AAAAAAAAAKIAAAAA', 'AAAAAAAAHKMAAAAA', 'AAAAAAAAEJNAAAAA', 'AAAAAAAADIOAAAAA', 'AAAAAAAAKMOAAAAA') OR td.t_minute IN ('17', '18', '57', '25')) GROUP BY hd.hd_income_band_sk ORDER BY total_net_profit DESC, total_orders DESC;
SELECT w_state, w.w_warehouse_name, AVG(ws.web_tax_percentage) AS average_tax_percentage, COUNT(DISTINCT r.r_reason_sk) AS total_reason_count, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft FROM warehouse w JOIN web_site ws ON w.w_zip = ws.web_zip LEFT JOIN reason r ON r.r_reason_desc LIKE '%return%' WHERE w.w_gmt_offset = '-5.00' AND ws.web_rec_start_date <= CURRENT_DATE AND (ws.web_rec_end_date IS NULL OR ws.web_rec_end_date >= CURRENT_DATE) GROUP BY w_state, w.w_warehouse_name ORDER BY w_state, w.w_warehouse_name;
SELECT ca.ca_state AS state, CASE WHEN cc.cc_call_center_sk IS NOT NULL THEN 'Call Center' WHEN ws.web_site_sk IS NOT NULL THEN 'Web Site' WHEN st.s_store_sk IS NOT NULL THEN 'Store' ELSE 'Unknown' END AS return_channel, COUNT(*) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, AVG(cr.cr_return_tax) AS avg_return_tax, AVG(cr.cr_return_ship_cost) AS avg_return_ship_cost FROM catalog_returns cr LEFT JOIN call_center cc ON cr.cr_call_center_sk = cc.cc_call_center_sk LEFT JOIN web_site ws ON cr.cr_call_center_sk = ws.web_site_sk LEFT JOIN store st ON cr.cr_call_center_sk = st.s_store_sk LEFT JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk GROUP BY ca.ca_state, CASE WHEN cc.cc_call_center_sk IS NOT NULL THEN 'Call Center' WHEN ws.web_site_sk IS NOT NULL THEN 'Web Site' WHEN st.s_store_sk IS NOT NULL THEN 'Store' ELSE 'Unknown' END ORDER BY state, return_channel;
SELECT ca_state, SUM(hd_dep_count) AS total_dependents, AVG(hd_vehicle_count) AS avg_vehicles, COUNT(DISTINCT ca_address_sk) AS total_addresses, SUM(CASE WHEN p_channel_email = '1' THEN p_response_target ELSE 0 END) AS email_promo_targets, AVG(inv_quantity_on_hand) AS avg_inventory_on_hand FROM customer_address ca JOIN household_demographics hd ON ca.ca_address_sk = hd.hd_demo_sk JOIN promotion p ON ca.ca_address_sk = p.p_promo_sk JOIN inventory i ON ca.ca_address_sk = i.inv_warehouse_sk GROUP BY ca_state ORDER BY ca_state;
SELECT ws.ws_web_site_sk, web.web_name, web.web_class, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_inc_tax, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_coupon_amt) AS total_coupon_amt_used, sm.sm_type AS shipping_type, sm.sm_carrier AS shipping_carrier, COUNT(DISTINCT ws.ws_warehouse_sk) AS total_warehouses_used, t.t_shift AS time_shift, COUNT(DISTINCT ws.ws_ship_mode_sk) AS total_ship_modes_used FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk JOIN time_dim t ON ws.ws_sold_time_sk = t.t_time_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk WHERE web.web_country = 'United States' AND ws.ws_coupon_amt IN (1426.08, 70.99, 196.19) AND t.t_minute IN (33, 5, 49, 22, 42, 10) AND ws.ws_web_site_sk IN (4, 3, 28, 16, 7, 26) GROUP BY ws.ws_web_site_sk, web.web_name, web.web_class, sm.sm_type, sm.sm_carrier, t.t_shift ORDER BY total_net_paid DESC;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions, SUM(wr.wr_return_quantity) AS total_quantity_returned, AVG(wr.wr_return_amt) AS average_return_amount, COUNT(DISTINCT wr.wr_order_number) AS number_of_return_transactions FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN web_returns wr ON ss.ss_item_sk = wr.wr_item_sk AND ss.ss_ticket_number = wr.wr_order_number WHERE cc.cc_mkt_class IN ('Silly particles could pro', 'Dealers make most historical, direct students', 'Wrong troops shall work sometimes in a opti', 'A bit narrow forms matter animals. Consist', 'More than other authori') AND cc.cc_sq_ft IN (795, 4134, 3514) AND wr.wr_refunded_addr_sk IN ('15506', '16033', '22303') AND ss.ss_item_sk IN (5893, 944) AND ss.ss_ticket_number IN (3473, 3634, 3530) GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_quantity_sold DESC, total_quantity_returned DESC;
SELECT cc.cc_call_center_id, cc.cc_name, cc.cc_city, cp.cp_type, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_items_sold, SUM(ss.ss_net_paid) AS total_net_sales, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_ext_discount_amt) AS total_discount_amount, AVG(ss.ss_quantity) AS average_quantity_per_transaction FROM store_sales ss JOIN call_center cc ON ss.ss_store_sk = cc.cc_call_center_sk JOIN catalog_page cp ON ss.ss_item_sk = cp.cp_catalog_page_sk WHERE ss.ss_customer_sk IN ('79119', '51420') GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_city, cp.cp_type ORDER BY total_net_sales DESC, average_sales_price DESC;
SELECT c.c_first_name, c.c_last_name, ca.ca_city, ca.ca_state, ca.ca_country, SUM(cs.cs_sales_price) AS total_sales, AVG(cs.cs_sales_price) AS average_sale_amount, COUNT(cs.cs_order_number) AS number_of_orders, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_return_amount) AS average_return_amount, COUNT(DISTINCT cr.cr_order_number) AS number_of_returns, SUM(cr.cr_net_loss) AS total_net_loss FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN catalog_sales cs ON c.c_customer_sk = cs.cs_bill_customer_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number AND cs.cs_item_sk = cr.cr_item_sk WHERE ca.ca_country = 'United States' AND ca.ca_gmt_offset IN ('-10.00', '-6.00', '-5.00') AND cs.cs_ext_list_price > 0 GROUP BY c.c_first_name, c.c_last_name, ca.ca_city, ca.ca_state, ca.ca_country HAVING SUM(cs.cs_sales_price) > 0 ORDER BY total_sales DESC, total_returns DESC LIMIT 100;
SELECT c.c_birth_month, COUNT(DISTINCT ss.ss_customer_sk) AS total_customers_made_purchase, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_sales_price) AS avg_sale_amount, COUNT(DISTINCT cr.cr_returning_customer_sk) AS total_customers_made_return, SUM(cr.cr_return_amount) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount FROM customer c LEFT JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN catalog_returns cr ON c.c_customer_sk = cr.cr_returning_customer_sk LEFT JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk AND cp.cp_catalog_page_number = 104 LEFT JOIN web_returns wr ON c.c_customer_sk = wr.wr_returning_customer_sk LEFT JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk AND ws.web_open_date_sk = 2450628 WHERE c.c_birth_month IN (5, 6, 11) GROUP BY c.c_birth_month ORDER BY c.c_birth_month;
SELECT t.t_shift, SUM(i.inv_quantity_on_hand) AS total_quantity_on_hand, AVG(s.s_number_employees) AS avg_number_of_employees, COUNT(DISTINCT s.s_store_sk) AS number_of_stores, SUM(s.s_floor_space) AS total_floor_space FROM inventory i JOIN time_dim t ON i.inv_date_sk = t.t_time_sk JOIN store s ON i.inv_warehouse_sk = s.s_store_sk WHERE s.s_store_id = 'AAAAAAAAIAAAAAAA' AND t.t_am_pm = 'PM' AND s.s_rec_start_date <= CURRENT_DATE AND (s.s_rec_end_date IS NULL OR s.s_rec_end_date > CURRENT_DATE) GROUP BY t.t_shift ORDER BY t.t_shift;
SELECT p.p_promo_name, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo, SUM(p.p_cost) AS total_promotion_cost, COUNT(p.p_promo_sk) AS number_of_promotions, AVG(cd.cd_dep_count) AS average_number_of_dependents FROM promotion p JOIN web_page wp ON p.p_item_sk = wp.wp_web_page_sk JOIN customer_demographics cd ON wp.wp_customer_sk = cd.cd_demo_sk WHERE wp.wp_creation_date_sk IN ('2450808', '2450809') AND p.p_response_target = 1 AND cd.cd_marital_status IN ('W', 'D', 'U', 'S') GROUP BY p.p_promo_name, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo ORDER BY total_promotion_cost DESC, number_of_promotions DESC;
SELECT c.c_last_name, c.c_first_name, c.c_email_address, SUM(ss.ss_net_paid) AS total_sales, AVG(ss.ss_quantity) AS avg_quantity_sold, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_transactions, SUM(wr.wr_fee) AS total_return_fees, AVG(wr.wr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT wr.wr_order_number) AS number_of_returns, r.r_reason_desc AS most_common_return_reason FROM store_sales ss JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk LEFT JOIN web_returns wr ON wr.wr_returning_customer_sk = c.c_customer_sk LEFT JOIN reason r ON wr.wr_reason_sk = r.r_reason_sk WHERE c.c_birth_day IN (12, 23, 14, 10, 22, 11) AND r.r_reason_desc IN ('Wrong size', 'unauthoized purchase', 'reason 32') GROUP BY c.c_last_name, c.c_first_name, c.c_email_address, r.r_reason_desc ORDER BY total_sales DESC, total_return_fees DESC;
SELECT t.t_shift, ib.ib_income_band_sk, COUNT(DISTINCT ws.web_site_sk) AS total_websites, AVG(ws.web_tax_percentage) AS avg_tax_percentage, SUM(CASE WHEN ws.web_class = 'Unknown' THEN 1 ELSE 0 END) AS unknown_class_count, MIN(ib.ib_lower_bound) AS min_income_lower_bound, MAX(ib.ib_upper_bound) AS max_income_upper_bound FROM time_dim t JOIN web_site ws ON t.t_time_sk = ws.web_open_date_sk LEFT JOIN income_band ib ON ws.web_mkt_id = ib.ib_income_band_sk WHERE t.t_time_sk IN (1002, 2003, 4384, 955, 433, 1796) AND ws.web_company_id IN (5, 2, 1) AND ws.web_class != 'Unknown' GROUP BY t.t_shift, ib.ib_income_band_sk ORDER BY t.t_shift, ib.ib_income_band_sk;
SELECT w_state, w_city, COUNT(DISTINCT w_warehouse_sk) AS number_of_warehouses, SUM(w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(w_warehouse_sq_ft) AS avg_warehouse_sq_ft, p_channel_dmail, p_channel_email, COUNT(DISTINCT p_promo_sk) AS number_of_promotions, SUM(p_cost) AS total_promotion_cost, AVG(p_cost) AS avg_promotion_cost, s_state, s_city, COUNT(DISTINCT s_store_sk) AS number_of_stores, SUM(s_number_employees) AS total_employees, AVG(s_floor_space) AS avg_store_floor_space, SUM(s_tax_precentage) AS total_tax_percentage, AVG(s_tax_precentage) AS avg_tax_percentage FROM warehouse JOIN promotion ON w_warehouse_sk = p_item_sk JOIN store ON w_state = s_state AND w_city = s_city WHERE promotion.p_channel_press = 'N' AND promotion.p_purpose = 'Unknown' AND store.s_rec_start_date <= CURRENT_DATE AND (store.s_rec_end_date IS NULL OR store.s_rec_end_date > CURRENT_DATE) GROUP BY w_state, w_city, p_channel_dmail, p_channel_email, s_state, s_city ORDER BY w_state, w_city;
SELECT cc.cc_division_name, cc.cc_class, wp.wp_type, COUNT(*) AS number_of_calls, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_fee) AS total_fee_collected, SUM(cr.cr_return_ship_cost) AS total_shipping_cost, SUM(cr.cr_net_loss) AS total_net_loss FROM call_center AS cc JOIN catalog_returns AS cr ON cc.cc_call_center_sk = cr.cr_call_center_sk JOIN web_page AS wp ON cr.cr_catalog_page_sk = wp.wp_web_page_sk WHERE cc.cc_division_name LIKE '%anti%' AND (cc.cc_class = 'small' OR cc.cc_class = 'large') AND (wp.wp_char_count = 3128 OR wp.wp_char_count = 701 OR wp.wp_char_count = 2129) GROUP BY cc.cc_division_name, cc.cc_class, wp.wp_type ORDER BY cc.cc_division_name, cc.cc_class, wp.wp_type;
SELECT sm.sm_type AS shipping_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_paid) AS total_net_paid, SUM(cs.cs_net_profit) AS total_net_profit, COUNT(DISTINCT p.p_promo_sk) AS distinct_promotions_used, SUM(CASE WHEN t.t_am_pm = 'AM' THEN cs.cs_quantity ELSE 0 END) AS total_quantity_am, SUM(CASE WHEN t.t_am_pm = 'PM' THEN cs.cs_quantity ELSE 0 END) AS total_quantity_pm FROM catalog_sales cs JOIN time_dim t ON cs.cs_sold_time_sk = t.t_time_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE cs.cs_sold_date_sk IS NOT NULL AND cs.cs_ship_date_sk IS NOT NULL AND sm.sm_contract IN ('uukTktPYycct8', 'GNJr3g5i7oorKqtX', 'hGoF18SLDDPBj', 'Ek', 'YvxVaJI10') AND p.p_cost = 1000.00 AND p.p_channel_catalog = 'N' GROUP BY sm.sm_type ORDER BY total_net_paid DESC;
SELECT i_category, ca_state, SUM(sr_return_amt) AS total_return_amount, AVG(sr_return_amt) AS avg_return_amount, COUNT(DISTINCT sr_customer_sk) AS unique_customers_returning, COUNT(*) AS total_returns FROM store_returns sr JOIN item i ON sr.sr_item_sk = i.i_item_sk JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ca.ca_gmt_offset IN ('-5.00', '-6.00', '-10.00', '-7.00', '-9.00') AND c.c_birth_month IN (6, 1, 3, 10, 9, 8) AND ca.ca_suite_number IN ('Suite 10', 'Suite I', 'Suite 60', 'Suite 360', 'Suite C', 'Suite 320') GROUP BY i_category, ca_state ORDER BY total_return_amount DESC, unique_customers_returning DESC;
SELECT c.cp_catalog_page_id, i.i_category, AVG(i.i_current_price) AS avg_current_price, SUM(sr.sr_return_amt) AS total_return_amount, COUNT(DISTINCT sr.sr_customer_sk) AS unique_customers_returning, SUM(wr.wr_return_amt_inc_tax) AS total_web_return_amount_inc_tax, AVG(wr.wr_return_ship_cost) AS avg_web_return_shipping_cost FROM catalog_page AS c JOIN item AS i ON c.cp_catalog_page_sk = i.i_item_sk LEFT JOIN store_returns AS sr ON i.i_item_sk = sr.sr_item_sk LEFT JOIN web_returns AS wr ON i.i_item_sk = wr.wr_item_sk WHERE c.cp_catalog_page_id IN ('AAAAAAAANDFAAAAA', 'AAAAAAAAJNJAAAAA', 'AAAAAAAALHEAAAAA') AND i.i_container = 'Unknown' AND sr.sr_customer_sk IN ('61916', '43478', '92201', '83008') AND sr.sr_item_sk IN ('1729', '3840', '8482') AND wr.wr_return_amt_inc_tax IN ('1793.82', '1539.82', '362.24', '311.63', '176.62', '164.88') AND wr.wr_return_ship_cost IN ('78.85', '1576.94', '590.04') GROUP BY c.cp_catalog_page_id, i.i_category ORDER BY total_return_amount DESC, total_web_return_amount_inc_tax DESC;
SELECT p.p_promo_name, COUNT(DISTINCT s.sr_customer_sk) AS num_customers_affected, SUM(s.sr_return_quantity) AS total_returned_quantity, AVG(s.sr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(s.sr_fee) AS total_fees_collected, SUM(s.sr_net_loss) AS total_net_loss, r.r_reason_desc, cd.cd_credit_rating, sm.sm_carrier FROM store_returns s JOIN promotion p ON s.sr_item_sk = p.p_item_sk JOIN reason r ON s.sr_reason_sk = r.r_reason_sk JOIN customer_demographics cd ON s.sr_cdemo_sk = cd.cd_demo_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = s.sr_item_sk WHERE p.p_start_date_sk >= 2450905 AND (s.sr_return_ship_cost = 482.43 OR s.sr_return_ship_cost = 95.68 OR s.sr_return_ship_cost = 82.62 OR s.sr_return_ship_cost = 37.74 OR s.sr_return_ship_cost = 670.08 OR s.sr_return_ship_cost = 40.56) AND p.p_purpose = 'Unknown' AND r.r_reason_sk = 11 GROUP BY p.p_promo_name, r.r_reason_desc, cd.cd_credit_rating, sm.sm_carrier ORDER BY num_customers_affected DESC, total_net_loss DESC;
SELECT p.p_promo_name, COUNT(DISTINCT cs_order_number) AS num_catalog_orders, SUM(cs_net_paid) AS total_catalog_sales, AVG(cs_net_profit) AS avg_catalog_profit, COUNT(DISTINCT ws_order_number) AS num_web_orders, SUM(ws_net_paid) AS total_web_sales, AVG(ws_net_profit) AS avg_web_profit, w.w_warehouse_name, SUM(w.w_warehouse_sq_ft) AS total_warehouse_sq_ft, AVG(w.w_gmt_offset) AS avg_warehouse_gmt_offset FROM promotion p LEFT JOIN catalog_sales cs ON p.p_promo_sk = cs.cs_promo_sk LEFT JOIN web_sales ws ON p.p_promo_sk = ws.ws_promo_sk LEFT JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk OR ws.ws_warehouse_sk = w.w_warehouse_sk WHERE (p.p_start_date_sk IN ('2450692', '2450536', '2450464') OR p.p_end_date_sk IN ('2450692', '2450536', '2450464')) AND (cs.cs_sales_price IS NOT NULL OR ws.ws_sales_price IS NOT NULL) AND (w.w_warehouse_name IS NOT NULL) GROUP BY p.p_promo_name, w.w_warehouse_name ORDER BY total_catalog_sales DESC, total_web_sales DESC;
SELECT d_year, d_quarter_name, sm_type AS shipping_type, COUNT(DISTINCT ss_ticket_number) AS num_sales_transactions, SUM(ss_quantity) AS total_sold_quantity, AVG(ss_sales_price) AS average_sales_price, SUM(ss_net_profit) AS total_sales_net_profit, COUNT(DISTINCT sr_ticket_number) AS num_returns_transactions, SUM(sr_return_quantity) AS total_returned_quantity, AVG(sr_return_amt) AS average_return_amount, SUM(sr_net_loss) AS total_returns_net_loss, AVG(hd_dep_count) AS average_dependency_count, AVG(hd_vehicle_count) AS average_vehicle_count, AVG(ib_lower_bound) AS average_income_lower_bound, AVG(ib_upper_bound) AS average_income_upper_bound FROM store_sales JOIN date_dim ON ss_sold_date_sk = d_date_sk JOIN store_returns ON sr_item_sk = ss_item_sk AND sr_returned_date_sk = ss_sold_date_sk JOIN ship_mode ON sm_ship_mode_sk = ss_sold_date_sk JOIN household_demographics ON ss_hdemo_sk = hd_demo_sk JOIN income_band ON hd_income_band_sk = ib_income_band_sk WHERE d_moy IN (2, 4, 6, 8, 12) AND sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') AND sm_carrier IN ('PRIVATECARRIER', 'DIAMOND') GROUP BY d_year, d_quarter_name, shipping_type ORDER BY d_year, d_quarter_name, shipping_type;
SELECT i.i_brand, i.i_category, sm.sm_type, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_refund_amount, AVG(cr.cr_return_amount) AS avg_refund_amount_per_return, SUM(cr.cr_return_quantity) AS total_returned_quantity FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN time_dim t ON cr.cr_returned_time_sk = t.t_time_sk WHERE t.t_am_pm = 'AM' GROUP BY i.i_brand, i.i_category, sm.sm_type ORDER BY total_refund_amount DESC, i.i_brand, i.i_category, sm.sm_type;
SELECT cd.cd_gender, cd.cd_marital_status, s.s_state, COUNT(wr.wr_order_number) AS total_returns, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount, AVG(wr.wr_return_amt_inc_tax) AS average_return_amount, AVG(wr.wr_fee) AS average_fee FROM web_returns wr JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk JOIN store s ON wr.wr_returning_addr_sk = s.s_store_sk WHERE wr.wr_returning_addr_sk IN (38908, 38512, 43731, 22184, 44035) AND wr.wr_refunded_hdemo_sk IN (3650, 1143, 1326, 7105) AND s.s_state = 'CA' GROUP BY cd.cd_gender, cd.cd_marital_status, s.s_state ORDER BY total_return_amount DESC, total_returns DESC;
SELECT w_state, cp_department, COUNT(DISTINCT cr_order_number) AS num_returns, SUM(cr_return_quantity) AS total_returned_qty, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_amount) AS total_return_amount, SUM(cr_fee) AS total_fees, SUM(cr_return_ship_cost) AS total_shipping_cost, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns JOIN catalog_page ON catalog_returns.cr_catalog_page_sk = catalog_page.cp_catalog_page_sk JOIN warehouse ON catalog_returns.cr_warehouse_sk = warehouse.w_warehouse_sk GROUP BY w_state, cp_department ORDER BY total_return_amount DESC, total_net_loss DESC LIMIT 10;
SELECT i.inv_item_sk, AVG(i.inv_quantity_on_hand) AS avg_quantity_on_hand, AVG(ws.ws_net_profit) AS avg_net_profit, SUM(ws.ws_net_paid_inc_ship_tax) AS total_sales, w.w_warehouse_name, COUNT(DISTINCT ws.ws_order_number) AS orders_count FROM inventory i JOIN warehouse w ON i.inv_warehouse_sk = w.w_warehouse_sk JOIN web_sales ws ON i.inv_item_sk = ws.ws_item_sk AND i.inv_warehouse_sk = ws.ws_warehouse_sk JOIN time_dim td ON ws.ws_sold_time_sk = td.t_time_sk WHERE i.inv_date_sk = '2450815' AND td.t_am_pm = 'AM' AND w.w_city = 'Fairview' AND w.w_warehouse_id = 'AAAAAAAAFAAAAAAA' GROUP BY i.inv_item_sk, w.w_warehouse_name ORDER BY avg_quantity_on_hand DESC, avg_net_profit DESC;
SELECT cp.cp_department, SUM(ws.ws_net_profit) AS total_web_sales_profit, AVG(ws.ws_quantity) AS avg_web_sales_quantity, COUNT(DISTINCT ws.ws_order_number) AS total_web_orders, SUM(cr.cr_net_loss) AS total_catalog_returns_loss, AVG(cr.cr_return_quantity) AS avg_catalog_return_quantity, COUNT(DISTINCT cr.cr_order_number) AS total_catalog_returns, SUM(sr.sr_net_loss) AS total_store_returns_loss, AVG(sr.sr_return_quantity) AS avg_store_return_quantity, COUNT(DISTINCT sr.sr_ticket_number) AS total_store_returns, SUM(CASE WHEN p.p_channel_dmail = 'Y' THEN p.p_cost ELSE 0 END) AS total_promo_cost_via_dmail, COUNT(CASE WHEN p.p_channel_demo = 'N' AND p.p_channel_catalog = 'N' THEN p.p_promo_sk END) AS count_non_demo_catalog_promos FROM catalog_page cp LEFT JOIN web_sales ws ON cp.cp_catalog_page_sk = ws.ws_web_page_sk LEFT JOIN catalog_returns cr ON cp.cp_catalog_page_sk = cr.cr_catalog_page_sk LEFT JOIN store_returns sr ON sr.sr_item_sk = ws.ws_item_sk LEFT JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk WHERE cp.cp_start_date_sk IS NOT NULL AND cp.cp_end_date_sk IS NOT NULL AND ws.ws_sold_date_sk BETWEEN cp.cp_start_date_sk AND cp.cp_end_date_sk GROUP BY cp.cp_department ORDER BY total_web_sales_profit DESC, total_catalog_returns_loss ASC, total_store_returns_loss ASC;
SELECT cc.cc_division_name, COUNT(DISTINCT cc.cc_call_center_sk) AS num_call_centers, SUM(cc.cc_employees) AS total_employees, AVG(cc.cc_employees) AS avg_employees, SUM(cc.cc_sq_ft) AS total_square_footage, AVG(cc.cc_sq_ft) AS avg_square_footage, COUNT(DISTINCT cp.cp_catalog_page_sk) AS num_catalog_pages, AVG(cp.cp_catalog_number) AS avg_catalog_number, COUNT(DISTINCT r.r_reason_sk) AS num_reasons, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses, SUM(w.w_warehouse_sq_ft) AS total_warehouse_square_footage, AVG(ib.ib_lower_bound) AS avg_income_band_lower_bound, AVG(ib.ib_upper_bound) AS avg_income_band_upper_bound FROM call_center cc LEFT JOIN catalog_page cp ON cc.cc_call_center_sk = cp.cp_catalog_page_sk LEFT JOIN reason r ON cc.cc_call_center_sk = r.r_reason_sk LEFT JOIN warehouse w ON cc.cc_call_center_sk = w.w_warehouse_sk LEFT JOIN income_band ib ON cc.cc_call_center_sk = ib.ib_income_band_sk WHERE cc.cc_division_name IN ('ese', 'ought') GROUP BY cc.cc_division_name ORDER BY cc.cc_division_name;
SELECT s_store_name, cd_gender, cd_marital_status, cd_education_status, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_revenue, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT c_customer_sk) AS unique_customers, SUM(wr_return_quantity) AS total_return_quantity, SUM(wr_return_amt) AS total_return_amount, AVG(wr_fee) AS average_return_fee FROM store_sales JOIN store ON ss_store_sk = s_store_sk JOIN customer ON ss_customer_sk = c_customer_sk JOIN customer_demographics ON ss_cdemo_sk = cd_demo_sk LEFT JOIN web_returns ON ss_item_sk = wr_item_sk AND ss_ticket_number = wr_order_number WHERE ss_sold_date_sk BETWEEN 20020101 AND 20020131 AND cd_purchase_estimate > 10000 AND s_number_employees BETWEEN 50 AND 200 AND (wr_returned_date_sk IS NULL OR wr_returned_date_sk BETWEEN 20020201 AND 20020228) GROUP BY s_store_name, cd_gender, cd_marital_status, cd_education_status ORDER BY total_revenue DESC, s_store_name, cd_gender, cd_marital_status, cd_education_status;
SELECT s.s_store_name, COUNT(sr.sr_ticket_number) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, SUM(sr.sr_return_amt) AS total_refund_amount, AVG(sr.sr_return_amt) AS average_refund_amount, SUM(sr.sr_fee) AS total_fees_collected, r.r_reason_desc AS return_reason, d.d_year AS return_year, d.d_quarter_name AS return_quarter FROM store_returns sr JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN date_dim d ON sr.sr_returned_date_sk = d.d_date_sk JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE s.s_company_id = '1' AND s.s_gmt_offset = '-5.00' AND sr.sr_reason_sk IN ('24', '25', '31', '13', '17', '4') AND sr.sr_returned_date_sk IS NOT NULL GROUP BY s.s_store_name, r.r_reason_desc, d.d_year, d.d_quarter_name ORDER BY s.s_store_name, total_returns DESC, total_refund_amount DESC;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(wr.wr_return_quantity) AS total_quantity_returned, SUM(wr.wr_net_loss) AS total_net_loss, COUNT(DISTINCT sm.sm_ship_mode_sk) AS shipping_modes_used FROM call_center cc JOIN catalog_sales cs ON cc.cc_call_center_sk = cs.cs_call_center_sk JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number LEFT JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk WHERE cc.cc_open_date_sk IS NOT NULL AND (wr.wr_item_sk = '10174' OR wr.wr_item_sk = '3888') AND wr.wr_web_page_sk = '37' GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY total_net_loss DESC, total_quantity_sold DESC, unique_customers DESC;
SELECT ca_state, cd_gender, cd_marital_status, sm_type, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(sr_return_quantity) AS total_quantity_returned, AVG(sr_return_amt) AS average_return_amount, SUM(sr_net_loss) AS total_net_loss FROM store_sales JOIN customer_address ON ss_addr_sk = ca_address_sk JOIN customer_demographics ON ss_cdemo_sk = cd_demo_sk JOIN ship_mode ON sm_ship_mode_sk = ss_promo_sk LEFT JOIN store_returns ON sr_ticket_number = ss_ticket_number AND sr_item_sk = ss_item_sk WHERE ca_state IS NOT NULL AND cd_gender IN ('M', 'F') AND cd_marital_status IN ('M', 'U', 'S', 'D') GROUP BY ca_state, cd_gender, cd_marital_status, sm_type ORDER BY total_quantity_sold DESC, average_sales_price DESC;
SELECT cc.cc_state, SUM(ss.ss_net_paid) AS total_net_sales, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT cc.cc_call_center_sk) AS number_of_call_centers, SUM(cc.cc_employees) AS total_employees FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk WHERE cc.cc_rec_start_date <= CURRENT_DATE AND (cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date > CURRENT_DATE) AND ss.ss_sold_date_sk BETWEEN cc.cc_open_date_sk AND COALESCE(cc.cc_closed_date_sk, ss.ss_sold_date_sk) GROUP BY cc.cc_state ORDER BY total_net_sales DESC, average_sales_price DESC;
SELECT p.p_promo_id AS promotion_id, p.p_promo_name AS promotion_name, p.p_channel_dmail AS channel_direct_mail, p.p_channel_email AS channel_email, p.p_channel_catalog AS channel_catalog, p.p_channel_tv AS channel_tv, p.p_channel_radio AS channel_radio, p.p_channel_press AS channel_press, p.p_channel_event AS channel_event, p.p_channel_demo AS channel_demo, s.s_state AS store_state, SUM(sr.sr_return_amt_inc_tax) AS total_returns_incl_tax, SUM(sr.sr_return_quantity) AS total_returned_quantity, COUNT(sr.sr_ticket_number) AS total_return_transactions, AVG(sr.sr_return_amt) AS avg_return_amount, AVG(sr.sr_return_amt_inc_tax) AS avg_return_amount_incl_tax FROM promotion p JOIN store_returns sr ON p.p_promo_sk = sr.sr_reason_sk JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN date_dim d ON sr.sr_returned_date_sk = d.d_date_sk WHERE d.d_fy_year = 2003 AND p.p_discount_active = 'Y' GROUP BY p.p_promo_id, p.p_promo_name, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo, s.s_state ORDER BY total_returns_incl_tax DESC, promotion_id;
SELECT cp.cp_department, i.i_category, sum(ss.ss_quantity) AS total_quantity_sold, avg(ss.ss_sales_price) AS average_sales_price, count(DISTINCT w.w_warehouse_sk) AS number_of_warehouses, count(DISTINCT ss.ss_customer_sk) AS number_of_customers, sum(wr.wr_return_quantity) AS total_quantity_returned, sum(wr.wr_return_amt) AS total_return_amount FROM catalog_page cp JOIN item i ON cp.cp_catalog_page_sk = i.i_item_sk JOIN store_sales ss ON i.i_item_sk = ss.ss_item_sk JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk LEFT JOIN web_returns wr ON i.i_item_sk = wr.wr_item_sk WHERE cp.cp_department LIKE 'DEPARTMENT%' AND i.i_manager_id IN ('54', '71', '14') AND i.i_brand_id IN ('7014003', '9006005', '10012001') AND cp.cp_catalog_page_number IN ('24', '68', '70', '62', '42') AND w.w_warehouse_id IN ('AAAAAAAAFAAAAAAA', 'AAAAAAAACAAAAAAA', 'AAAAAAAABAAAAAAA') GROUP BY cp.cp_department, i.i_category;
SELECT cpg.cp_department, it.i_category, SUM(cs.cs_quantity) AS total_quantity, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_net_profit) AS total_net_profit FROM catalog_sales cs JOIN item it ON cs.cs_item_sk = it.i_item_sk JOIN catalog_page cpg ON cs.cs_catalog_page_sk = cpg.cp_catalog_page_sk JOIN web_site ws ON cpg.cp_catalog_number = ws.web_mkt_id WHERE it.i_category_id IS NOT NULL AND cpg.cp_department IS NOT NULL AND ws.web_class <> 'Unknown' GROUP BY cpg.cp_department, it.i_category ORDER BY total_net_profit DESC, cpg.cp_department, it.i_category;
SELECT w_state, COUNT(DISTINCT c.c_customer_sk) AS num_customers, COUNT(DISTINCT s.s_store_sk) AS num_stores, SUM(i.inv_quantity_on_hand) AS total_inventory, AVG(s.s_number_employees) AS avg_store_employees, AVG(wp.wp_link_count) AS avg_webpage_link_count FROM warehouse w JOIN inventory i ON w.w_warehouse_sk = i.inv_warehouse_sk JOIN web_page wp ON wp.wp_rec_end_date > CURRENT_DATE JOIN store s ON s.s_state = w.w_state JOIN customer c ON c.c_current_addr_sk = s.s_store_sk WHERE i.inv_quantity_on_hand BETWEEN 200 AND 1000 AND wp.wp_max_ad_count BETWEEN 1 AND 3 GROUP BY w_state ORDER BY total_inventory DESC;
SELECT s.s_store_name, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_items_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_ext_discount_amt) AS total_discount_amount, SUM(ss.ss_net_paid) AS total_net_sales, SUM(ss.ss_net_paid_inc_tax) AS net_sales_including_tax, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(DISTINCT wr.wr_order_number) AS total_returns_transactions, SUM(wr.wr_return_quantity) AS total_items_returned, AVG(wr.wr_return_amt) AS average_return_amount, SUM(wr.wr_fee) AS total_return_fees, SUM(wr.wr_net_loss) AS total_net_loss FROM store s JOIN store_sales ss ON s.s_store_sk = ss.ss_store_sk LEFT JOIN web_returns wr ON ss.ss_item_sk = wr.wr_item_sk AND ss.ss_ticket_number = wr.wr_order_number WHERE s.s_county = 'Williamson County' AND ss.ss_coupon_amt IN (215.60, 1007.22, 1869.51) GROUP BY s.s_store_name ORDER BY s.s_store_name;
SELECT cr.cr_returned_date_sk AS return_date, wp.wp_type AS web_page_type, COUNT(cr.cr_order_number) AS total_returns, SUM(cr.cr_return_quantity) AS total_returned_quantity, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_return_amt_inc_tax) AS total_return_amount_including_tax, SUM(ws.ws_quantity) AS total_sold_quantity, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_profit) AS total_net_profit FROM catalog_returns cr JOIN web_sales ws ON cr.cr_item_sk = ws.ws_item_sk AND cr.cr_order_number = ws.ws_order_number JOIN web_page wp ON ws.ws_web_page_sk = wp.wp_web_page_sk GROUP BY cr.cr_returned_date_sk, wp.wp_type ORDER BY cr.cr_returned_date_sk, wp.wp_type;
SELECT i_category, i_class, COUNT(DISTINCT ss_ticket_number) AS total_sales_transactions, SUM(ss_sales_price) AS total_sales_revenue, AVG(ss_sales_price) AS avg_sales_price, SUM(cr_return_amount) AS total_return_revenue, AVG(cr_return_amount) AS avg_return_amount, SUM(sr_return_amt) AS total_store_return_revenue, AVG(sr_return_amt) AS avg_store_return_amount, (SUM(ss_sales_price) - SUM(cr_return_amount) - SUM(sr_return_amt)) AS net_revenue, SUM(inv_quantity_on_hand) AS total_inventory_quantity, COUNT(DISTINCT inv_warehouse_sk) AS num_warehouses_stocking FROM item LEFT JOIN store_sales ON store_sales.ss_item_sk = item.i_item_sk LEFT JOIN catalog_returns ON catalog_returns.cr_item_sk = item.i_item_sk LEFT JOIN store_returns ON store_returns.sr_item_sk = item.i_item_sk LEFT JOIN inventory ON inventory.inv_item_sk = item.i_item_sk WHERE i_manufact = 'oughtought' AND (inventory.inv_item_sk = 14212 OR inventory.inv_item_sk = 6826) AND inventory.inv_date_sk = 2450815 AND store_sales.ss_list_price = 145.48 GROUP BY i_category, i_class ORDER BY net_revenue DESC;
SELECT ca.ca_state, i.i_category, COUNT(cs.cs_order_number) AS total_orders, SUM(cs.cs_ext_sales_price) AS total_sales, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(inv.inv_quantity_on_hand) AS total_inventory FROM catalog_sales cs JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk JOIN item i ON cs.cs_item_sk = i.i_item_sk JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk AND cs.cs_sold_date_sk = inv.inv_date_sk WHERE cs.cs_wholesale_cost != 26.15 AND i.i_item_sk IN (2, 27, 23, 43, 36, 38) AND inv.inv_date_sk = 2450815 GROUP BY ca.ca_state, i.i_category ORDER BY total_sales DESC, ca.ca_state, i.i_category;
SELECT d.d_year, d.d_month_seq, COUNT(DISTINCT cp.cp_catalog_page_sk) AS total_catalog_pages, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_size, SUM(p.p_cost) AS total_promotion_cost, COUNT(DISTINCT ca.ca_state) AS num_states_with_customers, COUNT(DISTINCT w.w_state) AS num_states_with_warehouses, SUM(CASE WHEN p.p_channel_press = 'N' THEN p.p_cost ELSE 0 END) AS total_cost_non_press_channel FROM date_dim d JOIN catalog_page cp ON (d.d_date_sk = cp.cp_start_date_sk OR d.d_date_sk = cp.cp_end_date_sk) JOIN promotion p ON (p.p_start_date_sk = d.d_date_sk OR p.p_end_date_sk = d.d_date_sk) JOIN customer_address ca ON cp.cp_catalog_page_sk = ca.ca_address_sk JOIN warehouse w ON w.w_zip = ca.ca_zip WHERE d.d_fy_quarter_seq IN (41, 35, 15, 54, 14, 9) AND cp.cp_catalog_number IN (27, 41) AND d.d_year = 2023 GROUP BY d.d_year, d.d_month_seq ORDER BY d.d_year, d.d_month_seq;
SELECT cp.cp_department, cp.cp_catalog_number, sm.sm_carrier, COUNT(*) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt_inc_tax) AS average_return_amount_inc_tax, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN catalog_page cp ON sr.sr_item_sk = cp.cp_catalog_page_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = sr.sr_item_sk WHERE cp.cp_catalog_page_number IN (20, 88, 103, 108, 56, 9) AND cp.cp_catalog_page_id IN ('AAAAAAAAMECBAAAA', 'AAAAAAAAPENAAAAA', 'AAAAAAAAHKMAAAAA', 'AAAAAAAADBGAAAAA', 'AAAAAAAADEPAAAAA', 'AAAAAAAALIDAAAAA') AND sm.sm_ship_mode_id IN ('AAAAAAAAABAAAAAA', 'AAAAAAAACBAAAAAA', 'AAAAAAAAJAAAAAAA', 'AAAAAAAAFAAAAAAA', 'AAAAAAAAEBAAAAAA') AND sm.sm_carrier IN ('TBS', 'DIAMOND', 'AIRBORNE', 'GREAT EASTERN', 'LATVIAN') GROUP BY cp.cp_department, cp.cp_catalog_number, sm.sm_carrier;
SELECT dd.d_year, dd.d_quarter_name, sm.sm_type, COUNT(DISTINCT ws.web_site_sk) AS num_websites, COUNT(DISTINCT cc.cc_call_center_sk) AS num_call_centers, COUNT(DISTINCT st.s_store_sk) AS num_stores, SUM(wr.wr_return_amt) AS total_return_amount, AVG(st.s_number_employees) AS avg_store_employees, AVG(wr.wr_fee) AS avg_return_fee FROM date_dim dd JOIN web_returns wr ON dd.d_date_sk = wr.wr_returned_date_sk JOIN web_site ws ON wr.wr_web_page_sk = ws.web_site_sk JOIN call_center cc ON ws.web_market_manager = cc.cc_manager JOIN store st ON cc.cc_mkt_id = st.s_market_id JOIN ship_mode sm ON sm.sm_ship_mode_sk = wr.wr_item_sk WHERE dd.d_dom = 7 AND dd.d_weekend = 'Y' AND st.s_country = 'United States' AND st.s_number_employees IN (271, 297) AND sm.sm_type IN ('LIBRARY', 'REGULAR', 'TWO DAY', 'OVERNIGHT') AND sm.sm_contract IN ('P7FBIt8yd', 'Xjy3ZPuiDjzHlRx14Z3', '2mM8l', 'Ek') AND ws.web_zip IN ('35709', '31904') AND ws.web_street_number IN ('671', '247', '973', '730') GROUP BY dd.d_year, dd.d_quarter_name, sm.sm_type ORDER BY total_return_amount DESC, avg_store_employees DESC;
SELECT w_warehouse_name, cd_credit_rating, AVG(cr_return_amount) AS avg_return_amount, SUM(cr_return_quantity) AS total_return_quantity, COUNT(DISTINCT cr_order_number) AS total_orders_returned, SUM(cr_net_loss) AS total_net_loss FROM catalog_returns INNER JOIN warehouse ON catalog_returns.cr_warehouse_sk = warehouse.w_warehouse_sk INNER JOIN customer_demographics ON catalog_returns.cr_refunded_cdemo_sk = customer_demographics.cd_demo_sk INNER JOIN household_demographics ON catalog_returns.cr_refunded_hdemo_sk = household_demographics.hd_demo_sk WHERE cr_returned_date_sk IN (2451154, 2451037, 2450875, 2450957, 2450981) AND household_demographics.hd_income_band_sk IN ('12', '7', '9', '5', '16', '3') AND household_demographics.hd_vehicle_count = 3 AND customer_demographics.cd_dep_employed_count = 0 AND catalog_returns.cr_store_credit IN (950.05, 59.82, 39.71) GROUP BY w_warehouse_name, cd_credit_rating ORDER BY total_net_loss DESC, avg_return_amount DESC;
SELECT cp.cp_department, COUNT(*) AS total_catalog_pages, AVG(cp.cp_catalog_number) AS average_catalog_number, SUM(inv.inv_quantity_on_hand) AS total_inventory_quantity, AVG(wr.wr_return_amt_inc_tax) AS average_return_amount_inc_tax, COUNT(DISTINCT wr.wr_order_number) AS total_returned_orders, COUNT(DISTINCT cd.cd_demo_sk) AS unique_customers, SUM(CASE WHEN hd.hd_income_band_sk IS NOT NULL THEN 1 ELSE 0 END) AS households_with_income_band, sm.sm_type AS shipping_type, COUNT(DISTINCT sm.sm_ship_mode_sk) AS count_shipping_modes, ROUND(SUM(wr.wr_fee)::numeric, 2) AS total_fees_collected, ROUND(SUM(wr.wr_reversed_charge)::numeric, 2) AS total_reversed_charges FROM catalog_page cp LEFT JOIN inventory inv ON cp.cp_catalog_page_sk = inv.inv_item_sk LEFT JOIN web_returns wr ON inv.inv_item_sk = wr.wr_item_sk LEFT JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk LEFT JOIN household_demographics hd ON wr.wr_returning_hdemo_sk = hd.hd_demo_sk LEFT JOIN ship_mode sm ON sm.sm_ship_mode_sk IN (9, 10) WHERE cp.cp_start_date_sk IS NOT NULL AND cp.cp_end_date_sk IS NOT NULL AND (wr.wr_reversed_charge IN ('35.79', '219.13', '107.56', '7.03') OR wr.wr_fee IN ('60.42', '16.01', '7.56', '22.38')) AND (inv.inv_quantity_on_hand IN (932, 682, 540) OR inv.inv_item_sk IN (12650, 13507, 12682, 13526)) GROUP BY cp.cp_department, sm.sm_type ORDER BY total_catalog_pages DESC, average_return_amount_inc_tax DESC;
SELECT ca_state, sm_type, COUNT(DISTINCT ca_address_sk) AS num_addresses, AVG(w_warehouse_sq_ft) AS avg_warehouse_sq_ft, SUM(CASE WHEN ib_upper_bound <= 70000 THEN 1 ELSE 0 END) AS count_income_band_70k_and_below, SUM(CASE WHEN ib_upper_bound > 70000 AND ib_upper_bound <= 80000 THEN 1 ELSE 0 END) AS count_income_band_70k_to_80k FROM customer_address JOIN warehouse ON ca_county = w_county AND ca_state = w_state JOIN ship_mode ON ca_zip = LEFT(w_zip, 5) JOIN income_band ON ca_gmt_offset = w_gmt_offset WHERE ca_street_name IN ('Sixth 2nd', 'Lincoln 5th', '15th Broadway') AND sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') GROUP BY ca_state, sm_type ORDER BY ca_state, sm_type;
SELECT w.w_warehouse_name, w.w_warehouse_sq_ft, AVG(i.inv_quantity_on_hand) AS avg_quantity_on_hand, COUNT(DISTINCT p.p_promo_sk) AS num_promotions, SUM(CASE WHEN p.p_discount_active = 'Y' THEN 1 ELSE 0 END) AS active_discounts FROM warehouse w JOIN inventory i ON w.w_warehouse_sk = i.inv_warehouse_sk LEFT JOIN promotion p ON i.inv_item_sk = p.p_item_sk WHERE w.w_city = 'Fairview' GROUP BY w.w_warehouse_sk, w.w_warehouse_name, w.w_warehouse_sq_ft ORDER BY w.w_warehouse_name;
SELECT s.s_store_name, i.i_category, r.r_reason_desc, COUNT(DISTINCT wr_order_number) AS total_returns, SUM(wr_return_quantity) AS total_returned_quantity, AVG(wr_return_amt) AS avg_return_amount, AVG(wr_return_ship_cost) AS avg_shipping_cost, SUM(wr_net_loss) AS total_net_loss FROM web_returns wr JOIN store s ON s.s_store_sk = wr.wr_refunded_addr_sk JOIN item i ON i.i_item_sk = wr.wr_item_sk JOIN reason r ON r.r_reason_sk = wr.wr_reason_sk WHERE s.s_market_id = 7 AND s.s_rec_start_date IN ('2001-03-13', '1997-03-13') AND i.i_manager_id = 52 AND wr.wr_reason_sk = 13 GROUP BY ROLLUP(s.s_store_name, i.i_category, r.r_reason_desc) ORDER BY s.s_store_name, i.i_category, r.r_reason_desc;
SELECT i.i_category AS category, ca.ca_state AS customer_state, EXTRACT(MONTH FROM (DATE '1970-01-01' + c.c_first_sales_date_sk * INTERVAL '1 day')) AS sale_month, COUNT(DISTINCT s.s_store_sk) AS num_stores, SUM(i.i_current_price) AS total_sales_amount, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, COUNT(i.i_item_sk) AS items_sold, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_amt) AS avg_return_amount, COUNT(sr.sr_item_sk) AS items_returned FROM store s JOIN customer c ON s.s_store_sk = c.c_current_addr_sk JOIN item i ON s.s_store_sk = i.i_manufact_id JOIN store_returns sr ON i.i_item_sk = sr.sr_item_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk WHERE ca.ca_state IN ('TN', 'DE', 'VA', 'CO') AND i.i_category_id IS NOT NULL AND c.c_first_sales_date_sk IS NOT NULL AND (c.c_birth_month = 1 OR c.c_birth_month IS NULL) AND sr.sr_returned_date_sk IS NOT NULL GROUP BY category, customer_state, sale_month ORDER BY total_sales_amount DESC, avg_wholesale_cost DESC, total_return_amount DESC LIMIT 100;
SELECT cd.cd_education_status, cd.cd_marital_status, CASE WHEN cd.cd_purchase_estimate < 2000 THEN 'Low' WHEN cd.cd_purchase_estimate BETWEEN 2000 AND 3500 THEN 'Medium' WHEN cd.cd_purchase_estimate > 3500 THEN 'High' ELSE 'Unknown' END AS purchase_estimate_range, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_paid) AS total_revenue, AVG(ws.ws_net_paid) AS average_revenue_per_order, COUNT(DISTINCT ws.ws_bill_customer_sk) AS total_customers FROM web_sales ws JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk JOIN time_dim t ON ws.ws_sold_time_sk = t.t_time_sk JOIN web_site wsit ON ws.ws_web_site_sk = wsit.web_site_sk WHERE wsit.web_market_manager = 'Jeffrey Campbell' AND t.t_shift = 'third' AND cd.cd_dep_college_count = 0 GROUP BY cd.cd_education_status, cd.cd_marital_status, purchase_estimate_range ORDER BY total_revenue DESC;
SELECT d_year, d_quarter_name, s_state, COUNT(DISTINCT s_store_sk) AS number_of_stores, SUM(s_number_employees) AS total_employees, AVG(s_floor_space) AS avg_floor_space, SUM(wp_char_count) AS total_char_count, AVG(wp_link_count) AS avg_link_count, AVG(wp_image_count) AS avg_image_count, COUNT(DISTINCT wp_web_page_sk) AS number_of_web_pages, SUM(CASE WHEN wp_max_ad_count = 3 THEN 1 ELSE 0 END) AS count_max_ad_3, AVG(s_tax_precentage) AS avg_tax_percentage FROM store JOIN date_dim ON s_rec_end_date = d_date LEFT JOIN web_page ON wp_access_date_sk = d_date_sk WHERE s_rec_end_date BETWEEN '1999-01-01' AND '2001-12-31' AND wp_url LIKE 'http://www.foo.com%' AND wp_max_ad_count IN ('1', '2', '3', '4') GROUP BY d_year, d_quarter_name, s_state ORDER BY d_year DESC, d_quarter_name, s_state;
SELECT cc.cc_name, cc.cc_city, st.s_store_name, st.s_city, SUM(ss.ss_net_profit) AS total_net_profit, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_quantity) AS total_quantity_sold, COUNT(DISTINCT ss.ss_ticket_number) AS number_of_sales_transactions FROM call_center AS cc JOIN store_sales AS ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN store AS st ON ss.ss_store_sk = st.s_store_sk WHERE cc.cc_rec_start_date >= '2020-01-01' AND cc.cc_rec_end_date <= '2020-12-31' AND ss.ss_wholesale_cost BETWEEN 40 AND 90 AND (st.s_city = 'Fairview' OR st.s_city = 'Midway') AND cc.cc_employees >= 3 GROUP BY cc.cc_name, cc.cc_city, st.s_store_name, st.s_city HAVING SUM(ss.ss_net_profit) > 0 ORDER BY total_net_profit DESC, average_sales_price DESC;
SELECT cc_state, ca_location_type, COUNT(DISTINCT ws_order_number) AS total_orders, SUM(ws_quantity) AS total_quantity_sold, AVG(ws_sales_price) AS avg_sales_price, SUM(ws_net_paid) AS total_net_paid, SUM(ws_net_profit) AS total_net_profit FROM web_sales ws JOIN store s ON ws.ws_bill_addr_sk = s.s_store_sk JOIN call_center cc ON cc.cc_call_center_sk = ws.ws_ship_mode_sk JOIN customer_address ca ON ws.ws_bill_addr_sk = ca.ca_address_sk JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk WHERE ws.ws_item_sk IN (70, 58, 77) AND hd.hd_dep_count BETWEEN 1 AND 9 AND ca.ca_location_type IN ('single family', 'apartment', 'condo') AND ca.ca_city IN ('Ferguson', 'Holiday Hills') GROUP BY cc_state, ca_location_type ORDER BY total_net_profit DESC, total_net_paid DESC;
SELECT dd.d_year, dd.d_quarter_name, SUM(cs.cs_net_paid_inc_ship) AS total_revenue, AVG(cs.cs_quantity) AS average_quantity_sold, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(CASE WHEN cd.cd_gender = 'F' THEN cs.cs_net_paid_inc_ship ELSE 0 END) AS female_total_revenue, SUM(CASE WHEN cd.cd_gender = 'M' THEN cs.cs_net_paid_inc_ship ELSE 0 END) AS male_total_revenue, COUNT(DISTINCT CASE WHEN ib.ib_upper_bound <= 50000 THEN cs.cs_bill_customer_sk END) AS customers_low_income, COUNT(DISTINCT CASE WHEN ib.ib_upper_bound > 50000 AND ib.ib_upper_bound <= 150000 THEN cs.cs_bill_customer_sk END) AS customers_mid_income, COUNT(DISTINCT CASE WHEN ib.ib_upper_bound > 150000 THEN cs.cs_bill_customer_sk END) AS customers_high_income, COUNT(DISTINCT sm.sm_ship_mode_sk) AS shipping_modes_used, COUNT(DISTINCT w.w_warehouse_sk) AS warehouses_used, COUNT(DISTINCT p.p_promo_sk) AS promotions_run FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk LEFT JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound WHERE dd.d_year IN (2020, 2021) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT web_name, SUM(p_cost) AS total_promotion_cost, AVG(inv_quantity_on_hand) AS avg_inventory_quantity, COUNT(DISTINCT c_customer_sk) AS unique_customer_count, COUNT(DISTINCT r_reason_sk) AS unique_reason_count FROM web_site JOIN promotion ON (web_close_date_sk BETWEEN p_start_date_sk AND p_end_date_sk) JOIN inventory ON (inv_date_sk BETWEEN p_start_date_sk AND p_end_date_sk) JOIN customer ON (c_first_sales_date_sk BETWEEN p_start_date_sk AND p_end_date_sk) LEFT JOIN reason ON (c_last_review_date_sk = r_reason_sk) WHERE p_channel_press = 'N' AND inv_warehouse_sk IN (1, 2) AND p_end_date_sk IN (2450816, 2450598, 2450185, 2450481) GROUP BY web_name ORDER BY total_promotion_cost DESC, avg_inventory_quantity DESC, unique_customer_count DESC, unique_reason_count DESC;
SELECT sm.sm_ship_mode_id, sm.sm_type, cd.cd_credit_rating, COUNT(DISTINCT ws.ws_order_number) AS total_sales_transactions, AVG(ws.ws_net_paid_inc_tax) AS avg_sales_amount, COUNT(DISTINCT cr.cr_order_number) AS total_return_transactions, AVG(cr.cr_return_amt_inc_tax) AS avg_return_amount, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(cr.cr_return_quantity) AS total_quantity_returned FROM ship_mode sm LEFT JOIN web_sales ws ON sm.sm_ship_mode_sk = ws.ws_ship_mode_sk LEFT JOIN catalog_returns cr ON ws.ws_order_number = cr.cr_order_number LEFT JOIN customer_demographics cd ON ws.ws_ship_cdemo_sk = cd.cd_demo_sk WHERE sm.sm_ship_mode_id IN ('AAAAAAAANAAAAAAA', 'AAAAAAAADBAAAAAA', 'AAAAAAAADAAAAAAA', 'AAAAAAAACAAAAAAA') AND cd.cd_credit_rating IN ('Low Risk', 'High Risk', 'Unknown', 'Good') GROUP BY sm.sm_ship_mode_id, sm.sm_type, cd.cd_credit_rating ORDER BY sm.sm_ship_mode_id, cd.cd_credit_rating;
SELECT cd.cd_education_status, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_type, AVG(cd.cd_purchase_estimate) AS average_purchase_estimate, COUNT(cd.cd_demo_sk) AS customer_count, AVG(w.web_tax_percentage) AS average_tax_percentage FROM customer_demographics cd JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound JOIN ship_mode sm ON sm.sm_contract = 'qENFQ' AND sm.sm_type IN ('EXPRESS', 'LIBRARY', 'OVERNIGHT', 'TWO DAY') JOIN web_site w ON w.web_class IN ('B2C', 'B2B', 'Small Business', 'Enterprise') AND w.web_tax_percentage IS NOT NULL WHERE cd.cd_education_status IN ('College', 'Secondary', '2 yr Degree', 'Primary') AND cd.cd_purchase_estimate IN (1000, 2500, 7000, 3000) AND sm.sm_type IN ('EXPRESS', 'LIBRARY', 'OVERNIGHT', 'TWO DAY') GROUP BY cd.cd_education_status, ib.ib_lower_bound, ib.ib_upper_bound, sm.sm_type ORDER BY cd.cd_education_status, ib.ib_lower_bound, sm.sm_type;
SELECT s.s_store_id, s.s_zip, cs.cs_sold_date_sk, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_ext_sales_price) AS total_sales, SUM(cs.cs_net_paid) AS net_paid, SUM(cs.cs_net_paid_inc_tax) AS net_paid_inc_tax, SUM(cs.cs_net_profit) AS net_profit, COUNT(DISTINCT cs.cs_order_number) AS total_orders, AVG(sr.sr_return_amt) AS avg_return_amt, SUM(sr.sr_return_quantity) AS total_return_quantity, SUM(sr.sr_net_loss) AS net_loss FROM catalog_sales cs JOIN store s ON cs.cs_ship_customer_sk = s.s_store_sk LEFT JOIN store_returns sr ON cs.cs_item_sk = sr.sr_item_sk AND cs.cs_order_number = sr.sr_ticket_number WHERE s.s_store_id = 'AAAAAAAACAAAAAAA' AND s.s_zip = '35709' GROUP BY s.s_store_id, s.s_zip, cs.cs_sold_date_sk ORDER BY cs.cs_sold_date_sk DESC;
SELECT ca_state, cd_education_status, AVG(cs_net_paid) AS avg_sales_amount, SUM(cs_net_paid) AS total_sales_amount, COUNT(DISTINCT cs_bill_customer_sk) AS unique_customers FROM catalog_sales JOIN date_dim ON catalog_sales.cs_sold_date_sk = date_dim.d_date_sk JOIN customer_demographics ON catalog_sales.cs_bill_cdemo_sk = customer_demographics.cd_demo_sk JOIN customer_address ON catalog_sales.cs_bill_addr_sk = customer_address.ca_address_sk WHERE date_dim.d_quarter_name IN ('1901Q4', '1913Q3', '1902Q3') AND date_dim.d_current_quarter = 'N' AND customer_address.ca_county IN ('Claiborne County', 'Scott County', 'Borden County', 'Juneau County') GROUP BY ca_state, cd_education_status ORDER BY ca_state, cd_education_status, total_sales_amount DESC;
SELECT p.p_promo_name, p.p_start_date_sk, p.p_end_date_sk, SUM(cs.cs_net_paid) AS total_sales, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS order_count, SUM(inv.inv_quantity_on_hand) AS total_inventory_quantity FROM catalog_sales cs JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk JOIN inventory inv ON cs.cs_item_sk = inv.inv_item_sk JOIN web_site ws ON cs.cs_warehouse_sk = ws.web_site_sk WHERE inv.inv_quantity_on_hand >= 500 AND ws.web_mkt_class = 'Well-known, patient proposals m' AND p.p_purpose <> 'Unknown' AND ws.web_site_id IN ('AAAAAAAAJBAAAAAA', 'AAAAAAAACAAAAAAA') GROUP BY p.p_promo_name, p.p_start_date_sk, p.p_end_date_sk ORDER BY total_sales DESC, average_sales_price DESC;
SELECT st.s_store_name AS store_name, SUM(sales.ss_net_paid) AS total_sales, AVG(sales.ss_quantity) AS average_quantity_sold, COUNT(DISTINCT customer.c_customer_sk) AS unique_customers, cd.cd_education_status AS education_status, cd.cd_gender AS gender, COUNT(promo.p_promo_sk) AS promotion_count, AVG(promo.p_cost) AS average_promotion_cost FROM store_sales sales JOIN store st ON sales.ss_store_sk = st.s_store_sk JOIN customer ON sales.ss_customer_sk = customer.c_customer_sk JOIN customer_demographics cd ON customer.c_current_cdemo_sk = cd.cd_demo_sk JOIN promotion promo ON sales.ss_promo_sk = promo.p_promo_sk WHERE st.s_hours IN ('8AM-12AM', '8AM-4PM') AND cd.cd_education_status IN ('Unknown', 'Advanced Degree', '2 yr Degree', 'College') AND cd.cd_gender IN ('M', 'F') AND sales.ss_sold_date_sk BETWEEN promo.p_start_date_sk AND promo.p_end_date_sk GROUP BY st.s_store_name, cd.cd_education_status, cd.cd_gender ORDER BY total_sales DESC, average_quantity_sold DESC;
SELECT dd.d_year, dd.d_moy, sm.sm_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_net_paid) AS total_net_sales, AVG(cs.cs_net_paid) AS avg_net_sales_per_order, SUM(sr.sr_return_quantity) AS total_quantity_returned, SUM(sr.sr_net_loss) AS total_net_loss, AVG(sr.sr_net_loss) AS avg_net_loss_per_return, SUM(wr.wr_return_quantity) AS total_web_quantity_returned, SUM(wr.wr_net_loss) AS total_web_net_loss, AVG(wr.wr_net_loss) AS avg_web_net_loss_per_return, COUNT(DISTINCT hd.hd_demo_sk) AS unique_customers FROM date_dim dd LEFT JOIN catalog_sales cs ON dd.d_date_sk = cs.cs_sold_date_sk LEFT JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk LEFT JOIN web_returns wr ON dd.d_date_sk = wr.wr_returned_date_sk LEFT JOIN ship_mode sm ON cs.cs_ship_mode_sk = sm.sm_ship_mode_sk LEFT JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk WHERE dd.d_year = 2003 AND sm.sm_carrier IN ('ZOUROS', 'ALLIANCE', 'GREAT EASTERN') AND hd.hd_income_band_sk IN (10, 3, 16) AND hd.hd_buy_potential IN ('Unknown', '501-1000', '1001-5000') GROUP BY dd.d_year, dd.d_moy, sm.sm_type ORDER BY dd.d_year, dd.d_moy, sm.sm_type;
SELECT i.i_category, COUNT(DISTINCT ss.ss_item_sk) AS item_count, SUM(ss.ss_net_paid) AS total_revenue, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT s.s_store_sk) AS store_count, COUNT(DISTINCT ws.web_site_sk) AS website_count FROM store_sales ss JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN web_site ws ON s.s_market_id = ws.web_mkt_id LEFT JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk WHERE s.s_market_id = 8 AND (ws.web_rec_end_date IS NULL OR ws.web_rec_end_date > CURRENT_DATE) AND ss.ss_sold_date_sk BETWEEN 2450654 AND 2450705 AND s.s_state IN ('Leon', 'Holiday Hills', 'Waterloo', 'Pinecrest') GROUP BY i.i_category ORDER BY total_revenue DESC;
SELECT ca.ca_state as customer_state, dd.d_month_seq as month_sequence, dd.d_year as year, SUM(ss.ss_ext_sales_price) as total_sales, AVG(ss.ss_sales_price) as average_sale_price, SUM(ss.ss_ext_discount_amt) as total_discounts, SUM(ss.ss_coupon_amt) as total_coupons, SUM(ss.ss_ext_tax) as total_tax, COUNT(DISTINCT ss.ss_ticket_number) as total_transactions FROM store_sales ss JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk WHERE dd.d_month_seq IS NOT NULL AND ca.ca_state IS NOT NULL GROUP BY customer_state, month_sequence, year ORDER BY customer_state, month_sequence, year;
SELECT c.c_salutation, cd.cd_gender, cd.cd_education_status, cd.cd_credit_rating, COUNT(*) AS total_customers, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, COUNT(DISTINCT ws.ws_promo_sk) AS number_of_promotions_used FROM customer c JOIN customer_demographics cd ON c.c_current_cdemo_sk = cd.cd_demo_sk JOIN web_sales ws ON c.c_customer_sk = ws.ws_bill_customer_sk JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk WHERE c.c_salutation IN ('Sir', 'Miss', 'Mrs.', 'Ms.') AND cd.cd_demo_sk IN ('17361', '17821', '17056', '18235') AND ws.ws_list_price = '160.03' AND ws.ws_ship_cdemo_sk IN ('887064', '1910407', '1755166', '369305', '1188209') GROUP BY c.c_salutation, cd.cd_gender, cd.cd_education_status, cd.cd_credit_rating ORDER BY total_net_profit DESC, total_customers DESC, average_sales_price DESC;
SELECT w.web_name, SUM(ws.ws_net_paid) AS total_revenue, AVG(ws.ws_quantity) AS average_quantity_sold, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(wr.wr_return_amt_inc_tax) AS total_return_amount_incl_tax, AVG(wr.wr_return_quantity) AS average_return_quantity, COUNT(DISTINCT wr.wr_order_number) AS total_returns, MAX(i.inv_quantity_on_hand) AS max_inventory_on_hand FROM web_sales ws JOIN web_site w ON ws.ws_web_site_sk = w.web_site_sk LEFT JOIN web_returns wr ON ws.ws_order_number = wr.wr_order_number AND ws.ws_item_sk = wr.wr_item_sk JOIN inventory i ON ws.ws_item_sk = i.inv_item_sk WHERE w.web_mkt_class IN ('Continuous, social schools shou', 'Broad, new groups show car', 'Necessary, intermediat') AND ws.ws_wholesale_cost BETWEEN 20.49 AND 79.73 AND ws.ws_order_number IN (38859, 41620, 300) AND i.inv_warehouse_sk IN (1, 2) GROUP BY w.web_name ORDER BY total_revenue DESC;
SELECT p.p_promo_name AS promotion_name, i.ib_lower_bound AS income_band_lower_bound, i.ib_upper_bound AS income_band_upper_bound, COUNT(DISTINCT c.cd_demo_sk) AS number_of_customers, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_paid, SUM(ws.ws_net_paid_inc_tax) AS web_total_net_paid_inc_tax, COUNT(DISTINCT cp.cp_catalog_page_sk) AS number_of_catalog_pages_used, COUNT(DISTINCT inv.inv_item_sk) AS number_of_items_sold FROM store_sales ss JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk JOIN customer_demographics c ON ss.ss_cdemo_sk = c.cd_demo_sk JOIN income_band i ON c.cd_purchase_estimate BETWEEN i.ib_lower_bound AND i.ib_upper_bound JOIN web_sales ws ON ss.ss_item_sk = ws.ws_item_sk AND ss.ss_customer_sk = ws.ws_bill_customer_sk JOIN catalog_page cp ON ws.ws_web_page_sk = cp.cp_catalog_page_sk JOIN inventory inv ON ws.ws_item_sk = inv.inv_item_sk WHERE p.p_discount_active = 'Y' AND ss.ss_sold_date_sk BETWEEN 2451271 AND 2451575 AND cp.cp_start_date_sk BETWEEN 2451088 AND 2451420 AND inv.inv_quantity_on_hand > 0 GROUP BY promotion_name, income_band_lower_bound, income_band_upper_bound ORDER BY total_net_paid DESC, number_of_customers DESC;
SELECT c.cd_gender, c.cd_marital_status, c.cd_education_status, c.cd_credit_rating, AVG(c.cd_purchase_estimate) AS avg_purchase_estimate, SUM(c.cd_dep_count) AS total_dep_count, SUM(c.cd_dep_employed_count) AS total_dep_employed_count, SUM(c.cd_dep_college_count) AS total_dep_college_count, w.w_state, w.w_country, COUNT(DISTINCT w.w_warehouse_sk) AS num_warehouses, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_size, web.web_class, web.web_market_manager, COUNT(DISTINCT web.web_site_sk) AS num_websites, AVG(web.web_tax_percentage) AS avg_web_tax_percentage FROM customer_demographics c JOIN warehouse w ON c.cd_demo_sk = w.w_warehouse_sk JOIN web_site web ON w.w_state = web.web_state GROUP BY c.cd_gender, c.cd_marital_status, c.cd_education_status, c.cd_credit_rating, w.w_state, w.w_country, web.web_class, web.web_market_manager ORDER BY w.w_country, w.w_state, c.cd_education_status, c.cd_credit_rating;
SELECT COUNT(DISTINCT c.c_customer_sk) AS total_customers, AVG(w.w_warehouse_sq_ft) AS average_warehouse_size, SUM(p.p_cost) AS total_promotion_cost, s.s_state, s.s_city, COUNT(DISTINCT s.s_store_sk) AS total_stores, AVG(s.s_number_employees) AS average_store_employees FROM customer c JOIN store s ON c.c_current_addr_sk = s.s_store_sk JOIN warehouse w ON s.s_zip = w.w_zip JOIN promotion p ON p.p_channel_event = 'N' AND p.p_purpose != 'Unknown' GROUP BY s.s_state, s.s_city ORDER BY total_customers DESC, average_warehouse_size DESC, total_promotion_cost DESC;
SELECT dd.d_year, COUNT(DISTINCT wr.wr_order_number) AS num_returns, SUM(wr.wr_return_quantity) AS total_returned_qty, AVG(wr.wr_return_amt) AS avg_return_amt, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_return_ship_cost) AS total_ship_cost, SUM(wr.wr_net_loss) AS total_net_loss, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, i.i_category, i.i_brand, wh.w_warehouse_name, wh.w_city FROM web_returns wr JOIN date_dim dd ON wr.wr_returned_date_sk = dd.d_date_sk JOIN customer_demographics cd ON wr.wr_returning_cdemo_sk = cd.cd_demo_sk JOIN item i ON wr.wr_item_sk = i.i_item_sk JOIN warehouse wh ON i.i_item_sk = wh.w_warehouse_sk WHERE dd.d_year = 2000 AND (wr.wr_reversed_charge = 23.38 OR wr.wr_reversed_charge = 11.02) AND wr.wr_web_page_sk IN (18, 32, 58) AND (dd.d_quarter_seq = 27 OR dd.d_quarter_seq = 20) AND dd.d_month_seq = 131 AND wh.w_warehouse_sq_ft IN (621234, 294242) AND wh.w_street_name IN ('6th', 'Wilson Elm') GROUP BY dd.d_year, cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, i.i_category, i.i_brand, wh.w_warehouse_name, wh.w_city ORDER BY total_net_loss DESC, avg_return_amt DESC LIMIT 100;
SELECT cc_state, COUNT(cc_call_center_sk) AS total_call_centers, AVG(cc_employees) AS avg_employees, SUM(cc_sq_ft) AS total_sq_ft, COUNT(DISTINCT p_promo_sk) AS total_promotions, AVG(p_cost) AS avg_promotion_cost, AVG(hd_income_band_sk) AS avg_income_band, AVG(hd_vehicle_count) AS avg_vehicle_count, AVG(cc_tax_percentage) AS avg_tax_percentage, SUM(CASE WHEN p_channel_email = '1' THEN 1 ELSE 0 END) AS total_email_promotions, SUM(CASE WHEN p_channel_tv = '1' THEN 1 ELSE 0 END) AS total_tv_promotions, SUM(CASE WHEN p_channel_radio = '1' THEN 1 ELSE 0 END) AS total_radio_promotions FROM call_center LEFT JOIN promotion ON cc_mkt_id = p_promo_sk LEFT JOIN customer_address ON cc_county = ca_county LEFT JOIN household_demographics ON ca_address_sk = hd_demo_sk WHERE cc_rec_start_date <= CURRENT_DATE AND (cc_rec_end_date IS NULL OR cc_rec_end_date > CURRENT_DATE) AND ca_county IN ('Cowlitz County', 'Bay County', 'Loudon County', 'Santa Rosa County', 'Lebanon County') GROUP BY cc_state ORDER BY total_call_centers DESC;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, ib.ib_income_band_sk, COUNT(sr.sr_item_sk) AS total_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(sr.sr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(sr.sr_net_loss) AS total_net_loss FROM customer c JOIN store_returns sr ON c.c_customer_sk = sr.sr_customer_sk JOIN income_band ib ON c.c_current_hdemo_sk = ib.ib_income_band_sk WHERE sr.sr_return_quantity > 5 AND ib.ib_lower_bound >= 120001 AND (c.c_birth_year BETWEEN 1980 AND 1990) GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, ib.ib_income_band_sk ORDER BY total_net_loss DESC, avg_return_amount DESC LIMIT 100;
SELECT p.p_promo_name, p.p_start_date_sk, p.p_end_date_sk, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_tickets, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sale_price, SUM(ss.ss_net_paid) AS total_net_sales, SUM(ss.ss_net_profit) AS total_net_profit, COUNT(DISTINCT wp.wp_web_page_sk) AS total_web_pages_accessed, AVG(wp.wp_char_count) AS average_webpage_char_count FROM promotion p JOIN store_sales ss ON p.p_promo_sk = ss.ss_promo_sk LEFT JOIN web_page wp ON ss.ss_customer_sk = wp.wp_customer_sk WHERE p.p_channel_email = 'N' AND ss.ss_hdemo_sk IN (4351, 333, 293, 976, 2889) AND wp.wp_link_count IN ('20', '3', '19', '9', '6', '17') GROUP BY p.p_promo_name, p.p_start_date_sk, p.p_end_date_sk ORDER BY total_net_sales DESC, total_net_profit DESC;
SELECT p.p_promo_name, p.p_start_date_sk, p.p_end_date_sk, p.p_purpose, COUNT(DISTINCT cc.cc_call_center_sk) AS number_of_call_centers_involved, SUM(inv.inv_quantity_on_hand) AS total_inventory, SUM(wr.wr_return_quantity) AS total_returns, AVG(wr.wr_return_amt_inc_tax) AS avg_return_amount_inc_tax, SUM(wr.wr_fee) AS total_fees, SUM(wr.wr_net_loss) AS total_net_loss FROM promotion p LEFT JOIN inventory inv ON p.p_item_sk = inv.inv_item_sk LEFT JOIN web_returns wr ON p.p_item_sk = wr.wr_item_sk LEFT JOIN call_center cc ON wr.wr_returned_date_sk BETWEEN cc.cc_open_date_sk AND cc.cc_closed_date_sk WHERE p.p_purpose <> 'Unknown' AND p.p_end_date_sk <= 2450916 GROUP BY p.p_promo_name, p.p_start_date_sk, p.p_end_date_sk, p.p_purpose ORDER BY total_returns DESC, avg_return_amount_inc_tax DESC LIMIT 100;
SELECT i.i_category AS item_category, i.i_brand AS item_brand, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, SUM(ws.ws_net_paid_inc_ship_tax) AS total_sales, AVG(ws.ws_sales_price) AS average_sales_price, COUNT(DISTINCT i.i_item_sk) AS item_count FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN web_site w ON ws.ws_web_site_sk = w.web_site_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk WHERE w.web_mkt_class = 'Right efforts must no' AND sm.sm_code = 'SEA' AND w.web_company_id = 1 GROUP BY i.i_category, i.i_brand ORDER BY total_sales DESC, item_category, item_brand;
SELECT i.i_category, i.i_class, i.i_brand, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(wr.wr_return_quantity) AS total_quantity_returned, AVG(wr.wr_return_amt) AS avg_return_amount, (SUM(ws.ws_net_paid) - SUM(wr.wr_refunded_cash)) AS net_profit FROM item i JOIN web_sales ws ON i.i_item_sk = ws.ws_item_sk LEFT JOIN web_returns wr ON i.i_item_sk = wr.wr_item_sk AND ws.ws_order_number = wr.wr_order_number JOIN income_band ib ON ib.ib_income_band_sk = ws.ws_bill_cdemo_sk WHERE i.i_manufact IN ('oughtanti', 'callyableable', 'ableationable') AND ib.ib_upper_bound IN (110000, 190000, 120000, 20000, 10000) AND ws.ws_quantity > 0 GROUP BY ROLLUP(i.i_category, i.i_class, i.i_brand) ORDER BY i.i_category, i.i_class, i.i_brand;
SELECT ws.web_site_id, ws.web_name, ws.web_manager, ws.web_gmt_offset, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_paid) AS total_revenue, AVG(cs_net_profit) AS average_profit, SUM(cr_return_amount) AS total_returns, AVG(cr_return_quantity) AS average_return_quantity, COUNT(DISTINCT cr_returned_date_sk) AS return_days_count, SUM(cd_purchase_estimate) AS total_purchase_estimate, AVG(cd_dep_count) AS average_dependents, COUNT(DISTINCT wp_web_page_sk) AS total_web_pages_accessed, SUM(wp_image_count) AS total_images_counted FROM web_site ws LEFT JOIN catalog_sales cs ON ws.web_site_sk = cs.cs_warehouse_sk LEFT JOIN catalog_returns cr ON cs.cs_order_number = cr.cr_order_number AND cs.cs_item_sk = cr.cr_item_sk LEFT JOIN customer_demographics cd ON cs.cs_bill_cdemo_sk = cd.cd_demo_sk LEFT JOIN web_page wp ON ws.web_site_sk = wp.wp_customer_sk WHERE ws.web_site_id IN ('AAAAAAAAKAAAAAAA', 'AAAAAAAAKBAAAAAA', 'AAAAAAAANAAAAAAA') AND ws.web_manager IN ('John Thomas', 'Charles Castillo', 'Jimmy Pope') AND ws.web_gmt_offset = '-5.00' AND cr.cr_ship_mode_sk IN ('2', '3', '12') AND cr.cr_refunded_hdemo_sk IN ('5787', '111', '6091') AND cr.cr_returning_customer_sk IN ('39980', '67407', '42477') AND cr.cr_returning_addr_sk IN ('22557', '8862', '28393') AND cd.cd_credit_rating IN ('Good', 'Unknown', 'Low Risk') AND cd.cd_purchase_estimate IN ('3500', '2500', '5500') AND cd.cd_dep_employed_count = '0' AND cd.cd_marital_status IN ('U', 'S', 'W') AND wp.wp_access_date_sk IN ('2452555', '2452619', '2452568') AND wp.wp_url = 'http://www.foo.com' AND wp.wp_image_count IN ('2', '3', '5') GROUP BY ws.web_site_id, ws.web_name, ws.web_manager, ws.web_gmt_offset ORDER BY total_revenue DESC, average_profit DESC;
SELECT w_state, COUNT(DISTINCT c_customer_sk) AS number_of_customers, AVG(inv_quantity_on_hand) AS average_inventory, SUM(case when c_preferred_cust_flag = 'Y' then 1 else 0 end) AS preferred_customer_count, MAX(wp_link_count) AS max_webpage_link_count, MIN(web_tax_percentage) AS min_tax_percentage FROM customer JOIN warehouse ON c_current_addr_sk = w_warehouse_sk JOIN inventory ON inv_warehouse_sk = w_warehouse_sk JOIN web_page ON wp_customer_sk = c_customer_sk JOIN web_site ON wp_web_page_sk = web_site_sk AND web_class <> 'Unknown' WHERE web_close_date_sk IN ('2446944', '2446978', '2447046') GROUP BY w_state ORDER BY number_of_customers DESC, average_inventory DESC;
SELECT dd.d_year, dd.d_quarter_name, COUNT(DISTINCT ss.ss_ticket_number) AS store_sales_count, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, COUNT(DISTINCT wp.wp_web_page_sk) AS web_pages_accessed, SUM(wp.wp_link_count) AS total_links_accessed FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk LEFT JOIN catalog_returns cr ON cr.cr_returned_date_sk = dd.d_date_sk LEFT JOIN web_page wp ON wp.wp_access_date_sk = dd.d_date_sk WHERE dd.d_year = 2000 AND wp.wp_type = 'product' AND ss.ss_net_paid > 0 AND cr.cr_return_amount IS NOT NULL GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT cc.cc_city, cc.cc_name, SUM(ss.ss_quantity) AS total_sales_quantity, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_profit) AS total_sales_net_profit, SUM(sr.sr_return_quantity) AS total_returns_quantity, AVG(sr.sr_return_amt_inc_tax) AS average_return_amount_inc_tax, SUM(sr.sr_net_loss) AS total_returns_net_loss, SUM(inv.inv_quantity_on_hand) AS total_inventory_quantity, AVG(i.i_wholesale_cost) AS average_wholesale_cost, COUNT(DISTINCT hd.hd_demo_sk) AS unique_households FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN store_returns sr ON ss.ss_item_sk = sr.sr_item_sk AND ss.ss_ticket_number = sr.sr_ticket_number JOIN inventory inv ON ss.ss_item_sk = inv.inv_item_sk JOIN item i ON ss.ss_item_sk = i.i_item_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk WHERE cc.cc_gmt_offset = '-5.00' AND cc.cc_open_date_sk IN (2450806, 2450952, 2451063) AND cc.cc_city = 'Midway' AND ss.ss_sold_date_sk BETWEEN '2450815' AND '2450815' + 30 AND sr.sr_store_sk IN (2, 4, 1) AND sr.sr_return_amt_inc_tax IN (258.90, 545.50, 3957.70) AND hd.hd_buy_potential IN ('1001-5000', 'Unknown', '501-1000') AND hd.hd_vehicle_count IN (1, 3, 0) AND i.i_rec_start_date IN ('2001-10-27', '1999-10-28', '1997-10-27') AND inv.inv_warehouse_sk IN (2, 1) AND inv.inv_quantity_on_hand IN (393, 230, 717) GROUP BY cc.cc_city, cc.cc_name ORDER BY total_sales_net_profit DESC, total_returns_net_loss ASC LIMIT 10;
SELECT r.r_reason_desc, sm.sm_type, sm.sm_code, COUNT(*) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS average_return_amount, SUM(cr.cr_return_quantity) AS total_return_quantity, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk WHERE cr.cr_returned_date_sk IS NOT NULL AND sm.sm_code = 'AIR' AND sm.sm_type IN ('TWO DAY', 'NEXT DAY') AND cr.cr_return_amt_inc_tax IN (93.14, 49.54, 370.20, 5187.66) GROUP BY r.r_reason_desc, sm.sm_type, sm.sm_code ORDER BY total_return_amount DESC, total_return_quantity DESC;
SELECT i_category, i_brand, i_class, i_size, ca_state, SUM(cs_quantity) AS total_quantity_sold, AVG(cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(cs_net_profit) AS total_profit FROM catalog_sales JOIN item ON cs_item_sk = i_item_sk JOIN customer_address ON cs_ship_addr_sk = ca_address_sk WHERE cs_sold_date_sk IS NOT NULL AND i_rec_start_date <= '1999-10-28' AND i_formulation IN ('47violet063986294269', '99894237tan735493935', '3tan0939360655141073', 'snow8893404317305605') AND cs_ext_discount_amt IN ('4923.36', '6952.68', '1512.42', '81.69') AND ca_state IN ('NY', 'CA', 'TX') GROUP BY i_category, i_brand, i_class, i_size, ca_state ORDER BY total_profit DESC, total_quantity_sold DESC LIMIT 100;
SELECT ca_state, COUNT(cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS avg_sales_price, SUM(cs_net_paid_inc_tax) AS total_net_paid_inc_tax, SUM(cs_net_profit) AS total_net_profit FROM catalog_sales JOIN customer_address ON catalog_sales.cs_ship_addr_sk = customer_address.ca_address_sk GROUP BY ca_state HAVING SUM(cs_net_paid_inc_tax) > 50000 ORDER BY total_net_profit DESC;
SELECT sm.sm_type AS shipping_type, cc.cc_name AS call_center_name, COUNT(ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, SUM(CASE WHEN cd.cd_credit_rating = 'High Risk' THEN ws.ws_net_profit ELSE 0 END) AS high_risk_profit, SUM(CASE WHEN cd.cd_credit_rating = 'Low Risk' THEN ws.ws_net_profit ELSE 0 END) AS low_risk_profit, COUNT(DISTINCT cd.cd_demo_sk) AS unique_customers FROM web_sales ws JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN call_center cc ON ws.ws_order_number = cc.cc_call_center_sk JOIN customer_demographics cd ON ws.ws_bill_cdemo_sk = cd.cd_demo_sk GROUP BY shipping_type, call_center_name ORDER BY total_net_profit DESC;
SELECT SUM(ss.ss_net_profit) AS total_net_profit, AVG(ss.ss_quantity) AS average_quantity_sold, COUNT(DISTINCT ss.ss_customer_sk) AS unique_customers, COUNT(DISTINCT sr.sr_reason_sk) AS number_of_return_reasons, SUM(sr.sr_return_amt_inc_tax) AS total_returns_with_tax, AVG(p.p_cost) AS average_promotion_cost, COUNT(DISTINCT w.w_warehouse_sk) AS number_of_warehouses_used, AVG(w.w_gmt_offset) AS average_warehouse_gmt_offset, SUM(CASE WHEN c.c_preferred_cust_flag = 'Y' THEN 1 ELSE 0 END) AS preferred_customer_count FROM store_sales ss LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number LEFT JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk AND p.p_discount_active = 'N' LEFT JOIN warehouse w ON w.w_suite_number IN ('Suite 80', 'Suite 0', 'Suite P', 'Suite 470') LEFT JOIN customer c ON ss.ss_customer_sk = c.c_customer_sk WHERE (ss.ss_sold_date_sk BETWEEN 20180101 AND 20181231 OR ss.ss_sold_date_sk IS NULL) AND (sr.sr_returned_date_sk BETWEEN 20180101 AND 20181231 OR sr.sr_returned_date_sk IS NULL) AND (c.c_customer_sk IN ('824', '4397', '807', '476') OR c.c_customer_sk IS NULL) AND (sr.sr_reason_sk IN (SELECT r_reason_sk FROM reason WHERE r_reason_desc IN ('duplicate purchase', 'reason 34', 'Found a better price in a store', 'Gift exchange', 'Parts missing', 'Lost my job')) OR sr.sr_reason_sk IS NULL) GROUP BY w.w_city, c.c_birth_year;
SELECT wp_type, COUNT(DISTINCT wp_web_page_sk) AS num_web_pages, COUNT(DISTINCT wr_order_number) AS num_returns, SUM(wr_return_amt) AS total_return_amt, AVG(wr_fee) AS avg_return_fee, COUNT(DISTINCT ss_ticket_number) AS num_sales, SUM(ss_net_paid) AS total_sales_net_paid, AVG(ss_quantity) AS avg_quantity_sold, AVG(ss_net_profit) AS avg_net_profit_per_sale FROM web_page JOIN web_returns ON wp_web_page_sk = wr_web_page_sk JOIN store_sales ON wp_web_page_sk = ss_item_sk AND wr_item_sk = ss_item_sk WHERE wp_autogen_flag = 'Y' AND wr_refunded_hdemo_sk IN ('6339', '6945', '3736', '1127', '5965') AND wr_returning_addr_sk IN ('5470', '35039', '13547', '10964') AND ss_sold_time_sk IN ('51540', '75570', '63103', '51775', '61813', '66204') AND wr_reason_sk = '21' GROUP BY wp_type ORDER BY total_return_amt DESC, num_sales DESC;
SELECT d_year, i_category, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_customer_sk) AS unique_customers, SUM(ss_net_profit) AS total_profit FROM store_sales JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk JOIN item ON store_sales.ss_item_sk = item.i_item_sk JOIN promotion ON store_sales.ss_promo_sk = promotion.p_promo_sk WHERE promotion.p_channel_event = 'N' AND item.i_manager_id = 40 AND item.i_container = 'Unknown' AND promotion.p_item_sk IN ('11194', '2314', '17593') AND EXISTS ( SELECT 1 FROM household_demographics WHERE household_demographics.hd_demo_sk = store_sales.ss_hdemo_sk AND household_demographics.hd_buy_potential IN ('>10000', 'Unknown') AND household_demographics.hd_vehicle_count IN ('3', '1', '0', '4', '2') ) GROUP BY d_year, i_category ORDER BY total_profit DESC, total_quantity_sold DESC;
SELECT dd.d_year, dd.d_quarter_name, SUM(cs.cs_quantity) AS total_quantity_sold, SUM(cs.cs_ext_sales_price) AS total_sales, SUM(cs.cs_ext_discount_amt) AS total_discount, SUM(cs.cs_ext_tax) AS total_tax_collected, SUM(cs.cs_net_profit) AS total_net_profit, AVG(cs.cs_sales_price) AS average_sales_price, COUNT(DISTINCT cs.cs_order_number) AS total_orders FROM catalog_sales cs JOIN date_dim dd ON cs.cs_sold_date_sk = dd.d_date_sk WHERE dd.d_year IN (2001, 2002) AND dd.d_quarter_name IN ('1905Q4', '1906Q3', '1908Q2', '1903Q2') GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT ca.ca_state AS state, dd.d_year AS year, COUNT(sr.sr_ticket_number) AS total_returns, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(sr.sr_return_quantity) AS total_returned_quantity, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN date_dim dd ON sr.sr_returned_date_sk = dd.d_date_sk WHERE ca.ca_zip IN ('60534', '57995', '13951') GROUP BY ca.ca_state, dd.d_year ORDER BY state, year;
SELECT i.i_category AS item_category, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, COUNT(DISTINCT ws.ws_order_number) AS number_of_orders, COUNT(DISTINCT h.hd_demo_sk) AS number_of_customers_by_demographics, sm.sm_type AS shipping_type, AVG(inv.inv_quantity_on_hand) AS average_inventory_on_hand FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk JOIN household_demographics h ON ws.ws_bill_hdemo_sk = h.hd_demo_sk WHERE i.i_category_id BETWEEN 1 AND 5 AND ws.ws_ship_mode_sk IN (6, 4, 18, 1, 5, 8) AND inv.inv_warehouse_sk IN (1, 2) AND h.hd_income_band_sk IN (20, 11, 4) GROUP BY i.i_category, sm.sm_type ORDER BY total_net_profit DESC, item_category;
SELECT w_state, w_city, i_category, i_class, i_brand, AVG(i_current_price) AS avg_price, SUM(inv_quantity_on_hand) AS total_inventory, COUNT(DISTINCT i_item_sk) AS unique_items_count, MAX(i_current_price) AS max_price, MIN(i_current_price) AS min_price, COUNT(DISTINCT hd_demo_sk) AS unique_households, AVG(hd_dep_count) AS avg_dependency_count FROM warehouse w JOIN inventory inv ON w.w_warehouse_sk = inv.inv_warehouse_sk JOIN item i ON inv.inv_item_sk = i.i_item_sk LEFT JOIN household_demographics hd ON hd.hd_income_band_sk = i.i_brand_id WHERE w.w_zip = '35709' AND w.w_state = 'TN' AND w.w_street_type IN ('Dr.', 'Drive', 'Parkway') AND w.w_city = 'Fairview' AND inv.inv_date_sk = 2450815 AND inv.inv_quantity_on_hand IN (396, 595, 454) AND inv.inv_warehouse_sk IN (2, 1) AND i.i_container = 'Unknown' AND i.i_item_sk IN (4699, 4967, 949) AND hd.hd_dep_count IN (4, 1, 6) AND hd.hd_income_band_sk IN (9, 18, 10) GROUP BY w_state, w_city, i_category, i_class, i_brand ORDER BY total_inventory DESC, avg_price DESC;
SELECT s.s_division_name, AVG(s.s_number_employees) as avg_employees, SUM(s.s_floor_space) as total_floor_space, COUNT(DISTINCT c.c_customer_sk) as total_customers, AVG(i.ib_upper_bound) as avg_income_upper_bound, MIN(i.ib_lower_bound) as min_income_lower_bound, COUNT(DISTINCT wp.wp_web_page_sk) as total_web_pages, SUM(wp.wp_image_count) as total_images FROM store s JOIN customer c ON s.s_store_sk = c.c_current_addr_sk LEFT JOIN income_band i ON i.ib_income_band_sk = c.c_current_hdemo_sk LEFT JOIN web_page wp ON wp.wp_customer_sk = c.c_customer_sk WHERE s.s_division_name <> 'Unknown' AND c.c_current_addr_sk IN (13536, 17282) AND c.c_first_shipto_date_sk = 2451994 AND i.ib_upper_bound IN (90000, 30000, 20000, 200000, 70000, 60000) AND i.ib_lower_bound > 110001 GROUP BY s.s_division_name ORDER BY total_customers DESC;
SELECT c.c_last_name, c.c_first_name, ca.ca_city, ca.ca_state, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_items_sold, SUM(ss.ss_net_paid_inc_tax) AS total_sales_revenue, AVG(ss.ss_net_profit) AS avg_sales_profit, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions, SUM(sr.sr_return_quantity) AS total_items_returned, SUM(sr.sr_return_amt_inc_tax) AS total_returns_revenue, AVG(sr.sr_net_loss) AS avg_returns_loss, ib.ib_lower_bound, ib.ib_upper_bound, hd.hd_buy_potential FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk WHERE ca.ca_street_name IN ('9th Ninth', 'Jackson Sunset', 'Willow Davis') AND c.c_last_name IN ('Heller', 'Burrows') AND c.c_first_name IN ('Dolores', 'Sheree', 'James', 'Lee', 'Cassandra', 'Kayleen') AND hd.hd_buy_potential IN ('>10000', '501-1000', 'Unknown', '5001-10000', '0-500') AND sr.sr_return_amt = 1099.14 GROUP BY c.c_last_name, c.c_first_name, ca.ca_city, ca.ca_state, ib.ib_lower_bound, ib.ib_upper_bound, hd.hd_buy_potential ORDER BY c.c_last_name, c.c_first_name, ca.ca_city, ca.ca_state;
SELECT cd_gender, cd_marital_status, cd_education_status, cd_credit_rating, AVG(cd_purchase_estimate) AS avg_purchase_estimate, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_net_paid, SUM(ss_net_paid_inc_tax) AS total_net_paid_inc_tax, COUNT(DISTINCT ss_ticket_number) AS number_of_sales_tickets, COUNT(DISTINCT ss_customer_sk) AS number_of_customers FROM store_sales JOIN customer_demographics ON ss_cdemo_sk = cd_demo_sk JOIN time_dim ON ss_sold_time_sk = t_time_sk WHERE t_shift = 'Day' AND cd_credit_rating IN ('Good', 'Excellent') AND ss_sales_price >= 100 AND ss_sold_date_sk IS NOT NULL GROUP BY cd_gender, cd_marital_status, cd_education_status, cd_credit_rating ORDER BY total_net_paid DESC, cd_gender, cd_marital_status;
SELECT dd.d_year, dd.d_quarter_name, ca.ca_state, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_ext_sales_price) AS total_sales, AVG(ss.ss_sales_price) AS avg_sales_price, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(sr.sr_return_quantity) AS total_quantity_returned, SUM(sr.sr_return_amt) AS total_returns, AVG(sr.sr_return_amt) AS avg_return_amt, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions, SUM(wr.wr_return_quantity) AS total_web_quantity_returned, SUM(wr.wr_return_amt) AS total_web_returns, AVG(wr.wr_return_amt) AS avg_web_return_amt, COUNT(DISTINCT wr.wr_order_number) AS total_web_return_transactions FROM store_sales ss JOIN date_dim dd ON ss.ss_sold_date_sk = dd.d_date_sk JOIN customer_address ca ON ss.ss_addr_sk = ca.ca_address_sk LEFT JOIN store_returns sr ON ss.ss_item_sk = sr.sr_item_sk AND ss.ss_ticket_number = sr.sr_ticket_number LEFT JOIN web_returns wr ON ss.ss_item_sk = wr.wr_item_sk AND ss.ss_ticket_number = wr.wr_order_number WHERE dd.d_year = 2001 AND ca.ca_country = 'United States' AND (sr.sr_returned_date_sk IS NULL OR dd.d_date_sk = sr.sr_returned_date_sk) AND (wr.wr_returned_date_sk IS NULL OR dd.d_date_sk = wr.wr_returned_date_sk) GROUP BY dd.d_year, dd.d_quarter_name, ca.ca_state ORDER BY dd.d_year, dd.d_quarter_name, ca.ca_state;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, COUNT(cp.cp_catalog_page_sk) AS number_of_catalog_pages, SUM(case when p.p_channel_press = 'N' then 1 else 0 end) AS promotions_without_press, AVG(p.p_cost) AS average_promotion_cost, MAX(cc.cc_employees) AS max_employees_per_call_center, MIN(cc.cc_sq_ft) AS min_sq_ft_per_call_center FROM call_center cc LEFT JOIN catalog_page cp ON cc.cc_call_center_sk = cp.cp_catalog_page_sk LEFT JOIN promotion p ON cc.cc_call_center_sk = p.p_promo_sk WHERE cc.cc_sq_ft IN ('3514', '649', '1138', '795', '2268') GROUP BY cc.cc_name, cc.cc_city, cc.cc_state ORDER BY number_of_catalog_pages DESC, average_promotion_cost ASC;
SELECT ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(DISTINCT ss.ss_customer_sk) AS num_customers, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_net_profit, SUM(sr.sr_return_quantity) AS total_return_quantity, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_fee) AS avg_return_fee, COUNT(DISTINCT wp.wp_web_page_sk) AS num_visited_pages, SUM(wp.wp_link_count) AS total_link_count FROM income_band ib LEFT JOIN store_sales ss ON ib.ib_income_band_sk = ss.ss_cdemo_sk LEFT JOIN store_returns sr ON ss.ss_customer_sk = sr.sr_customer_sk AND sr.sr_reason_sk IN (21, 2, 14, 30) LEFT JOIN web_page wp ON ss.ss_customer_sk = wp.wp_customer_sk AND wp.wp_type IN ('protected', 'ad') WHERE ss.ss_sold_date_sk IN (2451298, 2450872, 2451390, 2451634) AND ib.ib_upper_bound IN (30000, 130000, 90000) AND ib.ib_income_band_sk IN (17, 6) GROUP BY ib.ib_income_band_sk, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY ib.ib_income_band_sk;
SELECT dd.d_year, dd.d_quarter_name, sm.sm_type, COUNT(DISTINCT inv.inv_item_sk) AS distinct_items_count, SUM(inv.inv_quantity_on_hand) AS total_quantity, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, AVG(i.i_current_price) AS avg_current_price, (SUM(i.i_current_price * inv.inv_quantity_on_hand) - SUM(i.i_wholesale_cost * inv.inv_quantity_on_hand)) AS total_profit, COUNT(DISTINCT cc.cc_call_center_sk) AS call_centers_count, COUNT(DISTINCT w.w_warehouse_sk) AS warehouses_count, COUNT(DISTINCT ws.web_site_sk) AS web_sites_count FROM inventory inv JOIN item i ON inv.inv_item_sk = i.i_item_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN date_dim dd ON inv.inv_date_sk = dd.d_date_sk JOIN call_center cc ON cc.cc_open_date_sk <= dd.d_date_sk AND (cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date >= dd.d_date) JOIN web_site ws ON ws.web_open_date_sk <= dd.d_date_sk AND (ws.web_rec_end_date IS NULL OR ws.web_rec_end_date >= dd.d_date) JOIN ship_mode sm ON sm.sm_code = 'AIR' WHERE dd.d_current_month = 'N' AND w.w_state = 'TN' AND w.w_city = 'Fairview' AND w.w_county = 'Williamson County' AND (cc.cc_class = 'large' OR cc.cc_class = 'medium') AND (i.i_color = 'forest' OR i.i_color = 'navy') AND ws.web_class <> 'Unknown' AND ws.web_gmt_offset = '-5.00' AND ws.web_company_id IN (3, 4, 5) GROUP BY dd.d_year, dd.d_quarter_name, sm.sm_type ORDER BY dd.d_year, dd.d_quarter_name, sm.sm_type;
SELECT s_store_id, s_state, s_city, COUNT(DISTINCT ss_ticket_number) AS num_transactions, SUM(ss_net_paid) AS total_sales, AVG(ss_sales_price) AS avg_sales_price, SUM(wr_return_amt_inc_tax) AS total_returns, COUNT(DISTINCT wr_order_number) AS num_returns, ARRAY_AGG(DISTINCT r_reason_desc) AS reasons_for_returns FROM store_sales AS ss JOIN store AS s ON ss.ss_store_sk = s.s_store_sk LEFT JOIN web_returns AS wr ON ss.ss_ticket_number = wr.wr_order_number LEFT JOIN reason AS r ON wr.wr_reason_sk = r.r_reason_sk JOIN date_dim AS dd ON ss.ss_sold_date_sk = dd.d_date_sk WHERE dd.d_quarter_seq = ( SELECT MAX(d_quarter_seq) FROM date_dim WHERE d_current_quarter = 'Y' ) AND s.s_state IN ('CA', 'TX', 'NY') GROUP BY s_store_id, s_state, s_city ORDER BY total_sales DESC, s_state, s_city;
SELECT w.w_state AS warehouse_state, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_net_profit) AS total_net_profit, COUNT(DISTINCT cr.cr_order_number) AS total_returns, AVG(cr.cr_return_amount) AS average_return_amount FROM web_sales ws LEFT JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk LEFT JOIN catalog_returns cr ON ws.ws_item_sk = cr.cr_item_sk AND ws.ws_order_number = cr.cr_order_number WHERE ws.ws_sold_date_sk = 2450976 GROUP BY w.w_state ORDER BY total_net_profit DESC;
SELECT w.w_city, w.w_state, w.w_country, COUNT(*) AS number_of_households, AVG(hd.hd_dep_count) AS average_dependency_count, AVG(hd.hd_vehicle_count) AS average_vehicle_count, AVG(ib.ib_lower_bound) AS average_income_lower_bound, AVG(ib.ib_upper_bound) AS average_income_upper_bound, SUM(CASE WHEN hd.hd_buy_potential = 'Unknown' THEN 1 ELSE 0 END) AS unknown_buy_potential_count, SUM(CASE WHEN hd.hd_buy_potential = 'High' THEN 1 ELSE 0 END) AS high_buy_potential_count, SUM(CASE WHEN hd.hd_buy_potential = 'Low' THEN 1 ELSE 0 END) AS low_buy_potential_count FROM warehouse w JOIN household_demographics hd ON w.w_warehouse_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk GROUP BY w.w_city, w.w_state, w.w_country ORDER BY w.w_country, w.w_state, w.w_city;
SELECT d_year, d_quarter_name, SUM(cs_net_profit) AS total_profit, AVG(cs_quantity) AS average_quantity, COUNT(DISTINCT cs_order_number) AS total_orders, COUNT(DISTINCT sr_ticket_number) AS total_returns, SUM(sr_net_loss) AS total_return_loss, AVG(sr_return_quantity) AS average_return_quantity, COUNT(DISTINCT c_customer_sk) AS total_customers FROM date_dim JOIN catalog_sales ON cs_sold_date_sk = d_date_sk JOIN store_returns ON sr_returned_date_sk = d_date_sk JOIN customer ON (cs_bill_customer_sk = c_customer_sk OR sr_customer_sk = c_customer_sk) JOIN web_site ON c_first_shipto_date_sk = web_open_date_sk WHERE d_moy IN (5, 1, 6) AND web_close_date_sk IN (2448854, 2446944, 2448752) AND sr_returned_date_sk IN (2451779, 2451809) AND c_first_shipto_date_sk IN (2450817, 2450990, 2450273, 2449359, 2449289, 2449658) AND c_first_name IN ('Alecia', 'Allen', 'Deanne') GROUP BY d_year, d_quarter_name ORDER BY d_year, d_quarter_name;
SELECT c.ca_state, c.ca_city, COUNT(DISTINCT cust.c_customer_sk) AS total_customers, SUM(CASE WHEN p.p_channel_dmail = 'Y' THEN 1 ELSE 0 END) AS dmail_promo_count, AVG(p.p_cost) AS avg_promotion_cost, MAX(cust.c_birth_year) AS latest_birth_year FROM customer_address c JOIN customer cust ON c.ca_address_sk = cust.c_current_addr_sk LEFT JOIN promotion p ON p.p_start_date_sk <= cust.c_first_sales_date_sk AND p.p_end_date_sk >= cust.c_first_sales_date_sk WHERE cust.c_birth_year > 1980 AND c.ca_country = 'United States' AND (p.p_channel_dmail = 'Y' OR p.p_channel_dmail = 'N') GROUP BY c.ca_state, c.ca_city ORDER BY total_customers DESC, avg_promotion_cost DESC, dmail_promo_count DESC LIMIT 100;
SELECT sm.sm_type AS ship_mode_type, p.p_promo_name AS promotion_name, r.r_reason_desc AS return_reason, COUNT(DISTINCT cr.cr_order_number) AS total_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_net_loss) AS total_net_loss, COUNT(DISTINCT cs.cs_order_number) AS total_sales_orders, SUM(cs.cs_sales_price) AS total_sales_amount, AVG(cs.cs_sales_price) AS avg_sales_price, (SUM(cr.cr_return_amount) / NULLIF(SUM(cs.cs_sales_price), 0)) * 100 AS return_rate_percentage FROM catalog_returns cr JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN catalog_sales cs ON cr.cr_order_number = cs.cs_order_number JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk GROUP BY sm.sm_type, p.p_promo_name, r.r_reason_desc ORDER BY total_returns DESC, total_net_loss DESC LIMIT 10;
SELECT ss_item_sk, ss_store_sk, AVG(ss_sales_price) AS avg_sales_price, SUM(ss_quantity) AS total_quantity_sold, SUM(ss_net_paid) AS total_net_paid, SUM(ss_net_profit) AS total_net_profit, AVG(ss_ext_discount_amt) AS avg_discount_amount, COUNT(DISTINCT ss_customer_sk) AS unique_customer_count FROM store_sales GROUP BY ss_item_sk, ss_store_sk ORDER BY total_net_profit DESC;
SELECT ss.ss_store_sk AS store_id, hd.hd_vehicle_count AS vehicle_count, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_items_sold, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_sales_net_profit, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_transactions, SUM(sr.sr_return_quantity) AS total_items_returned, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(sr.sr_net_loss) AS total_returns_net_loss, ARRAY_AGG(DISTINCT r.r_reason_desc) FILTER (WHERE sr.sr_reason_sk IS NOT NULL) AS return_reasons FROM store_sales ss JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk LEFT JOIN store_returns sr ON ss.ss_ticket_number = sr.sr_ticket_number AND ss.ss_item_sk = sr.sr_item_sk LEFT JOIN reason r ON sr.sr_reason_sk = r.r_reason_sk WHERE ss.ss_store_sk IN ('10', '4', '7', '8') AND hd.hd_vehicle_count IN ('3', '2', '1', '4') GROUP BY ss.ss_store_sk, hd.hd_vehicle_count ORDER BY total_sales_net_profit DESC, total_returns_net_loss ASC;
SELECT ca.ca_state, ca.ca_city, COUNT(DISTINCT c.c_customer_sk) AS num_customers, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_quantity) AS total_quantity_sold, SUM(ss.ss_ext_discount_amt) AS total_discount_amount, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_net_loss) AS avg_net_loss, SUM(CASE WHEN r.r_reason_sk IS NOT NULL THEN 1 ELSE 0 END) AS num_returns_with_reason FROM customer c JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk LEFT JOIN web_returns wr ON wr.wr_refunded_customer_sk = c.c_customer_sk LEFT JOIN reason r ON wr.wr_reason_sk = r.r_reason_sk GROUP BY ca.ca_state, ca.ca_city HAVING COUNT(DISTINCT c.c_customer_sk) > 5 AND SUM(ss.ss_quantity) > 50 ORDER BY total_discount_amount DESC, avg_sales_price DESC LIMIT 100;
SELECT c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address, sum(i.i_current_price) AS total_spent, avg(i.i_wholesale_cost) AS average_wholesale_cost, count(DISTINCT cp.cp_catalog_page_sk) AS number_of_catalog_pages, count(DISTINCT web.web_site_sk) AS number_of_websites_visited, sm.sm_type AS shipping_type, sm.sm_code AS shipping_code FROM customer c JOIN catalog_page cp ON c.c_first_shipto_date_sk = cp.cp_start_date_sk JOIN item i ON i.i_category_id = cp.cp_catalog_number JOIN web_site web ON web.web_open_date_sk = c.c_first_sales_date_sk JOIN ship_mode sm ON sm.sm_ship_mode_sk = web.web_site_sk WHERE i.i_brand_id IN ('6016004', '7006002', '6004007') AND i.i_manufact_id IN ('86', '35', '590') AND web.web_suite_number IN ('Suite 330', 'Suite R', 'Suite Q') AND web.web_open_date_sk IN ('2450798', '2450654', '2450756') AND cp.cp_catalog_page_number IN ('93', '92', '1') AND cp.cp_start_date_sk IN ('2451088', '2451180', '2451271') AND cp.cp_department = 'DEPARTMENT' AND cp.cp_catalog_number IN ('19', '13', '33') AND sm.sm_code IN ('BIKE', 'SURFACE', 'SEA') AND sm.sm_type IN ('REGULAR', 'NEXT DAY', 'LIBRARY') AND c.c_salutation IN ('Ms.', 'Mr.', 'Miss') AND c.c_first_name IN ('Arturo', 'Gudrun', 'Douglas') AND c.c_birth_country IN ('ISLE OF MAN', 'AMERICAN SAMOA', 'EQUATORIAL GUINEA') AND c.c_customer_sk IN ('4875', '3748', '2364') GROUP BY c.c_customer_id, c.c_first_name, c.c_last_name, c.c_email_address, sm.sm_type, sm.sm_code ORDER BY total_spent DESC LIMIT 100;
SELECT ca_state, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS avg_sales_price, COUNT(DISTINCT cs_order_number) AS total_orders, SUM(wr_return_amt_inc_tax) AS total_return_amount_inc_tax, COUNT(DISTINCT wr_order_number) AS total_return_orders FROM catalog_sales JOIN customer_address ON cs_ship_addr_sk = ca_address_sk JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk JOIN web_returns ON cs_item_sk = wr_item_sk AND cs_order_number = wr_order_number JOIN time_dim ON cs_sold_time_sk = t_time_sk JOIN reason ON wr_reason_sk = r_reason_sk WHERE t_am_pm = 'AM' AND r_reason_id IN ('AAAAAAAAMBAAAAAA', 'AAAAAAAAPAAAAAAA', 'AAAAAAAAFBAAAAAA', 'AAAAAAAALAAAAAAA') AND cs_bill_addr_sk IN ('23752', '34909', '20802', '37622', '45921') AND ca_state IN ('IL', 'KY', 'OR', 'VA', 'FL', 'AL', 'OK', 'IA', 'TX') GROUP BY ca_state ORDER BY total_quantity DESC, total_return_amount_inc_tax DESC;
SELECT i.i_item_id, i.i_category, i.i_class, i.i_brand, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(cr.cr_returned_date_sk) AS return_count, SUM(cr.cr_fee) AS total_fee, SUM(cr.cr_return_ship_cost) AS total_shipping_cost, SUM(cr.cr_net_loss) AS total_net_loss FROM catalog_returns cr JOIN item i ON cr.cr_item_sk = i.i_item_sk JOIN web_site ws ON cr.cr_returned_date_sk = ws.web_open_date_sk WHERE ws.web_gmt_offset = '-5.00' AND ws.web_mkt_id IN (3, 5, 6, 1, 4, 2) AND i.i_size IN ('small', 'extra large') AND i.i_class IN ('hockey', 'infants', 'portable', 'memory') AND cr.cr_reason_sk = 3 GROUP BY i.i_item_id, i.i_category, i.i_class, i.i_brand ORDER BY total_return_amount DESC, return_count DESC LIMIT 100;
SELECT ca.ca_state AS customer_state, cp.cp_department AS department, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(cr.cr_item_sk) AS total_return_count, SUM(cr.cr_net_loss) AS total_net_loss, SUM(p.p_cost) AS total_promotion_cost FROM catalog_returns cr JOIN customer_address ca ON cr.cr_returning_addr_sk = ca.ca_address_sk JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN promotion p ON cp.cp_catalog_page_sk = p.p_item_sk WHERE cp.cp_department IN ('Electronics', 'Home & Garden', 'Books') AND p.p_cost > 1000 AND cp.cp_end_date_sk IN (2450934, 2451664) AND ca.ca_state = 'CA' AND ca.ca_gmt_offset = -8.00 GROUP BY customer_state, department ORDER BY total_net_loss DESC, total_return_count DESC;
SELECT ws.web_site_id, ws.web_name, c.c_birth_country, SUM(wsl.ws_sales_price) AS total_sales, AVG(wsl.ws_sales_price) AS average_sales, COUNT(DISTINCT wsl.ws_order_number) AS total_orders, COUNT(DISTINCT wsl.ws_item_sk) AS total_items_sold, s.s_store_name, s.s_market_manager FROM web_sales wsl JOIN web_site ws ON wsl.ws_web_site_sk = ws.web_site_sk JOIN customer c ON wsl.ws_bill_customer_sk = c.c_customer_sk JOIN store s ON s.s_market_id = ws.web_mkt_id WHERE (s.s_store_name LIKE '%ought%' OR s.s_store_name LIKE '%ation%' OR s.s_store_name LIKE '%anti%') AND s.s_market_manager = 'Charles Bartley' AND ws.web_suite_number IN ('Suite 150', 'Suite 260', 'Suite 350', 'Suite 450', 'Suite 280', 'Suite 470') AND c.c_first_sales_date_sk = '2451321' GROUP BY ws.web_site_id, ws.web_name, c.c_birth_country, s.s_store_name, s.s_market_manager ORDER BY total_sales DESC, average_sales DESC;
SELECT ca.ca_country, ca.ca_state, COUNT(DISTINCT sr.sr_ticket_number) AS num_returns, SUM(sr.sr_return_amt) AS total_return_amount, AVG(sr.sr_return_amt) AS avg_return_amount, SUM(sr.sr_return_quantity) AS total_returned_quantity, SUM(sr.sr_fee) AS total_fees, SUM(sr.sr_net_loss) AS total_net_loss FROM store_returns sr JOIN customer_address ca ON sr.sr_addr_sk = ca.ca_address_sk JOIN store s ON sr.sr_store_sk = s.s_store_sk WHERE ca.ca_country = 'United States' AND s.s_rec_start_date BETWEEN '1997-03-13' AND '2001-03-13' AND s.s_number_employees BETWEEN 236 AND 288 AND sr.sr_returned_date_sk IN ('2452372', '2451953', '2452254') GROUP BY ca.ca_country, ca.ca_state ORDER BY total_return_amount DESC;
SELECT sm.sm_type AS ship_mode_type, s.s_state AS store_state, COUNT(DISTINCT cr.cr_order_number) AS num_returns, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_quantity) AS avg_return_quantity, COUNT(DISTINCT ss.ss_ticket_number) AS num_sales, SUM(ss.ss_net_paid) AS total_sales_net_paid, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS avg_sales_price FROM catalog_returns cr JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk JOIN ship_mode sm ON cr.cr_ship_mode_sk = sm.sm_ship_mode_sk JOIN store_sales ss ON ss.ss_store_sk = cr.cr_returning_customer_sk JOIN store s ON ss.ss_store_sk = s.s_store_sk WHERE cp.cp_type = 'monthly' GROUP BY sm.sm_type, s.s_state ORDER BY total_return_amount DESC, total_sales_net_paid DESC;
SELECT d_year, cp_department, sm_type, p_promo_name, COUNT(cs_order_number) AS total_orders, SUM(cs_quantity) AS total_quantity, AVG(cs_sales_price) AS average_sales_price, SUM(cs_net_paid_inc_ship_tax) AS total_revenue, SUM(cs_ext_tax) AS total_tax_collected, AVG(cs_net_profit) AS average_profit FROM catalog_sales JOIN date_dim ON cs_sold_date_sk = d_date_sk JOIN catalog_page ON cs_catalog_page_sk = cp_catalog_page_sk JOIN ship_mode ON cs_ship_mode_sk = sm_ship_mode_sk JOIN promotion ON cs_promo_sk = p_promo_sk WHERE d_year = 2001 AND cp_department LIKE 'Electronics%' AND sm_type = 'AIR' AND p_channel_event = 'N' AND cs_net_paid_inc_ship_tax BETWEEN 500 AND 8000 GROUP BY d_year, cp_department, sm_type, p_promo_name ORDER BY total_revenue DESC, average_profit DESC;
SELECT ws.ws_item_sk, hd.hd_income_band_sk, AVG(ws.ws_net_profit) AS avg_net_profit_web_sales, SUM(cr.cr_net_loss) AS total_net_loss_catalog_returns FROM web_sales ws JOIN catalog_returns cr ON ws.ws_item_sk = cr.cr_item_sk AND ws.ws_order_number = cr.cr_order_number JOIN household_demographics hd ON (ws.ws_bill_hdemo_sk = hd.hd_demo_sk OR ws.ws_ship_hdemo_sk = hd.hd_demo_sk) AND (cr.cr_refunded_hdemo_sk = hd.hd_demo_sk OR cr.cr_returning_hdemo_sk = hd.hd_demo_sk) WHERE hd.hd_buy_potential IN ('0-500', '5001-10000', '>10000', '1001-5000') AND ws.ws_warehouse_sk IN (1, 2) AND cr.cr_warehouse_sk IN (1, 2) AND ws.ws_item_sk IN (8530, 14257, 11258, 15637, 6283) AND cr.cr_item_sk IN (9044, 17656, 9802) GROUP BY ws.ws_item_sk, hd.hd_income_band_sk;
SELECT p.p_promo_name, p.p_channel_details, COUNT(*) AS num_promotions, AVG(p.p_cost) AS avg_promo_cost, SUM(p.p_response_target) AS total_response_target, ca.ca_country, ca.ca_state, ca.ca_city, AVG(hd.hd_dep_count) AS avg_dependency_count, AVG(hd.hd_vehicle_count) AS avg_vehicle_count, SUM(CASE WHEN hd.hd_buy_potential = 'High' THEN 1 ELSE 0 END) AS high_buy_potential_count, SUM(CASE WHEN hd.hd_buy_potential = 'Low' THEN 1 ELSE 0 END) AS low_buy_potential_count FROM promotion p JOIN household_demographics hd ON p.p_item_sk = hd.hd_demo_sk JOIN customer_address ca ON hd.hd_demo_sk = ca.ca_address_sk WHERE ca.ca_address_id IN ('AAAAAAAAOBJAAAAA', 'AAAAAAAAINCBAAAA', 'AAAAAAAABBBBAAAA') AND p.p_discount_active = 'Y' GROUP BY ROLLUP (p.p_promo_name, p.p_channel_details, ca.ca_country, ca.ca_state, ca.ca_city) ORDER BY ca.ca_country, ca.ca_state, ca.ca_city, p.p_promo_name;
SELECT cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, hd.hd_income_band_sk, hd.hd_buy_potential, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo, AVG(ss.ss_sales_price) AS avg_sales_price, AVG(ss.ss_coupon_amt) AS avg_coupon_amt, SUM(ss.ss_quantity) AS total_quantity_sold, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, AVG((ss.ss_list_price - ss.ss_sales_price) / ss.ss_list_price * 100) AS avg_discount_rate FROM store_sales ss JOIN customer_demographics cd ON ss.ss_cdemo_sk = cd.cd_demo_sk JOIN household_demographics hd ON ss.ss_hdemo_sk = hd.hd_demo_sk JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk GROUP BY ROLLUP ( cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, hd.hd_income_band_sk, hd.hd_buy_potential, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo ) ORDER BY cd.cd_gender, cd.cd_marital_status, cd.cd_education_status, cd.cd_purchase_estimate, cd.cd_credit_rating, hd.hd_income_band_sk, hd.hd_buy_potential, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog, p.p_channel_tv, p.p_channel_radio, p.p_channel_press, p.p_channel_event, p.p_channel_demo;
SELECT ca.ca_state, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_net_paid) AS total_sales_amount, AVG(ss.ss_net_paid) AS average_sales_amount, SUM(ss.ss_quantity) AS total_quantity_sold FROM store_sales AS ss JOIN customer_address AS ca ON ss.ss_addr_sk = ca.ca_address_sk JOIN inventory AS inv ON ss.ss_item_sk = inv.inv_item_sk AND ss.ss_sold_date_sk = inv.inv_date_sk WHERE ca.ca_location_type = 'single family' AND inv.inv_warehouse_sk IN (1, 2) GROUP BY ca.ca_state ORDER BY total_sales_amount DESC;
SELECT cp_department, cd_gender, cd_marital_status, cd_education_status, COUNT(DISTINCT sr_ticket_number) AS total_returns, SUM(sr_return_quantity) AS total_returned_quantity, AVG(sr_return_amt) AS average_return_amount, SUM(sr_return_amt_inc_tax) AS total_return_amount_inc_tax, SUM(sr_fee) AS total_fees, SUM(sr_net_loss) AS total_net_loss FROM catalog_page JOIN store_returns ON cp_catalog_page_sk = sr_returned_date_sk JOIN customer_demographics ON cd_demo_sk = sr_cdemo_sk WHERE cp_department = 'DEPARTMENT' AND (cp_start_date_sk = 2451665 OR cp_start_date_sk = 2451360) GROUP BY cp_department, cd_gender, cd_marital_status, cd_education_status ORDER BY total_returned_quantity DESC;
SELECT dd.d_year, dd.d_quarter_name, COUNT(DISTINCT c.c_customer_sk) AS total_customers, COUNT(DISTINCT sr.sr_store_sk) AS total_stores_with_returns, SUM(sr.sr_return_quantity) AS total_returned_quantity, AVG(sr.sr_return_amt) AS average_return_amount, SUM(sr.sr_return_amt) AS total_return_amount, SUM(sr.sr_fee) AS total_fees_collected, SUM(sr.sr_net_loss) AS total_net_loss FROM date_dim dd JOIN store_returns sr ON dd.d_date_sk = sr.sr_returned_date_sk JOIN store s ON sr.sr_store_sk = s.s_store_sk JOIN customer c ON sr.sr_customer_sk = c.c_customer_sk WHERE dd.d_year IN (1909, 1903, 1901, 1907, 1911, 1900) AND dd.d_quarter_seq = 53 AND NOT EXISTS (SELECT 1 FROM promotion WHERE p_channel_tv = 'N' AND p_promo_sk = sr.sr_item_sk) GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT ib.ib_lower_bound, ib.ib_upper_bound, hd.hd_dep_count, COUNT(DISTINCT cs.cs_order_number) AS total_sales_orders, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_quantity) AS total_quantity_sold, COUNT(DISTINCT wr.wr_order_number) AS total_return_orders, AVG(wr.wr_return_amt) AS avg_return_amount, SUM(wr.wr_return_quantity) AS total_quantity_returned FROM catalog_sales cs JOIN household_demographics hd ON cs.cs_bill_hdemo_sk = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk LEFT JOIN web_returns wr ON cs.cs_item_sk = wr.wr_item_sk AND cs.cs_order_number = wr.wr_order_number GROUP BY ib.ib_lower_bound, ib.ib_upper_bound, hd.hd_dep_count ORDER BY ib.ib_lower_bound, ib.ib_upper_bound, hd.hd_dep_count;
SELECT i.i_category, sm.sm_type, w.w_state, SUM(ws.ws_sales_price) AS total_sales, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(sr.sr_return_amt) AS total_returns, AVG(sr.sr_return_amt) AS avg_return_amt, COUNT(DISTINCT sr.sr_ticket_number) AS total_return_tickets FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN ship_mode sm ON ws.ws_ship_mode_sk = sm.sm_ship_mode_sk JOIN warehouse w ON ws.ws_warehouse_sk = w.w_warehouse_sk LEFT JOIN store_returns sr ON ws.ws_item_sk = sr.sr_item_sk WHERE sm.sm_code IN ('SEA', 'BIKE', 'AIR', 'SURFACE') AND i.i_class IN ('loose stones', 'swimwear', 'semi-precious', 'maternity', 'camping') AND i.i_manager_id IN ('92', '83') AND w.w_street_name LIKE '%6th%' GROUP BY i.i_category, sm.sm_type, w.w_state ORDER BY total_sales DESC, total_returns DESC;
SELECT ws.ws_item_sk, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_ext_discount_amt) AS avg_discount_amt, AVG(ws.ws_sales_price) AS avg_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, hd.hd_dep_count AS avg_dependents, hd.hd_vehicle_count AS avg_vehicles, s.s_store_name, s.s_city, s.s_state, SUM(inv.inv_quantity_on_hand) AS total_inventory_on_hand FROM web_sales ws JOIN household_demographics hd ON ws.ws_ship_hdemo_sk = hd.hd_demo_sk JOIN store s ON ws.ws_warehouse_sk = s.s_store_sk JOIN inventory inv ON (ws.ws_item_sk = inv.inv_item_sk AND ws.ws_warehouse_sk = inv.inv_warehouse_sk) WHERE ws.ws_ship_customer_sk IN ('14120', '70023', '31659', '86542') AND ws.ws_ship_addr_sk IN ('8368', '47705', '32703', '24892') AND inv.inv_date_sk = '2450815' AND hd.hd_vehicle_count IN (1, 0, 3, 2) AND s.s_number_employees IN (245, 271, 236, 218, 288, 278) GROUP BY ws.ws_item_sk, hd.hd_dep_count, hd.hd_vehicle_count, s.s_store_name, s.s_city, s.s_state ORDER BY total_net_paid DESC, total_orders DESC;
SELECT s.s_store_name, s.s_state, cp.cp_department, COUNT(*) AS total_returns, AVG(wr.wr_return_amt) AS avg_refund_amount, AVG(wr.wr_return_tax) AS avg_tax, AVG(wr.wr_return_ship_cost) AS avg_shipping_cost, SUM(wr.wr_net_loss) AS total_net_loss, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, COUNT(DISTINCT wr.wr_refunded_customer_sk) AS unique_customers FROM web_returns wr JOIN store s ON wr.wr_returning_addr_sk = s.s_store_sk JOIN customer_demographics cd ON wr.wr_refunded_cdemo_sk = cd.cd_demo_sk JOIN catalog_page cp ON wr.wr_web_page_sk = cp.cp_catalog_page_sk WHERE s.s_division_id = 1 AND s.s_tax_precentage IN (0.08, 0.01, 0.06, 0.03) AND cp.cp_description LIKE 'Traditional, clear years used to cover regardless%' AND cp.cp_start_date_sk >= 2450997 AND cd.cd_credit_rating = 'Good' GROUP BY s.s_store_name, s.s_state, cp.cp_department ORDER BY total_net_loss DESC, avg_refund_amount DESC;
SELECT ca_state, w_city, wp_type, SUM(cs_net_paid) as total_catalog_sales, AVG(ws_net_paid_inc_ship_tax) as avg_web_sales_inc_ship_tax, COUNT(DISTINCT ws_web_page_sk) as distinct_web_pages_accessed, COUNT(DISTINCT sr_reason_sk) as count_distinct_return_reasons, SUM(sr_return_amt) as total_return_amount, MIN(cs_sales_price) as min_catalog_sales_price, MAX(ws_sales_price) as max_web_sales_price FROM customer_address JOIN catalog_sales ON ca_address_sk = cs_ship_addr_sk JOIN web_sales ON ca_address_sk = ws_bill_addr_sk JOIN warehouse ON cs_warehouse_sk = w_warehouse_sk JOIN web_page ON ws_web_page_sk = wp_web_page_sk LEFT JOIN store_returns ON sr_addr_sk = ca_address_sk WHERE w_city = 'Fairview' AND wp_type IN ('feedback', 'dynamic', 'protected', 'welcome', 'general') AND ws_web_site_sk IN ('22', '17', '24', '18', '2') AND cs_ship_customer_sk IN ('47431', '33123', '91253') GROUP BY ca_state, w_city, wp_type ORDER BY total_catalog_sales DESC, avg_web_sales_inc_ship_tax DESC;
SELECT i.i_category AS category, p.p_channel_dmail AS promo_direct_mail, p.p_channel_email AS promo_email, p.p_channel_catalog AS promo_catalog, COUNT(DISTINCT i.i_item_sk) AS total_items, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN item i ON ws.ws_item_sk = i.i_item_sk JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk GROUP BY i.i_category, p.p_channel_dmail, p.p_channel_email, p.p_channel_catalog ORDER BY total_net_profit DESC, total_quantity_sold DESC;
SELECT web.web_name AS website_name, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_sales_price) AS average_sales_price, SUM(ws.ws_net_paid) AS total_net_paid, SUM(ws.ws_net_profit) AS total_net_profit, t.t_shift AS sales_shift, s.s_store_name AS store_name, s.s_number_employees AS number_of_employees, s.s_city AS store_city, SUM(s.s_tax_precentage) AS total_tax_percentage_collected FROM web_sales ws JOIN web_site web ON ws.ws_web_site_sk = web.web_site_sk JOIN time_dim t ON ws.ws_sold_time_sk = t.t_time_sk JOIN store s ON web.web_mkt_id = s.s_market_id WHERE web.web_mkt_id IN ('1', '4', '3') AND t.t_shift = 'third' AND s.s_gmt_offset = '-5.00' AND s.s_number_employees IN ('297', '278', '229', '245') GROUP BY web.web_name, t.t_shift, s.s_store_name, s.s_number_employees, s.s_city ORDER BY total_net_profit DESC;
SELECT p.p_promo_id, p.p_promo_name, SUM(ws.ws_net_profit) AS total_net_profit, AVG(ws.ws_sales_price) AS avg_sales_price, COUNT(DISTINCT ws.ws_item_sk) AS number_of_items_sold, SUM(cr.cr_return_amount) AS total_returns, COUNT(DISTINCT cr.cr_item_sk) AS number_of_items_returned FROM web_sales ws JOIN promotion p ON ws.ws_promo_sk = p.p_promo_sk JOIN customer c ON ws.ws_bill_customer_sk = c.c_customer_sk LEFT JOIN catalog_returns cr ON ws.ws_item_sk = cr.cr_item_sk AND ws.ws_order_number = cr.cr_order_number JOIN item i ON ws.ws_item_sk = i.i_item_sk WHERE i.i_class_id = 4 AND c.c_birth_country IN ('GABON', 'ALBANIA', 'RUSSIAN FEDERATION', 'CHINA', 'BELGIUM', 'PORTUGAL') GROUP BY p.p_promo_id, p.p_promo_name ORDER BY total_net_profit DESC;
SELECT cc.cc_call_center_id AS call_center, cc.cc_name AS call_center_name, cc.cc_manager AS manager, SUM(i.i_current_price) AS total_sales, AVG(i.i_wholesale_cost) AS average_wholesale_cost, COUNT(DISTINCT cd.cd_demo_sk) AS unique_customer_demographics, AVG(cd.cd_purchase_estimate) AS average_purchase_estimate, COUNT(DISTINCT t.t_time_sk) AS count_time_sk_events, ib.ib_lower_bound, ib.ib_upper_bound, COUNT(*) FILTER (WHERE t.t_am_pm = 'AM') AS am_shifts, COUNT(*) FILTER (WHERE t.t_sub_shift = 'night') AS night_sub_shifts FROM call_center cc JOIN catalog_page cp ON cc.cc_call_center_id = cp.cp_catalog_page_id JOIN item i ON cp.cp_catalog_page_sk = i.i_item_sk JOIN customer_demographics cd ON i.i_manager_id = cd.cd_demo_sk JOIN time_dim t ON t.t_time_sk = cd.cd_demo_sk JOIN income_band ib ON cd.cd_purchase_estimate BETWEEN ib.ib_lower_bound AND ib.ib_upper_bound JOIN date_dim dd_cc ON cc.cc_open_date_sk = dd_cc.d_date_sk JOIN date_dim dd_cp ON cp.cp_start_date_sk = dd_cp.d_date_sk WHERE dd_cc.d_date <= CURRENT_DATE AND (cc.cc_rec_end_date IS NULL OR cc.cc_rec_end_date > CURRENT_DATE) AND dd_cp.d_date <= CURRENT_DATE AND (cp.cp_end_date_sk IS NULL OR dd_cp.d_date > CURRENT_DATE) GROUP BY cc.cc_call_center_id, cc.cc_name, cc.cc_manager, ib.ib_lower_bound, ib.ib_upper_bound ORDER BY total_sales DESC;
SELECT ca.ca_state AS customer_state, ib.ib_income_band_sk AS income_band, COUNT(DISTINCT c.c_customer_sk) AS num_customers, AVG(cs.cs_sales_price) AS avg_sales_price, SUM(cs.cs_net_profit) AS total_profit FROM catalog_sales cs JOIN customer c ON cs.cs_bill_customer_sk = c.c_customer_sk JOIN customer_address ca ON c.c_current_addr_sk = ca.ca_address_sk JOIN income_band ib ON c.c_current_hdemo_sk = ib.ib_income_band_sk JOIN promotion p ON cs.cs_promo_sk = p.p_promo_sk WHERE ib.ib_income_band_sk IN (19, 16) AND ca.ca_state IS NOT NULL AND p.p_discount_active = '1' AND cs.cs_sales_price IS NOT NULL GROUP BY ca.ca_state, ib.ib_income_band_sk ORDER BY total_profit DESC, avg_sales_price DESC, num_customers DESC;
SELECT d_year, SUM(ss_quantity) AS total_quantity_sold, AVG(ss_sales_price) AS average_sales_price, COUNT(DISTINCT ss_store_sk) AS number_of_stores, SUM(CASE WHEN ss_promo_sk IN (265, 140) THEN ss_net_paid_inc_tax ELSE 0 END) AS sales_with_special_promotions, SUM(CASE WHEN p_channel_email = 'Y' THEN ss_net_paid ELSE 0 END) AS sales_via_email_promotion FROM store_sales JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk LEFT JOIN promotion ON store_sales.ss_promo_sk = promotion.p_promo_sk WHERE d_current_month = 'N' AND d_quarter_seq IN (30, 11) AND ss_quantity IN (60, 100) AND promotion.p_promo_sk IN (35, 216, 172) AND promotion.p_item_sk = 10982 GROUP BY d_year ORDER BY d_year;
SELECT cc.cc_name AS call_center_name, st.s_store_name AS store_name, st.s_state AS store_state, ws.web_name AS website_name, p.p_promo_name AS promotion_name, p.p_channel_details AS promotion_channel_details, SUM(ss.ss_quantity) AS total_quantity_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_net_paid) AS total_net_sales, SUM(ss.ss_net_profit) AS total_net_profit FROM call_center cc JOIN store_sales ss ON cc.cc_call_center_sk = ss.ss_store_sk JOIN store st ON ss.ss_store_sk = st.s_store_sk JOIN web_site ws ON st.s_market_id = ws.web_mkt_id JOIN promotion p ON ss.ss_promo_sk = p.p_promo_sk WHERE cc.cc_manager IN ('Mark Hightower', 'Felipe Perkins', 'Bob Belcher') AND cc.cc_call_center_id = 'AAAAAAAAEAAAAAAA' AND st.s_market_id IN (4, 6, 7, 2, 8, 10) AND st.s_country = 'United States' AND p.p_start_date_sk IN (2450694, 2450318, 2450696, 2450508, 2450764, 2450750) AND ss.ss_customer_sk IN (169, 28519, 57009, 32392) GROUP BY call_center_name, store_name, store_state, website_name, promotion_name, promotion_channel_details ORDER BY total_net_sales DESC;
SELECT ca.ca_state, COUNT(DISTINCT cr.cr_order_number) AS total_returns, AVG(cr.cr_return_amount) AS avg_return_amount, SUM(cr.cr_net_loss) AS total_net_loss, COUNT(DISTINCT ss.ss_ticket_number) AS total_sales, AVG(ss.ss_sales_price) AS avg_sales_price, SUM(ss.ss_net_profit) AS total_net_profit FROM customer_address ca LEFT JOIN catalog_returns cr ON ca.ca_address_sk = cr.cr_returning_addr_sk LEFT JOIN store_sales ss ON ca.ca_address_sk = ss.ss_addr_sk LEFT JOIN catalog_page cp ON cr.cr_catalog_page_sk = cp.cp_catalog_page_sk LEFT JOIN inventory inv ON ss.ss_item_sk = inv.inv_item_sk AND cr.cr_item_sk = inv.inv_item_sk WHERE ss.ss_net_paid IN (2118.53, 811.65, 477.37) OR ss.ss_ext_sales_price IN (43.89, 681.72, 440.10, 1852.62, 93.60, 2554.68) GROUP BY ca.ca_state ORDER BY total_net_profit DESC, total_net_loss DESC
SELECT cs_state, SUM(cs_total_sales) AS total_sales, SUM(cr_total_returns) AS total_returns, (SUM(cs_net_profit) - SUM(cr_net_loss)) AS net_profit FROM (SELECT ca_state AS cs_state, SUM(ss_ext_sales_price) AS cs_total_sales, SUM(ss_net_profit) AS cs_net_profit FROM store_sales JOIN customer ON ss_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk GROUP BY ca_state) sales LEFT JOIN (SELECT ca_state AS cr_state, SUM(cr_return_amount) AS cr_total_returns, SUM(cr_net_loss) AS cr_net_loss FROM catalog_returns JOIN customer ON cr_returning_customer_sk = c_customer_sk JOIN customer_address ON c_current_addr_sk = ca_address_sk GROUP BY ca_state) returns ON sales.cs_state = returns.cr_state GROUP BY cs_state ORDER BY net_profit DESC;
SELECT cp.cp_department, i.i_category, SUM(wr.wr_return_quantity) AS total_returned_quantity, AVG(wr.wr_return_amt) AS avg_return_amount, COUNT(DISTINCT wr.wr_order_number) AS count_distinct_orders, AVG(w.w_warehouse_sq_ft) AS avg_warehouse_sq_ft, SUM(wr.wr_fee) AS total_fees, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, SUM(wr.wr_net_loss) AS total_net_loss FROM web_returns wr JOIN item i ON wr.wr_item_sk = i.i_item_sk JOIN catalog_page cp ON wr.wr_web_page_sk = cp.cp_catalog_page_sk JOIN warehouse w ON i.i_manufact_id = w.w_warehouse_sk WHERE wr.wr_returned_date_sk IS NOT NULL AND cp.cp_description = 'Effects change easy, real types; young, corporate' AND wr.wr_refunded_addr_sk IN ('47678', '14023', '11197', '22228', '47074') GROUP BY cp.cp_department, i.i_category ORDER BY total_returned_quantity DESC, avg_return_amount DESC;
SELECT cc.cc_name, cc.cc_city, cc.cc_state, SUM(cr.cr_return_amount) AS total_return_amount, AVG(cr.cr_return_amount) AS avg_return_amount, COUNT(*) AS total_returns, SUM(cr.cr_net_loss) AS total_net_loss, r.r_reason_desc, COUNT(r.r_reason_desc) AS reason_count FROM call_center cc JOIN catalog_returns cr ON cc.cc_call_center_sk = cr.cr_call_center_sk JOIN reason r ON cr.cr_reason_sk = r.r_reason_sk GROUP BY cc.cc_name, cc.cc_city, cc.cc_state, r.r_reason_desc ORDER BY total_net_loss DESC, total_returns DESC;
SELECT i.i_category, i.i_class, cp.cp_department, w.w_state, p.p_channel_dmail, p.p_channel_email, AVG(i.i_wholesale_cost) AS avg_wholesale_cost, SUM(inv.inv_quantity_on_hand) AS total_quantity_on_hand, COUNT(DISTINCT p.p_promo_sk) AS num_promotions FROM item i JOIN catalog_page cp ON i.i_item_sk = cp.cp_catalog_page_sk JOIN inventory inv ON i.i_item_sk = inv.inv_item_sk JOIN warehouse w ON inv.inv_warehouse_sk = w.w_warehouse_sk JOIN promotion p ON i.i_item_sk = p.p_item_sk WHERE w.w_state = 'TN' AND p.p_channel_dmail = 'Y' AND p.p_channel_email = 'Y' GROUP BY i.i_category, i.i_class, cp.cp_department, w.w_state, p.p_channel_dmail, p.p_channel_email HAVING AVG(i.i_wholesale_cost) > 0 ORDER BY avg_wholesale_cost DESC, total_quantity_on_hand DESC;
SELECT w.w_state, t.t_shift, s.s_geography_class, COUNT(ss.ss_ticket_number) AS total_sales_transactions, SUM(ss.ss_quantity) AS total_items_sold, AVG(ss.ss_sales_price) AS average_sales_price, SUM(ss.ss_coupon_amt) AS total_coupon_amount, SUM(wr.wr_return_quantity) AS total_returned_items, AVG(wr.wr_fee) AS average_return_fee, SUM(wr.wr_net_loss) AS total_net_loss FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk JOIN time_dim t ON ss.ss_sold_time_sk = t.t_time_sk JOIN warehouse w ON s.s_state = w.w_state LEFT JOIN web_returns wr ON ss.ss_item_sk = wr.wr_item_sk AND ss.ss_ticket_number = wr.wr_order_number WHERE w.w_state = 'TN' AND t.t_am_pm = 'AM' AND s.s_geography_class = 'Unknown' AND ( ss.ss_coupon_amt = 449.88 OR ss.ss_coupon_amt = 3399.87 OR ss.ss_coupon_amt = 28.33 OR ss.ss_coupon_amt = 434.01 OR ss.ss_coupon_amt = 1885.51 ) GROUP BY w.w_state, t.t_shift, s.s_geography_class;
SELECT cd.cd_education_status, AVG(cd.cd_purchase_estimate) AS avg_purchase_estimate, SUM(case when c.c_preferred_cust_flag = 'Y' then 1 else 0 end) AS preferred_customer_count, COUNT(DISTINCT c.c_customer_sk) AS unique_customers, SUM(hd.hd_vehicle_count) AS total_vehicles, MIN(p.p_cost) AS min_promo_cost, MAX(p.p_cost) AS max_promo_cost, SUM(inv.inv_quantity_on_hand) AS total_inventory FROM customer_demographics cd JOIN customer c ON cd.cd_demo_sk = c.c_current_cdemo_sk JOIN household_demographics hd ON c.c_current_hdemo_sk = hd.hd_demo_sk JOIN promotion p ON p.p_start_date_sk BETWEEN 2450688 AND 2450740 JOIN inventory inv ON inv.inv_date_sk = 2450815 WHERE cd.cd_education_status IN ('Secondary', 'Primary', '2 yr Degree', 'Advanced Degree') AND c.c_email_address IN ('Bruce.Goodwin@3mtLAZrvaCRJ9p.org', 'Douglas.Smith@hF9KfOktaH5qz3.edu', 'Ana.Cary@imJui63o9G08Nas.com') AND p.p_promo_sk IN ('260', '238', '124', '179', '203') GROUP BY cd.cd_education_status;
SELECT ca.ca_city, ca.ca_state, hd.hd_income_band_sk, COUNT(DISTINCT ws.ws_order_number) AS total_orders, SUM(ws.ws_quantity) AS total_quantity_sold, AVG(ws.ws_net_paid) AS average_net_paid, SUM(ws.ws_net_paid_inc_tax) AS total_net_paid_including_tax, AVG(ws.ws_net_profit) AS average_net_profit FROM web_sales ws JOIN customer_address ca ON ws.ws_bill_addr_sk = ca.ca_address_sk JOIN household_demographics hd ON ws.ws_bill_hdemo_sk = hd.hd_demo_sk WHERE ca.ca_country = 'United States' AND (ca.ca_city IN ('Argyle', 'Collinsville', 'Ferguson') OR hd.hd_demo_sk IN (1967, 3880)) AND ws.ws_sold_time_sk IN (27944, 62910, 57271, 74886, 48677, 80582) AND ws.ws_net_paid_inc_tax >= 7202.65 GROUP BY ca.ca_city, ca.ca_state, hd.hd_income_band_sk ORDER BY total_net_paid_including_tax DESC, average_net_profit DESC;
SELECT i_category, i_class, web_state, web_name, avg_hd_vehicle_count, avg_ib_lower_bound, sum_i_current_price, avg_i_wholesale_cost, count_distinct_items FROM ( SELECT i.i_category, i.i_class, ws.web_state, ws.web_name, AVG(hd.hd_vehicle_count) AS avg_hd_vehicle_count, AVG(ib.ib_lower_bound) AS avg_ib_lower_bound, SUM(i.i_current_price) AS sum_i_current_price, AVG(i.i_wholesale_cost) AS avg_i_wholesale_cost, COUNT(DISTINCT i.i_item_sk) AS count_distinct_items FROM item i JOIN household_demographics hd ON i.i_manager_id = hd.hd_demo_sk JOIN income_band ib ON hd.hd_income_band_sk = ib.ib_income_band_sk JOIN web_site ws ON i.i_manufact_id = ws.web_company_id WHERE i.i_category IN ('Home', 'Men', 'Women') AND i.i_class IN ('toddlers', 'basketball', 'bedding') AND hd.hd_buy_potential IN ('0-500', 'Unknown', '501-1000') AND hd.hd_vehicle_count IN (4, 3, 0) AND ws.web_state = 'TN' AND ws.web_name IN ('site_0', 'site_3', 'site_4') AND ib.ib_lower_bound IN (150001, 160001, 120001) AND ib.ib_upper_bound IN (70000, 200000, 10000) AND ib.ib_income_band_sk IN (6, 11, 18) GROUP BY i.i_category, i.i_class, ws.web_state, ws.web_name ) AS derived_table ORDER BY i_category, i_class, web_state, web_name;
SELECT ca.ca_state, ca.ca_location_type, COUNT(DISTINCT cs.cs_order_number) AS total_orders, SUM(cs.cs_quantity) AS total_quantity_sold, AVG(cs.cs_sales_price) AS average_sales_price, SUM(cs.cs_net_profit) AS total_net_profit, w.w_street_name, w.w_city FROM catalog_sales cs JOIN customer_address ca ON cs.cs_ship_addr_sk = ca.ca_address_sk JOIN warehouse w ON cs.cs_warehouse_sk = w.w_warehouse_sk WHERE ca.ca_state = 'VA' AND ca.ca_location_type IN ('single family', 'apartment', 'condo') AND cs.cs_net_profit > 0 AND w.w_gmt_offset = -5.00 GROUP BY ca.ca_state, ca.ca_location_type, w.w_street_name, w.w_city ORDER BY total_net_profit DESC;
SELECT dd.d_year, dd.d_quarter_name, COUNT(DISTINCT c.c_customer_sk) AS total_customers, SUM(inv.inv_quantity_on_hand) AS total_inventory, AVG(cc.cc_employees) AS average_employees, SUM(CASE WHEN ws.web_country = 'United States' THEN 1 ELSE 0 END) AS total_us_websites FROM date_dim dd JOIN inventory inv ON dd.d_date_sk = inv.inv_date_sk JOIN customer c ON dd.d_date_sk = c.c_first_sales_date_sk JOIN call_center cc ON dd.d_date_sk = cc.cc_open_date_sk JOIN web_site ws ON dd.d_date_sk = ws.web_open_date_sk WHERE dd.d_year = 2022 AND inv.inv_warehouse_sk = 1 AND ws.web_county = 'Williamson County' AND ws.web_street_name IN ('Hickory 3rd', 'Broadway South', 'Cedar North', 'Railroad', 'Lake') AND dd.d_last_dom IN ('2419096', '2418790', '2417026', '2416844', '2419340', '2415871') AND dd.d_week_seq IN ('499', '115') AND c.c_salutation IN ('Mr.', 'Ms.', 'Mrs.') AND c.c_birth_day = 5 GROUP BY dd.d_year, dd.d_quarter_name ORDER BY dd.d_year, dd.d_quarter_name;
SELECT d_year, p_channel_details, COUNT(DISTINCT ws_order_number) AS web_order_count, SUM(ws_net_paid) AS total_web_sales, SUM(ws_net_profit) AS total_web_profit, AVG(ws_quantity) AS average_quantity_sold, SUM(ss_net_paid) AS total_store_sales, SUM(ss_net_profit) AS total_store_profit, AVG(ss_quantity) AS average_store_quantity_sold FROM web_sales JOIN store_sales ON ws_item_sk = ss_item_sk JOIN date_dim ON ws_sold_date_sk = d_date_sk JOIN promotion ON ws_promo_sk = p_promo_sk WHERE d_year IN (1902, 1903, 1904) AND p_channel_details IS NOT NULL AND (ws_net_paid > 0 OR ss_net_paid > 0) GROUP BY d_year, p_channel_details ORDER BY d_year, p_channel_details;
